{"title": "Enhancing Angular Resolution via Directionality Encoding and Geometric Constraints in Brain Diffusion Tensor Imaging", "authors": ["Sheng Chen", "Zihao Tang", "Mariano Cabezas", "Xinyi Wang", "Arkiev D'Souza", "Michael Barnett", "Fernando Calamante", "Weidong Cai", "Chenyu Wang"], "abstract": "Diffusion-weighted imaging (DWI) is a type of Magnetic Resonance Imaging (MRI) technique sensitised to the diffusivity of water molecules, offering the capability to inspect tissue microstructures and is the only in-vivo method to reconstruct white matter fiber tracts non-invasively. The DWI signal can be analysed with the diffusion tensor imaging (DTI) model to estimate the directionality of water diffusion within voxels. Several scalar metrics, including axial diffusivity (AD), mean diffusivity (MD), radial diffusivity (RD), and fractional anisotropy (FA), can be further derived from DTI to quantitatively summarise the microstructural integrity of brain tissue. These scalar metrics have played an important role in understanding the organisation and health of brain tissue at a microscopic level in clinical studies. However, reliable DTI metrics rely on DWI acquisitions with high gradient directions, which often go beyond the commonly used clinical protocols. To enhance the utility of clinically acquired DWI and save scanning time for robust DTI analysis, this work proposes DirGeo-DTI, a deep learning-based method to estimate reliable DTI metrics even from a set of DWIs acquired with the minimum theoretical number (6) of gradient directions. DirGeo-DTI leverages directional encoding and geometric constraints to facilitate the training process. Two public DWI datasets were used for evaluation, demonstrating the effectiveness of the proposed method. Extensive experimental results show that the proposed method achieves the best performance compared to existing DTI enhancement methods and potentially reveals further clinical insights with routine clinical DWI scans.", "sections": [{"title": "1 Introduction", "content": "Magnetic Resonance Imaging (MRI) is a non-invasive imaging technique based on the principles of nuclear magnetic resonance, used to generate detailed internal images of the human body [22,30]. Among MRI techniques, diffusion-weighted imaging (DWI) is sensitised to Brownian motion and measures water diffusivity as it is constrained by various tissue structures [35]. Thus, DWI can reveal microstructural organisation and assess the impact of pathology on tissue integrity. Therefore, it has become a remarkable surrogate in clinical neuroscience research since the 1990s [36,4].\nThe Diffusion Tensor Imaging (DTI), one of the most widely used DWI mod-els, characterised by a tensor matrix D as follows:\n\nD = \n  \nDxx Dxy Dxz\n  Dxy Dyy Dyz\n  [Dxz Dyz Dzz\n  \n\n(1)\n\nThe symmetry of D implies that, theoretically, only 6 unique coefficients need to be estimated, requiring at least 6 unique DWIs. In clinical research studies, a greater number of DWIs are generally used to ensure an accurate DTI esti-mation [23]. Specifically, it was recommended to acquire more than 20 diffusion gradient directions to obtain reliable DTI scalar metrics [17]. However, DWI has been much more commonly used for stroke diagnosis in clinical practice [11] and has broad applications to differentiate pathologies that result in diffusion restriction, which is often acquired with much fewer DWI directions. While lever-aging retrospective clinical data for new observational studies, DWIs obtained through clinical protocols might not include sufficient gradient directions for reliable DTI metrics. Existing methods have yet to integrate the directional information embedded in bvec which contains valuable information for enhanc-ing angular resolution. Furthermore, they have ignored exploiting the inherent geometrical properties of DTI model, which can be leveraged to constrain the differences between the enhanced DTI and the ground truth. To this end, we propose a DirGeo-DTI, which enhances the angular resolution of DTI with only 6 unique diffusion gradient directions via directionality encoding and geomet-ric constraints. Experimental results on two public datasets demonstrate that DirGeo-DTI outperforms existing methods with scalar metrics derived from the enhanced DTIs by DirGeo-DTI comparable to those derived from the ground truth. Our contributions can be summarized as follows:\n\u2013 DirGeo-DTI is the first method to integrate the information of diffusion gradient direction (bvec) by the proposed novel Diffusion Gradient Encoding (DGE).\n\u2013 DirGeo-DTI has leveraged geometric learning, including stress invariants from physics and FA, to constrain the geometrical properties of the predicted DTI model.\n\u2013 Extensive experimental results demonstrate that DirGeo-DTI achieves the best performance and has the potential to reveal further clinical insights with routine clinical DWI scans."}, {"title": "2 Methods", "content": "2.1 Related Works\nIn recent years, deep learning has significantly advanced structural brain MRI applications, leading to successful translation into real clinical practice [5,29]. DWI, in contrast, the complexity of data requires sophisticated techniques for accurate analysis and reconstruction. Several deep learning-based methods have been proposed to address various challenges in this domain. To maximize the utility of retrospective DWI, efforts have been made to reconstruct missing slices caused by the limited field of view (FOV) in acquisition protocols through deep learning techniques [31,32,12]. Clinically acquired scans are often constrained by acquisition protocols with low spatial and angular resolutions due to cost limita-tions [1]. Several methods were proposed to perform spatial super-resolution on DWI and its derivatives. While angular resolution is a property unique to diffu-sion MRI scans, few studies have specifically addressed this aspect. DeepDTI [33] and HADTI-Net [30] were developed to enhance the angular resolution of DTI. DeepDTI utilises raw DWI, b0, and T1/T2-weighted images as inputs, which are processed by a 3D convolutional neural network (CNN) to improve DWIs, followed by fitting the enhanced images to a tensor model. HADTI-Net, on the other hand, employs a 3D U-Net to use DWI, b0, and T1-weighted images to directly produce enhanced DTI metrics. While both methods have demonstrated improved DTI quality, they have not fully investigated the impact of incorpo-rating diffusion gradient directions and geometric constraints in enhancing the angular resolution of DTI.\n2.2 Datasets\nThe Human Connectome Project (HCP) and Parkinson's Progression Markers Initiative (PPMI) databases were used for this study.\nThe HCP database [37] comprises structural imaging and DWI data acquired with 3 diffusion-weighted shells (b1000, b2000 and 63000 with 90 gradient directions for each b-value). We randomly selected 100 subjects from the HCP database and split them between training (80) and testing (20) in this work.\nPPMI [21] is a collaborative study for Parkinson's Disease (PD) that com-prises a large-scale imaging data collection including DWIs and structural imag-ing for both healthy controls and patients with PD. For each subject, DWI scans with 64 gradient directions were acquired with b1000. In our study, 225 subjects from the dataset were selected for model training (180) and testing (45). The class balance was maintained for both the training and testing sets. In contrast with HCP whose data is already pre-processed, the images required additional preprocessing for the raw DWI [2,3,38,34] and T1 [15,10] images as illustrated in Figure 1."}, {"title": "2.3 Data Preparation", "content": "All available b1000 directions from the preprocessed DWIs in each dataset were first selected to derive the ground truth DTI due to the signal diminishing at high b-values [16] and b1000 is commonly used in clinical acquisitions. From this set of images, 6 most evenly distributed directions from all possible sets were sub-sampled using the Kennard-Stone algorithm [18] in Q-Space to select the most evenly distributed set of 6-direction DWIs as input to the proposed net-work. A diffusion tensor model was then fitted at each voxel [7] of the two sets of preprocessed images using FSL DTIFIT to generate the corresponding DTI vol-umes for the 6 direction volumes (namely 6-dir DTI) and the ground truth ones $D_{GT}$ (derived from all available b1000 directions). 72 White Matter (WM) fiber tracts were generated using TractSeg [38] on the original preprocessed DWIs."}, {"title": "2.4 DirGeo-DTI", "content": "The detailed design of the proposed DirGeo-DTI is illustrated in Figure 2. DirGeo-DTI takes bo image plus 6 unique DWIs and 7 corresponding bvec ((0, 0, 0) as buec for bo image) as input to generate enhanced DTI volumes (\u00ce\u00d4I).\nDirectionality Encoding The diffusion tensor $\\hat{D}$ at each voxel can be esti-mated from DWI data using the Stejskal-Tanner equation: $S_k = S_0e^{-b \\hat{g}D\\hat{g}_k}$ [28]. In this equation, $S_0$ represents the signal acquired without any diffusion-sensitizing gradients (often referred to as the bo image), while $S_k$ represents the diffusion-weighted signal measured along the gradient direction $\\hat{g}_k$ with diffusion weight-ing factor b [6,24]. The gradient direction $\\hat{g}_k$, commonly referred to as buec, is a crucial parameter in diffusion MRI acquisition and DTI modeling, providing essential directional information to solve the Stejskal-Tanner equation. For a given gradient direction, $\\hat{g}_k = (g_x, g_y, g_z)$, the Stejskal-Tanner equation can be expanded to:\n\nln(S_0) - ln(S_k) = g\\cdot d,\n\n(2)\nwhere g is defined as the vector $[g_x^2, 2g_xg_y, 2g_xg_z, g_y^2, 2g_yg_z, g_z^2]$ and d represents our estimation target $[D_{xx}, D_{xy}, D_{xz}, D_{yy}, D_{yz}, D_{zz}]$.\nInspecting the Equation 2, leveraging bvec is vital for enhancing the angular resolution of DTI because it encodes directional constraints. A novel Diffusion Gradient Encoding (DGE) block is thus proposed to leverage buec efficiently. The DGE block is designed to incorporate directional information directly into the network's learning process. It takes the feature map $X_i \\in R^{N\u00d7C\u00d7W\u00d7H\u00d7D}$ and a diffusion gradient embedding $E_i \\in R^{N\u00d7C}$ as inputs, where i denotes the layer position within the network. The DGE block processes these inputs through a multilayer perceptron (MLP) that maps the diffusion-weighted information from $X_i$ and $E_i$ into latent embeddings separately. These two embeddings are then combined and used to recalibrate the feature map channels in the subsequent layers [14]. The overall process in the DGE block can be formulated as follows:\n\nEi+1 = F2(\u03bc(F1(Xi))) + F3(Ei),\n(3)\nXi+1 = F1(Xi) \u00d7 Ei+1,\n(4)\nwhere $F_1$ is a convolution operation, $F_2$ and $F_3$ are two independent MLPs, and \u03bc denotes average pooling. This design ensures that the directional information from the gradient directions is effectively integrated into the feature extraction process, providing a more robust representation of diffusion information and improving the estimation of the corresponding DTI model. The DGE block, therefore, learns a representation of the missing diffusion gradient directions and"}, {"title": "2.5 Geometric Learning", "content": "Stress Invariants From a physics perspective, the mathematical representation of D describes a stress tensor (\u03c3) representing directional variations in stress due to stress anisotropies, as shown in Equation 6. Moreover, stress invariants associated with are a set of constraints that are unaffected by stress and are important parameters used in failure criteria [8,13], plasticity, and Mohr's circle [19]. In DTI angular resolution enhancement, stress invariants can be used to constrain the enhanced DTI prediction and force geometrical similarity with the corresponding ground truth. Based on this observation, we integrate the stress invariants of o as part of the geometric learning of DirGeo-DTI.\nSpecifically, the stress invariants of a symmetric 3\u00d73 matrix can be expressed by the three different orders of principle minors of the tensor. The first-order principal minors (\u03941) are defined by the diagonal elements of the stress tensor (\u03c3\u03c7\u03b1, \u03c3yy, and ozz) and represent the normal stresses on the three axes. This constraint in A\u2081, can be easily covered by calculating the L1 loss between GT (DGT) and the enhanced DTI (\u00ceD) from the network:\n\nLDTI = ||DGT \u2013 \u00ce\u010e||1.\n\n(5)\nThe second-order principal minors (A2) represent the contributions of the shear stress components to the overall stress state, reflecting the interaction between normal and shear stresses on different planes. The definitions for A2 are formu-lated in Equations 7 and 8 and a new loss L\u2081\u2082 is then implemented as Equation 9.\n\n\u03c3 = \n  \n\u03c3\u03c7\u03b1 \u03c3\u03c7\u03b7 \u03c3\u03b5\u03b6\nOxy \u03c3yy \u03c3yz\n[Oxz oyz Ozz\n,\n\n(6)\n\nM\u2081 = \n  \n\u03c3\u03c7\u03b1 \u03c3\u03c7\u03b7\n[\u0431\u0443\u0445 \u0431\u0443\u0443\n\n,\nM2 = \n  \n\u03c3\u03c7\u03b1 \u03c3\u03c7\u03b6\nJzy Ozz\n\n,\nM3 = \n  \nJyy \u03c3yz\n[Ozy Ozz\n\n,\n\n(7)\n\n\u03942(\u03c3) = det(M1) + det(M2) + det(M3),\n(8)\nL\u0394\u2082 = ||\u03942(DGT) \u2013 \u03942(\u00ce\u00ce)||1.\n(9)\nFinally, the third-order principal minors (A3) are defined as the determinant of the entire stress tensor. From a theoretical perspective, DTI at a certain voxel in the brain can be understood as applying a 3D linear transformation (defined by rotation, scaling, reflection, and shear) to a sphere with its origin point at its centre. In addition, DTI is generally visualised as a 3D ellipsoid defined by D, where the lengths of the semi-principle axes of the ellipsoid are defined by the eigenvalues of D. We thus leverage the definition of A3 to constrain the volume invariant between the ellipsoids represented by DGT and \u0125 by calculating the relative volume change:\n\n\u03a1\u03c5 = \n\u25b33(DGT)\n\u03943 (1)\n= \ndet(DGT)\ndet(D)\n\n(10)\nWe intend to consistently penalise the percentage volume differences by multi-plying the original loss by a penalisation factor \u00a7, which is directly proportional to the percentage change in volume and follows & \u2265 1:\n\n\u03be = \n  \n\u03a1\u03c5 if \u03c1\u03c5 \u2265 1,\n1 if p\u03c5 < 1,\n  \n\n\u03a1\u03c5\n\n(11)\n\u00a7 is thus implemented as a single penalisation factor for back-propagation:\n\n\u03be = \n1\n\u03a1\u03c5\nReLU (1 \u2212 \u03c1\u03c5) + ReLU(\u03c1\u03c5 \u2212 1) + 1.\n\n(12)\nRelative Diffusivity To provide quantitative insights into the microstructural characteristics of the underlying brain tissue [24], scalar metrics, including axial diffusivity (AD), mean diffusivity (MD), radial diffusivity (RD), and fractional anisotropy (FA) can then be derived from D. As demonstrated in Equation 13 and 14, these metrics are similar to A3 that is closely related to the eigenval-ues (\u03bb1, \u03bb2, \u03bb3) of D, measuring the magnitude and morphology of the ellipsoid represented by the tensor and serving as effective imaging biomarkers.\n\nAD = \u03bb1, MD = \n\u03bb1 + \u03bb2 + \u03bb3\n3\n, RD = \n\u03bb2 + \u03bb3\n2\n\n(13)\nFA = \n\u221a(\u03bb1 \u2013 \u03bb2)2 + (\u03bb1 \u2013 \u03bb3)2 + (\u03bb2 \u2013 \u03bb3)2\n2 * (\u03bb1 + \u03bb + \u03bb3)\n\n(14)\nFA is a ratio of variances normalised by the total diffusion that naturally falls within the scale of 0 to 1, making it a dimensionless measure in contrast to scale measures (AD, MD, and RD). Therefore, based on the significance and properties of FA, we adopt it as a complementary objective function for geometric learning:\n\nLFA = || FA(DGT) \u2013 FA(\u00ceD)||1.\n\n(15)\nGeometry-constrained Loss Hence, the total geometry-constrained loss can be formulated as:\n\nLGeo = \u00a7(ALDTI + \u1e9eL\u25b32) + YLFA,\n\n(16)\nwhere \u03b1, \u03b2, and y serve to balance the contributions of both loss items by adjusting the numerical magnitude of them to the range of [0, 1]."}, {"title": "2.6 Implementation Details", "content": "3D U-Net [9] is adopted as a baseline. All compared deep learning methods were trained for 100 epochs for each dataset using Adam optimiser with an initial learning rate of 0.001. The preprocessed 6-direction DWIs were cropped into patches of 64 \u00d7 64 \u00d7 64 with an overlap of 32 x 32 x 32 and were fed into the network in batches of 12. The bo, bvec (unit vectors), and preprocessed DWIS were not normalised for training and testing. Our model is optimized based on the weighted loss LGeo using the weight values a = 1e6, \u03b2 = 1e6 and y = 10, which were empirically chosen to yield optimum results. All experiments were run on a single NVIDIA GeForce Tesla V100-SXM2 GPU with 32GB of memory and the models were implemented with PyTorch 2.0.0 and Python 3.10.12."}, {"title": "3 Experimental Results", "content": "3.1 Tensor Evaluation\nTo quantitatively assess the differences between DTIs generated using various methods and the ground truth, the mean absolute error (MAE) of the DTI coefficients and the corresponding diffusion scalar metrics in white matter (WM) regions of interest are presented in Table 1."}, {"title": "3.2 WM Tracts Analysis", "content": "WM tracts are crucial in clinical research on neurological diseases due to their role in connecting different regions of the brain, facilitating efficient communica-tion and coordination of neural activities. Understanding the integrity and func-tionality of white matter tracts is vital for diagnosing and managing neurological conditions. To further explore the robustness and potential clinical significance of the proposed DirGeo-DTI, several WM tracts of interest were selected for further evaluation based on the interests from clinical research in Alzheimer's disease (AD) [39], Huntington's disease (HD) [27], Multiple Sclerosis (MS) [25,26], and Parkinson's disease (PD) [20]. The segmentations of WM tracts were performed using TractSeg [38]. A repetitive experiment was performed by inferencing the compared methods using 10 different subsets of 6-direction DWIs extracted from the original ground truth acquisition. This experiment compares the FA differ-ences in the enhanced DTIs predicted by different methods to the FA differences in WM tracts reported in previous studies. The corresponding results for the testing subjects in PPMI and HCP are shown in Figure 4 and Figure 5, re-spectively. The selected white matter (WM) tract bundles are defined according to [38] and include the corpus callosum (CC) with its subregions (rostrum, genu, rostral body, anterior midbody, posterior midbody, isthmus, and splenium), as well as the cingulum (CG), corticospinal tract (CST), fornix (FX), and optic radiation (OR).\nThe hypothesis is that if the MAE of FA values between the enhanced DTI and the ground truth exceeds clinically observed differences, the likelihood of detecting group-wise differences within the same sample size may decrease sig-nificantly. For instance, FA differences of 0.07 were observed in both the left and right optic radiation tracts in patients with MS when compared to healthy controls [20,25]. The DTIs generated by 6-dir DTI, DeepDTI, and HADTI-Net exhibit FA differences that are either larger than or close to the observed group-wise differences. In contrast, the proposed method effectively reduces measure-ment errors to a level below the gap between patients and controls, suggesting the potential to still detect these group-wise differences. Although the evaluation results on the enhanced DTI only show no statistical difference of FA in only 34"}, {"title": "4 Conclusion and Future Work", "content": "We have proposed DirGeo-DTI for enhancing the angular resolution of DTI from DWI data with a minimal number of gradient directions. By leveraging direc-tional information and geometric learning, DirGeo-DTI effectively improves DTI predictions, as demonstrated by the experimental results on both the HPC and PPMI datasets. Our findings suggest that DirGeo-DTI has the potential to be a valuable post-processing tool in clinical research, particularly in studies where only a limited number of diffusion directions are available, thereby enhancing the utility of DWI scans and the reliability of scalar metrics derived from DTI.\nWhile results are promising, further work is needed to fully evaluate DirGeo-DTI in real-world clinical settings. Specifically, we plan to assess the method on actual clinical data with fewer gradient directions and potential artifacts to bet-ter understand its robustness and applicability in typical clinical environments. This future direction will provide a broader understanding of the method's per-formance across diverse scenarios, ultimately enhancing its utility in clinical practice."}]}