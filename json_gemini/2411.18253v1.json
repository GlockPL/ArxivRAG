{"title": "Multimodal Integration of Longitudinal Noninvasive Diagnostics for\nSurvival Prediction in Immunotherapy Using Deep Learning", "authors": ["Melda Yeghaian", "Zuhir Bodalal", "Daan van den Broek", "John B A G Haanen", "Regina G H\nBeets-Tan", "Stefano Trebeschi", "Marcel A J van Gerven"], "abstract": "Analyzing noninvasive longitudinal and multimodal data using artificial intelligence\ncould potentially transform immunotherapy for cancer patients, paving the way towards\nprecision medicine. In this study, we integrated pre- and on-treatment blood\nmeasurements, prescribed medications and CT-based volumes of organs from a large\npan-cancer cohort of 694 patients treated with immunotherapy to predict short and long-term\noverall survival. By leveraging a combination of recent developments, different variants of our\nextended multimodal transformer-based simple temporal attention (MMTSimTA) network were\ntrained end-to-end to predict mortality at three, six, nine and twelve months. These models were\nalso compared to baseline methods incorporating intermediate and late fusion based integration\nmethods. The strongest prognostic performance was demonstrated using the\nextended transformer-based multimodal model with area under the curves (AUCs) of 0.84 \u00b1\n0.04, 0.83 \u00b1 0.02, 0.82 \u00b1 0.02, 0.81 \u00b1 0.03 for 3-, 6-, 9-, and 12-month survival prediction,\nrespectively. Our findings suggest that analyzing integrated early treatment data\nhas potential for predicting survival of immunotherapy patients. Integrating complementary\nnoninvasive modalities into a jointly trained model, using our extended transformer-based\narchitecture, demonstrated an improved multimodal prognostic performance, especially in short\nterm survival prediction.", "sections": [{"title": "1 Introduction", "content": "During cancer treatment, non-invasive data, such as laboratory blood test results and\nradiological imaging, is routinely collected by clinicians to guide clinical decision-making.\nNon-invasive data offers safe and cost-effective observables which can be frequently collected,\nreducing the need for repeated invasive procedures. Moreover, various sources of medical data\nare also routinely monitored by clinicians during treatment, since each modality measures a\ndifferent aspect and has a different, sometimes complementary, ability to quantify the health\nstatus of patients. Combining these modalities using Al could potentially lead to better patient\nstratification strategies and provide individualized care [1,2]. In addition, patient data is routinely\ncollected longitudinally as diseases and treatments evolve over time. Therefore, capturing the\ntemporal dimension, as well, by analyzing longitudinal patient data using artificial intelligence\n(Al) is key for the prediction of patient outcomes (e.g. early response to treatment and\nprognosis), offering personalized treatment strategies [3,4].\nImmunotherapies such as immune-checkpoint inhibitors (ICI) have changed the landscape of\ncancer care. While they have transformed 20% of fatal cancers into manageable chronic\nconditions, providing patients with better survival and quality of life, the remaining 80% of all\ncancers show poor response to therapy [4]. Immunotherapy is also costly and can cause\nadverse events. A number of clinical biomarkers, such as the tumor mutation burden (TMB),\nprogrammed death-ligand 1 (PD-L1) expression and DNA repair deficiency (e.g., microsatellite\ninstability (MSI) and POLE mutation), are clinically used to predict response to ICIs in certain\ncancers [4,5]. However, the evolving nature of the tumor microenvironment and tumor\ncharacteristics over time changes the sensitivity to ICIs, limiting durable response patterns in\nadvanced cancers [4]. With the infeasibility of obtaining multiple tumor biopsies over time, and\nthe challenges in continuous monitoring via circulating tumor DNA sequencing, there is a need\nto develop noninvasive longitudinal and multimodal biomarkers using large-scale databases and\nAl to predict response and efficacy of immunotherapy [4,5].\nIn a multimodal setting, several studies have emerged for response, progression, and survival\nprediction in immunotherapy using data at a single time point [6\u201315]. Cancer prognostication\nusing non-longitudinal multimodal data in other therapies was also extensively studied in\nliterature [16-29]. Considering the need to analyze data longitudinally in cancer immunotherapy,\nseveral multimodal and longitudinal studies have addressed this challenge in recent years\n[30-34]."}, {"title": "2 Materials and Methods", "content": null}, {"title": "2.1 Study cohort and ethical approval", "content": "Institutional review board (IRB) approval was obtained from the Netherlands Cancer Institute\n(approval number: IRBd23-219), where the need for project-specific informed consent was\nwaived. We retrospectively collected all cancer patients treated with immune checkpoint\ninhibitors (specifically nivolumab, pembrolizumab, ipilimumab, or a combination of nivolumab\nand ipilimumab) in a non-neoadjuvant setting at the Netherlands Cancer Institute between\nJanuary 2016 and August 2022. We only included patients with a single cancer diagnosis who\nreceived a single cycle of the abovementioned ICIs. Patients lost to follow-up, those with a\nfollow-up duration of <3 months from the start of treatment, and those without a 12-month\nprediction window after the last included follow-up examination were excluded.\nFor each included patient, we collected non-invasive multimodal longitudinal data, including\nlaboratory blood test measurements, contrast-enhanced CT imaging, and prescribed\nmedications. Blood data consisted of the measurements of routine blood markers, while imaging"}, {"title": "2.2 Data preprocessing", "content": "From the included longitudinal thoracic and abdomen contrast-enhanced CT scans, we\nautomatically segmented 117 anatomical structures and calculated their volumes using the\nTotalSegmentator model [39]. Certain volumes of interest were occasionally absent in the scan\ndue to a limited field of view on the image, medical reasons such as surgical resection of the\nstructure, or technical reasons such as absent/incomplete segmentation by the algorithm.\nStructures with \u226550% missing values were dropped, resulting in a final set of 100 volume\nfeatures per scan. We excluded blood tests with >60% missing values, which resulted in the\nretention of 33 blood markers. Multivariate iterative imputation was used to fill in missing values\nof blood markers [40]. Imaging and blood features were scaled using statistics that are robust to\noutliers (median and interquartile range) [37]. Imputation and scaling were performed based on\nthe training sets. Anatomical Therapeutic Chemical (ATC) classification codes of medications\nwere tokenized and encoded using PyTorch embedding layers [41]."}, {"title": "2.3 Model design and architecture", "content": "We extended the transformer encoder block with the simple temporal attention (SimTA) module\ndeveloped by Yang et al. [30] for encoding longitudinal patient data. The modified architecture,\nthe transformer-based SimTA (TSimTA) network, is not only suitable for longitudinal data but it\nalso substitutes the expensive self-attention (SA) layer of transformers with the SimTA module,\nwhich linearly encodes time intervals. This is particularly beneficial when training in small batch\nsizes and utilizing longitudinal patient data spanning a period of up to one year.\nThe SimTA module was originally proposed in a multimodal longitudinal setting [30], which we\nrefer to as MMSimTA. To adapt the extended transformer-based architecture for multimodality,\nwe also followed a common intermediate fusion approach which trains a multi-layer perceptron\n(MLP) after concatenating the representations of each individual modality, obtained through"}, {"title": "2.4 Model training and validation strategies", "content": "The SimTA module was originally built with the assumption that the most recent examinations\nare the most important ones during the patient timeline [31]; therefore, we trained the models\nincluding data from all existing examinations up to randomly selected follow-up (FU) durations\n(between three months after the start of treatment (SoT) up to one year).\nThe models were trained to simultaneously predict the overall survival of patients at different\nprediction endpoints, namely, at three, six, nine, and twelve months from the (randomly)\nselected FU duration. All modalities and prediction tasks were jointly trained in an end-to-end\nmanner with the preprocessed features of arbitrary numbers of available modalities using\nmultimodal dropout [43]. We adopted a three-fold stratified cross-validation approach for\nevaluating the trained models. Validation was performed using early on-treatment data (up to 3\nmonths after SoT) and, occasionally, late on-treatment (up to 6 months after SoT) data. Our\ncode extended the publicly available SimTA unimodal module, and will be publicly shared."}, {"title": "2.5 Statistical Analysis", "content": "The area under the receiver operating characteristic curve (ROC-AUC) was used to evaluate\nthe predictive performance of the studied models. In each cross-validation fold, the statistical\nsignificance of the classifiers was tested using the Mann-Whitney U test. DeLong tests\nassessed the statistical significance of AUC differences between classifiers in each fold,\ncomparing their performance. The p-values resulting from the DeLong test in each fold were\ncombined using Fisher's method. Mean AUCs and their standard deviation across the three\ncross-validation folds were reported. A p-value <0.05 was considered statistically significant. All\nanalyses were performed using Python (v3.10.13) and the following packages: PyTorch 2.0.1,\nScikit-learn 1.3.0, TotalSegmentator 2.0.5, NumPy 1.25.2, and Pandas 2.0.3."}, {"title": "3 Results", "content": null}, {"title": "3.1 Patient characteristics", "content": "We identified 1120 cancer patients treated with a single cycle of nivolumab, pembrolizumab,\nipilimumab, or a combination of nivolumab and ipilimumab in a non-neoadjuvant setting. Among\nthem, 138 had multiple (primary) tumors, and were, therefore, excluded. Eight additional lost to\nfollow-up patients, and a total of 280 patients with either less than 3 months of follow-up data or"}, {"title": "3.2 Extended transformer-based architecture demonstrates equal unimodal prognostic\nperformance", "content": "We ran unimodal data-based evaluation using the baseline SimTA-based and the extended\nTSimTA-based models, including data acquired between 3-months pre-treatment and 3-months\nafter, to compare their performance for survival prediction. The extended transformer-based\nmodel, TSimTA, did not always show improved performance across all four prediction endpoints\n(AUCSSiMTA of 0.83, 0.80, 0.80, 0.80 vs AUCSTSIMTA Of 0.82, 0.81, 0.82, 0.81 for the prediction of\n3-, 6-, 9- and 12-month survival in the best-performing individual modality, blood data). The two\nunimodal models did not statistically differ in terms of the AUCs of the predictive performance\n(p-values >0.05 in all the aforementioned endpoints). The performance of the remaining\nunimodal modalities is detailed in Table 2."}, {"title": "3.3 Extended transformer-based architecture shows improved multimodal prognostic\nperformance", "content": "Several experiments were conducted with different variants of multimodal baseline and\nextended transformer-based models to compare the prognostic performance, including data\nacquired between 3-months pre-treatment and 3-months after. The best variant of the baseline\nmultimodal SimTA models, MMSimTA, showed equal or decreased prognostic performance\ncompared to the prognostic performance of the best-performing unimodal modality, blood data\n(AUCSMMSIMTA Of 0.83, 0.80, 0.78, 0.78 vs AUCSSimTA Of 0.83, 0.80, 0.80, 0.80; DeLong p-values\n>0.05 for the prediction of 3-, 6-, 9- and 12-month survival, respectively). In comparison, the\nbest variant of the extended transformer-based multimodal TSimTA model, MMTSimTA,\nperformed significantly better than the best variant of the baseline MMSimTA (AUCSMMTSIMTA Of\n0.84, 0.83, 0.82, 0.81 vs AUCSMMSimTA of 0.83, 0.80, 0.78, 0.78; DeLong p-values of >0.05, 0.01,\n0.001, 0.01 for the prediction of 3-, 6-, 9- and 12-month survival, respectively). Comparing\nMMTSimTA with the best-performing unimodal TSimTA model, multimodal performance showed\nhigher AUCs in the earlier prediction endpoints, while showing equal performance in later\nprediction endpoints, (AUCSMMTSimTA Of 0.84, 0.83, 0.82, 0.81 vs AUCSTSIMTA Of 0.82, 0.81, 0.82,\n0.81; DeLong p-values of >0.05, 0.03, 0.05, >0.05 for 3-, 6-, 9- and 12-month survival\nprediction, respectively; Figure 2a). Table 3 summarizes the results of the multimodal\nexperiments."}, {"title": "3.4 Extended transformer-based architecture improves multimodal prognostic performance with\nintermediate over late fusion", "content": "The jointly trained best-performing baseline and extended multimodal transformer-based\nmodels were compared against a model-agnostic late fusion integration method, MA-MMSimTA,\nMA-MMTSimTA, respectively. MA-MMSimTA with late fusion performed better than the baseline\nMMSimTA incorporating intermediate fusion (AUCSMA-MMSimTA of 0.85, 0.81, 0.81, 0.81 vs\nAUCSMMSIMTA of 0.83, 0.80, 0.78, 0.78; DeLong p-values of >0.05, 0.05, 0.03, 0.03 for the\nprediction of 3-, 6-, 9- and 12-month survival, respectively). In contrast, the extended\ntransformer-based model, MMTSimTA, incorporating intermediate fusion, was better able to\npredict overall survival than MA-MMTSimTA, incorporating late fusion, in almost all prediction\nendpoints (AUCSMMTSimTA Of 0.84, 0.83, 0.82, 0.81 vs AUCSMA-MMTSimTA of 0.84, 0.80, 0.80, 0.79;\nDeLong p-values of 0.005, 0.02, 0.04, >0.05 for 3-, 6-, 9-, and 12-month survival prediction,\nrespectively). Comparing MA-MMSimTA to the best baseline unimodal SimTA model of blood\ndata, we observed that integrating modalities via late fusion performed better than the best"}, {"title": "3.5 Longer-term on-treatment data shows stronger prognostic performance", "content": "We evaluated the performance of the best-performing baseline and extended transformer-based\nmultimodal models, with both intermediate and late fusion, using longer-term longitudinal\non-treatment data (spanning between 3-month pre-treatment to 6-months after, instead of\n3-months after). To compare with 3-month survival, we used the best-performing model variant,\nMMTSimTAconcat+SA, and the same subsets of patients (n=184) with long-term (6-month)\non-treatment data by using only their corresponding short-term (3-month) on-treatment data.\nPredictive performance was better using longer-term on-treatment data (AUCS6-month of 0.81,"}, {"title": "4 Discussion", "content": "This study aimed to harness existing successful Al modules to develop a transformer-based\nmodel for the prediction of overall survival in immunotherapy using non-invasive longitudinal and\nmultimodal medical data. We predicted survival at specific future endpoints: 3, 6, 9, and 12\nmonths. We included longitudinal blood test measurements, volumes of organs extracted from\ncontrast-enhanced CT imaging, and medications administered to patients over time.\nPerformance was evaluated using early (3-month) and late (6-month) on-treatment data (Tables"}, {"title": "Statements and declarations", "content": null}]}