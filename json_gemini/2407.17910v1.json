{"title": "Causal Deepsets for Off-policy Evaluation under Spatial or Spatio-temporal Interferences", "authors": ["Runpeng Dai", "Jianing Wang", "Fan Zhou", "Shikai Luo", "Zhiwei Qin", "Chengchun Shi", "Hongtu Zhu"], "abstract": "Off-policy evaluation (OPE) is widely applied in sectors such as pharmaceuticals and e-commerce to evaluate the efficacy of novel products or policies from offline datasets. This paper introduces a causal deepset framework that relaxes several key structural assumptions, primarily the mean-field assumption, prevalent in existing OPE methodologies that handle spatio-temporal interference. These traditional assumptions frequently prove inadequate in real-world settings, thereby restricting the capability of current OPE methods to effectively address complex interference effects. In response, we advocate for the implementation of the permutation invariance (PI) assumption. This innovative approach enables the data-driven, adaptive learning of the mean-field function, offering a more flexible estimation method beyond conventional averaging. Furthermore, we present novel algorithms that incorporate the PI assumption into OPE and thoroughly examine their theoretical foundations. Our numerical analyses demonstrate that this novel approach yields significantly more precise estimations than existing baseline algorithms, thereby substantially improving the practical applicability and effectiveness of OPE methodologies. A Python implementation of our proposed method is available at https://github.com/BIG-S2/Causal-Deepsets.", "sections": [{"title": "1. Introduction", "content": null}, {"title": "1.1. Background", "content": "Many causal inference problems involve spatial or spatio-temporal data, which consist of observations recorded at specific locations and/or times. This data type is increasingly prevalent in environmental studies, epidemiology, social science, two-sided marketplaces, and various other fields due to advanced modern data collection methods. Unlike traditional scenarios where observations are typically independent across different subjects, spatial data often exhibit spillover effects. This means the treatment applied to one subject can affect not only their own response but also the responses of their neighboring subjects, challenging the stable unit treatment value assumption (SUTVA, Angrist et al., 1996). For example, in infectious disease control, an individual's risk of infection is influenced by the vaccination status of others nearby (Hudgens and Halloran, 2008). Social scientists have also observed that living in disadvantaged neighborhoods can intensify the difficulties faced by the urban poor, further illustrating the impact of spatial interference (Sobel, 2006).\nThis paper is motivated by the challenge of managing complex spatio-temporal interferences in major ride-sourcing platforms such as Uber, Lyft, and Didi Chuxing (Hahn and Metcalfe, 2017; Qin et al., 2022). Key interferences in these platforms include fluctuating demand and supply across various locations and times, the impact of surge pricing, changes in driver income due to shifts in driver locations, and the influence of external factors such as weather and events on demand (Wang and Yang, 2019; Zhou et al., 2021a; Qin et al., 2022). An example of these challenges can be seen in our evaluation of new passenger-side subsidizing policies. When implemented in specific regions, these policies not only boost demand and draw drivers from nearby areas, affecting income in both the target and surrounding regions, but also have a delayed effect on the driver income distribution, leading to both spatial and temporal interferences. The presence of such complex interferences significantly complicates the application of traditional causal inference methods. To navigate these complexities effectively, the development of advanced statistical models and methods is essential for accurately evaluating the impact of these policies in the context of causal inference with spatio-temporal interference."}, {"title": "1.2. Related Works", "content": "Our proposal intersects with three distinct bodies of literature: spatial interference in causal inference, off-policy evaluation (OPE), and the concept of permutation invariance within the realm of geometric deep learning."}, {"title": "1.2.1. Spatial Interference in Causal Inference", "content": "The literature on addressing spatial interference in causal inference broadly falls into two main categories: design-based and model-based methods (see Reich et al., 2021, and the references therein). Design-based methods concentrate on leveraging the design of experiments and sampling processes. For instance, Aronow and Samii (2017) introduced a spatial causal inference framework that estimates average potential outcomes using known treatment distributions and exposure mapping. Li et al. (2019) proposed randomization-based point estimators and confidence intervals to study peer effects with arbitrary numbers of peers and peer types. Wang et al. (2020) proposed estimating the average marginalized response to quantify outcome interference by treatments at specific distances, assuming a Bernoulli treatment distribution. On the other hand, model-based methods are divided into four subcategories. The first subcategory, structural models, imposes interference structures to approximate interference effects. Notable examples include conditional autoregressive (CAR, Banerjee et al., 2003) and spatial autoregressive (SAR, Lee, 2007) models, which introduce spatial random effects to represent neighborhood influences. The second subcategory, partial interference methods, divides populations into non-overlapping blocks, assuming interference within these blocks (Sobel, 2006; Tchetgen and VanderWeele, 2012; Zigler et al., 2012; Perez-Heydrich et al., 2014). The third subcategory focuses on experimental units in geographical spaces or networks, employing local or network-based assumptions for causal inference (Verbitsky-Savitz and Raudenbush, 2012; Wang et al., 2020; Tchetgen Tchetgen et al., 2021; Puelz et al., 2022). The final subcategory considers scenarios where interference manifests as congestion or pricing effects in two-sided markets (Munro et al., 2021; Johari et al., 2022)."}, {"title": "1.2.2. Off-policy Evaluation", "content": "Off-policy evaluation (OPE) represents an actively evolving research domain within the field of reinforcement learning (RL, Sutton and Barto, 2018; Agarwal et al., 2019; Levine et al., 2020). The primary goal of OPE is to accurately estimate the mean reward that a prospective target policy might yield, utilizing observational data generated under a different, behavior policy. This area encompasses a variety of methods (see Dud\u00edk et al., 2014; Uehara et al., 2022, for reviews), including model-based approaches (Gottesman et al., 2019; Yin and Wang, 2020), value-based techniques (Le et al., 2019; Luckett et al., 2020; Hao et al., 2021; Liao et al., 2021; Chen and Qi, 2022; Shi et al., 2022b), importance sampling methods (Thomas et al., 2015; Luedtke and Van Der Laan, 2016; Liu et al., 2018; Hu and Wager, 2023; Thams et al., 2023; Wang et al., 2023), and doubly robust strategies (Zhang et al., 2012; Jiang and Li, 2016; Thomas and Brunskill, 2016; Tang et al., 2019b; Kallus and Uehara, 2022; Liao et al., 2022). Despite the progress in OPE methodologies, a notable shortcoming is their general lack of accounting for spatial interference, an essential factor in many real-world scenarios, including ride-sharing platforms. Recognizing this gap, recent research endeavors have started integrating concepts from mean-field multi-agent RL (Yang et al., 2018) to handle spatio-temporal interference effects (Shi et al., 2023; Luo et al., 2024). This approach marks a significant step towards modeling the complex interactions in environments where actions in one location or time can influence outcomes in another. However, a key limitation of these emerging methods is their dependency on specifying the mean-field function. This requirement often poses challenges in terms of flexibility and adaptability, particularly when applied to diverse and unpredictable real-world settings where the dynamics of interference are not easily quantifiable or pre-defined. Therefore, while these methods mark a critical advancement towards OPE with spatial data, there remains a need for further development to enhance their applicability and efficacy in a wider range of practical applications."}, {"title": "1.2.3. Permutation Invariance", "content": "Permutation invariant functions, which maintain their output regardless of the order of their inputs, are prevalent in domains such as cosmology (Ntampaka et al., 2016) and computer vision (Aittala and Durand, 2018). This characteristic has led to the design of numerous geometric deep learning models specifically aimed at approximating these types of functions (Bronstein et al., 2017). A notable example is the structure called DeepSets, proposed by Zaheer et al. (2017), which is capable of approximating any permutation invariant function. DeepSets has shown impressive performance in a number of tasks such as sum of digits, classification of point-clouds, and regression with clustering side-information, highlighting its versatility. Expanding on this concept, the PINE model (Gui et al., 2021) offers a generalization of DeepSets by studying partially permutation invariant functions. In these functions, inputs are categorized into distinct groups, and the function remains invariant to permutations occurring within these individual groups. This design allows for greater flexibility in various contexts. Applying these permutation invariant models to studying the interference effects in spatio-temporal systems appears to be a natural progression. However, there is a lack of existing literature specifically addressing the application of these models in spatio-temporal interference modeling. This gap suggests an opportunity for novel research contributions in this area, potentially leading to advancements in understanding complex spatio-temporal systems, such as ride-sharing platforms."}, {"title": "1.3. Contributions", "content": "In our paper, we introduce a novel causal deepsets model designed to address spatial interference, incorporating several innovative elements. Firstly, we propose a permutation invariant neural network architecture that effectively manages spatial interference. This architecture aggregates information from neighboring areas and constructs a general permutation invariant function through neural networks, thereby moving beyond traditional parametric models and facilitating adaptive learning of interference patterns. Additionally, we seamlessly combine this architecture with OPE algorithms to produce robust causal estimators. For spatio-temporal data, we further employ the multi-agent RL (MARL) framework which models each spatial region as an individual agent to capture spatial interference through agent interactions and utilizes Markov decision processes (MDPs, Puterman, 2014) to model temporal relationships. Our methodology's efficacy is evidenced through comprehensive simulations and real data analyses, where it demonstrates outstanding performance. Beyond these methodological advancements, we conduct an in-depth theoretical analysis of our proposed estimator. We establish its consistency and convergence rate under practical assumptions. We also prove the minimax optimality of our estimator in approximating permutation invariant functions, underscoring our approach's capability in accurately representing and managing complex interference structures. Considering that our estimator is built upon the assumption of permutation invariance, we have named it the Permutation Invariant Estimator, or PIE, for short."}, {"title": "1.4. Paper Outline", "content": "The paper is structured as follows. In Sections 2 and 3, we focus on the derivation of our estimators, along with the underlying assumptions. The statistical properties of our method are discussed in Section 4. In Section 5, we present the results of numerical studies and real data analysis, showcasing the superior performance of our approach."}, {"title": "2. Spatial Interference in Nondynamic Settings", "content": "This section aims to thoroughly explore the issue of spatial interference in nondynamic settings, often referred to as contextual bandits in OPE. Spatial interference implies that the potential outcome in one region is influenced by other regions. We denote each region by an index i within the set {1,..., R}. For the ith region, \\(Y_i\\), \\(A_i\\), and \\(X_i = (X_{i,1},..., X_{i,M})^T \\in \\mathbb{R}^M\\) represent the response, treatment, and M-dimensional confounding variables, respectively.\nIn scenarios without spatial interference, a region's outcome is a function of its own confounding variables and treatment:\n\\(Y_i = f_i(X_i, A_i) + e_i,\\)\nwhere the error term \\(e_i\\) satisfies \\(E(e_i|\\{A_j\\}_{j=1}^R, \\{X_j\\}_{j=1}^R) = 0\\). In practical applications, however, the assumption of no interference is often unrealistic, making model (1) inapplicable. Without specific knowledge of the interference pattern, the outcome in a region can generally be expressed as a function of its own confounding variables and the treatments across all regions:\n\\(Y_i = f_i(X_i, A_i, m_i(X_{-i}, A_{-i})) + \\epsilon_i,\\)\nwhere \\(X_{-i} = (X_1, ..., X_{i-1}, X_{i+1},..., X_R)\\) and \\(A_{-i} = (A_1, ..., A_{i-1}, A_{i+1}, . . . ,A_R)\\). Here, \\(f_i\\) includes two components: the first reflecting the ith region's contribution and the second capturing interference effects from other regions, denoted by the function \\(m_i(\\cdot)\\). This model, depicted in Figure 2b, extends beyond traditional models that only consider neighboring region effects (see e.g., Reich et al., 2021). Specifically, the interference effect function \\(m_i(\\cdot)\\) in (2) accounts for influences from all regions. Moreover, this framework accommodates nonlinear interference effects, which are common in real-world scenarios. Model (2) offers a broad framework for understanding spatial interference, but its complexity becomes daunting with the increase in the number of regions, often rendering it impractical to solve. To combat this, various strategies have been developed to reduce its complexity. One notable approach is spatial network inference (see e.g., Forastiere et al., 2021), which narrows the focus to interactions between regions and their immediate neighbors. While \"neighborhood\" could be defined in various ways, we simplify it here to mean geographical proximity.\nThe study of spatial interference has a rich history (Blume, 1993). Many researchers have posited that interference typically occurs within a defined neighborhood and can be transmitted via environmental conduits like adjacent regions. Although this method simplifies the complexity of inter-regional interactions, it still implies dependencies between any two regions due to their potential indirect connections. There's often at least one indirect path connecting any two regions, creating a dependency link. For example, consider two non-adjacent units A and B. In this case, A would be conditionally independent of B if we have complete information about A's neighbors. However, indirect connections between A and B are still permissible. Our proposed approach is based on such an understanding of spatial interdependencies.\nASSUMPTION 1 (GENERAL NETWORK INTERFERENCE). The outcome within a particular region is conditionally independent of all other pairs of confounders and treatments, provided the pairs of confounders and treatments of its neighboring regions are given.\nWe remark that Assumption 1 slightly generalizes existing network inference by permitting the outcome of a region to be influenced by both the treatments and confounders of its neighboring regions; see Figures 2c and 2d for illustrations. From a mathematical perspective, let \\(\\mathcal{N}(i)\\) denote the index set"}, {"title": "2.1. PIE: A Permutation-Invariant Estimator with Interference Effect", "content": "We first introduce some definitions pertaining to permutation-invariant functions.\nDEFINITION 1 (PERMUTATION OPERATOR). Given an index set \\(\\mathcal{I} = \\{1,2,...,N\\}\\) with N integers, the permutation operator \\(\\Pi\\) is a one-to-one mapping \\(\\Pi : \\mathcal{I} \\rightarrow \\mathcal{I}\\) such that \\(\\mathcal{I}_{\\Pi} = \\{\\Pi(1), \\Pi(2), . . .,\\Pi(N)\\}\\) is the resulting permutation of \\(\\mathcal{I}\\). Let the symmetric group \\(\\mathbb{S}_N\\) denote the set containing all permutations. Apparently, we have \\(|\\mathbb{S}_N| = N!\\).\nFor instance, consider the set \\(\\mathcal{I} = \\{1,2,3\\}\\), which has six different permutations. Let \\(\\Pi\\) denote the permutation operator such that \\(\\Pi(1) = 3, \\Pi(2) = 1, \\Pi(3) = 2\\). We have \\(\\mathcal{I}_{\\Pi} = \\{3,1,2\\}\\). With the definition of permutation operator, we impose the permutation invariant assumption on mean outcome function.\nASSUMPTION 2 (PERMUTATION INVARIANCE). For any given region i, the mean-outcome function \\(f_i(X_i, A_i, m_i(X_{\\mathcal{N}(i)}, A_{\\mathcal{N}(i)}))\\) exhibits Permutation Invariance with respect to its neighboring regions. This implies that for any permutation \\(\\Pi : \\mathcal{N}(i) \\rightarrow \\mathcal{N}(i)\\), the following holds true:\n\\(f_i(X_i, A_i, m_i(X_{\\mathcal{N}(i)}, A_{\\mathcal{N}(i)})) = f_i(X_i, A_i, m_i(X_{\\Pi\\mathcal{N}(i)}, A_{\\Pi\\mathcal{N}(i)})).\\)\nIn essence, the outcome function remains unchanged regardless of the order in which the neighboring regions are considered, emphasizing a key characteristic of spatial invariance in the model.\nThis assumption is based on the observation that, from the perspective of the target region, all neighboring regions are indistinguishable. Therefore, the interference effect of neighbors on the center"}, {"title": "2.2. Application to Policy Evaluation in Nondynamic Settings", "content": "To demonstrate the versatility of the proposed architecture, we apply PIE to OPE in nondynamic settings. The observed data consists of the confounders-treatment-outcome triplets \\(\\{(X_{i,j}, A_{i,j}, Y_{i,j}) : 1 < i < R,1 < j < S\\}\\) measured over time. In our ridesharing application, \\(\\{(X_{i,j}, A_{i,j}, Y_{i,j}) : 1 < i < R\\}\\) corresponds to the data collected on the jth day. We assume these triplets are i.i.d. copies of \\(\\{(X_i, A_i, Y_i) : 1 < i < R\\}\\) defined at the beginning of Section 2. It is important to note that while there are strong temporal correlations within each day's data, it is reasonable to assume independence across different days, provided that the same treatment is implemented throughout each day. This assumption is partly based on the observation that order volumes typically decrease significantly between 1 am and 5 am. Consequently, we treat the observations of each day as new, independent realizations. In Section 3, we will study settings where different treatments are implemented across various time periods within each day.\nWe next introduce our estimand. In real-world applications, it is often necessary to understand the effects of implementing a specific policy denoted by \\(\\pi = (\\pi_1,...,\\pi_R)\\). Each \\(\\pi_i\\) corresponds to a deterministic function of the confounding vector, indicating the treatment assignment for the ith agent."}, {"title": "3. Spatio-temporal Interference in Dynamic Settings", "content": "In this section, we will integrate concepts from multi-agent reinforcement learning (MARL) to address additional temporal interference, treating the process as an MDP. This allows us model how actions taken at one point in time can affect outcomes at subsequent points. We will introduce several estimators designed to accurately evaluate the average treatment effect in scenarios where both spatial and temporal interference are present."}, {"title": "3.1. Interference Modelling via MDP", "content": "In a dynamic setting, the independence assumption among confounder-treatment-outcome triplets at different time points is no longer valid. Thus, we encounter both spatial and temporal interference, necessitating the introduction of new assumptions to appropriately model both interference structures. Spatial interference continues to be described by the spatial interference function \\(m\\), as in the non-dynamic setting. Temporal interference, however, is twofold. Firstly, an individual's response is influenced by the confounders and treatments in neighboring regions. Secondly, the present confounders are affected by the history of past confounder-treatment interactions.\nMirroring Assumption 1 from the non-dynamic context, we approach temporal interference by imposing specific conditional independence assumptions which relate to the future confounder, current confounder-treatment-response triplet, and their historical context. For ease of explanation, let \\(X_{\\cdot,t}\\) represent the set \\(\\{X_{i,t}\\}_i\\) at each time t, and similarly for A (treatment) and Y (response). The following assumptions detail the conditional independence properties in this dynamic setting.\nASSUMPTION 3 (CONDITIONAL MEAN INDEPENDENCE ASSUMPTION (CIMA)). There exist functions \\(\\{r_i\\}_i\\) such that for each region i (where \\(1 < i < R\\)), the following equation is almost surely satisfied:\n\\(E(Y_{i,t}| A_{\\cdot,t}, X_{\\cdot,t}, \\{A_{\\cdot,k}, X_{\\cdot,k}, Y_{\\cdot,k}\\}_{0<k<t}) = r_i(A_{i,t}, X_{i,t}, m_i(A_{\\mathcal{N}(i),t}, X_{\\mathcal{N}(i),t})),\\)\nwhere \\(m_i(\\cdot)\\) represents the interference effect function.\nASSUMPTION 4 (MARKOV ASSUMPTION (MA)). There exist Markov transition kernel \\(P_i(\\cdot)\\) such that for any \\(t \\geq 0\\) and \\(x \\in \\mathcal{S}\\), we have almost surely that\n\\(Pr\\{X_{i,t+1} = x|A_{\\cdot,t}, X_{\\cdot,t}, \\{A_{\\cdot,k}, Y_{\\cdot,k}, X_{\\cdot,k}\\}_{0<k<t}\\} = P_i(x; A_{i,t}, X_{i,t}, m_i(A_{\\mathcal{N}(i),t}, X_{\\mathcal{N}(i),t})).\\)\nTo verify these assumptions, one can employ the approach proposed by Shi et al. (2020) and test the conditional independence using appropriate statistical tests (see e.g., Chen and Hong, 2012; Shah and Peters, 2020; Kim et al., 2022; Polo et al., 2023). Additionally, these assumptions can be satisfied by concatenating measurements over several decision points and selecting the optimal order. By combining the assumption on spatial interference (Assumption 1) with these temporal interference assumptions, we establish the assumption on spatio-temporal interference effects.\nIn a similar vein to Assumption 2 in a static setting, we propose that both the response function \\(r_i(\\cdot)\\) and the transition kernel \\(P_i(\\cdot)\\) are unaffected by the order of neighboring regions. This means for any given region i and any permutation \\(\\Pi : \\mathcal{N}(i) \\rightarrow \\mathcal{N}(i)\\), the following holds true:\n\\(r_i(X_{i,t}, A_{i,t}, m_i(X_{\\mathcal{N}(i),t}, A_{\\mathcal{N}(i),t})) = r_i(X_{i,t}, A_{i,t}, m_i(X_{\\Pi(\\mathcal{N}(i)),t}, A_{\\Pi(\\mathcal{N}(i)),t})),\\)\n\\(P_i(X_{i,t}, A_{i,t}, m_i(X_{\\mathcal{N}(i),t}, A_{\\mathcal{N}(i),t})) = P_i(X_{i,t}, A_{i,t}, m_i(X_{\\Pi(\\mathcal{N}(i)),t}, A_{\\Pi(\\mathcal{N}(i)),t})).\\)\nWith the interference assumptions in place, conventional reinforcement learning models can be adapted to form PIE estimators. The details and discussions will be presented in the following section."}, {"title": "3.2. Application to Offline Policy Evaluation", "content": "In the dynamic setting, the observed data consists of S i.i.d samples of \\(\\{(X_{i,t}, A_{i,t}, Y_{i,t}) : 1 < i < R, 1 < t < T\\}\\) generated under a specific behavior policy, each of which is a confounders-treatment-outcome triplet measured over time. Consequently, the observed data can be represented as \\(\\{(X_{i,t,j}, A_{i,t,j}, Y_{i,t,j}) : 1 < i < R,1 < t < T,1 < j < S\\}\\), where j indicates the index of the sample. In our illustrative ridesharing example, the index i denotes the ith spatial unit, j corresponds to the jth day, and t represents the tth time interval within each day. This dynamic model, as compared to the nondynamic one discussed in Section 2, facilitates the analysis of scenarios where the company may implement different treatments on each day."}, {"title": "4. Theoretical Results", "content": "This section provides a detailed analysis of the statistical properties of PIE. Initially, we explore the theoretical properties of PIE in a generic supervised learning setting. This includes an examination of their consistency, convergence rate, and minimax optimality. Subsequently, we apply these theoretical results to evaluate the sample efficiency of value-based PIE in both non-dynamic (see Section 2.2.1) and dynamic settings (see Section 3.2.1)."}, {"title": "4.1. Theoretical properties of PIE", "content": "We establish the theoretical properties of PIE in a generic supervised learning setting. Let X = \\([X_1, X_2, ..., X_N] \\in \\mathbb{R}^{M\\times N}\\) denote the predictor and \\(Y \\in \\mathbb{R}\\) denote the outcome variable. Our goal is to estimate the conditional mean function \\(f^*(x) = E(Y|X = x)\\). Toward that end, we restrict our attentions to the class of permutation invariant estimators \\(\\mathcal{F}\\) defined as\n\\[\n\\mathcal{F}= \\left\\{ f : \\mathbb{R}^{M\\times N}\\rightarrow\\mathbb{R} \\quad f(X) = \\psi\\left(\\sum_{q=1}^N \\phi(X_q)\\right), \\quad \\phi, \\psi \\in \\mathcal{F}_{ReLU} \\right\\}\n\\]\nwhere the detailed definition of ReLU neural networks is given in Appendix. Consider the following empirical risk minimization (ERM) predictor\n\\[\n\\hat{f} = \\underset{f \\in \\mathcal{F}}{\\text{arg\\,min}} \\frac{1}{n} \\sum_{j=1}^n [Y(j) - f(X(j))]^2\n\\]\nwhere \\(\\{X(j),Y(j)\\} : 1 \\le j \\le n\\) denote n i.i.d. copies of (X, Y). \nWe introduce the following assumptions\nDEFINITION 2 (PERMUTATION INVARIANT FUNCTIONS). A function f is defined to be permutation invariant function if for any permutation \\(\\Pi\\in \\mathbb{S}_N\\).\n\\[\nf(X) = f(X_{\\Pi(1)}, X_{\\Pi(2)},\\cdots, X_{\\Pi(N)})\n\\]\nwhere the permutation operator \\(\\Pi\\) is defined in Definition 1.\nASSUMPTION 5 (PERMUTATION INVARIANCE). Assume the target function \\(f^*\\) is a permutation invariant function as defined in Definition 2.\nBefore establishing the consistency of the PIE, we need the following assumptions on the boundedness and continuity of target function:\nASSUMPTION 6 (BOUNDEDNESS). Let \\(\\|f\\|_{\\infty} = \\underset{x}{\\text{sup}}|f(x)|\\) and \\(\\mathcal{F}\\) denote the envelope function of \\(\\mathcal{F}\\), i.e., \\(F(x) = \\underset{f\\in \\mathcal{F}}{\\text{sup}}|f(x)|\\). Assume there exist some constant J > 0 such that\n\\[\n\\text{max} \\{ \\| f^* \\|_{\\infty}, \\|\\mathcal{F}\\|_{\\infty}, |Y|\\} \\le J.\n\\]\nASSUMPTION 7 (CONTINUITY). Assume the target function \\(f^*\\) is continuous function defined on \\([0,1]^{M\\times N}\\).\nThe assumption of a continuous and bounded target function is commonplace in nonparametric settings. The response variable Y is often assumed to be bounded in the RL literature (see e.g., Fan et al., 2020). The following theorem specifies the consistency of PIE.\nTHEOREM 2 (CONSISTENCY OF PIE). Under Assumption 6, the ERM estimator \\(\\hat{f}\\) is consistent for the target function \\(f^*\\) in the sense that as \\(n \\rightarrow \\infty\\),\n\\[\n\\| \\hat{f}- f^*\\|_{L_2(P_X)} \\longrightarrow 0,\n\\]\nin which the convergence occurs with probability at least \\(1 - 2/n\\). Here, \\(\\|\\cdot \\|_{L_2(P_X)}\\) denotes the L2 norm associated with the probability distribution function of X (denoted by PX), i.e., \\(\\|f\\|_{L_2(P_X)} = \\sqrt{\\int_X f(x)^2dP_X}\\).\nTo further establish the convergence rate of \\(\\hat{f}\\), an additional smoothness assumption is required."}, {"title": "4.2. Nondynamic Results", "content": "We establish convergence rate for the OPE estimator in a nondynamic setting in this subsection. Accordingly, the notation used here aligns with that in Section (2.2).\nRecall that under Assumption 2, the conditional mean of the response of the ith region is denoted by \\(f_i(X_i, A_i, m_i(X_{\\mathcal{N}(i)}, A_{\\mathcal{N}(i)}))\\). Let G represent the PIE function class defined in Theorem 1 which approximates the mean-outcome function \\(f_i\\).\nFor the nondynamic setting, we impose similar boundedness and smoothness assumptions to Assumptions 6 and 8.\nASSUMPTION 10. For any \\(i = 1,\\ldots, R\\) and any \\(f \\in \\mathcal{G}\\), there exist a constant J that:\n\\[\n\\text{max}\\{\\|f_i\\|_{\\infty}, |Y_i|, \\|f\\|_{\\infty}\\} < J.\n\\]\nFurthermore, it is assumed that each \\(f_i\\) resides within the Sobolev space \\(W^{\\beta, \\infty}([0,1]^{(M+1)\\times(N+1)})\\).\nWe extend the results of Theorem 3 to derive the convergence rate for estimator in Theorem 1.\nCOROLLARY 1 (CONVERGENCE RATE OF PIE). Under Assumption 2, Smoothness Assumption that \\(f_i \\in W^{\\beta, \\infty}([0, 1]^{(M+1)(N+1)})\\) for any \\(i = 1,\\ldots, R\\). We derive \\(\\hat{f_i} \\in \\mathcal{G}\\) in estimation scheme shown in (16), the PIE exhibits consistency and the following finite sample convergence rate:\n\\[\n\\| \\hat{f_i} - f_i\\|_{L_2(P_X)} = O_P\\left(S^{-\\frac{2\\beta}{(M+1)(N+1)+2\\beta}}\\right).\n\\]\nTo facilitate the derivation of the convergence rate of the OPE estimator \\(\\hat{J}_{VB}(\\pi)\\), we employ a cross-fitting scheme as outlined in (Chernozhukov et al., 2018) and (Athey and Wager, 2021), the detail of cross-fitting scheme can be found in Appendix. With above preparation, the following corollary is establishes the convergence rate of OPE estimator \\(\\hat{J}_{VB}(\\pi)\\).\nCOROLLARY 2. Under Assumption 10, the finite sample convergence rate of \\(\\hat{J}_{VB}(\\pi)\\) in approximating the true value J(\\(\\pi\\)) is described by\n\\[\n|\\hat{J}_{VB}(\\pi) - J(\\pi)| \\le O\\left(RS^{-\\frac{2\\beta}{(M+1)(N+1)+2\\beta}}\\right) + \\epsilon,\n\\]\nwhere this holds for any \\(\\epsilon > 0\\) with a probability of at least \\(1 - \\text{exp}\\left(-\\frac{n\\epsilon^2}{2\\sigma^2}\\right)\\)."}, {"title": "4.3. Dynamic Results", "content": "To establish the statistical properties of \\(\\hat{J}_{VB}(\\pi)\\) in dynamic settings, we begin by defining the transition operator \\(\\mathbb{P}^{\\pi}\\):\n\\[\n(\\mathbb{P}^{\\pi} f(t)) (X_{\\mathcal{N}^*(i),t,j}, A_{\\mathcal{N}^*(i),t,j}) = \\mathbb{E}\\left\\{f(t+1) (X_{\\mathcal{N}^*(i),t+1,j}, \\pi(X_{\\mathcal{N}^*(i),t+1,j})) | X_{\\mathcal{N}^*(i),t.j}, A_{\\mathcal{N}^*(i),t.j}\\right\\},\n\\]\nwhere M has been defined in (10). The Bellman operator \\(\\mathbb{T}^{\\pi}\\) can therefore be defined as\n\\[\n(\\mathbb{T}^{\\pi} f(t)) (X_{\\mathcal{N}^*(i),t,j}, A_{\\mathcal{N}^*(i),t,j}) = r_i (X_{\\mathcal{N}^*(i),t,j}, A_{\\mathcal{N}^*(i),t,j}) + (\\mathbb{P}^{\\pi} f(t)) (X_{\\mathcal{N}^*(i),t,j}, A_{\\mathcal{N}^*(i),t,j})\n\\]\nBased on the Bellman operator, we redefine the Smoothness Assumption.\nASSUMPTION 11. For any \\(i = 1,\\ldots, R\\), it is assumed that:\n* \\(r_i \\in W^{\\beta, \\infty} ([0, 1]^{(M+1)\\times(N+1)})\\).\n* For any \\(f_i \\in \\mathcal{G}\\), we have \\(\\mathbb{T}^{\\pi} f_i \\in W^{\\beta, \\infty}([0,1]^{(M+1)\\times(N+1)})\\).\nAssumption 11 addresses the smoothness of the mean-outcome function and target function in training. Recall \\(\\rho_i\\) denote the stationary probability measure under behavior policy, and \\(\\rho_i^{\\pi}\\) denote probability measure under policy at time step t. Distribution shift caused by policy distinction can be controlled by the following assumption"}, {"title": "5. Numerical Study", "content": "In this section"}, {"title": "6. Discussion", "content": "We have introduced a novel causal deepsets model that effectively addresses the challenge of spatial interference. The versatility of our framework opens up a plethora of applications in diverse fields. In urban planning, it could be pivotal in modeling the impact of policy interventions on traffic flow and public transportation. Environmental studies could leverage this model to assess the effects of policy changes on pollution patterns across different regions. In public health, our methodology could be instrumental in analyzing the spread of diseases and the efficacy of intervention strategies over varying spatial scales.\nMeanwhile, our theoretical analysis, which establishes the consistency, convergence rate, and minimax optimality of the PIE estimator, is a cornerstone of our research, not only validate the robustness of our methodology but also provide a solid foundation for future advancements in the field. They also encourage the exploration of PIE in other contexts where permutation invariance is a key characteristic, potentially broadening the scope of its applicability. Several important avenues for extension and further research emerge from our study:\n(i) Spatial-Temporal Interference and Invariance Property: Our paper represents an early yet significant effort in addressing spatial-temporal interference. The methodologies we have developed for handling either spatial or temporal interference offer avenues for extension and refinement.\nIn terms of temporal dynamics, while our model employs MDPs, it is possible that they do not completely capture the intricacies of interference structures. Therefore, more complex models, such as"}]}