{"title": "GAMED-Snake: Gradient-aware Adaptive Momentum Evolution Deep Snake Model for Multi-organ Segmentation", "authors": ["Ruicheng Zhang", "Haowei Guo", "Zeyu Zhang", "Puxin Yan", "Shen Zhao"], "abstract": "Multi-organ segmentation is a critical yet challenging task due to complex anatomical backgrounds, blurred boundaries, and diverse morphologies. This study introduces the Gradient-aware Adaptive Momentum Evolution Deep Snake (GAMED-Snake) model, which establishes a novel paradigm for contour-based segmentation by integrating gradient-based learning with adaptive momentum evolution mechanisms. The GAMED-Snake model incorporates three major innovations: First, the Distance Energy Map Prior (DEMP) generates a pixel-level force field that effectively attracts contour points towards the true boundaries, even in scenarios with complex backgrounds and blurred edges. Second, the Differential Convolution Inception Module (DCIM) precisely extracts comprehensive energy gradients, significantly enhancing segmentation accuracy. Third, the Adaptive Momentum Evolution Mechanism (AMEM) employs cross-attention to establish dynamic features across different iterations of evolution, enabling precise boundary alignment for diverse morphologies. Experimental results on four challenging multi-organ segmentation datasets demonstrate that GAMED-Snake improves the mDice metric by approximately 2% compared to state-of-the-art methods. Code will be available at https://github.com/SYSUzrc/GAMED-Snake.", "sections": [{"title": "I. INTRODUCTION", "content": "Multi-organ segmentation, which predicts the boundaries of all tissues of interest within an image, is of significant clinical value. Many organs are anatomically interconnected and functionally interdependent. Hence, their contours and morphology are often considered simultaneously for the diagnosis and treatment of certain diseases. For example, in radiation therapy (RT) for cancer, accurately delineating organs at risk (OARS) is crucial for minimizing the adverse effects. Typically, an RT session requires the segmentation of dozens of OARs, making manual segmentation labor-intensive and time-consuming. In contrast, automatic multi-organ segmentation can significantly reduce the required effort and time while enhancing the consistency, accuracy, and reliability of the results.\nHowever, multi-organ segmentation remains a challenging task due to its complex nature [3]. First, complex backgrounds with numerous interfering structures make it more difficult to accurately identify and segment target organs. Second, the boundaries between adjacent organs are often blurred, and their tight anatomical arrangement further complicates precise contour delineation. Moreover, the wide diversity in the shapes and sizes of different organs poses significant challenges for a single model to generalize effectively. These challenges could hinder the efficacy of existing semantic segmentation methods [4], most of which treat segmentation as a pixel-wise classification task [5], [6]. These approaches fail to explicitly consider the global structure of the target organs at the object level, leading to a lack of holistic understanding. As a result, the segmentation outcomes are often inconsistent, exhibiting pixel misclassifications, jagged contours and mask cavities, as illustrated in Fig. 1.\nSnake algorithm [7], particularly when integrated with deep learning (i.e., deep snake), presents a promising solution to these challenges. Unlike conventional semantic segmentation algorithms [8], which predict pixel-level semantic maps [9], the deep snake model generates initial object-level contours and refines them through vertex-wise offsets. This two-stage pipeline of detection followed by segmentation allows the model to focus on specific anatomical structures, mitigating the interference from complex backgrounds. Meanwhile, this object-level contour inherently accounts for the structural relationships among predicted regions, demonstrating robustness across diverse organ morphologies. Furthermore, the natural constraints between adjacent points ensure that the snake algorithm effectively produces smooth boundaries, even in cases of ambiguous edges, thereby avoiding the jagged and unrealistic contours common in pixel-based methods."}, {"title": "II. RELATED WORKS", "content": "Multi-organ segmentation is an essential and challenging task, attracting considerable research attention. Fang et al. [13] propose a multi-scale deep neural network incorporating pyramid convolution for multi-organ segmentation in CT images. Boutillon et al. [14] develop a segmentation model that utilizes shared convolutional kernels and domain-specific normalization for MRI images of three musculoskeletal joints. Shen et al. [15] introduce a spatial attention block that improves abdominal CT segmentation by learning spatial attention maps to highlight organs of interest. Zhao et al. [16] combine a CNN-Transformer architecture [17] with a progressive sampling module, achieving high performance in multi-organ segmentation for both CT and MRI images.\nDespite these advances in segmentation accuracy, the inherent limitations of pixel-to-pixel prediction render these methods vulnerable to the challenges posed by complex backgrounds and ambiguous boundaries in multi-organ segmentation scenarios. Additionally, the lack of strong anatomical priors and the failure to explicitly account for the structural relationships among predicted outputs often result in unreasonable morphological errors, such as mask cavities, fragmented or jagged boundaries, and erroneous pixel classifications."}, {"title": "B. Deep Snake Algorithm", "content": "Deep snake algorithms, which extend traditional active contour models [7] (ACMs) by incorporating deep learning techniques, demonstrate significant potential in multi-organ segmentation. By focusing on contour evolution rather than pixel-wise classification, these models are capable of generating smooth and realistic boundaries, even in scenarios with blurred edges or complex backgrounds. This makes deep snake methods a strong complement to semantic segmentation approaches, which also motivates our work. Xie et al. [11] reformulate instance segmentation into instance center classification and dense distance regression tasks by modeling instance masks in polar coordinates. Peng et al. [10] propose a two-stage deep snake pipeline that utilizes a novel circular convolution for efficient feature learning to enhance snake evolution. Lazarow et al. [12] introduce a point-based transformer with mask supervision via a differentiable rasterizer. However, these approaches typically treat snake evolution as a purely topological problem, overlooking its dynamic nature. Additionally, the absence of robust anatomical prior guidance may constrain their segmentation performance, particularly in the challenging multi-organ segmentation scenarios.\nDespite the potential of deep snake models to effectively parameterize object boundaries, their application remains underexplored, particularly within the medical imaging domain."}, {"title": "III. METHOD", "content": "Inspired by [10], GAMED-Snake performs segmentation by iteratively deforming an initial contour to align with the target organ boundary. Specifically, the method takes an initial contour as input and predicts vertex-wise offsets directed towards the target boundary, as depicted in Fig. 1. We propose an innovative contour evolution strategy that leverages the Differential Convolution Inception Module (DCIM) to effectively extract gradient information from the distance energy map. This gradient information offers precise guidance for determining the direction and step sizes for contour point offsets. In addition, the Adaptive Momentum Evolution Mechanism (AMEM) establishes dynamic features across successive evolution iterations, enhancing the ability of contour points to accurately search for the target boundary."}, {"title": "A. Distance Energy Map Prior", "content": "Traditional snake algorithms rely on low-level image features such as grayscale gradients and predefined ACM parameters to guide contour evolution [15]. However, this weak guidance proves insufficient for handling the complexities of multi-organ medical images [1], which frequently feature intricate backgrounds, blurred boundaries, and diverse contour morphologies.\nTo overcome these limitations, our GAMED-Snake incorporates a novel Distance Energy Map Prior (DEMP) within the deep snake framework, providing precise guidance for contour evolution. As a high-level feature map, the DEMP effectively encodes the distance of each pixel to the target contour boundary, offering a concise yet robust prior representation. For a given pixel P(x, y), its energy value $E_p$ is defined based on the distance to its nearest boundary point C(x, y):\n$E_p = max {0, 255 \u2013 32 ln (1 + ||P(x, y) \u2013 C(x,y)||^2)}$.\n(1)\nThe design generates a force field distributed across the entire image, attracting contour points precisely to the target boundaries to achieve precise alignment."}, {"title": "B. Differential Convolution Inception Module", "content": "In distance energy maps, gradient information can encode both the distance and direction of a given pixel relative to the target boundary. This information offers effective guidance for the step size and direction of contour point evolution. Previous studies [18] have shown that integrating traditional edge operators with convolutional neural networks significantly enhances gradient detection capabilities. Inspired by this, we design a Differential Convolution Inception Module (DCIM) to adaptively extract various types of energy gradient information.\nThe differential convolution (DC) process is similar to standard convolution (SC). During the convolution operation, instead of using the original pixel intensities, DC replaces them with pixel differences within the local feature map patch covered by the convolution kernels. This modification allows the network to focus on gradient changes instead of absolute intensities, thus enhancing its sensitivity to boundary features:\nSC : y = f(x, 0) = \\sum_{i=1}^{k \\times k} W_iX_i\nDC : y = f(x, 0) = \\sum_{(x_i, x'_i) \\in P} W_i (X_i - X'_i),\n(2)\nwhere $x_i$ and $x'_i$ represent the input pixels, and $W_i$ denote the weights in the $k\\times k$ convolution kernel. The set $P = {(x_1,x'_1), (x_2, x'_2), ..., (x_m, x'_m)}$ contains pixel pairs sampled from the current local patch, with $m \u2264 k \u00d7 k$.\nTo comprehensively capture gradient information, DCIM comprises four distinct branches: Stepped Differential Convolution (SDC), Diagonal Differential Convolution (DDC), Circular Differential Convolution (CDC), and average pooling. Each form of DC is used to capture different gradient information, providing comprehensive gradient awareness for contour points located at various spatial positions. The principles underlying each DC type are straightforward. For example, in CDC, pixel differences are calculated within a 3\u00d73 patch along both diagonal and radial directions. These pixel differences are then element-wise multiplied by the kernel weights and convolved, followed by summation to produce the output feature map values (See Fig. 3)."}, {"title": "C. Adaptive Momentum Evolution Mechanism", "content": "Regressing contour-point offsets in a single step is challenging, especially for vertices far away from the organ. Inspired by [10]-[12], we handle contour evolution in an iterative optimization fashion. Previous methods typically treat the evolution process as a topological problem, largely neglecting its dynamic properties. However, in the context of state-space transition problems, the temporal dependencies between states are of paramount importance. To address this oversight, we design an Adaptive Momentum Evolution Mechanism (AMEM), which establishes dynamic features across adjacent evolution iterations, thereby effectively enhancing the contour points' ability to accurately locate target boundaries.\nIn the evolution process, vertex position offsets are predicted based on contour-point feature information. The input feature $f_i$ for a vertex $x_i$ is a concatenation of learning-based features and the vertex coordinate: $[F(x_i); x_i]$, where F denotes the feature maps. AMEM extracts feature vectors of the contour points at both current ($f$) and historical ($f_h$) positions, which are then fused using a cross-attention mechanism with historical evolution vectors $x$:\nq = $fW_q$, k = $fW_k$, v = $x^W_v$,\nA = softmax $(\\frac{q k^T}{\\sqrt{C/h}} )$, CA(f, x) = Av,\n(3)\nwhere $W_q$, $W_k$, $W_v \\in R^{C \\times (C/h)}$ are learnable parameters, C and h denote the embedding dimension and the number of heads, respectively.\nThe outputs are processed through multi-layer circular 1D convolutions [10] to produce the final contour-point offset vectors. AMEM adaptively compresses information from both historical and current states, using the displacement vector from the previous step as \"momentum\" to guide the current evolution step, significantly improving the ability of contour points to locate target boundaries. Moreover, the circular 1D convolution integrates features from neighboring points, effectively enlarging the receptive field of contour evolution."}, {"title": "D. Implementation details", "content": "The distance energy map generation network The distance energy map generation network is built upon the EfficientNetV2 [19] backbone, followed by deconvolution layers for outputting predictions. EfficientNet optimizes network architecture through neural architecture search, significantly boosting performance with a reduction in the number of parameters.\nDetector We adopt CenterNet [20] as the detector for our GAMED-Snake, which outputs class-specific boxes as the initial contours. CenterNet reformulates the detection task as a keypoint detection problem and achieves an impressive trade-off between speed and accuracy.\nContour evolution We uniformly sample N points from both the ground truth boundary and the initial contour and pair them by minimizing the distance between corresponding poins. GAMED-Snake takes the initial contour as input and outputs N offsets that point from each vertex to the target boundary point. We set N to 128 in all experiments, which is sufficient to cover most organ shapes. The number of evolutionary iterations is set to 3.\nTraining strategy We initially pretrain the energy map generation network to ensure accurate distance energy map predictions. This is followed by the joint optimization of both the detection and the snake evolution processes.\nIn the pretraining phase of the distance energy map, we utilize the Charbonnier loss, given by:\n$L_E = \\sqrt{ ||f_E(P(x, y)) \u2013 E_{GT} ||^2 + \\epsilon^2}, \\epsilon = 10^{-3}$,\n(4)\nwhere $E_{GT}$ denotes the distance energy value of the ground truth, and fe() represents the energy map generation network. Subsequently, we employ the smooth L\u2081 loss to train the detection and segmentation processes. The loss function for the prediction of the detection box is defined as:\n$L_{det} = \\sum_{i=1}^4 \\mathcal{L}_1(x_i^{det} - x_i^{*det})$,\n(5)\nwhere $x_i^{det}$ and $x_i^{*det}$ represent the predicted and actual vertices of the detection box, respectively. The loss function for iterative contour deformation is defined as:\n$L_{iter} = \\frac{1}{N} \\sum_{i=1}^N \\mathcal{L}_1(x_i - x_i^{*}), N = 128$,\n(6)\nwhere $x_i$ is the deformed contour point and $x_i^{*}$ is the ground-truth boundary point. For the detection part, we adopt the same loss function as the original detection model."}, {"title": "V. CONCLUSION", "content": "We introduce the GAMED-Snake model, a novel approach for multi-organ segmentation that integrates gradient-aware learning and adaptive momentum evolution into a unified contour-based framework. GAMED-Snake not only advances the design of snake algorithms but also functions as a robust complement to semantic segmentation methods. Utilizing the Distance Energy Map Prior and the Differential Convolution Inception Module, GAMED-Snake provides precise guidance for contour evolution, overcoming challenges posed by complex backgrounds and blurred boundaries. The Adaptive Momentum Evolution Mechanism establishes dynamic awareness across different evolution iterations, improving contour points' accuracy in locating boundaries of organs with diverse morphologies. We found that integrating boundary features with contour coordinates provides valuable guidance for precise segmentation and robust anatomical priors enhance the model's adaptability to complex features in medical images. These offer meaningful insights for future research."}]}