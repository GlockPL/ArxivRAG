{"title": "CoMoTo: Unpaired Cross-Modal Lesion Distillation Improves Breast Lesion Detection in Tomosynthesis", "authors": ["Muhammad Alberb", "Marawan Elbatel", "Aya Elgebaly", "Ricardo Montoya-del-Angel", "Xiaomeng Li", "Robert Mart\u00ed"], "abstract": "Digital Breast Tomosynthesis (DBT) is an advanced breast imaging modality that offers superior lesion detection accuracy compared to conventional mammography, albeit at the trade-off of longer reading time. Accelerating lesion detection from DBT using deep learning is hindered by limited data availability and huge annotation costs. A possible solution to this issue could be to leverage the information provided by a more widely available modality, such as mammography, to enhance DBT lesion detection. In this paper, we present a novel framework, Co- MoTo, for improving lesion detection in DBT. Our framework leverages unpaired mammography data to enhance the training of a DBT model, improving practicality by eliminating the need for mammography dur- ing inference. Specifically, we propose two novel components, Lesion- specific Knowledge Distillation (LsKD) and Intra-modal Point Align- ment (ImPA). LsKD selectively distills lesion features from a mammog- raphy teacher model to a DBT student model, disregarding background features. ImPA further enriches LsKD by ensuring the alignment of le- sion features within the teacher before distilling knowledge to the stu- dent. Our comprehensive evaluation shows that CoMoTo is superior to traditional pretraining and image-level KD, improving performance by 7% Mean Sensitivity under low-data setting. Our code is available at https://github.com/Muhammad-Al-Barbary/CoMoTo.", "sections": [{"title": "1 Introduction", "content": "Breast cancer is the most prevalent type of cancer among women [24]. Early de- tection of breast cancer significantly improves survival rates [10]. Mammography, the standard screening protocol, is limited by its lack of depth perception which could lead to lesion masking by the surrounding tissue. Digital Breast Tomosyn- thesis (DBT), an innovative breast imaging modality, addresses this limitation by providing a pseudo 3D image that enables visualization of superimposed struc- tures [13]. Despite the higher detection rates, the 3D nature of DBT requires a much longer reading time, limiting its applicability in breast screening [8,14]."}, {"title": "2 Methodology", "content": "Our framework, CoMoTo, is based on the distillation of selected features corre- sponding to the object of interest from an intra-modal point-aligned mammogra- phy teacher network to a DBT student one. Fig. 1 shows an overview of the main components of CoMoTo. During training, a mammography dedicated network is trained over mammography data by minimizing a typical detection loss $L_{det}$ and Intra-modal Point Alignment (ImPA) loss $L_{IMPA}$, which maximizes the sim- ilarity of critical lesion features of different mammography samples. Similarly, a DBT dedicated network is trained over DBT data to minimize $L_{det}$. Addi- tionally, KD is applied by minimizing Lesion-specific KD (LsKD) loss $L_{LsKD}$, increasing the similarity of the DBT critical lesion features extracted from the DBT encoder with the mammography intra-modal point aligned critical lesion features extracted from the mammography encoder. During inference, only the DBT network is used to detect lesions from DBT data.\nIn the next sections, we introduce our proposed Lesion-specific KD by critical feature points alignment, then we introduce Intra-modal Point Alignment of the teacher to further enhance Lesion-specific KD."}, {"title": "2.1 Cross-modal Lesion-specific Knowledge Distillation", "content": "Existing KD frameworks aim to distill knowledge from a pretrained teacher model to a student model through image-level feature alignment [21,22,6]. How- ever, within the realm of breast imaging, this approach proves to be highly sus- ceptible to the global variations inherent in breast tissue. Moreover, image-level feature alignment methods exhibit a bias towards larger objects, which inher- ently occupy larger regions of the feature maps [23]. To address these challenges, we propose Lesion-specific KD.\nAligning lesion-specific features is not straightforward, since lesions can vary in size and structure, which limits the applicability of traditional features dis- tillation. Therefore, we propose to identify 9 critical points in the extracted feature maps of both modalities for each existing object, representing its center, 4 edges, and 4 sides midpoints. This is performed by scaling the ground truth bounding boxes to correspond to the down-sampled feature maps. Afterwards, for each bounding box, its scaled 9 critical points are employed to select 9 features from the extracted feature maps, resulting in flattened critical feature vectors $f_c \\in \\mathbb{R}^{D\\times9}$, where D is the number of feature maps channels. Point-wise mean is then applied for each modality to average the critical feature vectors of the whole batch, creating mammography and DBT lesion-specific prototypes. The derivation of the lesion-specific prototype of one modality $e$ can be formulated as:\n$\\begin{equation}\ne_c = \\frac{1}{B} \\sum_{i=1}^B \\frac{1}{k_i} \\sum_{j=1}^{k_i} f_{c_{i,j}} \\\\\n\\end{equation}$\nwhere B is the number of images per batch, and $k_i$ is the number of ground truth lesions in one image. Softmax activation $\\sigma$ is then applied to both prototypes:\n$\\begin{equation}\nE_{c,mammo} = \\sigma(\\frac{e_{c,mammo}}{T}), E_{c,dbt} = \\sigma(\\frac{P(e_{c,dbt})}{T}) \n\\end{equation}$\nwhere $\\tau$ is a temperature parameter to soften the prototypes distribution, and $P$ is a learnable linear layer that projects the DBT prototype, reducing the domain shift of the DBT and mammography. Finally, the two lesion-specific prototypes are aligned by minimizing KL-divergence loss function:\n$\\begin{equation}\nL_{LSKD} = \\frac{1}{D} \\sum_{i=1}^9 \\sum_{j=1}^D E_{c,mammo_{i,j}} log \\frac{E_{c,mammo_{i,j}}}{E_{c,dbt_{i,j}}}\n\\end{equation}$\nThe overall loss function to be optimized can be then defined as:\n$\\begin{equation}\nL_{DBT} = L_{det} + \\alpha \\cdot L_{LsKD}\n\\end{equation}$\nwhere $\\alpha$ is a loss weight to control the contribution of lesion-specific KD."}, {"title": "2.2 Intra-modal Point Alignment", "content": "Our proposed lesion-specific KD assumes homogeneous teacher features across different lesions. Thus, the presence of non-homogeneous point-wise teacher fea- tures has the potential to adversely impact performance. To this end, we propose Intra-modal Point Alignment to explicitly align critical lesions feature points between different mammography images during training of the mammography network.\nDuring the mammography teacher training, critical feature vectors $f_c$ of each lesion in the batch are extracted, as described in Sec. 2.1. Additionally, non- critical feature vectors of the same dimensions $f_{nc} \\in \\mathbb{R}^{D\\times9}$ are extracted by randomly sampling the background features, which are not part of the scaled bounding boxes, from each image in the batch. We design $L_{IMPA}$ to include a positive term that maximizes the cosine similarity between critical features from different data samples, and a negative term that penalizes positive cosine similarities between critical and non-critical features, preventing model collapse. Our proposed loss can be formulated as:\n$\\begin{equation}\nL_{IMPA} = L_{pos} + L_{neg}\n\\end{equation}$\n$L_{pos}$ and $L_{neg}$ can accordingly be formulated as:\n$\\begin{equation}\nL_{pos} = \\frac{1}{B^2} \\sum_{i=1}^B \\sum_{j=1}^B \\frac{f_{c,i} \\cdot f_{c,j}}{|| f_{c,i} || || f_{c,j} ||}\n\\end{equation}$\n$\\begin{equation}\nL_{neg} = \\frac{1}{B^2} \\sum_{i=1}^B \\sum_{j=1}^B max(0, - \\frac{f_{c,i} \\cdot f_{nc,j}}{|| f_{c,i} || || f_{nc,j} ||})\n\\end{equation}$\nThe overall mammography loss, $L_{mammo}$, is the result of combining the detection loss with the Intra-modal Point Alignment loss as follows:\n$\\begin{equation}\nL_{mammo} = L_{det} + \\beta \\cdot L_{IMPA}\n\\end{equation}$\nwhere $\\beta$ is a loss weight that controls the contribution of Intra-modal Point Alignment during mammography training."}, {"title": "3 Experiments", "content": "Datasets. To build and evaluate our framework, we used two unpaired datasets for mammography and DBT. The OPTIMAM Medical Image Database (OMI- DB) is a huge, multi-centre, dataset consisting of mammography images and associated clinical information from UK [11]. For the sake of this study, we se- lect a subset of images with available bounding box coordinates representing identified masses. The subset dataset consists of 3608 full-field digital mammog- raphy images from 1911 patients. This dataset comprises images of both right\nImplementation Details. For mammography preprocessing, the dataset was stratified by patient and divided into training, validation, and testing sets of approximately 60%, 20%, and 20%, respectively. We cropped the breast regions and resized them to 2048 \u00d7 1024. During training, we applied random horizontal flipping, ensuring homogeneous performance across both breasts. For DBT, fol- lowing the DBTex challenge [16] distribution, the dataset was divided into 50%, 20%, and 30% for training, validation, and testing, respectively. We sliced the volumes into 2D images and used the central images of lesions to train the DBT model. The same mammography preprocessing and augmentation were applied to the DBT. During evaluation, non-max suppression was applied to the DBT slices predictions of each volume.\nOur framework is applicable to any architecture that include a feature ex- tractor. In our experiments, we used RetinaNet as the detection network for both modalities with Focal Loss [17] as $L_{det}$ (see Eqs. (4) and (8)). We used ResNet50 [12] as the feature extractor, anchor sizes of 32, 64, 128, 256, and 512, and aspect ratios of 0.5, 1, and 2. We used Stochastic Gradient Descent as an optimization algorithm, with a learning rate of 0.01 and a momentum of 0.9. A batch size of 8 images was used. We selected $\\tau = 4$ in Eq. (2), $\\alpha = 2$ in Eq. (4), and $\\beta = 2$ in Eq. (8). The models were trained for 50 epochs in all experiments, and the learning rate was divided by 10 after 30 epochs. The validation mean Average Precision (mAP) was the used criterion to select the best checkpoint. The framework was implemented on a Nvidia A40 and a Nvidia A30 GPUs.\nEvaluation Metrics. Following the DBTex challenge [16], our primary metric was mean sensitivity at 1, 2, 3, and 4 false positives per case (Mean Sensitivity), and our secondary metric was sensitivity at 2 false positives (Sensitivity@2FPs)."}, {"title": "3.2 Results", "content": "Our experiments, as shown in Tab. 1, show that mammography pretraining followed by DBT fine-tuning, as in [19], could achieve 0.57 and 0.64 Mean Sen- sitivity when trained over 10% and 25% of the available DBT data. However, applying the SOTA image-level KD, as in [21], resulted in a performance down- grade by 3% and 5% Mean Sensitivity, when using 10% and 25% of the data,"}, {"title": "3.3 Ablation Studies", "content": "CoMoTo Component Analysis. We assess the effect of each of our modules, as shown in Tab. 2. LsKD outperforms the SOTA image-level KD [21], in terms of Mean Sensitivity, by 2% and 5%, whereas ImPA has a larger impact improving by 9% and 8% over the image-level KD and by 7% and 2% using LsKD without previous ImPA, when using 10% and 25% DBT training data, respectively. Those results show the impact of aligning the lesion features of both the student and teacher networks, an aspect often overlooked in the literature.\nTraining Data Ratio Effect. We compare mammography pretraining [19] and image-level KD [21] with our framework, CoMoTo, at different training data ratios as shown in Fig. 3 (a). The results indicate that CoMoTo is superior to other SOTA methods, especially at lower data setting.\n$\\alpha$-value Effect. Fig. 3 (b) shows the results of our method at different values of $\\alpha$ when trained over 10% of the DBT data. The results reveal that significantly raising alpha can cause the model to deviate from the detection objective.\nDistilled Points. As depicted in Fig. 3 (c), distilling 9 critical points, repre- senting the center, sides midpoints, and edges, improves the overall KD process, compared to distilling other sets of points. This suggests that combining fea- tures associated with varying degrees of certainty enhances the value of distilled knowledge."}, {"title": "4 Conclusion", "content": "Our work proposes a novel KD framework, CoMoTo, to improve breast lesion detection from DBT. CoMoTo aligns lesions features extracted from a mammog- raphy network across different mammography samples, then distills the aligned lesions features from mammography to DBT, while ignoring background fea- tures corresponding to unpaired breast tissues. Moreover, CoMoTo remains un- biased towards larger lesions by distilling a predetermined number of critical points from each lesion, addressing a significant limitation of image-level KD. Our experiments demonstrate that CoMoTo outperforms existing approaches by a considerable margin, especially at low data setting. The results of this study reveal a great potential of object-level KD to improve object detection in a less available modality using unpaired data from a more common one."}]}