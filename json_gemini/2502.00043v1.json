[{"title": "A scalable adaptive deep Koopman predictive controller for real-time optimization of mixed traffic flow", "authors": ["Hao Lyu", "Yanyong Guo", "Pan Liu", "Nan Zheng", "Ting Wang"], "abstract": "The use of connected automated vehicle (CAV) is advocated to mitigate traffic oscillations in mixed traffic flow consisting of CAVs and human driven vehicles (HDVs). This study proposes an adaptive deep Koopman predictive control framework (AdapKoopPC) for regulating mixed traffic flow. Firstly, a Koopman theory-based adaptive trajectory prediction deep network (AdapKoopnet) is designed for modeling HDVs car-following behavior. AdapKoopnet enables the representation of HDVs behavior by a linear model in a high-dimensional space. Secondly, the model predictive control is employed to smooth the mixed traffic flow, where the combination of the linear dynamic model of CAVs and linear prediction blocks from AdapKoopnet is embedded as the predictive model into the AdapKoopPC. Finally, the predictive performance of the prosed AdapKoopnet is verified using the HighD naturalistic driving dataset. Furthermore, the control performance of AdapKoopPC is validated by the numerical simulations. Results demonstrate that the AdapKoopnet provides more accuracy HDVs predicted trajectories than the baseline nonlinear models. Moreover, the proposed AdapKoopPC exhibits more effective control performance with less computation cost compared with baselines in mitigating traffic oscillations, especially at the low CAVs penetration rates. The code of proposed AdapKoopPC is open source\u00b9.", "sections": [{"title": "I. INTRODUCTION", "content": "WITH the acceleration of urbanization and the increase in the number of motor vehicles, traffic congestion and traffic accidents have become increasingly prominent [1]. Against this background, autonomous driving technology has emerged and is expected to become an innovative solution to alleviate traffic congestion [2], [3]. The most common application is Cooperative Adaptive Cruise Control (CACC), which relies on V2V state sharing to enable vehicles within a vehicle platoon to run at coordinated speeds to maintain a small headway [4]. This technique can enhance traffic capacity and improve safety between vehicles, which has attracted a lot of interest from academia and industry. The excellent performance of connected automated vehicles (CAVs) in a purely intelligent network environment has been widely recognized [5]. In essence, CAV is a mobile scanner that provides historical and real-time trajectory data of individual vehicles [6]. As well, it is also a dynamic actuator for adaptive control [7]. In this intelligent network ideal scenario, vehicles communicate seamlessly and autonomous driving systems operate together accurately and efficiently, thus building a highly intelligent transportation ecosystem [8]. However, the industrialization of autonomous driving technology is a complex process, and the realization of large-scale application of mobile internet and autonomous driving technology is a long process. A more realistic traffic environment is that CAVs and human-driven vehicles (HDVs) share the road. This mixed traffic flow prompts scholars to think deeply and study the performance of CAVs in complex traffic environments [9].Considering the research topics of this paper, we mainly focus on the following two key points, including the modeling of HDVs behavior and the controlling of CAVs.\nHow to model the HDVs driving behavior in dynamic traffic flow, and to predict the HDVs trajectory with high accuracy? A key goal is to simulate the dynamic driving behaviors of HDVs in mixed traffic flow. These behaviors will be essentially different due to differences in driving environments, drivers, etc. HDV adjusts its own acceleration based on the headway to the leader vehicle, velocity difference, and among others. In term of the physics-driven methods, well-known car-following models were widely employed, such as optimal velocity model [10], full velocity difference model [11], intelligent driver model [12], to describe and model the HDVs behaviors. However, it is known that these time-invariant car-following models always archives high-biased results with large error. With the rapid development of artificial intelligence, big data and computing power, the deep learning methods, including recurrent neural networks (RNN), long short-term memory model (LSTM), deep deterministic policy gradient (DDPG), etc., are being gained more and more interests in modeling the driving behaviors of HDVs. Although deep learning is superior in capturing and modeling driving behavior in complex traffic environments, due to the characteristic of nonlinearity, its shortcomings of slow solution speed and inability to meet real-time optimization control are self-evident.\nHow to control CAVs more effectively in mixed traffic flows for mitigating traffic oscillations? As well known, the jam-absorption driving strategy in the Newell's car-following theory framework was proposed to mitigate the propagation of upstream disturbances, and the corresponding vehicles need to be selected based on the expected absorption speed and real-time traffic conditions to implement the strategy [13]. As mentioned before, CAV is a dynamic executor, and its role is no longer limited to\u201cfollower\u201d, but has been further expanded to\"leader\", which is the basic idea and connotation of the Leading Cruise Control (LCC) framework [14]. In addition, the controllability, observability and head-to-tail stability of the LCC framework were also analyzed and verified, confirming its positive role in improving traffic performance [15], [16]. Along this direction, the Data-Enabled Predictive Leading Cruise Control (Deep-LCC) was proposed [17], [18], as an alternative to parametric car-following model, to achieve safe and optimal control of CAVs in mixed platoons. The Deep-LCC has inspired this paper, however, it still exhibits certain limitations. To be specific, in order to use CAVs to positively guide HDVs, it is necessary to first understand the driving behavior changes of HDV after being affected by CAVs. In Deep-LCC, all HDVs follow a rule-based car-following model and add random high-frequency noise to construct the trajectory database. It is obviously unrealistic and limited to combine these trajectories to match the corresponding HDV expected driving trajectories for different scenarios. this is obviously not realistic and has limitations.\nOverall, the dilemmas faced by CAV control for traffic optimization in mixed traffic flow lies in accurately modeling and predicting the driving behavior of HDVs in complex scenarios, as well as meeting the requirements of effective and feasible real-time solution and optimization control in reality. Motivated by the above two requirements, the Koopman operator offers a new solution for identifying and analyzing nonlinear systems. The Koopman operator emerges as a highly suitable approach, which facilitates the handling of intricate nonlinear dynamics through linear transformations. This method allows for an efficient modeling of the HDVs behavior without introducing excessive complexity, and its linear properties are well suited for subsequent real-time optimization of mixed traffic flow. Therefore, this paper develops a multi-scenario adaptive deep Koopman predictive control framework for mixed traffic flow. The main contributions of this paper are as follows:\n\u2022 An adaptive deep Koopman network (AdapKoopnet) is proposed for modeling HDVs car-following behavior with the high-dimensional linear model;\n\u2022 A scalable state prediction model of mixed traffic flow is developed by integrating linear dynamic model of CAVs and linear prediction blocks from AdapKoopnet;\n\u2022 An adaptive deep Koopman predictive control framework (AdapKoopPC) based on the state prediction model is proposed for mitigating traffic oscillations in mixed traffic flow.\n\nThe framework of this paper is as follows. Section II mainly reviews the relevant literatures and summarizes the research gap. Section III states the AdapKoopnet. Section IV proposes the AdapKoopPC framework. Section V and Section VI conducts the experiments for HDVs longitudinal trajectory prediction and mixed traffic flow optimization control. At last, the conclusion and prospects are given in Section VII ."}, {"title": "II. RELATED WORK", "content": "Recognizing and extracting potential driving scenarios is beneficial for achieving vehicle trajectory prediction with strong generalization ability and accuracy. [19] extracted driving scenarios directly from real driving data and clustered repeated patterns into potential scenario groups without any pre-definition or rules. [20] developed a general active learning framework to annotate driving trajectory time series data and explore unknown driving scenario trajectories. Beyond scenario recognition, more research focuses on capturing driving characteristics. [21] utilized unsupervised algorithms to automatically extract descriptive driving patterns, and the clustered patterns promote a comprehensive understanding of driver behavior characteristics. In addition, identifying the driving style is also a work with practical value. For example, based on the multi-dimensional characteristics, three different driving styles are identified using an unsupervised clustering algorithm [22]. [23] employed a set of experiments to collect driving data among different drivers, and a supervised machine learning-based driving style classifier was designed to recognize the driving style. [24] defined the intermediate variable of neural process as the driving style vector and linked to an interpretable and continuous aggressiveness index. However, identifying and clustering scenarios from natural driving datasets using neural networks without relying on pre-definition or pre-labeling remains to be solved. Secondly, further extracting personalized driving features based on recognized scenarios and using them for driving behavior prediction is also worth exploring.\nB. Car following behavior modeling and trajectory prediction\nThe trajectory prediction methods of car-following behavior are mainly divided into physics-based methods, data-driven methods, and hybrid-driven methods. The physics-based method uses microscopic traffic flow models for trajectory prediction. For example, [25] explicitly considered the interactions between vehicles and proposed a dynamic Bayesian networks-based filter to estimate the behavior of traffic participants and predict their future trajectories. [26] developed a cooperative intelligent driver model that dynamically determines its acceleration based on parameters such as velocity difference and headway. With the advancement of big data and deep learning technology, data-driven methods for trajectories prediction have been emerging. [27] built spatiotemporal attention long short-term memory (STA-LSTM) for vehicle trajectory prediction, ensuring accuracy while improving interpretability. Pioneeringly, [28] first proposed a physics informed deep learning framework for car-following modeling, taking full advantage of data-driven and physics-based models to surpass existing models. Further, relying on the self-attention mechanism to achieve deeper mining of trajectory features, [29] proposed a Physics-Informed Transformer-Intelligent Driver Model to predict longitudinal vehicle trajectories. However, there is still a contradiction between the complex deep learning model that describes the nonlinear state evolution of vehicle driving behavior and the requirement that CAV control relies on real-time solutions.\nC. CAV control for optimized mixed traffic flow\nVarious control approaches have been explored to optimize mixed traffic flow performance such as safety, efficiency and energy consumption. [30] presented a highly efficient platoons control framework based on tube MPC to address heavy computational and communication burden, which mitigates prediction uncertainty through feedback control. [31] implemented a cooperative control strategy for CAVs under the assumption of completely random disturbances triggered by HDVs. Recently, a control strategy called \u201cThe Follower Stopper controller\" was proposed, and real vehicle experiments demonstrated its ability to improve traffic flow stability [32]. To address the limitation of executing FS policies individually for all CAVs, [33] established a cellular automaton model of mixed traffic flow based on the FS strategy for CAV control, which positively affected the efficiency, oscillation, and fuel consumption of mixed traffic flow. From the perspective of collective function optimization, [34] studied the impact of different formations of CAVs on traffic performance, focusing on the formation of cooperation between CAVs using centralized optimal controllers. Besides, a traffic-smoothing controller was directly learned from trajectories based on a reinforcement learning policy gradient algorithm [35]. [36] integrated an advanced linear controller and a DPPO-based DRL controller to construct a hybrid controller, achieving stable and efficient longitudinal driving of CAVs within mixed flow. [37] developed the robust-safety-critical traffic controller in mixed traffic flow. This controller ensures collision-free safety even in the face of actuator and sensor delays, as well as disturbances from the leading HV. As traffic systems expand, a consequent problem is the dramatic increase in online computing burden, and the data-driven distributed control emerged as the times require. Surprisingly, [38] conducted data-driven mixed vehicle platoons dynamics modeling based on Koopman, which is a groundbreaking work that has attracted our high attention and interest. [17], [18] proposed distributed data-driven predictive control that directly utilizes measurable traffic data to design collision-free optimal CAV control inputs for collaboratively smoothing mixed traffic flows. However, it is difficult to demonstrate its generalization ability in other mixed traffic flow scenarios by modeling the entire traffic flow and obtaining the Koopman operator based on a dataset generated by simple physical models, which drives our idea. We expect to use Koopman theory to learn vehicle features from real-world trajectories and construct a scene adaptive and scalable control framework.\nD. The applications of Koopman theory in traffic flow\nKoopman operator theory is a mathematical framework that involves representing nonlinear systems in a higher-dimensional linear space, making it possible to study the evolution of complex systems [39] [40] used Koopman operator to propose a model-free, data-driven approach that cleverly analyzed and predicted the evolution of highly complex nonlinear traffic flow. [41] applied Koopman operator theory and the dynamical mode decomposition for signalized traffic flow networks control, which allows for early identification of unstable queue growth. In order to realize the real-time control of the ramp metering on the freeway efficiently, [42] proposed a model predictive controller with the trained deep Koopman model. The above methods relied on parameter estimation of physical models or modeling of nonlinear dynamics using neural networks. [43] introduced a novel data-driven vehicle modeling and control approach, employing an interpretable Koopman operator base deep neural networks in which extended dynamic mode decomposition was utilized to learn a finite-dimensional approximation of the Koopman operator. Recently, in solving non-stationary time series prediction problems, [44] proposed an efficient time series prediction model driven by Koopman theory, which hierarchically mines the dynamic system of time series."}, {"title": "III. ADAP\u039a\u039f\u039f\u03a1\u039d\u0395\u03a4: ADAPTIVE DEEP KOOP\u039c\u0391\u039d NETWORK FOR CAR FOLLOWING BEHAVIOR MODELING AND PREDICTION OF HDVS", "content": "In this section", "paper": "nScenario is the mixed traffic flow environment in which the vehicle is located", "equations": "n$(v_i (t + 1)", "follows": "n$dc_i (t) = f_{dc"}, "x_i (t \u2013 P), x_i (t \u2013 P + 1), x_i (t))$,\n$(v_i (t + 1), h_i (t + 1)) = f_{sp} (v_i (t), h_i (t), dc_i (t), V_{i-1} (t))$ (2)\nwhere $x_i (\u00b7)$ = $[v_i (\u00b7), h_i (\u00b7), \\Delta v_i (\u00b7), a_i (\u00b7), l_i"], "theory": "The Koopman operator theory initially provides an alternative linear dynamic description for the evolution of uncontrollable systems [39]. With slight modifications", "follows": "n$K_{\\phi"}, {"phi": "Z\u00d7V \u2192C$. Exploiting the linearity of K", "follows": "n$K\\phi_m (z_i (t)", "operator": "n$f_{sp"}, {"decomposition": "The extended dynamic mode decomposition (EDMD) is a data-driven approach of finding the finite-dimensional approximation K of the Koopman operator [46]. EDMD employs various basis functions", "obtain": "n$\\phi (z_i (t)", "phi_2(": "...", "phi_L(": "represents a set of observable lift functions is general nonlinear. Let $s_i (k) = \\phi(z_i (k))$", "obtained": "n$\\phi (z_i (k + 1)) = K\\phi (z_i (k)", "tasks": 1, "block": "As shown in Fig. 2", "follows": "n$H_{ITE"}, {"follows": "n$Q_{DTI"}, {"formula": "n$H_{DTI"}, {"follows": "n$H_{DSR-DS"}, {"follows": "n$H_{DS"}, {"1": "In this study", "follows": "n$dc(T) = softmax(H_{DSR-TC"}, {"mechanism": "The explicit state encoder is tasked with encoding the explicit state of the vehicle from the original space to an observable high-dimensional space", "follows": "n$e_s (T) = W_{ESE"}, {"decoder": "In the Koopman evolution block", "follows": "n$s^P (T + F) = As^P (T + F \u2212 1) + Bv_{\u22121"}, {"T": "T + F \u2212 1))$ (16)\nwhere $s^P (\u00b7)$", "follows": "n$e_s^P (T + f) = W_{DEC"}, {"2": "In a typical trajectory prediction task", "follows": "n$L_"}]