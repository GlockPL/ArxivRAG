{"title": "ROBUST BARYCENTER ESTIMATION USING\nSEMI-UNBALANCED NEURAL OPTIMAL TRANSPORT", "authors": ["Milena Gazdieva", "Alexander Kolesov", "Petr Mokrov", "Jaemoo Choi", "Jaewoong Choi", "Alexander Korotin"], "abstract": "A common challenge in aggregating data from multiple sources can be formalized\nas an Optimal Transport (OT) barycenter problem, which seeks to compute the\naverage of probability distributions with respect to OT discrepancies. However,\nthe presence of outliers and noise in the data measures can significantly hinder the\nperformance of traditional statistical methods for estimating OT barycenters. To\naddress this issue, we propose a novel, scalable approach for estimating the robust\ncontinuous barycenter, leveraging the dual formulation of the (semi-)unbalanced\nOT problem. To the best of our knowledge, this paper is the first attempt to\ndevelop an algorithm for robust barycenters under the continuous distribution setup.\nOur method is framed as a min-max optimization problem and is adaptable to\ngeneral cost function. We rigorously establish the theoretical underpinnings of the\nproposed method and demonstrate its robustness to outliers and class imbalance\nthrough a number of illustrative experiments.", "sections": [{"title": "INTRODUCTION", "content": "The world is full of data, and accurate analysis of this data allows for solving a number of problems in\nthe world related to science, medicine, engineering, etc. A common challenge in data analysis arises\nfrom two factors: (i) a huge quantity of data, and (ii) the data originating from multiple sources, such\nas different scientific experiments, hospitals, or engineering trials. One promising way to address\nthese difficulties is to perform data aggregation. This means reducing the particular source-specific\ncharacteristics and leaving only source-agnostic information for solving a practical case on hand.\nRecently, a fruitful branch of research (Li et al., 2020; Fan et al., 2021; Korotin et al., 2022; Kolesov\net al., 2024a;b) has emerged that focuses on addressing the challenge of data aggregation through\nthe framework of the Optimal Transport (OT) barycenter problem. Given a number of reference\ndistributions representing data from different sources, the problem is to discover a geometrically\nmeaningful average of these distributions by minimizing the average OT costs from the reference\ndistributions to the desired one."}, {"title": "BACKGROUND", "content": "In this section, we give an overview of the theoretical concepts related to our paper. In \u00a72.1, we state\nthe SUOT problems and its semi-dual formulation. In \u00a72.2, we formulate the OT/UOT barycenter\nproblem. Then, in \u00a72.3, we describe our computational setup. For details on OT, we refer to\n(Santambrogio, 2015; Villani et al., 2009; Peyr\u00e9 et al., 2019), unbalanced OT - (Chizat, 2017; Liero\net al., 2018; S\u00e9journ\u00e9 et al., 2022), OT barycenters - (Agueh & Carlier, 2011; Chizat, 2023).\nTo begin with, we introduce the concept of 4-divergences needed for our further derivations.\n-divergences for positive measures. Let \\(\\mu_1, \\mu_2 \\in \\mathcal{M}_+(\\mathcal{X})\\) be two positive measures. Then, for a\nfunction \\(\\psi : \\mathbb{R}_+ \\rightarrow \\mathbb{R}_+ \\cup \\{\\infty\\}\\), the \u03c8-divergence between \\(\\mu_1, \\mu_2\\) is given by:\n\\(D_{\\psi}(\\mu_1 ||\\mu_2) \\stackrel{\\text{def}}{=} \\int_{\\mathcal{X}} \\psi\\left(\\frac{d\\mu_1(x)}{d\\mu_2(x)}\\right) d\\mu_2(x).\\)\nHere the generator function \u03c8(t) is assumed to be convex, non-negative, lower semi-continuous and\nattain zero uniquely when t = 1. Note that \u03c8(t) is non-decreasing since function \u03c8(t) is non-negative\n(Choi et al., 2024a). Under these assumptions, \\(D_{\\psi}\\) is a valid measure of dissimilarity between two\npositive measures. Well known examples of such \u03c8-divergences include Kullback-Leibler divergence\n\\(D_{\\text{KL}}\\) (Chizat, 2017; S\u00e9journ\u00e9 et al., 2022) and \\(\\chi^2\\)-divergence \\(D_{\\chi^2}\\). For the extended discussion on\nadmissible divergences, we refer to (Gazdieva et al., 2023a, Appendix C)."}, {"title": "OPTIMAL TRANSPORT", "content": "Classic OT problem. Consider two probability measures \\(P\\in\\mathcal{P}(\\mathcal{X})\\), \\(Q\\in\\mathcal{P}(\\mathcal{Y})\\) and the cost function\n\\(c(x, y) \\in \\mathcal{C}(\\mathcal{X} \\times \\mathcal{Y})\\). Then the OT problem (Kantorovich, 1942) between P and Q is given by\n\\(OT(P, Q) \\stackrel{\\text{def}}{=} \\inf_{\\pi \\in \\Pi(P,Q)} \\int_{\\mathcal{X} \\times \\mathcal{Y}} c(x, y)\\pi(x, y)dxdy.\\) (1)\nUnder the mild assumptions on the distributions P, Q and cost function c, the minimizer \\(\\pi^*\\) of (1)\nalways exists but is not guaranteed to be unique, see (Villani et al., 2009). In the special case of the\nquadratic cost \\(c(x, y) = ||x-y||^2\\), problem (1) reduces to the well-known (squared) Wasserstein-2\ndistance (\\(W_2(P, Q)\\)). Problem (1) admits a semi-dual reformulation:\n\\(OT(P, Q) = \\sup_{f\\in\\mathcal{C}(\\mathcal{Y})} \\left[ \\int_{\\mathcal{X}} \\underline{f}(x)dP(x) + \\int_{\\mathcal{Y}} f(y)dQ(y) \\right]\\) (2)\nwhere \\(\\underline{f}(x) \\stackrel{\\text{def}}{=} \\inf_{\\mu \\in \\mathcal{P}(\\mathcal{Y})} \\int_{\\mathcal{Y}} (c(x,y) - f(y))d\\mu(y)\\) is the c-transform. Note that the standard\nc-transform in the OT duality is usually defined as \\(\\underline{f}(x) = \\inf_{y\\in\\mathcal{Y}}\\{c(x, y) - f(y)\\} \\). Here, for the\nfuture needs, we substitute the classic c-transform by the weak c-transform (Backhoff-Veraguas et al.,\n2019, Theorem 1.3), (Gozlan et al., 2017). This transition is valid since we work the infimum in weak\ntransform is anyway attained at any \\(\\mu\\in \\mathcal{P}(\\mathcal{Y})\\) supported on the \\(\\arg \\inf_{y\\in\\mathcal{Y}}\\{c(x, y) - f(y)\\} \\) set.\nUnbalanced & semi-unbalanced OT problems. The standard formulation of the OT problem entails\nvarious issues (Balaji et al., 2020; S\u00e9journ\u00e9 et al., 2022), such as sensitivity to outliers, inability to\ndeal with class imbalance in the source and target measures and inapplicability to positive measures.\nStill, we consider the mass transportation between probability measures and focus on the first two\nissues. Fortunately, they can be overcome by relaxing the hard marginal constraints of the OT problem\nwhich yields the Unbalanced OT (Chizat, 2017; Liero et al., 2018, UOT) problem. Formally, the\nUOT problem between the probability measures \\(P\\in\\mathcal{P}(\\mathcal{X})\\), \\(Q\\in\\mathcal{P}(\\mathcal{Y})\\) is\n\\(UOT^{c,\\psi, \\phi}(P, Q) = \\inf_{\\gamma \\in \\mathcal{M}_+(\\mathcal{X} \\times \\mathcal{Y})} \\int_{\\mathcal{X} \\times \\mathcal{Y}} c(x, y)\\gamma(x, y)dxdy + D_{\\psi}(\\gamma_x||P) + D_{\\phi}(\\gamma_y||Q) \\) (3)\nwhere \\(c(x, y) \\in \\mathcal{C}(\\mathcal{X} \\times \\mathcal{Y})\\) is a continuous cost function and \\(D_{\\psi}, D_{\\phi}\\) are \u03c8-divergences over \\(\\mathcal{X}\\) and\n\\(\\mathcal{Y}\\) respectively. Note that the classic OT problem (1) is a particular instance of the UOT problem (3)\nwhen the \u03c8-divergences \\(D_{\\psi}, D_{\\phi}\\) satisfy \\(D_{\\psi'}(P', Q') = 0\\) if \\(P' = Q'\\), and \\(+\\infty\\) otherwise. Equivalently,\nit means that the generator functions \u03c8, \u03c6 are the convex indicators of \\(\\{1\\}\\) and their conjugates are\ndefined as \\(\\psi^*(t) = \\phi^*(t) = t\\). We can tune the degree of penalizing the marginal distributions mismatch\nby introducing the unbalancedness parameter \\(\\tau > 0\\) and considering \\(D_{\\psi'} = \\tau D_{\\psi}, D_{\\phi'} = \\tau D_{\\phi}\\).\nInformally, when \\(\\tau \\rightarrow +\\infty\\), the corresponding UOT problem tends to classic OT (1).\nIn this paper, we focus on the semi-unbalanced OT (SUOT) problem, i.e., the case when only the first\nmarginal constraint in the OT problem (1) is softened:\n\\(SUOT^{c, \\psi}(P, Q) = \\inf_{\\gamma \\in \\Pi(Q)} \\int_{\\mathcal{X} \\times \\mathcal{Y}} c(x, y)\\gamma(x, y)dxdy + D_{\\psi}(\\gamma_x||P).\\) (4)\nNote that the minimizer \\(\\gamma^*\\) of (4) always exists thanks to the compactness of the space \\(\\mathcal{X} \\times \\mathcal{Y}\\)\n(yielding the compactness of \\(\\Pi(Q)\\)), continuity of the cost function \\(c(x, y)\\) and lower semi-continuity\nof the function \u03c8 (yielding the lower-semi-continuity of the optimized functional w.r.t. \\(\\gamma\\)).\nThe semi-dual SUOT problem is given by\n\\(SUOT^{c,\\psi}(P, Q) = \\sup_{f\\in\\mathcal{C}(\\mathcal{Y})} \\left\\{ \\int_{\\mathcal{X}} (-\\psi^*)(-f(x))dP(x) + \\int_{\\mathcal{Y}} f(y)dQ(y)\\right\\}.\\) (5)\nNote that when \\(\\psi^*(t) = t\\), we get dual problem (2) for balanced OT problem (1)."}, {"title": "(SEMI-)UNBALANCED OPTIMAL TRANSPORT BARYCENTER", "content": "Consider probability measures \\(P_k \\in \\mathcal{P}(\\mathcal{X}_k)\\) and continuous cost functions \\(c_k(x, y) : \\mathcal{X}_k \\times \\mathcal{Y} \\rightarrow \\mathbb{R}\\),\n\\(k\\in \\mathcal{K}\\). Given wights \\(\\lambda_k > 0\\) s.t. \\(\\sum_{k=1}^K \\lambda_k = 1\\), the classic OT barycenter problem consists in\nfinding a minimizer of the sum of OT problems with fixed first marginals \\(P_{[1:K]}\\):\n\\(\\inf_{Q\\in\\mathcal{P}(\\mathcal{Y})} \\sum_{k=1}^K \\lambda_k OT_{c_k}(P_k, Q).\\) (6)\nTo ensure the robustness of the barycenter estimation it is natural to consider the relaxation of the\nmarginals \\(P_{[1:K]}\\), i.e., substitute the OT problems in (6) with the SUOT problems. Let \\(\\Psi_{[1:K]}\\) be the\nset of \u03c8-divergences. Then the SUOT barycenter problem is\n\\(\\mathcal{L}^* \\stackrel{\\text{def}}{=} \\inf_{Q\\in\\mathcal{P}(\\mathcal{Y})} \\mathcal{B}_\\Psi(Q) \\stackrel{\\text{def}}{=} \\inf_{Q\\in\\mathcal{P}(\\mathcal{Y})} \\sum_{k=1}^K \\lambda_k SUOT_{c_k,\\psi_k}(P_k, Q).\\) (7)\nClearly, the SUOT barycenter problem (7) subsumes the conventional OT one (6). We also note that\nin principle one may substitute OT with UOT problem (3) unbalanced from the both sides. However,\nthis is not practically meaningful. Indeed, the ultimate goal is to get rid of the potential outliers\nand noises in the input data, not in the barycenter. So there is no need for unbalancedness in the\nbarycenter.\nThanks to (Liero et al., 2018, Corollary 2.9), the functionals \\(Q \\rightarrow SUOT_{c_k,\\Psi_k}(P_k, Q)\\) (\\(k \\in \\mathcal{K}\\)) are\nconvex and lower semi-continuous. Thus, the functional \\(Q\\rightarrow \\mathcal{B}_\\Psi(Q)\\) is convex and lower semi-\ncontinuous itself. We note that \\(\\mathcal{P}(\\mathcal{Y})\\) is weakly compact. Thus, thanks to the Weierstrass theorem\n(Santambrogio, 2015, Box 1.1), \\(\\mathcal{B}_\\Psi(Q)\\) admits at least one minimizer meaning that the barycenter \\(Q^*\\)\nexists. Still, we can not claim that it is unique since the functional \\(Q \\rightarrow \\mathcal{B}_\\Psi(Q)\\) is not proved to be\nstrictly convex."}, {"title": "COMPUTATIONAL SETUP", "content": "In a real-world scenario, the distributions \\(P_k\\) are not available explicitly and can be assessed only via\nempirical samples. Assume that we are given \\(N_k\\) empirical samples \\(x_k^{[1:N_k]} \\sim P_k\\), \\(k \\in \\mathcal{K}\\). Our goal\nis to find approximations \\(\\gamma_k\\) of the SUOT plans between the measures \\(P_k\\) and unknown SUOT\nbarycenter \\(Q^*\\) for the given cost functions and \u03c8-divergences \\(c_k, \\psi_k\\), \\(k \\in \\mathcal{K}\\). After that, we can\nuse the learned plans to perform the conditional sampling, i.e., derive new points \\(y \\sim \\gamma_k(\\cdot|x_k)\\) from\nthe (approximate) barycenter taking samples \\(x_k \\sim (\\gamma_k)_x\\) as inputs. Actually, sampling from the left\nmarginals of the learned plans is not an easy task since the marginal can not be easily assessed using\nthe learned plans or potentials. Fortunately, we can deal with this issue using the rejection sampling\nprocedure (Forsythe, 1972), see our \u00a74.2 for the additional details.\nIt is important to note that the learned plans should admit the new input samples, i.e., not necessarily\npresent in the training datasets. This setup is typically called continuous (Li et al., 2020; Kolesov\net al., 2024a; Korotin et al., 2022) and significantly differs from the discrete one (Peyr\u00e9 et al., 2019;\nCuturi & Doucet, 2014). The latter is aimed at solving the barycenter problem between the empirical\nmeasures which makes the application to new data samples challenging."}, {"title": "RELATED WORKS", "content": "The first subsection below is devoted to continuous OT solvers with a specific focus on unbalanced\nsetup. In turn, the second subsection covers the most relevant OT barycenter solvers.\nNeural OT/UOT solvers. Neural network-based continuous OT is a popular and fruitful area of\nrecent generative modelling research. Some keynote solvers include: (Makkuva et al., 2020; Korotin\net al., 2021a; Amos, 2023) (ICNN-based, quadratic cost); (Seguy et al., 2018; Daniels et al., 2021;\nMokrov et al., 2024) (Entropic OT); (Vargas et al., 2021; De Bortoli et al., 2021; Gushchin et al.,\n2023; Tong et al., 2023; Shi et al., 2024; Gushchin et al., 2024) (Schr\u00f6dinger bridge); (Liu et al., 2023;\nTong et al., 2024; Kornilov et al., 2024; Klein et al., 2024) (Flow matching). Of special importance for\nour developed method are max-min (adversarial) OT solvers based on (semi-) dual OT formulation\n(Rout et al., 2022; Korotin et al., 2023b;a; Fan et al., 2023). Recently, the adversarial methodology\nhas been extended to unbalanced setup (Choi et al., 2024a; Gazdieva et al., 2023b; Choi et al., 2024b),\nopening up a new intriguing research direction in the field of robust continuous OT.\nOT Barycenter Methods. Below, we start with a brief overview of continuous OT barycenter solvers\nand then proceed to the current state of robust (unbalanced) barycenter research. The continuous\nOT barycenter methods could be categorized as follows: (Fan et al., 2021; Korotin et al., 2021b)"}, {"title": "PROPOSED METHOD", "content": "In \u00a74.1, we derive and investigate our novel optimization objective for learning SUOT barycenters.\nIn \u00a74.2, we propose the algorithm to solve this problem. The proofs for all theoretical results are\ngiven in Appendix A."}, {"title": "DERIVING THE OPTIMIZATION OBJECTIVE", "content": "To develop a procedure for estimating the barycenter, one may simply substitute the dual form of\nSUOT problem (5) in the barycenter problem (7) and get a min-max problem. Actually, without\nadditional modifications, it will lead to the min-max-min problem since the c-transforms \\(f_k^*\\) also\nneed to be optimized. In our Theorem 1 below, we present the way for solving the optimization\nproblem (7) in max-min manner and without the optimization over distributions \\(Q \\in \\mathcal{P}(\\mathcal{Y})\\).\nTheorem 1 (Semi-dual form of SUOT barycenter problem). The dual form of SUOT barycenter\nproblem (7) is given by\n\\(\\mathcal{L}^* = \\sup_{\\substack{m\\in\\mathbb{R}, f_{[1:K]} \\in \\mathcal{C}^K(\\mathcal{Y}) \\\\ \\sum_{k=1}^K \\lambda_k f_k = m}} \\sum_{k=1}^K \\lambda_k \\left[ \\int_{\\mathcal{X}_k} (-\\Psi_k^*)(-f_k(x_k))dP_k(x_k) + m \\right].\\) (8)\nThis Theorem shows that if potentials \\(f_{[1:K]}\\) satisfy the m-congruence condition \\(\\sum_{k=1}^K \\lambda_k f_k = m\\)\n(for some \\(m\\in\\mathbb{R}\\)) then the optimal value of the SUOT barycenter problem (4) can be derived\nby solving (8). Substituting the definition of the c-transform in (8), we get our final optimization\nobjective.\nCorollary 1 (Maximin reformulation for the semi-dual problem (8)). It holds:\n\\(\\mathcal{L}^* = \\sup_{\\substack{m\\in\\mathbb{R}, \\gamma(x_k)\\in\\mathcal{P}(\\mathcal{Y}) \\\\ f_{[1:K]} \\in \\mathcal{C}^K(\\mathcal{Y})}} \\inf_{\\sum_{k=1}^K \\lambda_k f_k = m} \\sum_{k=1}^K \\lambda_k \\left[ \\int_{\\mathcal{X}_k} \\left( -\\Psi_k^* \\left( - \\int_{\\mathcal{Y}} \\left( c_k(x_k, y) - f_k(y) \\right) d\\gamma_k(y|x_k) \\right) \\right) dP_k(x_k) + m \\right] \\stackrel{\\text{def}}{=} \\sum(f_{[1:K]}, \\{ \\gamma_k(\\cdot|x_k) \\}_{[1:K]},m) \\) (9)\nwhere the sup is taken over potentials \\(f_{[1:K]} \\in \\mathcal{C}^K(\\mathcal{Y})\\) and inf over conditional plans \\(\\gamma_k(\\cdot|x_k)\\).\nInterestingly, in the special case when at least one of the \\(SUOT_{c_k,\\psi_k}\\) terms in the right-hand-\nside of (7) reduces into \\(OT_{c_1}\\), the m-congruence condition in (9) turns into congruence condition\n\\(\\sum_{k=1}^K \\lambda_k f_k = 0\\) which typically appears in balanced settings (Kolesov et al., 2024a;b).\nCorollary 2 (Congruence Condition of the Special SUOT barycenter problem). Suppose that \u03c81(t) =\nt, i.e., \\(SUOT_{c_1,\\psi_1} = OT_{c_1}\\) in (7). Then, dual form (9) turns into the following dual formulation:\n\\(\\mathcal{L}^* = \\sup_{\\substack{f_{[1:K]} \\in \\mathcal{C}^K(\\mathcal{Y}) \\\\ \\sum_{k=1}^K \\lambda_k f_k = 0}} \\inf_{\\gamma(x_k)\\in\\mathcal{P}(\\mathcal{Y})} \\sum_{k=1}^K \\lambda_k \\left[ \\int_{\\mathcal{X}_k} \\left( -\\Psi_k^* \\left( - \\int_{\\mathcal{Y}} \\left( c_k(x_k, y) - f_k(y) \\right) d\\gamma_k(y|x_k) \\right) \\right) dP_k(x_k) \\right].\\) (10)"}, {"title": "PARAMETRIZATION AND PRACTICAL OPTIMIZATION PROCEDURE", "content": "Parametrization. To implement the optimization over distributions \\(\\gamma(\\cdot|x_k) \\in \\mathcal{P}(\\mathcal{Y})\\) (\\(k \\in \\mathcal{K}\\)) in (9),\nwe consider parametrizing them with stochastic or deterministic functions, using the strategy defined\nin (Kolesov et al., 2024a, \u00a74.1) and (Korotin et al., 2023a, \u00a74.1).\nTo realize the optimization over conditional plans \\(\\gamma_k (x_k)\\) in (9), we define an auxiliary space\n\\(\\mathcal{S}\\in \\mathbb{R}^D\\), atomless distribution \\(S \\in \\mathcal{P}(\\mathcal{S})\\) and measurable maps \\(T_k: \\mathcal{X}_k \\times \\mathcal{S} \\rightarrow \\mathcal{Y}\\). For every plan\n\\(\\gamma_k\\), we consider the representation using the map \\(T_k\\) s.t. \\(\\gamma_k(\\cdot|x) = T_k (x,\\cdot)\\_#S\\). Using the stochastic\nparametrization of the conditional plans, we can reformulate the optimization objective (9) as:\n\\(\\mathcal{L}^* = \\sup_{\\substack{m\\in\\mathbb{R}, T_{[1:K]} \\\\ f_{[1:K]} \\in \\mathcal{C}^K(\\mathcal{Y})}} \\inf_{\\sum_{k=1}^K \\lambda_k f_k = m} \\sum_{k=1}^K \\lambda_k \\left[ \\int_{\\mathcal{X}_k} \\int_{\\mathcal{S}} \\left( f(T_k(x_k,s)) - c(x_k,T_k(x_k, S)) \\right) dS(s) dP_k(x_k) + m \\right]. \\) (13)\n\\(\\mathcal{L}(f_{[1:K]},T_{[1:K]},m) \\stackrel{\\text{def}}{=} \\) Expression under sup inf in (13).\nWe denote the expression under sup inf in (13) as \\(\\mathcal{L}(f_{[1:K]}, T_{[1:K]}, m)\\). In some of the setups, the\nstochasticity of the conditional plans \\(\\gamma(\\cdot|x)\\) is not needed. Then we can consider a measurable map\n\\(T_k: \\mathcal{X}_k \\rightarrow \\mathcal{Y}\\) which specifies the deterministic conditional plans as \\(\\gamma_k(\\cdot|x) = \\delta_{T_k(x)}(\\cdot)\\).\nFor solving (13), we parametrize the maps \\(T_k\\) and potentials \\(f_k\\) (\\(k \\in \\mathcal{K}\\)) as neural networks\n\\(T_{k,w}:\\mathbb{R}^{D_k} \\times \\mathbb{R}^{D_S} \\rightarrow \\mathbb{R}^D\\) and \\(f_{k,\\theta} : \\mathbb{R}^{D_k} \\rightarrow \\mathbb{R}\\) with weights \\(w \\stackrel{\\text{def}}{=} w_{[1:K]} \\in \\Omega\\), \\(\\theta \\stackrel{\\text{def}}{=} \\theta_{[1:K]} \\in \\Theta\\). Here\n\\(\\Omega = \\Omega_1 \\times \\Omega_2 \\times ... \\times \\Omega_K\\) and \\(\\Theta = \\Theta_1 \\times \\Theta_2 \\times ... \\times \\Theta_K\\) are the parameter spaces for the maps and\npotentials respectively. Note that \\(\\mathbb{R}^D\\) denotes the stochastic dimension which should be omitted in\nthe case of deterministic maps. In order to ensure the m-congruence condition for the potentials, we\nparametrize them as \\(f_{k,\\theta} = g_{k,\\theta} - \\sum_{n\\neq k} \\frac{\\lambda_n}{(\\mathcal{K}-1)}g_{n,\\theta} + \\frac{m}{\\mathcal{K}}\\) where \\(g_{k,\\theta}\\) denote the auxiliary neural\nnets. Here we take inspiration from similar strategies in (Li et al., 2020; Kolesov et al., 2024b;a).\nTraining. Recall that we work in a continuous setup of barycenter problem, i.e., the distributions\n\\(P_{[1:K]}\\) are accessible only through the empirical samples of data. Thus, we opt to estimate the\nobjective (13) from samples using the Monte-Carlo method. Specifically, the objective is opti-\nmized using stochastic gradient descent-ascent algorithm over random batches of samples from\nthe distributions \\(P_k\\) and auxiliary distribution \\(\\mathcal{S}^1\\). For simplicity, we replace the minimization of\nthe objective \\(\\mathcal{L}(f_{\\theta,[1:K]}, T_{w,[1:K]})\\) w.r.t. \\(T_{w,[1:K]}\\) with the direct minimization of the c-transform\n\\(\\int_{\\mathcal{X}_k} \\int_{\\mathcal{S}} \\left( f(T_k(x_k,s)) - c(x_k,T_k(x_k, S)) \\right) dS(s) dP_k(x_k).\\)"}, {"title": "EXPERIMENTS", "content": "In this section, we evaluate our model through various experiments. In \u00a75.1, we compare the numerical\naccuracy of our method against baseline methods. In \u00a75.2, we investigate two key properties of our\nU-NOTB method: robustness to class imbalance and robustness to outliers. Specifically, we show\nthat these properties can be controlled by adjusting the unbalanced parameter \u03c4. In \u00a75.3, we evaluate\nour model for the general costs, leveraging shape and color-invariant cost on the image dataset, other\nthan the quadratic cost. We provide the details about settings and baselines in Appendix B."}, {"title": "BARYCENTER EVALUATION ON SYNTHETIC DATASETS", "content": "Baselines. We aim to evaluate whether our model accurately estimates the optimal barycenter \\(Q\\)\nand the corresponding transport maps \\(T_{[1:K]}\\). Because our work is the first attempt to address the\ncontinuous SUOT barycenters, there are no existing baselines for direct comparison. Therefore, we\ncarefully designed two baseline models for comparison with our approach. These baseline models\nare motivated by the equivalence between the OT barycenter of two distributions and the interpolation\nbetween them (Villani et al., 2009). Each baseline model is derived from two approaches for learning\nthe unbalanced transport map \\(T_{uot}\\) between \\(P_1\\) and \\(P_2\\): (i) the semi-dual UOT model (UOTM) (Choi\net al., 2024a) and (ii) the OT Map model (OTM) (Rout et al., 2022) combined with the mini-batch"}, {"title": "ROBUST BARYCENTER ESTIMATION UNDER OUTLIER AND CLASS IMBALANCE", "content": "In this section, we examine two key properties of our U-NOTB model: (i) robustness to class\nimbalancedness and (ii) robustness to outliers. The value of OT functional OT(\u00b7,\u00b7) is known to\nbe sensitive to outliers and class imbalance problems. Hence, the OT barycenter is also largely\naffected by these factors. To address this sensitivity, the UOT problem extends the traditional OT\nproblem by relaxing the constraint on marginal densities. This relaxation introduces two notable\ncharacteristics. First, even in the presence of class imbalances, the reweighting process allows the\nmodel to appropriately align with the relevant modes in a reasonable manner (Eyring et al., 2024).\nSecond, the model exhibits robustness to outliers, maintaining reliable transport despite their presence\n(Balaji et al., 2020; Choi et al., 2024a). The goal of this section is twofold: (1) to investigate whether\nthese two properties are also observed in our U-NOTB model by comparing it with the OT counterpart"}, {"title": "SHAPE-COLOR EXPERIMENT", "content": "In this section, we illustrate one interesting example demonstrating how the UOT barycenter problem\ncan be applied using a general cost. We designed the problem at general costs when there are some\nundesirable outliers in the marginal distributions.\n\u2022 Shape distribution P1. The first marginal distribution consists of grayscaled images of digits '2'\n(49% of training dataset), '3' (50%) and '7'(1% - outliers) of MNIST data.\n\u2022 Color distribution P2. The second marginal distribution consists of three color points: red\n(probability mass po = 0.495), green (p1 = 0.495), white (p2 = 0.01 - outliers).\n\u2022 Manifold. We pretrained the StyleGAN Karras et al. (2019) generator \\(G : \\mathcal{Z} \\rightarrow \\mathbb{R}^{3\\times32\\times32}\\) on the\ncolored MNIST dataset of digits '2' and '3'. Let \\(E\\) be the network which encodes each marginal\n\\(P_i\\) to the latent \\(\\mathcal{Z}\\). Throughout the experiment, we transport \\(x_i \\sim P_i\\) to the barycenter point \\(y_i\\) by\n\\(y_i=GE(x_i)\\), thus confining the transformed images to the colored MNIST of digits '2' and '3'.\n\u2022 General Transport costs. For the first marginal sample \\(x_1 \\sim P_1\\) and its corresponding barycenter\npoint \\(y_1\\), we use the following shape-preserving cost: \\(c_1(x_1, y_1) = ||x_1 - H_g(y_1)||^2\\), where \\(H_g\\) is\na decolorization operator. Moreover, for the second marginal sample \\(x_2 \\sim P_2\\) and the corresponding\nbarycenter point \\(y_2\\), we use the following color-preserving cost: \\(c_2(x_2, y_2) = ||x_2 - H_c(y_2)||^2\\),\nwhere \\(H_c\\) is a color projection operator defined in Kolesov et al. (2024a)."}, {"title": "DISCUSSION", "content": "Our work continues the recent and fruitful branch of OT barycenter research. We present the first\nattempt to build robust OT barycenters under continuous setup based on unbalanced OT formulation.\nFrom now on, the barycenter researchers have a new deep learning tool at their disposal that gives\nthem the ability to deal with imperfect data (with outliers/noise/class imbalance) at a large scale. We\nbelieve that our proposed method will further expand the toolbox of deep learning practitioners.\nLimitations. In practice, we found that the practical optimization procedure (Algorithm 1) may work\nunstably. In particular, the training may diverge under improper hyper-parameters selection or the\nresulting quality might depend on the random seed. We hypothesise that this behaviour is due to\nthe reliance on adversarial training and leave its thorough investigation to"}]}