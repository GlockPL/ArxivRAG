{"title": "Hybrid CNN-LSTM based Indoor Pedestrian Localization with CSI Fingerprint Maps", "authors": ["Muhammad Emad-ud-din"], "abstract": "The paper presents a novel Wi-Fi fingerprinting system that uses a Channel State Information (CSI) data for fine-grained pedestrian localization. The proposed system exploits the frequency diversity and spatial diversity of the features extracted from CSI data to generate a 2D+channel image termed as a \u201cCSI Fingerprint Map\". We then use this CSI Fingerprint Map representation of CSI data to generate a pedestrian trajectory hypothesis using a hybrid architecture that combines a Convolutional Neural Network and a Long Short-Term Memory Recurrent Neural Network model. The proposed architecture exploits the temporal and spatial relationship information among the CSI data observations gathered at neighboring locations. A particle filter is then employed to separate out the most likely hypothesis matching a human walk model. The experimental performance of our method is compared to existing deep learning localization methods such ConFi, DeepFi and to a self-developed temporal-feature based LSTM based location classifier. The experimental results show marked improvement with an average RMSE of 0.36 m in a moderately dynamic and 0.17 m in a static environment. Our method is essentially a proof of concept that with (1) sparse availability of observations, (2) limited infrastructure requirements, (3) moderate level of short-term and long-term noise in the training and testing environment, reliable fine-grained Wi-Fi based pedestrian localization is a potential option.", "sections": [{"title": "1. Introduction", "content": "People localization is an essential component of many applications like indoor security camera systems, activity classification, and elderly people who need to be monitored. Apart from Wi-Fi based localization, alternate options like camera-based people tracking generally fail to deliver because of problems with maintaining line-of-sight with the sensor, privacy concerns, variance in lightening conditions, high velocity motions, computational and infrastructure costs. Apart from cameras, sensors like IMUs and Magnetometers are either too noisy or expensive to be part of a scalable solution.\nSince Wi-Fi infrastructure is ubiquitous in indoor environments, many have jumped on the opportunity and designed efficient and scalable localization systems based on deep learning models. These systems rely on either active or passive localization methods. Passive methods include scenarios where users carry no Wi-Fi device and are localized based on the available Wi-Fi signals that are reflected from their bodies [11-14]. Active methods primarily rely on user carried Wi-Fi devices for gathering fingerprints usually extracted from either Received Signal Strength Indicator (RSSI) measure or Channel State Information (CSI). A cost-effective and scalable solution which has a potential to provide localization without the need of any additional signal or infrastructure, seems like a promising road to a future widespread adoption for this technology.\nOur approach towards pedestrian localization involves an active method of localization that pivots on two assumptions (1) The CSI measure, apart from being a tool to monitor channel conditions for achieving high data-rates, can also be used as a spatially diverse signal. (2) The fingerprinting strategy, the pre-processing and the post-processing framework used to shape the training data associated to indoor locations, ensures that fingerprint features remain diverse over space and robust to noise over longer durations of time. As such, there exists wide support in the literature for the fact that CSI can capture fine-grained variations over space in the wireless channel, but no formal study has been conducted to study the signal stability over time.\nGiven the above pre-requisites, we pre-processed the CSI observations so that these remain temporally stable for pedestrian positioning task over extended periods of time. Spatial diversity in the CSI measure exists by the virtue of a large number of signal features it considers but it is certainly a challenge to extract a temporally stable fingerprint formulation considering how noisy these signals can get. This happens due to the extent of Radio Frequency (RF) phenomena present in an uncontrolled environment."}, {"title": "2. Literature Review", "content": "For coarse-grained localization, RSSI based fingerprinting has not been able to show convincing accuracy, primarily because of lack of space diversity in RSSI measure. Both RSSI and CSI channel quality indicators contain unpredictable variance over time and space due to the presence of people and existing obstacles, which create RF phenomena like reflection, refraction and multipath interference, thus impairing precise positioning. Even in the case of CSI, very close locations usually share similar fingerprints and, therefore, the typical average accuracy of Wi-Fi positioning systems is within a few meters (~1\u20134m) [5]. In an effort to achieve fine-grained localization, some complementary approaches have been suggested that make use of a range of noisy sensors like IMUs (Inertial Measurement Units) [6], light intensity sensors and magnetometers [7] but these suffer from sources of error like nonlinear and time-dependent noise and accumulative error [8]. Thus, traditional methods use reliable external sources to reset the bias and accumulative error. A more recent work [4] affirms the overall superiority of CSI over RSSI in terms of stability for effective localization via fingerprinting. It also highlights that the difference of CSI phase values between two antennas for 5GHz orthogonal frequency-division multiplexing (OFDM) channel, is highly stable at a fixed location compared to RSSI channel information or similar 2.4GHz OFDM channel CSI phase values. Such revelations have dictated our choice of 5 GHz OFDM channel for measuring CSI phase difference values between two antennae on the same device. A higher-level derived feature (computed from calibrated phase difference between antenna), such as angle of arriving (AOA) could also be used but requires that there is a strong Line of Sight (LOS) component between the access point (AP) and the receiver (which may not be the case for our collected dataset). The simulation work presented in [5] claims that since real RSSI datasets would always contain significant noise due to environmental factors, working with simulated RSSI signals has obvious advantages since we have a ground-truth signal available. Authors in [5] have shown that they have the liberty to introduce controlled noise and error-sources and study its impact on fingerprints in isolation to the noise introduced by uncontrolled factors. This study is particularly useful for determining the impact of distance and presence of other RF signal sources on the spatial diversity of signal.\nWe also evaluated popular RSSI datasets available at [10] for long term fingerprint degeneration. It was noticed that an average of signal strength difference of up to a maximum"}, {"title": "3. Preliminaries and CSI Phase Information", "content": "3.1. Channel State Information\nCSI records the variation in an 802.11n standard channel, experienced during propagation. A wireless signal may experience variance caused due to possible RF phenomena like the multipath effect, fading, shadowing, reflection, refraction, interference and delay distortion. Without a channel quality metric like CSI, it is almost impossible to analyze the channel characteristics with only the signal power. Briefly, CSI represents the channel's frequency response, which can be estimated from transmitted and received signal vectors.\nThe 5GHz band Wi-Fi channel is a narrowband flat fading channel. We use Intel Wi-Fi Link 5300 NIC wireless LAN card that can read 30 subcarriers out of a total 56 subcarriers for CSI information via the device driver. The channel frequency response CSI of subcarrier i is a complex value, which can be represented as follows\n$\\text{CSI}_{i} = |\\text{CSI}_{i}|e^{jsin(\\angle \\text{CSI}_{i})}$\nwhere $|\\text{CSI}_{i}|$ and $ \\angle \\text{CSI}_{i}$ are the amplitude response and the phase response of subcarrier i, respectively. Our fingerprinting approach uses sanitized phase values for 30 subcarriers in the OFDM system, which when used with a multiple-input and multiple-output (MIMO) router and a wireless receiver device both having 3 antennae, translates into a total of 270 phase values.\n3.2. Sanitizing CSI phase values\nThough the CSI phase information is readily available from the Intel 5300 NIC, it cannot be directly used for localization, due to noise and the unsynchronized time and frequency of the transmitter and receiver. We use a linear transform-based approach listed in [18] to sanitize the phase values measured from the 30 subcarriers. The key idea behind removing the randomness in CSI phase is that the true phase formulation contains certain unknown values i.e. timing offset at the receiver and phase offset, which can be"}, {"title": "3.3. Denoising the CSI values", "content": "We performed a detailed time-based analysis of variance present in CSI amplitude response and phase response. The analysis is based on a dataset gathered over a period of almost two months. This analysis precipitated the following conclusions which helped shape our decision as to what CSI component to choose for fingerprinting and decide a denoising approach to remove variance caused due to RF phenomenon caused by the environment.\n\u2022\tFor a location, the CSI values for both amplitude and phase for different antennas pairs (transmitting and receiving antenna pairs) show unique patterns. Thus, using CSI values corresponding to more antenna pairs is bound to bring more diversity to our fingerprint.\n\u2022\tFor a location, CSI values on certain subcarriers frequencies occasionally show very high variance due to RF propagation phenomena discussed earlier. Skipping these frequencies altogether from the dataset does not justify the accuracy loss as certain \"discriminant features\" are lost in the process.\n\u2022\tFor a given location, for consecutive observations, not separated in time by more than 200 milliseconds, CSI values have very low variance over a short time window e.g. 2 seconds. Under rare environmental circumstances, this variance however grows by a large margin due to RF phenomenon caused by environmental changes such as very frequent motion in the vicinity of access point or Wi-Fi device.\nLast observation proved to be essential as literature [5] suggests that 68.27%,95.45% and 99.73% of noisy RSSI values fall within the first, second and third standard deviation (\u03c3) bounds respectively. We already know that assuming the noise distribution in wireless signals to be a Gaussian is an oversimplification, but this assumption significantly simplifies the computations with little performance loss [5]. We thus assume similar noise distribution and bounds for CSI phase values and remove noisy observations which contain CSI phase values beyond 2\u03c3 bound for any subcarrier frequency."}, {"title": "4. Hybrid CNN LSTM based Pedestrian Localization", "content": "4.1. Dataset Collection\nA CSI observation dataset was collected in the corridors of Emerging Technologies Building at Texas A&M University. Each training observation consists of 30 sanitized CSI Phase values for 9 MIMO channel pairs between an access point (AP) and a Wi-Fi device as shown in Figure 4. Thus, each fingerprint observation collected at location (x, y) can be represented by a set FP(x,y)\n$FP_{x,y} = \\{pr_1, pr_2, ..., pr_{270} \\}$\nHere $pr_i$ represents a sanitized phase value collected at location (x, y) at time t. A comprehensive snapshot of the dataset attributes is presented in table 1.\nA total of 14400 observations distributed among 36 locations were gathered during the data collection exercise. Each of the observations was time-stamped using suitable resolution so that observations can be used in time-sensitive recurrent networks. More specifically, the following conditions were met to establish the suitability of this dataset to serve as fingerprinting database for a Wi-Fi based positioning system.\na.\tThe training data locations were kept at fixed distance"}, {"title": "4.2. Proposed Method", "content": "The proposed method and its components are shown in a flowchart illustrated in figure 6. It can be seen in the figure, that our method contains two kind of dataflows. One is the offline data flow that is meant to collect the CSI fingerprints at certain locations and then train a deep learning model which can be queried for a location when provided with a test fingerprint. The second data flow obviously is the online or the test dataflow. Its job is to collect test CSI fingerprints and feed it to the trained deep learning model to elicit a location estimation. Now going into further detail, the step-by-step method is listed below.\n4.2.1. CSI Fingerprint map\nThe RF fingerprint map shown in figure 5, can establish a correspondence between our single observation which is"}, {"title": "4.2.2. Sliding Window based Localization Method", "content": "A graphical illustration of this method is presented in figure 7. We list down the proposed method in brief steps listed below.\na.\tWe shape the collected dataset into a 2D+channels CSI Map format. This map Mi has each pixel associated to a location (x, y) where training observations were gathered during the pre-requisite fingerprinting collection stage.\nThis step explains the notion of Information Adaptive Sliding Window (Proposal) Size. We assume a motion model of a pedestrian where we anticipate a very high variance of roughly 180 degrees in the heading and a variance of 3 m/s in the walking speed of the pedestrian. These assumptions lead us to come up with three possible proposal sizes for the sliding window that will generate the training proposals for our method. The varying size of training proposals or sub-images give our model the ability to \"adapt\" and provide superior accuracy once CSI observations related to immediate and extended neighborhood are available.\nb.\tThe following are the driving factors behind each of the proposal sizes.\n\u2022\t1\u00d71 size: This is essentially a single pixel associated to a single location on the map. This training patch or proposal will likely make the classification suffer from highest level of localization inaccuracy since this contains minimal amount of information.\n\u2022\t2 \u00d7 2 size: This size of sliding window extends to the immediate neighborhood of the walking pedestrian. For the test observation, the sliding proposal for this size, can only be generated when we have enough CSI datapoints available in the vicinity of the pedestrian. Since 4x more information is present in this proposal, the localization performance improves accordingly.\n\u2022\t3 \u00d7 3 size: This size of sliding window extends beyond immediate neighborhood of pedestrian"}, {"title": "4.2.3. Hybrid CNN-LSTM based Learning Model", "content": "After carefully trying multiple hyper-parameters, we ended up achieving optimal location classification performance via using the hybrid architecture shown in figure 8. Here parameters U and V represent the maximum Information Adaptive Sliding Window Size used to extract the proposals from the CSI Fingerprint Map. We can make following observations that sum up our findings at the end of our model development effort. These statements also indicate the suitability of hybrid CNN-LSTM model for our problem.\na.\tSubject's path trajectory in space is highly variant and as such, no long-term dependency patterns were expected to exist. This was indicated to us when we increased the recurrent weight for the L2 Regularization Factor for Forget gate to 4X its default value of 0.001. This penalized our model for forgetting and in effect made our model remember much longer temporal patterns. Under this scenario the model accuracy dropped. Bringing this value to 2X provided us with optimal results. This means there exist some short-term temporal patterns that brought up model accuracy for 2X weight factor.\nb.\tIncreasing the number of CNN layers adversely affected the overall accuracy of our method. This was primarily caused due to the unsuitable level of learned spatial features provided to LSTM.\nc.\tIncreasing the number of hidden units in LSTM Layers caused the overfitting to occur. This indicates that having too many parameters available for the model to learn can easily make the model memorize the training dataset.\nd.\tDropout Layers were not introduced since overfitting was largely addressed via adjusting L2 Regularization Factor in LSTM layers."}, {"title": "4.2.4. Particle Filtering approach for Trajectory Hypothesis Selection", "content": "We propose a particle filtering approach that removes location misclassifications generated by Hybrid CNN-LSTM based learning model. The particle filtering approach consists of two phases namely Multi-Trajectory Hypothesis Generation and Particle Filter based Hypothesis Selection.\nMulti-Trajectory Hypothesis Generation: The goal of this module is to generate multiple trajectory beliefs based on location confidence values St, evaluated by CNN-LSTM at time t. This module requires two parameters to generate trajectory beliefs. The first parameter f represents the number of weighted random samples that are chosen from"}, {"title": "5. Results and Performance Evaluation", "content": "5.1. Experiment Setup\nWe use a low-power pocket held embedded PC as a Wi-Fi device for collecting test data set. This device is installed with a power optimized Ubuntu LTS configuration; thus, the device can last upwards of 9 hours of data collection activity. The device has an Intel Wi-Fi Link 5300 NIC wireless LAN card, along with a 3 Port MIMO Antenna. Hybrid CNN-LSTM model training was performed suing a High-Performance Computing node installed with an NVIDIA K80 Accelerator and 20 GB of RAM. We verify our model in an indoor corridor scenario as shown in figure 10. The whole experiment area is about 14 m by 10 m. It must be mentioned here that there exists no line of sight (LOS) between the router and the reference points for training observation collection.\n5.2. Methodology\nWhile the reference locations are kept equidistant (1 meter apart) and fixed, test locations have not such restrictions placed on these. A subject is allowed to walk through the corridors and a stream of observations is collected with each observation 200 milliseconds apart in time. A consecutive subset of these observations is extracted as a trajectory and tested on our proposed method. There is no restriction on the temporal distance between two test"}, {"title": "5.3. Method Comparison", "content": "The first method that we shortlisted for accuracy comparison with the proposed method is called DeepFi [15]. This method has been widely employed for comparisons for CSI based positioning method and can provide a good baseline for achievable localization accuracy via CSI based fingerprinting. Moreover, this method also uses a Bayes probability model based post-processing technique to estimate final positioning of the subject. Since we also employ a particle filter-based location estimation technique, DeepFi stands out to be a good comparison candidate.\nThe second method chosen for comparison is known as ConFi[17]. As already discussed earlier, this method also uses 2D+channel CNN for location classification, thus we wanted to have a closely related and relatively recent technique present in the comparison table as well.\nThe last method for comparison was developed by us. This method is an LSTM based classifier that only uses temporal features of the CSI fingerprints and completely ignores the spatial relationships between the fingerprints."}, {"title": "5.4. Effect of Parameters and Hypothesis Selection Method on Localization Performance", "content": "Parameters that have a significant impact on localization performance of the method include grid-size for training dataset collection, Information Adaptive Sliding Window Size, Pedestrian walking speed. Apart from these parameters, Hypothesis Selection Method, reduces the Mean Distance Error to as low as 0.07 m for a specific combination of parameters. Table 2 lists the corresponding localization errors before and after the application of HSM for several parameter combinations.\nIt is evident from the experimental data that learning spatial features alongside the temporal features on a map-based representation has a significantly positive impact of localization accuracy. PF-HSM application over the CNN-LSTM model output provides us with an average 38% improvement in terms of distance error measure. The primary reason behind such a boost in accuracy is the fact that particle filter is easily able to reject mis-classified locations that lie farther apart in terms of distance, the human walk motion model is easily able to filter out pedestrian hypothesis that either try to breach human walking speeds or corresponding limits on turning angles. An instance of such hypothesis rejection from the real test dataset is shown in figure 11. The selected trajectory is then mapped onto the grid-cells defined during the training dataset collection phase. The grid-cells that overlap selected trajectory points are then used to evaluate the improved localization accuracy listed in the last column of table 2. An instance of such a mapping is shown in figure 12. Due to the non-availability of accurate sensors that could measure accurate pedestrian heading for each location at a resolution"}, {"title": "6. Conclusion", "content": "The proposed method delivers robust results in terms of pedestrian localization and heading. A temporally stable and diverse sanitized CSI phase value signal is used for fingerprinting. The novelty of the proposed method lies in representation of the signal to 2D mapping domain and then exploiting this representation to be used in location classification using a hybrid CNN-LSTM learning model. Not only is the proposed method more accurate than contemporary methods in terms of pedestrian localization, it also manages to deliver estimated pedestrian heading without the use of any additional sensors such as an IMU or Magnetometer. The accuracy and stability of generated trajectory and heading based on Wi-Fi signals are verified via experimental results."}, {"title": null, "content": "$\nPL =\n\\frac{1}{\\sqrt{2\\pi(1 - c^2)}} e\n\\frac{(-x_l^b)^2 + (-y_l^b)^2}{2(1-c^2)}\n$\n$\nPR =\n\\frac{1}{\\sqrt{2\\pi(1 - c^2)}} e\n\\frac{(-x_r^b)^2 + (-y_r^b)^2}{2(1-c^2)}\n$\n$\nd0 = (x_l^b - x_r^b) cos(\u03b8^b) + (y_l^b - y_r^b) sin(\u03b8^b)\n$\n$\nr0 = -S_b^j cos(\u03b8_t^b)\n$\n$\nh = \\frac{1}{\\sqrt{2 \\pi \\eta}}\n$\n$\nP_B = \\sqrt{2\\pi h^2} e^{\\frac{(d0 - r0)^2}{2h^2}}\n$\n$\nP(w_t^{b,j} | Z_t^{b,CSI}) = P_L \\cdot P_R \\cdot P_B\n$\n$\nw^{b,j} = \\frac{ P(w_t^{b,j} | Z_t^{b,CSI})}{\\sum_j P(w_t^{b,j} | Z_t^{b,CSI})}\n$"}]}