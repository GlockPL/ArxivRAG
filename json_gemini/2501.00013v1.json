{"title": "Relation-Aware Equivariant Graph Networks for Epitope-Unknown Antibody Design and Specificity Optimization", "authors": ["Lirong Wu", "Haitao Lin", "Yufei Huang", "Zhangyang Gao", "Cheng Tan", "Yunfan Liu", "Tailin Wu", "Stan Z. Li"], "abstract": "Antibodies are Y-shaped proteins that protect the host by binding to specific antigens, and their binding is mainly determined by the Complementary Determining Regions (CDRs) in the antibody. Despite the great progress made in CDR design, existing computational methods still encounter several challenges: 1) poor capability of modeling complex CDRs with long sequences due to insufficient contextual information; 2) conditioned on pre-given antigenic epitopes and their static interaction with the target antibody; 3) neglect of specificity during antibody optimization leads to non-specific antibodies. In this paper, we take into account a variety of node features, edge features, and edge relations to include more contextual and geometric information. We propose a novel Relation-Aware Antibody Design (RAAD) framework, which dynamically models antigen-antibody interactions for co-designing the sequences and structures of antigen-specific CDRs. Furthermore, we propose a new evaluation metric to better measure antibody specificity and develop a contrasting specificity-enhancing constraint to optimize the specificity of antibodies. Extensive experiments have demonstrated the superior capability of RAAD in terms of antibody modeling, generation, and optimization across different CDR types, sequence lengths, pre-training strategies, and input contexts.", "sections": [{"title": "Introduction", "content": "Antibodies are a family of Y-shaped proteins produced by the immune system to recognize, bind, and neutralize pathogens (e.g., antigens) (Basu et al. 2019). Since the specificity of antibody-antigen binding is mainly determined by the Complementary Determining Regions (CDRs) in the antibody, how to design CDRs that bind to specific regions (epitopes) of an antigen becomes an important problem. Considering the enormous search space of over 2060 potential CDR sequence candidates and the high variability of CDR structures, it is not feasible to test all potential CDRs by experimental assays in the web laboratory, which calls for computational methods for antigen-binding antibody CDR design (Tiller and Tessier 2015; Kuroda et al. 2012).\nThe computational antibody design has undergone a paradigm shift from energy-base models (Adolf-Bryfogle et al. 2018; Lapidoth et al. 2015) to deep generative models (Lin et al. 2024; Kong, Huang, and Liu 2022; Wu et al. 2024a,b; Tan et al. 2024; Jin, Barzilay, and Jaakkola 2022). RefineGNN (Jin et al. 2021) is the first work to co-design CDR sequences and structures in an autoregressive manner, and its follow-up HSRN (Jin, Barzilay, and Jaakkola 2022) unifies antigen-binding antibody design and docking in a hierarchical refinement framework. DiffAb (Luo et al. 2022) adopts diffusion models (Hoogeboom et al. 2021) to design the CDR sequences, Ca coordinates, and orientations in an iterative manner. Similarly, AbDiffuser (Martinkus et al. 2024) incorporates family-specific priors into the diffusion process, which greatly improves generation efficiency and quality over DiffAb. To improve computational efficiency, MEAN (Kong, Huang, and Liu 2022) replaces autoregressive decoding with progressive full-shot decoding and involves the light chain as a conditional input to generate CDRs. It is further extended as dyMEAN (Kong, Huang, and Liu 2023), an end-to-end full-atom antibody design method. Two recent works, ABGNN (Gao et al. 2023) and HTP (Wu and Li 2023), focus on the benefits of antibody sequence pre-training and hierarchical pre-training, respectively.\nDespite the fruitful progress, existing approaches still face several challenges. The first issue is that it is hard to model complex CDRs with long sequences. Take MEAN as an example in Fig. 1, it fails to model the types and coordinates of those amino acids in the middle of CDRs, especially for CDRs with long sequences. This is probably because the amino acids in the middle region of CDRs are far from the framework regions on either side and thus can-"}, {"title": "Preliminary", "content": "An antibody is a Y-shaped symmetric protein with two identical sets of chains, as shown in Fig. 2. Each set contains a heavy chain and a light chain, either of which contains a variable domain (VH/VL) and several constant domains. Each variable domain can be further divided into four framework regions (FRs) and three complementarity-determining regions (CDRs), each occupying a contiguous subsequence.\nThe CDRs, especially those in the heavy chain (i.e., CDR-H1, CDR-H2, CDR-H3), are key in determining the antigen-antibody binding. Therefore, we mainly focus on the design and optimization of 3 CDRs in heavy chains in this paper."}, {"title": "Graph Construction", "content": "We represent each antigen-antibody complex as a heterogeneous graph G = (V,E), where V = (VH,VL, VA) is the set of nodes (residues) of the heavy chain, the light chain and the antigen, and & contains the edges connecting the residues. Each node vi = (hi, Xi) \u2208 V is attributed as a node feature vector hi \u2208 Rdn and a node coordinate matrix X\u00bf \u2208 R3\u00d74 consisting of 4 backbone atoms {N, Ca, C, O}. In addition, each edge ei,j \u2208 E is described by an edge feature vector Ei,j \u2208 Rde and a set of edge relations Ri,j \u2208 R, where R contains 8 different relations describing the dependence between residue vi and residue vj. Therefore, the graph of each antigen-antibody complex can also be denoted as G = (H, X, E, R). To capture global information about different contextual components, we additionally insert a global node for the light chain, heavy chain, and antigen, respectively. The three global nodes are connected to each other and to all nodes within the same context component.\nNode and Edge Fetures are defined in terms of 6 aspects: type, position, distance, direction, angle, and orientation. For each residue vi, we define its node feature as follows\nhi = {Etype (vi), Epos (i), sin(\u03b7), cos(\u03b7),\nRBF (|| Xica \u2212 Xi ||), QT Xi-Xi,Ca}. (1)\nwhere Etype (vi) and Epos(i) are trainable type embedding and positional encoding of residue vi, respectively. \u03b7 = {\u03b1\u03ca, \u03b2\u03af, \u03a5\u03af, \u03a8\u03af, \u03a6i, wi} contains six bond/dihedral angles of residue vi. Besides, RBF(\u00b7) is a radial basis distance encoding function, and Xi,ca is the coordinate of Ca atom in the i-th residue. The last term in h\u2081 is a direction encoding that corresponds to the relative direction of three backbone atoms \u03be\u2208 {C\u03b2, \u039d, \u039f} in the local coordinate frame Qi of residue vi. The edge feature Ej that describes the spatial relationship between two residues vi and vj is defined as follows\nEi,j = {Etype (Ci,j), Epos (i\u2212j), RBF(||Xi,Ca \u2212 Xj,\u00a3||),\nQT Xi,Ca . \nQTXjg-Xi,Ca\n(QQ)\u0664},\nwhere Etype(i,j) is the one-encoding of relations Ri,j between two residues, and the positional encoding Epos(i \u2013 j) encodes the relative sequential position. The third and fourth terms are distance and direction encodings of four backbone atoms &\u2208 {Ca, C\u00df, N, O} in residue vj in the local coordinate frame Q\u2081. The last term q (QT Q\u2081) is the quaternion representation q(\u00b7) of QQj. \nEdge Relations. To expand the contexts of CDRs, we divide the previous internal and external edges (Kong, Huang, and Liu 2022) into 8 different types of relations R = {1,2,...,rs}, including (i) sequential relations r\u2081 and r2 between two residues with relative sequential distance"}, {"title": "Task Formulation", "content": "The residue set of the target CDR to be generated is denoted as Ve VH with node features and coordinates C = {(hi, Xi)}v;\u2208vc. Given a graph constructed from incomplete antigen-antibody complex G\\C, our objective is to learn a mapping Fe : G\\C \u2192 {(si, Xi)}vi\u2208vc, parameterized by \u0398, that generates the amino acid type si and 3D coordinate X\u00bf for each residue vi \u2208 Ve in the CDR."}, {"title": "Relation-Aware Antibody Design (RAAD)", "content": "The paper proposes a novel Relation-Aware Antibody Design (RAAD) framework, consisting of several layers of Relation-Aware Equivariant Graph Network (RA-EGN).\nRelation-Aware Equivariant Graph Network\nEach layer of RA-EGN takes into account the multi-scale residual interactions at the node, edge, and global levels and performs joint updating of node features, edge features, node coordinates, and edge relations to learn geometric residual representations. A schematic of RA-EGN is shown in Fig. 4.\n(1) Message Aggregation. For any relation r \u2208 Ri,j that exist between residues vi and vj, we perform relation-aware message aggregation with shared MLPs $m(\u00b7), as follows\nmi,j,r (1) 3 = $mh,, (X) XE), (3)\nwhere ho (0) = hi, X(0) = Xi, E(0) Ei,j, and X(1)"}, {"title": "CDR Sequence and Structure Generation", "content": "Two common strategies for sequence and structure decoding are (1) autoregressive (Jin et al. 2021; Jin, Barzilay, and Jaakkola 2022): generating CDR residues one by one; and (2) iterative refinement (Kong, Huang, and Liu 2022, 2023): the generation of the previous iteration is used as the initial for the next iteration. Autoregressive generation requires N (length of the CDRs) times decoding, which suffers from the inefficiency problem. Although iterative refinement requires only T < N iterations, it still suffers from error accumulation from previous iterations. However, our RAAD does not need either autoregression or iterative refinement, but rather directly generates both the sequences and structures of CDRs in the antibody in one single forward pass.\nSequence Generation. The sequence generation module takes the encoded node representations has input to predict the amino acid type, Si = arg max (Wh)), where W is a linear transformation matrix. The loss function for sequence generation is defined as the cross-entropy lce between the predicted amino acid types {$i}vieve and the ground-truth types {si}vi\u2208vc, defined as follows\nLseq = \u03a3 Volce (si, Softmax (Wh))). (8)\nStructure Generation. We directly take the node coordinate XL) from the last layer of RA-EGN as the backbone structure X = X(L) without using any additional decoding process. Furthermore, we can perform the side-chain packing using Rosetta (Chaudhury, Lyskov, and Gray 2010) to obtain the full-atom 3D structure. As for the loss function for structure generation, we adopt the Huber loss lhuber (,) (Huber 1992) other than the common MSE, defined as follows\nLstruct = \u03a3Chuber (\u03a7, \u03a7). (9)"}, {"title": "Antibody Specificity Optimization", "content": "Antibody optimization is another important aspect of antibody design besides antibody generation, and it is aimed towards antibodies that are not only structurally realistic but also have desirable properties, such as specificity. Most of the existing work (Kong, Huang, and Liu 2022; Gao et al. 2023; Tan et al. 2024; Kong, Huang, and Liu 2023) adopts the change in binding energy (\u2206\u2206G, kcal/mol) predicted by a geometric network (Shan et al. 2022) to measure antibody-antigen binding affinity, but it does not reflect the specificity of the antibody. To address this problem, we define a new evaluation metric to measure antibody specificity by considering AAGs of the optimized antibody to both target and non-target antigens in the test set D, defined as follows\nSP-score = AAGneg \u2013 AAGpos, where\nAAGpos = \u03a3\u0394\u0394\u0395), \n1\nD iED\nAAGneg = \u03a3\u0394\u0394\u0395). (10)"}, {"title": "Ablation Study", "content": "We further conduct ablation study on five key components: (1) w/o node features, using only node type features Etype(vi); (1) w/o edge features, using only edge type features Etype (ei,j); (3) w/o relational MMP, which performs"}, {"title": "Evaluation on Length, Context, and Pre-training Input Context", "content": "To evaluate how well RAAD is applicable to different input contexts, we consider five contextual combinations as in Table. 5. In particular, we explore how well RAAD performs if the known epitopes are pre-given and directly taken as inputs instead of the full antigen (Kong, Huang, and Liu 2022, 2023). It can be observed from the results in Table. 5 that (1) contexts on heavy chains, i.e., framework regions, play the most important role; (2) light chain helps little in antibody design; and (3) dynamic modeling of interactions between the full antigen and antibody can greatly improve performance across a variety of tasks compared to considering only those pre-given epitopes."}, {"title": "Conclusion", "content": "In this paper, we identify insufficient contextual information as a major bottleneck in limiting antibody CDR design. To address this problem, we take into account a variety of node and edge features and define multiple relations to achieve Relation-Aware Antibody Design (RAAD) in a one-shot manner. The RAAD framework takes the complete antigen as input and formulates antigen-antibody interaction dynamics modeling as a learnable structural (relational) optimization problem. Furthermore, we propose a new evaluation metric and contrastive constraints for antibody specificity optimization. Extensive experiments are provided to demonstrate the superiority of RAAD in antibody CDR generation and optimization. Despite great progress, limitations still exist in two main aspects: (1) The antibody optimization of our paper relies on an iterative augmentation (ITA) algorithm, where a well-built AAG predictor plays an important role. Combining RAAD with a stronger AAG predictor may further boost the performance. (2) Due to space limitations, only preliminary results on how pre-training affects antibody generation are provided. Combining more powerful protein or antibody pre-training strategies may be beneficial for both antibody generation and optimization."}, {"title": "Appendix", "content": "A. Comparison of Method Characteristics\nWe compare various methods in Table. Al from three key aspects: (1) input contextual data", "aspects": "type", "follows": "nhg (l+1) ="}, {}, {"title": "E. On the proof of RA-EGN E(3)-Equivariance", "content": "Theorem 1. We denote the l-th RA-EGN layer g(1)(.) in our framework as (H(l+1), X(l+1), E(l+1), R(l+1)) = g(1) (H(1), X(1), E(1), R(1)). For any given orthogonal matrix O \u2208 R3\u00d73 and translation matrix t \u2208 R\u00b3, g(1)(.) is E(3)-equivariant, i.e., we have (H(l+1), OX(l+1) + t, E(l+1), R(l+1)) = g(1) (H(1), OX(1) + t, E(1), R(1)).\nProof. For any orthogonal matrix O \u2208 R3\u00d73, translation matrix t \u2208 R\u00b3, and X = X \u2013 XD, We can derive the relative coordinates between OX + t and OX + t as\n(OX + t) \u2013 (OX + t) = OX \u2013 X = OX (A.3)\nF. Huber Loss Function\nThe huber loss (Huber 1992) helps to lead to a stable training procedure (Kong, Huang, and Liu 2022), defined as follows:\nl(x, y) = . (A.8)"}]}