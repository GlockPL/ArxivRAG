{"title": "An Interoperable Machine Learning Pipeline for Pediatric Obesity Risk Estimation", "authors": ["Hamed Fayyaz", "Mehak Gupta", "Alejandra Perez Ramirez", "Claudine Jurkovitz", "H. Timothy Bunnell", "Thao-Ly T. Phan", "Rahmatollah Beheshti"], "abstract": "Reliable prediction of pediatric obesity can offer a valuable resource to providers, helping them engage in timely preventive interventions before the disease is established. Many efforts have been made to develop ML-based predictive models of obesity, and some studies have reported high predictive performances. However, no commonly used clinical decision support tool based on existing ML models currently exists. This study presents a novel end-to-end pipeline specifically designed for pediatric obesity prediction, which supports the entire process of data extraction, inference, and communication via an API or a user interface. While focusing only on routinely recorded data in pediatric electronic health records (EHRs), our pipeline uses a diverse expert-curated list of medical concepts to predict the 1-3 years risk of developing obesity. Furthermore, by using the Fast Healthcare Interoperability Resources (FHIR) standard in our design procedure, we specifically target facilitating low-effort integration of our pipeline with different EHR systems. In our experiments, we report the effectiveness of the predictive model as well as its alignment with the feedback from various stakeholders, including ML scientists, providers, health IT personnel, health administration representatives, and patient group representatives.", "sections": [{"title": "1. Introduction", "content": "Pediatric obesity is a major public health problem that has been escalating across the globe (Pulgar\u00f3n, 2013). Specifically, in the US, the prevalence of obesity in children and adolescents aged 2-19 years in 2017-2020 was 19.7% and affected about 14.7 million children and their families (Akinbami et al., 2022).\nThis disease is often comorbid with a variety of health issues, such as type 2 diabetes, hypertension, and sleep apnea (Pulgar\u00f3n, 2013); and increases the risk of obesity-related complications in adulthood, including heart disease, stroke, and certain types of cancer (Reilly and Kelly, 2011). Beyond the physical health implications, pediatric obesity can lead to psychological problems like low self-esteem, depression, and social isolation (Rankin et al., 2016). Addressing this public health problem requires a multidisciplinary approach involving parents, educators, healthcare professionals, and policymakers to create an environment supporting children's healthy lifestyles. Timely identification of patients at an elevated risk of obesity can help engage in preventive interventions before the disease is established. In particular, utilizing AI methods to predict unhealthy weight trajectories can offer a more targeted approach and allow for early interventions and more efficient treatment in tackling this complex disease.\nDespite the abundance of obesity predictive models (Graversen et al., 2015; Redsell et al., 2016; Steur et al., 2011; Weng et al., 2013; Hammond et al., 2019), existing models are not commonly used in clinical practice. One major limitation of existing work relates to using \"site-specific\" variables, such as ad hoc datasets and questionnaires, in carefully crafted data collection studies (Gupta et al., 2022a). This kind of data is unavailable to all pediatric care providers.\nFurthermore, from an interoperability point of view, bridging the gap between theoretical models and real-world implementation within the healthcare domain has proven to be another major challenge (Harris et al., 2022). Smooth translation of technical tools requires integrating the models into the workflow of pediatric providers with minimal modification and adjusting. Collaborative efforts between data scientists, stakeholders, healthcare professionals, and technology experts are also needed to ensure the successful deployment and application of obesity prediction systems in clinical settings.\nOne way to integrate such ML tools into clinical practice is by using Fast Healthcare Interoperability Resources (FHIR) protocols (Ayaz et al., 2021), which provide a standardized framework for exchanging healthcare information. Implementing FHIR allows for seamless interoperability between different health information systems, facilitating the smooth data exchange between predictive obesity models and EHR platforms.\nThis study aims to present an end-to-end application that can access EHR data through FHIR protocols, extract relevant variables, and predict the risk of developing obesity in the future. Specifically, we propose an application that processes the EHRS of a patient and predicts obesity using greatly customized machine learning methods. It also addresses the common challenges of working with EHRs, including missingness, high-dimensionality, and temporality. Our pipeline works with only a subset of electronic health records (EHRs) that are routinely recorded in pediatric healthcare systems and avoids using site-specific or uncommon medical concepts. Specifically, the contribution of our study can be listed as follows:\n\u2022 We propose a comprehensive obesity prediction pipeline that can be integrated into any EHR platform using FHIR protocols. We also present a dedicated API for retrieving health records and returning obesity predictions.\n\u2022 We use our deep learning model customized for learning longitudinal BMI trajectories from commonly available EHR data elements to predict obesity for the next three years.\n\u2022 We present a dedicated user interface designed following extensive collaboration with different stakeholders, including the pediatric providers (i.e., the end users)."}, {"title": "2. Background", "content": "Two research areas are related to our work, namely, obesity prediction using machine learning and clinical decision support systems. In this section, we review existing work in these areas.\nObesity Prediction Machine learning models have shown great potential in predicting future health outcomes. The availability of large-scale medical data has made clinical predictive models prevalent and widely utilized in the medical domain (Alonzo, 2009). In the field of obesity prediction, a growing subset of studies have used advanced machine learning techniques. Most of the existing studies rely on traditional machine learning methods, such as the studies that used regression (Graversen et al., 2015; Redsell et al., 2016; Steur et al., 2011; Weng et al., 2013), random forest (Hammond et al., 2019) or sequence mining (Campbell et al., 2020). Capturing temporal and"}, {"title": "3. Method", "content": "Our obesity prediction pipeline includes three main components. (1) A backend that communicates with the EHR database in Observational Medical Outcomes Partnership (OMOP) common data model (CDM) format using the FHIR protocol and OMOP-on-FHIR to obtain patients' medical records. OMOP-on-FHIR is a FHIR server implementation built on top of the OMOP CDM. It is designed to provide a FHIR clinical API, which can read and write data from an OMOP CDM database. It also includes a preprocessing pipeline to transform the data representation in a way that is ready for the obesity predictive model. The backend can be accessed through the user interface or the dedicated API. (2) A trained machine learning model that predicts obesity for each patient for the next three years. (3) A user interface based on SMART (Substitutable Medical Apps and Reusable Technologies)-on-FHIR that shows the summary of patient health records con-\ntributing to the prediction of obesity as well as the outcome of the obesity predictor model. SMART-on-FHIR is a set of open standards and specifications designed to enable the integration of health information technology systems in a secure and interoperable manner. SMART-on-FHIR combines the SMART platform with the FHIR standard to create a framework for building healthcare applications. The overall architecture of the proposed system is shown in Figure 1. We discuss the details of these components below."}, {"title": "3.1. Backend", "content": "The backend acts as a coordinator between the user interface, data sources, and machine learning model. It comprises three components: (1) a FHIR client, (2) an API, and (3) a preprocessing pipeline. The FHIR client (1) communicates with the EHR databases using FHIR protocols to receive raw data. The API (2) can be used by the user interface or independently to send the patient data resources and receive the predictions from the obesity predictor model. The preprocessing pipeline (3) transforms the data representation to match the expected format by the machine learning model."}, {"title": "3.1.1. FHIR CLIENT", "content": "We used the SMART-on-FHIR framework to build our FHIR client, which is a platform-agnostic platform (Mandel et al., 2016). The FHIR client receives the concepts (i.e., demographics, measurements, medications, conditions, family history) for each patient from the EHR database and sends them to the preprocessing pipeline for further steps.\nUsing FHIR standardization promotes data consistency and compatibility, enabling efficient stakeholder communication and collaboration (Vorisek et al., 2022). Leveraging FHIR protocols can streamline integrating technical models into practical healthcare settings, thus enhancing the overall usability and effectiveness of obesity prediction systems in pediatric clinical environments."}, {"title": "3.1.2. \u0391\u03a1\u0399", "content": "We used Flask (Grinberg, 2018) to develop our API. Flask is a lightweight Python web framework designed for building web services and applications that provide essential tools for rapid development. Its modular structure and adherence to the Web Server Gateway Interface standard make integrating with various web servers easy.\nOur API can be utilized through the user interface or independently for other downstream applications (i.e., using obesity risk prediction as an input for other CDS tools). The API can access the FHIR resources directly or receive them in JSON format. In the former mode, it receives a patient's identification number and uses the FHIR client embedded in the application to retrieve the patient's information. In the latter mode, the API directly receives the FHIR resources in JSON format. The data is then passed to the preprocessing pipeline for further steps."}, {"title": "3.1.3. DATA PREPROCESSING PIPELINE", "content": "As mentioned earlier, we adopted a variant of the OMOP CDM as implemented for the PEDSnet clinical research network (NEED REFERENCE), which is a data standard designed to standardize the structure and content of observational data and enable efficient analysis. OMOP transforms data from various sources, such as EHRs and administrative claims, into a common format with standardized vocabularies and coding schemes. The CDM includes a person-centric relational database schema with a group of tables categorized into domains. It captures a wide range of healthcare information, including patient encounters, diagnoses, drugs, and procedures. As an open-community standard, the adoption of the OMOP CDM can facilitate reproducible research and collaboration across institutions.\nthat are related to each visit. Standard SNOMED-CT, RxNorm, CPT, and LOINC medical coding were used to encode health information in the original dataset. Additional information about the dataset is shown in Appendix (A).\nData Representation EHR data contains patient records as a sequence of visits over time, with each visit containing a variety of medical codes. To represent this data, we use an incremental approach with multiple levels of representation. First, we represent medical codes using code-level representation, including conditions, medications, procedures, and measurements. Then, we combine the code-level representations into visit-level representations, representing all the medical codes for each patient visit. Finally, we use visit-level representations to create a patient-level representation, combining all visits to represent the full sequence for each patient.\nIn addition to temporal data for the visits, EHRS also contain static demographic data, which does not change with every visit. We show the demographic variables such as race, ethnicity, gender, insurance type, and address as categorical variables. We preprocess and aggregate all these data types for further processing.\nBased on input from a group of pediatric obesity experts in our team, we selected a subset of clinically relevant features that are generally recorded in pediatric (well-)visits. This selection process yields 71 clinical diagnoses, 67 family history diagnoses, 84 medication groups, and 51 measurements (the exact list is available in (Gupta et al., 2024a)). Taking the above steps transforms the initial sparse representation to a representation with appropriate density for further processing.\nWe quantize the measurement variables that are initially present as continuous variables. All condition and procedure variables are converted to binary values, with 1 indicating the variable is present for the visit and 0 indicating the variable is not recorded. Then, we aggregate and unify all features with different types in one table, including age, type, description, and value.\nAdditionally, we encode the data by assigning a unique identifier to each feature. We also divide the patient's timeline into time bins and aggregate features over each time bin. We divide the timeline into equally sized monthly bins (for a 0-2 yr period with more visits) and bimonthly bins (for later ages). An"}, {"title": "3.2. Machine learning model", "content": "We extended the encoder-decoder architecture presented in our previous work (Gupta et al., 2022b). We have extensively evaluated our ML model through discriminative performance checking (including comparison to other baselines), temporal (different times for training and testing), and geographic (using data from other sites) validations. We have calibrated our model and checked for its fairness performance across various protected groups (determined by gender, race, and insurance type) (Gupta et al., 2024a, 2022a, 2021).\nThe extended version includes an encoder consisting of embedding layers that map diagnosis, medication, procedure, and measurement data into a latent space with 256 dimensions, followed by two layers of LSTM cells with 512-dimension neurons.\nConsider a scenario where a patient has the data from birth to age 7 yr. As shown in Figure 3, the encoder takes EHR data for 0-2 yrs as input and outputs a representation (embedding) vector. All the features in 0-2 yrs of EHR data are arranged chronologically, where the order of events occurring at the same timestamps is random. The output vector capturing visit-level (temporal) patterns is concatenated with the demographic data representation, where the demographic data is embedded into the latent space using a separate embedding layer.\nThis concatenated vector is given to the decoder as input. The decoder can learn from medical data of different lengths. In the example scenario, the decoder concatenates this vector with the 3-7 yrs EHR data. The decoder contains three separate feed-forward networks with two fully connected layers (512-dimension with Leaky Relu activation of 0.1 slope, 256-dimension, and 0.2 dropout rate) for every future age point for the next three years. A softmax layer at the end of two fully connected layers generates the final output. Each of these three separate feed-forward networks is used to simultaneously provide the risk of obesity for the next 1, 2, and 3 years. Obesity is defined based on the CDC's standard thresholds of being above the 95th percentile for corresponding age and sex.\nFeature importance values for all features are obtained by calculating the attention scores. Since we use different decoders for each year's prediction, the scores obtained can be different for features from each task. For instance, in the presented user interface in Figure 4, we rank top contributors from age 0 to 2 years for all prediction tasks."}, {"title": "3.3. Frontend (User Interface)", "content": "The user interface (shown in Figure 4) is designed for the end-users interacting with patients and their families, in particular pediatric primary care providers. The user interface consists of several components that provide essential information about the patient's medical history and future weight prediction based on an embedded machine learning model.\nThe final configuration of the user interface was set up following an extensive user study, which we discuss the details of it later in Section 4. The user interface has been designed in close partnership with our support group, which includes diverse stakeholders, primary care providers, and human computer interaction experts. While we could have shown a wealth of information through our AI, we have especially aimed for simplicity and briefness, considering the very busy workflow of pediatric providers who already deal with busy panels and patient charts during the visits.\nThe final components of the user interface include the following five. (1) Patient's information (name and date of birth). We do not include race, ethnicity, and address. (2) A BMI trajectory displaying the child's BMI history and predictions for the next three years. The BMI values are superposed over the standard CDC growth charts, creating a familiar interface to what providers generally see in patient charts. We have also designated an option to switch between the weight and BMI trajectories. (3) A summary of the top risk factors as determined by the predictive ML model (as explained in Gupta et al. (2022b), including top medications, measurements, family history, and conditions. (4) A descriptive guide is presented to help the users understand and interpret the outputs of the model, assist in interpreting the predictions, and offer advice on how to navigate each case. (5) A comprehensive panel listing various educational resources for families and their children is also included. These resources cover nutrition, health behavior, and community resources that can help prevent obesity and promote a healthier lifestyle."}, {"title": "4. Experiments", "content": "We conducted two types of experiments to evaluate the effectiveness of our developed pipeline, targeting the performance and utility of the whole pipeline. In particular, we target a series of technical experiments to asses the overall prediction (discrimination) performance of our ML model. We also conduct experiments that target the human factors involved in designing our pipeline, primarily focusing on the usability of the user interface within the pediatric clinical workflow."}, {"title": "4.1. Machine Learning Model Evaluation", "content": "We trained our deep learning model using 36,191 eligible children to predict the risk of obesity as well as BMI in the next three years using 6 different lengths of observation windows from ages 0-2 to 0-7 years. The observed Area Under the Receiver Operating Characteristic Curve (AUROC) for all prediction ages is presented in Table 1.\nAt a high level, there are trade-offs between the length of prediction windows and the accuracy of the models. Longer windows are preferred but can reduce accuracy. Shorter windows risk not giving enough time for an effective intervention. The current granularity of predictions (next 1-3 years) was chosen based on input from the pediatric obesity experts in our team and considering the common frequency of pediatric visits after age 2 (annual).\nSpecifically, during the first two years, children typically have well-child visits at 1, 2, 4, 6, 9, 12, 18, and 24 months. Following this period, annual visits are recommended. Based on this schedule, we utilized 3-month granularity in the first year and 6-month granularity in the second year. After two years, we adopted a yearly data granularity, which still captures sufficient variability in BMI to provide meaningful signals for the model's learning process. We will add this information to the manuscript.\nWe report additional results related to performance across temporal (different years), geographical (two different regional sites), and various subgroups (as determined by gender, race/ethnicity, and insurance type), as well as net benefit analysis, in the Appendix B."}, {"title": "4.2. User Study", "content": "We recruited a group of 12 primary care providers (PCPs) from our pediatric healthcare system. We have obtained extensive qualitative feedback about the usability, acceptability, and utility of our developed tool to predict early childhood obesity risk.\nIn our iterative study, we have assessed the acceptability and feasibility of the refined CDS tool among the PCPs using the Technology Adoption"}, {"title": "5. Discussion", "content": "A fairly large group of machine learning models have been presented for predicting future patterns of obesity across various settings (e.g., pediatric vs. adult,"}, {"title": "Limitations:", "content": "Our study remains limited in several ways. The model's performance may be influenced by the quality and completeness of the data. Variations in data quality across EHR systems could potentially impact the accuracy and reliability of predictions, leading to challenges in generalizability. By adhering to FHIR protocols and leveraging the OMO\u03a1 common data model, our system aims to bridge the differences and facilitate seamless integration regardless of the underlying EHR infrastructure. We have tested our pipeline on Epic through the \"EPIC on FHIR\" interface and confirmed its integration.\nMoreover, inherent biases in the training data (such as social and measurement biases) or feature-matching processes could affect its performance. Additionally, while the model's FHIR compatibility facilitates user accessibility and integration with EHR systems, the long-term usability and acceptance of our application among healthcare providers and patients would require further evaluation and refinement to ensure effective adoption in clinical practice and maintain positive net benefit. The issue of a performance drop and effective implementation of \"continual learning\" approaches is an important consideration that applies to all AI-based CDS tools.\nFinally, long-term prediction of pediatric obesity may pose additional challenges due to potential shifts in the underlying data patterns over time. Factors such as evolving healthcare practices, changes in patient demographics, and advancements in medical technologies could introduce variability in the predictive performance of the model over extended periods. Consequently, continuous monitoring and recalibration of the models may be necessary to ensure the reliability and accuracy of the models in forecasting obesity risk in children over an extended period."}, {"title": "Acknowledgments", "content": "Our study was supported by the NIH award U54-GM104941 and computing credits from Amazon Web Services (AWS). We would like to acknowledge significant support from Haritima Manchanda (U. Delaware), Matthew Mauriello (U. Delaware), Levon H Utidjian (CHOP), Daniel Eckrich (Nemours), and all PCPs who helped us in developing our pipeline."}, {"title": "Appendix A. Dataset Demographics", "content": "Table A shows the distribution of some of the demographic variables in the utilized dataset."}, {"title": "Appendix B. Extended Results", "content": "Additional results related to performance across temporal (different years), geographical (two different regional sites), and various subgroups (as determined by gender, race/ethnicity, and insurance type), as well as net benefit analysis, are shown in Table 4 and Figure 5.\nWe validated our model temporally and geographically and studied the model's performance across subpopulations (which can also capture the model's fairness across these groups) using separate test datasets. When using the entire cohort, the data was split with an 80:20 train and test regime, with 5% of the training data as a validation set to fix the best model. Model performance was reported exclusively on the test dataset. The confidence intervals (CIs) for the classification task are calculated using 100 bootstrapped replicates. For the regression task, we used conformal prediction."}, {"title": "Appendix C. TAM Questionnaire", "content": "Based on a Likert scale applied to each set of questions, please respond on how strongly you agree or disagree with these statements about the early childhood obesity prediction tool."}, {"title": "Appendix D. Interview Guide for User Testing of Obesity Prediction Tool", "content": "D.1. Introduction\nIf e-consent is conducted right before a session, then this part can be skipped.\nHi, thank you for taking the time to meet with me. As a reminder, during this session you will be asked to use a prototype of an electronic clinical decision support tool that will give you an estimate of a patient's risk of obesity. The tool uses machine learning models and data from the electronic health record to predict an individual patient's risk of developing obesity over the next three years. Because we know that early identification of obesity risk is critical but often challenging, we have designed the tool to predict obesity risk in children under the age of seven.\nDuring this session, we'll show you the prototype tool and ask that you describe everything you are thinking and doing as you navigate using the tool. We are not testing you or your knowledge. We're testing how easy or hard it is to use the tool. At the end of the session, we will ask you a few additional questions about the tool and how useful it is. Keep in mind, this is not the final version and we are interested in getting feedback for how to improve the tool.\nThis session should be 30-60 minutes long and will be recorded. We will delete any personal information from our transcript of the recording and will delete the recording after the study is complete. As a reminder, this is completely voluntarily so we can stop at any point and you don't have to answer any question that you are uncomfortable with. You will receive a $50 dollar gift card after completing the session."}]}