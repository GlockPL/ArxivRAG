{"title": "PaMMA-Net: Plasmas magnetic measurement evolution based on data-driven incremental accumulative prediction", "authors": ["Yunfei Ling", "Zijie Liu", "Jun Du", "Yao Huang", "Yuehang Wang", "Bingjia Xiao", "Xin Fang"], "abstract": "An accurate evolution model is crucial for effective control and in-depth study of fusion plasmas. Evolution methods based on physical models often encounter challenges such as insufficient robustness or excessive computational costs. Given the proven strong fitting capabilities of deep learning methods across various fields, including plasma research, this paper introduces a deep learning-based magnetic measurement evolution method named PaMMA-Net (Plasma Magnetic Measurements Incremental Accumulative Prediction Network). This network is capable of evolving magnetic measurements in tokamak discharge experiments over extended periods or, in conjunction with equilibrium reconstruction algorithms, evolving macroscopic parameters such as plasma shape. Leveraging a incremental prediction approach and data augmentation techniques tailored for magnetic measurements, PaMMA-Net achieves superior evolution results compared to existing studies. The tests conducted on real experimental data from EAST validate the high generalization capability of the proposed method.", "sections": [{"title": "1. Introduction", "content": "Fusion energy presents three major advantages: abundant reserves, minimal environmental impact, and a high degree of safety, making it the ideal energy source for humanity. One of the most important ways to achieve controlled fusion is to generate and confine high-temperature plasma through tokamak devices [1]. The continuous development of numerical simulation methods for fusion plasmas in recent decades has demonstrated that establishing a model capable of accurately describing plasma behavior under the control of tokamak devices is crucial for a better understanding and control of plasma dynamics. The integration of numerical simulations, theoretical analyses, and experimental measurements facilitates the verification of the feasibility of tokamak experimental configurations, the development of advanced tokamak operational modes, and the effective control of plasma behavior.\n\nThe evolution methods for fusion plasmas could be categorized into two approaches: physics-driven methods and data-driven methods [2]. Physics-driven methods entail partial differential equations, sophisticated numerical methods, and simplifying assumptions. Data-driven methods, on the other hand, primarily consist of empirical equations and deep learning techniques. Physics-driven methods boast excellent interpretability, but for first-principles models, their accuracy hinges on the completeness of the physical processes involved, making it challenging to strike a balance between efficiency and precision. When efficiency is constrained, it becomes difficult to account for all physical phenomena comprehensively. In contrast, data-driven methods generally feature models and numerical methods of lower complexity, resulting in faster computation speeds. Furthermore, as data-driven methods are grounded in raw data, they could inherently accommodate a broader range of physical phenomena.\n\nDeep neural networks, as a data-driven approach to modeling complex parametric relationships, have made significant progress in the last decade. Especially since the Transformer architecture [3] has been proposed and extensively studied, deep neural networks have achieved impressive results in time series modeling and prediction. It has been widely used in many fields, such as natural language generation [4], sequence prediction in scenarios like power [5], finance [6], etc. In the field of plasma control, deep neural networks have also been applied in many research directions. Such as disruption prediction [7], equilibrium reconstruction [8], discharge prediction [9]. It is generally believed that deep neural networks, takes advantage of their strong generalization, could produce better predictions than physical models. By self-supervised training on rich experimental data, deep neural networks can be generalized to some unseen experimental configurations.\n\nCompared to univariate, time-independent regression tasks, the long-sequence plasma magnetic measurement evolution is a significantly more challenging problem. It demands high precision in modeling the plasma response and requires capturing long-range dependencies with strong generalization ability. Both the inputs and outputs involve multiple modalities, each with a wide dynamic range and substantial"}, {"title": "2. Related work", "content": null}, {"title": "2.1. Physics-driven plasma modeling", "content": "Physics-driven models are typically integrated versions of first-principles-based physical models [10], which often employ separate modules to address sub-problems such as equilibrium reconstruction [11, 12], refinement [13, 14], and linear MHD stability calculations [15,16]. However, the accuracy of these methods hinges on the completeness of the involved physical processes, posing a challenge in balancing efficiency and precision. Specifically, when prioritizing efficiency, it becomes difficult to encompass all physical phenomena. Conversely, excessive simplification of the model and overly"}, {"title": "2.2. Data-driven plasma modeling", "content": "In recent years, data-driven methods have been extensively applied to various plasma modeling tasks, including disruption prediction [17-19], electron temperature profile estimation [20], discharge estimation [21, 22], last closed-flux surface evolution [23], equilibrium reconstruction [8, 24], control plasma [25, 26], reinforcement learning-informed magnetic field control [27,28] and instability avoidance [29].\n\nAs a field dedicated to studying the temporal relationships among variables, time series forecasting has already provided some effective modeling approaches for data-driven plasma modeling. LSTM [30], TCN [31] and DeepAR [32], Timesnet [33] use CNNs and RNNs to predict future trends. MLP-based models such as N-HiTS [34], N-BEATS [35], NLinear [36], and DLinear [36] maintain high accuracy even with fewer parameters. Due to the breakthrough in computer vision and natural language processing, Transformer-based models have also seen widespread adoption in TSF. Informer [37], FEDformer [38], Autoformer [39], and PatchTST [40], itransformer [41] are able to effectively capture key information in the sequence to significantly improve accuracy.\n\nIt is noteworthy that the magnetic measurement evolution task defined in this paper can be categorized as a multi-horizon forecasting task [42] because some relevant future inputs are already known when predicting future sequences. Such tasks require modeling the relationship among the future sequence, the observed sequence and known future inputs simultaneously."}, {"title": "3. Methodology", "content": null}, {"title": "3.1. Magnetic measurements evolution", "content": "Typically, Tokamak discharge experiments measure the magnetic field intensity and flux at specific locations using pickup coils and flux loops. Subsequently, the magnetic flux in all regions of the vacuum chamber is calculated using equilibrium reconstruction algorithms [43]. Finally, based on the magnetic field data, the coil currents are controlled in real-time to maintain the plasma state according to control objectives. In alignment with this standard procedure, the plasma magnetic measurement evolution model defined in this paper does not directly predict the magnetic flux in all regions. Instead, it simulates the measurement process of Tokamak discharge experiments: predicting future sensor measurements based on a segment of observed data and the coil currents throughout the experiment. This task design offers two key advantages: it avoids introducing additional errors from the equilibrium reconstruction process, and it more directly simulates the experimental measurement process, thereby facilitating integration with other Tokamak simulation algorithms."}, {"title": "3.1.1. Task definition", "content": "In the context of data-driven multivariate regression, the magnetic measurement evolution task begins with the collection of a dataset, which comprises K independent time series $U^{(k)} \\in \\mathbb{R}^{C\\times T_k}$. Each time series encapsulates a complete discharge experiment, characterized by $T_k$ time-steps and C signal channels, denoted by $U^{(k)} = {u_1^{(k)},..., u_{T_k}^{(k)}}$, $u_t^{(k)} = {u_1,...,u_c} \\in \\mathbb{R}^C$. Notably, the number of signal channels remains constant across all series, whereas the number of time-steps may vary. The signal channels are categorized into two groups: the first D channels, referred to as magnetic measurement or state signals $y_t = {u_1, ..., u_D} \\in \\mathbb{R}^D$, and the remaining E channels, designated as control signals $z_t = {u_p, ..., u_c} \\in \\mathbb{R}^E$.\n\nFor any given time t, the signals preceding it are designated as the observed signals $X_{t-M-1:t} = {u_{t-M-1},\u2026\u2026, u_t} \\in \\mathbb{R}^{C\\times M}$, the subsequent magnetic measurement signals constitute the evolution target $Y_{t+1:t+N} = {y_{t+1}, ..., y_{t+N}} \\in \\mathbb{R}^{D\\times N}$, and the subsequent control signals are termed known future inputs $Z_{t+1:t+N} = {z_{t+1}, \u2026\u2026\u2026, z_{t+N}} \\in \\mathbb{R}^{E\\times N}$, where M is the length of the observed input, N is the length of the evolution result. In subsequent chapters, M and N are assigned values of 1000. The objective of the magnetic measurement evolution task is to predict the evolution target based on the observed input and known future input. Hence, the task could be defined as:\n\n$Y_{t+1:t+N} = f(X_{t-M-1:t}, Z_{t+1:t+N})$\n\nwhere $Y_{t+1:t+N}$ is the predicted output of the future N steps, $f(.)$ represents the proposed PaMMA-Net."}, {"title": "3.1.2. Input and output variables", "content": "Detailed input and output signals used by our model and their number of channels are shown in Table 1. Where the subscript :t of BP:t and FL:t indicates that the prediction starts at time t, and the observed signals referring to signals prior to time t. The subscript t: denotes signals that are predictions for future measurements. As for the known future inputs without a time subscript, they are known at any given moment. The model utilizes these signals while ensuring causality is maintained.\n\nIn accordance with the task definition outlined in the previous section, this paper adopts a total of C = 90 signal channels. The magnetic measurements consist of 37-dimensional BP signals and 35-dimensional FL signals, amounting to D = 72 signal channels in total. The known future inputs encompass PCS commands and several macroscopic signals, totaling E = 18 signal channels. This selection is made with the intention of utilizing the minimal number of signals necessary to achieve plasma evolution, thereby facilitating the construction of a highly generalized evolution model for magnetic measurements."}, {"title": "3.2. PaMMA-Net", "content": "This paper introduces PaMMA-Net, which imposes additional supervision on the increments of evolution targets and efficiently models the relationship between magnetic"}, {"title": "3.2.1. Incremental accumulative prediction", "content": "The term \"increment\u201d refers to the temporal difference of the prediction target, denoted $\\Delta y_t$. Our model first predicts the increment and then, through a non-parametric accumulation layer, converts the increment back to the prediction target. Both the increment and the predicted"}, {"title": "3.2.2. State fusion prediction", "content": "As defined in Sec. 3.1, the proposed evolution model incorporates observed magnetic measurements as input, thereby implicitly modeling the relationships among various signal channels and furnishing an initialization for incremental prediction. However, this state fusion design results in a difference in the number and physical meanings of input channels before and after time t. The crucial challenge lies in unifying these into a format that can be processed by the attention module. The method adopted in this paper could be defined by the following equations:\n\n$h^S = Concat(MLP^S(X_t), X_t) + PE_t$\n\n$h^C = Concat(MLP^C(X_{t+}), X_{t+}) + PE_t$\n\n$H^0 = Concat(H^S, H^C)$\n\nwhere $H^S = {h_{-M-1}, \u2026\u2026\u2026, h_{t+N}} \\in \\mathbb{R}^{d_A\\times M+N}$, $H^C = {h_{-M-1},..., h_{t+N}} \\in \\mathbb{R}^{d_A\\times M+N}$, $d_A$ is the projected dimension. The superscript 0 of $H^0$ denotes the input of the first transformer layer. The superscript S and C are used to distinguish state fusion embedding and PCS command embedding. PE is the result of position embedding.\n\nAs described by Eq. 3, two embedding layers with the same basic components but independent parameters are designed, named state fusion embedding and PCS command embedding, to process the heterogeneous observed signals and known inputs. Both embedding layers incorporate token embedding and position embedding. Token embedding employs an MLP layer to tokenize the preprocessed and data-augmented inputs into tokens required for subsequent decoder layers. Specifically, to preserve the original features, the input is concatenated with the output of the MLP layer. An MLP is used here because, in this task, the data across different channels are strongly coupled. Due to its fully connected nature across all feature dimensions with relatively few parameters, an MLP could better explore inter-channel relationships. In contrast, convolutional-based embeddings have a smaller receptive field. Position embedding"}, {"title": "3.2.3. Variable separated projection", "content": "After the decoder layers, a special mapping layer is placed, referred to the variable separated projection. It is defined as follows:\n\n$\\hat{y}_t = Concat(MLP^{BP}(h), MLP^{FL}(h))$\n\nThe projector takes into account the different modalities of BP and FL, applying parameter separated projections to them. Two distinct MLP layers form the variable separation projector. Both of their inputs stem from the outputs of the decoder layers, but their outputs separately model the relationships between BP, FL, and the latent variables. Compared to directly using a wider fully connected layer, the variable separated projection utilizes fewer parameters and achieves faster convergence. An alternative, more radical design is the channel separated projection, which adopts parameter separated projections for each signal channel. However, in the context of our task, since the channels within BP and FL are highly coupled, the channel separated projection does not provide significant performance gains compared to the substantial computational overhead it incurs."}, {"title": "3.3. Physically consistent data augmentation", "content": "Considering the high cost of the Tokmak discharge experiment, this paper delves into a data augmentation approach grounded in simple rules, aiming to enrich signal diversity while serving as a regularization technique to mitigate the risk of model overfitting."}, {"title": "4. Experiment", "content": null}, {"title": "4.1. EAST magnetic measurements dataset", "content": "By screening the discharges with longer durations and higher sampling frequencies no from EAST experiments conducted between #117823 and #141775, two datasets were compiled in this study. The larger dataset, comprising 7671 shots for training, 199 shots for validation, and 830 shots for testing, was utilized to ascertain the model's evolutionary capability. The smaller one, consisting of 1000 shots for training, 50 shots for validation, and 100 shots for testing, was designated for an ablation study. Notably, the larger dataset encompasses the smaller one. The sampling rates per shot ranged from 500 to 10000 Hz, while the sampling durations varied between 5 and 50 seconds.\n\nFurthermore, we have conducted a more granular segmentation of the dataset, dividing it into four mutually exclusive subsets based on two criteria: whether it is disruptive and whether it is in H-mode. When allocating the training set, validation set, and test set, we ensured that the proportions of these four types of data remained largely consistent, thereby mitigating the risk of overfitting.\n\nBefore entering the model, we preprocessed the data as follows: In order to deal with inconsistent sampling frequency, we use linear interpolation method for up-sampling or"}, {"title": "4.2. Experimental configuration", "content": "After obtaining the preprocessed and augmented data, we proceed with the training using the model and training configurations as outlined in Table 2. The learning behavior of PaMMA-Net is depicted in Fig. 4."}, {"title": "4.3. Forecasting result", "content": "In this section, we first demonstrate the model's measurement-to-measurement prediction capability through a detailed statistical analysis of the prediction results for all shots in the test set. Subsequently, we illustrate the performance enhancements attributed to our model design by comparing it with several advanced deep learning models."}, {"title": "4.4. Ablation study", "content": "We conducted ablation experiments to validate the effectiveness of our proposed method. As shown in Table 4, we first tested the model's performance using the complete method. Subsequently, we sequentially removed data augmentation, incremental design, positional embedding, and normalization to observe their individual contributions. Notably, data augmentation led to comprehensive performance improvements, particularly a 10% relative reduction in MAE. The incremental design significantly enhanced performance on a higher baseline, with an approximate 1.5% increase in Sim and a 49% decrease in MAE. Positional embedding, a widely adopted technique, also demonstrated performance gains in the regression task of discharge"}, {"title": "4.5. Case study", "content": "In this section, the predictive capability of the model is intuitively demonstrated by showcasing its predictions on an entire shot. Although the maximum length for a single inference of the proposed model is limited to 1000 time steps, the entire shot prediction could be obtained by employing a sliding window on real experimental data and concatenating the prediction results (hereinafter referred to as the non-autoregressive prediction method). Fig. 6 presents an illustrative example of this process.\n\nFig. 6 presents examples of magnetic measurement evolution using the PaMMA-Net for discharge # 125323 and # 120446. Each case comprises four subplots, where three depict BP for different channels, and one showcases FL for a specific channel. In each subplot, the horizontal axis represents time, while the vertical axis denotes the measured values. The yellow line represents the experimental data, and the blue line indicates the model's predictions. Firstly, a notable advantage of the proposed surrogate model is its capability to predict the entire shot, encompassing both the rising and falling phases. In contrast, some response models are limited to predictions within the flat-top phase, thereby highlighting that the proposed model offers a more comprehensive predictive insight. Secondly, beyond matching the real values in overall trends, the model also exhibits proficiency in predicting abrupt changes during the flat-top phase. This is primarily attributed to the model's establishment of a relationship between real-time inputs and magnetic measurements, effectively reflecting mutations in real-time inputs into the magnetic measurements.\n\nTo showcase the details, only representative channels from the total 72 channel outputs are plotted here. The full-channel prediction results of the model across more shots are presented in the appendix."}, {"title": "4.6. Auto-regressive evolution", "content": "In this section, we explore the model's capability to predict the entire shot using an autoregressive approach. This means that the model can predict all subsequent magnetic measurements solely based on the initial 1000ms of probe signals during the rising phase. Of course, the known inputs, which include macroscopic variables and control variables, is provided in real-time. This is no different from the input required for traditional equilibrium evolution. An example of the model's autoregressive prediction result for the entire shot is shown in Fig. 8, which displays the prediction results for four channels.\n\nAlthough our model has not undergone additional optimization for autoregressive prediction, we have found that its performance in predicting the entire shot using an autoregressive approach is acceptable. While the results are somewhat inferior to those obtained through non-autoregressive prediction, especially beyond 2000ms, the"}, {"title": "5. Conclusion", "content": "In this paper, PaMMA-Net is proposed for tokamak magnetic measurement evolution. By integrating knowledge from plasma physics and deep learning, innovative incremental design and data augmentation methods are introduced to effectively enhance the performance of evolution. When compared with various classical network architectures, PaMMA-Net achieves the best evolutionary results. The model's single-step inference capability implies its potential for offline interaction with controllers."}]}