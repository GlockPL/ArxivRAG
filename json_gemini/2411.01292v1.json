{"title": "CAUSAL REASONING IN DIFFERENCE GRAPHS", "authors": ["Charles K. Assaad"], "abstract": "In epidemiology, understanding causal mechanisms across different populations is essential for de- designing effective public health interventions. Recently, difference graphs have been introduced as a tool to visually represent causal variations between two distinct populations. While there has been progress in inferring these graphs from data through causal discovery methods, there remains a gap in systematically leveraging their potential to enhance causal reasoning. This paper addresses that gap by establishing conditions for identifying causal changes and effects using difference graphs and observational data. It specifically focuses on identifying total causal changes and total effects in a nonparametric framework, as well as direct causal changes and direct effects in a linear context. In doing so, it provides a novel approach to causal reasoning that holds potential for various public health applications.", "sections": [{"title": "1 Introduction", "content": "In epidemiology, it is critical to understand the causal mechanisms that impact health outcomes across diverse popula- tions, which may differ based on geographic location, socioeconomic status, genetic predispositions, or environmental exposures. Recently, difference graphs have been introduced to represent differences between two Structural Causal Models (SCMs) [Pearl, 2009], with each model corresponding to a distinct population. These graphs offer a refined representation to visually compare and analyze the causal variations between these groups. By clearly delineating these causal differences, epidemiologists can tailor public health policies and interventions more effectively to address the unique needs of each population. Moreover, it has been highlighted that such graphs are particularly effective for root cause analysis, as noted in [Malik et al., 2024]. This utility is especially evident within the framework proposed by [Assaad et al., 2023], which identifies root causes by comparing direct effects under normal conditions to those under anomalous conditions.\nRecently, there has been a surge of interest in constructing difference graphs directly from data through methods rooted in causal discovery [Wang et al., 2018, Malik et al., 2024, Bystrova et al., 2024]. The simplest approach involves inde- pendently discovering the SCM for each of the two populations and then computing the difference graph. However, a more effective strategy has emerged that involves directly constructing the difference graph, bypassing the two SCMS that define it [Wang et al., 2018, Malik et al., 2024, Bystrova et al., 2024]. This approach reduces the need for strin- gent assumptions commonly associated with causal discovery [Spirtes et al., 2000, Glymour et al., 2019]. Despite these advancements, an evident gap remains in the existing literature: there has been no systematic investigation into how difference graphs themselves can facilitate or enhance the process of causal reasoning. This oversight presents a unique opportunity to explore the potential of difference graphs as a tool not just for representation but also for driving identifiability of causal changes and causal effects.\nTo bridge this gap, this work establishes both sufficient and necessary conditions for identifying total causal changes and total effects in difference graphs within nonparametric models, under the assumption of no hidden confounding. Additionally, this work provides sufficient and necessary conditions for identifying direct causal changes and direct effects in difference graphs within linear models, under the assumption of no hidden confounding. Initially, both results are presented under the assumption that the two causal graphs, induced by the two SCMs defining the difference graph, share the same topological ordering. These results are then extended to accommodate cases where the graphs have different topological orderings."}, {"title": "2 Difference graphs, causal changes, and causal effects", "content": "In the following, uppercase letters represent variables and lowercase letters represent their values, while letters in blackboard bold denote sets.\nThis study utilizes the framework of structural causal models (SCMs) introduced by [Pearl, 2009]. Formally, an SCM M is defined as a 4-tuple $(\\mathcal{U}, \\mathcal{V}, \\mathcal{F}, P(\\mathcal{U}))$, where $\\mathcal{U}$ represents a set of exogenous (latent) variables and $\\mathcal{V}$ denotes a set of endogenous (observed) variables. The set $\\mathcal{F}$ consists of functions $\\{f_i\\}$, where each endogenous variable is determined by a function $f_i \\in \\mathcal{F}$ that depends on both a subset of exogenous variables and a subset of endogenous variables (which are also called the direct causes or the parents). In a linear SCM, $f_i$ is a linear equation where each coefficient is called path coefficient [Wright, 1920, 1921] and it designates a direct effect. The following assumption regarding exogenous variables is made throughout the paper.\nAssumption 1. All exogenous variables are mutually independent, i.e., no hidden confounding.\nConsistent with common practice in causal inference, it is also assumed that each SCM M induces a causal graph $G = (\\mathcal{V}, E)$ which is assumed to be a directed acyclic graph (DAG). For clarity, any causal graph that is a DAG will be referred to as a causal DAG. In this graph, $\\mathcal{V}$ represents the set of vertices, each corresponding to a random variable, and $E$ includes the directed edges, with each edge $X \\rightarrow Y$ indicating a causal relationship between X and Y. For any graph $G = (\\mathcal{V}, E)$, standard terminology is adopted to describe relations to any vertex $Y \\in \\mathcal{V}$: Parents$(Y, G)$ denotes the set of vertices from which there is a direct edge to Y; Ancestors$(Y,G)$ refers to the collective set including Y and the parents of all vertices that can be recursively traced back from Y; Descendants$(Y,G)$ comprises all vertices X for which Y is found within Ancestors$(X,G)$. If a path contains the subpath $X \\rightarrow W \\leftarrow Y$, then W is a collider on the path. A path from X to Y is considered active given a vertex set W, where neither X nor Y are in W, if every non-collider on the path is not in W, and every collider on the path has a descendant in W. Otherwise, the path is blocked by W. It is important to note that many SCMs can induce the same causal DAG, meaning that a causal DAG can be compatible with many probability distributions.\nIn epidemiology, it is critical to understand the causal mechanisms that impact health outcomes across diverse popula- tions, which may differ based on geographic location, socioeconomic status, genetic predispositions, or environmental exposures. Recently, difference graphs have been introduced as a tool to represent the differences between two SCMs, each corresponding to a distinct population, offering a refined method to visually compare causal variations between these groups.\nDefinition 1 (Difference graphs). Consider an unordered pair of SCMs $(M\u00b9 = (\\mathcal{V}, \\mathcal{U}, \\mathcal{F}^1, Pr^1), M\u00b2(\\mathcal{V}, \\mathcal{U}, \\mathcal{F}^2, Pr^2))$ that respectively induce the two causal DAGs $G\u00b9$ and $G\u00b2$ and that are respectively compatible with the two distributions $Pr^1(v)$ and $Pr^2(v)$. A difference graph $D = (\\mathcal{V}, [E|^{1-2}|)$ between $M\u00b9$ and $M\u00b2$ is a directed graph where the set of vertices is identical of the set of endogenous variables in $M\u00b9$ and $M\u00b2$ and the set of edges is defined as follows:\n$[E|^{1-2}| := \\{X \\rightarrow Y |\\forall X,Y \\in \\mathcal{V} \\text{ if the direct effect of X on Y in } M\u00b9 \\text{ is different than the direct effect' of X on Y in} M\u00b2, \\text{i.e., if there is a mechanism change [Tian and Pearl, 2001] at Y with respect to X.}\\$\nNote that multiple unordered pairs of SCMs can define the same difference graph. In Definition 1, difference graphs are defined using SCMs rather than causal DAGs because causal variations may not always be structurally evident by comparing the two causal DAGs, since changes are often parametric rather than structural. That said, Figures 1 and 2, feature six examples of difference graphs ((c), (h), (m) in Figure 1 and (c), (f), (k) in Figures 2) along with pairs of causal DAGs on both side of each difference graph that can also define the same difference graph (indicating structural differences between the two populations). This selection was made intentionally in order to make the concept of difference graphs visually clearer and easier to understand. Nonetheless, it is important to remember that the theoretical results of this paper apply even when the difference between the two populations is not structurally apparent. However, all those results are grounded in the following assumption regarding the distributions that are compatible with the difference graph.\nAssumption 2. $Pr\u00b9(v)$ and $Pr\u00b2(v)$ are positive distributions.\nAs shown in Figure 2, generally, there is no inherent necessity to impose similarity constraints on two causal DAGs and thus difference graphs can contain cycles. However, to make the results of this paper more comprehensible and"}, {"title": "Causal reasoning in difference graphs", "content": "This work considers two types of causal changes: total causal change and direct causal change, also referred to as mechanism change [Tian and Pearl, 2001]. The total causal change of X on Y is defined as the difference between the total effect of X on Y in M\u00b9 and the total effect of X on Y in M\u00b2. In a nonparametric setting, the total effects is a specific functional of the interventional distribution $Pr(Y = y | do(X = x))$ (where the do() operator represents the intervention) for different values of x. However, for simplicity, the total effect is often reffered to as $Pr(Y = y | do(X = x))$ and by a slight abuse of notation, in the remainder, the total effect will be denoted as $Pr(y | do(x))$. Similarly, the direct causal change is the difference between the direct effect of X on Y in M\u00b9 and the direct effect of X on Y in M\u00b2. In a nonparametric setting, the direct effect can be defined as a specific functional of $Pr(y | do(x), do(S_{X,Y}))$ for different values of x, known as the controlled direct effect [Pearl, 2009], where $S_{X,Y}$ represents the set of all observed variables in the system except X and Y. The controlled direct effect of X on Y is not uniquely defined as it can change with respect to the values of $S_{X,Y}$ (some variables in $S_{X,Y}$ are known as effect modifier). For instance, the direct effect of a pill on thrombosis is likely different for pregnant and non-pregnant women [Pearl, 2009]. However, in a linear SCM, i.e, $\u2200 f_i \u2208 F f_i$, is a linear function, the direct effect, obtained through differentiation, corresponds to the familiar path coefficient $a_{x,y}$ [Wright, 1920, 1921], which, unlike the non- parametric controlled direct effect, is uniquely defined. Therefore, in this work, whenever direct effect is discussed, it will refer specifically to linear SCMs.\nSince the total causal change of X on Y is a functional of the total effect, $Pr(y | do(x))$, and the direct causal change is a functional of the direct effect, $a_{x,y}$, the total causal change is identifiable if the total effect is identifiable, and likewise, the direct causal change is identifiable if the direct effect is identifiable. Therefore, the focus of the remainder of this paper is to establish the identifiability of both the total and direct effects using difference graphs. We begin by providing a general definition of the identifiability of causal effects using difference graphs, which is adapted from the definition given by Pearl [2009] for the identifiability of causal effects using causal DAGs.\nDefinition 3 (Causal effect identifiability using difference graph). Let X and Y be distinct vertices in a difference graph $D = (\\mathcal{V}, E|^{1-2}|)$. The causal effect Q of X on Y is identifiable in D if Q is uniquely computable from any observational distributions consistent with D.\nGiven a causal DAG, it is possible to identify $Pr(y | do(x))$ using the back-door criterion and to identify $a_{x,y}$ using the single-door criterion which is only applicable in a linear setting.\nDefinition 4 (Back-door criterion, Pearl [1995]). A set of variables W satisfies the back-door criterion relative to the total effect $Pr(y | do(x))$ in a causal DAG G if $\u2200W \u2208 W, W \\notin Descendants(X,G)$ and W blocks every path between X and Y which contains an arrow into X.\nDefinition 5 (Single-door criterion, Spirtes et al. [1998], Pearl [1998, 2009]). A set of variables W satisfies the single- door criterion relative to the direct effect $a_{x,y}$ in a causal DAG G if $\u2200W \u2208 W, W \\notin Descendants(Y,G)$ and W blocks every path between X and Y.\nWhenever there is a set W that satisfied the back-door criterion in a causal DAG, $Pr(y | do(x))$ is given by the adjsutment formula $\\sum Pr(y | x, w) Pr(w)$. Whenever there is a set W that satisfied the single-door criterion in a causal DAG, $A_{x,y}$ is given by the regression coefficient of X on Y after Wanc is partialled out.\nSince this work focuses on difference graphs, the first objective is to identify a set that satisfies the back-door criterion across all causal DAGs compatible with a given difference graph when estimating the total effectif such a set exists, the total effect is said to be identifiable by a common back-door. Similarly, the second objective is to find a set that satisfies the single-door criterion across all compatible causal DAGs when estimating the direct effect if such a set exists, the direct effect is said to be identifiable by a common single-door. However, these goals cannot be acheived by applying the back-door and single-door criteria directly to difference graphs, even when the difference graph is acyclic. For example, in the difference graph shown in Figure 1 (m), the sets \u00d8, {$W\u2081$}, {$W2$}, and {$W1, W2$} all satisfy the back-door criterion for the total effect $Pr(y | do(x))$. But when examining the pair of causal DAGs in (k) and (l) that are compatible with this difference graph, it becomes clear that W\u2081 is necessary and W2 must be excluded from any set that satisfies the back-door criterion, ruling out the empty set and {$W2$}. Additionally, by looking at another pair of causal DAGs in (n) and (o), it becomes evident that in this case, {$W2$} is required for the back-door criterion to hold. This illustrates that, in this example, no single set satisfies the back-door criterion for every causal DAG compatible with the difference graph. Similarly, for the difference graph in Figure 1 (h), the sets \u00d8, {$W\u2081$}, {$W2$}, and {$W1, W2$} all satisfy the single-door criterion for the direct $A_{x,y}$. However, the pair of causal DAGs shown in (f) and (g), both W\u2081 and W2 are needed in any set that satisfies the single-door criterion, whereas in the pair of causal DAGs shown in"}, {"title": "3 Identification of total effects using difference graphs in a nonparametric setting", "content": "This section first presents conditions for identifying total effects using difference graphs in a nonparametric setting under Assumption 3 and then generalizes this result by relaxing the assumption.\nTheorem 1. Consider a difference graph D compatible with two different SCMs. Under Assumptions 1, 2 and 3, Pr(y| do(x)) is identifiable in D by a common back-door if and only if:\nA.1 Y \u2208 Ancestors(X,D); or\nA.2 X \u2208 Ancestors(Y,D) and $\u2200W \u2208 V\\{X, Y\\}, X \u2208 Ancestors(W,D) or W \u2208 Ancestors(X,D)$.\nFurthermore, if Condition A.1 is satisfied then Pr(y | do(x)) = Pr(y) and if Condition A.2 is satisfied then Pr(y |\ndo(x)) = $\\sum_{wanc} Pr(y | x, w_{anc}) Pr(w_{anc})$, where $W_{anc}$ = Ancestors(X,D)\\{X}.\nProof. Lemmas 3.1 and 3.2 respectively prove that Conditions A.1 and A.2 are sufficient for identifiability and\nLemmas 3.1 and 3.3 prove that they are also necessary.\nBefore delving into the four lemmas that form the foundation of the proof for Theorem 1, it is important to highlight the key implications of the theorem. The theorem provides conditions under which the total effect can be identified in difference graphs by a common back-door. The identification of these total effects hinges on the structural properties of the difference graph.\nIn particular, when there is no directed path between the variables of interest\u2014either from X to Y or from Y to X-as seen in the difference graph in Figure 1 (c), the absence of such a connection creates ambiguity in the directionality of the total effect. This is illustrated by the pair of causal DAGs in (a) and (b), where the association between X and Y reflects the total effect of interest, and by the pair in (d) and (e), where the association between X and Y does not correspond to the total effect being sought. Therefore, the total effect cannot be identified using a common back-door. This is an essential point, as it highlights that causal reasoning in difference graphs can appear counterintuitive, with nonexistent directed paths in the difference graph potentially leading to ambiguous causal interpretations. The following lemma builds on this observation and in addition it shows that Condition A.1 of the theorem is sufficient.\nLemma 3.1. Under Assumptions 1, 2 and 3, if there exists a directed path from Y to X then Pr(y | do(x)) = Pr(y) and if there exists no directed path from X to Y or from Y to X in D then Pr(y | do(x)) is not identifiable.\nProof. If there exists a directed path from Y to X then by Assumption 3, there cannot exists a directed path from X to Y, which means that X does not have an effect on Y, i.e., Pr(y | do(x)) = Pr(y). If there is no directed path from X to Y or from Y to X in D then there exists a possible pair of causal DAGs ($G1, G2$) defining D such that X \u2192 Y in $G\u00b9$ and $G2$. In this case Pr(y | do(x)) \u2260 Pr(y). At the same time there exists another possible pair of causal DAGs ($G1', G2'$) defining D such that X \u2190 Y in $G1'$ and $G2'$. In this case, Pr(y | do(x)) = Pr(y).\nCondition A.2 of Theorem 1 can be applied to identify Pr(y | do(x)) in the difference graph shown in Figure 1 (h), as W\u2081 \u2208 Ancestors(X,D) and X \u2208 Ancestors(W2, D). This implies that for any pair of causal DAGs compatible with the difference graph-such as the pairs depicted in Figures 1 (f) and (g) or Figures 1 (i) and (j)\u2014the set {W\u2081} satisfies the back-door criterion. The following lemma illustrates that Condition A.2 is indeed sufficient for identifiability.\nLemma 3.2. Under Assumptions 1, 2 and 3, if there exists a directed path from X to Y and for each vertex $W\u2208 V\\{X,Y\\}$ there exists a directed path from X to W or from W to X in D, then Pr(y | do(x)) is identifiable in D by a common back-door."}, {"title": "4 Mediation analysis using difference graphs in a linear setting", "content": "This section presents conditions for identifying the direct effect using a difference graph in a linear setting and as in the previous section, it starts by given conditions under Assumption 3 and then generalizes this result by relaxing the assumption.\nTheorem 3. Consider a difference graph D compatible with two different linear SCMs. Under Assumptions 1, 2 and 3, $A_{x,y}$ is identifiable in D by a common single-door if and only if:\nC.1 Y \u2208 Ancestors(X,D); or\nC.2 X \u2208 Ancestors(Y,D) and $\u2200W \u2208 V\\{X, Y\\}, Y \u2208 Ancestors(W,D) or W \u2208 Ancestors(Y,D)$.\nFurthermore, if Condition C.1 is satisfied then $a_{x,y}$ = 0 and if Condition C.2 is satisfied then $a_{x,y}$ = $r_{YX.Wanc}$ where\n$r_{YX.Wanc}$ is the regression coefficient of X on Y after $W_{anc}$ is partialled out."}, {"title": "5 Related works", "content": "There has been extensive research on causal reasoning using graphs that represent families of graphs. For exam- ple, Maathuis and Colombo [2013], Perkovic et al. [2016], Perkovic [2020], Jaber et al. [2022], Wang et al. [2023] extended causal reasoning to partially oriented graphs such as CPDAGs and PAGs. PAGs are similar to CPDAGs but allow for hidden confounding. Both CPDAGs and PAGs represent multiple causal DAGs that share the same skeleton, some common edge orientations, and the same topological ordering. From a different perspective, Iwasaki and Simon [1994], Chalupka et al. [2016], Anand et al. [2023], Assaad et al. [2023], Ferreira and Assaad [2024], Assaad et al. [2024] have examined causal reasoning using cluster graphs, where each vertex represents a cluster of low-level variables. These cluster graphs represent various causal DAGs, with each vertex corresponding to a different low- level variable. Most of these works assumed that the causal DAGs represented by the cluster graphs share the same topological ordering, though some relaxed this assumption. In addition, other works, such as Richardson [1997], Forr\u00e9 and Mooij [2020], have specifically focused on cyclic directed graphs, where vertices do not represent clusters. However, to date, there has been no investigation into causal reasoning using difference graphs. The existing work in the literature cannot be directly applied to difference graphs because the absence of an edge in these graphs has a different interpretation than in other types of graphs."}, {"title": "6 Conclusion", "content": "This paper is the first to explore causal reasoning through the lens of difference graphs. While difference graphs may not be as intuitive as classical causal DAGs for identifying causal effects, this work establishes conditions for identifying total effects in a nonparametric setting and direct effects in a linear setting, directly from the dif- ference graph. These findings also demonstrate that difference graphs can be effectively applied to identify causal changes-specifically, total and direct causal changes\u2014providing a valuable tool for causal inference and root cause analysis in complex systems. For future works, it would be valuable to explore the controlled direct effect and natural direct effect in a nonparametric setting. Additionally, providing conditions for the identifiability of path-specific effects using difference graphs would be an important advancement. This paper focuses on cases where the difference graph is fully specified. However, some algorithms detect only partially oriented difference graphs, making it worthwhile to extend this work to such partially specified graphs. Another open question is the utility of discovering differences in the presence of hidden confounding in real-world applications, as the precise definition of this remains unclear. If it is shown that difference graphs with hidden confounding are useful and can be learned or provided by experts, it will be crucial to investigate the identifiability conditions for these graphs as well."}]}