{"title": "Towards Transparent and Accurate Plasma State Monitoring at JET", "authors": ["A. B\u00fcrli", "A. Pau", "T. Koller", "O. Sauter", "JET Contributors"], "abstract": "Controlling and monitoring plasma within a tokamak device is complex and challenging. Plasma off-normal events, such as disruptions, are hindering steady-state operation. For large devices, they can even endanger the machine's integrity and it represents in general one of the most serious concerns for the exploitation of the tokamak concept for future power plants. Effective plasma state monitoring carries the potential to enable an understanding of such phenomena and their evolution which is crucial for the successful operation of tokamaks.\nThis paper presents the application of a transparent and data-driven methodology to monitor the plasma state in a tokamak. Compared to previous studies in the field, supervised and unsupervised learning techniques are combined. The dataset consisted of 520 expert-validated discharges from the ILW campaigns at JET. The goal was to provide an interpretable plasma state representation for the JET operational space. By leveraging multi-task learning for the first time in the context of plasma state monitoring and disruption prediction, a state- and a sequence-based approach was developed and compared. When evaluated as disruption predictors, a sequence-based approach showed significant improvements compared to the state-based models. The best resulting network achieved a promising cross-validated success rate when combined with a physical indicator and accounting for nearby instabilities. Furthermore, it closely matched the cumulative warning time distribution of the ground truth, showing potential for disruption prevention. Qualitative evaluations of the learned latent space uncovered operational and disruptive regions as well as patterns related to learned dynamics and global feature importance.\nThe applied methodology provides novel possibilities for the definition of triggers to switch between different control scenarios, data analysis, and learning as well as exploring latent dynamics for plasma state monitoring. It also showed promising quantitative and qualitative results with warning times suitable for avoidance purposes and distributions that are consistent with known physical mechanisms.", "sections": [{"title": "1. Introduction", "content": "Phenomena such as plasma disruptions pose a serious risk to the structural integrity of tokamak devices and may also force long maintenance interventions which could significantly reduce the device availability [2]. To mitigate or avoid disruptions, a specific and often unknown sequence of actions is required. The particular sequence of actions is defined in the complex framework of disruption prevention and exception handling, which is at the basis of modern plasma control systems. Therefore, the development of effective plasma state monitoring techniques is essential for further exploration, physics understanding, and improvement of the operational regions of fusion devices [3].\nSupervised machine learning and more re-cently also deep learning methods have demon-strated remarkable capabilities in extracting and processing complex patterns from various types of data [4]. This establishes them as promising approaches for plasma state mon-itoring related tasks such as disruption pre-vention in nuclear fusion research [5, 6, 7, 8, 9]. However, these supervised learning tech-niques often suffer from the so-called \"black box\" problem, where the inner workings and decision-making processes of the models are not transparent to the researchers [10, 11]. To overcome these limitations, several unsu-pervised learning techniques have been pro-posed, including manifold learning techniques, such as generative topographic mapping, and variational autoencoders [12, 13]. These tech-niques aim to provide a low-dimensional rep-resentation of the operational space, allowing researchers to qualitatively inspect and under-stand the underlying patterns that drive dis-ruptive events and thus enhance model trans-parency.\nIn this work, we propose a system for plasma state monitoring at JET that integrates supervised as well as unsupervised learning techniques. We define plasma state monitoring as the process of continuously observing and analyzing plasma behavior to detect and predict changes in relevant operational parameters, as well as to further understand the mechanisms that lead to those changes. By leveraging the benefits of both learning paradigms, our approach aims to provide a meaningful representation of plasma states, identifying critical conditions and enhancing the understanding of plasma state evolution in the different operational regions. We consider both state-based and sequence-based models and emphasize their differences by evaluating them as disruption predictors.\nThe remaining sections are organized as follows: Section 2 provides an overview of the employed model architecture as well as the optimization scheme. Section 3 elaborates on the dataset constitution including features selection and preprocessing. Section 4 presents the quantitative results for both the state-and sequence-based approaches. Section 5 qualitatively analyses the learned low-dimensional plasma state representations and studies the projection of unseen discharges. We conclude with a summary and proposed future work."}, {"title": "2. Methodology", "content": "Multitask learning (MTL) is an inductive transfer approach that holds the potential to enhance generalization by using domain-specific information in training signals of related tasks [14]. This is achieved by training tasks simultaneously while using shared representations. As a result, the"}, {"title": "2.1. Architecture", "content": "The employed neural network model follows a general consistent architecture inspired by [13]. Each model consisted of an encoder $q_{\\phi}$ with parameters $\\phi$ that maps the plasma state $x \\in \\mathbb{R}^{F}$ to a latent variable $z \\in \\mathbb{R}^{L}$. The encoded latent state $z$ was further processed by $m$ parallel heads $q_{\\psi m}$ with parameters $\\psi_{m}$ where each one solved a specific task. Let $x_t^i$ be the plasma state at time $t$ of discharge $i$, then\n$Z_t^i \\sim q_{\\phi}(Z \\vert X_t^i)$,\nwhere the encoder $q_{\\phi}$ is called state-based and parameterized the distribution over the possible latent variables as a symmetric Gaussian\n$q_{\\phi} (z \\vert x_t) = \\mathcal{N} (z \\vert \\mu_t^i , (\\sigma_t^i)^2 I)$\nThe latent variable $z$ was sampled from the posterior distribution using the reparame-terization trick [15]. The conditioning variable of the encoding network depends on the model type. If we let the encoder processes a sequence of plasma states\n$\\vec{Z} \\sim q_{\\phi}(\\vec{Z} \\vert \\vec{X}_{-k}, ..., \\vec{X}_t)$,\nthe network is called sequence-based. Where state-based model used an MLP encoder, sequence-based models leveraged an autoregressive transformer encoder with a positional embedding relative to the start of the flat-top phase to learn temporal dependencies efficiently [16] as depicted by Figure 1. To enhance model transparency, the latent space dimensionality was set to $L = 2$ similar to prior work [12, 13]. The choice of the positional embedding on the start of the flat-top is not a constraint, but it allows, for this first demonstrative study, to relax the additional complexity due to the initial time-varying phase of the plasma current ramp-up."}, {"title": "2.2. Tasks", "content": "We focused on four tasks related to plasma state monitoring: disruptivity classification (TDisr), time-to-boundary regression (\u0422\u0442\u0442\u0432), state reconstruction (Trec) and smooth latent trajectory movements (TMov).\nFor disruptivity classification, we relied on a reference warning time similar to [11], described in section 3.1. It was used to generate binary labels for a disruptivity score $P_{disr}$. We used binary cross-entropy $L_{BCE}$ as an objective function for this task. To regress the time-to-boundary quantity, we use a boundary condition $T_B$ determined by considering plasma current ($I_p < 1MA$), ramp-down end ($t > T_{RDE}$), time of the locked mode onset ($t > T_{ML}$), and the time of disruption ($t > T_D$). The relative time $t_{B,rel}$ to $T_B$ served as the target variable. The quantity was clipped to a constant value of ten seconds if it was too large or if the shot experienced a stable ramp down. We utilize a symmetric mean absolute percentage error $L_{SMAPE}$ as an objective function for this task because it penalizes the scale of the error with respect to the scale of the target [17]. Both $T_{Disr}$ and $T_{TTB}$ are supervised tasks, as they rely on supervised labels such as plasma disruptivity and time of disruption.\nFor state reconstruction, the input state $S_t$ is at the same time the target output. We minimize the mean squared error $L_{MSE}$ between the input plasma state and its reconstruction to maximize their similarity. We also introduced a smooth latent movement task that enforced smooth trajectory dynamics for consecutive latent variables of a discharge in the latent space. It was optimized by minimizing\n$L_{Mov} = D_{KL} [\\mathcal{N} (\\mu_t , (\\sigma_t)^2 I) \\vert\\vert \\mathcal{N} (\\mu_{t-1} , (\\sigma_{t-1})^2 I)]$\nwhich encouraged the model to project plasma states that are close in time, to coordinates that are close in the latent space. These two tasks are unsupervised because their objectives are based on plasma measurements and their temporal relationships without incorporating any external knowledge about the disruptivity of the plasma state.\nAdditionally, we employed regularization in the form of a latent space prior similar to [15]. The latent space alignment with a spherical prior\n$L_{Prior} = D_{KL} [\\mathcal{N} (0, 1) \\vert\\vert \\mathcal{N} (\\mu_t^i , (\\sigma_t^i)^2 I)]$\nencouraged the model to learn a contin-uous, spherical, zero-centered state distribu-tion [18]. Through this alignment, plasma state representations that lie on a continuous surface are favored, avoiding the formation of well separated clusters. Individual loss terms were minimized jointly by optimizing over their weighted sum [19]."}, {"title": "3. Dataset", "content": "The dataset used in this work originates from ILW experimental campaigns performed at JET from 2011 to 2022. It contained mea-surements of 520 shots where 322 were disrup-tive and 198 non-disruptive. The discharges were selected to have a statistically significant representation of low and high-power/current plasma scenarios, including base key operation scenarios like the ITER baseline for instance [20, 21, 22]. The resulting distributions of shot numbers and durations were non-uniform for both non-disruptive and disruptive shots. The dataset comprised various diagnostic, includ-ing \"raw\" physics quantities, typically used to describe the plasma states, as well as features engineered to encode specific physics mecha-nisms as described in [12]. Metadata identi-fying shot phases, plasma regime transitions"}, {"title": "3.1. Reference Warning Time Tpredisr", "content": "In addition to the time of specifing events and the time of disruption TD, a special label titled Tpredisr is defined to define the point in time at which the plasma state is considered to diverge from expected trajectory to become disruptive. It lies between the start of the pre-precursor and precursor phase, which are associated with the events leading to the disruption [24]. Derived from expert knowledge, the Tpredisr label is based on the chain of events that ultimately result in a disruption, as described in various studies [24, 23]. It identifies the beginning of the unstable phase for all considered discharges, such that plasma states prior to it are considered stable and disruptive thereafter. The dataset is imbalanced, with a disruptive vs stable state ratio of $\\eta = 0.1725$ when using Tpredisr to mark the start of the unstable phase. The automated labeling of the discharge, including the definition of discharges phases, plasma regime transitions and precursor events is handled thorugh the DEFUSE software supporting, among other things, the construction and validation of the EUROfusion Disruption Database [25]. DEFUSE allows the automated characterization of the chain of events leading to disruptions through physics-based and data-driven models. Statistical analysis and interactive validation tools allow to check the consistency of the automated detections."}, {"title": "3.2. Feature selection and preprocessing", "content": "Table 2 reports the selected set of 14 features which was chosen to describe the plasma state (F = 14), inspired by previous works on disruption prediction [11, 12, 13]. Most of the chosen features are inherently dimensionless, making them device agnostic. Additional discharge metadata was also extracted for preprocessing and target label generation.\nThe domain of analysis described the win-"}, {"title": "4. Results", "content": "We trained state-based as well as sequence-based models for $10^5$ batch updates using the AdamW optimizer [26]. Sequences were sampled with a length of 512 states, thus spanning approximately one second. The transformer model backbone was inspired by the GPT-2 architecture, but using a reduced model dimensionality ($d_{model} = 192$), with only three attention heads (h = 3) and twelve layers, (K = 12) [27] resulting in an order of magnitude less parameters. Disruptive states were resampled uniformly to account for label imbalance such that for each training batch $\\eta \\approx 1$. During training, the Tpredisr label was augmented by a uniform random time shift ($\\pm$20ms) to simulate the uncertainty of the label. Downsampling $f_s$ by a randomized factor allowed models to learn lower-frequency, long-term dependencies up to four seconds.\nTable 1 reports on the evaluation perfor-mances on the considered learned tasks aver-aged over all state measurements of unseen test discharges. Scores of the tasks TDisr, TTTB and Trec are on similar scales for both model types. They are also not very close to their optimal values. It is likely that by relaxing the strong constraints we imposed, such as L = 2, we would be able to improve on those numbers. However, in this work, we are mainly interested in the transparency of the model's decision-making process. On the contrary for the TMov task, Table 1 does report a significant differ-ence between the state- and sequence-based"}, {"title": "4.1. Disruption Prediction", "content": "For a further comparison we assess the models' performances as disruption predictors. The networks are evaluated using two detection methods. The first one is referred to as Network-only and uses the raw network prediction regarding plasma state disruptivity and triggers an alarm once a fixed threshold is overstepped. The second detection method is called Network + ML and corresponds to a hybrid detector. It additionally leverages a locked mode onset event detection such that an alarm is triggered either if the disruptivity score prediction oversteps a threshold or if there was a locked mode onset event (similar to the basic control scheme described in [11]). In order to allow a comparison with other references in literature, we evaluate the performance of these detectors focusing on the missed alarm rate (MA), false alarm rate (FA) as well as success rate (SR)."}, {"title": "4.1.1. Detection Rates Using the Network-", "content": "only approach, sequence-based models show a higher missed alarm rate but a lower"}, {"title": "4.1.2. Assertion Time", "content": "To minimize the false alarm rate, one can additionally introduce an assertion time window similar to [11], at the expense of potentially increasing the missed alarm rate. When using such a window, the prediction score must remain above a selected threshold for its entire duration, which introduces a hard-coded level of noise tolerance to the detector.\nTable 4 shows that the introduction of an assertion window improved the success rate for sequence-based networks only slightly, suggesting that they already did learn to deal with measurement noise during training. On the other hand, for the state-based networks, we can observe a significant increase in terms of success rate, allowing them to achieve a similar"}, {"title": "4.1.3. Warning Times", "content": "Apart from the detec-tion rates, the mean warning time (MWT) is another important performance indicator for a disruption predictor. This indicator is visual-"}, {"title": "5. Operational Space Mapping", "content": "Figure 4a shows the latent space, learned by a sequence-based model on a grid map. The grid is colored by the log scaled mean, clipped time-to-boundary quantity $t_{B,rel}$. The shape of the learned low-dimensional space is zero-centered and has spherical edges, which is likely due to the chosen spherical prior. We may already identify a vague disruptive boundary in the observed color scale. Furthermore, there appear to be two main and diverging paths along which the state can evolve towards the boundary condition. There also seems to be a small cluster of states in the top left corner that is not connected to the continuous state plane."}, {"title": "5.1. Discharge Tracking", "content": "The learned embedding space allows for the projection of measurements of unseen discharges onto it, enabling the visualization of the shot start (head), end (tail) and all states in between. Figure 4b visualizes the trajectory of the unseen disruptive shot 94447 on the learned latent space. The trajectory starts at its head in the stable region and crosses at some point the learned disruptive boundary. Thereafter it follows a path along the contour lines of the $t_{B,rel}$ quantity and encounters a locked mode at its tail. The trajectory also visualizes the 95% confidence interval of a state measurement, which might indicate whether the plasma evolves slowly or undergoes a rapid change. The white-to-black color scale indicates the time variable, showing that the overall evolution of the trajectory is smooth as required by $T_{Mov}$. Furthermore, the latent coordinates of the various labeled precursor events are also shown. The discharge seems to be crossing the learned disruptive boundary at the same time as it experiences a radiative collapse, corresponding to the definition of $T_{predisr}$ .\nA discharge tracking for multiple shots is depicted by figure 5a. The plot hints at a clustering of the heads and tails of the discharges, indicating that the latent space does incorporate some global dynamics. But trajectories do intersect on various occasions, implying that their evolution is still locally stochastic. However, all trajectories show smooth dynamics which may indicate that their local dynamics are predictable given their past evolution."}, {"title": "5.2. Heads And Tails", "content": "By computing a discharge tracking for all discharges and visualizing only the start and end state for each shot, one gets a heads and tails plot as shown in Figure 5b. The plot also shows the ramp-down start states of stable discharges. There seem to be two flat-top start clusters that suggest two distinct ramp-up strategies, while only a single ramp-down end cluster is revealed. These"}, {"title": "5.3. Marginal Feature Distributions", "content": "Figure 6 reports the component planes of two interesting input parameters used for the map-ping. They reflect the marginal feature dis-tributions and allow for uncovering patterns in the data. The radiation peaking factor BOLO_HV shows high values in the slow dis-ruptive region. Said region mostly corresponds to impurity accumulation disruptions in Figure 5b for which one would expect high values for the radiation peaking factor as also found by [11]. Figure 6b shows that the temperature peaking factor spikes at the tip of the diverg-ing branch in the fast disruptive region. That location corresponds to an edge cooling disrup-tion cluster as seen in Figure 5b which also is expected and was also observed in [11]. These feature distributions can be interpreted as a learned global feature importance regarding state disruptivity and disruption macro class type."}, {"title": "5.4. Precursing Events", "content": "For each discharge, the precursor events as described by [23] were labeled semi-automatically by an expert. Figure 7 displays the distribution of two prominent events, by projecting the closest measurement in time into the latent space.\nBoth events are precursors to an impurity accumulation disruption. They do exhibit a"}, {"title": "6. Conclusions", "content": "The presented study has demonstrated the capability of neural networks to describe in a meaningful way complex high-dimensional patterns into a lower-dimensional representa-tion, unveiling operation boundaries separat-ing different plasma regimes. The resulting 2D latent space representation (similarly to what was done in [11]) has successfully clustered the two main patterns characterizing JET dis-ruptions, namely the core radiative collapse due to the accumulation of high-Z impurities, and edge radiative collapses characterized by the contraction of the plasma current channel, both leading to MHD unstable scenarios. A fundamental improvement with respect to the previous work is the capability of this model of learning the temporal dependencies hidden in time series data. This capability allows the learned latent space to encode plasma dynam-ics, describing more consistently plasma trajec-tories across different regimes, as well as char-acteristic patterns in the proximity to disrup-tion boundaries. This aspect is of paramount importance in tasks such as plasma state moni-toring, where the temporal dependencies play a key role in detecting and predicting changes in relevant operational parameters, as well as to further understand the mechanisms that lead to those changes.\nWhen evaluated on the task of disrup-tion prediction, the model achieved competi-tive success rates when considering nearby in-stabilities and including a mode lock event detection. The resulting warning time dis-tribution closely resembled the ground truth, showing its potential for the implementation of disruption avoidance strategies. Furthermore, discharge tracking established smooth trajec-tory evolutions within the latent space, hint-ing at the fact that their dynamics might be predictable.\nSeveral promising avenues for future re-search emerge from our findings. The latent trajectory movements show curious patterns for disruptive discharges. Using methodolo-gies such as integrated gradients [28], one could attribute the predicted coordinate change to the input features, which could potentially uncover new information about the disrup-tive phenomenon. Furthermore, the adop-tion of self-supervised approaches from other domains could allow leveraging larger, unla-beled data sources for pretraining, potentially discovering more general and meaningful la-"}]}