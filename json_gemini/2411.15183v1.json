{"title": "Balancing property optimization and constraint satisfaction\nfor constrained multi-property molecular optimization", "authors": ["Xin Xia", "Yajie Zhang", "Xiangxiang Zeng", "Xingyi Zhang", "Chunhou Zheng", "Yansen Su"], "abstract": "Molecular optimization, which aims to discover improved molecules from a vast chemical\nsearch space, is a critical step in chemical development. Various artificial intelligence tech-\nnologies have demonstrated high effectiveness and efficiency on molecular optimization tasks.\nHowever, few of these technologies focus on balancing property optimization with constraint\nsatisfaction, making it difficult to obtain high-quality molecules that not only possess desirable\nproperties but also meet various constraints. To address this issue, we propose a constrained\nmulti-property molecular optimization framework (CMOMO), which is a flexible and efficient\nmethod to simultaneously optimize multiple molecular properties while satisfying several drug-\nlike constraints. CMOMO improves multiple properties of molecules with constraints based\non dynamic cooperative optimization, which dynamically handles the constraints across vari-\nous scenarios. Besides, CMOMO evaluates multiple properties within discrete chemical spaces\ncooperatively with the evolution of molecules within an implicit molecular space to guide the evo-\nlutionary search. Experimental results show the superior performance of the proposed CMOMO\nover five state-of-the-art molecular optimization methods on two benchmark tasks of simultane-\nously optimizing multiple non-biological activity properties while satisfying two structural con-\nstraints. Furthermore, the practical applicability of CMOMO is verified on two practical tasks,\nwhere it identified a collection of candidate ligands of \u1e9e2-adrenoceptor GPCR and candidate\ninhibitors of glycogen synthase kinase-3\u1e9e with high properties and under drug-like constraints.", "sections": [{"title": "1 Introduction", "content": "Molecular optimization, which aims to improve molecular properties by modifying molecular struc-\ntures, is a critical step for several engineering applications, such as drug discovery [1, 2] and matrial\nscience [3]. Molecular optimization is a challenging task in drug discovery, since it always needs\nto optimize multiple properties that may be conflicted with each other [4, 5]. Additionally, the\npractical optimization of molecules often necessitates the adherence to stringent drug-like criteria,\nthereby preventing some molecules from becoming drug candidates [6, 7]. For instance, in order to\ndiscover potent inhibitors against the discoidin domain receptor 1, Zhavoronkov et al. [8] adhered to\nstringent drug-like criteria, such as avoiding molecules with structural alerts or reactive groups, to\nselect candidates for subsequent synthesis. Note that, some stringent drug-like criteria for molecular\noptimization are typically not suitable to be treated as optimization objectives. Instead, they are\nmore aptly employed as constraints that guide the optimization process. For example, the molecules\nwith either small rings (< 5 atoms) or large rings (> 6 atoms) are difficult to be synthesized (see\nFigures S1 in the Supplementary Material). Although some molecular optimization tasks consider\nthe ring size in optimization objectives, e.g., the penalized logP [9], it is still difficult to rule out the\nmolecules with small or large rings. Consequently, the criteria for molecules with precisely 5 or 6\natoms in their rings is typically treated as a constraint in molecular optimization [10, 11]. Thus, the\nmodification of a specific molecule necessitates the optimization of its multiple molecular properties\nwhile simultaneously adhering to several drug-like criteria, i.e., it is required to achieve the balance\nbetween property optimization and constraint satisfaction.\nRecently, molecular optimization has witnessed significant advancements by the application of\nartificial intelligence methods [12-15], such as evolutionary algorithms (EA) [16, 17], reinforcement\nlearning (RL) [18, 19], and deep learning models (DL) [20-22]. Most of these existing molecular\noptimization methods are proposed to enhance a specific property, such as the quantitative esti-\nmate of drug-likeness (QED) or the penalized logP value (PlogP). Although these single-property\noptimization methods perform well in exploring vast chemical search spaces and reducing costs [23,\n24], they still face challenges when applied to practical molecular optimization tasks that involve\nsimultaneously enhancing multiple conflicting properties [25-28]. Afterwards, several multi-property\noptimization methods have been proposed to deal with the enhancement of multiple molecular prop-\nerties. For example, QMO [29] and Molfinder [30], which aggregated multiple molecular properties\ninto a single objective for molecule optimization, have exhibited promising performance in the simul-\ntaneous optimization of multiple properties. However, the performance of these methods is prone to\nbe affected by the improper setting of weights. MOMO [31] employed a multi-objective optimization\nstrategy and effectively identified a set of diverse and novel molecules to enhance the likelihood of\nsuccessful multi-property optimization of molecules.\nDespite the rapid advancements in multi-property molecular optimization methods, we still face\nnotable challenges when dealing with practical molecular optimization problems, since existing meth-\nods often yield new molecules that fail to meet drug-like constraints. To date, only a few molecular\noptimization methods have been proposed to deal with constraints by very simple strategies. For ex-\nample, MSO [32] aggregates all the properties to be optimized and the predefined constraints into a"}, {"title": "2 Results", "content": "In this study, each property to be optimized is treated as an optimization objective and the stringent\ndrug-like criteria are treated as constraints. We propose a constrained multi-objective molecular\noptimization framework CMOMO that includes an efficient population initialization and a dynamic\ncooperative optimization (Fig. 2A), where the dynamic cooperative optimization serves as the key\ncomponent. The driving idea of the dynamic cooperative optimization is to dynamically select high-\nquality molecules during the evolutionary process and to cooperatively perform the evolution of\nmolecules between the discrete chemical and the continuous implicit spaces. To this end, a tailored\ndynamic constraint handling strategy divides the optimization into two scenarios (unconstrained\nscenario and constrained scenario) and dynamically deals with the constraints in these two scenarios,\nthereby making the dynamic equilibrium between property optimization and constraint satisfaction."}, {"title": "2.1 The proposed CMOMO framework", "content": "lenging to explore feasible molecules (i.e., the molecules adhere constraints) with multiple desired\nproperties.\nTo address the above problem, in this study we propose a constrained multi-objective molecular\noptimization framework (CMOMO) to simultaneously optimize multiple molecular properties while\nsatisfying several constraints. CMOMO firstly solve the unconstrained multi-objective molecular\noptimization scenario to find molecules with good properties, and then considers both properties\nand constraints to find feasible molecules that possess promising properties (Fig. 1B). The main\ncontributions of this paper are summarized as follows.\n\u2022 A constrained multi-objective molecular optimization framework (CMOMO) is suggested to\naddress the multi-property molecular optimization with several drug-like constraints. The\nproposed CMOMO achieves a good balance between the optimization of multiple properties\nand the satisfaction of constrained molecules by first searching for molecules with good con-\nvergence and diversity in the unconstrained scenario and then identifying feasible molecules\nwith the desired property values in the constrained scenario. To the best of our knowledge,\nCMOMO is the first method that delicately balances property optimization and constraint\nsatisfaction for molecular optimization, and thereby yielding high-quality molecules exhibiting\ndesired molecular properties while adhering rigorously to drug-like constraints.\n\u2022 Compared with state-of-the-art methods, CMOMO has the following significant improvements:\nit facilitates simultaneous optimization of multiple molecular properties while adhering to\nvarious drug-like constraints, and subsequently identifies a set of optimal molecules with trade-\noffs among multiple objectives. We demonstrated the high performance of CMOMO in a\nvariety of molecular optimization tasks. Via CMOMO, we identified a collection of potential\nligands of \u1e9e2-adrenoceptor GPCR receptor (4LDE) and potential inhibitors against glycogen\nsynthase kinase-3 target (gsk33) with multiple higher properties while adhering the drug-like\nconstraints."}, {"title": "2.2 Experimental design", "content": "Furthermore, a vector fragmentation-based evolutionary reproduction strategy (VFER) significantly\nenhances the efficiency of evolution in the continuous implicit space. The above two strategies within\nthe dynamic cooperative optimization help to enhance the ability to identify molecules that possess\ndesirable molecular properties while adhering strictly to drug-like constraints. The procedure of the\nproposed CMOMO is illustrated as follows.\n(1) Population initialization: Given a lead molecule represented by a SMILES string, CMOMO\nfirst utilizes existing public database to construct a Bank library, which contains high property\nmolecules that are similar to the lead molecule. Then, CMOMO uses a pre-trained encoder [34]\nto embed the lead molecule and molecules in the Bank library into continuous implicit space. It\nis worth noting that the pre-trained encoder has been widely used to perform efficient and smooth\nsearch in the implicit space [29, 32]. Next, CMOMO performs linear crossover [35] between the la-\ntent vector of lead molecule and that of each molecule in the Bank library, which enables CMOMO\nto generate a high-quality initial molecular population.\n(2) Dynamic cooperative optimization: In this step, the cooperative optimization between\nthe discrete chemical space and the continuous implicit space is dynamically executed in both uncon-\nstrained and constrained scenarios. To be specific, in the unconstrained scenario, CMOMO firstly\nemploys a newly designed vector fragmentation based evolutionary reproduction strategy (VFER)\non the implicit molecular population to efficiently generate offspring molecules in the continuous\nimplicit space (Fig. 2B). Next, CMOMO decodes parent and offspring molecules by a pre-trained\ndecoder from the continuous implicit space to the discrete chemical space to evaluate their molecular\nproperties [34]. Further, the molecules with better property values are selected by the environmental\nselection strategy of NSGA-II [36] to obtain the next molecular population. CMOMO iterates the\nabove operations until the given number of iterations is reached, which enables CMOMO to possess\nstrong ability to explore the vast search space to obtain molecules with good convergence and diver-\nsity, where convergence measures the proximity of molecules to the CPF and diversity assesses the\ndistribution of molecules in the search space. Afterwards, CMOMO switches to the optimization\nin the constrained scenario. In comparison to the optimization in the unconstrained scenario, the\noptimization within the constrained scenario adopts a novel way (i.e., a ranking aggregation strat-\negy) to evaluate and select molecules by balancing property optimization and constraint satisfaction\n(Fig. 2C). Finally, we identify the feasible molecules which have excellent molecular properties and\nsatisfy the drug-like constraints."}, {"title": "2.2.1 Optimization tasks.", "content": "The four constrained multi-objective molecular optimization tasks contain two benchmark tasks\n(Task 1 and Task 2) and two practical tasks (Task 3 and Task 4). Their optimization objectives and\nconstraints are described as follows."}, {"title": "2.2.2 Comparison methods.", "content": "In the experiments, there are totally five state-of-the-art methods that are selected to compare with\nthe proposed CMOMO, namely QMO[29], Molfinder[30], MOMO[31], MSO[32], and GB-GA-P[33].\nIn these five comparison methods, QMO and MSO use aggregation methods to optimize multiple\nobjectives, while the other three methods are Pareto optimization methods. As for the constraint"}, {"title": "2.2.3 Evaluation metrics.", "content": "We compare the performance of the six methods by using four metrics, namely the optimization\nsuccess rate (SR), the number of successfully optimized molecules (NSR), the hypervolume (HV),\nand the mean property value of successfully optimized molecules. Specifically, SR is the ratio of\nsuccessfully optimized molecules against all molecules to be optimized, where successfully optimized\nmolecules refer to those feasible molecules whose property values are better than the predefined\nthresholds. The hypervolume [44] is used to comprehensively evaluate both convergence and di-\nversity of successfully optimized molecules, which can be obtained by calculating the size of the\nhyperspace between the set of molecules and the reference point, where the reference point in each\ntask is set as a zero vector.\nIn the experiments, the thresholds that are used to assess whether a molecule is successfully\noptimized are given as follows. For Task 1, QED \u2265 0.85, PlogP_imp \u2265 3, and Similarity \u2265 0.3;\nTask 2, Score_dissmi\u2265 0.5, Score_mw\u2265 0.5, Score_rb\u2265 0.5, and Similarity > 0.3; Task 3, QED \u2265 0.8,\n4LDE < -10, and Similarity > 0.3; Task 4, QED \u2265 0.7, GSK3\u00df inhibition \u2265 0.4, SA\u2265 0.7, and\nSimilarity \u2265 0.2. Besides, since QMO and MSO are aggregation methods that obtain only one\nmolecule in their final results, CMOMO is compared with them only in terms of SR. As for the three\nPareto optimization methods, the CMOMO is compared with them using all of the four evaluation\nmetrics. Details about the experimental settings can be found in the Supplementary Material Text\nS1-S4."}, {"title": "2.3 \u0421\u041c\u041eMO outperforms the comparison methods on benchmark tasks", "content": "Fig. 3 shows the success rate, hypervolume, and the number of successfully optimized molecules by\nthe proposed CMOMO and comparison methods. From the figure, the following three observations\ncan be obtained.\nFirst, the proposed CMOMO achieves the highest success rate in comparison with the five\nmolecule optimization methods on the two benchmark tasks (Fig. 3A and Fig. 3B). For example, on\nTask 1, the proposed CMOMO successfully optimized 94.8% of 800 molecules, which achieves signif-\nicantly better performance than all the five comparison methods. It is indicated that the proposed\nCMOMO is likely to successfully optimize a molecule which is hard to be optimized.\nSecond, the successfully optimized molecules achieved by the proposed CMOMO have supe-\nrior molecular properties and exhibit greater diversity, where the diversity can be measured by the\nnumber and the distribution of molecules. (1) To comprehensively access the quality of the success-\nfully optimized molecules, Fig. 3C and Fig. 3D present the hypervolume (HV) of the optimized"}, {"title": "2.4 \u0421\u041c\u041eMO exhibits good performance on finding potential ligands for\nthe 4LDE protein", "content": "In this subsection, we test the performance of CMOMO and comparison methods on the protein-\nligand optimization task. First, we give the results of the six considered methods in terms of success\nrate. As shown in Fig. 4A, the proposed CMOMO obtains the largest success rate of 75%, while the\nlargest success rate obtained by the comparison methods is 59%, which is obviously smaller than the\nproposed CMOMO. Then, we present their optimization results in terms of HV of successfully opti-\nmized molecules, which are shown in Fig. 4B, the results show that the proposed CMOMO obtains\nthe largest HV value, i.e., 0.338, which is larger than the largest HV value obtained by the other\nthree Pareto optimization methods, i.e., 0.291. The superiority of CMOMO in terms of HV indicates\nthat its successfully optimized molecules have better convergence and diversity. Next, we compare\nthe performance of CMOMO and comparison methods by comparing the quality and quantity of\ntheir successfully optimized molecules, where the results are given in Figure S2C and Figure S3C\nin the Supplementary Material. The results in Figure S2C show that the molecules obtained by\nCMOMO have better properties. The results in Figure S3C show that CMOMO obtains a larger\nnumber of successfully optimized molecules than the three Pareto optimization based comparison\nmethods for most lead molecules.\nTo better validate the performance of the proposed CMOMO, we provide five pairs of molecules\nwith each pair containing a lead molecule and an optimized molecule to compare their difference.\nAs shown in Fig. 4C, it can be seen that the proposed CMOMO improves their QED and 4LDE\nconsiderably; besides, for each pair of molecules, the optimized and lead molecules are similar, which\npossess a similarity value that is larger than 0.3. To further verify the performance of our proposed\nCMOMO, the first two molecules shown in Fig. 4C are used to conduct the protein-ligand interaction\nanalysis, where the docking software Autodock and the visualization software PyMol [45] are used to\nsimulate the docking energies and the top docking poses. As shown in Fig. 4D, the binding energies"}, {"title": "2.5 \u0421\u041c\u041eMO performs well on finding potential inhibitors against the\nGSK33 target", "content": "Fig. 5 presents the results on Task 4, i.e., the inhibitor optimization task, which shows that the\nproposed CMOMO holds the ability to find potential inhibitors against GSK3\u03b2. To be specific,\nthe proposed CMOMO outperforms the comparison methods in terms of four evaluation metrics,\nincluding the success rate, HV, mean property value, and the number of successfully optimized\nmolecules. Besides, the protein-ligand interaction analysis shows that the molecules obtained by\nCMOMO have potential inhibitions against the GSK3\u1e9e target.\nAs shown in Fig. 5A, while the success rates obtained by the five comparison methods range from\n5.37% to 24.6%, CMOMO achieves the largest success rate of 52.7%, which is obviously larger than\nthat obtained by the comparison methods. In terms of HV, Fig. 5B shows that CMOMO obtains\nthe largest mean hypervolume, which is larger than that obtained by three Pareto optimization\nmethods. As for the quality and quantity of successfully optimized molecules obtained by CMOMO\nand comparison methods, they are given in Figure S2D and Figure S3D in the Supplementary\nMaterial. The results in Figure S2D show that the successfully optimized molecules obtained by\nCMOMO have the best performance on multiple properties, especially in terms of GSK3\u1e9e inhibition\nand SA. The results in Figure S3D show that CMOMO obtains a larger number of successfully\noptimized molecules for most lead molecules than comparison methods.\nTo better validate the performance of the proposed CMOMO, we use five successfully optimized\nmolecules to compare with their corresponding lead molecules. As shown in Fig. 5C, for each\nlead molecule, the proposed CMOMO obtains a successfully optimized molecule with the GSK3\u03b2\ninhibition, QED and SA being improved considerably. Moreover, we conduct an in-depth analysis\nof protein-ligand interactions for the first two optimized molecules in Fig. 5C, where the protein\nstructure of GSK3\u1e9e is downloaded from the UniProt website [48]. As depicted in Fig. 5D, the\nbinding energies of the two optimized molecules are also smaller than -7 kcal/mol, when the two\nmolecules generate 3 and 2 hydrophobic interactions (represented by yellow dashed lines) with the\namino acid residues of GSK3\u1e9e, respectively. The above results illustrate that the molecules obtained\nby CMOMO have the potential to bind with the GSK3\u1e9e target."}, {"title": "2.6 Case study", "content": "In this subsection, we perform a case study by randomly selecting a lead molecule in Task 1 to inves-\ntigate the search capability of the proposed CMOMO and the evolutionary trajectory of optimized\nmolecules. Fig. 6 gives the optimization results obtained by the proposed CMOMO and the three\nPareto optimization based comparison methods, where each dot represents a successfully optimized\nmolecule with its size reflecting the similarity to the lead molecule. It can be seen that the number\nof successfully optimized molecules obtained by CMOMO is obviously larger than that obtained by\nthe three comparison methods. Besides, the successfully optimized molecules obtained by CMOMO\ndominate the ones obtained by the comparison methods, which means that the molecules obtained\nby CMOMO have better QED and PlogP properties. Moreover, compared with the three Pareto\noptimization based comparison methods, the proposed CMOMO shows competitive performance in"}, {"title": "2.7 Ablation studies of CMOMO", "content": "In this subsection, we conduct some ablation experiments to validate the effectiveness of key compo-\nnents in the proposed CMOMO by designing three algorithmic variants, namely CMOMO_nobank,\nCMOMO_noagg, and CMOMO_novfer. Specifically, the variant CMOMO_nobank is obtained by re-\nmoving the Bank library from the population initialization of CMOMO, the variant CMOMO_noagg\nis obtained by replacing the ranking aggregation strategy in the constrained optimization stage of\nCMOMO with the constraint dominance principle [36], which is widely used as a constraint handling\ntechnique to address constraints, and the variant CMOMO_novfer is designed by replacing the vector\nfragmentation based evolutionary reproduction strategy in CMOMO with the polynomial mutation\noperation, which is widely used by many methods [31, 49] to generate the latent vectors of offspring\nmolecules.\nFig. 8 provides the results of performance comparisons between CMOMO and its three vari-"}, {"title": "3 Discussion", "content": "In this paper, we have proposed CMOMO, a deep constrained multi-objective optimization frame-\nwork that can be readily adapted to any stringent drug-like criteria and any evaluation metrics of\nmolecular property. It features an efficient dynamic cooperative optimization that enables CMOMO\nto balance property optimization and constraint satisfaction. The proposed CMOMO is able to\nsimultaneously optimize multiple molecular properties while satisfying several stringent drug-like\ncriteria. Further, the CMOMO framework can be applied to the tasks with other kinds of con-\nstraints, and other types of drugs, such as peptide, and proteins.\nCMOMO demonstrates its superior performance over baseline results on the simpler bench-\nmark tasks for optimizing two non-biological activity properties (i.e., drug-likeness and penalized\nlogP scores) and similarity or optimizing three structural scores of a drug and similarity, while ad-\nhering two constraints (i.e., the rings in molecules should have only 5 or 6 atoms and molecules\ncannot contain 163 toxic or uncommon substructures). Under above two constraints, we also ap-\nply CMOMO to improve the simulated docking score of existing ligands with the 32-adrenoceptor\nGPCR, as well as drug likeness and similarity; and to improve the inhibition of molecules against\nglycogen synthase kinase-3\u00df, as well as drug likeness, the normalized synthetic accessibility, and\nsimilarity. The CMOMO-optimized molecules of existing drug molecules show a favourable dock-\ning score with \u1e9e2-adrenoceptor GPCR and drug likeness score, and satisfy constraints. Besides,\nthe CMOMO-optimized molecules are consistently predicted to inhibit against glycogen synthase\nkinase-3\u00df and easily be synthesized by property predictors. Compared to the five competitors, the\nproposed CMOMO obtains more successfully optimized feasible molecules with better property val-\nues, which verifies the superiority of balancing property optimization and constraint satisfaction.\nThe multiple evolutionary paths analysis provides insight into how CMOMO efficiently traverses the\nmolecular space to discover a diverse set of improved molecules that possess the desired properties\nwhile adhering to established constraints. The results show strong evidence that CMOMO can serve\nas a novel and practical tool for molecule optimization to accelerate drug discovery with constraints."}, {"title": "4 Materials and Methods", "content": "The multi-property molecular optimization with complex constraints are formulated as constrained\nmulti-objective optimization problems. The proposed CMOMO starts with an effective population\ninitialization, which is used to generate a set of high-quality initial molecules. Then, CMOMO\nperforms dynamic cooperative optimization, where molecules are dynamically optimized by the\nconsidered properties and constraints, and cooperatively evolved between discrete chemical and\ncontinuous implicit spaces. Specifically, CMOMO employs a dynamic constraint handling strategy\nto divide the optimization into two scenarios, i.e., unconstrained scenario and constrained scenario,\nwhich enables CMOMO to dynamically balance property optimization and constraint satisfaction.\nIn the two scenarios, CMOMO performs the same operation in terms of molecule generation, i.e., the\nvector fragmentation-based evolutionary reproduction (VFER) strategy in the continuous implicit\nspace, however, they perform different operations in terms of molecule evaluation and selection to\npresent a dynamic constraint handling strategy."}, {"title": "4.1 Molecular optimization formulation", "content": "In the paper, multi-property molecular optimization problems are formally modeled as constrained\nmulti-objective optimization problems, where each property to be optimized is treated as an opti-\nmization objective and the strict requirements are treated as constraints. The proposed constrained\nmulti-objective optimization problems can be mathematically expressed as follows.\nMinimize F(x) = (f1(x),\u2026\u2026, fm(x))\nsubject to \u03a7\u0395\u03a9\ngi(x) \u2264 0, i = 1,\u2026\u2026,p\nhj(x) = 0, j = 1,\u2026, q\nwhere x represents a molecule and \u03a9 represents the molecular search space. F(x) is the objective\nvector consisting of m optimization properties, i.e., f1(x),\u2026\u2026, fm(x). The gi(x) and hj(x) are the\ni-th inequality constraint and the j-th equality constraint, respectively."}, {"title": "4.2 Population initialization strategy", "content": "In the proposed CMOMO, the population initialization strategy is used to generate a set of high-\nproperty molecules that are similar to the lead molecule. To this aim, we first build a Bank library for\neach lead molecule by screening high-property molecules from public databases [56-58] (Figure S6A\nin the Supplementary Material). Then, we use the pre-trained encoder to encode the lead molecule\nand screened molecules which are represented by SMILES strings into the continuous implicit space.\nNext, a linear crossover operation is performed between the latent vector of lead molecule and that\nof each screened molecule to obtain a set of new latent vectors (Figure S6B in the Supplementary\nMaterial). Finally, these newly generated latent vectors are decoded from the continuous implicit\nspace to the discrete chemical space. In this way, molecules in the initial population possess not\nonly the genes of lead molecule but also that of screened molecules, which enables initial molecules\nto have good properties under the premise that they are similar to the lead molecule."}, {"title": "4.3 Molecule generation strategy", "content": "At the two optimization scenarios, CMOMO utilizes pre-trained encoder and decoder to map\nmolecules between the discrete chemical space and continuous implicit space, which enables it gen-\nerate molecules effectively as QMO [29] and MSO [32]. Besides, a vector fragmentation based evolu-\ntionary reproduction (VFER) strategy is designed in CMOMO to further enhance the effectiveness\nand efficiency of generating offspring molecules, which consists of two operations, i.e., blended linear\ncrossover and fragmentation-based mutation. To be specific, CMOMO first selects two latent vectors\nrandomly as parent molecules to perform linear crossover, then, the generated vectors are divided\ninto small fragments with one fragment being selected randomly to perform mutation.\nCrossover. In the process of generating offspring molecules, the crossover operation is mainly\nused to inherit the good genes of parent molecules. To this aim, the blended linear crossover\noperator [35] is used in CMOMO, which has also been widely used by many other methods, including\nDEL [49] and MOMO [31]. Specifically, given a set of latent vectors of molecules, two vectors (21\nand z2) are randomly selected as parent molecules to generate two offspring molecules (z'1 and z'2)"}, {"title": "4.4 Dynamic constraint handling strategy", "content": "When CMOMO adopts the same strategy to generate high-quality molecules in the two scenarios, the\ntwo optimization scenarios are different in terms of molecule evaluation and selection. Specifically,\nwhen the first scenario evaluates and selects molecules by only considering property values, the\nsecond scenario takes both property values and constraint violation degree into consideration. In this\nway, the complex constraints in multi-property molecular optimization are addressed dynamically,\nwhich enables the final results obtained by CMOMO to be feasible with good convergence and\ndiversity."}, {"title": "4.4.1 Molecule evaluation and selection in the first scenario.", "content": "In the proposed CMOMO, the first scenario is an unconstrained multi-objective molecular opti-\nmization scenario, which aims to find molecules with good convergence and diversity. To this aim,\nwhen CMOMO in this scenario evaluates molecules by considering only their property values, the\nenvironmental selection strategy of NSGA-II is used to select molecules from the union of parent and\noffspring molecules, which consists of two components, i.e., non-dominating sorting and crowding\ndistance calculation.\nNon-dominated sorting [59]. The non-dominated sorting is used to assign molecules to dif-\nferent fronts according to their dominance relationship, which facilitates to improve the convergence\nof molecular population by selecting molecules with smaller front number. Typically, molecules\nwith smaller front number are the ones with good convergence. Herein, we first introduce how to\ndetermine the dominance relationship between different molecules. Given two molecules 21 and x2,\nthe molecule x1 is said to dominate molecule x2 (denoted as x1 < x2) if and only if x1 is not worse\nthan 22 on any objective, besides, the molecule x1 is better than 22 on at least one objective. Given\nthat the collection of all molecules to be sorted is termed as Q, if there does not exist a molecule\ninQ that dominates molecule x1, the molecule x1 is called a non-dominated molecule; otherwise,\nit is called a dominated molecule. In non-dominated sorting, all non-dominated molecules are first\nselected and removed from Q to obtain the first front F\u2081. Then, the dominance relationship between\nthe remaining molecules in Q is recalculated with all non-dominated molecules being removed from\nQ to obtain the second front F2. The above operations repeat until all molecules in Q are assigned\nto different fronts.\nCrowding distance calculation [59]. In the cast that the non-dominated sorting is used to\nimprove the convergence of molecular population, molecules with the same front number are further\nsorted by their crowding distance, which helps to maintain the diversity of molecular population.\nSpecifically, given a molecule x, its crowding distance is calculated as follows.\nCD(x) = \u2211 i=1 fi(xa) - fi(xb)/fimax - fimin\nwhere fimax and fimin are the maximum and minimum objective values of all molecules on the i-th\nobjective, xa and x are two nearest neighborhood molecules to molecule x with their objective\nvalues fi(xa) and fi(xb) being larger and smaller than fi(x), respectively.\nMolecule selection. In the first scenario, when the front number and crowding distance of\neach molecule are obtained, the proposed CMOMO selects P molecules from the union of parent\nand offspring molecules that contains 2P molecules, where the front number is used as the first\nselection criterion and the crowding distance is adopted as the second selection criterion. Specifically,\nCMOMO first selects molecules front by front until the number of molecules in F\u2081U F2UUFk is\nlarger than P. Then, CMOMO deletes | F1 UF 2 U\u2026\u2026 U Fk | - P molecules with the smallest crowding\ndistance from Fr. In this way, CMOMO obtains P molecules with good convergence and diversity\nto undergo further optimization."}, {"title": "4.4.2 Molecule evaluation and selection in the second scenario.", "content": "Different from the first scenario, the second scenario is a constrained multi-objective molecular op-\ntimization scenario, which poses high requirement on the balance between property optimization\nand constraint satisfaction. To address this issue, when the second scenario considers both property\nvalues and constraint violation degree in molecule evaluation, a ranking aggregation strategy is de-\nsigned to perform molecule selection, which consists of three steps, i.e., property-preference ranking,\nconstraint-preference ranking, and comprehensive scoring (Fig. 2C).\nProperty-preference ranking. The property-preference ranking considers only property val-\nues of molecules. Given the union of parent and offspring molecules which contains 2P molecules,\nwhen their front numbers and crowding distances are obtained by non-dominated sorting and crowd-\ning distance calculation as introduced in section 4.4.1, these 2P molecules are ranked by the following\nways. First, the molecules are ranked based on their front numbers, where the molecules having\nsmaller front number are ranked ahead of that having larger front number. Then, the molecules\nhaving the same front number are ranked based on their crowding distances, where the molecules\nhaving larger crowding distances are ranked ahead of that having smaller crowding distances. In\nthis way, each molecule in the union of parent and offspring molecules obtains a unique rank number\nranging from 1 to 2P. For example, the molecule having the smallest front number and largest\ncrowding distance is given a rank number of 1, by contrast, the molecule having the largest front\nnumber and smallest crowding distance is assigned a rank number of 2P.\nConstraint-preference ranking. The difference between the constraint-preference ranking\nand property-preference ranking lies in the fact that the constraint-preference ranking takes both\nproperty values and constraint violation degree into consideration. When the two ranking operations\nrank molecules in the union of parent and offspring molecules according to front numbers and\ncrowding distances, they use different methods to obtain the front numbers of molecules. Specifically,\nin property-preference ranking, front numbers of molecules are obtained by non-dominated sorting\nas introduced in section 4.4.1, which does not consider constraints. By contrast, in constraint-\npreference ranking, front numbers of molecules are obtained by the constraint dominance principle.\nGiven two molecules 21 and 22, the molecule x1 is said to dominate molecule x2 if one of the following\nconditions is met: (1) both 11 and 12 are feasible, besides, x\u2081 has better property values than 12.\n(2) x1 is feasible while x2 is infeasible; (3) both x1 and 12 are infeasible, besides, the constraint\nviolation degree of x\u2081 is smaller than that of x2.\nComprehensive scoring. When the above two ranking operations are performed, each molecule\nobtains two rank numbers, which are herein used to perform a comprehensive scoring for all molecules.\nSpecifically, the rank numbers obtained in property-preference ranking are saved in S\u2081 with Si repre-\nsenting the first score of the i-th molecule, while the rank numbers obtained in constraint-preference\nranking are saved in S2 with Si representing the second score of the i-th molecule. In this way, each\nmolecule in the union of parent and offspring molecules obtains a comprehensive score by aggregating\nits two scores as follows.\nSi = \u03b1Si + (1 \u2212 \u03b1)Si, \u03b1 = t/\u03c4 \u00d7 (1 + cos(\u03c0t)/\u03c4).\nwhere the Si represents the comprehensive score of the i-th molecule, the \u03b1 is a parameter which\ngradually decays from 1 to 0 as the evolutionary generation t increases.\nBased on the comprehensive score of each molecule, CMOMO selects P molecules with the\nsmallest comprehensive scores from the union which contains 2P parent and offspring molecules.\nBesides, CMOMO dynamically adjusts the effects of property-preference ranking and constraint-\npreference ranking on the comprehensive scoring, which enables the algorithm to focus on property\noptimization and constraint satisfaction respectively at the early and later evolutionary stages; thus,\nfacilitating to obtain feasible molecules with good convergence and diversity."}]}