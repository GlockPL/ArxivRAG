{"title": "Energy-efficient Hybrid Model Predictive Trajectory Planning for Autonomous Electric Vehicles", "authors": ["Fan Ding", "Xuewen Luo", "Gaoxuan Li", "Hwa Hui Tew", "Junn Yong Loo", "Chor Wai Tong", "A.S.M Bakibillah", "Ziyuan Zhao", "Zhiyu Tao"], "abstract": "To tackle the twin challenges of limited battery life and lengthy charging durations in electric vehicles (EVs), this paper introduces an Energy-efficient Hybrid Model Predictive Planner (EHMPP), which employs an energy-saving optimiza-tion strategy. EHMPP focuses on refining the design of the motion planner to be seamlessly integrated with the existing automatic driving algorithms, without additional hardware. It has been validated through simulation experiments on the Prescan, CarSim, and Matlab platforms, demonstrating that it can increase passive recovery energy by 11.74% and effectively track motor speed and acceleration at optimal power. To sum up, EHMPP not only aids in trajectory planning but also significantly boosts energy efficiency in autonomous EVs.", "sections": [{"title": "I. INTRODUCTION", "content": "The study of electric vehicles (EVs) has garnered sig-nificant attention from both industry and academia, driven by growing concerns about environmental issues [1]. Au-tonomous electric vehicles are presented as a practical solu-tion to these challenges [2]. However, a widespread adoption faces hurdles such as limited battery life and prolonged charging times [3]. To tackle these challenges, researchers are exploring diverse solutions, including innovations in autonomous driving strategies and optimization of route planning algorithms to maximize energy utilization [4] [5] [6] [7]. Yet, current studies often overlook the interplay among the kinetic energy recovery systems (KERS), engine efficiency, and external environment. These interactions are distinguishing features of hybrid and electric vehicles, which can additionally be incorporated into vehicle driving strate-gies to improve energy-efficiency [8]. In prior energy strategy research, driving strategies to improving energy-efficiency have been widely proposed [9], but it is difficult for drivers to manually control vehicles according to these proposed strategies. The emerge of autonomous driving provides a satisfying solution to the above problems, effective vehicles controlled by algorithms can be more accurately planned and controlled based on strategies.\nThe conversion of kinetic energy into electrical energy in-volves reversing the vehicle's electric engine into functioning as a generator and subsequently charging the battery with the generated current [10]. This conversion of the kinetic energy losses serves as a viable method for energy recovery, enhancing system performance, improving energy conversion efficiency, and extending the mileage [11] [12] [13]. In recent years, kinetic recovery has emerged as a key focus of interest among researchers, designers, and manufacturers in the EV industry [14]. As a portion of the energy that is utilized to propel the electric vehicle is dissipated as braking energy loss during driving, recovering a portion of these losses can enhance the efficiency of energy extraction from the battery and prolong the mileage. An alternative approach to regenerative braking for kinetic energy recovery is the conversion of potential energy losses, which can be implemented by not activating the braking system when the vehicle decelerates. In such instances, the kinetic energy recovery system kicks in to recover as much kinetic energy as possible from the car. Therefore, KERS in energy recovery strategy is an important factor that has to be considered for improving the overall efficiency of EV operation.\nIn this paper, we propose an energy-efficient Hybrid Model Predictive Planner (EHMPP), optimized based on the best energy efficiency strategies. This planner takes into account the operational state of the KERS during the planning process for EVs, enhancing their range and energy efficiency. We conducted simulation experiments in Prescan, Cars, and Matlab to validate the effectiveness of our proposed strategy. The results indicate that implementing EHMMP significantly enhances the energy efficiency of autonomous electric vehi-cles.\nOur main contributions to this article are as follows:\nEHMPP is an EVs planner that operates within the con-straints of existing hardware configurations, eliminating the need for supplementary hardware deployment.\nOur simulation results demonstrate that the proposed strategy significantly enhances the vehicle's energy ef-ficiency during operation. Specifically, it boosts pas-sive energy recovery by 11.74% during deceleration phases. Moreover, the strategy optimizes motor op-eration, ensuring it remains close to its ideal power state throughout acceleration, deceleration, and cruising phases, thereby improving overall energy efficiency.\nEHMPP enhances flexibility by automatically selecting distinct cost functions for different motion states, sur-passing traditional methodologies. This approach not only facilitates an adaptive planning but also serves as a valuable reference for deploying additional strategies."}, {"title": "II. RELATED WORK", "content": "Over the past decade, the autonomous vehicle industry has undergone remarkable growth [15]. One that garnered the most attention is trajectory planning [16], which is of great significance for charting an accurate course that aligns with a predefined global path. This procedure typically aligns with a predetermined set of control objectives. Simultaneously, vehicles have begun to widely install KERS [17], indicating that a transition towards electric vehicles will be the main direction for energy recovery systems in the foreseeable future."}, {"title": "A. Energy Control Strategy", "content": "Incorporating KERS into trajectory planning has ga-nined immense traction in research, with two prominent approaches: eco-driving control and energy control strategy. On one hand, examples of eco-driving control approaches include Connected and Autonomous Vehicles (CAVs) which optimizes speed profiles across various scenarios to con-serve energy [18]. In addition, Energy Management Systems (EMS) for plug-in hybrid and hybrid vehicles prioritize min-imizing powertrain energy consumption while meeting drive power requirements [8]. Automotive eco-driving is currently regarded as an effective method in enhancing vehicle energy-efficiency without extensive hardware integration [18]. On the other hand, energy control strategy primarily focuses on planning the most energy-efficient trajectory and speed for the vehicle by leveraging a dynamic model of the EV [19]. For example, the work [20] introduced an intelligent energy-saving control strategy for EVs, which implements the motion of the preceding vehicle to distinguish between four distinct scenarios and inform control decisions. The work cited in [21] introduces an integrated energy recovery strategy for regenerative braking systems in intelligent, four-wheel independent drive electric vehicles. This approach spans planning to control, addressing energy recovery across three distinct layers. It advocates for trajectory optimization in electric vehicles using an inverse dynamics model and servo constraints, aiming to enhance vehicle energy effi-ciency through strategic trajectory planning.\nAdditionally, the work cited in [22] presented an energy control strategy for self-driving electric vehicles navigat-ing intersections with continuous speed limit signals. This strategy enhances vehicle energy efficiency under continuous traffic light conditions by regulating vehicle speed.\nTo our best knowledge, most trajectory planning primarily focuses on the physical conditions and driving strategy of the car, with few works incorporating KERS into planner."}, {"title": "B. Route Planning Algoirthms", "content": "1) Dynamic Planning Method: Dynamic programming (DP), an optimization technique pioneered by Bellman, of-fers a powerful framework for solving multi-stage decision problems [23]. This approach leverages backward recur-sion, decomposing the problem into a series of single-stage optimizations, starting from the terminal state and work iteratively back to the initial state. While DP has enjoyed success in optimizing energy management for hybrid vehicles by allocating power among the engine, electric motor, and other sources, its computational demands have limited its application in autonomous driving energy strategies. Here, we use a novel approach that leverages DP to obtain a coarse solution, followed by a quadratic program (QP) for refinement.\n2) Quadratic programming(QP): QP is extensively em-ployed for determining the optimal trajectory for autonomous vehicles [24], with notable advantages over the commonly used nonlinear programming (NLP) methods in trajectory planning. While NLP approaches are versatile, they come with a high computational burden, which can be substantially minimized by adopting QP [25]. In contrast, QP not only has reduced computational demands but also excels in speed and convergence when solving convex problems. In particular, trajectory planning requires real-time processing capabilities for rapid dynamic environmental changes."}, {"title": "III. METHODOLOGY", "content": "Our proposed EHMPP framework applies the optimal energy-efficiency strategy on top of DP and QP methods to enhance energy efficiency in autonomous driving. The EHMPP's optimization algorithm involves optimal planning of speed, acceleration, and trajectory, while considering environmental factors such as air resistance, road surface friction, and road elevation. Furthermore, it incorporates real-time vehicle dynamics, such as engine power output and energy recovery system efficiency, into the decision-making matrix. By establishing distinct cost functions for different acceleration, deceleration and uniform cruising."}, {"title": "A. Constructing an Automobile dynamics model", "content": "Given the central emphasis on energy-efficiency within this paper, the influence of car steering effects is deliberately excluded from consideration in this study.\nTo achieve simulation control, here we construct an au-tomobile kinematic model that adheres to the following constraints under free motion: (1) Input parameters of the kinematic model encompass road slope, air resistance coef-ficient, ground friction coefficient, and car windward area. (2) Optimal road surface adhesion coefficients ensure balanced adhesion on both sides, mitigating any potential side-slip phenomena. (3) Motion heading angle constrains the car's trajectory. (4) The vehicle is treated as a rigid body rather than a mere mass. The vehicle kinematics model is depicted in Figure 1.\nThe air resistance acting on the vehicle is:\n$Fair = \\frac{1}{2} \\rho v^2 c_dA$ (1)\nwhere $\\rho$ denotes the air density, $v$ denotes the speed of the car, $C_d$ is the coefficient of air resistance, and $A$ is the windward area of the car.\n$Ffriction = \\mu mg cos(\\theta)$ (2)\nThe forces induced by slope are:\n$Fslope = mg sin(\\theta)$ (3)"}, {"title": "B. optimal energy-efficiency strategy", "content": "During acceleration, the EVs should enter the constant speed phase with optimal acceleration without violating constraints.\nThe constraints for the dynamics model are outlined as follows:\n1) The acceleration of the car must adhere to the limita-tion of the maximum power output of the motor.\n2) Objective constraints govern the braking process of the vehicle.\n3) The vehicle operation is mandated by formal road regulations.\nAccording to the studies [26] [27] [26] [28], there is an optimal acceleration with least energy consumption. In this process, the optimal acceleration of the vehicle is modeled via dynamic equation as follows:\n$\\@Acc_Opt = \\frac{P}{m} - \\frac{(fair + fFriction + fSlope)}{m}$ (7)\nwhere $P$ refers to the optimal output power of the motor or engine in the acceleration phase, which could make accel-eration achieve the most energy-efficient.Thus, we identify the acceleration in this state of acceleration as the optimal acceleration.\nDuring deceleration, the EVs decelerates at the optimal deceleration speed fllowing the same constraints. According to [8] [29], when the vehicle's kinetic energy recovery system decelerates at a specific speed range, it has the highest kinetic energy recovery efficiency. It is deduced that there is an optimal deceleration in the process of vehicle deceleration, to maximize the efficiency of the kinetic energy recovery system. When this optimal braking condition is met, the vehicle should not apply additional braking force at the brake end. In this process, the optimal vehicle deceleration by dynamic relationship recurrence is as follows:\n$\\@Opt_Dec = \\frac{Pm + fair + fFriction + fslope}{v} \\frac{d2}{m}$ (8)\nWhere $Pm$ is the power of the vehicle kinetic energy system with maximum energy-efficiency, which is determined by the configuration of the vehicle kinetic energy recovery system which could make deceleration achieve the most energy-efficient. So we identify the deceleration in this accelerated state as the optimal deceleration.\nOur proposed strategy aims to achieve optimal energy efficiency across acceleration, deceleration, and uniform cruising phases. This strategy is designed to optimize the speed and route planning of the autonomous driving system, ensuring alignment with the vehicle's optimal acceleration and deceleration requirements."}, {"title": "IV. ALGORITHM IMPLEMENTATION", "content": "In our EHMPP, motion planning is categorized into three types based on acceleration states: the acceleration phase with positive acceleration, the constant speed phase with zero drive, and the deceleration phase with negative acceleration. In particular, the motion/trajectory planning of EHMPP re-quires a transformation from a Cartesian coordinate system"}, {"title": "A. Dynamic programming of trajectories", "content": "We implement a uniform random sampling within a discrete space and subsequently link the sampling points using a quintic polynomial (illustrated in Figure 3). Upon establishing suitable boundary conditions, the trajectory is formulated through the connection of these points with a quintic polynomial.\nThe quintic polynomial is expressed as follows:\n$l = f(s) = a_0 + a_1s + a_2s^2 + a_3s^3 + a_4s^2 + a_5s^5$ (9)"}, {"title": "B. Quadratic programming of trajectories", "content": "The quadratic programming will search in the convex space opened up by the DP, as shown in Figure 4. QP mainly uses the cost function to find the optimal solution in this convex space, that is, the trajectory is output to the control module.\nIn the adopted coordinate framework, the coordinates corresponding to the path point are denoted by (si,ti), while the subsequent point's coordinates are represented by (Si+1, ti+1). QP is utilized to optimize the first and second derivatives of specified points along the trajectory. The tra-jectory is formulated as a quintic polynomial curve l = f(s), with the third derivative maintained as a constant, ensuring that all derivatives of f(s) of order four and higher are zero between any two consecutive points i and i + 1. Subject to the continuity constraints on the second derivative of f(s) and vehicular collision avoidance, the trajectory optimization cost, following a finite-term Taylor expansion at points i and i + 1. Upon incorporating the cost near the reference line, as formulated through quadratic programming, is delineated as follows:\n$Ctotal (f) = W1 \\int (f'(s))^2 ds + w2 \\int f(f''(s)) ds \\newline + W3 \\int (f''(s))^2, (f'''(s))^2 ds + w4 \\int (f(s) - g(s))^2 ds.$ (17)\nWhere, g(s) refers to the rough solution trajectory of DP. The cost function $(f(s) \u2013 g(s))^2$ quantifies the cost to the reference line. A greater path deviation results in an increased cost function value, thereby imposing a higher deviation penalty. The $(f'(s))^2$ represents the cost function for trajectory smoothness. The $(f''(s))^2$ is the curvature cost and $(f''(s))^2$ is the curvature continuity cost.\nAfter completing trajectory planning, we need to carry out velocity planning on this basis."}, {"title": "C. Velocity planning", "content": "Similar to trajectory planning, velocity planning requires a combination of dynamic and quadratic programming for similar reasons. A new Frenet coordinate system is estab-lished with the trajectory as the coordinate axis. In order to simplify the calculation, we regard the obstacle as a particle and construct the ST diagram as follows:\nIn EHMPP, the acceleration stage cost function comprises three components: obstacle, optimal acceleration, and rec-ommended speed costs. In the space-time (ST) diagram, the generated trajectory is represented by S(t) .Simplified within the ST diagram, the obstacle cost represents the minimal distance from a point to a line segment.To differentiate from the previous stage, we denote the derivative of the function f(s), representing acceleration, by si and so forth. Accordingly, the obstacle cost function is derived as follows:\n$Cobs = \\begin{cases}0 & \\text{if } dmin > d1 \\\\ A \\frac{dmin-d2}{2} & \\text{if } d2 <|dmin| < d1 \\\\ +\\infty & \\text{if } |dmin < d2\\end{cases}$ (18)\nWhere, dmin refers to the minimum distance from the obsta-cle.\nFor simplicity, the derivatives are approx-imated by the finite difference method. Simultaneously, we discretize the trajectories into discrete points and evaluate the associated cost function. The cost function for reference speed of the point is defined as:\n$Cref_speed = Wref_speed(s_i \u2014 Vopt)^2$\nwhere si represents the actual speed of the vehicle, and Vopt is the optimal speed.\nEHMPP aims to maintain as Optimal acceleration as possible and accelerate gently to achieve optimal acceleration energy consumption:\n$Cacc = Wacc(s_i - dacc_opt)^2 + Wje(s_i)^2$\nwhere si is the actual acceleration, and si is the jerk of the vehicle. Therefore, we define the cost function of speed planning in the acceleration phase as follows:\n$Cacc_total = W1Cref_speed + W2Cacc + W3Cobs$ (19)\nIn the deceleration phase, EHMPP considers not only the minimum braking distance within the path planning phase but also the optimal drag acceleration during deceleration."}, {"title": "V. EXPERIMENTAL DATA ANALYSIS", "content": "In the experimental environment, Matlab, Carsim, and Per-scan were used to conduct joint simulations to verify the us-ability and results of the strategy in the general environment. The experimental simulation environment covers a series of commands carried out by the car during normal driving, including acceleration, deceleration, uniform speed, lane change, and avoidance. We conduct a comparative analysis of the traditional planner and EHMPP within the same testing environment. After the above experiments, we obtained the time-changing velocity and acceleration of the car before and after the improvement, as well as the planned trajectory. Since this paper emphasizes the influence of strategy on velocity planning, and velocity is influenced by acceleration, we discuss acceleration based on the conclusion. According to the formula, the motor output power of the electric vehicle during operation can be calculated as:\n$P=FV$\nF is the total force of the motor acting on the car, and V is the speed of the car. In this experiment, in order to visually see the effect of the experiment and facilitate calculation, we ignore other forces and only consider the motor power, braking force, and kinetic energy recovery force of the car. The approximate calculation formula of Power (P) is as follows:\n$P\\times a\\times |V|$ (26)\nIn the sampling time, the power is calculus with the sampling time, which is approximately regarded as the total power of the whole process:\n$E = \\int P(t) dt$ (27)\nBecause the data collected before and after were in the same simulation situation, other conditions except the strategy were the same (same vehicle, same road condition, same distance traveled, same sampling time, same recom-mended speed, and cost weight). Therefore, to simplify the calculation, we can discretize the experimental data set: Deceleration stage: In the experiment, the kinetic energy recovery system can provide drag acceleration within the range of 0 to -3, beyond which it needs to rely on vehicle braking. At the same time, the kinetic energy recovery system cannot start to work if the drag acceleration is lower than 0.5 in the deceleration stage, as follows:\n1) With all conditions equal, vehicle drag acceleration be-tween 0 and -0.5 is reduced by 11.74% after deploying the strategy (Figure 6). This indicates that autonomous driving planning, referencing the policy, is biased to decelerate using drag acceleration greater than 0.5, consistent with planning.\n2) In the simulation experiment, during the first half of the busy traffic scenario, the vehicle's EHMPP demon-strated performance consistent with that of the tra-ditional planner, maintaining effective obstacle avoid-ance. However, in the latter half of the day, when traffic conditions were lighter, the EHMPP achieved reduced energy consumption (Figure 7).\n3) The indirect optimization of energy consumption by EHMPP allows the vehicle to sustain optimal output power, thereby enhancing overall energy efficiency and reducing energy consumption.\nIn summary, experiments show that EHMPP significantly improves energy efficiency compared to traditional planners."}, {"title": "VI. CONCLUSIONS AND FUTURE WORKS", "content": "This work introduced EHMPP, a hybrid model predic-tive planner designed to enhance vehicle energy efficiency, address mileage anxiety, and maximize the utilization of vehicle KERS. The core feature of this planner it considers different vehicle motion states during the planning process and apply distinct optimization equations for each state. EHMPP has been validated in an experimental environment and demonstrated a substantial energy-saving effect.\nEHMPP is capable of handling basic autonomous driv-ing scenarios, including the avoidance of multiple static and dynamic obstacles. It plans trajectories by predicting the movements of obstacles over a set period. Future en-hancements to EHMPP could include additional modules to accommodate more complex driving scenarios, further optimizing the energy efficiency of EVs. Additionally, the concept of maintaining optimal power for each device of EVs could be extended to other driving decision planners to optimize their energy consumption."}]}