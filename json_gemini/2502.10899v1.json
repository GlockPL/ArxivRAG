{"title": "Breaking Down the Hierarchy: A New Approach to Leukemia Classification", "authors": ["Ibraheem Hamdi", "Hosam El-Gendy", "Ahmed Sharshar", "Mohamed Saeed", "Muhammad Ridzuan", "Shahrukh K. Hashmi", "Naveed Syed", "Imran Mirza", "Shakir Hussain", "Amira Mahmoud Abdalla", "Mohammad Yaqub"], "abstract": "The complexities inherent to leukemia, multifaceted cancer affecting white blood cells, pose considerable diagnostic and treatment challenges, primarily due to reliance on laborious morphological analyses and expert judgment that are susceptible to errors. Addressing these challenges, this study presents a refined, comprehensive strategy leveraging advanced deep-learning techniques for the classification of leukemia subtypes. We commence by developing a hierarchical label taxonomy, paving the way for differentiating between various subtypes of leukemia. The research further introduces a novel hierarchical approach inspired by clinical procedures capable of accurately classifying diverse types of leukemia alongside reactive and healthy cells. An integral part of this study involves a meticulous examination of the performance of Convolutional Neural Networks (CNNs) and Vision Transformers (ViTs) as classifiers. The proposed method exhibits an impressive success rate, achieving approximately 90% accuracy across all leukemia subtypes, as substantiated by our experimental results. A visual representation of the experimental findings is provided to enhance the model's explainability and aid in understanding the classification process.", "sections": [{"title": "1 Introduction", "content": "Leukemia is a type of cancer that starts in the bone marrow and spreads to the blood. Patients commonly exhibit symptoms such as fatigue, weakness, frequent infections and more [1]. Leukemia ranks among the ten most common cancers, with hundreds of thousands of new cases and deaths every year [2].\nThere are two main leukemia categories based on the speed of progression: acute, which develops quickly and exhibits symptoms within weeks of forming, and chronic, which develops more slowly and may not show noticeable symptoms for years. Based on the type of blood cell affected, these can be further"}, {"title": "2 Related Work", "content": "Previous work focused on detecting and segmenting leukemia cells from microscopic blood smear images [6\u20139], while some worked on classifying a specific type of leukemia against healthy cells [10-13]. However, at the time of writing, the authors are only aware of two papers that work on classifying multiple types against healthy cells, and both target the ALL, AML, CLL, and CML subtypes.\nThe authors in [14] propose using a small custom CNN, using the ALL-IDB [15] dataset as well as some images from the American Society of Hematology (ASH) Image Bank [16]. The authors obtained 903 images and implemented several augmentations to reduce overfitting. Despite this, their results show a large difference between the training and validation accuracies, indicating that their model is greatly overfitting. This can be attributed to the small dataset and overly simplified model. In the most recent paper [17], the authors propose using a pre-trained GoogleNet model, which is fine-tuned on 1,200 images from the ASH Image Bank. The authors do not provide detailed information on the hyperparameters used, making it difficult to study their impact on the model.\nIn summary, both papers lacked sufficient detail regarding the techniques used to attain their results. CNNs utilized were either small or obsolete, having been surpassed in performance by newer models such as ConvNeXt [18] or Vision Transformers (ViTs) [19]."}, {"title": "3 Dataset", "content": "The dataset consists of slices from 84 slides, each representing a patient. It was collected by a local hospital using 1000\u00d7 zoom on each slide. The slides were divided into patches which were annotated by a senior pathologist to obtain ground-truth labels.\nThe dataset, which includes four main leukemia types, normal cells, acute promyelocytic leukemia (APML), and reactive cells, is unique and represents the Middle East, making it the first of its kind for the region. APML is an aggressive, rare subtype of AML, requiring a specific treatment approach [20]. Reactive cells are non-cancerous cells that appear similar to leukemia cells [21]."}, {"title": "3.1 Pre-Processing", "content": "Many steps were taken to refine and clean the data in preparation for training. Specifically, scans with less than four images were excluded, and duplicates were removed. Furthermore, most images had a resolution of 1200 \u00d7 1600; therefore, images with significantly lower resolution were excluded, producing 3710 images. These images have been resized to 384 \u00d7 384. Training and validation sets were created by splitting the data per slide to prevent any leakage and prevent the model from under-performing on unseen data."}, {"title": "4 Methodology Overview", "content": ""}, {"title": "4.1 Flat/Leaf Classification (Baseline)", "content": "This approach is referred to as Flat/Leaf Classification, as it focuses on all 7 \"leaf\" classes seen in Figure 1. The approach is simple and ignores the hierarchy of the classes, which may lead to a loss of information and a potential reduction in performance. In addition, it does not provide classification probabilities for broader classes, such as acute vs chronic which is clinically vital in cases where doctors struggle to decide on the exact leukemia types."}, {"title": "4.2 Hierarchical Multi-Label Classification", "content": "Another way of presenting the dataset is shown in Figure 2, providing a more intuitive structure in a tree-like diagram. This inspired the authors to develop a method that performs classification following this hierarchy. Since the chance of having multiple types of leukemia is unlikely [22], the authors assume non-overlapping subgroups in the data and produce a solution based on that. We proposed two different methods to apply the hierarchical architecture:\nBase Hierarchical Model: Four separate models were trained; each on an individual level of the tree shown in Figure 2. They were then merged during inference to produce the final model. APML was included as a separate class in our study. This is because APML is unique among leukemia types in its excellent response to treatment, requiring immediate attention and intervention.\nProposed Multi-label Hierarchical Model: We've developed a hierarchical deep learning model for image classification, operating sequentially and tiered. The model first differentiates among normal, reactive, and leukemia cases (level 1). If leukemia is detected, it further classifies it as acute or chronic (level 2) and subsequently refines these into subtypes(level 3). These levels are shown in Figure 2. We employ a unique loss control strategy to ensure that the loss at each level is self-contained, preventing cross-layer interference. In essence, each stage of the hierarchy is affected only by its respective loss, promoting precise classifications throughout the model."}, {"title": "5 Experimental Setup", "content": ""}, {"title": "5.1 Model Selection", "content": "We utilize ConvNeXt-Tiny and ViT-Small models as they performed best, as shown in Table 1. Note that these results validate our choice of these models, which were later tweaked to match the proposed model hyper-parameters. For the baseline, the chosen configurations included the Adam optimizer [23], Focal Loss [24], and weighted-cross entropy with a learning rate of $10^{-6}$."}, {"title": "5.2 Simulating Pathological Evaluation", "content": "The holistic examination process taken by pathologists was taken into consideration. Hence, this study introduces a post-processing methodology that aggregates the mode of all predictions per slide (patient) at the end of the validation or testing phases. This approach mirrors the pathologists' diagnostic process and mitigates the impact of minor misclassifications by the models. Consequently, the models yield a singular dominant label per slide, eliminating the occurrence of edge cases that each slide has only one label."}, {"title": "5.3 Experimental Procedures", "content": "We further modified the baseline configurations. Using Focal Loss function instead of weighted-cross entropy enhanced the model's performance. The Adam optimizer was replaced with AdamW with a learning rate of 1 \u00d7 10-6, and each experimental run was limited to 80 epochs for the sake of time, and this was enough for the model to saturate."}, {"title": "5.4 Evaluation Metrics", "content": "Experiments were evaluated using accuracy and F1 score metrics. For hierarchical classification, the hierarchical precision (hP), recall (hR), and F1-score (hF) were computed using Equation 1.\n$hP = \\frac{\\sum |P_i \\cap T_i|}{\\sum |P_i|}$\n$hR = \\frac{\\sum |P_i \\cap T_i|}{\\sum |T_i|}$\n$hF = \\frac{2 * hP * hR}{hP + hR}$  (1)\nThe set Pi contains the most specific class or classes that are predicted for a given test example i and all of its ancestor classes. Likewise, Ti is the set that includes the true most specific class or classes for that test example i and all of its ancestor classes. These sets are used to compute summations over all test examples, and it is important to note that the measures being used are extended versions of the commonly used precision metrics [25]."}, {"title": "6 Results and Discussion", "content": ""}, {"title": "6.1 Flat/Leaf Classification", "content": "The classification outcomes of all seven leaf classes within a flat structure are concisely delineated in Table 2. A performance comparison revealed the ViT-Small model's superior efficacy and accelerated convergence pace compared to the ConvNext-Tiny model.\nAnalyzing confusion matrices revealed challenges in classifying reactive cells, known to pathologists for their ambiguous state between \"Normal\" and \"Leukemia\". Experiments excluding these cells improved performance.\nTable 2 shows performance variations in 5-fold cross-validation due to dataset slides and labeling discrepancies. The lower standard deviation for ViTs, compared to CNNs, in six and seven-class classifications support adopting ViTs."}, {"title": "6.2 Base vs Proposed Hierarchical Classification", "content": "Table 3 presents the comparative analysis of Base and Proposed hierarchical models in ConvNext and ViT architectures. Each level underwent an intermediate evaluation. While the Base model excels in intermediate binary classification due to dedicated tuning, the Proposed model marginally surpasses in seven-class classification due to its automated learning and scalability without the additional overhead of training multiple models separately.\nInterestingly, ConvNeXt outperforms ViT in internal levels, likely due to smaller training data sizes as ViT needs much more data for training; therefore, smaller models fit better. Nonetheless, the highest performance of 90.97% was achieved with the ViT architecture in the Proposed model for all seven classes. Moreover, although the ViT yields high flat/leaf multi-class classification results, the ConvNext-Tiny outperforms the ViT in most binary experiments. This can be due to the reduction of samples for the ViT. ViTs require large quantities of data to obtain reasonable representations [26]."}, {"title": "6.3 Flat vs Proposed Hierarchical Classification", "content": "The comparison between the Flat and Proposed Hierarchical models can be shown in Table 4. These results show that our hierarchical structure is boosting the model performance in terms of precision and recall compared to the flat structure. This is more evident in the \"visually confusing\" classes, such as ALL and Reactive classes, where the flat structure model struggles to differentiate these classes from other classes. However, when placed in a hierarchical structure, it becomes easier for the model to differentiate between these classes."}, {"title": "6.4 Visual Experimental Results", "content": "To verify performance, Grad-CAM was used to visualize the ViT's localization of features by targeting the final stage of the model and generating a heatmap. \nIt is expected that the model should perform well in identifying white blood cells (WBCs) from the images. Figure 3 shows the leaf classification model (middle row) identifying WBCs, but does not distinctively pick-out WBCs from the red blood cells (RBCs). However, the hierarchical model (bottom row) excels at pinpointing WBCs in every sample, signifying its higher effectiveness over the flat model. Yet, the hierarchical model displays certain limitations when interpreting Grad-CAM results. The heatmap spots appear wider in initial levels, becoming most precise at the lowest level of the hierarchy."}, {"title": "7 Conclusion", "content": "Our work demonstrates that multi-label hierarchical classification using ConvNext-Tiny and ViT-Small, holds great promise for leukemia subtype classification. Qualitative results further authenticated the model's reliability by showcasing its localization capabilities.\nNaturally, this work is not without limitations. Early-stage leukemia may not be detectable via blood smear images. Other limitations to consider include the assumption of non-overlapping subgroups in the data.\nFor future research, we recommend gathering more data to enhance model performance. Moreover, studying inter and intra-observer variability could offer comparative insights against real pathologists. Furthermore, implementing newer"}, {"title": "Prospect of Application:", "content": "Leukemia is a curable disease; however, only if diagnosed properly. This work can be deployed to hospitals to reduce pathologists' errors, bias, and fatigue. It can also speed up the detection of leukemia subtypes and potentially save the lives of patients and the costs associated with cancer detection through a non-invasive technique."}]}