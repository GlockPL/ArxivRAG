{"title": "Heterogeneous Graph Neural Networks with Post-hoc Explanations for Multi-modal and Explainable Land Use Inference", "authors": ["Xuehao Zhaia", "Junqi Jiangb", "Adam Dejlb", "Antonio Ragob", "Fangce Guo\u00aa", "Francesca Tonib", "Aruna Sivakumara"], "abstract": "Urban land use inference is a critically important task that aids in city plan- ning and policy-making. Recently, the increased use of sensor and loca- tion technologies has facilitated the collection of multi-modal mobility data, offering valuable insights into daily activity patterns. Many studies have adopted advanced data-driven techniques to explore the potential of these multi-modal mobility data in land use inference. However, existing studies often process samples independently, ignoring the spatial correlations among neighbouring objects and heterogeneity among different services. Furthermore, the inherently low interpretability of complex deep learning methods poses a significant barrier in urban planning, where transparency and ex- trapolability are crucial for making long-term policy decisions. To overcome these challenges, we introduce an explainable framework for inferring land use that synergises heterogeneous graph neural networks (HGNs) with Ex- plainable AI techniques, enhancing both accuracy and explainability. The empirical experiments demonstrate that the proposed HGNs significantly outperform baseline graph neural networks for all six land-use indicators, especially in terms of \u2018office' and 'sustenance'. As explanations, we con- sider feature attribution and counterfactual explanations. The analysis of feature attribution explanations shows that the symmetrical nature of the \u2018residence' and \u2018work' categories predicted by the framework aligns well with the commuter's 'work' and 'recreation\u2019activities in London. The analysis of the counterfactual explanations reveals that variations in node features and types are primarily responsible for the differences observed between the predicted land use distribution and the ideal mixed state. These analyses demonstrate that the proposed HGNs can suitably support urban stakehold- ers in their urban planning and policy-making.", "sections": [{"title": "1. Introduction", "content": "Land use is a term used by urban planners to describe the function of human-made spaces in which people live, work, and recreate on a day-to- day basis. Typically, city planners are responsible for determining land use plans, shaping a city's layout by dictating what types of buildings can be located in a given space. However, due to the complex and dynamic nature of the urban environment, the actual function both activity pattern and intensity may deviate from the intentions of land use planning [1, 2, 3]. For instance, an area initially planned as a commercial zone might gradually transition into a mixed-use area because of population growth and changes in housing demands. As the cities dynamically evolve, this deviation between land use planning and actual usage may widen, leading to inefficient use of resources, community dissatisfaction and social inequality [4, 5]. To support sustainable urban planning and related policies, stakeholders need accurate and effective tools to detect the spatial distribution of human activities. Urban land use inference has been a challenging task for decades. Early studies primarily used simple statistical methods (e.g., linear regressions) [6, 7] and simulation-based methods (e.g., Cellular Automata) [8, 9] with survey data to explore urban growth patterns and dynamics with rule-based interactions. However, these traditional methods rely on over-simplified as- sumptions, struggling to accurately reflect complex real-world scenarios, es- pecially for large metropolitan areas. In recent years, the advent of the era of big data has provided a new paradigm for this problem. Emergent sensor and location technologies have facilitated the collection of human activity-based data, such as mobile phone and mobility records. These passive data sources offer alternative ways for monitoring people's daily activities, facilitating the description of the urban space function. Furthermore, advanced AI models have shown significant promise in handling multi-modal and non-linear data"}, {"title": "2. Literature Review", "content": "This section will begin by reviewing the related work in land use inference. We then overview work on multi-modal data fusion and explainable AI."}, {"title": "2.1. Land use inference", "content": "In the literature on land use, early research used simple statistical ap- proaches (e.g., linear regressions) or simulation-based models (e.g., cellular automata) to understand urban growth patterns. Due to the development of sensor and location technologies, land use modelling has evolved from re- lying on survey data to incorporating activity-based big data (e.g., social media data, mobile data and transport data), enhancing understanding of urban dynamics in a fine-grained manner. In line with this change, there has been a significant shift from traditional model-driven to advanced data- driven methods. For example, Toole et al [1] applied call frequency data and correlation analysis to infer land use types in Boston, USA. The latest trend in urban land use inference incorporates big data and machine learn- ing techniques to provide highly accurate insights and dynamic forecasts of land use. Hu et al [17] employed vehicle GPS and trajectory data, using Graph Convolutional Neural Networks, to categorise road network patterns in Beijing into commercial, public, and traffic types. Similarly, Sun et al [20] applied mobile phone data and deep convolutional autoencoders to deduce various land use types\u2014residential, commercial, business, and industrial-in Wuhan, China."}, {"title": "2.2. Multi-modal data fusion", "content": "The need for fusion of multi-modal data for better accuracy and robust- ness is not unique to land use inference but also exists in many efforts for the development of smart and sustainable cities, such as traffic prediction [35, 36], energy management [37, 38], and healthcare [39]. In urban studies, commonly used fusion strategies can be divided into the following categories: fuzzy logic-based [11, 40], Bayesian-based [41, 42], ensemble-based [43, 44], and graph-based [11, 45, 46]. For the mobility data discussed in this paper, graph-based methods like GraphSages [47] and Graph Attention Networks [48] are particularly effective due to the strong ability to process spatial de- pendency among the facilities in a large-scale graph form. For example, Hu et al [17] introduced a Graph Convolutional Network (GCN) to understand the social function of road segments, showing significant accuracy compared with traditional machine learning. To better characterise the spatial heterogeneity and hierarchy inside the mobility system, we propose a novel hetero-graph deep learning framework for mobility data fusion. As an extended version of Graph Neural Networks (GNNs) - Heterogeneous Graph Networks (HGNs) are designed to handle graph structures with multiple types of nodes and edges. Existing stud- ies have proven that HGNs are highly effective in fusing multi-modal data and representing complex graph structures in various domains, such as rec- ommendation systems [49], biomedical structures [50], and social networks [51]. In scenarios like urban systems, HGNs have been applied to critical problems like traffic prediction, and signal control with significant perfor- mance improvement [36, 52]. However, no research has been undertaken so far on techniques related to the use of HGNs in land use inference. This paper proposes a novel framework using an attention-based heterogeneous graph neural network model to effectively represent the complex interactions within multi-modal mobility systems."}, {"title": "2.3. Explainability", "content": "Recent works on graph-based explanation have provided new tools for understanding the function of elements in heterogeneous mobility graphs. Given the requirement of this paper, two types of analytic XAI methods are considered: feature attribution analysis and counterfactual analysis. Feature attribution methods quantify the approximate importance of individual input features on a particular model prediction through an attribution value. These techniques, such as Integrated Gradients [53] and SHapley Additive exPlanations (SHAP) [54], clarify the roles of input features in the prediction of the outcome and have been suc- cessfully used in understanding graph elements (nodes and edges) in many critical domains, such as molecular science [55, 56] and Internet of Things [57]. Counterfactual explanations demonstrate which changes are needed in the factual input to achieve a different output prediction [58]. These methods have been used in domains like molecular science [59] and recommendation systems [60] to understand how potential changes in the graph might result in desired outcomes. Although these XAI methods have been used to explain GNNs in many critical domains, no studies have applied them to the land use inference problem. Facing this gap, this paper pioneers the use of the integrated- gradient method to analyse how mobility distribution influences the inferred land use types. Additionally, we introduce a new counterfactual explanation notion designed specifically for heterogeneous graph structures, aimed at identifying necessary minimum input modifications to achieve the ideal mixed land use state."}, {"title": "3. Preliminaries", "content": "This section introduces the research problem and the basic concepts for building heterogeneous graph models. We begin by defining heterogeneous graphs.\nDefinition 1. Graph: A graph G is represented as (V,E),where V is a set of nodes (or vertices), i.e., V = {1,..., \u03c5|V|}, and E denotes a set of edges connecting nodes, i.e., E = {e1,..., e|E|}. Each edge e \u2208 E is a pair of nodes (vi,vj) iff vi and vj are connected.\nIn a heterogeneous graph nodes and/or edges belong to different types, as follows:\nDefinition 2. Heterogeneous graph: Let A denote a set of node types and R denote a set of edge types, such that |A|+|R| > 2. Then a heterogeneous graph Gis (V,E) such that there exists a function \u00a2 : V \u2192 A that maps each node with its corresponding node type and a function \u03c8 : E \u2192 R that maps each edge with its corresponding edge type.\nDefinition 3. Meta relation: The meta relation for an edge e = (vs, vt) linked from source node vs to target node vt is denoted as ($(s),\u03c8(e), \u03c6(t)).\nUrban mobility systems can be conceptualised as heterogeneous graph structures with multiple types of service facilities in the form of nodes (e.g., tube and bus stations) and spatial connections among them in the form of edges (e.g., transit routes). Specifically, we consider two categories of edges: edges in the road network and edges in the transit networks. When travellers transfer between different types of stations, they usually need to walk. Therefore, as shown in Figure 1, we regard the connections across various types of nodes as the shortest path on the road network (1, 2, 3). For edges between nodes of the same type, there may be shortest routes in a road network (4) or connecting paths in a specific network, such as a tube network or a bus network (\u2464 and 6).\nGiven the complexities in the data, this paper aims to build an explainable heterogeneous graph-based framework for the land use inference problem. To begin with, the research is framed as a multi-task regression problem. This setting stems from practical considerations: compared with merely categoris- ing land use types, it is more useful for stakeholders to obtain the intensities of different land use because of the need to analyse diversity [3]."}, {"title": "4. Methodology", "content": "Figure 2 illustrates the framework of this methodology, divided into three main parts: a) Graph Building and Sampling: synthesising traffic data into typical daily patterns, collecting edge information from a hierarchical urban mobility network, and sampling heterogeneous subgraphs; b) Graph Neural Network Modelling: processing these subgraphs through a HGN with layer- wise and residual connections, embedding the output into a feature vector, and using a fully connected linear layer to predict land use targets; c) Expla- nation Techniques: using feature attribution explanations to determine the contribution of input features to the predictions and counterfactual explana- tions to explore the impact of changes in the graph structure on prediction outcomes."}, {"title": "4.1. Heterogeneous Attention Embedding", "content": "Given the rich mobility information and road topology information, our primary focus is on effectively embedding structural data and node-level mobility features within urban mobility networks. Inspired by the recent progress of HGNs in social network analysis [61], we propose a Heteroge- neous Graph Encoder based on HGNs. The HGN module aims to learn node representations through predetermined meta-relations. To model the influence of various node types, we utilise a multi-head attention mechanism. Firstly, we define a node feature transformation function that aligns fea- tures xi of nodes vi to a unified feature space, based on their node types \u00f3(i). This is formulated as:\n$h_{i}^{(0)}= W^{\\phi (i)}x_{i},$\nwhere WP is a type-specific linear projection matrix. Through this, we derive the initial node representation hd for node i.\nSubsequently, we implement a multi-head mechanism to compute the message representation $m_{ij}^{(l)}(s, e,t)$ at layer 1 \u2265 0 from source nodes us to target nodes ut. This process accommodates the types of nodes $(s), $(t) and edges (e) in the heterogeneous graph, as expressed:"}, {"title": "4.2. Explainable AI methods for post-hoc explanations", "content": "This section discusses the XAI methods to enhance explainability for land use inference: feature attribution analysis and counterfactual analysis. Two main reasons drive this need: stakeholders, particularly in urban planning and development, need to understand the importance (to decision-making) of specific elements in predictive models, especially for intricate input-outcome relationships. This justifies the use of feature attribution explanations. Ad- ditionally, these stakeholders seek to identify minimal changes that can be"}, {"title": "4.2.1. Feature attribution methods", "content": "The first class of techniques we use to explain the predictions of our model are feature attribution methods. These techniques quantify the approximate importance of the individual input features on a particular model prediction through linear feature attribution scores. Such scores can provide invaluable insights regarding the reasoning of deep learning models and uncover possible issues or biases [62, 63]. In the context of explaining an HGN model M applied to a heterogeneous graph G = (V, E), we can formalise the feature attribution scores as follows. Given a target node in the graph vi \u2208 V and a target output Yi,j, our goal is to compute the attribution scores S\u2208 R|V|\u00d7|\uc9c0 estimating the importance of every node and feature combination for the model output Yi,j. Intuitively, the element Ski of the attribution score matrix provides an estimate of how much the l-th feature of the k-th node, xk,\u0131, affected the j-th output at the i-th node, Yi,j. To get a more holistic view of the importance of the different features, we will also consider the aggregated attribution scores a \u2208 R|F| where $a_{k}=\\sum_{i=0}S_{ik}$. Each element of the aggregated attribution scores vector estimates how much a particular input feature affected the target output when considering its combined effect from all the nodes in the graph.\nIn our work, we use two different feature attribution methods for explain- ing our HGN model Gradient Input [64] and Integrated Gradients [65]. Gradient \u00b7 Input is a simple gradient-based attribution method defined as follows, in our setting:\nDefinition 4. Gradient \u00b7 Input Explanation. Given an explained model M, an input graph G = (V,E), a target node vi \u2208 V and a target output Yi,j, the Gradient \u00b7 Input feature attributions scores are defined as:\n$S_{k, l}^{GI} = x_{kl} \\cdot \\frac{\\partial M(G)_{ij}}{\\partial x_{kl}}$\nThe advantage of Gradient \u00b7 Input is its computational efficiency, its conceptual simplicity as well as its good ability to faithfully capture the be- haviour of the model in the small region around the considered input [66]."}, {"title": "4.2.2. Counterfactual Explanations", "content": "In contrast to attributing model output predictions to parts of input fea- tures, Counterfactual Explanations (CEs) reveal the minimal changes needed from the factual input to achieve a different and more desirable output pre- diction [58]. In this section, we define CEs suitable for the land use inference task with heterogeneous graphs. For graph data, CEs often take the form of subgraphs or modified graph inputs [69] due to the connectivity between the nodes, which is especially the case in land use inference since our interest is always on an area [70]. We start by defining the subgraph consisting of a target node and its neighbouring nodes.\nDefinition 7. 1-hop complete subgraph. Given an input heterogeneous graph G = (V,E) and a target node vi \u2208 V, the 1-hop complete subgraph of vi is defined as G\u2081 = (Vi, Ei), where $V_{i} = \\{V_{j} | e_{i,j} \\in E \\lor e_{j,i} \\in E\\} \\cup\\{v\\}$ and $E_{i} = \\{e_{j,k} | u_{j}, u_{k} \\in V_{i}, e_{j,k} \\in E\\}$.\nAnother concept central to CEs for graph data is the dissimilarity measure between two subgraphs, which allows comparisons of candidate CEs. Specif- ically, suppose we have two candidate subgraph CEs; that which is more similar to the input is considered the better candidate, because it would re- quire less effort to change from the input [58]. Given the multi-modal nature of our data, we design a dissimilarity measure covering the differences in node features, node types, edge types, and (sub)graph structure as follows:\nDefinition 8. Local subgraph dissimilarity. Given an input heteroge- neous graph G = (V,E), two 1-hop complete subgraphs Gi = (Vi, Ei) and"}, {"title": "Definition 9. Counterfactual Explanation.", "content": "Given an explained model M, an input heterogeneous graph G = (V,E), a target node vi \u2208 V with predicted output y\u017c, a desirable prediction result y' \u2260 yi, the counterfactual explanation for v\u00bf's prediction is Gj = (Vj, Ej), the 1-hop complete subgraph for node vj, which is:\n$argmin \\; d(Gi,Gj)$\\n$ v_{j} \\in V \\; y_{j}=y\u2019 $\nOur definition finds a 1-hop complete subgraph from the given hetero- geneous graph data as the CE for a given target node. It is the closest (measured by local subgraph dissimilarity) subgraph to the 1-hop complete subgraph of the target node, among all the subgraphs of nodes which are predicted with a pre-specified desirable prediction by our explained model. Our method has the same spirit as the nearest-neighbour CEs method for tabular data, which finds the closest point in the training dataset as the CE for an input point [72]. Such CEs taken from the dataset have the advantage of lying within the data manifold, therefore they are realistic data and not al- gorithmic artefacts [73]. Additionally, they are more robust to perturbations that could occur in the inference pipeline [74]. Practically, the CEs can be computed as the following. First, initialise the 1-hop complete subgraph for the target node. Then, filter out the nodes predicted with the desirable label. In an iterative procedure, for each of these nodes, take their 1-hop complete subgraph, and compute the local subgraph dissimilarity between the subgraph and the input node's subgraph. The subgraph with the lowest dissimilarity is returned as the CE. As will be seen in Section 5.4.5, we specify a mixed prediction and use CEs to investigate what changes are needed to achieve a community with balanced land use [75, 76]."}, {"title": "5. Empirical Experiments", "content": "5.1. Dataset description\nSince no open-source database currently offers well-processed graph datasets concerning urban mobility data and transport facilities, the first step of our case study is to construct a heterogeneous graph dataset of multi-modal ur- ban mobility information. As shown in Figure 3, London (inner and central) is chosen as the study area due to the high complexity and diversity of its land use. In addition, its dense mobility network allows for fine-grained regional analysis to cover most of the study area. The constructed dataset comprises four parts: node features, edge fea- tures, labels and zoning as described below.\n\u2022 Nodes features. For any mobility station, we use its ridership distri- bution on a 'typical weekday'(as averaged over the weekdays in 2017) as the input nodes feature. This ridership information is provided by the Transport of London (TfL) open data (tfl.gov.uk/info-for/ open-data-users/our-open-data). Specifically, three types of mo- bility services are selected - tube (186 stations), bus (3167 stations) and bike sharing (883 stations) as shown in Figure 3(a). The daily passenger inbound data of each station is processed into 15-minute in- terval ridership from 6:00 to 22:00 (64 input features).\n\u2022 Edge features. The edges are of two types: tube network edges, de- rived from connectivity data among tube stations, as shown in Fig- ure 3(b), and road network edges, based on a comprehensive road network, shown in Figure 3(c). There are specifically five types of road edge categories involved: Primary, secondary, tertiary, residen- tial, and unclassified (a detailed introduction of this information can be found at https://wiki.openstreetmap.org/wiki/Key:highway). These types of edge-level geography information are collected from the Open Street Map and encoded into one-hot vectors to represent the edge-level information. We do not use connectivity in the bus network because the available data does not distinguish the direction of routes among the bus stops. Although including this information would com- plete the heterogeneous map, it is beyond the scope of this research.\n\u2022 Labels. In the land use inference problem, there is no established paradigm for labelling. We adhere to the recommended practices of the most cited foundational studies [1] \u2013 using the density of POIs to characterise the intensity of specific land use characteristics in a region. To ensure comprehensiveness and objectivity, we selected six POI categories from the OSM database: office, sustenance, transport, retail, leisure and residence. Due to the restriction of OSM's API on the quantity of data collected, it is difficult to obtain complete POI data for the London area. Consequently, we chose a few major tags to represent each land use category, as detailed in Table 3 (the specific introduction of the used tags can be found at https://wiki.openstreetmap.org/). The spatial distributions of these labels are displayed in Figure A.9 in Appendix A.\n\u2022 Catchment area. We establish a criterion that assigns each node a catchment area\u2014a circular region centred on the node with a predeter- mined radius. Each node is labelled by the land use indicators within this catchment area. This process considers two types of label tags:\nFor point tags (e.g., locations of different services), count the num- ber of target types within the catchment area.\nFor polygon tags (e.g., parks, buildings), calculate the proportion of the catchment area that these tags cover.\nWe have used a 1 km radius for the catchment area in our analysis. As our focus is on demonstrating the use of heterogeneous graph models, a comparison of different catchment radii and their impacts is left to future work."}, {"title": "5.2. Baseline models for comparison", "content": "In our framework, we compare our proposed HGT model against several baseline methods, including:\n\u2022 Neural Network (NN): A basic neural network model, serving as a foundational benchmark against more complex graph-based models."}, {"title": "5.3. Measurement metrics", "content": "To evaluate the performance of our regression models, we employ three widely recognised metrics: Mean Absolute Error (MAE), Root Mean Square Error (RMSE), and the Coefficient of Determination (R\u00b2). These metrics are essential for assessing the accuracy and predictive quality of the models. They are defined as follows, where n is the number of observations in the test set, yi represents the actual values, and \u0177\u2081 are the predicted values.\n\u2022 Mean Absolute Error (MAE): MAE quantifies the average absolute difference between the predicted values and the actual values, giving an insight into the overall error magnitude without the influence of error direction.\n$MAE=\\frac{1}{n}\\sum_{i=1}^{n}|y_{i}-\\hat{y_{i}}|$\n\u2022 Root Mean Square Error (RMSE): RMSE is a quadratic scoring rule that calculates the square root of the average of squared differences between the predicted and actual values. It emphasises larger errors, which can be particularly important in certain contexts.\n$RMSE=\\sqrt{\\frac{1}{n}\\sum_{i=1}^{n}(y_{i}-\\hat{y_{i}})^2}$\n\u2022 Coefficient of Determination (R-Squared): R\u00b2 is a statistical measure that indicates the proportion of the variance in the depen- dent variable that is predictable from the independent variables. It is used to measure how well the model captures the variability of the dataset.\n$R^2 = 1 - \\frac{\\sum_{i=1}^{n}(y_{i}-\\hat{y_{i}})^2}{\\sum_{i=1}^{n}(y_{i}-\\overline{y})^2}$\nwhere y is the mean of the actual values Yi."}, {"title": "5.4. Results", "content": "These experiments were undertaken on a Linux Ubuntu system, utilis- ing CUDA Version 11.4 with NVIDIA RTX A5000 GPU for deep learning model optimisation. Computations were executed on Python 3.10 within a dedicated virtual environment (Readers can check \u201crequirement.txt\u201d on the GitHub website of this project). For comprehensive model evaluation and testing, we randomly allocated 70% of the samples for training, with the remaining 15% for validation and 15% for testing. To ensure fair compar- isons against multiple baseline models, we used the same hyper-parameters to model, train, and test them, as detailed in Table 4."}, {"title": "5.4.1. Overall accuracy", "content": "This section offers a comprehensive evaluation of various deep learning methods using the London mobility datasets across multiple urban domains. Models evaluated include the proposed HGT framework compared with base- line methods mentioned in Section 5.2. The improvement percentage (Impr.) over the baseline neural network model underscores the effectiveness of these models in inferring land use. The results in Table 5 indicate a consistent improvement in performance when transitioning from general deep learning models to complex graph- based models. The HGT model consistently delivers the highest improvement percentages across all categories, showing its capability to handle heteroge- neous graph data. Specifically, the \u2018Sustenance' indicator has substantial benefits from graph-based models, with the HGT achieving MAE improve- ments of 68.35%. The RGCN and HGT models consistently outperform others, probably due to their ability to capture heterogeneous relationships within the mobility and topology structure. The smallest improvement is noted in the 'leisure' land use indicator, suggesting that there might be un- observed information which could boost predictive accuracy."}, {"title": "5.4.2. Spatial residual distribution", "content": "To better understand the function of heterogeneous graph models at the individual level, we compare the geographical distribution of residuals in the geometric map between GCN and HGT. Figure 4 illustrates an example of one of the land use indicators -\u2018Residence', where the size of the circular markers indicates the absolute value of the residuals. The colour of each marker indicates whether the residual is positive or negative: red for over- predicted values and blue for underestimated values. Similar comparisons of other land use indicators can be found in Figure B.10 in Appendix B. A comparison in Figure 4 reveals that the circular markers in HGT are smaller overall than those in GCN. Additionally, a continuous distribution of red and blue colours in the GCN map suggests that the model consis- tently overestimates or underestimates certain areas or roads. This suggests unobserved heterogeneity is hindering the model's performance. HGT sig- nificantly improves this issue, displaying a more uniform colour distribution in its corresponding maps. According to Figure B.10, the same observations applied in other land use indicators like 'leisure' and \u2018retail\u2019."}, {"title": "5.4.3. Ablation analysis on connectivity in the graph", "content": "Given the significant improvement of GNN models illustrated in Table 5, this section delves into the role of connectivity and neighbouring nodes. Specifically, we constructed four scenarios by removing some of the nodes and connections: a) all nodes and edges; b) only bus and bike nodes with their edges; c) only bus and tube nodes with their edges; d) only bus nodes with their edges. Owing to the limited number of bike and tube nodes, these modes were not assessed as separate scenarios. We use R-square as the measurement for comparison as shown in Figure 5.\nAccording to Figure 5, we can draw two conclusions. First, increased connectivity enhances performance across all metrics in all graph models."}, {"title": "5.4.4. Feature attribution analysis", "content": "This section examines feature attributions \u2013 the impact of the daily mobil- ity distribution on the outcome using the Approximate Integrated Gradients index. The results are displayed in a heatmap format, where red indicates a positive correlation and blue a negative correlation between input features of different 15-time intervals and land use indicators, as shown in Figure 6. The feature attribution results in Figure 6 closely align with the general understanding of human activities in London, illustrated in three categories with different characteristics. The first category, comprising transport, of- fice, and sustenance, is primarily associated with work-related activities. This category shows a high sensitivity to commuter inflow during peak hours. Specifically, inflow is lower in the morning (10:00-11:00 AM) and significantly higher in the evening (5:00-6:00 PM). This indicates that areas with these land uses attract more commuters returning from work in the evening than departing in the morning. Besides, a subtler trend shows that Category 1 (work-related) stations experience reduced feature importance in the early evening (6:45-7:45 PM) and increased importance later at night (8:45-9:45 PM). This likely reflects a common urban lifestyle pattern, where individu- als engage in leisure and entertainment activities after returning home from work. In contrast, the second category, consisting of residential land use areas, exhibits a reverse trend with higher morning inflow and lower evening inflow. This reflects typical residential patterns where people leave for work in the morning and return in the evening. The third category, including leisure and retail, is less affected by in- flows at peak hours. Notably, these areas show minimal variation in in- flow during peak hours but have varied activity during other times, such as evenings (presumably after work), which aligns with shopping and leisure activities. It is important to note that various feature attribution methods might produce different outcomes. Our comparison of two methods, Integrated Gra- dients (Figure 6) and InputX-Gradient (Figure B.11 in appendix), illustrates this point. Integrated Gradients are generally considered more reliable be- cause they account for changes over a broader range, offering a more compre- hensive understanding of feature importance. Conversely, InputX-Gradient, focusing on a single point gradient, failed to align with the general context. As shown in this case, the importance of heatmap from the Integrated Gra- dient method aligns more closely with the characteristics of human activity in London, reflecting our understanding of the comparative performance of the methods."}, {"title": "5.4.5. Counterfactual explanation analysis", "content": "In the previous section, we focused on the explainability of our model by analysing the feature attribution of node features. Although this analysis offered valuable insights into individual node attributes, it did not account for the importance of other critical factors such as node types, edge types, and the overall graph structure. To overcome this limitation, this section introduces counterfactual analysis for a more comprehensive understanding of our model. We set \u2018mixed' as an expected scenario. Mixed land use refers to an area with balanced facilities and diverse activities, crucial for enhanc- ing urban vitality, reducing commute distances, and promoting sustainable development [76]. Mathematically, given the predicted land use intensity Yi,j from the main models, we applied the Shannon diversity index to quantify the diversity of land uses within each area. The Shannon diversity (SD) is calculated as follows:\n$SD_{i} = -\\sum_{j \\in T} \\frac{y_{i,j}}{\\sum_{j \\in T}y_{i,j}} \\ln (\\frac{y_{i,j}}{\\sum_{j \\in T}y_{i,j}})$\nwhere Yi,j/ \u03a3\u03b5\u03c4 Yi,j represents the proportion of land use of type i in the area. This formula provides a diversity score for each area to reflect the variety of land uses present. After calculating the diversity scores for all areas, we ranked them in descending order. The areas with the highest diversity scores, representing the top 10% of all nodes, were classified as 'mixed' land use types. This approach ensures that we focus on regions that already demonstrate a high level of land use diversity. Based on the mixed land use based Counterfactual Explanations (CEs), this counterfactual analysis is conducted in two parts. Initially, we perform a local-level analysis to demonstrate the practical application of CEs. In this analysis, we select a specific input node and target a \u2018mixed' land use prediction as the desired outcome. We identify a CE for this node and compare it with the original input to underscore the necessary changes for achieving the target prediction. Secondly, we conduct an aggregated-level analysis to demonstrate how dissimilarity measures for CEs can illuminate the importance of factors such as node features, node types, edge types, and graph structure. Local-level analysis. We present CEs for two example input nodes which do not belong to the \u2018mixed' land use area; these are the inputs 1 and 2 which are located in Central and East London respectively (Figure 7). We compute"}, {"title": "6. Conclusions", "content": "This paper builds an explainable graph-based framework for inferring land use from multi-modal mobility data in complex urban scenarios. In this framework, a Heterogeneous Graph Transformer model is introduced to fuse multi-modal mobility information for land use inference tasks. Next, two types of explainable AI methods enhance the models' transparency and extrapolab"}]}