[{"title": "Koopman-driven grip force prediction through EMG sensing", "authors": ["Tomislav Bazina", "Ervin Kamenar", "Maria Fonoberova", "Igor Mezi\u0107"], "abstract": "Loss of hand function due to conditions like stroke or multiple sclerosis significantly impacts daily activities. Robotic rehabilitation provides tools to restore hand function, while novel methods based on surface electromyography (sEMG) enable the adaptation of the device's force output according to the user's condition, thereby improving rehabilitation outcomes. This study aims to achieve accurate force estimations during medium wrap grasps using a single sEMG sensor pair, thereby addressing the challenge of escalating sensor requirements for precise predictions. We conducted SEMG measurements on 13 subjects at two forearm positions, validating results with a hand dynamometer. We established flexible signal-processing steps, yielding high peak cross-correlations between the processed SEMG signal (representing meaningful muscle activity) and grip force. Influential parameters were subsequently identified through sensitivity analysis. Leveraging a novel data-driven Koopman operator theory-based approach and problem-specific data lifting techniques, we devised a methodology for the estimation and short-term prediction of grip force from processed SEMG signals. A weighted mean absolute percentage error (wMAPE) of ~5.5% was achieved for the estimated grip force, whereas predictions with a 0.5-second prediction horizon resulted in a wMAPE of ~17.9%. The methodology proved robust regarding precise electrode positioning, as the effect of sensing position on error metrics was non-significant. The algorithm executes exceptionally fast, processing, estimating, and predicting a 0.5-second sEMG signal batch in just ~30 ms, facilitating real-time implementation.", "sections": [{"title": "I. INTRODUCTION", "content": "The concept of sensing gripping force from muscle activity through the non-invasive surface electromyography (SEMG) method is based on a group of muscle fibers called motor units (MU), which are activated by brain motor neurons.\nThe EMG signal is obtained as an interference of firing signals from each MU, known as motor unit activation potential (MUAP). Factors such as electrode placement, size, and inter-electrode distance, as well as tissue characteristics (such as fat layers and skin conductivity), temporal and spectral characteristics of the firing patterns, and cross-talk from neighboring muscles, all influence the variability of the EMG signal [1].\nIn [2], the authors predicted pinching force using a 6-channel SEMG sleeve, focusing on the RMS feature of the signal. They employed the gene expression programming algorithm and reported RMSE errors of 7.5-8.5% and cross-correlation coefficients up to 95%. The study examined four MVC levels (20%, 40%, 60%, and 80%) but did not test predictions near the transient states between these levels. In [3], the authors used sEMG with four bipolar electrodes on the forearm and finger force signals to predict grip force. They employed five EMG features and eleven finger force features, achieving a mean accuracy of 90% for grip force prediction in the transient phase. The study found that optimal sensing stabilized at three positions with 2\u20134 features. Electrode positioning on the forearm for grip force sensing was also explored in [4]. The study identified the brachioradialis muscle as optimal based on EMG signal strength. In [5], EMG signals were acquired using an eight-channel Myo's armband, and an LSTM network predicted normalized pinching force 1, 3, and 5 seconds ahead directly from the EMG data. Based on [6], which used eight sEMG sensors and 24 healthy subjects, extrinsic muscle coordination reliably predicted grip and pinch force levels due to its greater sensitivity to force changes compared to intrinsic muscles. Some studies, including [7] and [8], have focused on predicting gripping force from the transient phase of EMG signal, which is the initial burst when the muscle begins exerting force. In [7], a high-density 192-channel SEMG sensor setup was employed on 12 subjects to predict grasp force. This prediction utilized ten features and regularized linear regression, achieving absolute errors as low as 2.5% of MVC. Additionally, in [8], online predictions of gripping force were obtained from 8 SEMG sensors placed on the forearms of 16 participants. The model included ten features extracted from the EMG signal. Predictions were made 330 ms ahead using the elastic net regression algorithm, resulting in errors of 2% of MVC.\nIt is evident from the above analysis, as well as the findings highlighted in [9], that while the majority of the research has achieved favorable results in terms of accuracy, it relies on a high-and constantly increasing number of necessary SEMG sensors for the accurate prediction of grasping force. Additionally, existing methods often overlook advanced signal processing techniques, which are crucial for extracting the meaningful portion of the raw EMG signal. This signal is essential for causal modeling of grip force but is consistently affected by noise. Moreover, forecasts during the transient state are rarely taken into account. Our research is the first to develop an online modeling and signal-processing framework for estimating and short-term forecasting grip force based on Koopman operator theory (KOT) [10]. The main contributions of this work are as follows:\n\u2022 We devised and optimized a composition of EMG signal processing methods, achieving high peak cross-correlations between EMG and grip force signals using a single sensing position on the forearm.\n\u2022 We devised a novel Koopman-based data-driven approach with problem-specific observables for estimating and short-term predicting grip force in real-time during both transient and plateau phases.\n\u2022 The devised methodology enables fast execution, thus facilitating real-time implementation."}, {"title": "II. MATERIALS AND METHODS", "content": "This study involves obtaining time-series data on human muscle activity through sEMG and measuring hand grip force with a manual dynamometer. The dynamometer's shape necessitated a medium wrap type of grasp, following the taxonomy developed by [11] and further refined by [12]. This approach contrasts with some studies, such as [4], which use the strength of the EMG signal as a criterion for predicting grip force.\nTo minimize prediction errors, we considered SEMG positioning on the forearm to maximize signal measurement. Advanced signal processing techniques were employed to extract relevant features from the EMG signals and establish a robust correlation with grip force. Offline optimization of decision variables was also conducted.\nA crucial aspect of the research involves the signal filtering step, essential for proper inferences using EMG signals, which are often largely affected by noise and cross-talk between muscles. The signals are typically processed using notch filtering at 50 Hz to eliminate ground noise [3], bandpass filtering between approximately 10 and 500 Hz to remove wire movement artifacts [6]-[9], bandpass filtering between 100 and 500 Hz [4], and bandpass filtering that captures only power spectrum peaks between 20 and 60 Hz [5]. In contrast to such \"general\" filtering approaches, we focused on signal process-ing aimed at extracting only meaningful features (comparable to observables in KOT) from the sEMG signal those highly correlated with grip force that can later be applied within the KOT framework for accurate modeling and prediction. This strategy reflects elements of the structural approach to SEMG modeling in [1], which states that recruiting MUs is fundamental for generating muscle force. When more MUs are recruited, the muscle produces greater force, and the firing rate of each MU further amplifies this force. Generally, MU firing rates increase almost linearly with the muscle's force output. These firing patterns and the interference between the active MUs influence the characteristics of the measured sEMG. We aim to isolate the difficult-to-identify signal components, specifically the recruited MUs, their interference patterns, and firing rates that predominantly contribute to measured grip force during a medium wrap. This approach helps separate the meaningful signal from unwanted noise. We utilized Fast Fourier Transformation (FFT) and sensitivity analysis (SA) to develop a spectral mask that selectively targets specific spectral components to achieve this. The aim is to develop a fully integrated module for EMG signal preprocessing, including calibration and normalization. Additionally, the module will incorporate grip force prediction using the KOT.\nIn Section II-A, we describe the hardware components and their calibration. Section II-B explains the composition of EMG signal processing steps and describes the SA and optimization methods. Finally, Section II-C delves into the details of the Koopman methodology used for predicting and estimating hand grip force from EMG signals."}, {"title": "A. Experimental Setup & Design", "content": "Two different sensing devices were used during the ex-perimental phase: Shimmer3 EMG Unit\u00b9 for muscle activity sensing and Vernier Go Direct\u00ae Hand Dynamometer\u00b2 for grip force measuring. Both devices are wireless and connect to PC through Bluetooth. The EMG sensing unit records the electrical activity on the skin surface associated with muscle contractions. It can capture response signals from entire muscle groups but is commonly prone to noise. In the performed experiments, the EMG sampling rate was set to 1 kHz. A maximum internal gain of 12 was used, and an internal calibration procedure was followed. The dynamometer, with a force range of 0 to 550 N, a resolution of 0.05 N, and an uncertainty of 1.96 standard deviations (95% confidence interval), was used at a sample rate of 200 Hz.\nBefore performing experiments, the reference dynamometer was calibrated in-house according to ASTM E74: Standard Practices for Calibration and Verification for Force-Measuring Instruments norm. Calibration weights of OIML classes F1, M1, and M3 were used, and the laboratory temperature was maintained at approximately 23\u00b0C. Calibration forces ranged from 0 to 550 N in steps of 5, 20, 50, 100, 150, 200, 250, 300, 350, 400, 450, 500, and 550 N. The instrument was first preloaded from minimum to maximum force to establish hysteresis. Each measurement was preceded by reducing the instrument to zero between successive loadings, and the entire process was repeated three times. For measured forces greater than 50 N, the uncertainty as a percentage of the measured force is less than 4%, while for forces below 50 N, the percentage can be as high as 10%. The obtained calibration equation that relates the raw dynamometer signal $g_r$ to the reported grip force $\\hat{g}$ is:\n$\\hat{g} = 1.0629g_r - 2.5880 \\times 10^{-4}g_r^2 - 9.0028 \\times 10^{-8}g_r^3 + 7.6152 \\times 10^{-10}g_r^4.$\t\t(1)\nAlthough the most prominent term in (1) is linear and close to 1, a fourth-degree polynomial was deemed necessary due to the strict demands of the ASTM E74 norm.\nThe Robot Operating System (ROS) and Python were utilized to integrate devices and enable the acquisition of time-series raw EMG and calibrated dynamometer signals across all experiments. The implemented modules are available in the first author's GitHub repositories, namely godirect_ros\u00b3 and shimmer_ros4.\nWe aim to accurately predict grip force using two electrodes positioned at one sensing location, with a third (neutral) electrode serving as a reference in the final setup. This configuration is used because the EMG signal is typically very small relative to environmental noise, such as interference from power sources. Common Mode Rejection (CMR) takes advantage of the fact that environmental noise affects all electrodes similarly. By subtracting one signal from another, the common noise is cancelled out, while the local EMG signal, which varies with electrode position, is preserved and amplified. This approach improves the clarity of the EMG signal despite significant background noise.\nDuring the experimental design phase, a 2-factor random-ized block design (RBD) [13] was selected as the appro-priate design. In the preliminary phase, various positions for attaching electrodes were tested. Ultimately, two sensing positions on the human forearm, near the flexor carpi ulnaris muscle (see Fig. 1), were chosen for further analyses based on a simple screening experiment considering only signal strength. The electrode positioning corresponds to one of the configurations evaluated in previous studies [4], [9]. A subject variable is viewed as a nuisance during the design procedure. An experiment was conducted with 13 male volunteers aged 22 to 245 Blocking was used to remove the effect of the subject, considered nuisance variable, allowing the effect of the measuring positions on estimation and prediction errors to be examined. Randomization was applied within each block. Prior to experiments, skin for each subject was prepared by removing hair near measured positions, while alcohol swabs were used to clean the skin at the measuring location. Each subject was allowed several minutes to prepare for the experiment and adjust the grip to approximate the required five force levels. In all the experiments, the first 5 seconds of the acquired data were used to zero the dynamometer signal at the measuring position. The transitions between grip force levels were also recorded."}, {"title": "B. Multi-step sensitivity analysis and procedural parameter optimization", "content": "The optimization procedure aims to maximize the peak cross-correlation between the processed EMG signal and the synchronously collected grip force. We performed multi-step SA to identify the most influential spectral components and narrow the optimal bounds for decision variables. Narrowing was achieved by examining scatterplot projections of individ-ual decision variables with smoothed trends and means using Latin hypercube (LH) sampling. Simultaneous optimization and SA ensure that cross-correlations remain near their op-timal values, even when small variations are introduced. This approach enhances local robustness, helping to avoid unstable maxima and maintain consistent performance.\nFirst, data is processed in batches of approximately 0.5 seconds (496 data points) with a sampling rate of 992.97 Hz for EMG signals. Each batch is transformed into the frequency domain using FFT, achieving a resolution of 2.002 Hz. A spectral mask, obtained through an optimization process, is then applied to attenuate or amplify frequency components selectively. After modifying the amplitudes, an inverse FFT reverts the signal to the time domain. Signal rectification is performed by taking the absolute value, followed by windowed exponential moving average (MA) smoothing. The smoothing window is applied within each batch, except for the first (window size - 1) points, where data from the previous batch is utilized. In addition to the spectral mask, the optimization also targets finding the optimal window size and decay factor for exponential smoothing. The entire process for obtaining optimal processed EMG signal is schematically outlined in Fig. 2. The high-dimensional optimization problem was for-mulated to maximize the mean peak cross-correlation across all measurements using a decision vector comprised of 250 variables. The entries and initial bounds of the decision vector are:\n\u2022 Spectral mask with 248 entries corresponding to each frequency bin (without DC offset) ranging from 0\u20135,\n\u2022 Exponential smoothing window size ranging from 2\u2013495,\n\u2022 Exponential smoothing decay factor ranging from 0-0.05.\nThe DC offset was set to zero and excluded from the op-timization process. Initial mask bounds were set within the 0-5 range, allowing either complete removal of a spectral component's amplitude or amplification by up to five times. In contrast, the decay factor bounds were designed to support simple MA (if set to 0) and exponential MA (if greater than 0). Broad bounds on the window size also enabled fine-tuning of the applied smoothing. The objective function for optimization was defined as the peak cross-correlation between the processed EMG signal and measured grip force. Since the problem is framed as a minimization, the function returns 1 minus the mean peak cross-correlation-yielding near-zero values for high cross-correlations and values close to one for low cross-correlations. Due to differences in sampling rates-where the EMG signal is sampled five times faster than the dynamometer-the grip force signal was resampled using EMG timestamps. Intermediate points were estimated using linear regression to ensure proper signal alignment for cross-correlation computation. We hypothesize that not all 248 FFT frequency bins significantly impact the cross-correlation. To address this, a multi-step SA is conducted prior to optimization to narrow the problem's scope and identify the most influential spectral components. Preliminary SA is performed first with grouped spectral mask variables to gain higher-level insight into cross-correlation sensitivity to smoothing and filtering. Grouped Sobol variance-based SA was performed separately on each dataset, corresponding to two EMG measurement positions (see Fig. 1). For each position, 65536 (216) samples of 250-dimensional decision vectors were generated using Saltelli's sampling scheme. Bootstrapping with 216 resamples was applied to account for uncertainty, creating additional datasets by sampling the original one with replacement. Sen-sitivity indices (SI) were then calculated for each bootstrapped dataset, and empirical distributions were generated. From these distributions, 95% confidence intervals were derived. Fig. 3a presents the obtained first-order and total-order SI. The sum of all three first-order and total-order indices approximates 1, indicating that they can reliably approximate the percentage of output variance attributable to each variable, and interactions between variables can be safely ignored. When sampling the problem within the initial bounds, the contributions of smoothing parameters and the spectral mask to the variance in mean peak cross-correlation depend on the measurement position. Smoothing window size is the most influential factor, explaining between 47% and 65% of the output variance in peak cross-correlation for both positions. The decay factor contributes approximately 20\u201324%, while the frequency mask shows the most variance, ranging from 14% on P1 to 37% on P2. Additional LH sampling with 10,000 decision vector samples was conducted within the same bounds to investigate the partial contributions of smoothing parameters further. Fig. 3b displays the resulting projections onto the decay factor and window size. Increasing the window size improves the peak cross-correlation until it reaches a plateau, supporting the decision to narrow the window size bounds to the 200-495 range for subsequent SA steps. Conversely, increasing the decay factor shows a decreasing trend in peak cross-correlation, so we further narrowed the range to 0-0.01. The grouped SA was repeated with the narrowed parameter bounds, where the spectral mask contributed to 88% of the variance in P1 and 95% in P2. This highlights the necessity of ungrouping the mask for more detailed analysis in the subsequent steps.\nThe goal of iterative multi-step ungrouped SA is to reduce the dimensionality of the optimization problem by decreasing the number of spectral mask frequencies and identifying the ones that contribute most to the mean peak cross-correlation variance. This time, a more efficient RBD-FAST SA method [14] was used, returning only first-order SIs, with 65536 decision vector samples and resampling with bootstrapping using 8192 (213) samples for CI computation. After each step, the projections on the most sensitive spectral compo-nents, or smoothing parameters, were visualized using LH sampling with 10000 samples, and manual bounds narrowing was performed. The first step identified the 2 Hz spectral com-ponent as the most influential on cross-correlation variance, with an SI in the 78-83% range. The LH sample projection onto the 2 Hz component showed that increasing its mask variable significantly reduces the mean peak cross-correlation, prompting narrowing of its variable bounds to the 0-0.5 range. Additionally, LH sampling was projected onto the next three spectral components with the highest SI from the first SA step. Similar trends to those observed for the 2 Hz component were noted, prompting the narrowing of bounds to 0-1 for 4 Hz, 0-2 for 6 Hz, and 0\u20133 for 50 Hz. Another 18 steps (2\u201319) of iterative SE were performed similarly, and the top spectral components with narrowed bounds after each step are presented in Figure 4. Figures displaying LH sampling projections, along with smooth and mean lines that support the reasoning behind the narrowing of bounds, can be found in the first author's GitHub repository6. In a step-by-step analysis, a reverse funnel-shaped pattern can be observed (indicated by the two red arrows), with one starting point at low-frequency components and the other around 50 Hz. This pattern highlights the transition from the most influential spectral components to the less influential ones.\nAfter the 19th step of ungrouped RBD-FAST SA (Fig. 4), the sum of all SIs corresponding to frequency masks >=204 Hz amounted to less than 2% contribution. Therefore, the highest spectral component considered for further analysis was 202 Hz. This is consistent with [15], which indicates that most of the sEMG power spectrum is concentrated below 250 Hz. Next, LH sampling was performed twice within the newly obtained parameter ranges, followed by plotting and visually inspecting the influence trend of each of the 201 remaining spectral components (2\u2013202 Hz). The mean and smooth lines were examined to narrow the bounds further around the optimal point visually. In the last two steps (20th and 21st), optimal bounds were identified (Fig 4) and used as the final cutoff values. Optimal smoothing parameters reveal interesting trends:\n\u2022 Increasing decay factor decreases peak cross-correlation, and optimal values are close-to-zero (0\u20135 \u00d7 10-4), indicating a need for simple MA.\n\u2022 Window size shows an optimum in the 275-330 range."}, {"title": "C. Koopman-driven estimation and prediction of hand grip force", "content": "The first part of this subsection briefly introduces the KOT and relevant literature", "by": "n$x_{i+1"}, "F(x_i)$,\t(2)\nHere, F is the potentially nonlinear state transition function $F : \\mathcal{M} \\to \\mathcal{M}$, and $x_{i+1}$ represents the time-shifted state. Modeling a system in state space generally requires capturing nonlinearities, which are essential for accurately describing dynamical behavior but can be highly complex or even impos-sible. To address this challenge, we adopt an operator-theoretic perspective on the dynamics of observables [10"], "phi": "mathcal{M"}, {"16]": "n$\\phi(x_{i+1"}, ["F(x_i)"], [10], [17], {"K": "mathcal{O"}, {"as": "n$E = [\\phi(e_1)", "17]": "n$\\min_K ||G - KE||_F \\Rightarrow \\hat{K"}, {"as": "n$\\mathbf{E"}, {"bounds": "n\u2022 For etd(n)[1]: lower limit $b_i$", "tau_1$]": "lower limit $b_j$", "tau_2$]": "lower limit $b_k$", "as": "n$\\chi_{S_{ijk"}, {"7)": "n$e_{I", "vectors)": "n$\\begin{aligned"}, {"is": "n$\\begin{bmatrix"}, {"g_{e,lift(i)}$": "n$G_{e", "problem": "n$\\sum_{i=1"}, {"using": "n$\\hat{g}_{e, lift (N-d+\\tau)} \\approx \\sum_{j=1}^{l} z_j a_{j} \\lambda_{j}^{N-d+\\tau -1},  \\tau = 1,....$\\"}]