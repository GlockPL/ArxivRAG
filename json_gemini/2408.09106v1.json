{"title": "Fragment-Masked Molecular Optimization", "authors": ["Kun Li", "Xiantao Cai", "Jia Wu", "Bo Du", "Wenbin Hu"], "abstract": "Molecular optimization is a crucial aspect of drug discovery, aimed at refining molecular structures to enhance drug efficacy and minimize side effects, ultimately accelerating the overall drug development process. Many target-based molecular optimization methods have been proposed, significantly advancing drug discovery. These methods primarily on understanding the specific drug target structures or their hypothesized roles in combating diseases. However, challenges such as a limited number of available targets and a difficulty capturing clear structures hinder innovative drug development. In contrast, phenotypic drug discovery (PDD) does not depend on clear target structures and can identify hits with novel and unbiased polypharmacology signatures. As a result, PDD-based molecular optimization can reduce potential safety risks while optimizing phenotypic activity, thereby increasing the likelihood of clinical success. Therefore, we propose a fragment-masked molecular optimization method based on PDD (FMOP). FMOP employs a regression-free diffusion model to conditionally optimize the molecular masked regions without training, effectively generating new molecules with similar scaffolds. On the large-scale drug response dataset GDSCv2, we optimize the potential molecules across all 945 cell lines. The overall experiments demonstrate that the in-silico optimization success rate reaches 94.4%, with an average efficacy increase of 5.3%. Additionally, we conduct extensive ablation and visualization experiments, confirming that FMOP is an effective and robust molecular optimization method.", "sections": [{"title": "Introduction", "content": "Molecular optimization plays a crucial role in drug discovery (Xia et al. 2024), which involves the modification and improvement of lead compounds identified through initial screening to enhance their drug-like properties (Wu et al. 2022). Historically, molecular optimization is planned manually according to knowledge and experience in the pharmacology, and optimized through fragment-based screening or synthesis (Chen et al. 2021). However, manual molecular optimization is not easily scalable to different needs and cannot be automated for large-scale optimization; thus, this strategy is insufficient for meeting the demands of current drug discovery (Schneider et al. 2020).\nIn recent years, deep learning (DL) methods, particularly diffusion models (Ho, Jain, and Abbeel 2020), have been observed to effectively optimize molecules that meet specific conditions (Zhou et al. 2024; Gu et al. 2024), with the potential to accelerate traditional paradigms. Molecular optimization can rapidly identify potential drug candidates using existing experimental data and molecular structures, reducing the need for blind experimentation and enhancing research efficiency (Choudhuri et al. 2023). Several molecular optimization methods have been proposed to enhance candidate molecule performance, such as target pocket- (Huang et al. 2024) and property-based molecular optimization (Lee et al. 2024).\nTarget pocket-based molecular optimization methods rely on understanding specific pocket structures and their hypothesized roles in combating diseases (Moffat et al. 2017). Challenges such as a limited number of available targets and difficulty capturing clear structures hinder innovative drug development. In contrast, phenotypic drug discovery (PDD) (Vincent et al. 2022a) does not depend on well-defined target structures and can identify hit compounds with novel and multi-target properties. PDD emphasizes the phenotypic effects of molecules within disease-related biological systems (Sadybekov and Katritch 2023) and has significantly contributed to the discovery of first-in-class drugs (Swinney 2013). By observing the phenotypic changes that molecules induce in cells, tissues, or organisms, PDD identifies potential drugs without requiring prior knowledge about specific targets (Vincent et al. 2022b). As a result, PDD's potential as a drug discovery tool that addressing complex diseases that are not yet fully understood by the scientific community is evident. Extensive PDD research has been conducted, with significant efforts made in constructing relevant datasets such as the genomics of drug sensitivity in cancer (GDSC) (Yang et al. 2013; Garnett et al. 2012). Based on these datasets, numerous artificial intelligence-driven methods (Hostallero et al. 2023; Li et al. 2024b,c) have been proposed to predict drug responses against specific cell lines, typically quantified by the half-maximal inhibitory concentration (IC50) (Cho et al. 2022). These advancements have significantly accelerated PDD research (Reddy and Zhang 2013).\nBased on prior knowledge, molecular optimization methods specifically designed for PDD have not been proposed, primarily due to several challenges in this field. First, encoding molecular interactions with cellular systems differs significantly from existing target-based molecular optimization approaches. Second, the evaluation metrics for these tasks vary, making direct adaptation challenging. While the physicochemical drug properties (e.g., lipophilicity and solubility) can be measured quickly and cost-effectively (Morehead and Cheng 2024; Xiong et al. 2023), and drug-target affinities can be accurately predicted using existing virtual screening techniques (Ru et al. 2022; Lu et al. 2022), these approaches are not directly applicable to PDD. In the context of PDD optimization, the ideal evaluation metric is the IC50 value, which reflects the interaction between molecules and cell lines. Although determining IC50 values experimentally is time-consuming and expensive, they can be predicted by drug response prediction (DRP) models within a certain margin of error. By evaluating the predicted IC50 distribution of an optimized molecular set, we can assess the optimization model's effectiveness, thereby mitigating the impact of prediction errors.\nFor this reason, we propose a fragment-masked molecular optimization method for the PDD (FMOP). As shown is Fig. 1, the FMOP method's optimization conditions include the initial molecule to be optimized, its corresponding masked fragments, the target cell line, and the IC50 value. Notably, the IC50 is an efficacy measure of a single drug response against one specific cell line, obtained through the wet experiment. The output is a batch of optimized molecules under specified conditions. In addition, FMOP employs a regression-free diffusion model to conditionally optimize the molecules' masked regions, effectively generating new molecules with similar scaffolds and improving IC50 without training. Specifically, molecules' fragment masks are primarily based on scaffolds and side chains in the molecular structure. First, we apply rule-based constraints to the fragmentation results. Then, we use a pre-trained diffusion model as the generative prior and adjust the unmasked region sampling process during the reverse diffusion iteration using the given drug information, without modifying or conditioning the original diffusion model.\nOn the large-scale drug response dataset GDSCv2 (Yang et al. 2013), we conduct optimization experiments on all 945 cell lines, demonstrating an in-silico optimization success rate of 94.4% and an average efficacy increase of 5.3%. Additionally, through extensive ablation and visualization experiments, we further demonstrate that FMOP is an effective and robust molecular optimization method with broad application prospects in PDD. This paper's contributions are as follows:\n1.  We introduce FMOP, a novel fragment-masked molecular optimization method. The FMOP method integrates scaffold-based fragments with rule-based constraints and leverages a pre-trained diffusion model to optimize masked regions according to molecule information and the PDD task conditions, without requiring model training. To the best of our knowledge, the FMOP is the first optimization method for the PDD task.\n2.  Optimization experiments were conducted across all 945 cell lines in the GDSCv2 dataset, demonstrating a 94.4% success rate and a 5.3% average increase in efficacy through optimization. Extensive visualization evaluations further indicate FMOP's robustness and broad applicability."}, {"title": "Related Work", "content": "Molecular optimization aims to improve drug properties, including physicochemical (e.g., solubility, stability, and absorption) and biomedical attributes (e.g., toxicity, target affinity, and drug-cell response), thereby enhancing drug candidate effectiveness.\nExisting molecular optimization methods can be broadly categorized into rule- and deep learning-based methods. Rule-based methods, such as pharmacophore modeling, rely on predefined structural rules to suggest modifications. In comparison, deep learning-based methods, such as those utilizing the denoising diffusion probabilistic model (DDPM) (Xie et al. 2024; Peng et al. 2022; Ho, Jain, and Abbeel 2020), have demonstrated great potential for molecular optimization. These methods integrate DDPM's ability to generate high-quality and diverse molecules with specific optimization goals and conditions to efficiently refine molecular structures and properties.\nDespite significant progress, current molecular optimization techniques encounter limitations in meeting PDD requirements. Numerous studies have been proposed optimizing physicochemical properties (Xiong et al. 2023; Born and Manica 2023), such as toxicity and target affinity (Huang et al. 2024; Jorgensen 2009), demonstrating significant potential in accelerating molecular optimization. However, PDD molecular optimization methods have not been thoroughly investigated. Some drugs exhibit favorable solubility and stability in vitro but fail to deliver the expected efficacy in practical applications (Rocha et al. 2023). This gap often occurs due to current methods disregarding the complexity of cellular environments. In addition, current optimization methods are often limited to specific masks or predicting functional group placements (de Souza Neto et al. 2020). These fragment-based approaches often regard molecular optimization as the addition or deletion of individual atoms or chemical bonds (Huang et al. 2024; Cheng et al. 2023). Consequently, when tackling novel mask types or tasks, these methods may struggle to handle complex masking scenarios due to limited training data, thereby restricting their applicability (Br\u00f6ker et al. 2022)."}, {"title": "Method", "content": "Problem Formulation. Molecular optimization aims to enhance a molecule's properties to reveal improved alternatives. For the PDD-based optimization task, the molecule's property is its efficacy in a specific cell line, denoted as IC50.\nLet one molecule be represented as $G$, the cell line as $C = \\{C_1, C_2, ..., C_m\\}$, and their IC50 as $Y = \\{Y_1, Y_2,..., Y_m\\}$. The optimized molecule's $Y$ with respect to $C$ is denoted as $Y'$. Therefore, for a given $(G, C_i, Y_i)$, the optimized result $y'$ should satisfy $y' < y$. Based on our fragment-masked method, we decomposed $G$ into a scaffold $Sf$ and a side chain $Sc$, where a mask marks the side chain's fragment structure. For one molecule $G = (A, X)$, $M_X \\in R^{|X|}$ denotes an ordered array of the atom mask $X \\in R^{|X|}$, where the atoms on the scaffold are labeled as 0 and those on the side chain as 1. In addition, $M_A \\in R^{|X|\\times|X|}$ represents an ordered array of the edge mask $A \\in R^{|X|\\times|X|}$, with edges on the side chain labeled as 1 and those on the scaffold or between scaffolds and side chains labeled as 0.\nOverview. To generate molecules with a specific distribution under numerical drug response conditions, we employed a regressor-free conditional diffusion method. As illustrated in Fig. 2, we integrated specific conditions about the cell line C and IC50 Y into the scoring estimation to guide the diffusion model. Specifically, to establish the molecules' conditional constraints, we split the molecule into its scaffold and side chain to generate the fragment masks. Then, we performed molecule splitting according to the Murcko scaffold method.\nFinally, during the sampling phase, the drug response and fragment mask jointly constrained the sampling process, generating specific fragments that met the conditions in the mask regions.\nMolecular Conditional Generation\nTypically, the input conditions for molecular optimization methods are categorical. To more precisely and efficiently optimize molecular graphs to specific conditional distributions, our model for conditional generation follows the regressor-free molecular generation method (Li et al. 2024a), which can effectively generate molecules under the given numerical conditions. Moreover, the conditions comprise text labels for the PDD task (i.e., the cell line name and IC50 values) and fragment mask arrays $M_X$ and $M_A$. To effectively receive text conditions, we employed a contrastive learning strategy to align the two feature types. The drug, cell line, and fusion drug response encoders are denoted as $\\Phi_G$, $\\Phi_C$, and $\\Phi_F$ respectively.\nMoreover, the text encoder that describes the reaction process between the drugs and cell lines is denoted as $\\Phi_T$, and its input text $\\Phi_T$ is generated through a template with two parameters $(C,Y)$, as the response value of the drug with the name of the cell line is $[IC_{50}]$. For the $i$-th representations $(d_i, c_i)$ generated by the $\\Phi_F$ and the $j$-th captions $(c_j, y_j)$ produced by the caption encoder in a batch B, we normalized the feature vectors in a hyper-sphere using $u_i := \\frac{\\Phi_F(C_i)}{||\\Phi_F(C_i)||}$ and $v_j := \\frac{\\Phi_T(C_j)}{||\\Phi_T(C_j)||} $. Finally, the similarity between $u_i$ and $v_j$ was calculated as $u_i^T v_j$. Hence, the supervised contrastive loss function $L_{NCE}$ can be expressed as:\n$L_{NCE} = -\\frac{1}{N}\\sum_{i=1}^{N} \\bigg[ log \\frac{exp(u_i^Tv_i / \\sigma)}{\\sum_{j=1}^{N}exp(u_i^Tv_j / \\sigma)} + log \\frac{exp(v_j^Tu_i / \\sigma)}{\\sum_{i=1}^{N}exp(v_j^Tu_i / \\sigma)} \\bigg] $   (1)\nwhere, N is the size of the batch B, and $\\sigma$ is the temperature for scaling the logits.\nBy pre-training $\\Phi_T$ using contrastive learning, we ensured that its encoding space is aligned with that of $\\Phi_F$. Subsequently, we adopted an approach similar to the classifier-free guidance method, using the pre-trained contrastive model $\\Phi_F$ as a conditional encoder. To guide the generation process towards the desired sampling conditioning information $c = \\Phi_T(c_i, Y_i)$, we sampled the conditional distribution $q_\\theta(G|c)$, and carried the expectations over to the samples $G_0 \\sim P_{data}$ and $G_t \\sim P_{\\theta_t}(G_t|G_0, c)$. Thus, the transition probability $P_{\\theta_t}(G_t|G_0, c)$ can be represented as follows:\n$P_{\\theta_t}(G_t|G_0, c) = p_{\\theta_t}(X_t|X_0, c)p_{\\theta_t}(A_t|A_0, c)$. (2)\nFor time t, we introduced objectives (Song et al. 2020) to generalize score matching and estimate the scores as follows:\n$min E_t \\{ \\lambda_1(t)E_{G_t \\sim P_{\\theta_t}(G_t|G_0)} ||B_{\\theta_t}(G_t, c) - \\nabla_{X_t} log P_{\\theta_t}(X_t|X_0, c)||^2 \\}$   (3)\n$min E_t \\{ \\lambda_2(t)E_{G_t \\sim P_{\\theta_t}(G_t|G_0)} ||B_{\\theta_t}(G_t, c) - \\nabla_{A_t} log P_{\\theta_t}(A_t|A_0, c)||^2 \\}$   (4)\nwhere, $\\lambda_1(t)$ and $\\lambda_2(t)$ are positive weighting functions and $B_\\theta$ and $B_\\theta^e$ denoted the noise prediction models based on the GNNs (Jo, Lee, and Hwang 2022; Zhang, Rao, and Agrawala 2023) to estimate scores $\\nabla_{X_t} log p_t(X_t, A_t, c)$ and $\\nabla_{A_t} log p_t(X_t, A_t, c)$, respectively. These two noise prediction models are jointly referred to as $\\epsilon_\\theta(G, c)$.\nFragment Mask Generation\nScaffolds typically refer to a molecule's core structure or main ring system that determines its basic shape and properties (Li et al. 2019). In contrast, side chains are the branches or functional groups attached to the scaffolds. By altering the side chain properties, we can modulate the molecule's solubility, polarity, reactivity, and various properties. As a result, we designed a fragment-based molecular optimization method. Molecular fragmentation is primarily based on the scaffolds and side chains in the molecule's structure, and we applied rule-based constraints to the fragmentation results."}, {"title": "Molecular Conditional Generation", "content": "For a specific molecule $G = (A, X)$, we first analyzed the molecule's scaffold using the Murcko scaffold function in the RDKit tool (denoted as $F_{Ms}(\\cdot)$), extracting its core scaffold structure $S_f$ and side chains $S_c$.\n$S_c, S_f = F_{check}(F_{MS}(G)) $ (5)\nIn this instance, these side chains are referred to as fragments. After excluding the fragments containing only single atoms (e.g., C, N, Cl, and F), we verified the connectivity between $S_f$ and $S_c$ using $F_{check}(.)$.\n$F_{check} = \\begin{cases} 1, & \\text{if } |Connect(S_c, S_f)| = 1 \\\\ 0, & \\text{if } |Connect(S_c, S_f)| \\neq 1 \\end{cases}$ (6)\nIf a fragment $S_c$ has multiple connection points to the scaffold $S_f$, it makes the optimization task very difficult but also destroys the original scaffold's properties. Consequently, these fragments were not considered for optimization.\nAdditionally, by determining whether a fragment has only one atom connected to the retained scaffold with the function $F_{check}()$, we ensured its independent optimizability. This is because $M_X$ is generated based on $M_A$. To ensure that the information of separate chemical bonds is not disclosed, we marked the row and column elements corresponding to the atoms in the fragment as 1 in $M_X$.\nFinally, the fragment $S_c$ that meets the criteria is considered for optimization. Furthermore, the fragment masking involves two matrices, used for atom and bond masking in the graph G, respectively.\n$M_X(i) = \\begin{cases} 1, & \\text{if } i \\in S_c \\\\ 0, & \\text{otherwise} \\end{cases}$ (7)\n$M_A(i, j) = \\begin{cases} 1, & \\text{if } i \\in S_c \\\\\\ 1, & \\text{otherwise} \\end{cases}$ (8)\nSpecifically, the atom indices in $S_c$ correspond to those where the elements of $M_X$ are 1. In addition, the matrix $M_A$ is derived from $M_X$, where the elements of $M_A$ are set to 0 if the atoms are part of the scaffold $S_f$.\nFragment-Masked Molecular Optimization\nMolecular optimization aims to enhance specific molecular properties by leveraging their intrinsic information. This paper focuses on optimizing the molecules' fragment regions to improve their cell line experiment responses. Hence, we employed a trained conditional diffusion denoising model. The condition's inputs include the original molecule G, two masks $M_A$ and $M_X$, and the PDD task targets $(c_i, Y_i)$. The output comprises multiple structurally similar molecules $G'$ that exhibit improved IC50 values, denoted as $y_n^e$, for the given cell line $c_i$.\nSpecifically, as each reverse step from $G_t$ to $G_{t-1}$ relies solely on $G_t$, it is essential to guide the masked region generation according to the known regions of $G_t$ and the input optimization targets, described as follows:\n$\\begin{cases} A_1 \\sim N(\\sqrt{\\bar{\\alpha}_t} A_0, (1 - \\bar{\\alpha}_t)I) \\\\\\ X_1 \\sim N(\\sqrt{\\bar{\\alpha}_t} X_0, (1 - \\bar{\\alpha}_t)I) \\end{cases}$ (9)\n$\\begin{cases} A_{ukn}^{kn-1} \\sim N(\\mu_{\\theta} (A_t, t), \\Sigma_{\\theta} (A_t, t)) \\\\\\ X_{ukn}^{kn} \\sim N(\\mu_{\\phi} (X_t, t), \\Sigma_{\\phi} (X_t, t)) \\end{cases}$ (10)\nwhere, $A_0$ and $X_0$ are the adjacency and node matrices of the initial molecule $G_t$ at time $t = 0$, $\\beta$ is the schedule function, and $\\bar{\\alpha}_t = \\Pi_{i=1}^t (1 - \\beta_i)$. In addition, the reverse process is modeled by two neural networks (the details can be found in Eqs. 3 and 4) that predict the parameters $\\mu_{\\theta/\\phi}(\\cdot)$ and $\\Sigma_{\\theta/\\phi}(\\cdot)$ of the Gaussian distributions with the given conditions.\nFinally, at time step t \u2212 1, unknown $(A_{ukn}, X_{ukn})$ and known regions $(A_{kn}, X_{kn})$ are identified, constrained using two masks, and combined to form $G_{t-1}(X_{t-1}, A_{t-1})$:\n$\\begin{cases} A_{t-1} = WM_A A_{ukn} + (1 - M_A)\\times A_1 \\\\\\ X_{t-1} = WM_X X_{ukn} + (1 - M_X)\\times X_1 \\end{cases}$  (11)\nwhere, $\\odot$ denotes the element-wise product, \"kn\" and \"ukn\" are the abbreviations for \"known\" and \"unknown,\" respectively. W is a coefficient that gradually decreases from 1 to 0 over time t, and is used to control the scaffold's influence on the sampled region. After combining the known and optimized generated regions using the masks, the resulting $G_{t-1}$ is incorporated into the next denoise step as follows:\n$\\epsilon_\\theta(G_{t-1}, c) = w \\epsilon_\\theta(G_{t+\\epsilon}, c) + (1-w) \\epsilon_\\theta(G_{t+\\epsilon}, 0)$   (12)\nwhere, the noise $\\epsilon \\sim N(0, I)$, w is a conditional control strength parameter (w > 0), and w = 0 indicates unconditional generation.\nRule-Based Chemical Bond Post-Processing. During the sampling phase, the GNN-based score prediction model's inherent limitations in the molecular generation process prevent each atom from obtaining information beyond the GNN layer's k-hop neighborhood. This limitation may cause the model to miss global features or long-range interactions between atoms when generating molecular structures, which can, in turn, affect the overall structural rationality and stability of the molecule (Kim et al. 2023; Cai et al. 2022). Therefore, global optimization is necessary.\nThus, we changed the global features of the sampled molecule $G_0$ to correct specific local edge types. Specifically, we changed the molecular structure by converting continuous double bonds to single and modifying six-carbon double-bonded to aromatic rings. These corrections ensure that the generated molecules meet the chemical stability and structural rationality requirements, thereby improving the accuracy and effectiveness of molecular optimization."}, {"title": "Experiment", "content": "Experimental Setup\nThis study utilized two primary datasets: QM9 (Ramakrishnan et al. 2014) and GDSCv2 (Yang et al. 2013). The QM9 dataset was used for pre-training the model to enhance molecular diversity, and contains approximately 133,885 molecules. These data provide the model with rich molecular information, improving its generalization ability. Likewise, the GDSCv2 dataset was used for tasks related to drug response prediction (Shubham et al. 2024; Campana, Prasse, and Scheffer 2024), and comprises approximately 190,853 samples, covering 945 cell lines and 220 drugs. GDSCv2 enables learning and predicting drug response distributions. This is significant for precision medicine and new drug development (Ren et al. 2023).\nEvaluation Criteria. Molecules labeled with drug response for the cell line \u03b7 are selected from the GDSCv2 dataset, focusing on those with IC50 values in the top 20% to 30%. These molecules, referred to as $y_n$, were used as the target molecules for optimization. N@100 is a counting function, if the IC50 of the optimized molecules $y_n^e$ is lower than the average $y_n$, the count is incremented by one. The Improv. represented the improvement in IC50 before and after molecular optimization. Our method calculated the average increase based on the true IC50 values for each molecule being optimized, while other methods also used the average IC50 of these molecules to compute the average increase.\nIt is important to note that the generated or optimized molecules' the efficacy (i.e., the IC50) in various cell lines was predicted using the deep learning models and not wet lab validation. This is because the wet lab validation involves molecular synthesis and cell-based assays, processes that are time-consuming and extremely costly. Therefore, we relied on the out-of-domain drug response prediction (OOD-DRP) methods (Li et al. 2024c; Chen et al. 2022; Sharifi-Noghabi et al. 2021) to predict the IC50 of the newly generated molecules. The contrastive learning drug response model based on natural language supervision (CLDR) focused on out-of-domain generalization and demonstrated state-of-the-art correlation in response predictions (Li et al. 2024b). Consequently, we used the CLDR as the OOD-DRP method.\nOverall Experiments\nTo validate the effectiveness of FMOP, this study has meticulously ensured fairness by comparing it with five baseline models. GDSS (Jo, Lee, and Hwang 2022), DiGress (Vignac et al. 2023), and DruM2D (Xu et al. 2023) are unconditional molecular generation methods, while MOOD (Lee, Jo, and Hwang 2023) and CDGS (Huang et al. 2023) are conditional molecular generation methods that utilize specific category and the dataset distributions to guide molecular generation. Existing molecular optimization methods can be broadly categorized into target pocket- and property-based molecular optimization. Target pocket-based methods require detailed structural information and binding site data, whereas property-based optimization methods fail to integrate cellular genomics and drug-cell fusion information. Consequently, these methods cannot be directly compared with our approach.\nTo verify whether our method can effectively optimize molecules to achieve better drug response values, we conducted overall experiments involving various diffusion models. Due to the novelty of the molecule generation method, generated molecules are out-of-domain and require the OOD-DRP model to have a high generalization capability. Therefore, we used the CLDR method (Li et al. 2024b), which has excellent generalization performance, to predict the optimized molecules.\nTable 1 displays the optimization results of six methods in three different cell line scenarios and the average optimization results across 945 cell lines. Our method achieves the best optimization and increase rate results, surpassing the second-best method by 36.0% and 76.7%, respectively. To verify that our method can effectively optimize fragment regions while maintaining scaffold consistency, we conducted a visual comparison of the results. As shown in Fig. 3, our method maintains scaffold consistency while optimizing the masked region. In contrast, other methods' optimization success was primarily due to the random generation of a few molecules with good efficacy across various cell lines. However, these methods cannot adjust the sampling space distribution for specific tasks, resulting in poor performance."}, {"title": "Ablation Study", "content": "In the FMOP method, the PDD task information and fragment masks are encoded as indispensable conditions, and their impact on the final optimization results is significant. Therefore, three key points need to be explored:\nQ1: Do the conditional information (i.e., the expected IC50 values and cell line types) play a crucial role in the molecular optimization process, thereby improving optimization success rates and efficacy enhancements?\nQ2: Can fragment masking effectively focus optimization on specific regions to improve efficacy and optimization success rates?\nQ3: Given the current issues with aromatic ring quality and single/double bond generation, is rule-based chemical bond post-processing an effective method for molecular generation?\nAs shown in Table 2, each component significantly contributes to the model's overall performance. For Q1, without the fragment mask prompt, our method generates molecules randomly, resulting in a drastic decline in the success rate to 0.3% and an improvement of 2.1%, with only 26 instances reaching N@100. This indicates that the fragment mask is crucial for identifying key molecular features.\nFor Q2, when task guidance is removed, the success rate is 5.0%, and the improvement rate remains at 2.1%. The absence of task guidance leads to a random fragment generation strategy, where we use the top N most frequent fragments to assemble the scaffold, yielding a success rate of 5%. This demonstrates that task guidance is essential for potential molecule optimization.\nFor Q3, the success rate further increased to 94.4% through post-processing based on the aromatic ring recognition rules. This suggests that molecular modifications are essential for achieving a high success rate, although they introduce some complexity."}, {"title": "Visualization Analysis", "content": "To explore whether the molecules generated or optimized using different methods achieved a certain confidence level instead of merely evaluating the methods based on numerical values, we visually analyzed the molecular structures generated using our optimization method and baselines across different cell lines. As shown in Fig. 3, our method generates unique molecules for each cell line, ensuring that the optimization process does not converge to the same local optimum across different cell lines. In comparison, the molecules generated using other methods were generally similar, highlighting that our method is able to optimize molecular structures based on the specific response values of each cell line, thereby achieving more effective and suitable molecular structures. Furthermore, our method's predicted IC50 values remain consistently low across different cell lines, indicating that our optimized molecules have a competitive advantage compared to de novo designed molecules. For example, for cell line 906792, our method generated a molecule with an IC50 value of 0.48, while the other approaches generated different molecules with IC50 values ranging from 0.49 to 0.51.\nSince measuring the IC50 for all virtually generated molecules on 945 specific cell lines in a short time is impractical, we utilized the CLDR method to predict these values. To validate our method's effectiveness, as shown in Fig. 4, we predicted the IC50 values for the cell lines 906792, 688006, and 949090, and visualized the mean and variance by assuming a Gaussian distribution. As a result, our proposed FMOP method demonstrated a strong competitiveness in the lower IC50 range. For example, in Fig. 4a, the IC50 values for the molecules generated by FMOP fall between 0.47 and 0.53, while those generated using other methods mostly fall between 0.49 and 0.52. Additionally, the IC50 distribution of the original molecules (denoted as 'Origin') ranged between 0.51 and 0.52. After optimization using our method, the mean IC50 of the molecules showed a significant improvement, approximately by 3%. The results generated by MOOD and DruM2D are represented by $\\bigtriangleup$, indicating that only one single effective molecule was optimized for cell line 906792, resulting in a variance of 0."}, {"title": "Conclusion", "content": "To address the PDD challenge of generating molecules, which requires screening a vast number of possible molecular structures, we proposed the FMOP method. To the best of our knowledge, the FMOP is the first optimization method for the PDD task. FMOP employs a regression-free diffusion model to conditionally sample the masked regions of molecules for optimization, effectively generating new molecules with similar scaffolds and improved efficacy. We optimized the molecules for all 945 cell lines on the GDSCv2. The overall experiments demonstrated that the in-silico optimization success rate reaches 94.4%, with an average efficacy increase of 5.3%. Additionally, we conducted extensive ablation studies and visualization experiments, proving that FMOP is an effective and robust molecular optimization method."}, {"title": "Reproducibility Checklist", "content": "This paper:\n\u2022 Includes a conceptual outline and/or pseudocode description of AI methods introduced yes\n\u2022 Clearly delineates statements that are opinions, hypothesis, and speculation from objective facts and results yes\n\u2022 Provides well marked pedagogical references for less-familiare readers to gain background necessary to replicate the paper yes\nDoes this paper make theoretical contributions?\nyes\n\u2022 All assumptions and restrictions are stated clearly and formally yes\n\u2022 All novel claims are stated formally (e.g., in theorem statements). yes\n\u2022 Proofs of all novel claims are included. yes\n\u2022 Proof sketches or intuitions are given for complex and/or novel results. yes\n\u2022 Appropriate citations to theoretical tools used are given. yes\n\u2022 All theoretical claims are demonstrated empirically to hold. yes\n\u2022 All experimental code used to eliminate or disprove claims is included. yes\nDoes this paper rely on one or more datasets?\nyes\n\u2022 A motivation is given for why the experiments are conducted on the selected datasets yes\n\u2022 All novel datasets introduced in this paper are included in a data appendix. yes\n\u2022 All novel datasets introduced in this paper will be made publicly available upon publication of the paper with a license that allows free usage for research purposes. yes\n\u2022 All datasets drawn from the existing literature (potentially including authors' own previously published work) are accompanied by appropriate citations. yes\n\u2022 All datasets drawn from the existing literature (potentially including authors' own previously published work) are publicly available. yes\n\u2022 All datasets that are not publicly available are described in detail, with explanation why publicly available alternatives are not scientifically satisficing. NA\nDoes this paper include computational experiments?\nyes\n\u2022 Any code required for pre-processing data is included in the appendix. yes\n\u2022 All source code required for conducting and analyzing the experiments is included in a code appendix. yes\n\u2022 All source code required for conducting and analyzing the experiments will be made publicly available upon publication of the paper with a license that allows free usage for research purposes. yes\n\u2022 All source code implementing new methods have comments detailing the implementation, with references to the paper where each step comes from yes\n\u2022 If an algorithm depends on randomness, then the method used for setting seeds is described in a way sufficient to allow replication of results. yes\n\u2022 This paper specifies the computing infrastructure used for running experiments (hardware and software), including GPU/CPU models; amount of memory; operating system; names and versions of relevant software libraries and frameworks. yes\n\u2022 This paper formally describes evaluation metrics used and explains the motivation for choosing these metrics. yes\n\u2022 This paper states the number of algorithm runs used to compute each reported result. yes"}]}