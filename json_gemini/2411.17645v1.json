{"title": "Explainable AI for Classifying UTI Risk Groups Using a Real-World Linked EHR and Pathology Lab Dataset", "authors": ["Yujie Dai", "Brian Sullivan", "Axel Montout", "Amy Dillon", "Chris Waller", "Peter Acs", "Rachel Denholm", "Philip Williams", "Alastair D Hay", "Raul Santos-Rodriguez", "Andrew Dowsey"], "abstract": "The use of machine learning and AI on electronic health records (EHRs) holds substantial potential for clinical insight. However, this approach faces significant challenges due to data heterogeneity, sparsity, temporal misalignment, and limited labeled outcomes. In this context, we leverage a linked EHR dataset of approximately one million de-identified individuals from Bristol, North Somerset, and South Gloucestershire, UK, to characterize urinary tract infections (UTIs) and develop predictive models focused on data quality, fairness and transparency. A comprehensive data pre-processing and curation pipeline transforms the raw EHR data into a structured format suitable for AI modeling. Given the limited availability and biases of ground truth UTI outcomes, we introduce a UTI risk estimation framework informed by clinical expertise to estimate UTI risk across individual patient timelines. Using this framework, we built pairwise XGBoost models to differentiate UTI risk categories with explainable AI techniques to identify key predictors while ensuring interpretability. Our findings reveal differences in clinical and demographic factors across risk groups, offering insights into UTI risk stratification and progression. This study demonstrates the added value of AI-driven insights into UTI clinical decision-making while prioritizing interpretability, transparency, and fairness, underscoring the importance of sound data practices in advancing health outcomes.", "sections": [{"title": "1 Introduction", "content": "The integration of electronic health records (EHRs) into health research offers immense potential for generating insights that improve patient care and health outcomes (King et al. 2014; Menachemi and Collum 2011). As large-scale health data becomes more accessible, machine learning and AI can reveal patterns and relationships that traditional statistical methods might overlook (Richter and Khoshgoftaar 2018). However, the use of machine learning and AI with EHR data presents notable challenges, as EHRs are observational datasets that are often heterogeneous, sparse, and temporally misaligned (Ghassemi et al. 2020; Xie et al. 2022). These challenges are due to variations in clinical outcomes, diverse disease stages or conditions, irregular visit intervals, and inconsistent data recording practices over time that were not designed with machine learning in mind. Moreover, the lack of labeled outcomes, e.g. definitive diagnoses, complicates the development of robust predictive models, particularly in supervised learning. To address these challenges, rigorous data curation and pre-processing methods are essential.\nSeveral publicly available datasets, such as the MIMIC-IV (Johnson et al. 2023) and eICU (Pollard et al. 2018), are frequently used in healthcare predictive modeling. While these datasets contain detailed patient information - such as demographics, lab results, and clinical notes - they primarily focus on intensive care settings, limiting their applicability to conditions managed predominantly in primary care, such as urinary tract infections (UTIs) (Lecky et al. 2020). UTIs are one of the most common classes of infectious disease encountered in clinical practice (Stamm and Norrby 2001). A number of studies have applied machine learning techniques to predict UTI risk using EHR data. Classification algorithms like logistic regression and decision trees have been employed to predict UTI presence based on structured data fields such as patient demographics and medical history (M\u00f8ller, S\u00f8rensen, and Hardahl 2021; Jeng et al. 2022a). Other studies use clustering techniques to segment patients into UTI risk subgroups, revealing patterns that may guide targeted interventions (Barchitta et al. 2021). Additionally, (Iscoe et al. 2024) incorporated unstructured data via natural language processing to extract symptoms from clinical notes, such as Urinary frequency, to enhance UTI prediction. Reported UTI risk factors include gender (with females at higher risk), advanced age, comorbidities such as diabetes and neurological disorders, and prior history of UTIs which predispose individuals to recurrence(Jakobsen et al. 2023; Jeng et al. 2022b; M\u00f8ller, S\u00f8rensen, and Hardahl 2021).\nHowever, data used in these studies often lacks the breadth of linked primary care, secondary care and laboratory records, potentially limiting the predictive models' depth and accuracy, as many studies rely solely on either primary or secondary care data alone. This can lead to inequities, as risk factors may vary across different population subgroups, with hospitalized patients tend to be more vulnerable. Furthermore, few studies have examined the discrepancies between clinician-based and AI-driven risk assessments for UTIs, a critical consideration for aligning model outputs with clinical perspectives. While interpretability and fairness are essential for building trust in healthcare AI (Tjoa and Guan 2021; Pessach and Shmueli 2022), existing studies that address these in UTI prediction predominantly utilize data from hospital or emergency department settings, limiting their generalizability to broader patient populations (Khan 2022; Jakobsen et al. 2023). Our work aims to address these open questions by utilizing a linked EHR dataset that includes data from primary care, secondary care, and pathology data, allowing for a more comprehensive analysis of UTI risk. This dataset encompasses data from approximately one million individuals in the Bristol, North Somerset, and South Gloucestershire regions of the UK. Using this extensive dataset, we aim to better characterize UTIs and identify associated risk factors across various subgroups.\nConsidering the limited availability of labeled UTI data, we propose a UTI risk estimation framework informed by clinical expertise. This framework enables automatic annotation of patient records and UTI risk estimation across individual patient timelines. We examine UTI risk predictors over a one-year observation period, highlighting how these predictors differ across UTI risk groups and contribute to increased risk while ensuring interpretability and transparency.\nThis paper begins by detailing the unique dataset we have acquired and the associated challenges in Section 2. In Section 3, we present the data pre-processing and curation strategies that transform raw EHR data into structured representations suitable for further statistical analysis and AI modeling. Section 4 introduces our clinician-based risk and outcome estimation framework. The methods for constructing a baseline model to identify initial predictive factors across different UTI groups are presented in Section 5, while Section 6 presents the results derived from machine learning models and explainable AI techniques. Finally we discuss limitations in our study and outline future research directions continuing from this work in Section 7."}, {"title": "2 Dataset", "content": "The Bristol, North Somerset, and South Gloucestershire (BNSSG) 'System Wide' dataset consists of routinely recorded healthcare data (BusinessInformationBNSSG 2022), with patient-level linked records primarily covering the period from October 2019 to July 2022. This dataset includes data on 962,237 adult patients whose Primary Care practices opted into data sharing within the BNSSG Integrated Care Board (ICB) area. Included in the dataset are records from primary care, secondary care, and notably pathology lab results for antibiotic susceptibility tests, with our specific extraction focused on UTI risk factor analysis and prediction modelling. The dataset was linked at the ICB and disseminated to the University via patient pseudo-anonymized identifiers and a strict governance regime to ensure the protection of patient privacy.\nThe primary care data in the extraction include patient demographics, living circumstances, and comorbidity histories (e.g., diabetes, dementia), as well as records of prescriptions dispensed for antibiotics, steroids, hormone replacement therapy, and catheter supplies. Secondary care data include information on hospital admissions and discharges, categorized by ICD-10 (DiSantostefano 2010) codes for bacterial infections, and OPCS codes (NHS 2006) for procedures related to chemotherapy, and urinary and gastrointestinal health. Pathology data include laboratory test results, including viral identification, blood, and urine culture tests. Further details on the information included and the demographic characteristics of the population in the dataset can be found in sections A1 and A2 in the Appendix.\nLike most EHR data, this real-world dataset presents several challenges that affect statistical analysis and machine learning modelling:\n\u2022 Heterogeneity: The BNSSG dataset includes both structured data (e.g., demographic information) and semi-structured data (e.g., open-ended categories for medicine and catheter information), reflecting the diversity of real-world EHR data. This variety complicates further analysis, as these data require distinct pre-processing techniques, and integrating these data types can introduce inconsistencies that affect the robustness of model training and interpretability.\n\u2022 Temporal Misalignment: Data points are recorded at differing intervals, leading to time gaps and inconsistencies, as some events are recorded only when they occur (e.g., primary care medicine dispensations) while others are recorded at regular intervals (e.g., monthly records on comorbidity status). This misalignment challenges the construction of time-dependent models and accurate analysis. Moreover, different patients contract UTIs at different times, which can be influenced by extrinsic factors (e.g. seasonality).\n\u2022 Sparsity: Since certain data points are recorded only when healthcare contact events occur, there are often large temporal gaps, limiting the detail available to build complete patient profiles. Sparse data complicates statistical analysis and reduces the reliability of machine learning models, particularly for time-series analysis or cases requiring a consistent record of patient health.\n\u2022 Missingness: Missing values in EHR - such as incomplete prescription data or catheter details in the BNSSG dataset - create challenges. Common approaches like imputation may add noise or bias if the causal context is not considered precisely, affecting the reliability of both the analysis and model predictions. This is notably a key concern when the data is not missing at random, such as when clinical tests are only conducted when disease is suspected, and then only if there is a substantive possibility that the result might trigger a change treatment.\n\u2022 Lack of an Explicit UTI Diagnosis Label: Although the extracted data focus on UTIs, the SNOMED code (NHS England 2024) diagnoses from primary care GPs were not available due to data governance limitations in our data transfer, making supervised learning difficult. Nevertheless, most UTI diagnoses in primary care are merely suspected rather than confirmed, which certainty typically only available for the most serious hospital admissions. This lack of labeling requires us to rely on indirect indicators or semi-supervised approaches, which may be less accurate and increase the need for expert validation.\nTo address these challenges, we have collaborated closely with clinical partners to enhance data quality and transform the raw data into a consistent and suitable structure for machine learning, as detailed in the following sections."}, {"title": "3 Data Pre-processing", "content": "Our data pre-processing pipeline prepares the large-scale EHR dataset for effective analysis by systematically cleaning, standardizing, and transforming data relevant to UTI prediction. Key steps include targeted cleaning of different data to ensure consistency across critical variables. We then discretise the data into days, transforming it into a sparse 3D matrix of subject by variable by day to support comprehensive but computationally efficient temporal analysis."}, {"title": "3.1 Data Cleaning", "content": "Since our study focuses on UTIs, we implemented targeted data cleaning procedures on specific data subsets, including primary care dispensation records, secondary care hospital admissions, and pathology lab results for blood and urine bacterial cultures. Each data source has unique characteristics that required consultation with clinical experts to inform tailored cleaning approaches.\nRelevant attributes were extracted from clinical prescription dispensation notes, including drug name, dosage, type (antibiotics, steroids, hormones), and administration route (e.g., oral and topical). For catheter-related dispensations, data includes manufacturer, catheter type, insertion method, size, and several material and coating categories (e.g., silicone and latex).\nHospital Admission Data Admission data were cleaned to extract associated ICD-10 and OPCS codes recorded at each patient visit, alongside entry and discharge dates. This ensured we captured all relevant diagnostic and procedural information per admission period.\nPathology Data Blood and urinary bacterial culture results contained both culture tests (e.g. species detected) and a mix of antibiotic susceptibility tests (ASTs) and other pathology results (114 unique test types). We categorized urinary bacterial culture results into \u201cno significant growth\", \"no growth\u201d, \u201cmixed growth\u201d, \u201cinvalid\u201d, \u201cother\u201d (non-AST), and \u201crefer to AST test\u201d. The reason for adding the \"refer to AST test\" category is because the urinary bacteria test data have AST results but coded in a non-accessible format that is more easily accessed in the AST data. AST results were denoted to \"susceptible\u201d, \u201cintermediate\u201d, and \"resistant\" responses. We grouped intermediate results under the resistant category to streamline analysis based on clinician guidance and used (s) and (r) represent susceptible and resistance respectively. Additionally, in non-AST cases, results were labeled as \"positive\u201d or \u201cnegative\" (denoted as (p) and (n) respectively). Both urinary culture and AST data include specimen source information, which we mapped to standardized categories such as catheter stream urine, mid-stream, and some other categories."}, {"title": "Demographics Data", "content": "All patients have monthly recorded demographic information including age, gender, sex, date of death, living circumstances, a set of comorbidities, and geographic location. Geographic data is recorded using the 2011 Lower Layer Super Output Areas (LSOAs) (UK ONS 2011). The demographic data is structured and was minimally pro-cessed for our analysis."}, {"title": "3.2 Data Transformation", "content": "Following initial cleaning, we discretized the data into day resolution. The data is structured into a 3-dimensional matrix X(T, F, P), where T represents the time dimension, F represents features, and P denotes patients. This transformation is computationally intensive, as each patient's time-line generates approximately 1,005 rows (one row per day over 33 months) and over 25,000 variables (e.g. a row for each unique ICD-10 code and every antibiotic and bacteria AST combination dedicating presence or absence)."}, {"title": "4 UTI Risk Estimation Framework", "content": "Urinary tract infections can be challenging to diagnose due to the variety of symptoms that overlap with other conditions and the lack of a definitive diagnostic test. Given the absence of a direct UTI label in our dataset, we developed a UTI risk estimation framework in collaboration with clinical experts. This framsework aims to provide a probabilistic estimate of UTI risk for individual patients, ranging from 0 (no UTI) to 1 (definite UTI). It is based on three key variables: (1) the presence of UTI-related antibiotic dispensations, (2) the identification of UTI-related bacteria in urine culture tests, and (3) relevant hospital diagnosis codes. By integrating these sources of information, our framework allows us to assess UTI risk across a patient's entire clinical timeline, providing day-specific risk estimates."}, {"title": "Antibiotic Dispensation", "content": "Antibiotics dispensed to a patient are categorized into four groups based on their relevance to UTI treatment: \"None\", \"Rarely Used\", \"Sometimes Used\", and \"Regularly Used\" for UTI. The classification reflects the inferred levels that the prescribed antibiotic was used to treat or prevent a UTI."}, {"title": "Urine Pathology Results", "content": "Urine culture results are categorized into four levels: \"None\", \"No Growth / Bacteria Rarely Associated with UTI\", \"Bacteria Sometimes Associated with UTI\", and \"Bacteria Regularly Associated with UTI\". We treat both \"No Growth\" and \"Bacteria Rarely Associated with UTI\" as equivalent, since having a urine specimen taken indicates that the patient likely had some UTI symptoms, but both indicate a low (but non-zero) likelihood of UTI presence."}, {"title": "Hospital Diagnosis Codes", "content": "Secondary care ICD-10 diagnosis code N39.0, which specifically corresponds to UTI, is a definitive source of UTI diagnosis. Although patients who are hospitalized are assigned this ICD-10 code, the occurrence of such cases is relatively rare in our dataset, with approximately 1,000 instances recorded during the study period. This is likely due to many UTI cases being managed in primary care or outpatient settings, rather than requiring hospitalization.\nThese three variables are combined to generate a composite \"UTI Likelihood\u201d, which provides a discrete likelihood score with values of 0, 0.2, 0.4, 0.6, 0.8, or 1, representing varying degrees of UTI risk, from none to confirmed.\nOne of the primary challenges in applying this framework is the misalignment of EHR data. The key variables - antibiotic dispensation and pathology results - are event-based records, meaning they are recorded at specific points in time (e.g., the day an antibiotic was dispensed, or a urine sample was processed). These events are not always aligned with each other, even when they may be causally related to an underlying UTI. To address this, we extend the data temporally to capture the ongoing effects of medications and the progression of infection, thereby enabling the application of our clinician-based risk framework."}, {"title": "Data Extension 1", "content": "Given that a patient may have been symptomatic for days before receiving an antibiotic dispensation, we extend the data by marking a 3-day window prior to dispensation with the same antibiotic category based on clinical expertise. This accounts for the possibility that patients were already experiencing UTI symptoms before visiting a healthcare provider. Additionally, we estimate the duration of medication-usage based on prescribed dosage guidelines. For instance, if a patient is dispensed 28 tablets of Trimethoprim (500mg), we can infer the likely duration of treatment using local clinician guidelines or the World Health Organization's defined daily dosage (DDD) guidelines for antibiotics (WHO 2024). This enables us to extend the presence of the antibiotic over a period of days, reflecting the ongoing impact of the medication on future UTI risk."}, {"title": "Data Extension 2", "content": "For pathology records indicating that a urine specimen was collected, we extend the potential UTI risk to cover a 7-day window before and after the specimen collection date according to clinical advice. This extension accounts for the time required for pathogens to grow, be detected, and treated in the culture.\nSecondary care records, including hospital admissions and discharges, are marked with specific entry and exit dates. These dates are used to denote the period during which a UTI diagnosis is most likely to have occurred. However, since these records do not provide detailed temporal alignment for antibiotic treatment or pathology results, we do not extend these records in time.\nThe extended data generated through these strategies allows us to apply the UTI risk estimation framework more effectively, capturing a full picture of each patient's clinical journey and providing a more robust risk assessment."}, {"title": "5 Methodology", "content": ""}, {"title": "5.1 Data Preparation", "content": "During the 33-month data collection period (from October 1, 2019, to July 1, 2022), multiple potential occurrences of UTIs are identified for some patients, each assigned a likelihood score using the clinician-informed UTI risk estimation framework. As higher likelihood scores reflect greater confidence in the label, to boost the relatively small class sizes for the higher likelihoods, we selected the UTI occurrence with the highest likelihood within each patient's observation window, favoring the most recent and confident estimate. For each patient, we extracted features from the 12-month period preceding this highest likelihood UTI event, as shown in Figure 1. This standardized observation window across all patients, enabling consistent identification of predictive risk factors influencing the likelihood of UTI occurrence within the next year. Features included in this study are listed in section A5 in Appendix.\nFor the control group, consisting of individuals with a UTI likelihood of 0, we sampled individuals in a manner that aligned with the temporal distribution of the UTI group (likelihood >0) across the years. This ensures that both the UTI and control groups had similar distribution of observation time-frames, facilitating a fair comparison between the two groups with respect to the distribution of timelines across the years and seasons.\nTo maintain uniformity in temporal analysis, patients with observation windows shorter than 12 months were excluded. Additionally, patients under the age of 18 and those with unknown or unspecified sex were removed to establish a more homogeneous cohort for analysis."}, {"title": "5.2 Modeling UTI Risk Categories", "content": "The clinician-informed UTI risk estimation framework categorizes patients into six distinct likelihood groups. To analyze predictive differences between adjacent risk groups and identify key features predicting transitions between categories, we developed a classification model using XGBoost (Chen and Guestrin 2016) and SHAP (SHapley Additive exPlanations) (Lundberg and Lee 2017) for enhancing explainability.\nPairwise models were constructed to differentiate each set of neighboring risk groups (e.g., 0 vs. 0.2, 0.2 vs. 0.4), with the higher-risk group within each pair considered the positive class. Data for each model was divided into training, validation, and testing sets with the ratio of (3:1:1). These models aimed to identify the most important features distinguishing patients between adjacent UTI risk categories, providing insights about factors associated with an elevated risk of UTI. By leveraging SHAP explainable models, we assessed the impact of individual features on model predictions, aligning machine learning outputs with clinical understanding to ensure interpretability and transparency."}, {"title": "6 Results", "content": ""}, {"title": "6.1 Descriptive Analysis", "content": "The study population consisted of individuals categorized into UTI and control groups, with key demographic characteristics summarized in Table 1. Patients in the UTI group tend to be older on average than those in the control group, and a higher proportion of females are observed in the UTI group, reflecting the known epidemiology of UTIs. Additionally, the UTI group had a greater prevalence of comorbidities, such as dementia. In terms of living conditions, a higher proportion of patients in the UTI group were reported as housebound or residing in a nursing or caring Home, while these proportions were much lower in the control group."}, {"title": "6.2 Model Performance and Feature Importance", "content": "To differentiate patients between neighbouring UTI likelihood categories, pairwise models were constructed for adjacent groups (e.g., 0 vs. 0.2, 0.2 vs. 0.4). The models demonstrate varying effectiveness in distinguishing between adjacent UTI risk groups. The 0.0 vs 0.2 model achieves high accuracy (0.90) and an AUC-ROC of 0.80, but its low recall suggests difficulty in identifying true positives with subtle feature differences. The 0.2 vs 0.4 model has high accuracy but performs poorly in other metrics, likely due to extreme class imbalance. In contrast, the 0.4 vs 0.6 model performs relatively well in distinguishing each other across all metrics. This result aligns with human expectations of risk categorization, as the natural threshold at 0.5 intuitively separates patients with higher likelihood scores above 0.5 from those below 0.5. However, the AUC-ROC of 0.78 still indicates some challenges in distinguishing between these adjacent risk groups. The 0.6 vs 0.8 model shows moderate performance (AUC-ROC 0.73) but the recall (0.40) and F1-score (0.52) suggest that the model has limitations in detecting instances of the higher-risk group. Finally, the 0.8 vs 1.0 model achieves excellent discrimination with an AUC-ROC of 0.98, though its lower recall and precision reflects some misclassification, likely due to class imbalance of the positive class in this model."}, {"title": "7 Discussion", "content": "In this paper, we introduced a unique linked EHR dataset and detailed our pre-processing and curation methods tailored for UTI prediction. This enriched dataset integrates information from multiple healthcare settings, offering potential for advancing AI-driven healthcare solutions. However, it also presents several limitations. For instance, the dispensation data we acquired differs from the prescribing records commonly used in similar studies. Dispensation data records medications dispensed to patients rather than prescribed, providing a more accurate representation of actual medication usage. Nevertheless, it does not confirm whether patients completed the course or initialized it at all. Additionally, while urine sample processing data is included in the dataset, discrepancies may arise because the processing date may not align with the date the sample was collected, introducing potential temporal inconsistencies. Our initial clinician-guided framework for data annotation facilitates supervised learning and reflects how clinicians assess UTI risk based on three primary variables. However, this framework is based on current clinical practice and depends on a restricted set of clinical indicators, potentially overlooking subtle or unrecognized factors influencing UTI risk. Moreover, the 0.4 risk group contains relatively few cases, which may affect the robustness of the analysis. To address this, merging it with other groups, guided by AI to explore possible combinations, could potentially enhance reliability. Addressing the challenges posed by incomplete data and the lack of explicit UTI labels remains critical. These limitations introduce uncertainty into the analysis, emphasizing the importance of robust estimation methods to enhance the reliability of risk assessment. Future work will aim to refine this approach by transitioning to explainable AI-based predictive models capable of uncovering latest risk groups as well as broader patterns, providing greater insights into predictive factors and modifiable risk factors.\nOur study highlights the critical role of integrating data curation, risk estimation frameworks, and interpretable AI techniques to improve the real-world applicability of predictive models in healthcare. By leveraging a diverse and enriched dataset, we aim to advance not only the accuracy of predictive analytics but also their equity and effectiveness, ultimately contributing to better healthcare solutions."}]}