{"title": "Solar Active Regions Emergence Prediction Using Long Short-Term Memory Networks", "authors": ["SPIRIDON KASAPIS", "IRINA N. KITIASHVILI", "ALEXANDER G. KOSOVICHEV", "JOHN T. STEFAN"], "abstract": "We developed Long Short-Term Memory (LSTM) models to predict the formation of active regions (ARs) on the solar surface. Using the Doppler shift velocity, the continuum intensity, and the magnetic field observations from the Solar Dynamics Observatory (SDO) Helioseismic and Magnetic Imager (HMI), we have created time-series datasets of acoustic power and magnetic flux, which are used to train LSTM models on predicting continuum intensity, 12 hours in advance. These novel machine learning (ML) models are able to capture variations of the acoustic power density associated with upcoming magnetic flux emergence and continuum intensity decrease. Testing of the models' performance was done on data for 5 ARs, unseen from the models during training. Model 8, the best performing model trained, was able to make a successful prediction of emergence for all testing active regions in an experimental setting and three of them in an operational. The model predicted the emergence of AR11726, AR13165, and AR13179 respectively 10, 29, and 5 hours in advance, and variations of this model achieved average RMSE values of 0.11 for both active and quiet areas on the solar disc. This work sets the foundations for ML-aided prediction of solar ARs.", "sections": [{"title": "1. INTRODUCTION", "content": "The growing interest in manned spaceflight and the increased reliance on space-based infrastructure has made reliable space weather forecasting tools very important. Solar activity is the primary influencing factor of space weather and the geospace environment; therefore, understanding of its origin should form the foundation of these forecasting tools. Lately, significant efforts have been made towards the prediction of certain aspects of space weather, for example, flares (e.g., Georgoulis 2013; Jiao et al. 2020), coronal mass ejections (e.g., Maharana et al. 2024), and solar energetic particles (e.g., Ali et al. 2024; Kasapis et al. 2024), but forecasting the progenitor of these events, namely the solar active regions (ARs), has been a rather unexplored area of study. The main difference between forecasting space weather events and the emergence of active regions lies in their observational constraints: there are strong connections between the strength and configuration of the photospheric magnetic field and the likelihood of flares (Li et al. 2024) and CMEs, so prediction of these events benefits greatly from the high-resolution magnetograms produced by the Helioseismic and Magnetic Imager (HMI) onboard the Solar Dynamics Observatory (SDO). Forecasting the emergence of ARs, meanwhile, requires probing of the solar interior that is only possible indirectly via helioseismic methods (e.g., Ilonidis et al. 2011; Stefan & Kosovichev 2023).\nTo detect emergence, it is important to capture those subsurface solar activity signatures that precede the abrupt decrease in continuum intensity and increase in magnetic flux during the formation of an AR. By using time-distance helioseismology to image sound-speed variations prior to the appearance of the active region on the solar surface, Kosovichev et al. (2001) made the very first attempt to observe an emerging active region in the solar interior. This research focused on increases in magnetic flux associated with the AR emergence, showing that the flux is fragmented and travels very quickly through the top 18 Mm layer of the convection zone, with a speed of about 1 km/s. Similarly, Hartlep et al. (2011) explored the feasibility of using variations in acoustic power as a precursor to detect signatures of emerging magnetic flux for AR10488. More specifically, they demonstrated that subsurface structures influence the acoustic power at the overlying photosphere, suggesting that changes in acoustic power could be indicative of active regions before they become visible on the solar surface."}, {"title": "2. DATASET", "content": "To train and test LSTM models to forecast the emergence of ARs, a novel ML-ready dataset was created by tracking before, during, and after their emergence 61 ARs, using data from the Helioseismic and Magnetic Imager (Scherrer et al. 2012, HMI) onboard the Solar Dynamics Observatory (Pesnell et al. 2012, SDO). Each selected AR appeared on the solar surface within 30 degrees longitude from the central meridian between March 1st, 2010 and June 1st, 2023, persisted for more than 4 days, and reached a total area of 200 millionths of the solar hemisphere. This longitude range was chosen to minimize significant distortion due to projection and center-to-limb effects.\nThe HMI instrument provides high-resolution maps of three different physical quantities: a) the Doppler velocity VD, b) the line-of-sight magnetic flux Im and c) the continuum intensity Ic on the solar surface. For all three data products, we tracked the corresponding 30.66 \u00d7 30.66 degrees (heliographic coordinates) area around the 61 ARS included in the dataset, taking into account the local rotation speed. These solar disc patches represent a 512 \u00d7 512-pixel square centered around the target AR and are tracked through time by dividing them into overlapping 8-hour time series. Each one of these overlapping 8-hour series is comprised of 640 frames, with a cadence"}, {"title": "3. LSTM MODELS TRAINING, TESTING AND ARCHITECTURE", "content": "Understanding and capturing those changes in Pa and Im that precede the emergence of an AR and thereby enable their prediction is a complex and challenging task. Long Short-Term Memory (LSTM; Sherstinsky 2020) networks have been for many years a popular machine learning method used successfully for various tasks, such as flood forecasting (e.g., Le et al. 2019), sea surface temperature (e.g., Zhang et al. 2017) and even financial market (e.g., Fischer &\nKrauss 2018) predictions. In this section, we discuss three key aspects of the LSTM models used for forecasting AR emergence: the training and testing methodologies employed and the architecture of the various networks.\nWe train the LSTM models using the Pa, \u0424m, and Ic time series that describe the evolution of the ARs in Tables 6 and 2. Algorithm 1 outlines the training process we follow. The first step is to load the ML-ready data, the data that have gone through the processing discussed in Section 3 and are in the form of 240-hours-long time-series (one-hour cadence). Time-series for the four mean Pa frequency intervals, the Im and Ic values (6 physical quantities), for each one of the 63 tiles of the 9-by-9 grid in Figure 1 are used for training. The 9-by-9 grid has 81 tiles. The top and bottom rows are not used due to the geometric effect removal we apply to all data, bringing the total number of tiles to 63. This geometric effect normalization assumes that the top and bottom rows are parts of the quiet Sun and is further discussed by Kasapis et al. (2024). The processed training dataset (ML-ready) has 17,010 timelines available (63 tiles \u00d7 40 ARS \u00d7 6 physical quantities), and it occupies no more than 150 MB of data storage per AR.\nSimilar to AR11158 (Figure 1, left), none of the 45 tracked ARs occupies more than 10 tiles out of the 81 present in the grid. Imbalanced datasets in machine learning are problematic because they can lead to biased models that are overfitted to the majority class, resulting in poor performance on the minority class, which, like in our application, is often the most critical to predict (Chen et al. 2024). The imbalance between tiles that exhibit activity over time ('Emerging' tiles) and tiles that do not ('Quiet' or 'Non-emerging' tiles) is dealt with by omitting the top and bottom three (predominantly non-active) rows of data during training. By not using part of the grid, we keep a balance between the number of active and non-active tiles. It was observed that without adding a weighting parameter, a model trained on the entire tracked patch tends to over-fit on the quiet Sun data.\nAfter removing the dataset's imbalance, the remaining 2430 timelines (9 tiles \u00d7 45 ARs \u00d7 6 physical quantities) are split into training and testing datasets as discussed in Section 2. The training of the models is performed by iterating through the different ARs and the tiles within them, updating the model's weights separately for each tile. This approach ensures that the model recognizes each tile sample as a distinct region of the Sun rather than interpreting tile batches as different feature types within the same area. As seen in Algorithm 1, before the AR and Tile iterations begin, we initialize the optimizer and set the learning rate (LR) of our choice. In this work, we use the Adams optimizer provided by the PyTorch library. For every AR (Algorithm 1, line 6) and every Tile within the AR (line 7), the"}, {"title": "4. ACTIVE REGION EMERGENCE PREDICTION", "content": "There is currently no community-wide accepted definition of active region emergence. For instance, NOAA defines emergence every 24 hours, as they issue a Solar Region Summary report at the end of each UTC day. Sometimes, the time of AR emergence is defined as the time when the emerging magnetic flux is associated with strong diverging flows and decreased continuum intensity following the formation of the active region. To be able to evaluate the performance of the developed ML models, we define AR emergence as the time when continuum intensity decreases for more than 3 hours with speed over 0.01 (in relative units):\n$\\frac{dI_c}{dt} <-0.01$ for $t_{sus}$ > 3 hours,\nwhere I is continuum intensity (predicted or observed), and tsus is the sustained time. This definition of a moment of AR emergence reflects what an observer would define as emergence during visual inspection.\nFor instance, we evaluate Model 8 (Table 3) on predicting the emergence of AR13179. Each panel in Figure 3 represents the observed (orange curves) and predicted (blue curves) evolution of the continuum intensity for the seven tiles (38 \u2013 44) enclosed in red squares in the bottom right Ic maps. The time derivative for observed and predicted continuum intensity, dIc/dt, is included at the bottom of each panel. Color-coded in green is the non-emergence state, while red is emergence - the parts of the dIc/dt curves that fulfill Equation 2. The LSTM model can distinguish between tiles that remain quiet throughout observations and tiles that exhibit activity. For example, the model predictions show a good agreement with observations in both cases when emergence is apparent (e.g., tiles 40-41; Figure 3), and when the analyzed areas remain quiet (e.g., tiles 38-39).\nTypically, the model prediction deviates from observations after AR emergence (e.g., tiles 42-43). This discrepancy can be explained by the interaction of emerging magnetic fields and the reorganization of the convection structure at the photosphere, which affects the properties of the power maps. Another reason for the appearance of such discrepancies is that the training dataset is mainly focused on the period during which the AR is emerging, rather than the later AR evolution period. Despite these limitations, we can often see a remarkable qualitative agreement with observations over significant time of the AR evolution (e.g., tiles 40-42 for AR13179; Figure 3).\nTo identify the moment of AR emergence both in predictions and observations, we use criteria that describe the decreased rate of the continuum intensity (Equation 2). During the emergence and formation of the active region, the magnetic flux can spread across several tiles. Therefore, we assume that the AR emergence start time (predicted or observed) is the earliest moment when the emergence criterion is satisfied (e.g., tile 41 in Figure 3). Thus, the model predicted emergence on 2022-12-28 18:00 (black dotted line in Figure 3, First Warning), half a day before the observed emergence at 2022-12-28 06:00 (red dotted line in Figure 3, Emergence Start). The satisfaction of this criterion for other tiles (red dIc/dt) is caused by the expansion of the emergence of these tiles or the movement of magnetic flux together with diverging flows during emergence.\nWhile it is logical for the first tile where emergence is observed to also be the one where Model 8 triggers its initial alarm, it is not always the case, as Pa flows move and can potentially trigger the Model 8 emergence alarm in neighboring tiles. One such case is AR11726 (Figure 6 in Appendix), where although the first activity warning is produced in Tile 41 at 2013-04-19 14:00, the first observed emergence happens on the neighboring Tile 42 at 2013-04-19 19:00. The existence of incorrect local activity predictions (ILAP) can also be attributed to this movement of flows between the arbitrarily chosen tiles of our analysis and they will be further discussed later in this text. Nonetheless, for four out of the five ARs we have included in our testing dataset, our model signals its first activity alarm (moment of the emergence prediction) not only at the same tile it was observed, but also many hours before it was observed, as seen in the AR Emergence Prediction (Experiment) column of Table 4.\nIf we consider tiles as independent instances, we can evaluate the local continuous intensity evolution and the possibility of predicting the magnetic flux increase. This approach can be useful for future studies to capture situations when emergence takes place in different tiles close to each other. Tile 42 for example (Figure 3), based on the observed Ic, presents its first observed activity at 2022-12-29 19:00 while the first activity is predicted 12 hours ahead for 2022- 12-30 05:00, therefore Model 8 produces its first activity alarm at 2022-12-29 17:00, 2 hours ahead of the observed activity. Similarly, tile 40 has its first activity observed at 2022-12-30 01:00 while the first activity prediction is at 2022-12-29 17:00, which means that the first activity alarm was produced at 2022-12-29 05:00, 20 hours ahead of the observed. Therefore, if we treat each tile of AR13179 independently, activity on tile 40 is predicted 20 hours ahead, on tile 41, 12 hours ahead, and on tile 42, 2 hours ahead. These independent tile AR emergence forecast times are also tabulated on Table 4, under AR13179 and the respective tile number (Activity Prediction for Selected Tiles columns). Following the same analysis for the rest active regions used for testing (AR11698, AR11726, AR13165, and AR13183) we obtain the remaining forecast times in Table 4. Corresponding plots for these testing ARs, can be found in the Appendix (Figures 5 - 8).\nAll models presented, during testing, had output vectors of length Out = 12 hours (prediction window), with a data cadence of 1 hour. In reality, there are two reasons for which, in an operational setting, where predictions are produced in real-time, this model would only be able to predict values 5 hours in advance. The first reason stems from"}, {"title": "5. INCORRECT LOCAL ACTIVITY PREDICTIONS", "content": "Treating each tile independently allows us to explore the sensitivity of the LSTM model to mean evolution variations of the convection oscillatory properties, the continuum intensity, and present changes of magnetic flux. It is important to note that during AR emergence, a strong diverging flow may transport magnetic flux from one tile to another, which may cause strong variations in the acoustic power. Therefore, after the first alarm of AR emergence (tile 41, Figure 3), the LSTM model correctly predicts the incoming activity of neighborhood tiles (tiles 40 and 42). In this section we are discussing a few cases when LSTM model incorrectly predicted such activity.\n5.1. AR11698, Tile 50\nThe LSTM activity prediction in the vicinity of AR11698 (Figure 5) shows incorrect local activity predictions (ILAP) in tile 50 (red part of derivative curves in Figures 5 and 4). The decrease of the continuum intensity predicted by different LSTM models (Figure 4, upper left panel) was driven by significant suppression of the 3-4 mHz mean power that precedes the increase in the unsigned magnetic flux for 4 hours, while other frequency ranges don't show strong changes with time. Interestingly, the Model 8 is more sensitive to changes in the integrated properties of oscillations, while models Models 1 and 2 reveal less sensitivity to the background conditions at the photosphere.\n5.2. AR13179, Tile 43\nSimilarly, Models 1 and 8 predict some magnetic activity on tile 43 in the vicinity of emerging AR13179 (Figures 3 and 4, right upper panels) while when observed, no significant changes in the mean continuum intensity are detected. In this case, even though emergence started in tile 42, magnetic flux shows a slow, gradual increase. In general, the mean power for the 3-4 mHz and 4-5 mHz frequency ranges show a significant enhancement and variations in time (Figure 4, right bottom plot), which makes interpretation of results challenging. These strong fluctuations in the power of oscillations were captured by Models 8 and 1 and were interpreted as a sign of upcoming activity. This example illustrates a possible way to improve our LSTM modeling, as, in its current version, the model considers relative variations of the acoustic power, which prevents it from recognizing the background enhancement in the acoustic power. Nevertheless, this existing limitation didn't prevent us from obtaining a reliable emergence prediction for AR13179."}, {"title": "6. CONCLUSIONS AND FUTURE WORK", "content": "This paper addresses the problem of predicting the emergence of active regions (ARs) by developing a dataset that includes 61 ARs tracked with solar rotation before and after emergence. This dataset was used to generate acoustic power time-series for four different frequency ranges. In this research only 45 ARs were utilized due to the presence of data gaps on the remaining 16 ARs. Using the acoustic power (Pa) and unsigned magnetic flux (\u0424m) time series as input, we developed LSTM models to predict decreases in the continuum intensity (Ic) associated with the emergence of an AR. Despite utilizing four frequency ranges to predict AR emergence, we found that power maps for 3-4 and 4-5 mHz frequency ranges carry most of information related to coming emergence of an AR.\nThe trained models' performance was tested on 5 ARs, unseen during training, using two evaluation criteria: the RMSE between predicted and observed intensity, and the comparison between true and predicted time of emergence, based on the Equation 2 criterion. One of the best-performing models trained during this research, Model 8, succeeded in predicting the emergence of all 5 ARs in an experimental setting and 3 of them in an operational setting. The model predicted the emergence of AR11726, AR13165, and AR13179, 10, 29, and 5 hours in advance, respectively, while variations of this model achieved average RMSE values that are as low as 0.06 for quiet (non-emerging) tiles and 0.16 for active (emerging) tiles. This LSTM network application demonstrates the ability of an ML model to capture solar Pa anomalies and predict Ic variations, resulting in the first trained network of its kind capable of forecasting AR emergence. By analyzing the inputs of the ML models during training and comparing them to the output predictions, we identify the necessary improvements in the model's training and data curation that will allow for better AR emergence predictions in the future.\nThe three models presented in Figure 4 produce incorrect local activity predictions (ILAPs) because they are spatially agnostic. During training, there is no information provided to Models 1, 2 and 8 in regards to which AR each tile belongs to, which part of the AR it belongs, nor which are its neighboring tiles. This training scheme that assumes the independence of each tile does not allow the network to understand the relationship between Pa variations in neighboring tiles. Because Pa often flows between the arbitrarily chosen borders of the tiles, a decrease in Pa on one tile can potentially lead to a decrease in Ic, not in the same tile but in a neighboring one, as seen in Figure 4. To solve this problem, methods that inform the model about the spatial arrangement of the tiles should be used. Spatially informed models will be able to relate the variations of the Pa not only with the Ic of the same tile but also Pa and Ic of different tiles. Assigning coordinates to the time series of each tile used as input during training could potentially lead to the reduction of ILAPs.\nThe analysis of the AR emergence results highlights potential improvements not only for the ML-ready dataset but also for the methods used to train and test the ML models. The 9-by-9 grid setup used here produces 81 tiles, for the majority of which (> 90%) no activity can be detected. This active-quiet tile imbalance is addressed by omitting the majority of quiet tile time series during training to create a balance between the two types of data. This training technique, although adequate for training the models presented, discards a large amount of training data, which can potentially carry useful information related to AR emergence. To address the imbalance between positive and negative instances but also train on all the data available, space weather prediction works (Kasapis et al. 2024) have either used weighting factors or have been randomly sampling different negative instances in every training epoch, two methods that are apt to this research too and could potentially improve the prediction capabilities of the models.\nThe prediction of ARs involves analyzing complex, temporal data collected from various parts of the solar surface, therefore capturing long-range dependencies between Pa, Im and Ic patterns is crucial. Although LSTM models are fit for such tasks, in recent years, Transformers (Vaswani et al. 2017) have been the most prominent alternative due to their self-attention mechanism, which allows them to simultaneously process different input data (ex., different Pa frequency ranges) and establish relationships across long sequences more effectively than the sequential processing approach of LSTMs. This ability to maintain global context without losing information over long time spans is partic- ularly beneficial for understanding the intricate and extended temporal patterns of emerging AR data. Furthermore, transformers' parallel processing capability significantly accelerates the training of large datasets, which is essential if training is performed without discarding any non-emerging tiles in the training dataset, as in such cases, the training time increases at least by 8 times.\nThroughout this work, two metrics have been used to evaluate the LSTM models' capabilities of predicting the emergence of ARs: the RMSE metric and the emergence criterion. While RMSE is a commonly used criterion in ML time-series prediction, the emergence definition outlined in Equation 2 was specifically devised for this research due to the absence of a precise AR emergence start time definition in the literature. This definition of the emergence time of"}, {"title": "ACKNOWLEDGMENTS", "content": "We want to thank the NAS Visualization Team (Nina McCurdy, Timothy Sandstrom, Christopher Henze) for their help with this project's visualizations. This work is supported by the NASA AI/ML HECC Expansion Pro- gram, NASA Heliophysics Supporting Research Program, and the NASA grants 80NSSC19K0630, 80NSSC19K0268, 80NSSC20K1870, and 80NSSC22M0162. The code and data used to produce the results presented in this manuscript can be found at zenodo.com/tbd"}]}