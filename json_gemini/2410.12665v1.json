{"title": "Hamiltonian bridge: A physics-driven generative framework for targeted pattern control", "authors": ["Vishaal Krishnan", "Sumit Sinha", "L. Mahadevan"], "abstract": "Patterns arise spontaneously in a range of systems spanning the sciences, and their study typically focuses on mechanisms to understand their evolution in space-time. Increasingly, there has been a transition towards controlling these patterns in various functional settings, with implications for engineering. Here, we combine our knowledge of a general class of dynamical laws for pattern formation in non-equilibrium systems, and the power of stochastic optimal control approaches to present a framework that allows us to control patterns at multiple scales, which we dub the \"Hamiltonian bridge\". We use a mapping between stochastic many-body Lagrangian physics and deterministic Eulerian pattern forming PDEs to leverage our recent approach utilizing the Feynman-Kac-based adjoint path integral formulation for the control of interacting particles and generalize this to the active control of patterning fields. We demonstrate the applicability of our computational framework via numerical experiments on the control of phase separation with and without a conserved order parameter, self-assembly of fluid droplets, coupled reaction-diffusion equations and finally a phenomenological model for spatio-temporal tissue differentiation. We interpret our numerical experiments in terms of a theoretical understanding of how the underlying physics shapes the geometry of the pattern manifold, altering the transport paths of patterns and the nature of pattern interpolation. We finally conclude by showing how optimal control can be utilized to generate complex patterns via an iterative control protocol over pattern forming pdes which can be casted as gradient flows. All together, our study shows how we can systematically build in physical priors into a generative framework for pattern control in non-equilibrium systems across multiple length and time scales.", "sections": [{"title": "Introduction", "content": "Over the last century, the study of the spatio-temporal dynamics of patterns started to come of age via the realization that certain general mathematical frameworks transcend specific applications, an idea that was first espoused by Landau [1] in the context of equilibrium phase transitions, but since generalized to other physical [2], chemical [3], material [4] and biological systems [5]. Theories for pattern prediction follow from different microscopic dynamics, e.g. Langevin dynamics or master-equation frameworks that take phenomenological coarse-grained forms of conservation laws and various types of closures guided by symmetry (and broken-symmetry). This typically (data-poor) theory-rich approach which has had enormous success in explaining the origin of patterns in natural and artificial settings has recently begun to be supplanted and supplemented by a data-rich (theory-poor) approach to pattern generation driven by advances in modern machine learning methods that enable the generation of diverse and realistic patterns by learning from large datasets [6]. Recent work [7] has attempted to provide insights into the underlying mechanisms driving pattern emergence in these models which leverage the combination of vast training sets and fast computing methods and resources. This naturally raises the question of how to build on this and incorporate the principles of pattern formation embodied in conservation laws, symmetry constraints, and material properties (empirical constitutive relations) as priors for generative algorithms for pattern control? And thence incorporate interpolation schemes that allow for the specification of physical constraints and dynamical laws into"}, {"title": "Hamiltonian bridge formulation for pattern control", "content": "We begin by considering an evolution equation that is robust enough to encompass a class pattern forming systems (see SI section S4 for derivation of deterministic PDEs from stochastic many-body lagrangian physics which also forms the algorithmic basis for solving the optimal control experiments)\n$\\frac{\\partial \\phi}{\\partial t}(t, z) + \\nabla \\cdot (m(\\phi(t, z)) (v(t, z) + u(t,z))) = R(t, z) + S(t, z)$ (1)\nwhere the scalar field $(t, z)$ represents the system state, i.e., pattern evaluated at time t at a point $z \\in $\\Omega in an (unbounded) planar domain. Here, $m($(t, z))$ is the (potentially nonlinear) mobility, v(t, z) is the passive (known) flux associated with variations in the passive chemical potential, and u(t, z) is the active conserved (unknown) control flux and R(t, z) is the passive non-conserved (known) reaction field, and S(t, z) is the active (unknown) control reaction field, all of which are functions of time t and space z\u2208 $\\Omega$ defining the domain. In studies of pattern formation [20], there are no active fluxes or reactions, and instead one aims to describe the phase diagrams for various types of patterns as a function of the problem parameters (e.g. the free energy, advective flow etc.). Complementing these efforts, in studies of active systems [21], the active fluxes and forces are known and subject to additional constraints, e.g. reciprocity, odd-ness etc. but the focus still remains on pattern prediction to define and describe the different qualitative phases that arise.\nHere, we deviate from this perspective of pattern prediction to that of pattern control and ask how we might deploy the control vector flux u(t, z) and/or the reaction field S(t, z) to pattern $(t, z)$ over a time horizon [0, T] in a domain $\\Omega$ to steer the pattern towards a target pattern $\\phi_*(z)$ while minimizing a measure of the steering costs. Of the various choices of the instantaneous steering costs, we choose a minimally effective one given by\n$C_{\\gamma_{\\alpha}, \\gamma_{\\nu}}(\\tau, \\phi, u, S) = \\frac{\\gamma_u}{2} \\int_{\\Omega} m(\\phi(t,z) ||u(t, z) ||^2 d^2z + \\frac{\\gamma_v}{2} \\int_{\\Omega} (S(t, z))^2 d^2z$\nwhere the first term is a time-extensive cost that is proportional to the flux, while the second time-extensive cost corresponds to the reaction term; $\\gamma_u, \\gamma_v$ are the weight parameters. The choice of a quadratic form for the cost is common in many applications, and leads to an easily implementable fast"}, {"title": "Eulerian-Lagrangian optimal control framework", "content": "With the general framework in place, we now briefly describe the numerical method for implementing the Hamiltonian bridge formulation (5) for optimally steering pattern forming systems (for details see SI section S4). Since the control of patterns often involves moving boundaries, we adopt a Lagrangian perspective instead of an Eulerian description. We switch between the Eulerian representation given by (1) and the Lagrangian representation using smoothed-particle-hydrodynamics [23], an approach to convert any field-theoretic formulation into a particle-based meshless formulation that is amenable to parallelization and speed-up. This allows us to discretize the forward (passive) Eulerian PDE and create a Lagrangian framework for the dynamics of particles and write the patterning field as $(t, z) = \\sum_{i=1}^{N} \\kappa(z - x_i(t)) \\phi_i(t)$, where $\\kappa(z - x_i(t)) \\sim exp(-\\frac{||z - x_i(t)||^2}{2\\sigma(s)^2})$ is an unnormalized Gaussian kernel with $\\sigma(s)^2$ being the size of the \u201csmoothed-particle\u201d with $s \\in [0, 1]$ characterizing the coarse-graining scale (with s = 0 being maximally fine-grained and s = 1 being maximally coarse-grained), z the discretized Eulerian position in $\\Omega$, $x(t) = (x_1(t), . . ., x_N(t))$ the dynamic Lagrangian positional degrees of freedom ($x_i(t) \\in $\\Omega$ for all $i \\in \\{1, ..., N\\}, t \\in R^+$), and $\\phi(t) = (\\phi_1(t), ..., \\phi_N(t))$ is the discretized Lagrangian pattern field (as shown in Figure 1A). Importantly, the particle-based representation of the forward problem for pattern evolution allows us to utilize our recently developed Feynmac-Kac path integral adjoint method for many-body control [19] on the Lagrangian dofs (x(t), $(t)$) to solve for the control field to steer the pattern dynamics to the desired end state (Figure 1B for a schematic of the implementation of pattern control). Our Eulerian-Lagrangian control formalism naturally extends to situations where the pattern can be steered in a scale dependent (i.e s can be a continuous variable from 0 to 1) fashion which can accommodate for concepts like renormalization [24,25]."}, {"title": "Targeted steering of pattern forming systems", "content": "Motivated by the problems associated with phase separation kinetics, droplet movements on substrates and reaction-diffusion systems that arise in a number of areas in the sciences and engineering, e.g."}, {"title": "Controlling phase separation", "content": "We start by considering the case of controlling phase separation for the case of the dynamics associated with either a non-conserved order parameter (Model A: Allen-Cahn), or a conserved order parameter (Model B: Cahn-Hilliard). For Model A dynamics (Allen-Cahn), the (uncontrolled) phase field $(t, z)$ satisfies the equation $\\phi_t = \\phi \u2212 \\phi^3 + \\nabla^2\\phi$ (and corresponds to the energy functional $E(\\phi) = \\int_{\\Omega} [\\frac{1}{4}(1 \u2212 \\phi^2)^2 + \\frac{\\epsilon}{2} ||\\nabla\\phi(z)||^2] d^2z$, with v = 0 and R = $\\frac{-\\delta E}{\\delta\\phi}$ in (1). For Model B dynamics (Cahn-Hilliard), the (uncontrolled) phase field $(t, z)$ satisfies the equation $\\phi_t = \\nabla^2(\u2212\\phi + \\phi^3 \u2212 \\nabla^2\\phi)$ (corresponding to the velocity field $v = -\\frac{\\delta E}{\\delta\\phi}$ and the reaction field R = 0 in Eq. 3).\nIn either case, we assume that the initial condition is a random distribution given by $\\phi_0$ (see leftmost panels in Figure 2A and Figure 2B) and the final target distribution, $\\phi_*$, is in the form of the letter 'H' (see top left in the bottom panels of Figure 2A and Figure 2B). We see that as the (flux/reaction) control fields pushes the pattern towards the target, the error decreases approximately exponentially (power law) in time for Allen-Cahn (Cahn-Hilliard)(see the inset SI Figure S1, and Movie1 and Movie2 for animations of the controlled Allen-Cahn and Cahn-Hilliard systems respectively). To interpret these"}, {"title": "More generally, Model B dynamics with nonlinear forms of the mobility are known to arise in a range of systems such as dewetting transitions in droplets, motility-induced phase separation etc. and our approach is easily generalizable to those systems as well. As an example, (see SI section S5 for details), the dewetting of a fluid on a substrate corresponds to Model B dynamics with the mobility given by m(\\phi) = $\\phi^3$, and the dewetting velocity field is given by v = -$\\nabla(\\frac{\\delta E}{\\delta\\phi})$, where $E(\\phi) = \\int_{\\Omega} [U(\\phi(z)) + \\frac{\\epsilon}{2} ||\\nabla\\phi(z)||^2] d^2z$. In this case, the transport paths corresponding to the nominal Hamiltonian will themselves have non-zero curvature owing to the nonlinear mobility, and a", "content": "More generally, Model B dynamics with nonlinear forms of the mobility are known to arise in a range of systems such as dewetting transitions in droplets, motility-induced phase separation etc. and our approach is easily generalizable to those systems as well. As an example, (see SI section S5 for details), the dewetting of a fluid on a substrate corresponds to Model B dynamics with the mobility given by m(\\phi) = $\\phi^3$, and the dewetting velocity field is given by v = -$\\nabla(\\frac{\\delta E}{\\delta\\phi})$, where $E(\\phi) = \\int_{\\Omega} [U(\\phi(z)) + \\frac{\\epsilon}{2} ||\\nabla\\phi(z)||^2] d^2z$. In this case, the transport paths corresponding to the nominal Hamiltonian will themselves have non-zero curvature owing to the nonlinear mobility, and a"}, {"title": "Controlling morphogenesis", "content": "We now turn to two examples inspired by reaction-diffusion systems in chemistry and engineering [31], and morphogenetic systems in developmental biology [32-34] and engineered mimics thereof. Indeed, recent experimental work shows that it is possible to control patterns in reaction-diffusion experiments using empirical methods [31], and similarly in developmental systems [35], raising the question of how to do so in a principled manner. This necessitates increasing the complexity by steering patterns us-"}, {"title": "where the energy functional E is given by\n$E(\\rho, \\phi) ) = \\int_{\\Omega} (f(\\rho) + g(\\rho) ||\\nabla\\phi||^2) d^2z$.", "content": "where the energy functional E is given by\n$E(\\rho, \\phi) ) = \\int_{\\Omega} (f(\\rho) + g(\\rho) ||\\nabla\\phi||^2) d^2z$.\nWe note that the intercellular interaction consists of a long-range attraction (f($\\rho$)) and short-range repulsion (g($\\rho$)) between different cell types (See SI section S7 for both the discretized version of the problem and the exact form of E($\\rho$,$\\phi$)). The first equation in (12) describes the dynamics of the controlled cell population as it progresses due to a combination of internal dynamics and external control (here we assume that total cell number is conserved, even though cell type is not), while the second equation in (14) describes the dynamics of cell fate which is advected at a velocity determined by active cell movement, while simultaneously being changed via reactive terms associated with the effect of the local cell population, as well as external control. The terminal penalty is given by\n$\\Psi(\\rho, \\phi) = \\frac{\\delta_{\\epsilon}}{4} \\int_{\\Omega} \\Pi_{k=1}^{2} (\\phi-C_k)^2 \\rho d^2z + \\frac{\\delta_{\\mu}}{2} \\sum_{k=1}^{2} \\int_{\\Omega} e^{-\\frac{(\\phi-C_k)^2}{2\\delta^2}} ||z - \\mu_k||^2 \\rho d^2z$\nwhere $C_k = \\{-1,1\\}$ characterizes the final differentiated states at spatial location $\\mu_k$ (where $k = 1,2$ corresponding to the differentiated states -1 and 1) and $\\delta$ sets the spatial range of specificity of the morphogen to the gene expression state. The first term in the terminal cost corresponds to differenti-ation and penalizes undifferentiated (internal) terminal states, while the second term corresponds to segregation and penalizes deviation from (external) target locations for the population.\nUsing our SPH approach, we convert the above Eulerian description to a Lagrangian one and then deploy our algorithm for stochastic optimal control (see SI section S4 for the SPH approach and SI section S7 for the discrete problem formulation). Figure 4B shows the sequential time snapshots of the controlled dynamical system where the cells undergo differentiation from a homogeneous pluripotent state (green) to a differentiated spatially segregated state (see Movie5) as the area of the differentiated states (i.e red and blue) initially increases and then reaches a steady state in time as cells simultaneously differentiate and migrate to specific target sites (see SI Figure S4)."}, {"title": "Optimal control as a generative modeling framework", "content": "So far, we have only considered passive physics given by gradient flows which might seem very restrictive at first. We now show that gradient flows emerge naturally from the framework of optimal control and hence form a necessary and sufficient class for very large class of pattern-forming PDEs. In the absence of any intrinsic pattern forming capacity, corresponding to (1) with v = 0 and R = 0, we first ask how to steer a pattern forming system using a combination of a conserved flux-based steering control vector field u and a non-conserved reaction field S. In terms of the value function given by\n$F(t, \\phi) = \\min_{u,S} \\{\\frac{\\gamma_u}{2} \\int_t^T \\int_{\\Omega} m(\\phi(\\tau, z) ||u(\\tau, z)||^2 d^2z d\\tau + \\frac{\\gamma_v}{2} \\int_t^T \\int_{\\Omega} S^2(\\tau,z) d^2z d\\tau + \\Psi(\\phi(T)),\\newline s.t. \\{ \\frac{\\partial \\phi}{\\partial \\tau} (\\tau,Z)+ \\nabla \\cdot (m(\\phi(\\tau, z))u(\\tau, z)) = S(\\tau, z) \\newline \\phi(t,z) = \\phi(z)\\}$ (13)\nwe ask how to achieve a prescribed target pattern, but now using a relaxation of the terminal constraint to a smooth version given by (S.15), replacing it with a patterning objective functional $J(\\varphi) = \\int_{\\Omega} [U(\\varphi(z)) + \\frac{\\epsilon}{2} ||\\nabla\\varphi(z)||^2", "22,38": "it can be shown (see Section S8 for details) that the value function F(t, $\\phi$) satisfies a nonlinear PDE\n$\\frac{\\partial F}{\\partial t} + \\frac{1}{2\\gamma_u} \\int_{\\Omega} m(\\phi)||(\\frac{\\delta F}{\\delta\\phi})||^2 d^2z + \\frac{1}{2\\gamma_v} \\int_{\\Omega} (\\frac{\\delta F}{\\delta \\phi})^2 d^2z = 0 holds for any t, $\\varphi$ (14)\n$F(T, \\varphi) = \\int_{\\Omega} [U(\\varphi(z)) + \\frac{\\epsilon}{2} ||\\nabla\\varphi(z)||^2"}]}