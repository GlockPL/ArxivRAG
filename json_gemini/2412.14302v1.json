{"title": "SAFERec: Self-Attention and Frequency Enriched Model for Next Basket Recommendation", "authors": ["Oleg Lashinin", "Denis Krasilnikov", "Aleksandr Milogradskii", "Marina Ananyeva"], "abstract": "Transformer-based approaches such as BERT4Rec and SAS-Rec demonstrate strong performance in Next Item Recommendation (NIR) tasks. However, applying these architectures to Next-Basket Recommendation (NBR) tasks, which often involve highly repetitive interactions, is challenging due to the vast number of possible item combinations in a basket. Moreover, frequency-based methods such as TIFU-KNN and UP-CF still demonstrate strong performance in NBR tasks, frequently outperforming deep-learning approaches. This paper introduces SAFERec, a novel algorithm for NBR that enhances transformer-based architectures from NIR by incorporating item frequency information, consequently improving their applicability to NBR tasks. Extensive experiments on multiple datasets show that SAFERec outperforms all other baselines, specifically achieving an 8% improvement in Recall@10.", "sections": [{"title": "Introduction", "content": "The field of next-basket recommendations (NBR) has attracted significant interest from both academic [16,23,25] and industry [12,13], primarily caused by the NBR's critical role in enhancing the user experience on e-commerce platforms. Predicting users' subsequent purchases is essential in today's digital shopping landscape, supporting features like item reminders [14], product discovery [9], and efficient order creation [27, 30]. Additionally, the increasing complexity and size of e-commerce platforms demonstrate a strong demand for innovations and further improvements in NBR methodologies.\nSome of the best performing methods in NBR are frequency-based algorithms, such as TIFU-KNN [8] and UP-CF [6], which outperform even deep learning methods on these tasks [16]. However, despite their superior performance,"}, {"title": "SAFERec", "content": "Problem Formulation. In a typical Next Basket Recommendation (NBR) scenario, we have a set of users U and items V. For each user in the dataset there is an ordered set of purchases with baskets $B_u = {b_1^u,..., b_{l_u}^u}$, where $b_i^u = (i_1^u,..., i_{|b_i^u|}^u)$ represents an unordered set of items. The objective of NBR is to predict the next basket $b_{l_u+1}^u$ for a user u. In offline experiments, models usually predict $b_{l_u}^u$ based on the purchase history, known as the leave-one-out evaluation protocol. However, in real-world applications, the system operates with the entire $B^u$ and can be evaluated once the next basket $b_{|B^u|+1} \\in B^{u+1}$ is observed."}, {"title": "Architecture", "content": "History Encoding Module. SAFERec processes each user's purchase history $B_u$ in mini-batches. This begins with the conversion of baskets into sparse multi-hot vectors $q_u \\in R^{|V|}$, where the i-th component equals 1 if item i is present"}, {"title": "Approaches to Frequency Module.", "content": "To address the highly repetitive nature of user purchases in NBR, we introduce the Frequency Module (FM). Prior work, such as TIFU-KNN [8], has shown that Recurrent Neural Networks struggle to accurately capture sums of input vectors, raising similar concerns about the effectiveness of Transformer layers for this task. In NBR, it is essential to recommend previously purchased items, yet encoding all possible item combinations within the latent user vector $u_h$ can be challenging for models like SASRec."}, {"title": "Proposed FM Approach.", "content": "To tackle this issue, we incorporate item occurrence frequencies into the model, as illustrated in Figure 1. SAFERec utilizes two learned item embedding matrices: $I_1, I_2 \\in R^{|V|\\times d}$, used for collaborative item representation and frequency aware representation, respectively. For each user-item pair, we define a history vector $h^u = (1{i \\in b_j^u})_{j=1}^L$, indicating whether user u purchased item i in each of their past baskets $B_u$. This history vector helps capture the frequency of item interactions within the user's purchasing history.\nItem-Specific and User-Specific Patterns. FM utilizes both user history vectors, $h^u$, and item embedding, $i_2 \\in I_2$. For explicit frequency accounting, we use learned embeddings $FE \\in R^{Fmax\\times d}$ for each frequency value from 0 to $Fmax$. All values greater than $Fmax$ are clipped to $Fmax$. We concatenate these components to form the vector $c = [i_2+ f_i; h^u]$, which we then process through a series of FC layers with a tanh activation function. This transformation outputs an item-specific frequency-based score $p_{ui}^f$ for each user-item pair.\nUser preferences are incorporated similarly to SASRec through the dot product of the item embedding $i_1$ and the latent user vectors $u_h$ from the Transformer Layer, which encodes patterns from the user's interactions $h_u$. The output $p_{uu} = i_1 u_h$ is the prediction score for a user-item pair, reflecting user-specific patterns.\nThe final prediction of the SAFERec model is generated by summing both scores $p^u = p_{uu} + p_{ui}^f$. We argue that including frequency information helps the model generalize better, improving its performance compared to SASRec [11].\nObjective Function. In order to optimize the parameters of our neural network, we employ the Cross-Entropy Loss function, which remains a highly effective approach according to recent top-n recommendation benchmarks [26]. Like Mult-VAE [17], which predicts the set of items in a top-n recommendation setup, SAFERec predicts the entire basket, in contrast to SASRec and other next-item models that typically predict only one item. Notably, incorporating item frequencies into variational inference methods is left for future work."}, {"title": "Experiments", "content": "We design our experiments to answer the following research questions:\nRQ1 How do frequency-aware techniques affect Transformer performance?\nRQ2 How does SAFERec solve the NBR problem compared to well-established NBR baselines?"}, {"title": "Offline Experimental setup", "content": "Datasets. We run experiments on three public datasets: TaFeng5, Dunnhumby6, TaoBao7. We apply minimal preprocessing across all datasets: users and items with fewer than 5 interactions are removed, as well as users with only one basket."}, {"title": "Results of Offline Experiments", "content": "Table 2 presents findings for both RQ1 and RQ2. First, SAFERec consistently outperforms the SASRec model [11], demonstrating its ability to capture item-specific patterns of recurrent behavior effectively. Additionally, SASRec*, performs nearly at the P-Pop level, suggesting it struggles to promote previously consumed items through hidden vectors alone. Although SASRec* shows an advantage in UN@K, this metric is less emphasized due to its poor ranking quality. Nevertheless, SAFERec excels in recommending novel items, offering a more diverse user experience with higher accuracy. This balance means users receive accurate recommendations while also discovering new products.\nFurthermore, Table 2 addresses RQ2, showing that SAFERec outperforms baselines across all datasets, except the TaoBao dataset, where GP-Pop and TIFU-KNN surpass the model in Recall@100 and NDCG@10, likely due to the dataset's emphasis on rare items. GP-Pop and TIFU-KNN recommend rare items based on user purchase history rather than learned hidden representations. Notably, baseline results align with reproducibility papers [16, 18], where TIFU-KNN, UP-CF, and DNNTSP show comparable performance and outperform GP-Pop. Despite accuracy differences, UN@K indicates SAFERec's higher rate of recommending new items, which could enhance user satisfaction and engagement, outlined in [7,10,15]. Additionally, SAFERec maintains competitive accuracy metrics while exploring novel items. For instance, on TaFeng, SAFERec achieves better quality metrics than UP-CF, recommending 28% more novel items in the top 10 compared to UP-CF's 18%. These results show SAFERec's ability to take exploratory risks without compromising ranking quality, a trend consistent across datasets."}, {"title": "Conclusions", "content": "Our study introduces SAFERec, a novel model for the next-basket recommendations. Inspired by SASRec, designed for the next-item prediction, we present"}]}