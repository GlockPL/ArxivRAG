{"title": "Symmetric Pruning for Large Language Models", "authors": ["Kai Yi", "Peter Richt\u00e1rik"], "abstract": "Popular post-training pruning methods such as Wanda (Sun et al., 2023) and RIA (Zhang et al., 2024b) are known for their simple, yet effective, designs that have shown exceptional empirical performance. Wanda optimizes performance through calibrated activations during pruning, while RIA emphasizes the relative, rather than absolute, importance of weight elements. Despite their practical success, a thorough theoretical foundation explaining these outcomes has been lacking. This paper introduces new theoretical insights that redefine the standard minimization objective for pruning, offering a deeper understanding of the factors contributing to their success. Our study extends beyond these insights by proposing complementary strategies that consider both input activations and weight significance. We validate these approaches through rigorous experiments, demonstrating substantial enhancements over existing methods. Furthermore, we introduce a novel training-free fine-tuning approach R2-DSnoT that incorporates relative weight importance and a regularized decision boundary within a dynamic pruning-and-growing framework, significantly outperforming strong baselines and establishing a new state-of-the-art.", "sections": [{"title": "1. Introduction", "content": "Large Language Models (LLMs) (Zhang et al., 2022a; Touvron et al., 2023a;b; Javaheripi et al., 2023) have demonstrated remarkable capabilities across a variety of tasks. However, their extensive size often hinders practical deployment. Interest in LLM compression has surged in recent years, driven by the need to reduce model sizes while maintaining performance (Xiao et al., 2023; Frantar & Alistarh, 2023; Sun et al., 2023; Zhang et al., 2024b; Malinovskii et al., 2024). This paper focuses on LLM post-training pruning (PTP), a prevalent method for reducing the footprint of pre-trained weights.\n\nA common approach to pruning is magnitude-based pruning, where elements of each layer's weights with smaller absolute values are set to zero. In contrast, Wanda (Sun et al., 2023) introduced an innovative method that scales the weights by the activations of each layer, demonstrating promising performance on standard benchmarks. Building upon this, RIA (Zhang et al., 2024b) further improved the approach by evaluating the relative importance of each weight across its corresponding row and column before pruning. While their empirical results are encouraging, the underlying mechanisms remain poorly understood. This leads us to our first question:\n\nCan we provide theoretical support for post-training pruning methods and derive more efficient algorithms with minimal adaptations to the existing framework?\n\nTo deepen our understanding of these popular PTP methods, we introduce a novel formulation-referred to as Symmetric Weight And Activation (SymWanda)\u2014that aims to efficiently leverage both the input activation of a layer and the output for that layer. This symmetric and generalized approach provides theoretical insights into the mechanisms of established empirical methods such as Wanda and RIA.\n\nIntrinsic PTP methods have demonstrated remarkable performance, as reflected by perplexity scores and zero-shot accuracy. However, their performance can degrade significantly when the sparsity ratio is high. This is due to the intrinsic reconstruction error between the pruned weights and the original pre-trained weights. Minimizing this reconstruction error is particularly important for efficient post-training pruning. Beyond LLM pruning, we explore further fine-tuning to enhance model efficiency and performance. This brings us to our second problem:\n\nCan we fine-tune pruned LLMs without further training and outperforms state-of-the-art methods with minimal effort?\n\nDynamic sparse training (DST) has gained attention for selectively updating and maintaining a subset of network parameters throughout the training process while dynamically adapting the sparse topology through weight operations. Its proven efficiency in enabling effective training suggests DST could be a promising approach for fine-tuning LLMs in an efficient manner. However, DST inherently requires backpropagation to train subnetworks, and its effectiveness heavily depends on a sufficient number of weight updates (Liu et al., 2021).\n\nInterestingly, the pruning-and-growing step within DST offers a training-free methodology, where sparse mask adaptation is based solely on weight properties such as magnitude (Mocanu et al., 2018). This opens up a potential alternative for addressing the challenge: Instead of relying on computationally intensive backpropagation for fine-tuning sparse LLMs, we can explore the iterative updating of sparse masks in a training-free manner. Motivated by this insight, we focus on training-free fine-tuning approaches.\n\nDSnoT (Zhang et al., 2023) introduced a straightforward yet effective method for pruning and growing weights using their values and statistical metrics (e.g., expectation and variance) for each ongoing pruning row. Inspired by Wanda, DSnoT achieves simplicity but falls short of fully leveraging relative weight information, particularly in scenarios where weight distributions are highly non-uniform and contain many outliers (Zhang et al., 2024b). To address these limitations, we propose incorporating relative weight importance into the growing criterion design. Furthermore, we observe that directly optimizing for reconstruction error is suboptimal. To improve performance, we introduce a regularization term that relaxes the decision boundary. Our new designs demonstrate significant efficiency and consistently achieve promising performance, paving the way for more effective and computationally feasible fine-tuning methods for sparse LLMs.\n\nOur contributions are summarized as follows: i): We propose a novel formulation, SymWanda, which minimizes the impact of pruning on both input activations and output influences of weights. This approach provides theoretical insights into the empirical successes of methods such as Wanda and RIA. ii): Building on this formulation, we introduce a series of innovative pruning strategies. Extensive experiments validate the effectiveness of our methods. Notably, we incorporate an efficient stochastic approach for manipulating relative importance, which achieves superior performance with highly reduced sampling cost. iii): We present a novel training-free fine-tuning method R2-DSnoT that leverages relative weight importance and a regularized decision boundary within a pruning-and-growing framework. This approach significantly outperforms strong baselines, achieving remarkable results."}, {"title": "2. Related Work", "content": "Traditional model pruning. Pruning has emerged as a powerful strategy to compress and accelerate deep neural networks by removing redundant connections while preserving overall performance (Han et al., 2015; Frankle & Carbin, 2018; Hoefler et al., 2021). Early works introduced iterative pruning-and-retraining approaches, which iteratively identify unimportant weights, discard them, and retrain the resulting sparse network to recover accuracy (LeCun et al., 1989; Han et al., 2015). More recent dynamic sparse training techniques (Mocanu et al., 2018; Bellec et al., 2018; Lee et al., 2018; Mostafa & Wang, 2019) start from a sparse initialization and continuously prune and grow connections throughout training. These methods integrate sparsification into the training loop, yielding promising trade-offs between model size and performance. A prominent line of work has leveraged learnable thresholds to realize non-uniform sparsity (Kusupati et al., 2020) or combined magnitude-based pruning with periodic connectivity updates to regrow valuable weights (Evci et al., 2020; Lasby et al., 2023). However, most of these methods still rely on standard back-propagation over the full parameter set, which can be prohibitively expensive when scaling up to LLMs.\n\nLLM post-training pruning. The substantial computational demands of LLMs have raised the development of pruning methods tailored to reduce parameters counts without compromising performance (Li et al., 2023; Zhu et al., 2024). Among these methods, post-training pruning eliminates redundant parameters in a pre-training network without requiring resource-intensive fine-tuning. For instance, SparseGPT (Frantar & Alistarh, 2023) leverages second-order information to solve layer-wise reconstruction problems, supporting both unstructured and N:M structured sparsity (Zhou et al., 2021). Wanda (Sun et al., 2023) introduces a pruning metric that incorporates both weight magnitudes and corresponding input activations, achieving perplexity performance comparable to SparseGPT while surpassing simple magnitude-based pruning. The RIA method (Zhang et al., 2024b) builds on Wanda by considering relative weight importance, offering performance improvements at minimal additional cost. Moreover, DSnoT (Zhang et al., 2023) proposes pruning and regrowing weights based on statistical properties (e.g., mean and variance) in each pruning row, obviating the need for retraining."}, {"title": "3. Symmetric Wanda", "content": "3.1. Prerequisites\n\nPost-training pruning is defined as follows: consider a target sparsity ratio $\\epsilon \\in [0,1)$, a set of calibration inputs $X \\in \\mathbb{R}^{a \\times b}$, and pre-trained weights $W \\in \\mathbb{R}^{b \\times c}$. For clarity in the mathematical framework, we abstract the dimensions of inputs and weights. Specifically, in the context of large language models, let $a := C_{in}$, $b := N \\times L$, and $c = C_{out}$, where $N$ and $L$ denote the batch size and sequence length, respectively. The objective is to identify an optimal pruned weight matrix $\\tilde{W} \\in \\mathbb{R}^{b \\times c}$ that minimizes:\n\n$f(\\tilde{W}) := ||X(\\tilde{W} - W)||_F,$                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    \n        Preprint."}, {"title": "Abstract", "content": "Popular post-training pruning methods such as Wanda (Sun et al., 2023) and RIA (Zhang et al., 2024b) are known for their simple, yet effective, designs that have shown exceptional empirical performance. Wanda optimizes performance through calibrated activations during pruning, while RIA emphasizes the relative, rather than absolute, importance of weight elements. Despite their practical success, a thorough theoretical foundation explaining these outcomes has been lacking. This paper introduces new theoretical insights that redefine the standard minimization objective for pruning, offering a deeper understanding of the factors contributing to their success. Our study extends beyond these insights by proposing complementary strategies that consider both input activations and weight significance. We validate these approaches through rigorous experiments, demonstrating substantial enhancements over existing methods. Furthermore, we introduce a novel training-free fine-tuning approach R2-DSnoT that incorporates relative weight importance and a regularized decision boundary within a dynamic pruning-and-growing framework, significantly outperforming strong baselines and establishing a new state-of-the-art."}]}