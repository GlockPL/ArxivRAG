{"title": "A Trustworthy AIoT-enabled Localization System via Federated Learning and Blockchain", "authors": ["Junfei Wang", "He Huang", "Jingze Feng", "Steven Wong", "Lihua Xie", "Jianfei Yang"], "abstract": "There is a significant demand for indoor localization technology in smart buildings, and the most promising solution in this field is using RF sensors and fingerprinting-based methods that employ machine learning models trained on crowd-sourced user data gathered from IoT devices. However, this raises security and privacy issues in practice. Some researchers propose to use federated learning to partially overcome privacy problems, but there still remain security concerns, e.g., single-point failure and malicious attacks. In this paper, we propose a framework named DFLoc to achieve precise 3D localization tasks while considering the following two security concerns. Particularly, we design a spe-cialized blockchain to decentralize the framework by distributing the tasks such as model distribution and aggregation which are handled by a central server to all clients in most previous works, to address the issue of the single-point failure for a reliable and accurate indoor localization system. Moreover, we introduce an updated model verification mechanism within the blockchain to alleviate the concern of malicious node attacks. Experimental results substantiate the framework's capacity to deliver accurate 3D location predictions and its superior resistance to the impacts of single-point failure and malicious attacks when compared to conventional centralized federated learning systems.", "sections": [{"title": "I. INTRODUCTION", "content": "Nowadays, Location-Based Services (LBS) leverage the geographical data from IoT devices or users to provide tailored interaction services, significantly enhancing the IoT user experience, and are widely used in smart cities [1], [2]. According to the application scenarios and requirements, it can be divided into outdoor and indoor localization [3]. Outdoor localization technologies, e.g., GPS, are adopted for driving and navigation [4]. However, owing to complex indoor environmental factors and the absence of GPS signals, these outdoor positioning technologies cannot produce satisfactory results in the indoor environment, especially in complex multi-floor smart buildings, which motivates the research on indoor positioning technology. Indoor localization technology utilizes radio frequency (RF) signals such as WiFi, Bluetooth, and Ultra-Wideband (UWB) and locates the target using the re-ceived signal strength (RSS) that reflects the distance between the sensor and the user device [5], [6], leading to better performances in GPS-denied environments.\nIn the field of RSS-based indoor localization, one of the most prominent solutions is based on fingerprints and machine learning models due to their higher accuracy and adaptability. The indoor positioning algorithm of the fingerprint-based methods typically involves two primary phases: offline training and online localization [4]. During the offline training phase, a collection of reference points is conducted by gathering RSS measurements from known locations within the indoor environment. These reference points are utilized to construct a fingerprinting database. Subsequently, the localization models employ machine learning or even deep learning algorithms to establish a mapping between the signal fingerprints and their corresponding locations. In the online localization phase, the established localization models can determine the device's position based on real-time RSS measurements.\nIn fingerprinting-based indoor localization systems, the training of the machine learning algorithm is conducted on a central server. The users of the localization service trans-mit their fingerprint data from the respective IoT devices to the central server. The central server engages in crowd-sourcing training data from users, trains a deep learning model, and provides indoor localization services, such as building floor classification (BFC) and latitude longitude regression (LLR) [7]. However, such a framework raises several concerns in practice. Firstly, sharing location-linked fingerprint data collected locally with a central entity can raise privacy issues. More and more users prefer not to share the data directly in a central server. Secondly, the training and inference of machine learning algorithms rely solely on a central server, posing a single-point failure, a common security issue in centralized learning systems; when the central server fails, the entire system becomes non-functional until it's restored [8]. Thirdly, the system may be vulnerable to malicious attacks by dishonest clients through the injection of noisy data.\nTo address the privacy concern, Federated Learning (FL) [9] emerges as a promising solution, a machine learning technique that eliminates the need to transfer raw data from clients to the central server, mitigating privacy invasion. However, existing FL methods still suffer from security issues, e.g., single-point failure or malicious attacks. In fingerprinting-based indoor localization systems, single-point failure refers to the situation where the failure of the central server in the model training phase or implementation phase will cause the failure of the entire system. Malicious attacks entail the dispatch of nefarious clients by competitors or adversaries, disrupting the model training process by transmitting falsified or tainted data. On the one hand, as for single-point failure, opting for introducing decentralized technology to ease the over-reliance on the central server is a favorable solution. To this end, we introduce blockchain techniques due to their attributes of decentralization, traceability, and immutability. On the other hand, to counter malicious attacks, we design an update verification mechanism to differentiate between legitimate and malicious model updates, safeguarding our trained model from malicious alterations.\nSpecifically, we propose a Decentralized Federated Learning framework for the AIoT location system (DFLoc), as shown in Fig.1. The DFLoc is a kind of the fingerprint-based localiza-tion system, which consists of several clients. These clients are randomly assigned one of three roles (worker, valida-tor, miner) and engage in model aggregation over multiple iterations to train a location prediction model. This model comprises a classification network, denoted as DFLoc-BFC, and a regression network, referred to as DFLoc-LLR. The roles randomly assigned to the clients include local workers responsible for actual training, update validators tasked with verifying update quality and providing votes, and blockchain miners who aggregate vote results and client stakes and upload them onto the blockchain. At the end of each round, all de-vices, regardless of their previous roles, collectively aggregate model parameters whose received positive votes exceed the negative votes. This ensures that models suspected of poor quality or tampering are excluded from the model aggregation process. In the experimental part, we use WiFi data to validate the effectiveness of our proposed DFLoc system, since WiFi is one of the most prevalent methods in fingerprint-based indoor localization systems [10].\nDrawing upon the concepts above, this paper formulates and presents a novel decentralized federated location framework called DFLoc. The primary objective of DFLoc is to address the previously mentioned challenges and make the following contributions:\n\u2022 We aim to deal with the privacy and security issues in indoor localization by a decentralized federated learning framework. As far as we know, this is the first work that deals with both two issues simultaneously in RSS-based indoor localization systems.\n\u2022 We revamp federated learning with blockchain algorithms to decentralize the system framework. This addresses the single-point failure problem caused by over-reliance on the central server.\n\u2022 We design an update validation mechanism and integrate it into the blockchain to mitigate the impact of malicious nodes on the global indoor localization model.\n\u2022 To explore the effectiveness of our proposed framework against single-point failure and malicious attacks, we take the traditional centralized federated learning (CFL) as the baseline to conduct some experiments on a real-world dataset of WiFi fingerprints.\nThe structure of this article is as follows: Section II re-views related work. Section III provides an overview of the fingerprinting-based indoor localization problem first, then de-tails our proposed framework, DFLoc, including its operation and the DFLoc validator mechanism. Section IV presents the performance evaluation. Finally, Section V offers the conclusion for the entire work."}, {"title": "II. RELATED WORKS", "content": "Two principal concerns arise in the current research on 3D Indoor Location Systems based on the federated learning. The first concern pertains to the challenge of accurate Indoor 3D localization, while the second revolves around the reliability of federated learning.\nA. Fingerprint-based Indoor Localization\nWithin indoor environments, fingerprinting-based localiza-tion stands out as a favored choice, due to its ease of realization and remarkable accuracy. Implementing a fingerprint-based approach involves deploying several wireless sensors c\u0430\u0440\u0430-ble of acquiring RSS and creating a fingerprinting database, which consists of a set of reference points paired with the corresponding RSS values of the selected signal type for each reference point. Mainstream electronic devices used in daily life, such as laptops and IoT devices, all come with built-in WiFi capability [1]. Concurrently, existing WiFi access points can be used as reference points for signal collection [11]. These factors lead to WiFi as the most prevalent sensing technique for RSS fingerprint-based indoor localization. Some scholars apply centralized learning techniques as a means to address the challenge of WiFi fingerprinting-based indoor localization [12]\u2013[15]. However, all these centralized learn-ing approaches have no longer been the preferred choices when considering personal information privacy and dynamic environment. On the contrary, FL is a more suitable solution"}, {"title": "III. METHODOLOGY", "content": "This section will describe the problem definition of the fingerprinting-based indoor localization in Section III-A", "loss": "n$\\min_{\\omega"}, "epsilon(\\omega)$\nGiven the dataset D that contains n data samples, the local-ization loss is further defined as:\n$\\epsilon(\\omega) = \\frac{1}{n} \\sum_{i \\in D} l(x_i; Y_i; \\omega)$\nwhere $l(x_i; Y_i; w)$ denotes a loss function that characterizes the error between i-th location prediction $\\hat{y} = f (x_i; w)$ and its ground truth value $Y_i$.\nIn traditional indoor localization systems that apply the centralized machine learning technologies [16]-[19], all user data needs to be stored on the central server for training. When data is transmitted or stored on the server, risks of exposing the privacy of the data producers arise. Furthermore, this architecture's heavy reliance on the central server may bring a single-point failure problem, which means if the central server fails, the entire system would lose its functionality. Moreover, it's not reasonable to assume that all the clients are honest. The performance of traditional systems is very vulnerable to malicious attacks like uploading tampered data or local models. Thus, we propose DFLoc to solve the problems mentioned above.\nB. Decentralized Localization System\nAs shown in Fig. 2, the operation of the DFLoc frame-work is maintained by a group of devices, denoted as $D = {d_1, d_2, ..., d_l}$, across R communication rounds. At the onset of the i-th round, all devices are required to retrieve the current global model $G_{i-1}$ from the blockchain. Furthermore, in each epoch, every device is assigned randomly to one of three tem-porary roles: worker, validator, or miner. Consequently, these devices are transiently grouped into three distinct categories, denoted as W, V, M, and $|D| = |W| + |V| + |M|$.\nEach worker $w \\in W$ proceeds to train its local updated model $L^w_i$ using its respective training dataset $D_w^r$. The reward for worker w is calculated as $r_w = e \\times \\frac{|D_w^u|}{|D|} \\times r$, where r is a unit reward. e and $D_w^u$ denote the number of local training epochs and the size of the data samples within $D_w^u$ at the i-th communication round, respectively. It is noticeable that not all workers provide efficient information for the blockchain. Thus, a validation mechanism, which will be detailed in subsection III-C, is designed to distinguish valid workers, whose positive votes exceed negative votes evaluated by the following validators. Once a worker is seen as invalid, the relative reward will be zero. As a result, the transaction data from worker w can be expressed as $T_w^i = {L^w_i,r_w}$, which is further signed by the private signature and sent to the subsequent validators.\nSubsequently, each validator $v \\in V$ examines worker transactions $T_w^i$, one at a time, in a sequential manner until all transactions are verified. Different validators should share the worker transactions they received with peers, ensuring that each validator receives all worker transactions for the current communication round. Subsequently, v discards the transaction data without a digital signature, proceeds to extract $L^w_i$ from $T_w^i$ with a digital signature and evaluate its validity using the DFLoc validator mechanism. Afterward, v issues either a positive or negative vote, denoted as $V^v(L^w_i)$, based on the outcome of the validation process. Following this, v computes the reward, denoted as $r_v^u(L^w_i)$. Analogous to workers, the reward allocated to v is proportionate to the size of its training dataset $D_v^r$. As a result, the total reward accruing to v during i-th communication round is the sum of all $r_v^u(L^w_i)$, and this can be expressed as follows\n$r_v^i = \\frac{|D_v^r|}{|D|} \\times r$\n$r^i = \\sum_{v \\in V} r_v^i(L^w_i) = |V| \\times \\frac{|D_v^r|}{|D|} \\times r.$\nThen, v should encapsulate $T_w^i$, $V_v^u(L^w_i)$ and $r_v^u(L^w_i)$ together to obtain a validator transaction $T_v^u(L^w_i) = {T_w^i, V_v^u(L^w_i), r_v^u(L^w_i)}$, which is then dispatched to the miner which is randomly associated with v after signed by v's private key. Each miner broadcasts to its peers, ensuring the dissemination of all validator transactions among all miners. By doing so, each local updated model corresponds to $|V|$ validator transactions, and each miner will totally receive $|W|\\times |V|$ validator transactions.\nEach miner $m\\in M$ verifies the signature of each validator transaction $T_v^u(L^w_i)$. Upon successful signature verification, m proceeds to extract $T_w^i$, $V_v^u(L^w_i)$, and $r_v^u(L^w_i)$ from the transaction to summarize the vote results of each local updated model $L^w_i$ (denoted as $SV_m^i(L^w_i)$) and the total reward of each validator (denoted as $r_v^i$) in the i-th communication round. Meanwhile, m gets rewards for summarizing the results, denoted as $r_m^i$, which can be expressed as\n$r_m^i = |W| \\times |V| \\times r.$\nAfterward, each miner m undertakes the consolidation of summarized results, including all local updated models $L^w_i$ and corresponding summarized votes $SV_m^i(L^w_i)$, all worker rewards $r_w^i$, all validator rewards $r_v^i$, and its own reward $r_m^i$, to assemble a candidate block denoted as $B_m$. Subsequently, miner m engages in the mining process specific to the Proof of Stake (PoS) consensus which involves hashing the complete content of the block and signing the hash by using its private key. Upon $B_m$ being mined, miner m propagates the mined block to all the other miners in the network.\nFollowing this dissemination, each miner m leverages the stake information recorded on its blockchain to identify and select the block generated by the miner with the highest stake among the set $M$ as the legitimate block $B_i$. Only this legitimate block is deemed suitable for extracting the records of rewards $r_w^i$, $r_v^i$, and $r_m^i$ and summarized votes $SV_m^i(L^w_i)$, along with their corresponding model updates $L^w_i$. Furthermore, each m broadcast this legitimate block to its peers and associated workers w and validators v to ensure that all devices receive this legitimate block $B_i$.\nFinally, each device, denoted as d, regardless of its previous role, is tasked with two pivotal responsibilities to finish the i-th communication round. Firstly, it engages in the aggregation of locally updated models in legitimate block $B_i$ whose count\n    },\n    {\n      \"title\": \"IV. EXPERIMENTS AND SIMULATION\",\n      \"content\":", "In this section, we first describe the experimental setting and then evaluate the efficiency of the proposed system when confronted with malicious attacks and single-point failure, as well as its performance within a 3D environment.\nA. Experimental Setting\n1) Dataset: Without loss of generality, our experiments are conducted on the most commonly used dataset in indoor localization, which is called UJIIndoorLoc [27]. This dataset encompasses 21,049 labeled WiFi fingerprint data points collected from three campus buildings, each having four or five floors. Each data point is characterized by 520 RSS values and the associated location information. These RSS values are derived from 520 wireless access points distributed throughout these buildings. The data elements comprise building and floor information, as well as latitude and longitude coordinates (in meters using UTM from WGS84). Since we aim to deal with privacy and security issues, we avoid the potential variations caused by environmental dynamics by selecting 20% of the original training data to create a new testing set, as described in [20]. The remaining training data is partitioned into l (l = |D) data segments, assigned to individual clients for simulating the FL system. To tackle the classification and regression challenges in complex 3D scenes, such as smart buildings, we employ a dual-network approach. This approach involves the training of two distinct networks: DFLoc-BFC and DFLoc-LLR, each meticulously designed to tackle their respective specialized challenges. In this section, we provide a comprehensive overview of the structures of both networks.\n2) Network Architecture: To solve the BFC problem, we design a classification model called DFLoc-BFC, which takes an RSS measurements vector $x_i$ as input. Every element in this vector corresponds to the measured RSS value of a distinct access point. In the extensive 3D space, the input vector can become lengthy. For instance, in the UJIIndoorLoc dataset, every WiFi fingerprint record contains a 520-element RSS vec-tor from 520 access points within the 3D space. Additionally, input vectors can be sparse due to limited wireless sensing coverage, resulting in many invalid values where certain access points are undetectable at specific locations. Therefore, we integrate a fully connected feature extractor into the input layer to reduce data dimensions and extract features. Furthermore, to capture label similarities among input vectors from the same building and floor, we employ 1D convolutional layers to extract key features, as proposed in [20]. Meanwhile, a fully connected layer following the 1D convolution is designed to convert the vector to 8 bits one-hot encoding which encom-passes a 3-bit segment designated for the explicit denotation of the building index, with the remaining 5 bits allocated for the denotation of the floor index. We set two argmax(\u00b7) functions after these two groups of bits to output the final classification results of the DFLoc-BFC network $\\hat{y}_{BFC} = (BL_i, FL_i)$.\nAs mentioned above, input vectors collected from a consid-erable 3D space covered by many access points may be very lengthy and sparse, so DFLoc-LLR also requires a lightweight feature extractor to implement data dimensionality reduction and feature extraction functions. Then, the following linear layers convert the output of the extractor into a vector of two real numbers $\\hat{v}_{LLR} = (LA_i, LO_i)$, which denote the longitude and latitude of the reference point estimated by the DFLoc-LLR network, respectively. Finally, we combine the outputs of the two networks together to form the final 3D coordinate output and evaluate the 3D localization performance of DFLoc in the experiments in Subsection IV-D.\n3) Implementation Details: All experiments are conducted on a computer with two NVIDIA 2080ti GPUs, an Intel(R) Core(TM) i9-10900K CPU @ 3.70GHz, and 125 gigabytes of available RAM. Our DFLoc framework is trained under the following conditions: We utilize a total of 20 client devices, consisting of 12 workers, 5 validators, and 3 miners. Given the substantial differences in the required epochs for convergence between the two networks, we conduct separate training for each network. In DFLoc-BFC, we adopt the BCELoss as our chosen loss function, employing the Adam optimizer [28]. The selected learning rate is set at 0.001, with a batch size of 100. There are 100 communication rounds with each containing 10 local epochs. The validator-threshold parameter is configured to $T_{BFC}$ = 0.1. In the configuration of DFLoc-LLR, the optimizer, batch size, and local epoch count remain unchanged. However, we switch the loss function to L1Loss, adjust the learning rate to 0.002, and extend the number of communication rounds to 500. Furthermore, the validator-threshold parameter is set to $T_{LLR}$ = 0.9. Throughout our experiments, we employ a conventional centralized federated learning system as the baseline, abbreviated as CFL. Our proposed DFLoc framework is referred to as DFL in the following experiments and analysis for ease of reference.\nB. Evaluation on the effect against malicious attacks\nThis section evaluates the proposed framework's effec-tiveness against malicious attacks in both LLR and BFC components. In the CFL system, malicious devices inject Gaussian noise (zero mean vector and identical covariance matrix) into model parameters which are uploaded during training iterations, to emulate the malicious attacks. In DFLoc, malicious workers also distort local model updates with similar noise.\n1) Evaluation on the effect against malicious attacks on DFLoc-LLR: We conduct an experiment about four schemes: CFL without malicious devices (CFLM0), CFL with 3 ma-licious devices (CFLM3), and two analogous schemes for DFLoc (DFLM0 and DFLM3). In Fig. 3, the orange curve illustrates CFLM3's error distance, highlighting its sensitivity to noisy model updates from malicious devices, resulting in unstable convergence. The comparison between the unaffected blue curve (CFLM0) and the yellow curve (DFLM0) demon-strates similar performance, indicating the functionality of the FL components. Moreover, the purple curve (DFLM3) steadily converges to a relatively low error distance, albeit slightly higher than the blue and yellow curves. This is reasonable, considering that the training sets of malicious devices, which comprise 15% of the total, are never effectively incorporated into the learning process.\nIn Fig. 4, we present four pairs of schemes, each comprising blue (CFL) and orange (DFLoc) bars, reflecting different numbers of malicious devices. Irrespective of the varying count of malicious nodes, DFLoc maintains a consistently low error distance (below 8.5 m), while CFL's performance is notably affected. This underscores the significant impact of malicious attacks on CFL, particularly with a larger number of malicious nodes. In contrast, DFLoc always demonstrates robust resistance to malicious attacks in this work. When malicious nodes constitute 15% of the total, CFL's error distance is four times greater than that of DFLoc.\n2) Evaluation on the effect against malicious attacks on DFLoc-BFC: We assess the classification accuracy of DFLoc-BFC, which measures the ratio of correct building-floor pre-dictions to all predictions. Similar to the evaluation presented in Subsection IV-B1, a comparison of four schemes under a similar configuration is conducted, specifically CFLM0, CFLM3, DFLM0, and DFLM3 as shown in Fig. 5, and the re-sults show similar trends. The orange curve denoting CFLM3 experiences difficulty in convergence, maintaining an accuracy\n    },\n    {\n      \"title\": \"V. CONCLUSION\",\n      \"content\":", "In this work, a novel framework named DFLoc is proposed to address the 3D indoor localization problem in large-scale and complex 3D indoor spaces, particularly under the chal-lenges of malicious attacks and single-point failure. Within this framework, a decentralized federated learning approach is applied to train two networks: DFLoc-BFC and DFLoc-LLR, which provide accurate 3D position estimates based on RSS data. To bolster security and reliability, a model update validation mechanism and a decentralized architecture are incorporated into the federated learning process, effectively preventing the effects of malicious attacks and single-point failure. To better evaluate our DFLoc framework, we conduct extensive experiments using a real-world dataset of WiFi fingerprints. Our results demonstrate that DFLoc can effec-tively mitigate the challenges brought by malicious attacks and single-point failure in 3D environments when compared with the traditional central federated learning system.\nIn future work, we will implement and evaluate DFLoc via real-world AIoT systems and blockchain data networks. Crowdsourced data will be collected from WiFi systems in smart buildings and subsequently annotated by users via a decentralized platform such as PublicAI. These labeled IoT data will be processed and stored on-chain within the Chain-base omni-chain data network. The localization functionality will be powered by the proposed DFLoc system, with location results translated into human-readable language by a crypto-native language model developed by Chainbase Inc. Through this approach, DFLoc aims to provide reliable data collection, annotation, and location-based services."]}