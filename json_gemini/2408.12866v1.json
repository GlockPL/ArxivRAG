{"title": "Obfuscated Memory Malware Detection", "authors": ["Sharmila S P", "Aruna Tiwari", "Narendra S Chaudhari"], "abstract": "Providing security for information is highly critical\nin the current era with devices enabled with smart technology, where assuming a day without the internet is highly impossible. Fast internet at a cheaper price, not only made communication easy for legitimate users but also for cybercriminals to induce attacks in various dimensions to breach privacy and security. Cybercriminals gain illegal access and breach the privacy of users to harm them in multiple ways. Malware is one such tool used by hackers to execute their malicious intent. Development in AI technology is utilized by malware developers to cause social harm. In this work, we intend to show how Artificial Intelligence and Machine learning can be used to detect and mitigate these cyber-attacks induced by malware in specific obfuscated malware. We conducted experiments with memory feature engineering on memory analysis of malware samples. Binary classification can identify whether a given sample is malware or not, but identifying the type of malware will only guide what next step to be taken for that malware, to stop it from proceeding with its further action. Hence, we propose a multi-class classification model to detect the three types of obfuscated malware with an accuracy of 89.07% using the Classic Random Forest algorithm. To the best of our knowledge, there is very little amount of work done in classifying multiple obfuscated malware by a single model. We also compared our model with a few state-of-the-art models and found it comparatively better.", "sections": [{"title": "I. INTRODUCTION (HEADING 1)", "content": "Rapid development in digital technology and the replacement\nof paper documents with e-documents have caused a hike in\nthe number of cyber attacks [1] every day. Hackers are\nperturbing the daily activities of users with multiple types of\nattacks which begin from observing the user activities to\nintervening in the network and disrupting the entire working\nof the system.\nMalware is a significant cyber-attack[2]. The word malware\nis a hyponym derived from \u2018mal' for 'malicious' intent and\n'ware' is for 'software'. So, it is a software or program\nwritten with malicious intent. Although antiviruses[3] are\nbuilt with the ability to detect and remove malware with the\nexisting signatures of malware. However, they lack the\naccuracy in detecting new and unknown malware whose\nsignatures are not found in the antivirus database. These\nunknown malwares are intelligently coded to change their\nform and behavior thereby they are undetected by the\nantiviruses and sandboxes to deceive the detection.\nObfuscated malware is metamorphic malware that can hide\nitself from detection. Since 1980, enough research has been\ndone in the field of malware detection, however, still there\nare major challenges in this field detecting unknown\nmalware, optimizing the detection rate, detecting obfuscated\nand evasive malware, predicting malware before the attack,\nidentifying the path of malware propagation, mitigating the\nflow of malware and recovery from malware infection and\nmany.\nOur contribution to this paper:\n1. Implementing a multi-class classification model for\nidentifying multiple obfuscated malwares to choose the\nproper course of action for its mitigation.\n2. A Random Forest Classifier has been proven to\ndemonstrate impressive accuracy for selecting important\nfeatures and for both binary and multi-class classification.\n3. Compare the proposed model with the existing dilated\nCNN model intended for detecting obfuscated malware.\nFurther, the rest of the paper is organized as mentioned here.\nIn section II brief introduction to obfuscated malware is\nprovided, in section III background and related work is\ndiscussed, and in section IV and V proposed methodology\nand implementation details are presented. Discussing the\nresults in section VI we provide concluding remarks in\nsection VII followed by references."}, {"title": "II. OBFUSCATED MALWARE", "content": "Obfuscation is a software engineering strategy to conceal\nsoftware from its internal structure and functionality.\nMalware developers are using these techniques to alter the\nmalware features and behavior such that it can be hidden from\nmalware detection systems.\nA. Obfuscation methods:\nIlsun You [4] classifies malware into encrypted,\npolymorphic, oligomorphic, and metamorphic malware.\nEncrypted malware is associated with an encryptor and\ndecryptor. It evades detection by encrypting with different\nkeys during infection, thereby generating different signatures\nand confusing the antivirus scanner or any ML-based\ndetector. Meanwhile, the decryptor recovers the main body of\nmalware when the infected file is run. As there is a feasibility\nof mutation of decryptor from one generation to another\ngeneration, oligomorphic malware with multiple decryptors\nwere devised. Further to complicate the detection\npolymorphic malware with an infinite number of decryptors\nwere coded. Dead code insertion and other techniques like the\nusage of mutation engines were employed to generate such\nmalware. Advanced malware is metamorphic with auto\nmutation techniques to evolve themselves as and when it is\npropagating in a network.\nAccording to S. Schrittwieser et al., there are three software\nobfuscation techniques data obfuscation, static code\nrewriting, dynamic code rewriting[5] in the context of\nprotecting the software. In data obfuscation the program data"}, {"title": "III. BACKGROUND AND RELATED WORK", "content": "A. Role of Al in generating Obfuscated Malware\nAl techniques are employed in [13] for preparing obfuscated\nmalware by inserting NOP instructions via deep\nreinforcement learning. It is apparent that, machine learning\nmodels used in malware detection systems can be fooled by\nadversarial examples. Convolutional Neural Network is\nimplemented to insert dead codes at optimal positions,\nthereby the resulting executable gets a mislabel from the\nmachine learning classifier.\nObfuscated malware generated by [14] using adversarial deep\nreinforcement learning, employing an efficient action control\nstrategy for generating new malware to defend against LB-\nMDS. It has been experimentally proved that 67% of the\nmalware generated by this model is efficient in escaping from\ndetection. The new metamorphic malware generated by this\nmodel possesses uplifted misclassification and enhanced\nevasion probability.\nProminent API features of 11 families of malware are\nextracted from the Cuckoo sandbox by [15]. To represent the\nextracted features, A feature extraction algorithm, and\nprocedures for feature reduction and representation are\nproposed. KNN, RF, and DT multiclass classifiers are used\nto classify 11 families of malware with a high training\naccuracy of 95.7% but testing accuracy is not highlighted.\nAlthough it is found to be time-consuming to extract the\ndynamic features from the API call traces, overcoming\nwhich, API call sequence analysis serves as a major feature\nof analysis for Obfuscated malware detection.\nB. Random Forest\nRandom Forest[16] is a versatile supervised machine learning\nalgorithm for both classification and regression tasks. It is\npowerful by growing multiple decision trees and aggregating\nthe results of multiple decision trees for better decision-\nmaking. It is successful in giving accurate and stable results\nfor various complex problems beginning from image\nclassification, and image segmentation, to cancer cell\ndetection. Also, it has the capability of adaptability to extend"}, {"title": "IV. PROPOSED METHODOLOGY", "content": "In this work, we propose a machine learning model which is\na result of experimental analysis to detect obfuscated\nmalware and to identify the class of the obfuscated malware.\nHere we use the CIC MalMem 2022 Dataset as mentioned in\nSection II B, to identify the class of a new sample of malware\nas spyware, trojan or ransomware. We have evaluated State\nof the Art (SoTA) binary classifiers and multi-class classifiers\nwith CIC Malmem 2022 dataset to derive the metrics for\ncomparison and further analysis.\nWe conducted two experiments with State of the Art (SoTA)\nmodels in Machine Learning for Binary classification and\nMulti-class Classification. In Binary Classification, a given\nsample can be identified as malware or non-malware. As per\nour observation from the literature survey, an enormous\namount of work has been implemented in such classification.\nBut, identifying the new sample as malware or benign, does\nnot provide a proper insight on the specific type of malware\nattack and the course of action to be taken to mitigate the\npropagation of such malware. Because of the variants of\nmalware like ransomware, spyware, trojan, backdoors,\nrootkits, viruses, etc., identifying the type of the malware will\nbe helpful for suitable action to be taken to stop and/or\nrecover the adverse effect caused by the malware, which will\nfurther aid in mitigating the progress of the malware as well\nas recovering from the loss caused by the malware in a system\nor a network. This would also aid in identifying the source of\nthe attack."}, {"title": "V. IMPLEMENTATION", "content": "Dividing the dataset into training and testing in 80:20 ratio,\nthe binary and multiclass classifier models are implemented\nusing Python and Scikit learn libraries. After the training,\npredicting a label of a new sample is executed which returns\nthe learned label from the object in the array. This is followed\nby deriving the metrics from the prediction. For multi-class\nclassification, we employ the Adam optimizer with a Sigmoid\nactivation function and sparse categorical cross-entropy loss\nfunction."}, {"title": "A. Binary Classification of Malware", "content": "With reference to, Fig. 2, $M_1$, $M_2$, ..... $M_n$ represents the\nmachine learning classifiers implemented from scikit library.\nThe dataset has a sample X belongs to {$X_1$, $X_2$...$X_n$} with\nfeatures F{$F_1$,$F_2$....$F_n$ } defining a mapping X \u2192 F.\nIdentifying the class Y of X is the major objective of this\nexperiment. Y can be 0 or 1 for benign and malware.\n$A_1$, $A_2$, ..... $A_n$ are the accuracies derived from the models\n$M_1$, $M_2$, ..... $M_\\eta$. Comparing these accuracies, we evaluate\nand analyze the outstanding performer among all the binary\nclassifiers. With a similar ground rule, the multi-class\nclassifiers are also analyzed as in Fig. 3 for which Y can be\n0,1,2 and 3 for benign, spyware, ransomware, and trojan.\nWith this major objective, we carried out the experiment to\ncreate a baseline of five machine-learning algorithms. As\nmentioned earlier, implementation is undertaken with the\nscikit learn library. Basic and non-parameterized functions\nwere used for Logistic Regression and Na\u00efve Bayes classifier.\nFor Decision Tree minimum samples of leaf used are 3 with\na maximum depth of 10, entropy as the criteria, and log2 max\nfeatures are used. Repeating the same parameters for Random\nForest with a number of estimators as 30. C = 1 was the right\nchoice for Linear SVM."}, {"title": "B. Multi-class Classification of Malware", "content": "The major objective of this experiment is to create a baseline\nof five machine learning algorithms. Like the binary\nclassification experiment described in section V A, the\nimplementation is made with the scikit learn library. Basic\nand non-parameterized functions were used for Na\u00efve Baye's\nclassifier. For the Decision Tree, the minimum samples of\nleaf used are 16 with a maximum depth of 12, entropy as the\ncriteria, and log2 max features are used. Repeating the same\nparameters for Random Forest with number of estimators as\n30, min_samples split =4 and max depth as 40. With the batch\nsize of 2000 and just 10 epochs we achieved better accuracy\nwith Random Forest. Learning rate of 0.2 was the right choice\nfor Gradient Boosting. The ML models are tested and\nevaluated using the following metrics.\ni) Accuracy: metric used to measure the correctness in the\nclassification. Ratio of samples identified correctly to the\ntotal samples.\nAccuracy = $\\frac{No. of samples correctly identified}{Total samples}$\nii) Precision: metric used to measure the preciseness of the\nmodel in predicting positive samples.\nPrecision = $\\frac{positive samples rightly predicted as positive}{Total positive samples identified}$\niii) Recall: metric used to measure how many of predicted\npositive samples are correct.\nRecall = $\\frac{positive samples rightly predicted as positive}{Total rightly identified positive samples + Total rightly identified negative samples}$\niv) F1-score: metric that gives balance factor between\nprecision and recall, its value is directly proportional to\nthe performance.\nF1 score = $2 x \\frac{Precision x Recall}{Precision + Recall}$"}, {"title": "VI. RESULTS AND DISCUSSION", "content": "A. Results of Binary Classification\nThe following are the results deduced from the experiment\ndetails discussed in the previous section. The values of the\nmetrics accuracy, precision, recall, and F1 score of binary and"}, {"title": "VII. CONCLUSION", "content": "Obfuscated malware detection is one of the hot topics of\nresearch in the field of AI-infused cyber security. Although a\ngood amount of work is found in classifying a sample as\nmalware or non-malware, to the best of our knowledge\nsignificant research is lacking in detecting multiple malware\nin a single model. In this paper, we have implemented a\nMachine Learning-based cybersecurity model for multi-class\nclassification of obfuscated malware to detect three types of\nmalware viz. spyware, ransomware, and trojan. We have\ncompared the results of our work with existing works and\npresented that our proposed model performance is 8% better\nthan the existing models with the better hyperparameters we\nchose. With the Random Forest algorithm and considerable\nhyperparameter tuning, we achieved an accuracy of 89.07%\nin classifying multiple obfuscated malware. Although there\nis further scope for improvement in achieving still higher\naccuracy, extensive experiments are being conducted for\nfurther improvement in accuracy."}]}