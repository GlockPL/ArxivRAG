[{"title": "MG-Net: Learn to Customize QAOA with Circuit Depth Awareness", "authors": ["Yang Qian", "Xinbiao Wang", "Yuxuan Du", "Yong Luo", "Dacheng Tao"], "abstract": "Quantum Approximate Optimization Algorithm (QAOA) and its variants exhibit immense potential in tackling combinatorial optimization challenges. However, their practical realization confronts a dilemma: the requisite circuit depth for satisfactory performance is problem-specific and often exceeds the maximum capability of current quantum devices. To address this dilemma, here we first analyze the convergence behavior of QAOA, uncovering the origins of this dilemma and elucidating the intricate relationship between the employed mixer Hamiltonian, the specific problem at hand, and the permissible maximum circuit depth. Harnessing this understanding, we introduce the Mixer Generator Network (MG-Net), a unified deep learning framework adept at dynamically formulating optimal mixer Hamiltonians tailored to distinct tasks and circuit depths. Systematic simulations, encompassing Ising models and weighted Max-Cut instances with up to 64 qubits, substantiate our theoretical findings, highlighting MG-Net's superior performance in terms of both approximation ratio and efficiency.", "sections": [{"title": "Introduction", "content": "Combinatorial optimization problems (COPs) [1], central to numerous scientific and engineering disciplines [2, 3, 4], often defy efficient classical solutions due to their computational complexity [5, 6]. A promising strategy to overcome these computational challenges involves harnessing the power of quantum computing, as these COPs can be mapped to Ising Hamiltonians whose ground states denote optimal solutions [7, 8]. Leveraging this quantum representation, the Quantum Approximate Optimization Algorithm (QAOA) [9] has emerged to address these COPs. In particular, theoretical analyses [10, 11, 12, 13] underscore the potential of QAOA, suggesting its superiority over classical counterparts in certain contexts, particularly with unlimited infinite circuit depth. Meantime, empirical studies [14, 15, 16] affirm its applicability across a diverse spectrum of problems and devices.\nDespite these advancements, QAOA's practical efficacy is challenged by the quantum coherence limits of modern quantum devices, as there is a ceiling on the allowable maximum circuit depth $p$. As a result, standard QAOA often underperforms classical counterparts [18, 19]. This motivates a research shift towards redesigning the mixer Hamiltonian $H_M$, a key component of QAOA. As illustrated in Fig. 1(a), supported by the results of quantum adiabatic evolution [20, 21], alternative $H_M$ may exist that guide the system along a more direct and efficient trajectory-a shortcut to the solution state, leading to a better performance compared to the standard QAOA. Besides, as shown in Fig. 1(b), empirical evidence indicates that the form of $H_M$ promising a good performance is varied with the allowable $p$. As such, diverse alternatives $H_M$ are proposed in past years, drawing upon concepts from quantum annealing [22], incorporating additional trainable parameters [17] or exploiting permutation symmetry [23]. However, these approaches require deep domain expertise and often lack generalizability across different tasks and circuit configurations $p$.\nIn response to these challenges, here we first analyze the convergence of QAOA on various mixer Hamiltonian configurations and circuit depths with the tool of representation theory [24]. Our finding reveals that (i) the convergence of QAOA can be enhanced through parameter grouping in the mixer Hamiltonian; (ii) the specific strategy for parameter grouping is dependent on the particular problem and the value of $p$. These two findings are instrumental in understanding the interplay between $p$, parameter grouping, and the overall efficiency of the QAOA, providing valuable insights for the design of the mixer Hamiltonian.\nEnvisioned by the achieved theoretical results, we propose an end-to-end learning framework, termed Mixer Generator Network (MG-Net), to dynamically design the mixer Hamiltonian $H_M$ for a class of problems and distinct circuit depth constraints. Conceptually, MG-Net takes the problem's description and the available circuit depth $p$ as input and directly outputs the optimal mixer Hamiltonian for a $p$-QAOA. There are three distinguished features of our proposal: (i) The ability to dynamically adjust $H_M$ according to $p$, enhancing its compatibility with practical quantum devices; (ii) Fast customization of $H_M$ for unseen problems and circuit depth $p$, attributed to the multi-condition controlled generative network architecture; (iii) Circumvent the need for the expensive collection of a vast training dataset of optimal $H_M$ by employing an estimator-generator structure alongside a two-stage training approach. Note that the developed techniques can be flexibly extended to other variational quantum algorithms (VQAs) [25, 26], which may be independent of interests.\nThe contributions of this paper are:\n\u2022 We provide a rigorous theoretical analysis on the convergence of QAOA with sufficient circuit depth, elucidating the link between the performance and the parameter grouping in QAOA circuits. This analysis offers guidance on the design of mixer Hamiltonian to achieve a high approximation ratio for a specified circuit depth.\n\u2022 We propose MG-Net, which dynamically tailors its predicted mixer Hamiltonian $H_M$ to suit the given problem and circuit depth. Our model greatly reduces the cost of collecting labeled training data, attributed to an estimator-generator framework and a two-stage training strategy.\n\u2022 The proposed MG-Net demonstrates remarkable generalization ability from a limited dataset to a broad spectrum of combinatorial problems, which facilitates rapid and efficient creation of $H_M$ for unseen problems, advancing the practical utility of QAOAs.\n\u2022 Extensive experiments on the Transverse-field Ising model and Max-Cut up to 64 qubits verify our theoretical discoveries and demonstrate the advantage of MG-Net in achieving higher approximation ratios at various circuit depths compared to other quantum and traditional methods."}, {"title": "Background", "content": "2.1 Quantum approximation optimization algorithm\nConsidering a COP defined on a set of $N$ binary variables $z = z_1 \\cdots z_N$", "C(z)": {"equation": "|\\psi_p(\\alpha, \\beta)\\rangle = \\prod_{k=1}^p e^{-i\\beta_k H_M} e^{-i\\alpha_k H_c} |\\psi_0\\rangle,"}}, {"title": "Symmetry in QAOA", "content": "2.2 Symmetry in QAOA\nSymmetry, ansatz design, and effective dimension. A symmetry $S$ refers to the unitary operator leaving the operator $H$ invariant such that $S^{\\dagger} H S = H$ (or $[S, H] = 0$). All symmetries form a group $\\mathcal{S}$ where given any two symmetries $S_1, S_2 \\in \\mathcal{S}$, the compositions $S_1 S_2$ and $S_2 S_1$ are also symmetries in $\\mathcal{S}$. Among various symmetries, the most relevant one to our work is the permutation symmetry $\\pi \\in S_N$, with the subscript being the qubit count $N$ and $S_N$ being the symmetric group. For example, a permutation $\\pi$ with $\\pi(1) = 3, \\pi(2) = 1, \\pi(3) = 2$ acting on the state $|\\psi_1\\rangle|\\psi_2\\rangle|\\psi_3\\rangle$ yields $\\pi |\\psi_1\\rangle|\\psi_2\\rangle|\\psi_3\\rangle = |\\psi_3\\rangle|\\psi_1\\rangle|\\psi_2\\rangle$. Throughout the whole study, we denote the group of permutation symmetries of the problem Hamiltonian $H_c$ as $Per(H_c) = {\\pi \\in S_N | \\pi^{\\dagger} H_c \\pi = H_c}$.\nConsider an $N$-qubit PQC $U(\\theta) = \\prod_{k=1}^K e^{-i H_k \\theta_k}$ with $\\theta \\in \\Theta$ and $d = 2^N$. We call $U(\\theta)$ a symmetric PQC with respect to the problem Hamiltonian $H_c$ if there exists a symmetry group $\\mathcal{S}$ of $H_c$ such that $[U(\\theta), S] = 0$ for any $\\theta \\in \\Theta$ and $S \\in \\mathcal{S}$. This symmetry is determined by the generators of PQCs $A = {H_1,\\ldots, H_K}$ which is also called ansatz design, as $[U(\\theta), S] = 0$ holds for any $\\theta \\in \\Theta$ if and only if $[H_k, U(\\theta)] = 0$ for any $k \\in [K]$. Such symmetry can be quantified by the effective dimension [27, 28].\nDefinition 2.1 (Effective dimension). Consider an $N$-qubit QAOA instance $(\\psi_0\\rangle, U(\\theta), H_c)$ where $U(\\theta)$ acts on the vector space $\\mathcal{V}$. If there exists a direct sum decomposition $\\mathcal{V} = \\oplus_{j=1}^k \\mathcal{V}_j$ and $\\mathcal{V}^* \\in {\\mathcal{V}_j}_{j=1}^k$ such that $U(\\theta) |\\psi_0\\rangle \\in \\mathcal{V}^*$ for any $\\theta$ and the ground state of the problem Hamiltonian $|\\psi^*\\rangle$ satisfies $|\\psi^*\\rangle \\in \\mathcal{V}^*$, then the effective dimension $d_{eff} < 2^N$ is defined as the dimension of $\\mathcal{V}^*$.\nExperimental and theoretical analysis has shown that symmetric ansatz design with a small effective dimension contributes to better trainability [29, 28, 30]."}, {"title": "Convergence theory of QAOA", "content": "In this section", "equation": "d_{eff}(A_{FG}) = d_{eff}(A_{PG}) \\leq d_{eff}(A_{NG}),"}, {"title": "MG-Net", "content": "The implication of Theorem 3.1 inspires us to devise a method for dynamically generating an appropriate mixer Hamiltonian $H_M$ tailored to both the problem $G$ at hand and the specified circuit depth $p$. For this purpose, we harness the power of deep learning and devise an end-to-end learning framework, dubbed Mixer Generator Network (MG-Net)."}, {"title": "Framework of MG-Net", "content": "Before presenting the proposed MG-Net", "equation": "H_M = \\sum_{j=1}^K \\beta_j \\sum_{i \\in G_j} P_i,"}, {"title": "Experiments", "content": "We evaluate the performance of MG-Net by two typical applications of QAOA: weighted Max-Cut and Transverse-field Ising model (TFIM), each of which is elucidated below.\nWeighted Max-Cut. Denote a weighted graph as $G = (V, E, W)$, where $V$ is the set of vertices of graph, $E$ is the set of graph edges, $W = {W_{ij}}_{(i,j)\\in E}$ is the set of weights assigned to each edge. The problem Hamiltonian for the weighted Max-Cut problem is $H_{MaxCut} = 0.5 * \\sum_{(i,j)\\in E} W_{ij} Z_i Z_j$, where $Z_i$ is a Pauli-Z operator acting on the i-th qubit.\nTFIM. Our focus is a class of inhomogeneous TFIMs: $H_{TFIM} = - \\sum_{(i,j)} J_{ij} Z_i Z_j - h \\sum_i X_i$, where $J_{ij}$ is the interaction strength between neighboring spins (or qubits) $(i, j)$, and $h$ signifies the strength of a global transverse field applied to each spin. In this model, the interaction strengths $J_{ij}$ can vary between different pairs of spins, adding a layer of complexity to the system."}, {"title": "Experiment configuration", "content": "5.1 Experiment configuration\nDataset construction.The Max-Cut problem focuses weighted 3-degree regular (w3r) graphs, where the edge weights ${W_{ij}}$ are uniformly sampled from [0, 1]. The TFIM focuses on 1D instances where a qubit $i \\in [N - 1]$ has neighbors $i\\pm1$ (mod $N$). The strength $J_{ij}$ and $h$ are uniformly sampled from [0.5, 1.5] and [0.1,2] respectively. The training dataset $D_{Tr}$ in Sec. 4.3 contains $S = 100$ instances for both two tasks with size up to $N = 64$ qubits, while The test dataset $D_{Te}$ contains another 100 problem instances which are different from that of $D_{Tr}$."}, {"title": "Results", "content": "5.2 Results\nCost estimator acts as an accurate performance indication for QAOA. The behavior of the cost estimator on the test dataset with varying circuit depths $p$ and two distinct parameter grouping strategies NG and FG (defined in Theorem 3.1) is recorded in Fig. 4. In Fig. 4(a), we observed a strong correlation between the estimated and minimum cost values, and the correlation strength changes with $p$ and parameter grouping strategy. Particularly, the cost estimator predicts a high likelihood of finding the most accurate solution for QAOA circuits with FG parameters and a depth of $p = 92$. This prediction aligns with the actual performance of QAOA under these specific conditions.\nWe next focus on the behavior of the cost estimator concerning $p$ as shown in Fig. 4(b). We note that for FG (standard QAOA), the estimated loss decreased monotonically with increasing $p$, aligning with standard QAOA's behavior. Under the NG scenario (multi-angle QAOA), a transition that QAOA performance begins to decline is observed when the circuit becomes excessively long ($p > 42$). These results indicate the reliability of the cost estimator as a performance indicator for QAOA and reveal the complexities in QAOA performance under conditions of increased circuit length.\nMixer generator. We next evaluate the performance of the customized mixer Hamiltonian generated by MG-Net. As shown in Fig. 5(a), the number of trainable parameters $\\#P$ of the generated quantum circuits aligns with the maximum in scenarios where all parameters are non-correlated (labeled as 'NG') for smaller circuit depths $p < 20$. This alignment indicates that MG-Net effectively enhances the expressibility of the QAOA ansatz for limited-depth circuits without significantly increasing the number of parameters, thereby avoiding potential trainability issues. As $p$ increases, a transition occurs. The growth rate of $\\#P$ starts to decelerate, reaching a notable transition point at $p = 62$ for Max-Cut ($p = 52$ for TFIM). Beyond this threshold, the generated mixer Hamiltonians gradually converge towards the configuration seen in standard QAOA, with fully grouped parameters.\nFig. 5(b) compares the effective dimension $d_{eff}$ of quantum circuits achieving high approximation ratio $r \\geq 0.995$ in standard QAOA and MG-Net driven QAOA. The results show that circuits generated by MG-Net achiever $\\geq 0.995$ across all values of $p$, even as low as $p = 2$, outperforming standard QAOA, which only reaches this level for $p > 50$ for Max-Cut ($p > 20$ for TFIM). Besides, the effective dimension of these high-quality quantum circuits gradually decreases with growing $p$, in line with the convergence analysis in Theorem 3.1. These findings suggest that MG-Net dynamically adjusts quantum circuits in response to changes in circuit depth $p$, thereby consistently ensuring high performance."}, {"title": "Conclusion", "content": "In this study, we analyze QAOA's convergence on varied mixer Hamiltonians, focusing on parameter grouping strategies. We introduce MG-Net for dynamically generating optimal mixer Hamiltonians for various problems and circuit depths. Numerical experiments on Max-Cut and TFIM confirm MG-Net's efficacy in enhancing QAOA's approximation ratio, particularly for large-scale problems, while ensuring low circuit complexity. This research advances the understanding and application of QAOA across various circuit depths."}, {"title": "Optimization of QAOA", "content": "In this section", "matrices": "n$X = \\begin{bmatrix"}, 0, 1, 1, 0], "equation": "X = \\begin{bmatrix} 0 & 1\\\\ 1 & 0 \\end{bmatrix}, Y = \\begin{bmatrix} 0 & -i\\\\ i & 0 \\end{bmatrix}, Z = \\begin{bmatrix} 1 & 0\\\\ 0 & -1 \\end{bmatrix}."}, {"title": "Related work", "content": "In this section, we embark on a concise literature review, focusing on conventional algorithms for the Max-Cut problem, some variants of QAOA, and quantum circuit architecture search algorithms. This examination sets the stage for a comparative analysis between these established methods and our proposed model. In summary, our discussion underscores the distinctive strength of our model: its exceptional ability to generalize.\nC.1 Conventional algorithms\nGreedy algorithm for Max-Cut problem. The greedy algorithm for solving the Max-Cut problem operates on a simple principle: iteratively makes local, myopic decisions to construct a solution that attempts to maximize the sum of weights of edges between two disjoint subsets of vertices. This algorithm does not assure an optimal solution due to its greedy nature-making decisions based only on immediate benefits without considering future consequences. The detailed procedure is introduced in Alg. 1.\nC.2 Variants of QAOA\nThe studies of variants of QAOA aim to improve the convergence rate or reduce the computational time by changing the PQCs or the problem Hamiltonian. Current progress has revealed that the performance of QAOA could be improved by employing multi-angle QAOA [17] where the parameters are no-grouped or partially grouped according to the permutation symmetry of problem Hamiltonian [37, 38, 23], utilizing different mixer Hamiltonian obtained by searching from a given Hamiltonian pool [39] or inspired by specific problem [40, 22, 41, 42] and other quantum algorithms [43, 44, 45]. Another type of the variant of QAOA focuses on modifying the problem Hamiltonian, either through eliminating redundant qubits [46] to obtain a reduced problem Hamiltonian, or imposing conditional\nC.3 Quantum circuit architecture search\nIn the design of quantum circuits, quantum circuit architecture search methodologies have been developed to autonomously identify optimal quantum circuit architectures [48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59]. In the following, we delve into several notable approaches and contrast them with our MG-Net model."}, {"title": "Implementation details of MG-Net", "content": "In this section, we initially outline the methodology for constructing datasets used to train MG-Net across various problem scales. Subsequently, we detail the implementation of the data encoder, illustrated with a specific example.\nD.1 Dataset construction\nOperator types. The set of operator types for the mixer Hamiltonian is defined as {$X, Y$}$^{\\otimes N}$ in our experiments. Note that the operator type pool can be flexibly adjusted according to specific problems and hardware. For example, we can introduce two-qubit operators into the operator type pool to further enhance the performance of QAOA, as done in [60]. Considering the exponential growth of the search space in relation to the system size $N$, we have sampled only a subset from this pool in all our experiments. This approach is adopted to construct the training dataset while minimizing data collection costs.\nConstruction of parameter group pool. A straightforward idea to construct the pool of parameter group is to assume each $X_i$ can be assigned an index $j$ ranging from $1$ to $N$, leading to a pool $\\mathcal{P} = {(j_1 \\in [N], ..., j_n \\in [N])}$ with size $N^N$. However, there exist multiple duplicate candidates in the pool $\\mathcal{P}$ due to the disorder of the initial parameter pool. For example, for a two-qubit QAOA ansatz, parameter index vectors $(1, 2)$ and $(2, 1)$ make no difference in the optimization of QAOA. Based on these observations, we propose a recursive algorithm Alg. 3 to build a compact pool of parameter groups."}, {"title": "Data encoder", "content": "D.2 Data encoder\nProblem encoder. Our problem encoder is rooted on the problem Hamiltonian $H_c$ in Eqn. (1). More precisely", "equation": "x_p[2k] = sin(\\frac{p}{10000^{2k/dp}}), x_p[2k+1] = cos(\\frac{p}{10000^{2k/dp}}),"}, {"title": "Network structure", "content": "D.3.1 Cost estimator\nIn our experimental setup, the intricate architecture of the cost estimator is detailed in Fig. 8. Both the problem and mixer Hamiltonian branches incorporate two layers of graph convolutions, utilizing ReLU activation functions to transform the initial node features from dimensions $d_c$ and $d_m$ to a unified 128-dimensional space. Subsequently, the three extracted features\u2014$x_c$, $x_M$, and $x_p$\u2014are concatenated to facilitate the prediction of the attainable minimum cost $\\hat{y}$ for a given QAOA instance through an MLP layer.\nD.3.2 Mixer generator\nInspired by [63] which encodes a quantum circuit as a graph, the mixer generation is composed of two separate sub-generators: the operator type generator and the parameter grouping generator, which are respectively responsible for graph node and link prediction."}, {"title": "Experiment settings", "content": "D.4 Experiment settings\nHardware platform. All QAOA circuits are implemented by PennyLane [64] and run on classical device with Intel(R) Xeon(R) Gold 6267C CPU @ 2.60GHz and 128 GB memory. MG-Net is implemented by Pytorch [65] and is trained on a single NVIDIA GeForce RT 2080Ti with 12G graphics memory.\nHyper-parameters. The hyper-parameters of optimizing MG-Net and QAOA circuit are listed in Tab. 2."}, {"title": "More numerical results", "content": "E.1 Performance comparison among different methods for TFIM\nIn evaluating the effectiveness of our proposed method for solving TFIM, we conducted a comparative analysis against QAOA, ADAPT-QAOA, and multi-angle QAOA (ma-QAOA). Our analysis, based on the average results from 100 graphs in our test dataset, is summarized in Tab. 3. The findings reveal that our method consistently outperforms other techniques in achieving a higher approximation ratio for TFIM, particularly in larger-scale problems.\nE.2 Experiments on asymmetric graphs and 2D-TFIM\nWe conducted additional experiments on the asymmetric graphs of 6 nodes and 2D lattice models of 6 spins. Their topological structure is shown in Fig. 10.\nE.3 Approximation ratio with respect to p\nIn small-scale quantum systems, achieving the criteria set in Theorem 3.1 is more straightforward by increasing circuit depth $p$ beyond the threshold $C$. We analyze the approximation ratios achieved by 6-qubit QAOA circuits for Max-Cut and TFIM within the $p$ range of 2 to 82. Figure 11 illustrates that at lower $p$ values, our method consistently records the highest approximation ratio $r$, clearly outperforming both standard QAOA and ma-QAOA. As $p$ increases from 2 to 62, standard QAOA and ma-QAOA exhibit a rise in $r$, eventually matching our method's performance. However, a further increase in $p$ leads to a performance decline in ma-QAOA, where the detrimental impact of its numerous trainable parameters on convergence outweighs the benefits of enhanced expressibility. In contrast, our method maintains stable performance, continually achieving the highest $r$. These findings confirm our method's superiority in optimizing approximation ratios across various circuit depths compared to other approaches.\nE.5 Experiments on extended candidate operator type set\nIn this section, we investigate the performance of our model when applied to a more complex set of candidate operator types. Specifically, we expand the pool of mixer operator types from X, Y to X, Y, XX, YY by incorporating additional two-qubit operators, thereby increasing the search space for operator types to O(4N). All other experimental conditions remain consistent with those described in the main text. The behavior of the cost estimator under these conditions is illustrated in Fig. 13. Our results indicate that the cost estimator continues to serve as a reliable performance indicator for QAOA, even with the increased complexity of the mixer Hamiltonian design.\nE.6 Ablation study on the circuit depth embedding\nMG-Net acts as an initial protocol and provides a flexible circuit-generation framework where model components can be conveniently replaced by advanced techniques. Besides the position embedding of circuit depth in the main text, we have also considered another two embedding strategies: integer embedding and one-hot embedding. There are two key differences between the implementation of position encoding and one-hot or integer encoding:\n1. Feature vector length. The length of the one-hot-encoded vector xp depends on the predefined maximum value of p, while the length of the integer-encoded vector xp is 1. In"}]