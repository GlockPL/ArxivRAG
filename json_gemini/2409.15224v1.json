{"title": "Enhancing Pedestrian Trajectory Prediction with Crowd Trip Information", "authors": ["Rei Tamarua", "Pei Li", "Bin Ran"], "abstract": "Pedestrian trajectory prediction is essential for various applications in active traffic management, urban planning, traffic control, crowd management, and autonomous driving, aiming to enhance traffic safety and efficiency. Accurately predicting pedestrian trajectories requires a deep understanding of individual behaviors, social interactions, and road environments. Existing studies have developed various models to capture the influence of social interactions and road conditions on pedestrian trajectories. However, these approaches are limited by the lack of a comprehensive view of social interactions and road environments. To address these limitations and enhance the accuracy of pedestrian trajectory prediction, we propose a novel approach incorporating trip information as a new modality into pedestrian trajectory models. We propose RNTransformer, a generic model that utilizes crowd trip information to capture global information on social interactions. We incorporated RNTransformer with various socially aware local pedestrian trajectory prediction models to demonstrate its performance. Specifically, by leveraging a pre-trained RNTransformer when training different pedestrian trajectory prediction models, we observed improvements in performance metrics: a 1.3/2.2% enhancement in ADE/FDE on Social-LSTM, a 6.5/28.4% improvement on Social-STGCNN, and an 8.6/4.3% improvement on S-Implicit. Evaluation results demonstrate that RNTransformer significantly enhances the accuracy of various pedestrian trajectory prediction models across multiple datasets. Further investigation reveals that the RNTransformer effectively guides local models to more accurate directions due to the consideration of global information. By exploring crowd behavior within the road network, our approach shows great promise in improving pedestrian safety through accurate trajectory predictions.", "sections": [{"title": "1. Introduction", "content": "Pedestrian trajectory prediction is essential in various applications that aim to improve traffic safety and efficiency. For instance, predicting pedestrian trajectories can be embedded in an assistive system in a vehicle or traffic control devices that alert drivers if pedestrians are likely to cross their paths, thus preventing potential conflicts and accidents (M\u00f8gelmose et al., 2015). Similarly, autonomous vehicles can leverage these predictions to make safer decision-making, enhancing overall road safety (Li et al., 2020; Zhang et al., 2021, 2022). Moreover, accurate future pedestrian trajectories are important for crowd management systems, helping to ensure safe and secure public spaces by anticipating and mitigating potential issues related to road users.\nPedestrian trajectories are affected by various factors, including individual characteristics, road environments, and social interactions. In particular, social interactions are crucial as pedestrians constantly adjust their trajectories based on their interactions with other road users and objects. The studies of socially aware models have investigated to understand the social"}, {"title": "2. Literature Review", "content": "The approaches to understanding pedestrian trajectory are generally categorized into expert-based, data-driven methods, or hybrid approaches of them (Golchoubian et al., 2023). Expert-based models rely on hand-crafted rules to simulate pedestrian decision-making, delineating precise human kinetics (Anvari et al., 2015). In contrast, data-driven approaches, particularly"}, {"title": "2.1. Socially Aware Pedestrian Trajectory Prediction", "content": "Social interactions between pedestrians and other road users or objects are a key factor in predicting future trajectories. Such interactions are obtained by socially aware models. Alahi et al. (2016) firstly integrated social interactions, as derived from the social force model, into a deep learning framework. They introduced a social pooling layer to represent spatial relationships, allowing spatially adjacent long short-term memory networks (LSTMs) to share information. Building on this, Bisagno et al. (2018) proposed Group LSTM, which clustered individuals by their locations before predicting their trajectories. This work highlighted the importance of acknowledging group dynamics within pedestrian interactions. Expanding on this concept, Gupta et al. (2018) introduced social interactions into a generative adversarial network (GAN) framework. The proposed model features a generator, a pooling module, and a discriminator. The generator predicted the pedestrian trajectories, while the discriminator, by leveraging subtle social interaction rules, classified socially unacceptable trajectories (e.g., those causing collisions) as \"fake.\u201d The model used LSTMs as its encoder and decoder, with a pooling layer aggregating information across pedestrians. This designed pooling module considered interactions between all pedestrians, while the pooling module in Alahi et al. (2016) only considered people inside the grid it has defined, thereby improving predictive accuracy over Social-LSTM.\nLater studies further advanced the prediction accuracy by integrating more complex interaction models. Song et al. (2020) developed a convolutional LSTM model that accounted for both spatial and temporal interactions using multi-channel tensors, achieving significant improvements in predictive accuracy. Similarly, Mohamed et al. (2020) proposed Social-STGCNN that modeled social interactions among pedestrians as a graph. A 20% improvement in terms of prediction accuracy has been achieved over the state-of-"}, {"title": "2.2. Pedestrian Intention Prediction", "content": "Extended studies on crowd dynamics, such as those conducted by Helbing et al. (2000) on panic situations, have shown that crowd psychology influences individual movements. Pedestrian intention prediction aims to estimate future pedestrian behavior from a macroscopic viewpoint, accounting for multimodality to handle inherent uncertainty in pedestrian movements. Several goal-based models have addressed this challenge, including preset goals (Tran et al., 2021) and multimodal goal probability distributions (Ikeda et al., 2013; Mangalam et al., 2021; Girase et al., 2021). Tran et al. (2021) proposed a matching that aligns provided goals with observed trajectories, leveraging recurrent modules. The output representations are concurrently used to guide pedestrians toward their intended destination. Similarly, the sub-goal model proposed by Ikeda et al. (2013) posits that pedestrians head towards a series of sub-goals en route to the final destination, with each sub-goal inferred from past trajectories and human kinetics. Girase et al. (2021) developed a goal estimation model with a conditional variational autoencoder, demonstrating that reasoning about goals in a recurrent manner can significantly improve trajectory predictions.\nAlthough these goal-based approaches provide valuable insights, our proposed RNTransformer extends this line of inquiry by capturing global scene representations constructed with historical trajectories. Similar to the grid-based approach described by Gu et al. (2021) and Derrow-Pinion et al. (2021), RNTransformer anticipates that pedestrian goals can be depicted in a grid-based manner, which accommodates a wide range of behaviors such as slowing down or stopping."}, {"title": "2.3. Multimodal Learning on Trajectory Prediction", "content": "The prediction of pedestrian trajectories requires multimodal information to accurately capture the dynamic motion of pedestrians, as well as their interactions with other road users. Visual modalities have been extensively studied in existing research. For example, Rasouli et al. (2019) estimated the crossing intention of pedestrians using an LSTM-based model from image data. Similarly, Malla et al. (2020) employed a deep learning model to extract pedestrian actions, such as standing, jumping, running, and walking,"}, {"title": "3. Methods", "content": "Our proposed model considers trajectory predictions with hierarchical structures. The model has two components, including local and global prediction models. The study area is first divided into various nodes. The local model predicts individual pedestrian trajectories within each node. Differently, the global model predicts crowd behaviors with a sparse spatio-temporal module. In this study, we introduce a road network model that creates potential walkable areas with empirical pedestrian trajectories and geometrical information. Predictions from the RNTransformer are fed into the local model to predict the trajectories of pedestrians.\nFigure 2 illustrates the overall architecture of our proposed model. In our methodology, we first construct a representation of the target scene in the road network along the RNTransformer, which is utilized to train and"}, {"title": "3.1. Model Architecture", "content": "Socially aware pedestrian trajectory prediction models consider the relationships between individual pedestrians and their surroundings. These models construct adjacency matrices around each pedestrian, which are calculated as social tensors (Alahi et al., 2016) or graph neural networks (GNNs) with nodes representing pedestrian locations and edges representing their interactions (Mohamed et al., 2020, 2022). These socially aware models typically combine the spatial awareness modules, such as convolutional neural networks (CNNs) or graph convolutional networks (GCNs), with the temporal awareness modules like time-extrapolator convolution neural networks (TXP-CNNs), recurrent neural networks (RNNs), and LSTMs. By stacking several layers of these spatial and temporal modules, the models can capture complex interactions and dependencies in pedestrian trajectories.\nIn the general setup for socially aware pedestrian trajectory prediction, the location of the \\(i^{th}\\) pedestrian at time \\(t\\) is denoted by \\(p_i = (x_i, y_i)\\), where \\(t \\in {1,...,T \\subseteq N}\\), and \\(x\\) and \\(y\\) represent the coordinates of pedestrian \\(i\\)"}, {"title": "3.1.1. Trajectory Prediction Model", "content": "in \\(I\\). The objective is to utilize historical trajectories from 0 to \\(T\\) to predict future trajectories from \\(T\\) to \\(T + L\\). Given the inherent uncertainty in future trajectories, they are traditionally sampled from a stochastic distribution. Specifically, \\((\\hat{x}_t, \\hat{y}_t)\\) are variables randomly sampled from a bivariate Gaussian distribution such that \\(p \\sim N(\\mu_t, \\sigma^2_t, \\rho_t)\\), where \\(\\mu_t\\) denotes the mean, \\(\\sigma^2_t\\) is the variance, and \\(\\rho_t\\) denotes the correlation of the distribution. Similarly, predicted trajectories are represented as \\(\\hat{p}_t \\sim N(\\hat{\\mu}_t, \\hat{\\sigma}^2_t, \\hat{\\rho}_t)\\) where the model calculates each of these variables.\nSocially aware models consist of socially aware spatial modules and temporal reasoning modules. The spatial module transforms input features into hidden embedding using techniques such as a simple encoder (Alahi et al., 2016) or graph convolution (Mohamed et al., 2020, 2022) with the below process.\n\\begin{equation}\nv_i^{l+1}(t+1) = \\sigma \\left( \\frac{1}{\\Omega} \\sum\\limits_{v_j^l(t) \\in B(v_i^l(t))} \\phi\\left(v_i^l(t), v_j^l(t)\\right)\\right)\n\\end{equation}\nwhere \\(\\frac{1}{\\Omega}\\) is a normalization term. The set of neighboring vertices \\(B(v_i^l) = \\{v_j^l | d(v_i^l, v_j^l) < D\\}\\) includes all vertices \\(v_j^l\\) within a threshold distance \\(D\\) from \\(v_i^l\\), where \\(d(v_i^l, v_j^l)\\) represents the shortest path length between \\(v_i^l\\) and \\(v_j^l\\). The function \\(\\phi\\) is a sampling function, and the kernel function \\(w(\\cdot)\\) captures the relationships (e.g., the inverse of the Euclidean distances) between nodes \\(v_i^l\\) and \\(v_j^l\\). Specifically, \\(w(v_i^l, v_j^l) = \\frac{1}{\\|v_i^l - v_j^l\\|^2}\\) if \\(\\|v_i^l - v_j^l\\|^2 \\ne 0\\); otherwise, \\(w\\) is 0.\nThese spatial representations are then input to the temporal prediction module, which can utilize CNN, GRU, LSTM, or other models to understand temporal reasoning. The residual connection, as shown in Figure 2, allows past information to be retained in the predicted frame. In the local model, the task is to predict trajectories for \\(L\\) future steps based on \\(n\\) historical steps. Denote \\(V_t \\in \\mathbb{R}^{N \\times I_t}\\) as the node features at time \\(t\\) and \\(G_p\\) as the graph or adjacency matrix representing social interactions between pedestrians. The pedestrian trajectory prediction task can be represented as follows.\n\\begin{equation}\n[V_{t+1},..., V_{t+L}] = f(G_p; V_{t-n}, ..., V_{t-1}, V_t)\n\\end{equation}"}, {"title": "3.1.2. Road Network Construction", "content": "Inspired by the ETA prediction on road networks using supersegment construction (Derrow-Pinion et al., 2021), we construct segmented grids on the target roadway to predict crowd behavior. We model the roadway as a geometrical graph with nodes divided by a preset number of grids for crowd movements and edges connecting each node. The road network \\(R^{n \\times m}\\) is constructed based on historical pedestrian trajectories as illustrated in Figure 3.\n\\begin{equation}\n(n, m) = (\\frac{max \\ R_x - min \\ R_x}{gr}, \\frac{max \\ R_y - min \\ R_y}{gr})\n\\end{equation}\nwhere \\(gr\\) denotes the number of grids. Then we isolate the road grid and create nodes \\(v_i \\in V\\) associated with each grid. Each node represents the number of pedestrians in each time step, and the edges indicate transitions from the previous number of pedestrians. We used origin-destination relationships in this paper. The function \\(\\Phi\\) maps the road grid to the road network, initializing the value on the road grid 0 when the point is out of the scene coordinates and otherwise is set to 1.\n\\begin{equation}\n\\Phi_i = \\begin{cases}\n1, & \\text{if } min(R) \\leq p \\leq max(R) \\\\\n0, & \\text{otherwise}\n\\end{cases}\n\\end{equation}"}, {"title": "3.1.3. Road Network Transformer", "content": "Our Road Network Transformer (RNTransformer) leverages a GNN to predict the number of pedestrians on each node for several time horizons. Multiple models trained on different horizons are combined to predict pedestrian intentions. The graph constructed in the previous section is denoted as \\(G = (V, E)\\).\nOur approach integrates spatial and temporal geometrical relations through trip inputs and employs concatenation to merge the results from different time horizons. The model consists of a GCN as the spatial module and a GRU as the temporal module (Bai et al., 2021). The spatial GCN processes node attributes, such as the number of road users and node centers, while another GCN compresses spatial relationships among nodes based on pedestrian frequency.\n\\begin{equation}\nH_{t'+1} = g(f(H_t', A))\n\\end{equation}\nwhere \\(f(x, A) = \\sigma(Wh_i + Wh_m)\\), \\(h_m = \\sigma\\left(W \\sum\\limits_{j \\in d_i} \\frac{e_{ij}h_j}{\\sqrt{d_i d_j}}\\right)\\)\nIn this context, \\(W\\) denotes the weights, \\(d_i\\) represents the degree of nodes, \\(\\sigma\\) denotes the activation function, and \\(d_i\\) considers the graph neighborhood within \\(m\\) hop.\nGiven input sequences with time steps \\(t' \\in \\{1,2,...,T'\\}\\), the temporal model predicts the future number of pedestrians \\(\\pi\\) for \\(L'\\) subsequent steps. The input graph sizes are varied depending on the prediction horizon, which is a hyperparameter, and these sizes are forwarded to the spatial models to extract node features. Each feature encodes road structure information and node-specific attributes. The aggregation function is defined as \\(g(\\cdot)\\)."}, {"title": "3.2. Model Training", "content": "During the training process, the RNTransformer is used as a pre-trained model, with its parameters frozen. We adopt multiple loss functions for both the local and global models to ensure optimal performance. By iterating over the road network dataset, the RNTransformer learns node-wise information and compares predicted results with the actual pedestrian transitions using the Huber Loss \\(L_{global}\\), which is advantageous for handling outliers.\nWe integrate features extracted by the RNTransformer into the local model with a learnable weight, where each feature is concatenated to the spatial layer within the local model for each road user. The architecture comprises a single convolution layer and multiple linear layers to adapt to the dynamic size of the tensors, the quantity of which varies in accordance with the number of prediction horizons considered. The ReLU activation function is applied during this process.\nThe local model assesses the differences between predicted and ground truth trajectories sampled from a bivariate Gaussian distribution using a negative log-likelihood loss. To enhance training stability, we also incorporate L1 and L2 regularization terms. Each loss function is iteratively applied to the overall training process, as shown below:\n\\begin{equation}\n\\begin{aligned}\nL &= \\lambda_{huber}L_{huber} + \\lambda_{local}L_{local} + \\lambda_{L1}L_{1}+ \\lambda_{L2}L_{2}\\\\\n&= \\lambda_{huber} \\frac{1}{I} \\sum\\limits_{bs} \\sum\\limits_{t'=T'} 0.5(p_{t'}^{gt} - \\hat{p}_{t'}^i)^2 \\\\\n&- \\lambda_{local} \\sum\\limits_{t=T'}^{T_P} \\sum\\limits_{i=0}^{I} log(P((\\hat{\\mu}_i^t, \\hat{\\sigma}_i^t, \\hat{\\rho}_i^t), (p_i^{gt}| \\mu_i^t,  \\sigma_i^t, \\rho_i^t)))\\\\n&+ \\lambda_{L1} \\sum |w_i| + \\lambda_{L2} \\sum w_i^2\n\\end{aligned}\n\\end{equation}"}, {"title": "4. Experiments", "content": "For our experiments, we utilized the ETH Walking Pedestrians Dataset (Lerner et al., 2007) and the UCY Crowds-by-Example Dataset (Pellegrini et al., 2009). These datasets contain pedestrian trajectories captured at multiple locations, and we divided each dataset into training and evaluation subsets to ensure robust model validation. The trajectories were recorded at a frequency of 2.5 FPS. For our model, we used 8 frames (3.2 seconds) as input observations and predicted the subsequent 12 frames (4.8 seconds).\nThe road network was constructed based on the entire training dataset spanning all time steps and divided into 6 \u00d7 6 grids for our experiment. Our prediction model was trained using the observed sequences of pedestrian trajectories and validated against the target sequences. Initially, the pre-trained road network was trained and tested independently. We then selected the best-performing model to fuse its hidden features into the local prediction model. The RNTransformer was trained for 50 epochs optimized using SGD with a learning rate of 10-2 and a weight decaying rate of 10-3.\nWe sampled multiple trajectory probabilities from Gaussian distribution, with each parameter of the Gaussians determined by the model. The trajectory prediction model was trained along three socially aware baseline models: Social-LSTM (S-LSTM) (Alahi et al., 2016), Social-STGCNN (S-STGCNN) (Mohamed et al., 2020), and Social-Implicit (S-Implicit) (Mohamed et al., 2022). The S-LSTM was trained using the AdaGrad optimizer, while S-STGCNN and S-Implicit were trained with the SGD optimizer. We applied the basic loss functions (Section 3.2), as well as the specific loss functions defined in the respective papers for each baseline model.\nWe used two metrics to evaluate the developed model: the Average Displacement Error (ADE) (Alahi et al., 2016) (Equation 8) and the Final Displacement Error (FDE) (Pellegrini et al., 2009) (Equation 9). ADE measures the average L2 distance between the predicted and ground truth trajectories across all predicted time steps. FDE, on the other hand, is defined as the L2 distance between the predicted position at the final time step and the actual"}, {"title": "4.1. Experiments Design", "content": "ground truth position at that time step. In summary, ADE evaluates the model's performance on the entire prediction horizon, while FDE assesses its performance at the final time step.\n\\begin{equation}\nADE = \\frac{\\sum_{i \\in I} \\sum_{t \\in T_p} ||p_t^{gt} - \\hat{p}_t^i||_2}{I \\times T_p}\n\\end{equation}\n\\begin{equation}\nFDE = \\frac{\\sum_{i \\in I} ||p_{T_p}^{gt} - \\hat{p}_t^i||_2}{I} , t = T_p\n\\end{equation}"}, {"title": "4.2. Experimental Result", "content": "The model's performance on test data was evaluated using ADE and FDE. Table 1 presents the normalized results for these metrics across various datasets. The performance improvements are evident when comparing the baseline models with their extended versions that incorporate the RNTransformer. For the S-LSTM, integrating the RNTransformer results in a slight improvement with 1.3% in ADE and 2.2% improvement in FDE. The S-STGCNN shows significant performance gains with the RNTransformer integration. The ADE improves by 6.5%, and the FDE scores a remarkable improvement of 28.4%. The S-Implicit benefits greatly from the RNTransformer, achieving 8.6% improvement in ADE and 4.3% in FDE. Among the models tested, the S-Implicit with RNTransformer exhibits the best overall performance for both ADE and FDE, highlighting the synergy between the implicit modeling of social interactions and the road network representation provided by the RNTransformer."}, {"title": "5. Discussion & Future Works", "content": "In the previous section, we observed that the trip modality enhances pedestrian trajectory prediction. We further investigated how RNTrans-"}, {"title": "6. Conclusions", "content": "This study introduces a novel approach to enhance pedestrian trajectory prediction by incorporating trip information as a new modality. We propose RNTransformer to capture the global contextual trip information by reasoning pedestrian intention with crowd behavior. The RNTransformer significantly enhances prediction accuracy when integrating with various socially aware local pedestrian prediction models across multiple datasets. By formulating the scene into multiple grids and aggregating the number of pedestrians at each grid through time steps, the RNTransformer effectively learns crowd behavior. Moreover, the integrated model considers the impact of road environments on predictions by learning the spatial dependencies with GCN and temporal dependencies with GRU, as well as the pedestrian trajectories with the local model.\nThe proposed model is evaluated using pedestrian trajectories obtained from the ETH, UCY, and SDD datasets. Results demonstrate the quantitative improvements of our model that validate the effectiveness of incorporating trip information. Furthermore, the RNTransformer provides effective guidance for local models, resulting in more accurate goal predictions and better alignment with actual pedestrian trajectories. Future research should focus on expanding our methodology by exploring various strategies for sampling the grids in the road network and determining optimal scaling parameters. These efforts will help synthesize more accurate crowd behaviors and further enhance the predictive capabilities of the model. Additionally, we envision incorporating alternative approaches, such as non-socially aware models and vehicle trajectory predictions, to account for trip modality's effectiveness."}]}