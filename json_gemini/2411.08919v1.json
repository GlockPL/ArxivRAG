{"title": "A Machine Learning based Hybrid Receiver for 5G NR PRACH", "authors": ["Rohit Singh", "Anil Kumar Yerrapragada", "Radha Krishna Ganti"], "abstract": "Random Access is a critical procedure using which\na User Equipment (UE) identifies itself to a Base Station (BS).\nRandom Access starts with the UE transmitting a random\npreamble on the Physical Random Access Channel (PRACH). In\na conventional BS receiver, the UE's specific preamble is identified\nby correlation with all the possible preambles. The PRACH signal\nis also used to estimate the timing advance which is induced\nby propagation delay. Correlation-based receivers suffer from\nfalse peaks and missed detection in scenarios dominated by high\nfading and low signal-to-noise ratio. This paper describes the\ndesign of a hybrid receiver that consists of an AI/ML model for\npreamble detection followed by conventional peak detection for\nthe Timing Advance estimation. The proposed receiver combines\nthe Power Delay Profiles of correlation windows across multiple\nantennas and uses the combination as input to a Neural Network\nmodel. The model predicts the presence or absence of a user in\na particular preamble window, after which the timing advance is\nestimated by peak detection. Results show superior performance\nof the hybrid receiver compared to conventional receivers both\nfor simulated and real hardware-captured datasets.", "sections": [{"title": "I. INTRODUCTION", "content": "5G use cases such as Massive Machine Type Communi-\ncations, have to support a wide range and a large number of\nUE devices, including mobile phones and various IoT devices.\nEach of these devices has to attach to a BS, upon turning\non. In 5G systems, the BS continuously transmits broadcast\nsignals, which the UE has to detect in order to trigger its\ninitial attachment procedure. The procedure starts with the UE\nselecting a Random Access Preamble Index (RAPID) which it\nuses to rotate a known base sequence. Since the BS has limited\nknowledge about the UE's location and channel conditions, it\nuses a correlation-based receiver to decode the RAPID and\nestimate the propagation delay induced by the channel. Delay\nestimates fed back to the UE can be used to advance future\nuplink transmissions. Henceforth, we refer to this delay as\nTiming Advance (TA).\nInitially, the UE transmits on the PRACH with a low power\nand ramps it by 3/6 dB in the subsequent transmissions if\nthe previous reception fails. PRACH decoding failures, in the\nform of false peaks and missed detections are common in\ncorrelation-based receivers, particularly in high fading and\nlow Signal-to-Noise Ratio (SNR) scenarios. Note that each\nretransmission on the PRACH causes a wastage of radio and\npower resources and increases the latency of attachment.\nTo improve the robustness of PRACH decoding (and there-\nfore reduction in PRACH retransmissions), in this paper, we\nshow the design of a hybrid receiver that relies on an AI/ML\nmodel and a peak detection module. The input to the model\nis the Power Delay Profile (PDP) of the correlation, combined\nacross multiple antennas. We have shown that this hybrid\nreceiver performs better than both conventional correlation-\nbased approaches as well as other AI/ML-based approaches.\nThe main contributions of this paper are:\n\u2022\n\u2022 Design of a hybrid receiver for PRACH, which outper-\nforms correlation-based receivers. This work is a lower\ncomplexity enhancement of our previous work which\nrelied on large Neural Network (NN) models [1].\n\u2022 Performance analysis of the proposed receiver with Mul-\ntiple Input Multiple Output (MIMO).\n\u2022 Performance analysis of the proposed receiver on real\ndata.\n\u2022 Explainability insights on the decision making of the\nmodel using Shapley Additive Explanations."}, {"title": "II. BACKGROUND ON 5G NR PHYSICAL RANDOM ACCESS CHANNEL", "content": "This section provides basic details on the Random Access\n(RA) procedures and PRACH signal generation for 5G NR.\nAdditionally, it describes the prior literature on both conven-\ntional and AI/ML-based receivers.\n5G supports two types of RA Procedures - Contention-based\nRA and Contention-free RA. In contention-based access, the\nUE is free to choose any random preamble from a set. In\nContention-free RA, the UE is pre-assigned the preamble that\nit has to transmit. This paper focuses on the Contention-based\nRA. In the first step, the UE chooses a preamble randomly and\nsends it on the PRACH. This message is known as Msg1. At\nthe BS, the receiver determines which preamble the user has\nchosen and sends a response, also known as a RA Response\n(RAR, Msg 2). Uplink resources for the following message\nfrom the UE are also allocated using Msg 2. The RAPID is\nsent back to the UE, where it is compared with the one it had\nchosen previously. If both match, the UE transmits the next\nmessage in the uplink data channel (Msg 3). This is followed\nby a downlink contention resolution (Msg 4). If the RAPID is\ncorrectly detected, the RA procedure succeeds. Otherwise, the\nUE starts the whole process again, which adds to the latency\nin the attachment of the UE to the BS. Reducing the initial\nattach latency is the main motivation for designing a robust\nreceiver for the PRACH."}, {"title": "B. PRACH Sequence Generation and Transmission", "content": "This paper focuses on the PRACH signaling in Msg1 of the\nRA process. Considering an OFDM system, the received Msg\n1 signal, \u1ef9u,v,i(k) in the kth resource element, at the ith BS\nantenna is given by,\n$\\Yu,v,i(k) = hi(k)yu,v(k)e^{-j2\\pi TA_{i}\\frac{k}{N}} + wi(k),$\nwhere $h_i(k)$ represents the fading channel experienced by\nthe signal received at the ith antenna, N is the OFDM FFT\nsize, and $w_i(k)$ is the Additive White Gaussian Noise (AWGN)\nat the ith antenna. $TA_i$ is the timing delay experienced by the\nsignal received at the ith antenna. The sequence $Y_{u,v}(k)$ is the\ntransmitted frequency domain signal (mapped to the OFDM\nresource grid using the tables 6.3.3.2-2 to 6.3.3.2-4 given in\nTS 38.211 [2]) and it is given by,\n$\\Yu,v (k) = \\sum_{n=1}^{LRA-1} Xu,v (n)e^{\\frac{-j2\\pi n k}{LRA}} = Xu(k)e^{\\frac{-j2\\pi k v}{LRA}}$\n$\\xu(n) = e^{\\frac{-j\\pi u n(n+1)}{LRA}}, n=0, 1, .., LRA - 1$\n, \u03b7\nwhere the length of the sequence LRA, depends on the\nPRACH preamble format given by Table 6.3.3.1-2 in TS\n38.211 [2]. The initial sequence number u is selected from\nTable 6.3.3.1-4 in TS 38.211. xu(n) is a Zadoff-Chu base\nsequence and is given by $\\xu(n) = e^{\\frac{-j\\pi u n(n+1)}{LRA}}, n=0, 1, .., LRA - 1$. Note that xu (n) is first generated in the time\ndomain, upon which a random cyclic rotation is applied to\nobtain $x_{u,v}(n) = x_u((n+C_v) mod LRA)$. The cyclic rotation\nis a function of the preamble index and a parameter Ncs,\nwhich is given in Table 6.3.3.1-7 in TS 38.211. The table\nindices are configured by higher layers. Xu(k) is the LRA-\npoint Discrete Fourier Transform of the base sequence xu(n)\nand is known at both the transmitter and the receiver.\nIn this paper, we use the following commonly configured\nparameters for illustration: LRA = 139 and Ncs = 13\nresulting in C = vNcs where v indicates the preamble index\nranging from 0, .., $\\frac{LRA}{Ncs}-1$, for a base sequence. Note that $\\frac{LRA}{Ncs}$\n$\\frac{LRA}{Ncs}$\n=${\\frac{4096}{139}} = 29.4$ samples (caused by\na distance of 71m) causes the correlation peak at the receiver\nto shift by one sample."}, {"title": "C. Existing receivers for 5G NR PRACH", "content": "This section provides a summary of existing work on both\nconventional and AI/ML-based receiver implementations for\nPRACH. For ease of understanding the research landscape for\nPRACH, we provide a summary of key prior works along with\na comparison with our proposed receiver in Table I.\n1) Conventional approaches: Conventional receivers use\ncorrelation [3], [4] followed by a thresholding mechanism [5],\n[6], [7] to detect the user. Typical implementations achieve\ncorrelation by an equivalent IDFT operation. In the case of\nmultiple receiver antennas, correlation values are combined\nfrom all the receiver antennas using Equal Gain Combining\nsince the individual channels are not known. The combined\ncorrelation values are used either in the complex form (Com-\nplex Delay profile, CDP) or in the power form (Power Delay\nProfile, PDP), as shown below.\n$\\CDP x(k) = \\frac{1}{NRX} \\sum_{i=1}^{NRX} IDFT (\\frac{Yu,v,i (k)}{Xu(k)})$\n$\\PDP |x(k)|^2 = \\frac{1}{NRX} \\sum_{i=1}^{NRX} |IDFT (\\frac{Yu,v,i (k)}{Xu(k)})|^2$\nHere, NRX is the number of receiver antennas, \u1ef9u,v,i(k)\nis the received frequency domain data at the ith antenna and\nk = 0, .., LRA-1. Since, the value of Ncs is 13, groups of 13\nvalues of k correspond to a single preamble window (single\nRAPID).\nAn example of the PDP of the correlation is shown in\nFig. 1 for the case of EGC across 8 receiver antennas. We\nobserve that at low SNRs, even after combining values across\n8 RX antennas, there are still some false peaks. Setting up a\nthreshold is very difficult in such scenarios. If the threshold\nis set too high, then there will be a missed detection. If the\nthreshold is too low, there will be a lot of false peaks."}, {"title": "2) AI/ML approaches", "content": ": Several attempts at PRACH detec-\ntion (user detection, timing advance estimation and false peak\ndetection) using AI/ML have been made. A two-stage AI/ML\nframework is described in [8] where a first classifier predicts\nthe number of UEs likely to collide. Separate classifiers are\ndesigned for TA estimation. Other AI/ML models such as k-\nNearest Neighbors (kNN) [9], [10], Naive Bayes [9], [10],\nand Decision Tree Classification (DTC) [10] have shown to\nimprove the True/False classification performance. A further\ngain is achieved through ensemble learning methods [10] and\nthe models show 97% user detection accuracy at 10 dB and\n20 dB SNRs.\nAn initial attempt at RAPID detection and TA estimation\nis made by [11]. However, this work does not consider\nimpairments such as fading or noise, which are important\nfor any practical receiver. Our previous work [1] also de-\nveloped AI/ML classifier models for RAPID detection and\nTA estimation. The receiver proposed in this paper is an\nimprovement upon our previous work in terms of model\ncomplexity. The AI/ML classifier described in [12] achieves\ngood user detection performance using CDP as model input\nbut it is limited to AWGN scenarios. In this paper, we show\nthat in the presence of fading channels, CDP actually performs\nworse than PDP.\nThe hybrid receiver proposed in this paper has an NN\nthat can detect the presence or absence of users, without the\nneed for thresholds. The NN works for all the possible base\nsequences. It also works in the case of multiple users, provided\nthere is no collision of users within a preamble window. The\nNN can be trained offline, deployed in the BS and retrained\nperiodically to adjust the weights to the changing scenarios. In\nan RA scenario, even if there are many users in a given cell,\nthe probability of multiple users trying to access the network\nsimultaneously is very low. So it makes sense to optimize the\nreceiver for a single user instead of multiple users. Different\nfrom other works, we have evaluated the model with over-\nthe-air data captured from the IIT Madras 5G testbed [13].\nA further distinction of our work is that we have tried to\nexplain why the model takes a specific decision. We have used\nSHapley Additive exPlanations (SHAP) [14] (which works on\na game theoretic approach) to evaluate the model's decision-\nmaking."}, {"title": "III. PROPOSED HYBRID PRACH RECEIVER", "content": "Fig. 2 shows the proposed hybrid PRACH receiver. Initially,\nthe data is extracted from the Resource Grid in the frequency\ndomain. Subsequently, the extracted data is correlated with\nthe base sequence and the PDP is calculated based on Eq. (4)\nThe PDP is then separated into various preamble windows,\nand fed as separate input instances to the NN. The output\nprediction of the NN is the presence or absence of a user. If\nthe NN detects the user in a preamble window, the RAPID\ncorresponding that particular window can be identified. The\nwindow is then passed on to a peak detection module to find\nthe timing advance. If the NN does not detect the user, this\ndata in that window is discarded."}, {"title": "A. Neural Network Architecture", "content": "For the problem of user detection, we have used a simple\nFully Connected NN. The architecture of the NN model is\nshown in Fig. 3. The input to the model is the Ncs length\npreamble window extracted from the PDP as shown in Eq. (4).\nAn example model input can be seen in Fig. 9a. The model\nhas three hidden layers consisting of 128, 64 and 64 neurons\nrespectively. The output layer has two neurons, indicating\nwhether the user is detected or not."}, {"title": "B. Dataset Generation", "content": "1) Simulated datasets: For the training and testing of the\nNN model, we have generated datasets using MATLAB for\nthe SNR range of -20 dB to 20 dB in the steps of 5 dB.\nThe dataset contains 10000 instances for each SNR. During\ntraining, the data across all SNRs is combined. A train-test\nsplit of 75-25% is used.\n2) Over-the-Air (OTA) Hardware captured datasets: We\nhave also tested the AI/ML model using real-world data from\na base station at the IIT Madras 5G testbed to see how\nwell the model works with actual hardware impairments such\nas those from DACs (Digital-to-Analog converters), ADCS\n(Analog-to-Digital converters), up/down converters, amplifiers,\netc. Fig. 4 shows the hardware setup used for capturing the\nreal data. The transmitter and the receiver are set up one meter\napart in a line-of-sight scenario. We used an N5182B Vector\nSignal Generator with a commercial omnidirectional wideband\nmonopole antenna to transmit the signal over the air. The\ncenter frequency used is 3.64962 GHz, which lies in the N78\nband for 5G NR. We have used an in-house 5G-compliant\nbase station to receive the signal. One receiver antenna is\nused to receive the data. On the receiver side, the data\nundergoes various hardware impairments arising from multiple\ncomponents. The data is quantized and passed through the\ndifferent components in the receiver chain. Frequency domain\ndata is collected from the receiver and then pre-processed in\nMATLAB. After correlation with the base sequence the data\nis divided into various preamble windows. This data is used\nfor AI/ML model training and testing."}, {"title": "IV. RESULTS", "content": "This section shows the performance analysis of the proposed\nhybrid receiver for PRACH in terms of the user detection\naccuracy and the Timing Advance estimation accuracy.\nIn Fig. 5, we observe that the performance of the hybrid\nreceiver with AI/ML is significantly better than the con-\nventional correlation-based receiver. In the low SNR range,\nthe conventional correlation-based receiver suffer from false\ndetection and missed detections. These false peaks and missed\ndetections depend on the predefined threshold at the receiver.\nThis threshold is difficult to change in a deployed system in\nreal-time. Within AI/ML, PDP based model input is better than\nCDP based model input. This is because the information about\nthe user's presence is embedded within the correlation peak\nand not in the phase of the delay profile. Another problem\nwith the CDP-based method is that it suffers from destructive\ninterference when combining across multiple antennas.\nFig. 6 shows the performance of the PDP-based NN for\nmultiple receiver antenna scenarios, with EGC, for AWGN\nand the TDLC300 channel. Here, the number of transmit\nantennas at the UE is 1, and the number of receiver (BS)\nantennas considered is 1, 2, and 8. We can see that detection\naccuracy in AWGN is better than in the case of TDLC300\nfading. Furthermore, especially for the lower SNR cases, the\nperformance with multiple antennas is better than that with a\nsingle antenna."}, {"title": "A. Explainability of the model output", "content": "In addition to detection accuracy and TA estimation, we\nhave looked into the explainability of the AI/ML model using\nSHAP. It is a game theoretic approach that explains the output\nof any trained machine learning model. Using the SHAP\nlibrary in Python, we understand which of the inputs had more\nimpact on the model output (presence or absence of a user, in\nthis case). In other words, we want to know which parts of\nthe input helped the model predict the presence or absence of\na user. Naturally, the index where the peak is present should\ncarry more weight compared to the other indices in the PDP\n(input). In the case of multipath channels, the peak is scattered\ndue to various channel paths. In this case, the neighboring\nindices also carry significant weight. Fig. 9a shows an example\ninput to the model, and Fig. 9b shows the corresponding SHAP\nvalues. In the example shown in Fig. 9a, the highest peak is at\nthe 7th location, followed by the 6th, 8th location and so on.\nThis pattern is also reflected in the SHAP values in Fig. 9b."}, {"title": "B. Model Complexity", "content": "The neural network proposed in this paper has around\n28000 Floating Point Operations Per Second (FLOPS). The\ncorrelation operation has around 5800 FLOPS. For all 64\npreamble windows across all 7 base sequences, the total\nreceivers in 5G base stations and does not require setting up\nthresholds. Simulation results under TDLC MIMO channel\nmodels as well as hardware captures from a real 5G testbed\nbase station, show the proposed receiver's performance to\nbe better than the conventional methods. Using explainability\nframeworks such as SHAP, we provide some insights into the\ninner workings of the AI/ML model. Future work could extend\nto actual hardware deployment of the proposed receiver and\nalso to very low power devices such as Ambient IoT."}, {"title": "V. CONCLUSION", "content": "This paper presents a hybrid receiver consisting of an\nAI/ML model for user detection and conventional peak de-\ntection for timing advance estimation. This model can easily\nintegrate with current implementations of correlation based"}]}