{"title": "Evaluating the Generalization Ability of Spatiotemporal Model in Urban Scenario", "authors": ["Hongjun Wang", "Jiyuan Chen", "Tong Pan", "Zheng Dong", "Lingyu Zhang", "Renhe Jiang", "Xuan Song"], "abstract": "Spatiotemporal neural networks have shown great promise in urban scenarios by effectively capturing temporal and spatial correlations. However, urban environments are constantly evolving, and current model evaluations are often limited to traffic scenarios and use data mainly collected only a few weeks after training period to evaluate model performance. The generalization ability of these models remains largely unexplored. To address this, we propose a Spatiotemporal Out-of-Distribution (ST-OOD) benchmark, which comprises six urban scenario: bike-sharing, 311 services, pedestrian counts, traffic speed, traffic flow, ride-hailing demand, and bike-sharing, each with in-distribution (same year) and out-of-distribution (next years) settings. We extensively evaluate state-of-the-art spatiotemporal models and find that their performance degrades significantly in out-of-distribution settings, with most models performing even worse than a simple Multi-Layer Perceptron (MLP). Our findings suggest that current leading methods tend to over-rely on parameters to overfit training data, which may lead to good performance on in-distribution data but often results in poor generalization. We also investigated whether dropout could mitigate the negative effects of overfitting. Our results showed that a slight dropout rate could significantly improve generalization performance on most datasets, with minimal impact on in-distribution performance. However, balancing in-distribution and out-of-distribution performance remains a challenging problem. We hope that the proposed benchmark will encourage further research on this critical issue. Codes are available at GitHub", "sections": [{"title": "INTRODUCTION", "content": "VER a decade ago, research had already demonstrated that machine learning systems could exhibit significant failures when evaluated on data outside the domain of their training examples, primarily due to their heavy dependence on the training distribution [1]. For instance, self-driving car systems have been shown to perform poorly under conditions that deviate from their training environments, such as variations in lighting [2], weather [3], and object orientations [4].\nDespite the significant model degradation observed in various domains, there is limited research addressing this issue within the urban-related applications. Rapid urbanization in recent years has presented substantial challenges to accurate traffic forecasting [5]. The continuous growth and development of urban areas have led to significant changes in traffic patterns and mobility demands, imposing rigorous requirements on the generalization capabilities of these models. An illustrative example of Spatiotemporal Out-Distribution is shown in Figure 1. Prior to year Y, a road connected S\u2081 and S\u2083 is under construction, while S\u2082 housed a hospital. Consequently, a strong spatial correlation existed between S\u2081 and S\u2082 relative to S\u2083. However, a significant shift occurred in the subsequent year: the hospital in S\u2082 was demolished, and a new healthcare facility was constructed in S\u2083, introducing a spatial out-of-distribution scenario. To compound this, the road linking S\u2081 and S\u2083 underwent expansion, creating a temporal OOD condition. These transformative changes engendered novel spatiotemporal relationships, prompting an inquiry into the adaptability of the ST-model to such evolving circumstances.\nDespite the proliferation of spatiotemporal datasets, many are constrained to evaluating model performance over relatively short time horizons, such as METR-LA [6] and PEMS [7]. While LargeST [8] has recently emerged as a"}, {"title": "RELATED WORK", "content": ""}, {"title": "Spatiotemporal Benchmarks", "content": "The spatiotemporal research community has benefited from a diverse array of public datasets and benchmarks across various urban computing domains. In transportation, datasets like METR-LA [6] and PEMS series [20] offer rich spatio-temporal data for traffic prediction tasks, while datasets such as NYC taxi [21] and bike-sharing records [22] enable research on urban mobility patterns. Environmental studies are supported by air quality datasets from major cities [23] and meteorological data collections like WeatherBench [24]. Public safety research utilizes crime datasets from metropolitan areas [25] and natural disaster records [26]. In the public health domain, datasets tracking the spread of diseases, including COVID-19 [27] and influenza [28], are available. Complementing these datasets, domain-specific benchmarks such as BasicTS [29] for traffic prediction and WeatherBench2 [30] for meteorological forecasting provide standardized evaluation frameworks. This ecosystem of open resources fosters reproducibility, enables fair model comparisons, and drives innovation in spatiotemporal research across diverse urban computing applications.\nAlthough numerous datasets have been introduced, the generalization capabilities of spatiotemporal models remain inadequately understood. A major concern stems from the fact that conventional datasets typically evaluate models only a few weeks after training, providing limited insight into their long-term robustness. To address this limitation, this paper introduces a systematic benchmark, ST-OOD, marking the first comprehensive effort to construct a spatiotemporal out-of-distribution scenario for extensive validation of existing models."}, {"title": "Spatiotemporal Models", "content": "In recent years, deep neural networks, particularly graph neural networks (GNNs), have become the preferred approach for spatiotemporal prediction [6], [31], [32], [33], [34]. Researchers typically combine GNNs to capture complex spatial dependencies with recurrent neural networks (RNNs) or temporal convolutional networks (TCNs) to model temporal dependencies. For instance, the DCRNN [6] initially introduced a novel diffusion convolution that works alongside GRU. Following this, a series of related works emerged, such as AGCRN [10], and DGCRN [36], which also employed RNNs and their variants. To optimize RNNs for faster training and leverage parallel computing, numerous methods such as STGCN [7], GWNet [13], and DMSTGCN [37] replaced RNNs with dilated causal convolutions for temporal pattern modeling. Other approaches focus on graph structures; for example, ASTGCN [20] uses attention mechanisms to model both spatial and temporal correlations. Recently, there has been a trend towards coupling GNNs with neural ordinary differential equations to generate continuous layers for modeling long-range spatiotemporal dependencies, as seen in STGODE [14] and"}, {"title": "THE ST-OOD BENCHMARK", "content": "This section formally introduces the proposed ST-OOD benchmark, designed to comprehensively evaluate the spatiotemporal generalization capabilities of current models across various scenarios. We begin by detailing the collection and organization of ST-OOD in Sec. 4.1. Then, in Sec. 4.2, we conduct an in-depth data analysis to gain deeper insights into ST-OOD."}, {"title": "Data Collection and Preprocessing", "content": "In the following section, we provide a detailed description of the data collection process. All datasets were uniformly trained using data from the previous year, while testing was conducted on the same dates for both the same year and the following year to evaluate model generalization ability. We adopted the data partitioning strategy established in prior work [45], which chronologically divides the data into training, validation, and testing subsets with a 6:2:2 ratio. We have devised both in-distribution and out-of-distribution testing protocols to rigorously assess model performance. Specifically, models are trained on data from year A and subsequently evaluated on datasets from both year A (in-distribution) and year A+ 1 (out-of-distribution). By juxtaposing the model's performance on year A data against its performance on year A + 1 data, we can more comprehensively gauge the model's generalization capabilities and robustness to temporal shifts in data distribution. Additionally, for each dataset, we generated adjacency matrices based on the haversine (great-circle) distance between units. Units within 500 meters were considered connected (denoted as 1), while those beyond this threshold were considered disconnected (denoted as 0). For the 311 service dataset, where the statistical units are community districts,"}, {"title": "Data Analysis", "content": "In this section, we attempt to explore the differences between in-distribution and out-of-distribution scenarios from a data perspective. To evaluate the similarity of graph relationships, we employ Kendall's \u03c4 coefficient [46], which allows us to quantitatively assess the spatial shifts between in-distribution and out-of-distribution for the same day across different years [47]. Mathematically, the Kendall's \u03c4 for node v is defined as:\n$\\tau_v = \\frac{2}{n(n - 1)} \\sum_{u \\in N(v)} \\sum_{i<j} \\text{sign}(x_v^{(i)} - x_v^{(j)}) \\text{sign}(y_v^{(i)} - y_v^{(j)}),$ where $x_v$ and $y_v$ represents the signal of node $v$ in the same year or across different years. $N(v) = \\{u \\in V | (v, u) \\in E\\}$ denotes the neighbors of node $v$, $n = |N(v)|$ is the number of neighbors of node $v$, $E$ represents the edge set of the graph, and the sign function returns +1 when $x_v > x_u$, -1 when $x_v < x_u$, and 0 when $x_v = x_u$. Kendall's \u03c4 coefficient ranges from -1 to 1, where a value of 1 indicates perfect agreement between the rankings, -1 indicates perfect disagreement, and 0 suggests no correlation. We also introduce the Dynamic Time Warping (DTW) [48] metric to capture the temporal distance between different days. A DTW value of 0 would mean the sequences are identical, while larger values suggest increasing dissimilarity in the temporal patterns between days.\nIn Figure 3, we provide a comprehensive comparison of both intra-year and cross-year results, highlighting the"}, {"title": "EXPERIMENTS", "content": "Baselines. ST-OOD benchmark presents an extensive evaluation of traffic forecasting methods, covering a wide range of baselines with publicly accessible implementations. These baselines include traditional, contemporary deep learning, and state-of-the-art models, offering a comprehensive view of advancements in the field.\n\u2022 LSTM [51]: A recurrent neural network architecture, Long Short-Term Memory, is known for effectively capturing and maintaining long-term dependencies in sequential data.\n\u2022 Graph WaveNet [13]: Stacks Gated Temporal Convolutional Networks (TCN) with Graph Convolutional Networks (GCN) on WaveNet backbone [52] to concurrently capture both spatial and temporal dependencies.\n\u2022 ASTGCN [20]: The Attention-based Spatial-Temporal Graph Convolutional Network synergizes spatial-temporal attention mechanisms to capture dynamic spatial-temporal patterns in traffic data.\n\u2022 MTGNN [44]: Expands Graph WaveNet by incorporating mix-hop propagation layers, dilated inception layers for temporal modeling, and a sophisticated graph learning module.\n\u2022 STGCN [7]: A Spatial-Temporal Graph Convolutional Network that models spatial dependencies using graph convolutions and temporal dependencies via 1D convolutions.\n\u2022 STTN [53]: The Spatial-Temporal Transformer Network applies the Transformer architecture to simultaneously capture both spatial and temporal dependencies in traffic data.\n\u2022 STGODE [14]: Models continuous traffic flow changes over time and space using neural ordinary differential"}, {"title": "DISCUSSION", "content": "As illustrated in Table 2, MLPs, GNNs and Transformer display fundamentally different inductive biases, which significantly influence their generalization in spatiotemporal forecasting. STID employs MLPs based on the assumption of independence among input features, with a bias toward learning global relationships while disregarding the inherent structure of the data. STID relies exclusively on node embeddings to distinguish nodes, thereby reducing the introduction of spatial inductive biases. In contrast, GNNs and Transformer explicitly exploit the relational structure of ST data, learning node representations through local [55] or global neighborhood aggregation [56]. This structure-aware bias makes GNNs and Transformer well-suited to capturing complex dependencies in the data, though it may also lead to an over-reliance on neighborhood, exacerbating issues related to spurious correlations [57]. For example, in recommender systems, GNNs may reinforce social biases embedded in interaction graphs, leading to biased recommendations [58]. Moreover, when handling dynamic graphs, GNNs may struggle to distinguish between transient connections and persistent relationships, potentially amplifying short-term spurious correlations [59]. Understanding these inductive biases is essential for selecting appropriate models and designing learning strategies for spatiotemporal tasks, especially in the presence of complex data prone to spurious correlations.\nFurthermore, our findings suggest that the lack of a rigorous benchmark for spatiotemporal generalization has hindered the proper evaluation of models in OOD scenarios. Existing models either rely on limited datasets [17], introduce artificial noise [18], or remove nodes selectively [19], resulting in inadequate testing methodologies. Using the ST-OOD dataset, we have uncovered significant limitations in current spatiotemporal OOD models, particularly their suboptimal in-distribution performance and instability in OOD scenarios, sometimes yielding worse results than existing methods. Additionally, there is no unified strategy that can be applied seamlessly across current models. Given that many approaches have been validated on conventional benchmarks, addressing these shortcomings is critical for"}, {"title": "FUTURE OPPORTUNITIES AND LIMITATIONS", "content": "To advance research on OOD spatiotemporal prediction, we introduce ST-OOD as a new benchmark dataset. It comprises six types of urban data: shared bikes, 311 services, pedestrian counts, traffic speed, traffic flow, and ride-hailing demand. Based on thorough data analysis and extensive experimental results, we highlight the following research opportunities for future exploration:\n\u25c6 Integrating graph and time-series OOD theory into spatiotemporal prediction. Recent advances in out-of-distribution generalization on graphs [61], which"}]}