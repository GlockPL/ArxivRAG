{"title": "Estimating Peer Direct and Indirect Effects in Observational Network Data", "authors": ["Xiaojing Du", "Jiuyong Li", "Debo Cheng", "Lin Liu", "Wentao Gao", "Xiongren Chen"], "abstract": "Estimating causal effects is crucial for decision-makers in many applications, but it is particularly challenging with observational network data due to peer interactions. Many algorithms have been proposed to estimate causal effects involving network data, particularly peer effects, but they often overlook the variety of peer effects. To address this issue, we propose a general setting which considers both peer direct effects and peer indirect effects, and the effect of an individual's own treatment, and provide identification conditions of these causal effects and proofs. To estimate these causal effects, we utilize attention mechanisms to distinguish the influences of different neighbors and explore high-order neighbor effects through multi-layer graph neural networks (GNNs). Additionally, to control the dependency between node features and representations, we incorporate the Hilbert-Schmidt Independence Criterion (HSIC) into the GNN, fully utilizing the structural information of the graph, to enhance the robustness and accuracy of the model. Extensive experiments on two semi-synthetic datasets confirm the effectiveness of our approach. Our theoretical findings have the potential to improve intervention strategies in networked systems, with applications in areas such as social networks and epidemiology.", "sections": [{"title": "Introduction", "content": "Causal effect estimation is an important area of study, with the focus on determining cause-and-effect relationships between variables (Imbens and Rubin 2010; Pearl 2009). It is challenging to achieve accurate causal effect estimation using observational data due to the presence of confounders that affect both the treatment and the outcome. When the data is collected from sources such as social networks, communication networks, or biological networks, causal effect estimation becomes even more challenging since the data is inherently networked, meaning that units (e.g., individuals, nodes) are interconnected, and their outcomes potentially being influenced by both the treatments and outcomes of their neighbors (Sinclair, McConnell, and Green 2012). This implies that traditional causal inference methods are not applicable any more since they may not adequately account for peer effects or network dependencies (Yao et al. 2021). Therefore, estimating causal effects on network data necessitates specialized techniques that can handle these interdependencies, ensuring that the estimated effects are not biased by the network structure itself.\nEffects in network data can be classified into peer effects (PE, an individual's treatment affects another's outcome) and self-treatment effects (STE, an individual's treatment affects their own outcome). As illustrated in Fig. 1(a), in the context of an infectious disease, an individual's infection status depends on both their own and their neighbors' vaccination statuses. Peer effects can be direct, where the vaccination of an individual's neighbour reduces the risk of the individual's infection (peer direct effect, PDE, as indicated by the edge marked with \u2460 in Fig. 1(b)), or indirect, where the vaccination of an individual's neighbour affects the neighbor's own infection status, which in turn (indirectly) affects the individual's infection status (peer indirect effect, PIE, as indicated by the path marked with \u2461 in Fig. 1(b)). Understanding these mechanisms is crucial for optimizing vaccination strategies. Peer direct effect denotes the effectiveness of a vaccine on an individual by vaccinating their neighbours regardless of their neighbours' infectious conditions. Peer indirect effect indicates the effectiveness of a vaccine on an individual by improving their neighbours infectious conditions through vaccination.\nCausal mediation analysis (MacKinnon, Fairchild, and Fritz 2007) is usually used to distinguish between direct and indirect effects in independent and identically distributed (IID) data. VanderWeele et al. (VanderWeele, Tchetgen, and Halloran 2012) combined causal mediation analysis with"}, {"title": "Preliminary", "content": "This section provides the notations and problem setting used throughout the paper."}, {"title": "Notations and Problem Setting", "content": "Throughout the paper, uppercase letters (e.g., $T_i$, $W_{t_i}$) denote variables, while lowercase letters (e.g., $t_i$, $w_{t_i}$) represent their values. Bold uppercase letters (e.g., $\\textbf{W}$, $\\textbf{X}$, $\\textbf{W}_y$, $\\textbf{W}_x$) indicate sets of variables, vectors or matrices, and bold lowercase letters (e.g., $\\textbf{w}_x$, $\\textbf{x}$, $\\textbf{w}_y$, $\\textbf{w}_{x_i}$) represent their corresponding values.\nA network can be represented as a pair $(V, E)$, where $V = \\{V_1,..., V_m\\}$ is the set of nodes, and $E \\subseteq V \\times V$ is the set of edges between the nodes. A node $V_i \\in V$ has a set of features $X_i = \\{X_{i1}, ..., X_{ik}\\}$, a treatment $T_i$, and an outcome $Y_i$ associated with it. We assume $T_i \\in \\{0,1\\}$ is a binary treatment, representing, e.g., whether node $V_i$ receives a vaccination or not, and $Y_i$ is a continuous variable, indicating, e.g., the level of immunity of $V_i$. For simplicity of presentation, we will use the index of a node, e.g., $i$, to represent the corresponding node $V_i$ when there is no ambiguity in the rest of the paper."}, {"title": "Problem Definition", "content": "Considering an individual or node $i$, its outcome $Y_i$ is affected by several factors: its own features $X_i$, its treatment $T_i$, the features of its neighbors $\\{X_j\\}_{j\\in N_i}$, the treatments administered to those neighbors $\\{T_j\\}_{j\\in N_i}$, and the outcomes observed in those neighbors $\\{Y_j\\}_{j\\in N_i}$. Here, $N_i$ represents the set of neighbors of unit $i$, as illustrated in Fig. 2(a).\nWe use Kullback-Leibler (KL) divergence (Belov and Armstrong 2011) to compute the difference between the probability distributions $P_i$ and $P_j$ of node $i$ and its neighboring node $j$, as given by Eq 1 below:\n$D_{KL}(P_i || P_j) = \\sum_k P_i(k) \\log(\\frac{P_i(k)}{P_j(k)})$ (1)\nwhere $k$ is the dimension of the feature vector of a node. Based on the KL divergence, we calculate the influence weight of neighbor $j$ on individual $i$, $w_{ij}$ as follows:\n$w_{ij} = \\frac{1}{1+ D_{KL}(P_i || P_j)}$ (2)\nThe higher the weight $w_{ij}$, the greater the influence of neighbor $j$ on individual $i$.\nNeighbor treatment exposure $W_{t_i}$, neighbor contagion exposure $W_{y_i}$, and neighbor feature $W_{x_i}$ are calculated as: $W_{t_i} = \\sum_{j\\in N_i} w_{ij}T_j$, $W_{y_i} = \\sum_{j\\in N_i} w_{ij}Y_j$, $W_{x_i} = \\sum_{j\\in N_i} w_{ij}X_j$, respectively.\nOur problem definition is provided as follows:\nGiven the observational networked data of a network $(V, E)$, including the data of the features, treatments and outcomes associated with the nodes of the network, our goal is for each node or individual $i$ to distinguish and obtain unbiased estimation of the peer direct effects (PDE) (i.e., the causal effect of $W_{t_i}$ on $Y_i$ via $W_{t_i} \\rightarrow Y_i$), peer indirect effects (PIE) (i.e., the causal effect of $W_{t_i}$ on $Y_i$ via $W_{t_i} \\rightarrow W_{y_i} \\rightarrow Y_i$), and self-treatment effects (STE) (i.e., the causal effect of $T_i$ on $Y_i$ via $T_i \\rightarrow Y_i$) as shown in Fig. 2.\nThe formal definitions of group level PDE and PIE, and STE are based on the potential outcome framework (Imbens"}, {"title": "Assumptions", "content": "and Rubin 2010). In the following, we first present the basic concepts of the framework, then give the definitions of PDE, PIE and STE.\nFor each unit $i$ under two treatment conditions $T_i$ (where $T_i = 0$ represents no treated unit and $T_i = 1$ represents treated unit), we define two potential outcomes: $Y_i(1)$, the outcome if the unit receives treatment, and $Y_i(0)$, the outcome if untreated.\nThe individual treatment effect (ITE) is defined as the difference between these potential outcomes:\n$ITE_i = Y_i(1) - Y_i(0)$ (3)\nThe average treatment effect (ATE) across the population is defined as the expected value of the ITE for all units:\n$ATE = E[Y_i(1) - Y_i(0)]$ (4)\nUnder the potential outcome framework and following the definitions of PDE and PIE in (VanderWeele, Tchetgen, and Halloran 2012), in our problem setting, we have:\n$PDE = E [Y_i(w_{t_i}', W_{y_i}(w_{t_i}')) - Y_i (w_{t_i}, W_{y_i}(w_{t_i}))]$ (5)\n$PIE = E [Y_i(w_{t_i}, W_{y_i}(w_{t_i})) - Y_i(w_{t_i}, W_{y_i}(w_{t_i}))]$ (6)\nThe PDE defined in Eq. 5 indicates the average of the difference between the potential outcomes of an individual when the aggregated treatment of its neighbours, i.e., its neighbor treatment exposure $W_{t_i}$, is changed from one level ($w_{t_i}'$) to another ($w_{t_i}$), while the aggregated neighbor potential outcome, i.e., its neighbor contagion exposure $W_{y_i}$, remains at the level as it would have been if the neighbours' aggregated treatment had been $w_{t_i}$, denoted as $w_{y_i}(w_{t_i})$. In the vaccination example, PDE indicates the average effect of changing the vaccination status of an individual's neighbors on the infectious status of the individual, assuming the neighbors' infectious status is kept at the level as after their vaccination status is changed.\nThe PIE defined in Eq. 6 indicates the average of the difference between the potential outcomes of an individual when the aggregated treatment of its neighbours, i.e., its neighbor treatment exposure $W_{t_i}$, remains unchanged at $(w_{t_i})$, while the aggregated neighbor potential outcome, i.e., its neighbor contagion exposure $W_{y_i}$, is changed from what it would have been if the neighbours' aggregated treatment had been $w_{t_i}$, denoted as $w_{y_i}(w_{t_i})$, to what it would have been if the neighbours' aggregated treatment had been $w_{t_i}'$, i.e., $w_{y_i}(w_{t_i}')$. In the vaccination example, PIE indicates that assuming the vaccination status of the neighbors of an individual remains unchanged, how the change of the infectious status of an individual's neighbors as a result of changing their vaccination status would affect the infectious status of the individual.\nThe definition of STE in our problem setting is similar to the definition of ATE, i.e., $STE = E [Y_i(1) - Y_i(0)]$. In the vaccination example, STE indicates the average difference of potential outcomes of an individual if the individual had been vaccinated versus if they had not been vaccinated.\nEstimating these effects deepens our understanding of in-teractions within complex networks and provides critical in-sights for informed policy decisions."}, {"title": "The Proposed gDIS Method", "content": "In observational data, we only have the observed outcome, i.e., the factual outcome, but estimating causal effects re-quires the potential outcomes, i.e., both the factual and counterfactual outcomes. Therefore, the following assumptions are needed for estimating causal effects from observational network data (Jiang and Sun 2022).\nIn the following assumptions, $Z_i = (W_{t_i}, W_{y_i})$, where $W_{t_i}$ and $W_{y_i}$ represent the aggregated treatment and contagion exposures of node i's neighbors, respectively. We define $z_i$ as the corresponding value of $Z_i$.\nThe potential outcome is independent of both individual treatment and neighborhood exposure, given the individual and neighbor features. i.e., $Y_i(t_i, z_i) \\perp T_i, Z_i | X_i, W_{x_i}$\nIf the potential outcome $Y_i(t_i, z_i)$ for individual $i$ depends on both $i$'s treatment $T_i$ and $Z_i$, network interference exists.\nThe potential outcome equals the observed outcome when a unit is exposed to the same treatment and neighborhood exposure. i.e., $Y_i = Y_i(t_i, z_i)$ if unit $i$ is subjected to $t_i$ and $z_i$.\nEvery treatment and neighborhood exposure pair $(T_i, Z_i)$ must have a positive probability of occurring. i.e., $0<p(t_i, Z_i | X_i, W_{x_i}) < 1$.\nEstablishing the identifiability of a causal effects is the pre-requisite for estimating the causal effects from data. To study the identifiability of the causal effects (PDE, PIE and STE) with network data, we propose a novel causal graph, as shown in Fig. 2(b), to illustrate these causal effects. In this section, we provide the assumptions and conditions for identifying these causal effects from network data, along with the theoretical analysis and corresponding proofs.\nTo present our main theoretical results (Theorems 1 and 2 below), we make the following assumptions, which are com-monly found in the causal inference literature and adapted to our problem setting, with causal relationships between vari-ables illustrated in Fig. 2(b). For simplicity, we omit the sub-script i from the names of the variables shown in Fig. 2(b) in the following discussion.\n(Sequential Ignorability (Imai, Keele, and Yamamoto 2010)) There exists a set of observed covariates W such that:\n1G-1. $W_x$ and $W_t$ block all backdoor paths from $W_y$ to Y that do not pass through $W_t$;\n1G-2. The set $W_x$ blocks all backdoor paths from $W_t$ to $W_y$ or Y, and no element in W is a descendant of $W_t$.\nA set W that satisfies both conditions in Assumption 5 serves as an adjustment set for obtaining unbiased estimates of PDE and PIE from network data. We present our first theoretical finding below."}, {"title": "Implementation", "content": "to accurately estimate PDE, PIE, and STE within networks, it is first necessary to establish Theorem 2, proving that these effects can be effectively identified, and then derive Eq 10 to Eq 12. The implementation process involves three key steps: (1-1) Causal Mediation Analysis: This step de-composes network peer effects into direct and indirect ef-fects using causal mediation analysis (Pearl 2014); (1-2) Back-Door Criterion Adjustment: This step effectively iden-tifies the STE using the back-door criterion, as introduced in the preliminaries. (2) GNNs: Multi-layer GNNs with at-tention mechanisms are employed to capture the different influence of high-order neighbors. (3) HSIC Regularization: HSIC regularization (Ahmad, Mazzara, and Distefano 2021) is integrated to ensure independence between features and embeddings, maximizing the utilization of graph structures and enhancing model robustness. The workflow of our gDIS model is shown in Fig. 3, and it provides a robust framework for estimating group-level PDE, PIE, and STE.\nUsing attention weights to capture the varying influences of nodes. A two-layer GNN with attention mechanisms dynamically weights the importance o neighboring nodes when updating each node's representation. By considering both direct and second-order neighbors, we calculate the attention coefficients $a_{ij}$ to indicate the relative importance of each neighbor as follows:\n$a_{ij} = \\frac{exp(\\phi(A^T [WH_i || WH_j]))}{\\sum_{k\\in N(i)\\cup\\{i\\}} exp(\\phi(A^T[WH_i || WH_k]))}$ (13)\nwhere $a_{ij}$ indicates the importance of neighfbor $j$ to node $i$, and $\\phi(\\cdot)$ is the LeakyReLU activation function (Xu et al. 2020). A is a learnable weight vector used to calculate the unnormalized attention score between nodes, while W is a"}, {"title": "HSIC Regularization.", "content": "learnable weight matrix that linearly transforms the feature vector H. $H_i$ and $H_j$ are the feature vectors of nodes $i$ and $j$, respectively, and $||$ denotes vector concatenation. N(i) represents the neighbor set of node i.\nThe new feature representation of node $i$ incorporates both its own information and that of its neighbors, resulting in a more comprehensive and accurate update.\n$H'_i = \\sigma(\\sum_{j\\in N(i)\\cup\\{i\\}} A_{ij} WH_j)$ (14)\nwhere $\\sigma(\\cdot)$ represents the ELU activation function (Ide and Kurita 2017).\nHSIC (Ahmad, Mazzara, and Distefano 2021) measures the dependence between two variables in a Reproducing Kernel Hilbert Space (RKHS) (Berlinet and Thomas-Agnan 2011). Adding an HSIC regularization term to the loss function promotes independence between the original features and node embeddings, encouraging the embeddings to rely more on graph structure rather than node features, thereby reducing overfitting and improving robustness.\nThe feature matrix H and the kernel matrix H' using the Gaussian kernel (Keerthi and Lin 2003) function are defined as follows:\n$(K_H)_{il} = exp(\\frac{-||H_i - H_l||^2}{2\\gamma^2})$ (15)\n$(K_{H'})_{il} = exp(\\frac{-||H'_i - H'_l||^2}{2\\gamma^2})$ (16)\nwhere $|| H_i - H_l||^2$ is the squared euclidean distance (Danielsson 1980) between feature vectors $H_i$ and $H_l$. $\\gamma$ is the Gaussian kernel bandwidth (Kakde et al. 2017), set to the median of input feature distances. I is the $m \\times m$ identity matrix, 1 is an $m \\times 1$ vector of ones, and m is the total number of samples. The centering matrix C is calculated as:\n$C = I - \\frac{1}{n} 11^T$ (17)"}, {"title": "Experiments", "content": "Objective Function. We use mean squared error (MSE) loss (Chicco, Warrens, and Jurman 2021) to measure the difference between actual and predicted values. Our final objective function is:\n$\\mathcal{L}_{total} = \\frac{1}{n} \\sum_{i=1}^{n} (\\hat{Y_i} - Y_i)^2 + \\lambda \\cdot \\frac{1}{(n - 1)^2} trace(K_H C K_{H'} C)$ (18)\nwhere $\\lambda$ is a hyperparameter set to 0.1. The trace term measures the dependence between the feature matrix H and the embedding matrix H'.\nIn this section, we evaluate the causal effect estimation capabilities of gDIS. We use standard evaluation metrics to compare the performance of gDIS against baseline models, validating its effectiveness."}, {"title": "Experiments Setup", "content": "Datasets. Each unit i has only one observed treatment $T_i$, peer exposure $Z_i$, and outcome $Y_i$ (the factual outcome), making direct causal effect estimation challenging due to unobservable counterfactuals. Following (Jiang and Sun 2022; Chen et al. 2024), we use semi-synthetic datasets where the network structure (features and link) is real, but treatments and outcomes are simulated. The datasets include two real-world social networks: BlogCatalog and Flickr (Li et al. 2015), with detailed descriptions provided in the Appendix.\nGiven the high-dimensional and sparse nature of the orig-inal features, we follow the approach in (Jiang and Sun 2022; Chen et al. 2024) and apply Latent Dirichlet Allocation (LDA) (Blei, Ng, and Jordan 2003) to reduce the dimension to 10. The network is then divided into training, validation, and test sets using the METIS algorithm (Karypis and Kumar 1998). $T$ and $Y$ are simulated according to the pro-cedure outlined in Fig. 2(a). Due to space limitations, further details are provided in the appendix."}, {"title": "Metrics", "content": "We evaluate the algorithms using two met-rics: MSE (Chicco, Warrens, and Jurman 2021) and PEHE (Grimmer, Messing, and Westwood 2017). MSE, defined as $E_{MSE} = \\frac{1}{n} \\sum_{i=1}^{n} (\\hat{Y_i} - Y_i)^2$, measures counterfactual estimation accuracy. PEHE, defined as $E_{PEHE} = \\frac{1}{m} \\sqrt{\\sum_{i=1}^{m} [(\\hat{Y_i}(t') - \\hat{Y_i}(t)) - (Y_i(t') - Y_i(t))]}$, evaluates the precision in estimating heterogeneous effects. Here, $\\hat{Y_i}$ and $Y_i$ denote estimated and ground truth outcomes, with lower values indicating better performance."}, {"title": "Related Work", "content": "In this section, we review methods for estimating causal effects in network data that are related to our gDIS method.\nThere are var-ious methods for estimating peer effects in network data, where interference arises when an individual's treatment in-fluences the outcomes of connected individuals. For exam-ple, Forastiere et al. (Forastiere, Airoldi, and Mealli 2021) addressed this issue with a covariate adjustment method us-ing a generalized propensity score (PS) (Feng et al. 2012) to balance both individual and neighborhood covariates. Jiang et al. (Jiang and Sun 2022) introduced NetEst, a frame-work that employs graph neural networks (GNNs) to capture feature representations of both individual nodes and their first-order neighbors. Cai et al. (Cai et al. 2023) expanded on this by deriving generalization bounds and proposing a joint propensity score approach combined with representa-tion learning via weighted regression. Ma et al. (Ma et al. 2022) developed HyperSCI, which leverages hypergraph neural networks (HGNNs) (Ma et al. 2022) to model inter-ference using a multilayer perceptron (MLP) (Popescu et al. 2009) and hypergraph convolution. However, none of these methods distinguish between direct and indirect peer effects.\nAnother line of research focuses on estimating both direct and indirect peer effects in network data. VanderWeele et al. (VanderWeele, Tchetgen, and Halloran 2012) exam-ined the effects of vaccination in small family units, such as the impact of a child's vaccination on the mother. Shpitser et al. (Shpitser, Tchetgen, and Andrews 2017) developed a chain graph-based method to decompose peer effects into unit-specific components. Cai et al. (Cai, Loh, and Crawford 2021) evaluated contagion, susceptibility, and infectiousness effects in symmetric partnerships under infectious disease settings. Ogburn et al. (Ogburn et al. 2024) analyzed obe-"}, {"title": "Conclusion", "content": "sity status in the Framingham Heart Study using longitudinal logistic regression, noting potential issues with dependence and model misspecification. However, these studies gener-ally focus on scenarios with a propagation unit size of two, which may limit practical applicability. Ogburn et al. (Og-burn, Shpitser, and Lee 2020) also used a log-linear model within the chain graph framework to evaluate the decisions of nine judges. However, the assumption of system equilibrium may not hold in dynamic environments, limiting the model's accuracy and applicability. Different from these re-viewed works, our work focus on estimating peer direct and indirect effects at the group level. This more generalized set-ting allows us to capture the collective influence of groups, which is crucial for informing intervention strategies.\nIn this work, we address the novel problem of estimating three types of causal ef-fects in observational network data by proposing a new method, gDIS. Our approach differentiates between group-level PDE, PIE, and STE in observational network data. Through theoretical analysis, we establish identifiability conditions and provide corresponding proofs for the iden-tifiability of these causal effects. To capture complex net-work interactions, gDIS employs a multi-layer GNN with attention mechanisms and incorporate HSIC to effectively control dependencies between node features. We validated the effectiveness and robustness of our gDIS on two semi-synthetic datasets, demonstrating strong performance even in complex network environments.\nWhile our framework is supported by theorems and the performance of gDIS has been demonstrated, there are limitations. Our approach re-lies on the network unconfoundedness assumption, which may be violated in practice, despite being common in the literature. In future work, we aim to relax these assumptions"}]}