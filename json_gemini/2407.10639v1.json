{"title": "Risk-aware Trajectory Prediction by Incorporating Spatio-temporal Traffic Interaction Analysis", "authors": ["Divya Thuremella", "Lewis Ince", "Lars Kunze"], "abstract": "To operate in open-ended environments where humans interact in complex, diverse ways, autonomous robots must learn to predict their behaviour, especially when that behavior is potentially dangerous to other agents or to the robot. However, reducing the risk of accidents requires prior knowledge of where potential collisions may occur and how. Therefore, we propose to gain this information by analyzing locations and speeds that commonly correspond to high-risk interactions within the dataset, and use it within training to generate better predictions in high risk situations. Through these location-based and speed-based re-weighting techniques, we achieve improved overall performance, as measured by most-likely FDE and KDE, as well as improved performance on high-speed vehicles, and vehicles within high-risk locations.", "sections": [{"title": "I. INTRODUCTION", "content": "Vulnerable road users (VRUs), i.e., pedestrians, cyclists, motor cyclists, and horse riders [1], account for more than half of all road traffic accident related deaths worldwide [2] and are the hardest to predict since pedestrians are not restricted to the use of lanes as vehicles are [3]. Furthermore, every 1% increase in mean speed produces a 4% increase in fatal crash risk and 3% increase in serious crash risk [2], indicating that high speed vehicles pose a higher risk to VRUs and to other cars around them. Hence, high-risk pedestrian-vehicle interactions and high speed vehicles are two major sources of accidental collision.\nPredicting collisions and the behaviors used to prevent imminent collision can help autonomous robots to anticipate unexpected trajectories of near-collision situations and plan a safe path accordingly [4]. Risk/collision prediction can also help road planners improve road safety and traffic congestion [5]. Therefore, we aim to improve trajectory prediction in high-risk situations, specifically, those involving the previously discussed sources of accidental collision: close pedestrian-vehicle interactions and high speed vehicles.\nFurthermore, we recognize that many trajectory prediction datasets include a large number of stationary vehicles which are easier to predict and therefore may bias models and evaluation metrics to show superficially better performance. In this work, we report separate metrics for performance on stationary and non-stationary vehicles, so that better understanding of the model's performance can be gained.\nOur contributions include: 1) identifying areas of the map with high-risk pedestrian-vehicle interactions, 2) improving model performance on those high-risk areas, 3) additionally improving performance for dangerous high-speed vehicles, and 4) extensively analyzing both the baseline and our models on stationary and non-stationary vehicles, high-speed vehicles, and road users within high-risk locations.\nIn this work, we study the risk that observed road users pose towards each other, and aim to understand how inter-actions between them change due to the presence of risk conditions. We do not define risk as a measured uncertainty of prediction confidence or as the danger autonomous robots may pose to humans. The code 1 for our work is available."}, {"title": "II. RELATED WORK.", "content": "Many trajectory prediction algorithms use map informa-tion to add spatial context to the prediction model (e.g. [6]- [9]). However, some models add extra context (calculated heuristically or through model learning) to locations on the map. For example, [10] combines semantic map labels and positions of social agents into an occupancy map with a sliding scale: agents, cones, and curbs are high occupancy, merge lanes are medium occupancy (since they're likely to soon be occupied), and fast lanes are low occupancy. Similarly, [11] creates an occupancy map from lane lines and road boundaries. Some methods, on the other hand, dedicate part of their model towards learning extra spatial information: [12] produce a heatmap of potential goal loca-tions from the map and agent history to better inform the prediction model while [13] learn latent map features using an autoencoder to provide latent spatial information.\nHowever, one underexplored area of spatially aware trajec-tory prediction is the study of spatio-temporal patterns across the dataset and creation of location-specific priors based on these patterns, to incorporate into trajectory prediction. One implementation of this technique is the building of MoDs (maps of dynamics), which gather spatial velocity informa-tion from the training data and encode learned stochastic motion patterns at each location [14]. This is used to bias the prediction model [14]. Another method which improves prediction using spatio-temporal pattern priors is [15]. [15] extracts the spatial risk pattern at each timestep in the traffic scene by calculating the TTC (time-to-collision) between ev-ery pair of vehicles, records the locations with low TTC, and creates a spatial risk heatmap by using the average inverse TTC value at every location. This approach is the most sim-ilar to our work, with two primary differences. Firstly, [15]"}, {"title": "B. Risk-Aware Trajectory Prediction", "content": "While there are many trajectory prediction methods which use a collision risk formulation to prevent the prediction of trajectories which collide with each other (e.g. [6], [17], [18]), we aim to increase understanding and performance in situations where agents do collide (or almost collide) so that high-risk potential collision interactions can be better predicted. Therefore, we discuss here the methods which use non-spatial calculations of risk (as spatial methods are cov-ered above) to improve performance on high-risk trajectories.\n[16] propose a risk metric applicable to both vehicles and VRUs which exhibit large lateral motion and combine this with a trajectory prediction model to create a predictive risk analysis model which can accurately forecast risky scenarios 3 seconds before they happen. Although we use a simple distance-based risk estimation in this work, the future direction of our research aims to use the risk metric defined by [16] within the risk-aware prediction method of this work.\n[19] and [20] use CVaR (probability of predictions below a certain error) as the formulation of risk, which aims to reduce prediction error of the worst performing long-tail of the dataset. [20] is similar to our method in that it performs re-weighting to increase importance of high-risk examples."}, {"title": "III. METHODOLOGY", "content": "Dataset. To train and evaluate our model, we use the NuScenes dataset [21], which consists of 1000 scenes with 5.5 hours of footage labeled at 2Hz. It has 17,081 labeled tracks taken from a moving vehicle in 4 neighborhoods within Boston and Singapore (boston-seaport, singapore-onenorth, singapore-queenstown, singapore-hollandvillage), and includes HD semantic maps with 11 annotated layers, including pedestrian crossings, walkways, stop lines, traffic lights, road dividers, lane dividers, and driveable areas [21].\nBaseline. We use the same training methodology and learning parameters as our baseline, Trajectron++ [8], with 12 epochs, data augmentation, dynamics integration, and se-mantic maps. The Trajectron++ [8] architecture encodes the semantic map, history, and social interactions via a CNN and LSTMs respectively, and puts the concatenated input feature encodings into a CVAE to learn a latent space embedding, which is then used to predict a multi-modal distribution of likely future positions iteratively using a gaussian mixture model on top of a GRU."}, {"title": "A. Location-Risk Model", "content": "Data shows that in busy intersections and shopping areas, risk of pedestrian-vehicle collision is much greater [22]. While such areas can be labeled or inferred from a semantic map like NuScenes [21], maps lack the spatio-temporal information that residents would know: knowledge of which intersections and shopping areas are busier and when. For-tunately, this information can be gathered from patterns in training data [15].\nTo gather these patterns, we first determine the distance between every non-stationary vehicle and VRU within each scene (since interactions between VRUs and non-stationary vehicles pose the highest risk), and discretize the map of each neighborhood in NuScenes into a 100x100 grid. Then, we assign a risk score to each of the 10k bins of the grid in the following way: for each timestep, the value of the location bin containing the closest (distance-wise) vehicle-VRU interaction in the map is incremented. This creates a 100x100 2D histogram that shows the per-location frequency of the number of timesteps at which the riskiest vehicle-VRU interaction of the timestep had that location. Finally, this histogram is normalized, shifted, and re-scaled such that the minimum value is 1 and the maximum value is 10 (in order to give a re-weighting factor of 1 to low-risk locations and 10 to high-risk locations). The resulting heatmap is shown in Fig. 1b. As can be seen, the highest heatmap values correspond to busy intersections and streets with a high concentration of offices and restaurants (as informed by Google Maps). The heatmap values are then used as the re-weighting factor by which examples in each location bin are weighted.\nOne caveat, however, is that since pedestrians have right-of-way in intersections with crosswalks (commonly found in the NuScenes dataset), we expect pedestrian behavior in high-risk areas to be similar to their behavior in other areas (i.e. maintaining a steady speed across the road, as well as when walking down sidewalks). Vehicles, which have to watch for pedestrians and stop when one is crossing, significantly change their behavior in busy intersections. Therefore, we hypothesize that pedestrian performance in high-risk locations like busy intersections will remain rel-atively unchanged by this model, while vehicle prediction performance will improve due to the added risk information."}, {"title": "B. Non-Stationary Model", "content": "As expected, the Location-Risk Model improved vehicle performance on average and in high-risk locations. However, prediction of high speed vehicles (i.e. vehicles whose maxi-mum speed reaches > 14m/s) regressed (see Table I). Since high speed vehicles are a major source of risk, we aim to improve prediction of high speed vehicles while maintaining the boosted performance of vehicles in high-risk areas.\nTherefore, we analyzed the distribution of vehicle speeds in the training data (see Fig. 2c) and found that 27% of vehi-cles had a maximum speed of 0. One possible reason for this is that within the dataset preprocessing of Trajectron++ [8], vehicles with a total path length (i.e. distance traveled"}, {"title": "C. Location-Risk+Non-Stationary Model", "content": "Since removing stationary vehicles' effect on the loss in the Non-Stationary model showed improved performance on high speed vehicles (Fig. 3a), we combine the two models by both weighting stationary vehicles by 0, and weighting high-risk locations according to the heatmap in Fig. 1b. We hypothesize that this model will improve prediction for high speed vehicles as well as vehicles in high-risk areas."}, {"title": "IV. EVALUATION METRICS", "content": "Though the model was only trained to predict 3s into the future, we evaluate on predictions that are 1,2,3, and 4s into the future, as done in [8] to demonstrate ability to generalize.\nWe follow most methods using NuScenes (e.g. [8], [24], [25]) and use the final distance error (FDE) of the most likely predicted trajectory as our main evaluation metric, but unlike"}, {"title": "Location-Specific Metrics.", "content": "To show improvements in high-risk locations, we define the following location-type metrics: we split the range of heatmap weights (the risk measure ranging from 1 to 10) into quarters, as shown in Fig. 2b, and aim to assess performance on the examples whose heatmap weights fall into each quarter. Therefore, the first quarter would contain low-risk examples whose location weights are < 1.25 and the last quarter would contain high-risk examples with location weights of > 7.75. However, there are very few vehicles whose weights fall into the last quarter, and very few pedestrians with weights in the last two quarters. Evaluating on sets of examples with such low numbers could cause performance instability. Therefore, we define the following location-based risk metrics: vehicles whose heatmap weights fall into the first quarter are con-sidered 'low-risk', those whose weights fall into the sec-ond quarter are considered 'medium-risk', and those whose weights fall into the third and fourth quarters combined are considered 'high risk'. Similarly, pedestrians whose heatmap weights fall into the first quarter are considered 'low-risk', while those whose weights fall into the second, third, and fourth quarters combined, are 'high-risk,' (see Fig. 2c)."}, {"title": "Velocity-Specific Metrics.", "content": "Since the data is taken from both Boston, where the speed limit is 11 m/s [27], and Singapore, where the speed limit is 14 m/s [28], we use the maximum of these two speed limits and consider high speed vehicles to be those whose maximum speed throughout their history reaches above 14 m/s. Furthermore, since the baseline model may be biased towards stationary vehicles due to data leakage and low data diversity, we also report metrics on stationary and non-stationary vehicles separately. For this metric, we define stationary vehicles to be those whose path length from the first history to last future timestep is < 1m, and non-stationary vehicles to be all others.\nIn addition, we use color plots, as shown in Fig. 1, to demonstrate how the proposed models change the performance of examples in each location bin. For each bin, we average the performances of all vehicles in the test set whose current position lies within that bin, and subtract the per-location performance of baseline model from that of the Location-Risk model. As shown in the colormap, the colors range from FDE differences of -1 to 1 and show improvements in blue and regressions in red. FDE differences which are less or greater than -1 and 1 use the same shade of blue or red as -1 and 1."}, {"title": "V. RESULTS AND DISCUSSION", "content": "Stationary vs. Non-Stationary Performance. Since sta-tionary vehicles are much easier to predict than non-stationary vehicles, we report the performance of the baseline model on the two classes separately. As shown in Table I, stationary vehicles have much better performance than non-stationary vehicles, especially at larger timeframes like @3s and @4s, where the performance is more than 25 times better. This shows how much the performance can be skewed when a large portion of the data is stationary. Furthermore,"}, {"title": "A. Location-Risk Model", "content": "As hypothesized, the Location-Risk model improves vehi-cle predictions, especially in high-risk locations, but shows only a little improvement in pedestrian predictions, even in high-risk locations (Fig. 3). Both the vehicle FDE metrics in Table II and vehicle KDE metrics in Table III show that the Location-Risk model has better performance across the board compared to the baseline. These tables show that the Location-Risk model doesn't simply improve vehicle prediction in only high-risk locations at the expense of other examples; it provides additional information to the model that improves average prediction overall.\nThe Location-Risk model shows better FDE performance on both stationary and non-stationary vehicles (see Table I), as well as improvement in the percentage of Road Boundary Violations, an indicator of improved understanding of the map [29]. One possible explanation for these improvements is that applying higher weights on examples within risky locations may be helping the model to better understand the semantic map. By assigning more importance to locations with high-risk interactions, the model may be required to use more information from the map to learn to differentiate high-risk situations and better predict within them. This improved understanding of the map may give the Location-Risk model a better ability to differentiate between stationary and non-stationary vehicles, thereby improving the prediction of both.\nPedestrian performance, however, shows only slight im-provement in FDE (Table IV), and high-risk locations don't consistently show more improvement than low-risk locations (see Fig. 3). As hypothesized, this may be due to the fact that pedestrians with right-of-way may not change their behavior for vehicles as vehicles must for pedestrians.\nFinally, in order to better understand the Location-Risk model and ensure that it is risk-aware for both high-risk locations, and high-risk agents, we also evaluate the model on high speed vehicles, as shown in Table I, and find that the Location-Risk model shows worse performance on high speed vehicles for some metrics (at 2s and 3s). Therefore, we add an additional re-weighting component designed to improve performance of such examples."}, {"title": "B. Non-Stationary Model", "content": "Before combining the speed-based re-weighting compo-nent with the Location-Risk model, we first implement it on its own and compare its performance to all other models. When compared to the baseline model in Table I, the Non-Stationary model shows mostly regressions on stationary vehicle performance and across-the-board improvements on non-stationary vehicle performance (as to be expected), as well as small improvements to the high-speed vehicle per-formance. The graphs in Fig. 3a show a more nuanced story: although the average performance for speeds of > 14m/s doesn't show much improvement, this model significantly improves the performance of vehicles with a speed of > 20m/s. One caveat, however, is that there is very little data that falls into this extremely high speed category, which can cause performance instability between model iterations.\nOne surprising result shown by Table III is that the Non-Stationary model is the best-performing out of the three proposed methods on overall KDE metrics. Since KDE is a metric that measures multimodality as well as accuracy, this shows that the Non-Stationary model may be improving multimodality in predictions. These results indicate that the removal of stationary vehicles may induce the model to learn more about the diversity of possible trajectories."}, {"title": "C. Location-Risk+Non-Stationary Model", "content": "Combining the re-weighting schemes of the Location-Risk and Non-Stationary models shows slightly worse vehicle FDE and KDE performance on high-risk locations than the Location-Risk model alone, but the results are still an im-provement over the baseline across the board. Furthermore, this model shows better performance on non-stationary vehi-cles and high-speed vehicles than the Location-Risk model, showing that our goal of improving the performance of high-speed vehicles while maintaining improved performance on high-risk locations was achieved.\nMoreover, comparing the medium-risk improvements of the Location-Risk+Non-Stationary model to that of the Location-Risk model in Table II shows that the Location-Risk+Non-Stationary model yields even stronger improve-ments in medium-risk areas.\nFrom these evaluations, it can be seen that the Non-Stationary and Location-Risk methods complement each other to bring higher vehicle performance both within high-risk locations and for high-risk (i.e. high speed) agents. Pedestrian performance, on the other hand, is unchanged by the addition of the Non-Stationary model's re-weighting, as shown in Table IV. This is to be expected, as the re-weighting only applied to non-stationary vehicles."}, {"title": "VI. CONCLUSION", "content": "Although there are many studies which calculate risk based on current kinematic information of surrounding agents [16] or current semantic map information [10], there is very little work done on examining the training data to gain prior knowledge of where, location-wise, collisions are likely to occur [15]. Therefore, we employ this strategy to gain advance knowledge of the likely locations of close pedestrian-vehicle interactions, and use it to improve the model's understanding of pedestrian and vehicle behavior. Using these spatio-temporal priors generates better prediction within those areas, and helps the model to better utilize the semantic map it has been given. Furthermore, we show that a high number of stationary examples in the dataset biases the model, and that removing stationary examples' effect on the loss improves overall performance, and especially the perfor-mance of high-speed vehicles. The results of our Location-Risk+Non-Stationary model show improved performance on both high-risk locations and high-speed vehicles."}]}