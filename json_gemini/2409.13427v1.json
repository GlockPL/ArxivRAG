{"title": "A User Study on Contrastive Explanations for Multi-Effector Temporal Planning with Non-Stationary Costs", "authors": ["Xiaowei Liu", "Kevin McAreavey", "Weiru Liu"], "abstract": "In this paper, we adopt constrastive explanations within an end-user application for temporal planning of smart homes. In this application, users have requirements on the execution of appliance tasks, pay for energy according to dynamic energy tariffs, have access to high-capacity battery storage, and are able to sell energy to the grid. The concurrent scheduling of devices makes this a multi-effector planning problem, while the dynamic tariffs yield costs that are non-stationary (alternatively, costs that are stationary but depend on exogenous events). These characteristics are such that the planning problems are generally not supported by existing PDDL-based planners, so we instead design a custom domain-dependent planner that scales to reasonable appliance numbers and time horizons. We conduct a controlled user study with 128 participants using an online crowd-sourcing platform based on two user stories. Our results indicate that users provided with contrastive questions and explanations have higher levels of satisfaction, tend to gain improved understanding, and rate the helpfulness more favourably with the recommended AI schedule compared to those without access to these features.", "sections": [{"title": "I. INTRODUCTION", "content": "In a major survey for the explainable AI (XAI) community on relevant literature from social science, Miller [1] advocated an important theory on human explanations: that they are answers to contrastive why-questions of the form why P rather than Q? called contrastive explanations [2]. Although recent interest in XAI has largely focused on machine learning, there has also been parallel interest in XAI for AI planning, referred to as explainable AI planning (XAIP) [3]. Krarup et al. [4] recently introduced a definition of constrastive explanations for XAIP based on planning model restrictions. According to this definition, a contrastive question about plan \u03c0 for planning problem II forms a set of constraints on II yielding a restricted hypothetical planning problem \u03a0'. A contrastive explanation then is an answer to this question in the form of a comparison between \u03c0 and some hypothetical plan \u03c0' for I'. For example, a contrastive question \"why is action A used in state S, rather than action B?\" might have a contrastive explanation \"because using A in S permits the best plan (\u03c0) with lower cost than a plan (\u03c0') using B\u201d. A series of such questions and explanations forms an interactive dialogue between user and XAI where the general objective is to help the user better understand the original plan \u03c0and/or planning problem \u041f.\nThere is growing evidence that interactiveness is key to the success of XAI tools. For example, Rong et al. [5] conducted a meta-analysis of results from recent XAI user studies and concluded that interactiveness in particular has a positive effect on user trust, satisfaction, and comprehension. Indeed the work by Krarup et al. is closely related to an established concept in AI planning that relies heavily on interactiveness, known as planning as an iterative process [6]. In this setting, AI planning serves as a decision-support tool for requirements elicitation; it assumes that requirements are not fully specified but through an iterative process of AI planning, plan inspection, and planning model revision, humans can refine the model so as to fully specify their requirements. Although the objective of constrastive explanations is not necessarily to revise a model, it nonetheless remains a valid use case, e.g. given a contrastive explanation based on II and II', a user may decide that I' better reflects their requirements and thus choose to adopt it as their new planning model (becoming the subject of future contrastive questions). As such, contrastive explanations may be complementary to planning as an iterative process.\nIn this paper we study contrastive explanations in the context of an end-user application for the scheduling of smart homes, called Cuttlefish. This application assumes that users pay for energy according to dynamic energy tariffs, have access to high-capacity battery storage, and have the ability to sell energy to the grid. With dynamic tariffs, such as those offered by Octopus Energy in the UK, prices vary according to wholesale prices in timeslots of e.g. 30 minutes each. This allows consumers to reduce energy costs by shifting energy consumption from when prices are high to when prices are low. Consumers can further reduce energy costs by augmenting their home energy supply with high-capacity battery storage. This allows them to store low-cost energy for"}, {"title": "II. METHODOLOGY", "content": "We consider a variation on classical planning where appli- cable actions, transitions, and costs may vary over time and where plans have a fixed number of actions. A non-stationary finite-horizon planning problem, or an NF planning problem, is a tuple II = (S, A,h,E,T,C,G, $\u2081 ) where S is a set of states, A is a finite set of actions, h\u2208 N is a horizon, E = {Et | t = 1,...,h} with Et : S \u2192 24 the applicable action function at timestep t, T = {Tt | t = 1,...,h} with T\u2081: S\u00d7A \u2192 S the transition function at timestep t, C = {Ct | t = 1,...,h} with C\u2081 : A \u2192 R the cost function at timestep t, G \u2286 S is a goal, and s\u2081 \u2208 S is an initial state.\nWe say that E is stationary if E\u2081 =  = Eh, otherwise E is non-stationary. By abuse of notation, if E is stationary then we treat E as a function rather than a set. This terminology and notation extends to T and C similarly. We say that II is stationary if E, T, and C are stationary, otherwise II is non- stationary. A sequence of actions \u03c0\u2208 Ah is a plan if for each t = 1,...,h with st+1 = Tt(st, \u03c0t) then \u03c0\u03b9 \u2208 At(st) and Sh+1 \u2208 G. The cost of a plan \u03c0is C(\u03c0) = \u2211t=1 Ct(\u03c0\u03c4). \u0391 plan is optimal if there is no other plan with lower cost."}, {"title": "B. Problem formulation", "content": "We consider a home consisting of a single battery and zero or more appliances where the energy bill is determined by dynamic tariffs for importing and exporting of energy. When the battery discharges, the energy is consumed by any active appliance tasks while any surplus energy is exported to the grid. The objective is to find an optimal schedule for the home over a fixed time period that satisfies some user requirements on appliance tasks. We model this as an NF planning problem."}, {"title": "Definition 1.", "content": "A dynamic energy tariff is a tuple (h, P\u2081, PE): h\u2208Nis the horizon, P\u2081 : H \u2192 R is the import tariff, PE: H\u2192 R is the export tariff, where H = {1,...,h} is the set of timesteps."}, {"title": "Definition 1", "content": "permits negative import and export prices for any timestep t such that P\u2081(t) < 0 means the home is paid to import energy from the grid while PE(t) < 0 means the home is charged to export energy to the grid. Such prices are not necessarily permitted by real dynamic tariffs. The Agile tariff from Octopus Energy satisfies P\u2081(t) \u2264 35p/kWh and PE(t) \u2265 0p/kWh for each t."}, {"title": "Definition 2.", "content": "Let (h, P\u2081, PE) be a dynamic energy tariff. A battery specification is a tuple (\u03c9, \u03bb): \u03c9 \u2208 N is the capacity in timesteps, \u2208 R+ is the (dis)charge rate per timestep, where \u03c9\u00b7\u03bb is the energy capacity. A battery scheduling model is an NF planning model II:\n\u2022 S = {0,1,..., \u03c9}, A = {\u22121,0,1} such that for each s:\nDischarge -1 \u2208 E(s) if s \u2260 0 Off 0 \u2208 E(s)\nCharge 1 \u2208 E(s) if s \u2260\u03c9\n\u2022 T(s, a) = max{0, min{s + a,w}} for each s and a\n\u2022 For each t and a:\nC+(a) =\n{PE(t) a if a = -1\nP1(t)\u00b7\u03b1\u00b7 otherwise\n(1)"}, {"title": "According to Definition 2.", "content": "the battery serves as a finite- but-replenishable resource allowing homes on dynamic energy tariffs to earn by discharging to the grid. Due to Definition 1, the costs in Definition 2 are non-stationary and may be positive or negative. Note that Definition 2 is equivalent to the battery scheduling model from [7] but excluding the predicted home energy consumption parameter, or alternatively assuming that these predictions are always zero. The state space in Defini- tion 2 tracks the battery charge level as represented by non- negative integers. This choice simplifies implementation (e.g. by avoiding floating-points) but has no conceptual significance."}, {"title": "Definition 3.", "content": "Let (h, P\u2081, PE) be a dynamic energy tariff. An appliance specification is a tuple (\u03c9, \u03bb, R):\n\u2022 w \u2208 N is the task duration in timesteps\n\u2022 \u03bb\u2208R+ is the consumption rate per timestep\n\u2022 RC 2H \u00d7 N is a set of primitive requirements\nwhere w is the energy consumption per task, h is the horizon. An appliance scheduling model is an NF planning model II:\n\u2022 S = {0,1,...,\u03c9} \u00d7 (No)|R|\n\u2022 A = {0,1} such that for each t and s:\nOff 0 \u2208 Et(s) if $(1) \u2208 {0,w}\nOn 1 \u2208 Et(s) if w - s(1) \u2264 h - t\n\u2022 Tt(s, a) = s' for each s and a such that:\n$(1) =\n{$(1) + 1 if $(1) \u2260 w and a = 1\na otherwise\n(2)\nand for each ri \u2208 P:\nS'(2,1) =\n{S(2,1) +1 if $(1) = w and H' \u2286r (i, 1)\nS(2,1) otherwise\n(3)"}, {"title": "Definition 4.", "content": "Let (h, P\u2081, PE) be a dynamic energy tariff, \u041f\u044c be a battery scheduling model, and \u03a01,...,In be n appliance scheduling models. A home scheduling model is an NF planning model II:\n\u2022 S = SX S1 \u00d7 \u00d7 Sn\n\u2022 A = Ab \u00d7 A\u2081 \u00d7 \u00d7 An such that Et(s) = Eb,t(s) \u00d7 E1,t(s) \u00d7... \u00d7 En,t(s) for each t and s\n\u2022 Tt(s,a) = s' for each t, s, and a such that:\nBattery s = Tb,t(Sb, ab)\nAppliances s = Ti,t(si, ai) for each i\n\u2022 For each t and a:\nCt(a) =\n{PE(t)U(a) if U (a) < 0\nP1(t). U(a) otherwise\n(4)\nn\nU(a) = \u03b1\u03b3\u00b7 \u03bb\u03b9 + \u2211 (\u03b1\u1f31\u00b7\u03bb\u03af)\ni=1\n(5)\n\u2022 G = Gb \u00d7 G1 \u00d7 \uff65\uff65\uff65 \u00d7 Gn\n\u2022 S1 = ($(b,1), S(1,1),\u2026, S(n,1))"}, {"title": "According to Definition 4,", "content": "homes on dynamic energy tariffs can reduce energy costs through a combination of battery scheduling as in Definition 2 and the scheduling of n appli- ances as in Definition 3. In this way, the battery and appliances can be scheduled to make best use of the dynamic energy tariff while ensuring requirements over appliance tasks are satisfied. Note that in Definition 4 the battery and each appliance occupy disjoint dimensions of the state space. However, Equations 4\u2013 5 mean that in general the cost of a (joint) plan is not decomposable. This makes Definition 4 a multi-effector (or coordinated multi-agent) planning problem. Definition 4 can be seen as a variation on the battery scheduling model from [7] where the predicted home energy consumption is replaced with a decision problem about when to consume energy."}, {"title": "C. Contrastive explanations", "content": "The semantics of appliance scheduling models can also be understood by the following formalism."}, {"title": "Definition 5.", "content": "Let \u03a8 = (\u03c9, \u03bb, R) be an appliance specification and A = {0,1} be the set of appliance actions. Then is satisfied by a sequence of appliance actions \u03c0\u2208 Ah, denoted \u03a8 = \u03c0, iff there exists some X1, ..., Xm \u2286 \u0397 such that:\n\u2022 X\u2081 \u2229\u2229 Xm = 0\n\u2022 \u2200X\u2081,\u2203t \u2208 H, X\u2081 = {t, . . ., t + w}\n\u2022 Xi, t \u2208 Xi, \u03c0t = 1\n\u2022 \u2200r = (r(1), (2)) \u2208 R,\n|{i = 1, . . ., m : Xi \u2286 r(1) }| \u2265 (2)"}, {"title": "Corollary 1.", "content": "Let (\u03c9, \u03bb, R) be an appliance specification and II be its appliance scheduling model. Then \u03c0 is a plan for II iff (\u03c9, \u03bb, R) = \u03c0 for each \u03c0\u2208 Ah."}, {"title": "In Definition 5,", "content": "each Xi represents the set of timesteps of a task. The definition thus says that a sequence of appliance actions \u3160 satisfies an appliance requirement (H', m) if \u03c0 has at least m disjoint subsequences of length w, consisting only of on actions, occuring at timesteps from H'. Also, \u03c0 satisfies a set of appliance requirements R if a satisfies each requirement from R. Corollary 1 then says that this formalism is equivalent to a plan for the appliance scheduling model from Definition 3. According to Krarup et al. [4], a contrastive question about plan for planning problem II forms a set of contraints on II yielding a restricted planning problem \u03a0'. Formally, an NP planning problem II' is a restriction to an NP planning problem II if every plan for II' is also a plan for II."}, {"title": "Corollary 2.", "content": "Let (\u03c9, \u03bb, R) be an appliance specification and R' be a set of primitive requirements. Then (\u03c9, \u03bb, RUR') = \u03c0 iff (\u03c9, \u03bb, R) = \u03c0 and (\u03c9, \u03bb, R') |= \u03c0 for each \u03c0\u2208 Ah."}, {"title": "Corollary 2", "content": "implies that the addition of appliance require- ments to an existing appliance scheduling model II yields a new appliance scheduling model II' that is a restriction to \u03a0. This is the basis of contrastive explanations in Cuttlefish."}, {"title": "Definition 6.", "content": "Let \u03a8 = (\u03c9, \u03bb, R) be an appliance specification and R' be a set of primitive requirements. Then (\u03c0,\u03c0') is a contrastive explanation iff (\u03c9, \u03bb, R) = \u03c0 and (\u03c9, \u03bb, RUR') = \u03c0' where ((\u03a0, \u03c0), R') is the contrastive question."}, {"title": "Definition 6", "content": "says that, in Cuttlefish, a contrastive question about appliance schedule for appliance scheduling model II consists of a set of appliance requirements R' that are added to II yielding a restricted model \u03a0'. Then a contrastive explanation is a pair (\u03c0, \u03c0') where is the original schedule for II and \u03c0' is an alternative schedule for I'. Typically we assume that \u03c0 and \u03c0' are optimal. This definition then extends to n appliances in the obvious way. Note that we do not permit contrastive questions about the battery directly, since the battery is scheduled with respect to appliance requirements rather than its own requirements."}, {"title": "D. Software Architecture", "content": "The software architecture for Cuttlefish consists of three components outlined below. Energy price data was taken from the Agile tariff by Octopus Energy for the London region during the period 11\u201317 November 2019. This data is based on 30-minutes timeslots, which were mapped to 1-hour timeslots by ignoring the second datapoint each hour, e.g. 00:00-00:30 was mapped to 00:00\u201301:00, while 00:30\u201301:00 was ignored. All import prices were non-negative (min: 5.88, max: 35, mean: 11.46, SD: 5.94), as were export prices (min: 3.96, max: 17.68, mean: 6.51, SD: 2.77). The domain-dependent planner was based on a direct implementation of the model from Definition 4 except that costs were normalised to be non- negative. The planner uses a custom implementation of A* with a domain-dependent heuristic. The heuristic was chosen based on empirical observation of performance on the chosen price data, and primarily serves to prune states from which the goal is unreachable based on straightforward domain- dependent properties. Full details can be found in the source code. The three components are as follows:\n\u2022 cuttlefish-frontend is the user interface, accessed via a desktop web browser. It is implemented in JavaScript using React and various libraries including Chart.js.\n\u2022 cuttlefish-api is a web API that integrates with the database and provides all backend functionality required by the user interface. It is implemented in Python using the Falcon web framework and other libraries.\n\u2022 cuttlefish-backend is a system service implemented in Rust that monitors the database for new planning problems, attempts to solve those problems using the (integrated) planner, and records results in the database. A thread pool is used to process multiple planning problems concurrently (one per thread). For each problem, the planner has a fixed budget on runtime and visited states.\nDuring the study cuttlefish-frontend and cuttlefish-api were served through an Nginx reverse proxy. The thread pool was allocated 12 threads, while the planner was allocated a budget of 3 minutes and 8m states per problem."}, {"title": "E. Study Design", "content": "This section outlines the setup of our study. Participants were randomly assigned to the control group or the treatment group, denoted as CG and TG respectively; each presented with a different user interface: the CG only reviewed the recommend schedule, while the TG reviewed the recommend schedule, had options to ask questions, and received explanations.\nTwo characters were created to simulate diverse require- ments, named Alice (A) and Bob (B). A represents a working professional (working hours 9:00\u201317:00), while B represents a night-shift worker (23:00-9:00). B's schedule imposes more restrictions on time windows compared to A's, leading to increased complexity. For example, A has 2 days working from home, B has none; A uses 1 washer-dryer cycle per week, Buses 2 with once by Thurs. and once after. This design serves our objective of testing the potential of the XAI in- terface in differing requirements. The appliance specifications"}, {"title": "F. User Interface (Treatment Group)", "content": "The Cuttlefish web interface consists of the price chart (Figure 1a), the schedule charts, and the XAI sections (Figure 1b, including question and explanation features).\nPrice chart displays the dynamic price tariff in one-hour slots over a week. The purpose of the price chart is to inform users about price variations, helping them identify preferable time windows for appliance tasks. Users can access this chart by selecting a floating button on the left side of the interface."}, {"title": "Explanation feature", "content": "provides the contrastive explanation of two possible situations:\n\u2022 The new problem is solvable. \"The minimum cost satisfying the question is higher than the Cuttlefish AI schedule. Your total bill increases by C(\u03c0') \u2013 C(\u03c0) in pence (p).\"\n\u2022 The new problem is unsolvable, exceeded time limit, mem- ory or space budget. \"Unsolvable problem / Memory budget exceeded / Space budget exceeded. Please adjust your question and try again.\""}, {"title": "G. Recruitment", "content": "Participants were recruited using Prolific. Base compensa- tion was according to an hourly rate of \u00a38. The study was advertised with a suggested completion time, and participants were compensated according to the median time taken of the group. Participants who exceeded the suggested study time received a \u00a31 bonus. All participants were recruited"}, {"title": "III. RESULTS", "content": "We now evaluate key questions and present statistical anal- ysis regarding the understanding, satisfaction, and usefulness of the recommended schedule for the two characters. Then we analyse the free-text responses from the questionnaires.\nWe analyse three key questions answered by both groups in the questionnaire on understanding, satisfaction, and helpful- ness to compare the effectiveness of explanations. As shown in Figure 2, for both characters (A and B), the percentage of participants providing positive feedback (score > 5) is higher in the group with access to questions and explanations (TG) compared to the group without (CG). This suggests that the contrastive questions and explanations improved user expe- rience with different requirements of our study. The results indicate that the average scores in B are lower than in A, possibly due to increased complexity."}, {"title": "A. Quantitative analysis on questions", "content": "We conducted Welch's t-test on the Likert scale responses to the aforementioned questions. We used one-tailed test of the null hypotheses H0: the means of CG and TG are equal,"}, {"title": "B. Qualitative Analysis on Texts", "content": "In the free-text question, the participants are asked to (a) describe their understanding of the schedule under each character (both TG and CG); (b) describe the most difficult part in understanding the explanations (TG only). While the free-context questions were diverse in both length and topics, some themes and feedback were captured in the answers.\n1) Improvement in comprehension: In CG, many partici- pants (6 times for A and 13 times for B) questioned the appropriateness of individual task in the recommended sched- ule. Some (3 for A and 2 for B) disagreed with the use of the battery to be optimal, or believed a schedule costs less"}, {"title": "IV. DISCUSSION & CONCLUSION", "content": "In this paper, we have adopted contrastive explanations within an end-user application for temporal planning of smart homes. We developed a domain-dependent planner for multi- effector planning problems, along with a web-based interface that generates explanations answering contrastive questions about appliances by allowing users to add additional require- ments. We conducted a user study on our implementation, which demonstrated that our approach can improve users' ratings on understanding, satisfaction, and helpfulness of the schedule. Our findings allow us to conclude that our \u03a7\u0391\u0399 feature can enhance users' satisfaction with and acceptance of the recommended schedule. Future work will include further optimisation of efficiency of the planner and support for additional forms of \"why\u201d questions."}, {"title": "APPENDIX", "content": ""}]}