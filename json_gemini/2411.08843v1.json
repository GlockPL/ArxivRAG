{"title": "Data-driven Surface Solar Irradiance Estimation using Neural Operators at Global Scale", "authors": ["A. Carpentieri", "J. Leinonen", "J. Adieb", "B. Bonev", "D. Folini", "F. Hariri"], "abstract": "Accurate surface solar irradiance (SSI) forecasting is essential for optimizing renewable energy systems, particularly in the context of long-term energy planning on a global scale. This paper presents a pioneering approach to solar radiation forecasting that leverages recent advancements in numerical weather prediction (NWP) and data-driven machine learning weather models. These advances facilitate long, stable rollouts and enable large ensemble forecasts, enhancing the reliability of predictions. Our flexible model utilizes variables forecast by these NWP and AI weather models to estimate 6-hourly SSI at global scale. Developed using NVIDIA Modulus, our model represents the first adaptive global framework capable of providing long-term SSI forecasts. Furthermore, it can be fine-tuned using satellite data, which significantly enhances its performance in the fine-tuned regions, while maintaining accuracy elsewhere. The improved accuracy of these forecasts has substantial implications for the integration of solar energy into power grids, enabling more efficient energy management and contributing to the global transition to renewable energy sources.", "sections": [{"title": "1 Introduction", "content": "Surface solar irradiance (SSI) estimation and forecasting plays a crucial role in various applications, including renewable energy forecasting, agricultural planning, and climate studies. As the global push for sustainable energy sources intensifies, accurate prediction of solar irradiance becomes increasingly important for efficient integration of solar power into electricity grids [3-5].\nRadiative transfer models have traditionally been used for SSI estimation, accounting for complex atmospheric interactions. For example, Urraca et al. [6] evaluated global horizontal irradiance synonym for SSI - estimates from ERA5 and COSMO-REA6 against satellite-based radiative transfer models, emphasizing the need for accurate atmospheric data, including aerosol and cloud properties, to improve SSI estimates. The combination of satellite data with radiative transfer models has significantly enhanced their capabilities [5, 7]. Alongside advancements in traditional radiative transfer models [8], statistical and AI models have also been developed to further enhance the adaptability and speed of solar irradiance estimation approaches [9-11].\nThe output of radiative transfer models (i.e. SSI fields) have been widely used as input to statistical and AI-based forecasting models [12]. In fact, recent advancements in solar irradiance prediction have seen a shift towards AI-based models due to their ability to capture complex, non-linear relationships in meteorological data [13], outperforming previous methods (i.e. optical flow models) in short-time horizons [14, 15].\nWhile most current SSI forecasting models rely on satellite data and ground observations for accurate short-term forecasts, there is a growing need for SSI forecasting models capable of long-range predictions, commonly associated to lead times longer than few hours. In fact, by using satellite-based data as input, the models commonly forecast up to 6-hours in the future [16]. On the other hand, NWP and global AI weather models can produce forecast up to multiple days.\nIn [17], a global AI weather model was trained to forecast SSI, outperforming the ECMWF (European Centre for Medium-Range Weather Forecasts) HRES predictions in forecasting energy-related variables such as wind and SSI. However, training and validating global weather models is expensive and not easily scalable to cover different variables. We propose a model that addresses this gap with the following novel contributions:\n\u2022 Independence from satellite and ground observations: Unlike many existing models, our approach does not rely on real-time satellite or ground-based measurements, enabling long-range forecasts by depending only on atmospheric variables commonly forecasted by NWP and AI-based weather models.\n\u2022 Integration with Advanced Weather Models: Seamlessly incorporating numerical weather prediction (NWP) and AI weather models, leveraging advancements in weather prediction without needing to retrain or develop new weather models.\n\u2022 Enhanced Accuracy with Fine-Tuning: Utilizing ERA5 pre-training and fine-tuning on satellite-derived data to significantly improve accuracy.\nOur model delivers global, 6-hour average irradiance estimations at a high spatial resolution (0.25 degrees), supporting strategic energy planning and grid management. By combining physical models, satellite data, and AI techniques, we provide a comprehensive solution for global surface solar irradiance estimation, enhancing renewable energy forecasting and integration.\nThis paper is organized as follows: Section 2 provides a detailed description of the problem formula- tion, the data utilized, and the methods developed in our study. Section 3 presents the results obtained from our approach. In Section 4, we discuss the advantages and limitations of our approach and highlight potential opportunities for future research."}, {"title": "2 Data and Methods", "content": "The problem addressed in this work is formulated as follows: given the global atmospheric state $X_{t_i}$ and additional context variables $c_{t_i}$ at time $t_i$, our goal is to predict the accumulated SSI global field $Y_{t_i}$ over the period $[t_i \u2013 \\Delta, t_i]$ as described in Eq. (1) and Eq. (2).\n$Y_{t_i} = f(x_{t_i}, c_{t_i})$\n$\\qquad(1)$\n$Y_{t_i} = \\frac{1}{\\Delta} \\int_{t_i-\\Delta}^{t_i} s_t dt.$\n$\\qquad(2)$\nwhere $f$ is the function we want to simulate, $s_t$ is the instantaneous SSI at time t and $\\Delta$ is the target aggregation time period, which is set to six hours to cover the most common weather forecasts frequency [1, 18]. Additionally, by substituting $X_{t_i}$ with the atmospheric state forecasted by a weather forecasting model, we can generate a global SSI forecast. This close link with weather forecast models is advantageous, as it potentially allows to rapidly leverage progress in weather models for SSI forecast, in contrast to many existing SSI forecasting approaches that rely in part or entirely on data sources like satellite or ground based SSI observations."}, {"title": "2.1 ERA5", "content": "As input data for the model training, we used the ERA5 reanalysis dataset [19], which is the fifth generation of ECMWF atmospheric reanalyses of the global climate. ERA5 provides hourly estimates of a large number of atmospheric, land, and oceanic climate variables, covering the Earth on a 0.25\u00b0 grid and resolving the atmosphere using 137 vertical levels from the surface up to a height of 80 km.\nERA5 data are produced using ECMWF's Integrated Forecast System (IFS) Cy41r2, with 4D-Var data assimilation and 137 hybrid sigma/pressure (model) levels in the vertical reaching up to the top level at 0.01 hPa. Atmospheric data are available on these levels and they are also interpolated to 37 pressure, 16 potential temperature and 1 potential vorticity level(s).\nOur study focuses on SSI, represented by the ERA5 Surface Solar Radiation Downwards (SSRD) variable. SSRD represents the amount of solar radiation reaching the Earth's surface, expressed in Jm-2. It is accumulated over 1 hour and is a crucial parameter for various applications, including solar energy assessment, agricultural modeling, and climate studies. For simplicity, we transform the SSRD [Jm-2] values to SSI [Wm-2] estimates and use only SSI in the following.\nThe SSI in ERA5 is derived from a complex radiative transfer model that takes into account various atmospheric constituents, including clouds, aerosols, and gases. The accuracy of SSI estimates in ERA5 has been evaluated in several studies, such as [6], showing comparable performance to satellite-based products on daily-aggregated data when compared to in situ surface based observations of SSI.\nThe ERA5 SSI data are hourly accumulations whereas our dataset uses 6-hourly values. We averaged six consecutive 1-hour values to produce a 6-hourly value for SSI."}, {"title": "2.2 SARAH3", "content": "The SARAH-3 dataset, short for Surface Solar Radiation Data Set - Heliosat, Version 3 [20], is an advanced satellite-based dataset providing detailed information on SSI. Developed by the Climate Monitoring Satellite Application Facility (CM SAF) of EUMETSAT, SARAH-3 employs the cloud index method derived from the original Heliosat-1 algorithm [21]. This method calculates the effective cloud albedo (CAL) using the ratio between measured broadband reflectance, clear-sky reflectance, and maximum reflectance. The effective cloud albedo is then converted to a cloud index serving as input to a radiative transfer look-up table to retrieve the SSI.\nInstantaneous SSI from SARAH-3 is published with a two-week delay at a frequency of 30 minutes. The dataset spans several decades, providing consistent and continuous solar radiation data from 1983 onwards at 0.05\u00b0. It is centered at (0\u00b0N, 0\u00b0E) and covers 65\u00b0W to 65\u00b0E and 65\u00b0S to 65\u00b0N. The validation of SARAH3 against ground-based measurements from the Baseline Surface Radiation Network (BSRN) [20] confirms its high accuracy and reliability, making it a trusted source for solar radiation data.\nThe dataset comes on an equiangular grid at 0.05\u00b0 resolution. Given that the input variables (from ERA5) for our estimation model come at 0.25\u00b0, we downsampled the SARAH3 dataset to match the ERA5 grid. For the spatial downsampling, we made use of a convolutional kernel. The kernel takes into consideration the different grids by weighting less the edge 0.05\u00b0 pixels that fall in multiple 0.25\u00b0 pixels so that the sum of radiation flux is matched in the downsampled dataset. In the Supplementary Material, we present our validation results and show that the downsampled SARAH3 dataset shows higher accuracy compared to the original version on most of the BSRN locations at 6-hour resolution."}, {"title": "2.3 BSRN", "content": "The Baseline Surface Radiation Network (BSRN) is a global network of high-quality surface radiation monitoring stations implemented by the World Climate Research Programme (WCRP) in 1992 [22]. The network aims to provide continuous, long-term, and frequently sampled measurements (data sampling frequency on the order of one minute) of surface radiation with the highest possible accuracy. BSRN stations are equipped with precision instruments, including pyranometers, to measure various components of solar radiation such as global horizontal irradiance (SSI), diffuse irradiance, and direct normal irradiance. These measurements are conducted with strict adherence to standardized protocols for instrument calibration, data acquisition, and quality control procedures to ensure data consistency and reliability across the network. The BSRN data are widely used for climate research, satellite validation, and the study of long-term trends in surface radiation."}, {"title": "2.4 Solar Irradiance Diagnostic Model", "content": "The purpose of our diagnostic model is to provide a surface solar irradiance forecast exploiting the recent progress in numerical and AI-based weather predictions. The pool of available ERA5 variables is thus defined by the variables provided by the aforementioned forecast models. As reference, we take the 73 output variables defined in [1], which comprises 7 surface variables and 5 variables at 13 pressure levels. Differently from [1], the relative humidity r is replaced with specific humidity q, compatible with the new SFNO checkpoint [2].\nAccurate surface solar irradiance estimation requires consideration of several variables at multiple atmospheric layers, as well as surface and column integrated variables. Our specific choice of variables is motivated by the following considerations. While lower tropospheric levels (1000-850 hPa) are crucial due to their high water vapor and aerosol content [11, 23], mid and upper tropospheric levels also play significant roles in capturing cloud information and overall atmospheric structure. In fact, while lower levels contain most of the atmospheric water content, mid-levels (800-500 hPa) still hold a significant amount of water vapour [24]. On the other hand, upper levels (300-200 hPa) provide information on high-level clouds and cirrus, which can attenuate incoming solar radiation [11]. Given the importance of the different levels, we make use of more pressure levels closer to the surface (1000, 925, 850 hPa) and fewer levels at higher altitudes (700, 500, 300, 50 hPa) but still covering the full range of available pressure levels. For the different pressure levels, we retrieved the geopotential height z, the temperature t and the specific humidity q. It is important to note that temperature combined with specific humidity indicates the dew point and thus the potential for condensation and cloud formation. Moreover, we also make use of surface variables, specificallysurface temperature (T2m) and surface pressure (Sp), as well as of total column of water vapor (tcwv). The input variables are summarized in Table 1.\nBased on the precipitation estimation model developed in FourCastNet [25], our model architecture for SSI estimation is also based on Adaptive Fourier Neural Operators (AFNO) [26] as shown in Figure 2. However, with respect to the AFNO architecture presented in [25], we modify the patch embedding strategy and remove the learnable positional embeddings. The new patch embedding method implemented in our SSI estimation model uses convolutional layers, which wrap around the longitudinal axis, reflecting the spherical shape of the Earth [27]. This symmetrical patch embedding is done to reduce possible artifacts the AFNO can produce at the corners of the image and at the patch edges. Secondly, we remove the learnable positional embedding in order to permit the model to run on arbitrarily large images and replace it instead with sinusoidal embeddings of the latitude and longitude coordinate grids.\nIn our AFNO architecture (see Figure 2), data flow begins with the symmetrical patch embedder. This component maps each 4 x 4-pixel patch into a single latent vector. The input atmospheric state $x \\in \\mathbb{R}^{n\\times m\\times c}$ is initially symmetrically padded to $\\tilde{x} \\in \\mathbb{R}^{(n+p_n)\\times(m+p_m)\\times c}$. It is then transformed into a latent state $v \\in \\mathbb{R}^{(n+p_n) \\times (m+p_m) \\times 256}$. Here, $n$, $m$, and $c$ denote the longitude, latitude, and channel dimensions of the atmospheric state, respectively. For our specific use case at ERA5 resolution, these dimensions are 1440, 721, and 31, respectively. $p_n$ and $p_m$ represent the padding sizes for the longitude and latitude dimensions. The embedded representation $v$ is processed by 12 AFNO blocks and ultimately projected to the target shape. The AFNO blocks are as described in [25], as shown in Figure 2."}, {"title": "Training", "content": "We train our diagnostic model on 37 years of 1-hourly ERA5 data (1980\u20132016) and validated on one year (2017). The input variables are shown in Table 1, while the output variable is the shortwave surface downwelling radiation product aggregated to 6-hour temporal resolution as described in Section 2.1. The loss function is a weighted L2 loss as defined in Eq. (3).\n$L^{weighted} = \\frac{1}{N} \\sum_{i=1}^{N} w(\\phi_i) \\frac{(y_i - obs_i)^2}{\\sum_{i=1}^{N} w(\\phi_i)}$\n$\\qquad(3)$\n$w(\\phi_i) = cos(\\phi_i)$\n$\\qquad(4)$\nwhere $y_i$ and $obs_i$ are the prediction and ERA5 observation SSI values for the $i$ \u2013 th grid box. N is the number of grid boxes in the SSI field. The weights $w(\\phi_i)$ depend on the latitude $\\phi_i$ as defined in Eq. (4), where $\\phi_i$ ranges from -90\u00b0N to 90\u00b0N.\nThe training is governed by a a cosine annealing scheduler starting from a learning rate of $10^{-3}$ and run for 30 epochs on 32 NVIDIA A100 GPUs with batch size set to 128. We use the Adam optimizer [28]. The full model training took approximately 512 GPU hours."}, {"title": "Fine-tuning", "content": "To further enhance the accuracy of our SSI diagnostic model, we fine-tuned it on the satellite-based SARAH3 dataset. The main challenge of this was posed by the comparatively small domain of the dataset, which covers approximately 1/4 of the full globe. The finetuning is motivated by the higher accuracy provided by the SARAH3 SSI fields compared to ERA5 [6].\nOnce the model is trained on the ERA5 SSI product, we fine-tune the AFNO-based diagnostic model on the SARAH3 0.25\u00b0 dataset (2000\u20132016) for 10 epochs by using a masked L2 loss, which computes the residuals only on the SARAH3 domain. The fine-tuning is accomplished by starting training from the AFNOERA5 pre-trained weights and with a low learning rate of 5 \u00d7 10-5 and with a cosine annealing scheduler. The finetuning is again run on 32 NVIDIA A100 GPUs with batch size set to 128, taking approximately 80 GPU hours to complete."}, {"title": "3 Results", "content": "To differentiate the AFNO-based models trained on different datasets, we name AFNOERA5 and AFNOSARAH3 the AFNO-based models trained on the ERA5 and SARAH3 SSI datasets. AFNOf refers to AFNOERA5 finetuned on SARAH3.\nTo test the proposed global SSI diagnostic model, we compare it against two benchmarks models: a convolutional U-Net based on the Pix2Pix architecture [29] shown in Figure 2, and a point-wise estimation model built on a stack of multi-layer perceptron (MLP) blocks. Both benchmark models were trained on the same data and used the same training schedule as our AFNO architecture. The Pix2Pix UNet architecture consists of two convolutional encoding blocks, five ResNet layers and two convolutional decoding blocks. Each encoding block reduces the spatial dimension by a factor of 2. The U-Net latent space reflects the AFNO model embedding strategy for a fair comparison: every latent pixel correspond to a 4 \u00d7 4 input patch and is represented by a vector in $\\mathbb{R}^{256}$. On the other hand, the MLP-based model is composed of 5 MLP layers: the first layer embeds the input into the latent space and the last layer remaps the latent vector to one single scalar representing the aggregated SSI for one single pixel. A single MLP layer is composed by two linear layers and one ReLU activation function in between.\nFor the model validation we run the diagnostic models on 2018 ERA5 data at 6-hourly intervals (00:00, 06:00, 12:00, 18:00 UTC), which are commonly used to initialize most weather forecasting models. Model performance is measured on ERA5, SARAH3 and BSRN 6-hourly aggregated SSI observations. The validation on ERA5 is performed to measure the accuracy of the different architectures in learning the relationship between the input features and SSRD. ERA5 is the least accurate estimate [6] but covers the full globe. SARAH3 provides more accurate irradiance estimates but it is limited to the EUMETSAT geostationary satellite domain. Finally, BSRN pyranometers provide direct measurements but only on few locations from which we can have only sparse metrics. Moreover, BSRN data are point measurements, and some differences compared to spatially aggregated pixel or gridded data are to be expected [6]."}, {"title": "3.1 The need for large receptive fields", "content": "Our task involves the estimation of an aggregated variable over the past 6 hours. Differently from instantaneous estimation as done in [9], we need to predict previous atmospheric states in order to integrate them and retrieve the aggregated output. Clouds are the main irradiance blockers, so our task can be naively translated into predicting the cloud locations in the previous 6 hours based on the current model forecast state. Consequently, the model receptive field - the image region affecting the prediction of a single pixel - is important for capturing such advective cloud dynamics. In Figure 3, the three models are ordered based on their receptive field size. The MLP model works on the single-pixel level, making it difficult for the model to capture the variation of solar radiation in time, especially because it captures the solar zenith angle and the atmospheric state only for one location and for one timestamp in time. On the other hand, the convolutional model (Pix2Pix) has a receptive field of 25 \u00d7 25 pixels \u2013 7 \u00d7 7 from the encoder block plus 18 \u00d7 18 from the 5 latent residual blocks with two convolutional layers each \u2013, making it able to capture past atmospheric evolutions. The performance is further enhanced by the global receptive field of the AFNO model that perform global convolution by working in the Fourier Space.\nEven if AFNOERA5 and Pix2Pix models show similar error patterns (see Figure 3), AFNOERA5 outperforms Pix2Pix by 10.7% and 76% in terms of root mean squared error (RMSE) and bias, respectively."}, {"title": "3.2 Fine-tuning evaluation", "content": "Given the validation on daily aggregations performed in [6], satellite-based solar irradiance estimates (i.e. SARAH) are more accurate than reanalysis datasets (i.e. ERA5). In Table A.1, we confirm the results also for 6-hourly aggregation data. Moreover, we show that for such temporal frequencies, coarsening the resolution of the satellite-based dataset does not degrade the accuracy, but leads to slightly improved performance over most stations."}, {"title": "3.3 Ground evaluation", "content": "The most accurate measurements of SSI are retrieved by pyranometers located at ground weather stations. In particular, BSRN provides the most accurate surface solar radiation measurements due to their meticulous quality control. To validate against the ground stations, we picked the pixel surrounding the station and compared it to the station observations.\nDifferently from Table A.1, we validate the models on 2018 at 6-hour resolution, using 6-hour aggregated measurements at 00, 06, 12 and 18 UTC. Only BSRN stations with less than 10% of missing data are kept for the evaluation.\nAs reference, we use the ERA5 and SARAH3 metrics measured on the ground station locations. As described in Section 3.1, AFNO demonstrates to be the best performing architecture. Comparing to ground observations, AFNOERA5 and Pix2Pix show comparable skill as ERA5. The slight im- provement over the ERA5 dataset could be due to the fact that the model tend to predict smoother fields than the reference data (ERA5), thus reducing the error especially when ERA5 and ground observations largely disagree.\nOn stations located within the SARAH3 domain, SARAH3 shows higher accuracy (27.6% improve- ment over ERA5 in RMSE), as also demonstrated in [6] and Table A.1. In fact, the SARAH3-trained AFNO shows a slight improvement over the ERA5-trained version at the cost of a much worse accu- racy outside the SARAH3 domain. On the other hand, the fine-tuned version not only demonstrates higher accuracy compared to SARAH3 (see Figure 4) but also a significant improvement on ground stations: 8.2% lower RMSE compared to AFNOERA5. Moreover, AFNOf shows to be stable on locations outside the fine-tuning domain."}, {"title": "4 Conclusion", "content": "We present a novel model for global solar radiation estimation. By leveraging advancements in numerical weather prediction (NWP) and machine learning (ML) weather models, our model is able to provide stable medium-term SSI forecasts at a global scale. Moreover, our predictions are independent of real-time satellite and ground-based observations, which enables more reliable and extensive forecasts by depending only on the weather forecasting model output. By seamlessly integrating NWP and ML weather models, the framework enhances accuracy and reliability, thus enabling flexible deployment in various operational environments. Finally, we show how fine-tuning with satellite-derived data significantly improves the model's performance, especially in specific regions.\nDelivering 6-hourly aggregated SSI estimates on a global scale, our model supports strategic energy planning and grid management, potentially impacting the efficient integration of solar energy into power grids, aiding the global transition to renewable energy sources. As such, future research should focus on refining these techniques and expanding the model's capabilities to enhance renewable energy forecasting even further."}, {"title": "Code & Data Availability", "content": "The ERA5 dataset is available and freely accessible at: https://cds.climate.copernicus.eu/. The Heliosat SARAH3 dataset is available at: https://wui.cmsaf.eu/. The BSRN ground stations dataset is available at: https://bsrn.awi.de/. For the model development, training and validation, we refer to the Modulus open-source repository: https://github.com/NVIDIA/modulus."}, {"title": "A Supplementary Material", "content": "This section presents a detailed comparison of SSI data from ERA5 and SARAH3 against observations from the BSRN stations covered by the SARAH3 domain. We focus on evaluating the accuracy of these datasets using key metrics such as Root Mean Square Error (RMSE), Mean Absolute Error (MAE), and Bias. We compared only 6-hourly aggregated SSI measurements relevant for our application and compatible with most of weather forecasting models temporal resolution. The observations are retrieved for all the stations falling inside both domains and for the (2015, 2016) period.\nThe results indicate that SARAH3 generally exhibits superior performance compared to ERA5 across most BSRN locations as showed in Table A.1. Specifically, SARAH3 achieves lower RMSE values, suggesting enhanced predictive accuracy. The downsampled SARAH3 dataset at 0.25\u00b0 resolution often outperforms the original 0.05\u00b0 resolution, except at the tam location, where the original resolution shows better results.\nIn terms of MAE, SARAH3 consistently demonstrates lower values than ERA5, further confirming its higher accuracy in estimating solar irradiance. However, ERA5 tends to have smaller absolute bias values and SARAH3 maintains a consistent positive bias across several stations.\nThe comparison between different resolutions of SARAH3 reveals that the coarser 0.25\u00b0 resolution marginally improves upon the 0.05\u00b0 resolution in both RMSE and MAE at most sites. This suggests that the downsampled version effectively balances spatial detail with accuracy.\nThe performance of these datasets varies geographically. Notably, the iza station, located in Iza\u00f1a, Canary Islands, exhibits significantly higher errors for both datasets. This can be attributed to its high altitude (2373 meters) and unique climatic conditions that pose challenges for accurate solar irradiance estimation."}]}