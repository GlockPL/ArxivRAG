{"title": "Inverse Deep Learning Ray Tracing for Heliostat Surface\nPrediction", "authors": ["Jan Lewena", "Max Pargmann", "Mehdi Cherti", "Jenia Jitsev", "Robert Pitz-Paal", "Daniel\nMaldonado Quinto"], "abstract": "Concentrating Solar Power (CSP) plants play a crucial role in the global transition towards sus-\ntainable energy. A key factor in ensuring the safe and efficient operation of CSP plants is the\ndistribution of concentrated flux density on the receiver. However, the non-ideal flux density\ngenerated by individual heliostats can undermine the safety and efficiency of the power plant.\nThe flux density from each heliostat is influenced by its precise surface profile, which includes\nfactors such as canting and mirror errors. Accurately measuring these surface profiles for a large\nnumber of heliostats in operation is a formidable challenge. Consequently, control systems often\nrely on the assumption of ideal surface conditions, which compromises both safety and opera-\ntional efficiency.\nIn this study, we introduce inverse Deep Learning Ray Tracing (iDLR), an innovative method\ndesigned to predict heliostat surfaces based solely on target images obtained during heliostat cal-\nibration. Our simulation-based investigation demonstrates that sufficient information regarding\nthe heliostat surface is retained in the flux density distribution of a single heliostat, enabling deep\nlearning models to accurately predict the underlying surface with deflectometry-like precision for\nthe majority of heliostats. Additionally, we assess the limitations of this method, particularly in\nrelation to surface accuracy and resultant flux density predictions. Furthermore, we are present-\ning a new comprehensive heliostat model using Non-Uniform Rational B-Spline (NURBS) that\nhas the potential to become the new State of the Art for heliostat surface parameterization. Our\nfindings reveal that iDLR has significant potential to enhance CSP plant operations, potentially\nincreasing the overall efficiency and energy output of the power plants.", "sections": [{"title": "1. Introduction", "content": "In order to enhance the economic viability of solar tower power plants, it is crucial to enhance\ntheir efficiency. A viable approach for achieving this is through the optimization of the flux\ndensity distribution on the receiver. In commercial plants this can be done by optimal aimpoint\ncontrol. e.g. using the ant-colony optimization meta-heuristic [1, 2] or deep learning models [3]\nto calculate a flux density for each heliostat using ray tracing and optimize in a next step the flux\ndensity distribution on the receiver as a superposition of those. Moreover, using the knowledge\nabout the focal spot shape and its position on the receiver even higher efficiency gains can be\nachieved. Even simple assumptions can increase the energy output by up to 20% [4]. However,\nin commercial power plants aimpoint distribution is mostly static or just to mitigate temperature\npeaks and gradients that may cause material wear, e.g. by using the Vant Hull algorithm [5, 6].\nThis can be explained by the fact that exact information about the heliostats is not easily ac-\ncessible. Inherent mirror errors and uncertainties about the heliostat's precise geometry model\ncontribute to the individuality of each heliostat's flux density shape and the tracking error.\nThe mirror error is constituted of roughness, slope, and canting errors. The roughness, arises\nfrom sub-micrometer flaws on the reflective surface. Slope error measures the deviations of\nthe mirror surface from its ideal shape. Canting error, on the other hand, reflects misalignment\namong mirror facets. Among these errors, slope and canting are particularly crucial for the flux\ndensity [7, 8, 9]. A precise knowledge about the heliostats mirror error can be loaded in a ray\ntracing environment to predict the flux density of the heliostat under certain environmental con-\nditions accurately [10, 11].\nThe most prominent and state-of-the-art method for obtaining specific surface profiles of he-\nliostats is deflectometric measurement [11, 12]. This method involves capturing camera images\nof stripe patterns with diverse frequencies projected onto a Lambertian target and subsequently\nreflected from the heliostat. However, this approach faces obstacles in the heliostat field due to\nfactors such as dew, wind, and that the measurement has to be conducted at night with long expo-\nsure times. Alternatively, some methods utilize a laser [13, 14], while others employ photogram-\nmetry [15, 16, 17, 18, 19] or flux mapping [20]. However, up for today these measurements are\nunreliable or cost intensive. For a complete review the reader is referred to [9]."}, {"title": "2. Workflow of inverse Deep Learning Ray Tracing", "content": "The primary measurements executed at CSP plants are target images employed for calibration\nwith the Camera-Target Method [26], offering a direct observation of a heliostat's flux density.\nThe flux density shape is caused by the precise heliostat surface characteristics and known pa-\nrameters such as sun and heliostat positions, and hence the flux density contains information\nabout the surface. However, predicting surfaces from the heliostat's flux density is highly ill-\nposed and underdetermined due to facets canting and the overlap of reflected and scattered rays\non deformed heliostat surfaces and hence highly challenging.\nThis study aims to use deep learning models to predict the heliostat surface using the heliostat's\ntarget images as input. This approach is the inverse direction to physical ray tracing and hence\nwe term the method inverse Deep Learning Ray Tracing (iDLR). Figure 1 shows the integration\nof iDLR in the routine power plant operation. Deep learning models have the capability to learn\ntypical surface deformations constrained by material properties and mechanical construction of\nthe mirror surface. This unique ability enables them to predict heliostat surfaces even within the\nunderdetermined regime, leveraging the surface information learned during training. With this\ncapability iDLR should perform better in this underdetermined problem than comparable physi-\ncal algorithms like differentiable ray tracing [21]."}, {"title": "2.1. Comprehensive NURBS Heliostat Model", "content": "We employ a heliostat model proposed by Pargmann et al. [21], which integrates a traditional\ngeometric model with an innovative spline approach to parameterize the reflecting surface of\nthe heliostat. Current state-of-the-art (SOTA) methods represent heliostat surfaces as a point\ncloud of normal vectors [11], providing precise representation but at the cost of a high number of\nparameters. For instance, the deflectometry used at the Solar Tower J\u00fclich predicts approximately\n80,000 normal vectors per facet (1.6 m \u00d7 1.25 m). This presents a challenge for training deep\nlearning models due to the high computational resource demands and the potential decrease in\nmodel precision from the large number of free parameters.\nPargmann et al. [21] employ a differentiable Non-Uniform Rational B-Spline (NURBS)\nwithin a differentiable ray tracing routine (code published at [31]) as a trainable parameter to\nfit a heliostat surface to a given flux density. NURBS are the industrial standard to represent\ncomplex geometries with few parameters in Computer-Aided Design (CAD) [32]. We adapt this\nmethod by fitting the NURBS parameter against the normal vectors from the deflectometry mea-\nsurement through a gradient-based optimization process. The NURBS parameter subsequently\nserves as a representation of the heliostat surface.\nInitially, we reduce the number of NURBS parameters. By using one NURBS per facet,\nfixing the xy-position of each control point on a predefined grid, and setting the NURBS weight\nto zero, the heliostat surface is parameterized by only 4x8x8 z-control points. These z-control\npoints are then fitted using the differentiable formulation of Pargmann et al. [21] and gradient\ndescent against the normal vector cloud of the deflectometry measurement. As a result, the\nz-control points of the NURBS surface act as a comprehensive representation of the heliostat\nsurface, reducing the number of free parameters from nearly 1 million to just 256-a reduction\nof 99.97%. This significantly enhances the efficiency of training machine learning models that\ninvolve heliostat surfaces. Furthermore, the NURBS representation is drastically more memory\nand computationally efficient than the normal point cloud. A single deflectometry measurement's\nnormal vectors occupy 8.6 MB, while the NURBS representation requires only 7 KB, a reduction\nof 99.91%."}, {"title": "2.2. Data Acquisition and Augmentation", "content": "The utilized dataset comprises stripe pattern deflectometry measurements conducted at the\nSTJ, encompassing a total of 458 heliostat surfaces. A split into training data (428), validation\n(32) and testing data (32) was made, ensuring the exclusion of surfaces from validation and test-\ning heliostats in the model training. For each heliostat, the z-control points of the NURBS were\ncomputed as detailed in Section 2.1 and act as surface representation. As there is a constant\nunknown offset for the surface of each facet, the mean value of the surface from each facet was\nset to zero.\nThe dataset comprises an unusually extensive collection of deflectometry data. Despite its size,\nit remains relatively small for effectively training a neural network. To address this limitation,\ntwo types of data augmentation were applied. Firstly, the heliostat surface was rotated by 180 de-\ngrees. Secondly, the weighted average between two randomly selected surfaces was calculated\nusing $Z_{augm} = a * Z_1 + (1 \u2212 a) * Z_2$ with $a \u2208 (0, 1)$. This approach ensures training on a diverse arti-\nficial dataset, avoiding the use of surfaces with unrealistic features given the physical constraints"}, {"title": "2.3. Model and Training", "content": "The nature of the problem suggests the adoption of an Encoder-Decoder architecture (see Figure\n3). For the decoder, we employ the StyleGAN2 architecture [33] which is highly successful in\ngenerating data of a certain domain. The encoder is tasked with fusing two distinct input data\nstreams: the eight flux densities, parameterized as an 8x64x64 tensor, and scalar data containing\nthe corresponding sun positions and the position of the heliostat in the field. The input flux den-\nsities undergo processing by a convolutional encoder, while weight demodulation, as elucidated\nin Karras et al. [33], is employed to integrate the scalar information. The number of channels is\nkept constant by 256 in the encoder. The latent space size is 3*32 using the extended w+ latent\nspace of the styleGAN2 architecture introduced by Richardson et al. [34]. The latent surface\nrepresentation in the latent space is fed in the decoder which generates a cartesian representation\nof the surface spline. The total number of trainable parameter is 3.5 million.\nThe model underwent training utilizing the semi-artificial dataset detailed in Chapter 2.2 for\na total of 50 epochs. By using also less than eight input flux densities and sun positions during\nthe training we ensure that the model can predict surfaces for any number of input flux densities\nup to eight."}, {"title": "3. NURBS for Surface Representation: Quality and Computational Efficiency", "content": "To assess the quality of the NURBS parameterization, we compare it to the deflectometry\nnormal vector point cloud. Figure 4a compares the normal vectors from deflectometry measure-\nments with those from the NURBS surface, demonstrating minimal differences and underscoring\nthe accurate parameterization of the heliostats' normal vectors using the 4x8x8 NURBS z-control\npoints. In Figure 4b, the surface deviation of the heliostat from the ideal assumption is depicted,\nwith a conventional integration-based algorithm estimation on the left and the NURBS parame-\nterization on the right. The strong alignment between both underscores the robust parameteriza-\ntion achieved with the NURBS parameters. To quantify the quality of the NURBS parameteri-\nzation, we calculate the angular deviation between the normal vectors from the NURBS spline\nand the deflectometry measurements. 81% of the NURBS normal vectors have an angular devia-\ntion of zero mrad from the original deflectometry normal vectors within machine accuracy. The\nremaining 19% form an extremely skewed tail, with the largest outlier being 10.2 mrad. While\nthe majority of the normal vectors are fitted perfectly, the outliers have mainly three causes:\nthe NURBS normals must be smoother than the original, sharp edges in the contour lines are\nrounded, and at the boundary of the facets, the NURBS parameterization becomes slightly less\naccurate due to boundary effects.\nNext, we compare the flux density predictions based on the normal vector cloud and the"}, {"title": "4. Results", "content": "4.1. Surface Prediction\nIn Figure 6a, ten randomly selected surface predictions by iDLR are shown, whereby seven sim-\nulated flux densities were used as an input. The mean absolute error per control-point (MAE)\nbetween the predicted surface and the deflectometry-derived surface has a median of 0.14 mm\nwith (Mininmum/Quantile 1/Quantile 3/Maximum) of (0.07/0.12/0.17/0.7) mm. For comparison\nthe typical surface deviation falls within the range of -2 mm to 2 mm, but exhibiting consid-\nerable variability among heliostats. As illustrated in Figure 6a, a strong alignment is evident"}, {"title": "4.2. Flux density prediction", "content": "In the subsequent phase, the predicted surfaces serve as a basis for forecasting flux densities of\nheliostats using ray tracing. Randomly selected flux density predictions are visualized in Figure\n6b and compared to the ideal heliostat assumption. A high match between the flux densities\nevoking from iDLR and deflectometry surfaces is visible across all shown heliostats. Remark-\nably, this does not only hold for the heliostats with accurate surface prediction (compare Figure\n6a) but also for those with a poor surface reconstruction (the third heliostat from the left). This"}, {"title": "5. Discussion", "content": "The results obtained through simulation underscore the significant ability of iDLR. The method\ndemonstrates its capability to predict heliostat surfaces with high accuracy using simulated flux\ndensities, despite the inherently undetermined and ill-posed nature of the inverse problem. While\nthe majority of the reconstructed surfaces closely align with the deflectometry ground truth (me-\ndian MAE of 0.14 mm with (Min/Q1/Q3/Max) of (0.07/0.12/0.17/0.7) mm), it is important to\nacknowledge a potential drawback: there exists a risk of less accurate surface predictions com-\npared to deflectometry measurements for a minority of heliostats. This is particularly evident for\nheliostats with a small amount of input flux densities and those in close proximity to the tower,\nwhere surface predictions may exhibit deviations from deflectometry ground truth. This discrep-\nancy arises due to the influence of canting errors and surface deformation, leading to changes\nin the mean normal vector of facets. The impact of these factors on flux density is stronger for\nheliostats located further away from the tower, providing more information about those surface\ndeviations. However, this relationship does not hold for surface errors with higher frequency\nheliostat surface features, such as waviness. With higher distances to the tower, the features in\nthe flux density caused by waviness diminishes and the flux density becomes more smooth. No-\ntably, the model demonstrates the ability to predict higher frequency heliostat features even for\nheliostats at greater distances, indicating the utilization of learned static material constraints to\nmake accurate predictions rather than relying solely on conserved information in the flux density.\nIn contrast to the singular existing alternative for heliostat surface prediction from target images,\nthe differentiable ray tracer proposed by Pargmann et al. [21], our findings demonstrate substan-\ntial improvement. While the differentiable ray tracer can only predict the surface for one singular\nheliostat with pronounced, artificially introduced surface deformations, iDLR is able to predict a\nwide range of measured, realistic heliostat surfaces. The problem of the differentiable ray tracer\nlies in the underdetermined nature of the problem as it does not acquire any preknowledge about\nthe physical constraints of the surface deformations. Our approach successfully navigates this\nchallenge by learning the physical constraints of the heliostat surfaces, thereby narrowing the\nsolution space and enabling precise predictions despite the inherent underdetermination and ill-\nposed characteristics of the problem. Furthermore, iDLR predictions come at real time while\nthe predictions of differentiable ray tracing is depended on the number of epochs and number\nof input flux densities, resulting in computation times in the range of a few minutes up to some\nhours per heliostat.\nOn the other side, we identified three drawbacks of iDLR. Firstly, while the model yields real-\ntime predictions, its training process is notably time-intensive. The execution of ray tracing and\nsubsequent flux density processing consumes approximately 0.1 seconds per iteration. Conse-\nquently, the generation of the training dataset demanded approximately 45 hours of computation\non a single GPU (NVIDIA A100). Subsequent training and testing of the model on the same GPU\nrequired additional 12 hours. Despite this initial investment in time, the eventual computational\ncosts are anticipated to be outweighed by iDLR's real-time inference capabilities, rendering it\nsuperior to optimization-based algorithms like differentiable ray tracing over already short peri-\nods of usage. Secondly, to achieve accurate surface predictions, the model necessitates training\non realistic heliostat surfaces, which can be obtained through measurement or simulation. While\nsurface measurement incurs associated costs, it's noteworthy that each power plant intending to\nimplement iDLR need not possess a measurement setup; rather, only one setup per heliostat type\nis requisite at any power plant or even at the manufacturer side. Alternatively, circumventing\nthe necessity for heliostat surface measurements, finite-element simulation of heliostats could\nbe employed to predict potential deformations induced by construction-induced stress. Simple\nsurface simulation, that do not consider physical factors like adding gaussian deformations to the\nideal heliostat, were tried out and it was found that the trained model has problems to predict\nreal heliostat surfaces from the simulated flux densities, as it does not learn the heliostat surface\nspace with its physical constraints. Lastly, the model may encounter challenges in accurately\npredicting particularly rare or unique surface deformations that substantially deviate from those\nencountered during its training phase. Such out of distribution predictions pose a notable hurdle,\nnecessitating ongoing refinement and adaptation of the iDLR framework.\nThe minimum requisite quantity of measured heliostat surfaces for model training is contingent\nupon two primary factors. Firstly, it relies on the diversity present in surface deformations, as\nthe iDLR model necessitates comprehending a broader surface space, thereby requiring a larger\ndataset for effective learning. Secondly, it is influenced by the generalizability of a distinct set\nof deflectometry measurements. Biases often manifest within datasets, such as an overrepresen-\ntation of deflectometry measurements from heliostats situated in close proximity to the tower,\nowing to the ease of application in these areas. Given the likely existence of correlations be-\ntween mirror error and heliostat position (e.g. larger canting errors occurring at closer positions),"}, {"title": "6. Conclusion", "content": "We have introduced inverse Deep Learning Ray Tracing (iDLR), an innovative and cost-effective\nmethodology for predicting heliostat surfaces from target images, employing deep learning to\nsolve the inverse direction to ray tracing. The simulation results indicate that iDLR holds con-\nsiderable promise as an in-situ approach for predicting heliostat surfaces from target images.\nThe predicted surfaces demonstrate competitive accuracy compared to deflectometry surfaces\nfor the majority of heliostats, all while incurring minimal costs. Integrating the predicted surface\ninto ray tracing aim-point optimization strategies has the potential to enhance the flux density\ndistribution on the receiver, thereby optimizing the overall efficiency of power plant operations."}]}