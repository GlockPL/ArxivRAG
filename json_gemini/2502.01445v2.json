{"title": "SPFFNet: Strip Perception and Feature Fusion Spatial Pyramid Pooling for Fabric Defect Detection", "authors": ["Peizhe Zhao"], "abstract": "Defect detection in fabrics is critical for quality control, yet existing methods often struggle with complex backgrounds and shape-specific defects. In this paper, we propose an improved fabric defect detection model based on YOLOv11. To enhance the detection of strip defects, we introduce a Strip Perception Module (SPM) that improves feature capture through multi-scale convolution. We further enhance the spatial pyramid pooling fast (SPPF) by integrating a squeeze-and-excitation mechanism, resulting in the SE-SPPF module, which better integrates spatial and channel information for more effective defect feature extraction. Additionally, we propose a novel focal enhanced complete intersection over union (FECIoU) metric with adaptive weights, addressing scale differences and class imbalance by adjusting the weights of hard-to-detect instances through focal loss. Experimental results demonstrate that our model achieves a 0.8-8.1% improvement in mean average precision (mAP) on the Tianchi dataset and a 1.6-13.2% improvement on our custom dataset, outperforming other state-of-the-art methods.", "sections": [{"title": "I. INTRODUCTION", "content": "Traditional fabric defect detection [1-3] relies heavily on visual inspection by human experts, a process that is time-consuming, labor-intensive, and prone to errors, particularly when defects are small or contrast is low. This method often produces subjective and difficult-to-quantify results, leading to high defect rates and unreliable assessments. As a result, computer vision-based defect detection algorithms [4-10] have begun to emerge and develop. However, general object detection algorithms struggle with the complex backgrounds of fabric defects and their varied aspect ratios. Thus, adapting to the large-scale variations of fabric defects and distinguishing complex backgrounds are key challenges in improving the performance of fabric defect detection.\nModern fabric defect detection algorithms are generally divided into two categories: two-stage and single-stage methods. The two-stage method, such as Cascade Region-based Convolutional Neural Networks (Faster R-CNN) [11], improves accuracy and speed through cascaded detection. However, it may struggle with detecting multiple defects or misidentifying them. Similarly, the Convolutional Neural Network-based Mobile-Unet method [12] faces similar limitations. Recently, diffusion models have also gained attention in various vision tasks, including fabric defect detection, due to their ability to generate high-quality outputs and handle complex visual patterns. For instance, IMAGPose [13] and IMAGDressing [14] have demonstrated the potential of diffusion models for pose-guided image synthesis and customizable virtual dressing. Additionally, advancements in progressive conditional diffusion models [15] and rich-contextual conditional diffusion models [16] have shown promise in enhancing the consistency and realism of generated images, offering a potential direction for fabric defect detection in more complex scenarios.\nThe single-stage method, derived from the YOLO [17] framework, has shown promise. For example, the enhanced YOLOv3 [18] model [19] improves detection through an attention mechanism and negative sample weighting but remains insufficient for accurately detecting complex defect types. The YOLOv5 [20] algorithm [21] enhances feature representation by combining adaptive pooling with an attention module and optimizing the loss function. However, its accuracy remains limited in handling specific defect types and complex scenarios.\nIn response to these challenges, we propose a fabric defect detection model based on the improved YOLOv4 [22] model. While retaining the speed advantages of single-stage models, we introduce a Strip Perception Module (SPM) that incorporates multi-scale convolution to significantly enhance the models feature capture and extraction capabilities for strip defects. To improve the ability to distinguish between complex backgrounds and defects, we propose an enhanced Squeeze-and-Excitation Spatial Pyramid Pooling Fast (SE-SPPF), which fully integrates spatial and channel features. Additionally, to address the wide range of target box scales for different defect types, we introduce the Focal Enhanced Complete Intersection over Union (FECIoU) metric. This novel approach dynamically adjusts weights for difficult-to-detect instances, improving the model's adaptability to target boxes with large aspect ratios.\nThe key contributions of this paper are as follows:\n\u2022 A multi-scale convolutional SPM is introduced into the YOLOv4 backbone to improve feature capture and extraction for strip defects.\n\u2022 SE-SPPF is proposed to enhance the models ability to distinguish complex backgrounds and targets by combining weighted channel maps with spatial pyramid pooling."}, {"title": "II. RELATED WORK", "content": "Modern fabric defect detection methods are mainly divided into two categories: two-stage and single-stage approaches. The two-stage methods, such as Faster R-CNN [11], utilize cascade detection to improve accuracy and speed. However, they may struggle with detecting multiple defects in a single fabric sample. The CNN-based Mobile-Unet [12], which replaces U-Nets encoding block with MobileNetV2, achieves impressive accuracy (99.75% on YID, 98.80% on FID), but still faces limitations in handling various defect types. Single-stage methods, particularly those based on the YOLO framework, have gained popularity. Enhanced YOLOv3 [18] improves fabric defect detection by adding an attention mechanism and negative sample weighting [19]. While effective, it still underperforms in detecting complex defects. YOLOv5 [20] improves feature representation through adaptive pooling and an attention module [21], but faces challenges in complex scenarios. To address these issues, we propose an improved YOLOv4-based model with a Strip Perception Module (SPM) that enhances feature extraction for strip defects, retaining the speed advantage of single-stage detection."}, {"title": "B. Attention Mechanism", "content": "The attention mechanism [23, 24] enhances model performance by focusing on relevant spatial, channel, or hybrid features. Spatial attention methods like SAM [25] and RANet [26] prioritize key regions in the spatial domain, improving the capture of spatial dependencies. RANet uses a relation module to model feature interactions, leveraging attention or graph convolutions. Channel attention, exemplified by SENets [27], introduces a squeeze-and-excitation (SE) block that reweights feature channels to highlight important features. This mechanism improves representational power without significantly increasing computational cost. For fabric defect detection, we propose an enhanced spatial pyramid pooling fast (SE-SPPF) that integrates SENetv2 [28] for better multi-scale feature fusion, addressing the complexity and variation of defect shapes."}, {"title": "C. Loss Function", "content": "In object detection, the loss function quantifies the difference between predicted and ground truth bounding boxes. Intersection over Union (IoU) [29] is commonly used to measure this overlap. The IoU loss encourages the model to align predicted boxes with ground truth. The Generalized IoU (GIoU) [30] extends IoU by addressing scale and offset mismatches, providing more reliable localization, but it can be ineffective for boxes with significant overlap. Distance IoU (DIoU) [31] refines GIoU by incorporating centroid distance, improving localization accuracy. However, DIoU does not account for size variations between objects. Complete IoU (CIoU) [31] incorporates centroid distance, overlap area, and angular difference, making it more effective for rotated boxes. However, for fabric defect detection, where target aspect ratios vary significantly, basic IoU can lead to errors. To address this, we propose an improved version of CIoU (FECIoU), which adjusts for scale differences and enhances detection accuracy for targets with varying aspect ratios."}, {"title": "III. PROPOSED METHOD", "content": "This paper presents a fabric defect detection method based on YOLOv11, addressing the challenges of complex defect shapes and the need for high detection accuracy and real-time performance. The proposed method incorporates a strip perception module (SPM) and a squeeze-and-excitation spatial pyramid pooling fast (SE-SPPF). As shown in Fig.1, this approach enhances YOLOv11 by maintaining high detection accuracy while meeting real-time constraints, achieving significant improvements in fabric defect detection.\nThe SPM leverages strip convolution to extract strip defect features through intensive interactions with convolutions of various shapes, improving the model's precision in detecting and positioning strip defects. To enhance background discrimination and texture information extraction, the spatial pyramid pooling is re-designed as SE-SPPF, combining the channel attention mechanism of SENetv2. This module optimally utilizes both channel and spatial information to refine background discrimination and defect feature extraction. Additionally, a novel loss function, focal enhanced complete intersection over union (FECIoU), is introduced to address the issue of large-scale variations in target boxes. FECIOU assigns higher weights to samples with lower IoU, ensuring the model focuses on these challenging samples during training, thus improving detection efficiency and accuracy."}, {"title": "B. Strip Perception Module", "content": "In the task of fabric defect detection, the complex shape and large size variation of defect features affect the accuracy of detection. Multi-scale convolution can effectively capture features at different scales in the feature map, especially when facing long strip-shaped defects that occur frequently in fabric operations. Multi-scale convolution can more effectively extract defect features. The specific design is shown in Fig.2. This paper proposes SPM. First, two convolution blocks of 11 and 33 are used to minimize the number of channels, and then multi-scale (13, 31, 33) convolution operations are performed using branch parallelism. The resulting feature maps are densely stacked using concat, and then a 1x1 convolution kernel is used to extract important features from the convolutions of different scales. Finally, a residual structure was introduced to improve the stability and effectiveness of training. While maintaining the depth of the network,"}, {"title": "C. Squeeze and Excitation Spatial Pyramid Pooling Fast", "content": "Fabric defects usually exhibit multiple features. In order to eliminate some noise, make the features more robust, and help the model better capture the overall structure and texture of the image, SE-SPPF introduces SENetv2 to more reasonably assign weights to each channel. Combined with the multi-scale fusion in SPPF space, it strengthens the model's ability to extract features from both spatial and channel perspectives. The specific design is shown in Fig.3. This paper proposes SE-SPPF. First, the feature map is weighted by SENetv2 to the channel, and then the channel number is adjusted using a 1x1 convolution and input to SPPF. The four feature maps of different scales obtained by SPPF are concatenated using a residual structure and the weighted feature map Concat after feature extraction using a 1x1 convolution. Finally, features are further extracted using two convolutions of 1x1 and 3x3."}, {"title": "D. Focal Enhanced Complete Intersection over Union", "content": "The span of the defect detection box for different types of fabric defects is very large, especially for defects that appear in the form of stripes, which are several times or even more than the length and width of most target detection objects. Therefore, this paper proposes FECIOU, which uses a focal weight mechanism to make the model pay more attention to difficult-to-detect objects during training. Equation 1 is the formula for FECIOU, where $(1 \u2013 IoU)^\u03b3$ is the weight value for CIoU and y is a manually set parameter. In Equation 2 ,$\\rho^2 (b, b^{gt})$is the squared Euclidean distance between the centers of the predicted and ground truth boxes, calculated as shown in Equation 3, and c is the diagonal length of the minimum bounding box. $\\alpha v$ is a penalty term for the aspect ratio difference, and the specific calculation method is shown in Equations 4 and 5. $w^{gt}$, $h^{gt}$, w, and h are the width and height of the predicted frame and the actual frame, respectively.\nFECIOU = $(1 \u2013 IoU)^\\gamma IoU - \\frac{\\rho^2 (b, b^{gt})}{c^2} - \\alpha v)$, (1)"}, {"title": "A. Datasets", "content": "Tianchi fabric dataset Tianchi fabric dataset [32], provided by Alibaba's Tianchi platform, is a significant resource for fabric defect detection research. It comprises high-resolution fabric images with detailed annotations of various defect types, such as holes, stains, wrinkles, color shades, and missing threads. The dataset, consisting of thousands to tens of thousands of images, is designed to facilitate the development and validation of defect detection algorithms and automated quality inspection systems in the fabric industry.\nSelf dataset This dataset was collected and labeled and organized by us. The data mainly comes from the workshop of a fabric factory in Jiangsu Province and public images that can be collected on the Internet. After our collection and organization, the final dataset contains a total of 8,645 fabric defect images, which are classified into five types of defects that are most commonly found in the fabric process: missing stitches, broken holes, stain, broken seam, and broken stitches. The dataset is divided into a training set and a test set in a ratio of 2:8. In addition, this paper also uses some image data enhancement methods, such as rotation, translation, scaling, and flipping, to expand the dataset and generate more samples, thereby improving the generalization ability of the model and reducing the risk of overfitting."}, {"title": "B. Evaluation Metrics", "content": "The mAP (Mean Average Precision) is a widely used evaluation metric in object detection and information retrieval tasks, providing a comprehensive view of a model's performance by evaluating precision across different levels of recall. mAP is computed by averaging the Average Precision (AP) for each class, which is the area under the precision-recall curve for that class, and then averaging these values across all classes. The formula for AP is given by:\nAP = $\\int_0^1 P(r) dr$. (6)\nwhere P(r) denotes precision at a given recall level r. The final mAP score is calculated as:\nmAP = $\\frac{1}{N} \\sum_{i=1}^N AP_i$. (7)"}, {"title": "C. Implementation Details", "content": "In all experiments, the model size selected for the YOLO series of models is normal. The batch size for training the model is 32, and the input size of the image is 640. Because the dataset has a large number of samples and may contain noisy data, in order to avoid local optima and obtain better model performance, the optimizer selects Stochastic ic gradient descent (SGD), with an initial learning rate of 0.01 and momentum of 0.937. To compare the performance of models of different sizes, the experiment uniformly sets the patience to 20, which is the number of epochs that the training is allowed to continue without improving the accuracy of the model on the validation set."}, {"title": "D. Comparison with State-of-the-art Methods", "content": "We compared the proposed method with six state-of-the-art methods, including YOLOv5 [20], YOLOv6 [33], YOLOv8 [22], YOLOv9t [34], YOLOv9s [34], and YOLOv10n [35].\n1) Comparisons on Tianchi fabric dataset: Table I shows a comparison of the performance of the proposed improved model with multiple state-of-the-art algorithms on the Tianchi dataset. It can be seen that the model proposed in this paper achieved the highest mAP (i.e., 65.8%).\nThe mAP of the improved model in each defect category performed well, which shows that the proposed SE-SPPF module fully integrates important defect information from both spatial and channel perspectives, helping the model find key features.\n2) Comparisons on Self dataset: Table II shows a comparison of the performance of the proposed improved model with multiple state-of-the-art algorithms on the dataset we created. It can be seen that the model proposed in this paper achieves the highest mAP (i.e. 90.6%) without significantly increasing the computational cost and model size. Among them, the mAP for the detection of the two strip defects missing stitches and broken stitch is the highest among all methods. This shows that the multi-scale convolution SPM plays a key role in the detection of strip defects, which improves the detection ability of the model."}, {"title": "E. Ablation Studies and Analysis", "content": "The comparison results in Tables I and II show that the proposed improved model is superior to many state-of-the-art single-stage detection methods. Next, a comprehensive analysis of the proposed improved model will be performed by testing it on the dataset we created to explore the logical basis for its superiority. As shown in Table III, the model containing the SPM, SE-SPPF, and FECIOU modules has the highest detection accuracy, with an mAP of 90.6%. This is an improvement over the baseline model, which has an mAP of 89%. The baseline model does not include these modules, and its computational cost is 6.3 GFLOPs and the number of parameters is 2.58 million. After the SPM module is introduced into the model, the detection accuracy is improved to 89.6%, the computational cost is slightly increased to 6.6 GFLOPs, and the number of parameters is slightly increased to 2.61 million. This indicates that the SPM module has the effect of enhancing the extraction of features for strip defects in the dataset. Similarly, when the SE-SPPF module is added alone, the detection accuracy is 89.6%, and GFLOPS (6.6) and parameters (2.89 million) increase slightly, which indicates that SE-SPPF also plays a key role in defect feature extraction by better fusing channel and spatial features. When both the SPM and SE-SPPF modules were included, the mAP was further improved to 90.3%, with a computational cost of 6.8 GFLOPs and a parameter count of 2.86 million. This indicates that the combination of these modules enhances feature extraction capabilities without a significant increase in"}, {"title": "F. Visualization", "content": "As shown in Fig.4, the heat maps after the spatial pyramid pooling layer of the baseline model and the improved model proposed in this paper are shown respectively. It can be intuitively seen that the improved model proposed in this paper is more accurate than the baseline model in determining the most important region for prediction, and the coverage completely includes the defective parts of this fabric. This shows that the SPM module accurately extracts the important features of the strip defects, and SE-SPPF allows the model to accurately distinguish between the background and defects, which in turn allows the model to more accurately determine the most important region for judgment. The visualization results of the heat map once again verify the effectiveness of the structure proposed in this paper."}, {"title": "V. CONCLUSION", "content": "This paper introduced an enhanced fabric defect detection model built upon YOLOv11. To improve the model's ability to capture and extract features of stripe defects, a SPM was designed and incorporated. Additionally, the SPPF was enhanced, and a novel Squeeze-and-Excitation Spatial Pyramid Pooling Fast (SE-SPPF) was proposed to strengthen the model's capacity to differentiate backgrounds and extract defect features. Moreover, FECIoU was proposed, an adaptive-weight version of the CIoU, to mitigate the effects of significant scale differences between target boxes. SPM utilized multi-scale convolution to effectively capture features at various scales within the feature map, while its dense connection structure enhanced the accuracy and efficiency of feature sharing, leading to an overall improvement in the models accuracy and speed. SE-SPPF combined weighted channel feature maps with spatial pyramid pooling, ensuring the comprehensive integration of both spatial and channel information, which further boosted the model's ability to extract complex features. FECIOU applied focal loss to adjust the weights of hard-to-detect instances during training, addressing class imbalance issues and ultimately improving the overall detection performance. In conclusion, the proposed model outperformed other state-of-the-art methods, achieving an increase in mAP of 0.8-8.1% on the Tianchi dataset and 1.6-13.2% on our custom dataset. However, there are still some limitations to the current work. For example, the types of fabric defects currently studied are too few, and the types of defects in actual production are far more than those in the current dataset. The performance of the model on new defect types needs to be further explored. There is also a defect of color error in the fabric industry, which changes with the color of the fabric and poses a new challenge to the model."}]}