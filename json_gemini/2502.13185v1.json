{"title": "CondensNet: Enabling stable long-term climate simulations via hybrid deep learning models with adaptive physical constraints", "authors": ["Xin Wang", "Juntao Yang", "Jeff Adie", "Simon See", "Kalli Furtado", "Chen Chen", "Troy Arcomano", "Romit Maulik", "Gianmarco Mengaldo"], "abstract": "Accurate and efficient climate simulations are crucial for understanding Earth's evolving climate. However, current general circulation models (GCMs) face challenges in capturing unresolved physical processes, such as cloud and convection. A common solution is to adopt cloud resolving models, that provide more accurate results than the standard sub-grid parametrisation schemes typically used in GCMs. However, cloud resolving models, also referred to as super paramtetrizations, remain computationally prohibitive. Hybrid modeling, which integrates deep learning with equation-based GCMs, offers a promising alternative but often struggles with long-term stability and accuracy issues. In this work, we find that water vapor oversaturation during condensation is a key factor compromising the stability of hybrid models. To address this, we introduce CondensNet, a novel neural network architecture that embeds a self-adaptive physical constraint to correct unphysical condensation processes. CondensNet effectively mitigates water vapor oversaturation,", "sections": [{"title": "1 Introduction", "content": "Climate change is bringing more frequent and intense extreme weather events that are causing significant harm to ecosystems and communities worldwide [1]. General circulation models (GCMs), climate models that use mathematical equations to simulate the Earth's system, are critical to understand climate change over various time scales [2]. Indeed, they can be pivotal for the survival of a certain community or ecosystem, if they were to provide reliable projections on actionable time scales.\nOne of the primary sources of unreliability in modern GCMs stems from the challenges associated with cloud and convection processes. These phenomena are inherently tied to small-scale atmospheric physics occurring at kilometer or sub-kilometer scales, which current GCMs struggle to capture due to their relatively coarse spatial resolution (~ 50 km). To address this limitation, various approaches have been proposed in the literature. These can be grouped into two categories: subgrid parametrization models, and super parametrization models.\nSubgrid parametrization models use simplified empirical relationships or theoretical approximations to describe small-scale atmospheric processes that current GCMs are unable to resolve [3-6]. While computationally efficient, these subgrid models are relatively simplistic, and are a leading source of uncertainties in GCMs' climate projections [7].\nSuper parametrization models embed high-resolution cloud-resolving models (CRMs) within each grid cell of a larger-scale GCMs. These CRMs explicitly resolve small-scale atmospheric processes, enhancing the model's ability to simulate cloud dynamics. A notable example is the super-parameterized community atmosphere model (SPCAM), developed by the National Center for Atmospheric Research (NCAR) [8, 9]. Despite their improved accuracy, these models are computationally intensive, often rendering them impractical for long-term climate projections [10].\nA promising and emerging area of research, known as hybrid modeling (as it hybridizes physics and machine learning), blends CRMs with machine learning. The idea is to use the wealth of scale-resolving data from various CRMs to construct high-fidelity and computationally-efficient deep learning"}, {"title": "2 Results", "content": "GCMs integrated with DL parametrizations often become unstable during long-term simulations, where the instability typically manifests as an energy surge [21]."}, {"title": "3 Discussion", "content": "The integration of DL with equation-based models has opened new avenues for addressing long-standing challenges in accurately representing cloud and convection processes, leading to the promising field of hybrid climate modeling.\nCurrent research has focused on developing DL parametrizations that provide both long-term stability and physical consistency while achieving significantly faster computational performance (e.g., speedup of 10x to 1000x than standard GCM with super parametrization schemes). Yet, significant breakthroughs are still limited, especially for achieving long-term stability without compromising accuracy.\nThis work introduces CondensNet, a novel DL parametrization, that embeds physical condensation constraints, to address long-term stability and accuracy issues. CondensNet is built on the important finding that the regulation of water vapor saturation is a significant factor affecting simulation stability in real-world land and ocean configurations. Unlike traditional super parametrization methods that can suppress anomalous water vapor transport, unconstrained DL parametrizations may fail to replicate moisture regulation, resulting in water vapor oversaturation. CondensNet directly learns saturation adjustment processes from super parametrization models (where in this work we used SPCAM), through a Condensation Correction Network (ConCorrNet), that works concurrently and adaptively with a residual multi-layer perceptron, namely BasicNet (see also Methods, section 4.1).\nThe resulting improvement in stability does not compromise predictive accuracy performance or the representation of energy and matter cycles (further results on this aspect are reported in Supplementary Information B). Moreover, the explicit inclusion of physical constraints enhances interpretability of the hybrid modeling, highlighting the crucial role played by the condensation process.\nCondensNet is integrated in our hybrid DL framework, namely PCNN-GCM, and provides physically-consistent and stable long-term climate simulations, while providing significant speedups compared to the super parametrization benchmark, SPCAM, adopted."}, {"title": "4 Methods", "content": null}, {"title": "4.1 PCNN-GCM framework", "content": null}, {"title": "4.1.1 CondensNet DL architecture and GCM model", "content": "CondensNet (Figure 5d) is a novel DL parametrization that learns and emulates the high-resolution cloud-resolving model (CRM) of SPCAM's super parametrization [8] (Figure 5b), where the atmospheric dynamics is driven by the Community Atmosphere Model version 5.2 (CAM5.2) [37] (Figure 5e), running at a horizontal resolution of 1.9\u00b0 \u00d7 2.5\u00b0 with 30 vertical pressure levels, extending up to approximately 2 hPa. CAM5.2 is further coupled with the Community Land Model version 4.0 (CLM4.0) [26], using prescribed sea surface temperatures and sea ice concentrations according to the Atmospheric Model Intercomparison Project (AMIP) protocol. Traditional GCMs like CAM use subgrid parametrization based on empirical models to represent cloud and convective processes (Figure 5a), which can introduce significant uncertainties. The GCM using super parametrization, like SPCAM [8], mitigates this"}, {"title": "4.1.2 Dataset and training details", "content": "CondensNet uses SPCAM simulation data for training. The specific inputs and outputs are listed in Table 2, including 30 vertical levels of specific humidity Q, temperature T, large-scale water vapor tendency dQ1.s., large-scale temperature tendency dTi.s., as well as single-level surface pressure Ps and single-level incoming solar radiation Solin.\nThe output variables are the corresponding tendencies of moisture dQ and dry-static-energy ds at each vertical level (30 in total), as well as the four radiation fluxes (SOLS, SOLL, SOLSD, and SOLLD) in which reach to surface."}, {"title": "4.2 Post-processing and error metrics", "content": null}, {"title": "4.2.1 Means", "content": "For variables with vertical distribution (temperature, wind speed, specific humidity), the zonal mean at each pressure level is given by\n$X_{zonal}(\\phi,p) = \\frac{1}{N_x}\\sum_{i=1}^{N_x}X (\\lambda_i, \\phi, p),$  (7)\nwhere Nx is the number of longitudinal grid points, Ai is the longitude at grid point i, \u00f3 is latitude, and p is pressure level. For surface or near-surface variables (precipitation, 10m wind speed), the horizontal mean is given by\n$Y_{horizontal} = \\frac{1}{N_{\\lambda}N_{\\phi}} \\sum_{j=1}^{N_{\\phi}} \\sum_{i=1}^{N_{\\lambda}} Y(\\lambda_i, \\phi_j)w(\\phi_j),$  (8)\nwhere w($j) is the latitudinal weight factor. The climatological means are then obtained by averaging these spatial means over the analysis period\n$X_{clim} = \\frac{1}{Y}\\sum_{y=1}^{Y}X_{m,y},$  (9)\nwhere Y is the total number of years in the analysis period, Xm,y represents the monthly mean for month m in year y."}, {"title": "4.2.2 Error metrics", "content": "Once the means introduced in section 4.2.1 are obtained, we use different error metrics to asses the performance of PCNN-GCM against NN-GCM and CAM5, using as a reference (i.e., ground truth) SPCAM. In particular, we use the pattern difference\n$diff(\\phi, \\lambda, p) = X_{model}(\\phi, \\lambda, p) \u2013 X_{SPCAM}(\\phi, \\lambda, p)$  (10)"}, {"title": "A Additional results", "content": "We show additional detailed results in terms of key variables, namely wind and temperature (section A.1), precipitation (section A.2), and climate variability (section A.3). These complement the results shown in the main text, and more specifically in section 2."}, {"title": "A.1 Wind and temperature", "content": "First, we show the results for the vertical profiles of two key variables, namely wind speed and temperature. These are depicted in Figure Sla-d for wind speed and in Figure S1h-k for temperature, and they correspond to the annual means in the period 1999-2003, on a latitude-height cross-section (for more details on how these are computed, see Methods, section 4.2.1). We also show the difference, calculated using Equation 10 in Methods (section 4.2.2), between CAM5, NN-GCM, and PCNN-GCM with respect to the SPCAM reference (Figure Sle-g for wind speed and Figure S1m-o for temperature), where we report the associated RMSE errors in the title of each subfigure."}, {"title": "A.2 Precipitation", "content": "In Figure S3, we show both the probability density functions of daily precipitation intensity (Figure S3a), as well as the zonally-averaged precipitation rate (Figure S3b-g) for the years 1999-2003 for the region 30\u00b0S-30\u00b0N. For all results depicted in Figure S3, we consider the period 1998-2002, and the precipitation intensity intervals for obtaining the probability distribution in Figure S3a are set at 1mm/day.\nFigure S3a shows how CAM5 (red line) significantly underestimates the probability of heavy precipitation events (exceeding 20 mm/day) but overestimates the probability of moderate precipitation (2-20 mm/day), with an unrealistic probability peak near 10 mm/day [39]. Compared to CAM5 (red line), NN-GCM (blue line) and PCNN-GCM (green line) probability distributions are closer to those of SPCAM, with a notably enhanced probability estimation of heavy precipitation events, with PCNN-GCM aligning closer to SPCAM (black line).\nFigure S3b-g show the multi-year (1999-2003) mean of zonally-averaged precipitation for the whole year (Figure S3b,c), for the DJF \u2013 December- January-February \u2013 season (Figure S3d,e) and for the JJA \u2013 June-July-August season (Figure S3f,g), where the left figures represent the global average and the right figures represent the land global average."}, {"title": "A.3 Climate variability: Madden-Julian Oscillation", "content": "Super-parametrization incorporates higher spatial and temporal resolution, enabling to better capture high-frequency atmospheric variability. PCNN- GCM learns from the SPCAM super-parametrization. Hence, it should provide better performance than e.g., CAM5, in capturing high-frequency atmospheric variability. To asses this hypothesis, we evaluate the performance of PCNN- GCM on the the Madden-Julian Oscillation (MJO), the dominant mode of intraseasonal variability in the tropics. The MJO plays a significant role in climate prediction, serving as the foundation for seasonal forecasts of extreme events such as extreme rainfall and tropical cyclones [40]. A key characteristic of the MJO is the eastward propagation of deep convective structures along the equator, with a time scale of 20-100 days [41]. Convective parametrizations significantly affect the ability of models to correctly simulate the MJO [42], especially in terms of periodicity and eastward propagation characteristics.\nWe assess the simulation performance of PCNN-GCM by examining whether our model is able to correctly capture the periodicity and eastward propagation features of the MJO.\nFigure S4 shows that wavenumber-frequency spectrum analysis (Figure S4a-d), and the lag-correlation analysis (Figure S4e-h). These are obtained applying:\n1. a band-pass filter to the daily anomalies (precipitation and 200-hPa zonal winds) between 20-100 days;\n2. a meridional averaging from 10\u00b0S to 10\u00b0N on data in the reference time period 1999-2003, during Northern Hemisphere winter, and\n3. a correlation calculation with reference to the equatorial Eastern Indian Ocean (80\u00b0E-100E, 10\u00b0S-10\u00b0N).\nThe wavenumber-frequency spectrum analysis (Figure S4a-d) reveals that NN-GCM and PCNN-GCM successfully capture the key MJO characteristics observed in SPCAM. The coefficients of determination (R2) for NN-GCM (0.51) and PCNN-GCM (0.55) significantly exceed CAM5's performance (0.40), indicating better accuracy for tropical atmospheric intraseasonal variability.\nThe lag-correlation analysis (Figure S4e-h) demonstrates that both NN-GCM and PCNN-GCM effectively reproduce the eastward propagation of MJO convection from the Indian Ocean across the Maritime Continent to the Pacific Ocean, closely matching SPCAM's behavior. In contrast, CAM5 shows no distinct eastward propagation characteristics. In Figure S4e-h, shaded areas"}]}