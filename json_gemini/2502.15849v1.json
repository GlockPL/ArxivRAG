{"title": "Synthesizing Composite Hierarchical Structure from Symbolic Music Corpora", "authors": ["Ilana Shapiro", "Ruanqianqian (Lisa) Huang", "Zachary Novack", "Cheng-i Wang", "Hao-Wen Dong", "Taylor Berg-Kirkpatrick", "Shlomo Dubnov", "Sorin Lerner"], "abstract": "Western music is an innately hierarchical system of interacting levels of structure, from fine-grained melody to high-level form. In order to analyze music compositions holistically and at multiple granularities, we propose a unified, hierarchical meta-representation of musical structure called the structural temporal graph (STG). For a single piece, the STG is a data structure that defines a hierarchy of progressively finer structural musical features and the temporal relationships between them. We use the STG to enable a novel approach for deriving a representative structural summary of a music corpus, which we formalize as a dually NP-hard combinatorial optimization problem extending the Generalized Median Graph problem. Our approach first applies simulated annealing to develop a measure of structural distance between two music pieces rooted in graph isomorphism. Our approach then combines the formal guarantees of SMT solvers with nested simulated annealing over structural distances to produce a structurally sound, representative centroid STG for an entire corpus of STGs from individual pieces. To evaluate our approach, we conduct experiments verifying that structural distance accurately differentiates between music pieces, and that derived centroids accurately structurally characterize their corpora.", "sections": [{"title": "Introduction", "content": "A prevailing theory among Western music theorists and musicologists states that Western classical music exhibits an implicitly hierarchical structure [Simonetta et al., 2018]. While several different theoretical systems have been proposed to formalize this structural hierarchy [Marsden et al., 2013], a widely accepted modern interpretation of the hierarchy states that melodies form the bottom, followed by harmonic contour, rhythmic patterns, disjoint and possibly overlapping motifs, and finally large-scale sections [Nieto, 2015; Mount, 2020; Dai et al., 2024]. Together, this composite hierarchy encapsulates the overall structure of a piece.\nTo analyze musical structure computationally, many automatic approaches have been developed for extracting struc-ture at single levels of the structural hierarchy [McFee et al., 2017; Hsiao et al., 2023; Lev\u00e9 et al., 2011; Chen and Su, 2021; Salamon et al., 2014]. However, music perception researchers have shown that the levels are not perceptually independent: they relate to one another in both \u201cvertical\u201d (structural) and \u201chorizontal\" (temporal) directions [Narmour, 1983], interactions that have more recently been proven computationally [Dai et al., 2024]. A comprehensive analysis of a piece thus must integrate these inter- and intra-level interactions into a unified model. Furthermore, while attempts have been made to generate structured music [Young et al., 2022; Huang et al., 2023; Wang et al., 2024], to our knowledge, no existing research has examined generating music adhering to a complete, musically representative structural hierarchy, since no mechanism to computationally derive a complete structural specification from a desired music corpus currently exists. Such an encapsulation of music structure could also play a critical role in the generation of well-formed music by serving as a system of constraints on generative models.\nDespite prior attempts at such an integrated, computational model of musical form, two challenges remain. First, prior approaches do not completely encapsulate the vertical and horizontal relationships of the structural hierarchy, cannot handle polyphonic music, or are not fully automatic [Hamanaka et al., 2016; Simonetta et al., 2018; Mokbel et al., 2009; Carvalho and Bernardes, 2020]. Second, to our knowledge, existing methodologies focus only on individual pieces with no attempt to summarize the hierarchy over a music corpus to synthesize its overall structure and obtain a holistic representation of the entirety of the corpus.\nTo address these challenges, we introduce the structural temporal graph (STG) as a unified model of complete musical structure. The STG is a k-partite directed acyclic graph whose levels form the structural hierarchy, and edges encode temporal relationships between adjacent levels. We use simulated annealing to develop a measure of structural distance between two STGs based on graph isomorphism, and to obtain the overarching structure of a corpus of pieces, we develop an approach to derive a representative centroid graph from a corpus of STGs. We formalize centroid derivation as a dually NP-hard combinatorial optimization problem extending the Generalized Median Graph problem [Jiang et al., 2001], and propose a solution combining nested simulated annealing with the formal guarantees of SMT solvers to produce a structurally sound result. Our experiments show that structural distance accurately differentiates pieces, with its performance reliant on the complete hierarchy, and that derived centroids accurately structurally characterize their corpora.\nIn summary, the contributions of this paper are as follows:\n1. We propose the structural temporal graph, a meta-representation of musical form unifying the entire structural hierarchy, and develop a structural distance measure between two STGs rooted in graph isomorphism.\n2. We formalize the music summarization problem as a dually NP-hard combinatorial optimization problem, and contribute a novel solution using both stochastic and SMT-based techniques.\n3. We conduct experiments verifying structural distance accurately differentiate pieces, and music corpora are accurately characterized by their derived centroids."}, {"title": "2 Related work", "content": "Single-Level Analyses. Many existing algorithms extract structure at single levels of the music structural hierarchy. To extract segmentation, The Music Structure Analysis Framework (MSAF) toolkit [Nieto, 2015] features factorization-based techniques, including ordinal linear discriminant analysis [McFee and Ellis, 2014b], convex nonnegative matrix factorization [Nieto and Jehan, ], checkerboard [Foote, 2000], spectral clustering [McFee and Ellis, 2014a], the Structural Features algorithm [Serr\u00e0 et al., 2014], 2D-Fourier Magnitude Coefficients [Nieto and Bello, 2014], and the Variable Markov Oracle [Wang and Mysore, 2016]. Motif discovery algorithms search for disjoint, repeating, and possibly overlapping patterns in a piece. String-based approaches [Wang et al., 2015] represent music as a chromagram and detect patterns with sub-string matching, and geometry-based approaches [Hsiao et al., 2023] represent music as multidimensional point sets, and translatable subsets identify patterns. Recent approaches in harmony identification are centered around neural networks, such as using transformers to incorporate chord segmentation into the recognition process [Chen and Su, 2019; Chen and Su, 2021]. Until very recently, the Melodia algorithm was the state of the art in melody extraction, but recent approaches have shifted to neural networks [Kosta et al., 2022; Chou et al., 2021].\nIntegrated Models of Structure. Music theorists have attempted to unify the structural hierarchy with frameworks such as Schenkerian theory [Marsden, 2010] and the Generative Theory of Tonal Music (GTTM) [Lerdahl and Jackendoff, 2020]. Schenkerian analysis applies a series of reductions that progressively simplify a musical piece by removing layers of structure. Attempts to automatically derive Scherk-erian analyses are intractable for all but very short pieces, and have low accuracy [Marsden, 2010]. GTTM generates four different structural hierarchies (grouping structure, metrical structure, time-span tree, and prolongational tree) for a piece of music, to model human cognition [Hamanaka et al., 2016]. Computational implementations GTTM (e.g. the Automatic Timespan Tree Analyser [Hamanaka et al., 2016]) cannot handle polyphonic music, and are not fully automatic. Improved results with these theories are unlikely, as neither gives the precision required for complete computational implementation [Marsden et al., 2013].\nSuch theoretical limitations led to a modern interpretation of the structural hierarchy: segmentation, motifs (disjoint/repeating patterns), rhythm, harmony, and melody [Nieto, 2015; Mount, 2020; Dai et al., 2024]. Many approaches partially encode the hierarchy in graphs: topographic mappings for melodic progressions [Mokbel et al., 2009], graphs for interactions between sections, melody, harmony and rhythm [Dai et al., 2020], multi-edge graphs for bar-level relations [Bhandari and Colton, 2024], and undirected graphs for melodies and their reductions [Orio and Rod\u00e0, 2009]. The prototype graph [Young et al., 2022] is a bipartite network relating prototype elements to the music they represent. Attempts to model the structural hierarchy with formal grammars [Sidorov et al., 2014; Finkensiep et al., ] are limited to segmentation and motifs.\nNone of these approaches encapsulate the entire hierarchy, and to our knowledge, there have also been no attempts to synthesize representative structure from a music corpus."}, {"title": "3 Structural Temporal Graph", "content": "To address the lack of a fully automatic complete encapsulation of polyphonic musical structure, we introduce the structural temporal graph (STG), a unified meta-representation of musical structure that captures the levels of the music structural hierarchy and the temporal relationships between them. The STG is a k-partite directed acyclic graph (DAG), where each of the k layers encodes a level in the music structural hierarchy. Following the modern music theoretic interpretation of the hierarchy [Nieto, 2015; Mount, 2020; Dai et al., 2024], from top to bottom we denote the levels to be contiguous segmentation, motifs (both disjoint and overlapping), rhythmic contour, relative keys, functional harmonic chords, and melodic contour. The STGs we build include every level in the hierarchy except rhythmic contour, for which we were unable to access an analysis algorithm. We run individual analysis algorithms to generate each level of the hierarchy, which is elucidated in Section 6. Before formally defining the STG, we build intuition by walking through the derivation of an STG from an annotated piece.\nBuilding the Graph. We walk through the derivation of an STG from Beethoven's Biamonti Sketch No. 461 that unifies contiguous segmentation; disjoint, overlapping motifs; relative keys; functional harmonic chords; and melodic contour. First, we manually analyze the piece by annotating its score with computer-generated hierarchical structure analyses in Figure 1. Each colored annotation corresponds to one level of the structural hierarchy. In purple, we see that this piece has one large contiguous segment, labeled 0. Next, disjoint motifs are in red. Motif 0 appears twice, at the beginning of bars 1 and 2. The gray filler bar indicates no more motifs appear in the latter half. In orange, we see this piece is in a single key, Eb Major. We label this key symbolically as OM to indicate this is relative key number 0 (i.e. the first key) in M for major. Subsequent keys would be numbered by their positive interval difference from the previous key within the 12-tone scale. We next see functional harmonic chords in green annotated with Roman numeral chord symbols, and finally melodic contour intervals in blue. Notably, such generated analyses may be slightly inaccurate (e.g. the third green I chord should correspond to the previous beat). Since the STG is a fully automatic meta-representation of musical structure, it is only as accurate as the analysis algorithms it uses.\nWe then equivalently represent the ground-truth annotations in Figure 1 as the stacked rectangles in Figure 2 to elucidate how each level of the structural hierarchy relates to the next. Finally, we transition to the STG in Figure 3. There is a surjection between Figures 1, 2, and 3. The edges and nodes of the STG, respectively, correspond to the vertical and horizontal alignments of the rectangles in Figure 2. All motif nodes, including the gray filler node indicating no motifs for that interval, fall into the time interval of purple segmentation node 0. The orange key node 0M starts in the first red motif node 0, and ends in the last gray motif filler node (i.e. the key spans the entire piece). All the green chord nodes fall in the orange key node's interval. Finally, we see how blue melodic contour nodes relate to green chord nodes. For instance, the first melody interval -2 begins and ends in the first chord node I, and the penultimate melody interval -1 begins in the fourth V7 chord node and ends in the fifth I chord node.\nFormally, the nodes of an STG encode labeled musical sections along with their associated time intervals generated by the relevant analysis algorithm. Nodes are sorted within each level based on start time, and edges encode temporal relationships between nodes of adjacent levels. Specifically, for node n at level i, n must have either one or two parents in level i - 1 directly above it: one if its associated time interval is a total subset of its parent's, and two if its time interval begins in one parent's, and ends in the other's."}, {"title": "4 Structural Distance", "content": "At a high level, the distance between two STGs is the minimum number of edit operations (deletion, insertion, and substitution of nodes/edges) required to transform one graph to the other, also known as graph edit distance (GED) [Serratosa, 2021]. However, GED measures isomorphic similarity between two graphs, i.e. it evaluates how closely graph structures match independent of labeling. We cannot currently leverage STG isomorphism because STGs are \u201ccompressed,", "feature": "the section number they correspond to. Finally, to encode intra-level linear temporal relationships, we form a linear chain with edges between pairs of horizontally adjacent nodes. This results in a structurally complete STG we can reason about isomorphically. Figure 4 shows the first two levels of the STG from Figure 3, with yellow prototype nodes on the left for each instance feature (section number for segmentation nodes S, and pattern number and filler for motif/pattern nodes P), red edges connecting prototype features to instance nodes, and green edges for the pattern layer intra-level linear chain.\nGraph Alignment Annealing\nGED is a NP-hard combinatorial optimization problem [Serratosa, 2021], intractable for most STGs. Most GED approximation algorithms are slow and of dubious accuracy, and more generalized than we require. We thus introduce new measure of structural distance computed with simulated annealing (SA). SA is a stochastic optimization technique used to estimate the global optimum of a discrete cost function. It comprises an objective \u201cenergy", "move": "unction for generating a new solution from the current state.\nTo use SA, we convert the augmented STGs to adjacency matrices, and pad each matrix with zero-arity \"dummy nodes\" so they have identical dimensions. Given such matrices $A_{G_1}$ and $A_{G_2}$, their distance is given in Equation 1, where $||.||_F$ denotes the Frobenius norm. When $A_{G_1}$ and $A_{G_2}$ are optimally aligned, $DIST(A_{G_1}, A_{G_2})$ is simply $\\sqrt{GED}$.\n\\[DIST(A_{G_1}, A_{G_2}) = || A_{G_1} - A_{G_2} ||_F \\]\nFinding permutation matrix P optimally aligning $A_{G_2}$ to $A_{G_1}$ to minimize Equation 1 is NP-hard, so we use SA. The alignment annealer's energy function is given in Equation 2. Given optimal P, Equation 2 computes the structural distance between $A_{G_1}$ and $A_{G_2}$.\n\\[ENERGY (A_{G_1}, A_{G_2}, P) = DIST(A_{G_1}, P^T A_{G_2} P)\\]\nThe move function for modifying P at each step of SA is given in Algorithm 1. A partition is either the set of instance nodes at a single level in the STG (e.g. the set of functional harmonic key nodes), or the set of prototype nodes for a given feature (e.g. chord quality). Permuting only within valid partitions leverages the STG's inherent structure to avoid invalid moves globally detrimental to Equation 2.\nWe set the alignment annealer's initial state to $P = I$, the identity matrix. By running the annealer for sufficiently many steps, we obtain optimal P."}, {"title": "5 Centroid Derivation", "content": "Centroid STG derivation is a constrained version of the Generalized Median Graph (GMG) problem, which, given a set of graphs, seeks to construct a prototype graph minimizing the distances over the input set graphs [Blumenthal et al., 2021]. Formally, given a corpus of graphs C, the GMG g is:\n\\[g = \\underset{\\hat{g}}{\\text{arg min}} \\sum_{G \\in C} d(\\hat{g}, G) \\]\nwhere d is the distance measure. GMGs have wide applications in representation-based learning, particularly in biological settings [Mukherjee et al., 2009]. Prior attempts at the GMG use genetic search [Jiang et al., 2001], linear programming[Mukherjee et al., 2009], block coordinate updates [Blumenthal et al., 2021], and median graph shift clustering [Jouili et al., 2010]. To our knowledge, GMGs have never been applied to the music domain. Centroid STG derivation also operates in a significantly more constrained search space than the canonical GMG, since the centroid must be a well-formed STG. We thus propose a new approach combining nested simulated annealing with SMT solving.\nBi-Level Simulated Annealing\nGiven padded adjacency matrix $A_g$ for an augmented centroid STG and its associated corpus of matrices $C = \\{A_G\\}$ that are optimally aligned to $A_g$, we seek to minimize Loss in Equation 4, where DIST is as in Equation 1.\n\\[LOSS (A_g, C) = \\frac{1}{|C|} \\sum_{C A_G \\in C} DIST(A_g, A_G) \\]\nThe centroid annealer's energy function is given in Equation 5, where $C_{aligned}$ is the corpus aligned to the current centroid $A_g$, a process itself requiring SA as in Section 4.1 to obtain the optimal alignments. Finding the centroid $A_g$ minimizing Equation 4 is thus a dually NP-hard problem (GED and minimizing over these distances) requiring nested SA.\n\\[ENERGY (A_{G_1}, A_{G_2}, P) = LOSS(A_g, C_{aligned}) \\]\nAs the centroid annealer's temperature cools, the loss converges as the centroid is increasingly closely aligned to its corpus. Thus, as the centroid annealer's temperature cools, we scale down the number of steps and max temperature of the nested alignment annealer (precise cooling schedule is in Appendix Section A).\nThe centroid annealer's move function for modifying the centroid $A_g$ at each step of SA is given in Algorithm 2. To move strategically, we build the score matrix S revealing which edge(s) in $A_g$ contribute most to the loss. We add or remove the edge at a highest score coordinate meeting the criterion in Algorithm 2. In particular, a globally structurally invalid move induces a terminally invalid structure in the centroid by violating one of the rules in Table 1. Some locally invalid moves, however, such as removing an edge in an intra-level linear chain, must be allowed as intermediate steps to a more optimal structurally valid state. Importantly, the STGs being compared must have the same number of levels; otherwise, edges spanning multiple levels must be allowed as they can be intermediate states towards the deletion of an entire level. Based on our experiments, this would be unacceptably detrimental to the performance of the annealer.\nWe set the centroid annealer's initial state $A_g$ to the corpus STG in the corpus with the min loss over the rest of the corpus. Running the annealer for sufficient steps gives an approximate centroid that may contain locally invalid states.\nGraph Repair with SMT Solving\nIn order to obtain a structurally sound centroid, we must \u201crepair\" the approximate centroid $A_g$ by projecting it to the nearest valid STG. We achieve this by encoding the STG's structure as constraints in quantifier-free first-order logic formulae in the SMT (satisfiable modulo theory) solver Z3 [De Moura and Bj\u00f8rner, 2008], which gives us formal guarantees on the soundness of the centroid. We use Z3's optimizer to minimize an objective over the constraints. Given approximate centroid $A_g$ and valid centroid $A_g'$, our objective is Equation 6.\n\\[OBJ(A_g, A_g) = \\sum_{i} \\sum_{j} | A_{g_{ij}} - A_{g_{ij}} | \\]\nOur constraints include the global rules in Table 1, as well as additional constraints for instance nodes in Table 2, and finally prototype nodes in Table 3. We model relationships between nodes with uninterpreted functions.\nZ3's optimizer supports integration with large neighborhood search (LNS) and can return intermediate semi-optimized solutions after a timeout. We run the optimizer with LNS, with initial soft constraints set to the approximate centroid $A_g$ to guide the optimizer. Even so, naively running the optimizer on a full STG is generally intractable due to combinatorial explosion, so we partition $A_g$ into subsets we can apply the constraints to incrementally.\nWe first partition $A_g$ into pairs of consecutive instance levels without their prototypes (e.g. a segmentation/motif pair of instance levels), and optimize the instance constraints in Table 2 and relevant global constraints in Table 1 over each partition incrementally. We combine the results of each partition until we build a valid centroid subgraph of instance nodes. Then, we partition $A_g$ into single levels, each containing the instance nodes of that level and all prototype nodes for each instance feature at that level (e.g. segmentation instance nodes + section number prototype nodes). The instance constraints are already optimized; we need only optimize the prototype constraints in Table 2 and relevant global constraints in Table 1 over the possible prototypes. This gives us the complete, structurally sound centroid $A_g'$ we seek. A detailed visualization of the complete centroid derivation process is in Appendix Section B.\""}, {"title": "6 Experiments", "content": "We conduct experiments to verify that: (1) structural distance accurately differentiates individual pieces, with its performance reliant on the complete hierarchy, and (2) the centroid encapsulates the overarching structure of its corpus.\nTo evaluate our approach, we create a dataset of polyphonic, symbolic MIDI piano music from the Kunstderfuge and Classical Piano MIDI datasets. Since some single-level analyses we use to generate STGs require the data to be in audio and CSV format, we convert MIDI to CSV (with a manual script) and to MP3 (with Fluidsynth [Moebert, 2007]).\nStructural Distance Evaluation\nMathematical Verification. Given two STGs $G_1, G_2$ recall that under optimal alignment, $DIST(A_{G_1}, A_{G_2})$ is $\\sqrt{GED}$. To evaluate our alignment annealer, we set $G_1$ with $E_1$ edges as the \"base graph.\" From $G_1$, we generate a series of STGs $G_2$ by randomly adding $[|E_1|\\cdot p]$ valid edits to $G_1$ (add/remove edge, verified with Section 5.2 Z3 solver), where $p \\in \\{0.1, 0.2, . . ., 3\\}$ (i.e. p ranges from 10-300% edits in the size of $E_1$). We evaluate structural distance as a function of p for five base STGs $G_1$ by computing the relative error from experimental $DIST (A_{G_1}, A_{G_2})$ to ground truth structural distance $\\sqrt{[|E_1|\\cdot p]}$ (Figure 5). Relative error is close to 0 (perfect alignment) for $p < 1.8$, and only deteriorates, at worst, to 10.33% at p = 3 for the Beethoven 461 base graph.\nMusical Evaluation. To verify structural distance accurately differentiates pieces, we construct 210 STG sets from 32 pieces by composers J.S. Bach (21), Mozart (2), Beethoven (3), Schubert (2), and Chopin (4). Each set is a unique combination of 5 pieces, one from each composer, such that the duration of any piece is within 7 seconds of any other piece in the same set, since structural distance between disparate length pieces could be due to STG size differences rather than the local structural variations we aim to distinguish. Input pieces/set combination details are in Appendix Section C. We compute pairwise structural distances between the STGs in each set with our Section 4 graph alignment annealer (2000 iterations, max and min temperature of 2 and 0.01) on 8 Nvidia RTX 2080 GPUs with 11GB RAM. This results in 210 structural distance matrices, which we average to a single mean distance matrix.\nWe evaluate structural distance against three baselines over the same 210 piece combinations. Baseline 1 is the mean distance matrix obtained by taking the cosine similarity between feature vectors extracted from each MIDI file using Music21 [Cuthbert, 2006]. Baseline 2 is the mean distance matrix over pairwise Stent weighted audio similarities (SWAS) for each piece's paired MP3 file. SWAS is a composite audio similarity metric comprising zero-crossing rate, rhythm, chroma, spectral contrast, and perceptual similarity metrics, which we weigh equally. To demonstrate that existing graph comparison metrics are insufficient, Baseline 3 is the Weisfeiler-Lehman (WL) Kernel applied pairwise to the STGs in each set, with five iterations and Neighborhood Hash (NH) as the base kernel. The WL Kernel iteratively refines node labels based on their neighbors, and uses a base kernel (in this case, NH, which efficiently captures local graph structure by distinguishing neighborhood configurations) to compare them [Shervashidze et al., 2011]. Our ground-truth is the stylistic similarity indices between composers using human annotations and metadata from \"The Classical Music Navigator\" [Smith and Georges, 2014].\nWe normalize all matrices to [0, 1] range and apply the Mantel test with Spearman's rank correlation coefficient $\\rho_s$ to evaluate our results against the ground-truth similarity from the Classical Music Navigator (Table 4). $\\rho_s$ is highest (with p < 0.05) for structural distance (SD in Table 4), verifying that structural distance accurately differentiates between pieces and captures human conception of musical similarity. Finally, to verify the importance of the full hierarchy, we repeat this experiment with bottom-up level ablations of the STG (Table 5). The structural distance algorithm's performance incrementally declines each time a layer of the STG is removed, confirming the necessity of the complete hierarchy."}, {"title": "Centroid Evaluation", "content": "Mathematical Verification. As a correctness check, we evaluate derived centroids against constructed ground truth centroids. Given base STG g with E edges, we create a synthetic corpus $C_k$ of k STGs by randomly adding $[\nE\n3\n10]$ valid edits to g, k times, as in Section 6.1. By construction, g must be a true centroid with min possible loss over $C_k$ (Equation 4; proof in Appendix Section D). We derive candidate centroid $g_a$ from $C_k$, and compare to $g$. We evaluate $g_a$ against the naive centroid $g_n$, i.e., the STG already in $C_k$ with min loss over the rest of $C_k$.\nWe choose our base STG g to be Beethoven's Biamonti Sketch No. 461, which, when augmented, has E = 97 edges. Thus, we add $[\\frac{97}{2}]$ = 49 edits to g, k times, to generate a synthetic corpus $C_k$ of size k with g as its true centroid. 49 edits is structural distance of 7.0, since structural distance between optimally aligned graphs is $\\sqrt{GED}$ (Equation 1).\nWe repeat this process for $k \\in [3, 14]$. For each corpus $C_k$, we use the same GPU infrastructure as Section 6.1 to generate approximate centroids with the centroid annealer (1000 iterations, max and min temperature of 2.5 and 0.05). At each iteration, we run the nested graph alignment annealer, starting at 500 steps, max and min temperature of 1 and 0.01, and ending at 5 steps, max and min temperature of 0.05 and 0.01, as the outer centroid annealer's loss converges (see Section 5.1). We run our Z3 optimizer to generate each final, repaired centroid $g_a$, using 24 Intel Xeon cores and 32GB RAM.\nThere may be multiple non-isomorphic true centroids with the same minimal loss over $C_k$. Evaluating the relative error between optimal loss from g and experimental loss from $g_a$ thus gives a more rigorous assessment of $g_a$ than directly comparing $g_a$ to g. Figure 6 shows the relative error in loss $E_g$ between g and $g_a$ for $k \\in [3,14]$ in red, compared to the relative error in loss $E_g$ between g and $g_n$ in blue. We observe $E_{g_a}$ is consistently small, with max $E_{g_a} = 2.99\\%$ at k = 5, and min $E_{g_a} = 0$ (i.e. $g_a$ is a true centroid) at k = 10, 11. $g_a$ also greatly outperforms $g_n$: for nonzero $E_g$, $E_g$ is on average 17.23 times worse than $E_{g_a}$.\nMusical Evaluation. This experiment requires pieces with more length (and STG size) variation than Section 6.1, as centroids derived from very similar input graphs may be trivial by construction and fail to generalize to more diverse corpora. We thus relax the Section 6.1 relative duration restriction to 80 seconds, and generate centroid STGs for four corpora with pieces by Alkan (11), Chopin (8), Haydn (12), and Mozart (14) with the same architecture as before. Input piece details are in Appendix Section C.\nTo verify each derived centroid g musically characterizes its corpus C, we use rustworkx [Treinish et al., 2022] to enumerate the set of all 5-node subgraphs (\\{S_5\\}) common to every STG in C, thus extracting the most structurally salient musical relationships in C. For each C, we evaluate the percentage of the graphs in \\{S_5\\} that are also subgraphs of g; i.e. we evaluate how well g captures the most structurally salient musical relationships in C (Table 6). On average, 70.33% of each \\{S_5\\} aligns perfectly with g, confirming each centroid captures the musically essential information of its corpus. To visualize these essential musical substructures, consider a 5-node subgraph common to the Mozart corpus and captured in its centroid (Figure 7). This reveals that a characterizing feature of the Mozart corpus is two consecutive major chords in the same major key, which in turn falls in a motif/pattern."}, {"title": "7 Conclusion and Future Work", "content": "We presented the structural temporal graph (STG) to encapsulate complete, hierarchical musical structure; a measure of structural distance between STGs; and an algorithm to derive a centroid STG structurally representing a music corpus. We showed structural distance and derived centroids both mathematically approximate ground truth; structural distance accurately differentiates music pieces; and derived centroids capture the essential structural relationships of their corpora.\nThe STG and derived centroids lay the groundwork for structured, controllable sequence data generation. For example, users could modify the STG of a generated music piece to update constraints on a generative model. Beyond music, the STG can model structural hierarchies for any sequence data given algorithms for analyses at each level. For instance, an STG could encode a poetry hierarchy-verses, stanzas, lines\u2014with its centroid structurally summarizing the poetry corpus. Such applications enable human refinement of machine-generated data to meet desired structural specifications across fields."}, {"title": "A Nested Alignment Annealer Cooling Schedule in Centroid Annealing", "content": "Recall that as the centroid annealer's temperature cools, the loss converges as the centroid is increasingly closely aligned to its corpus. Thus, as the centroid annealer's temperature cools, we scale down the number of steps and max temperature of the nested alignment annealer. Specifically, given the hyperparameters $T_{initial\\_max}$ (initial max temperature), $T_{final\\_max}$ (final max temperature), $S_{initial}$ (initial number of steps), and $S_{final}$ (final number of steps) of the nested alignment annealer, its current temperature $T_{curr}$ and current number of steps $S_{curr}$ are as follows:\n\\[(1)\\qquad R = \\frac{T_{curr} - T_{min}}{T_{max} - T_{min}} \\]\nwhere $T_{curr}, T_{min}$, and $T_{max}$ are the current, min, and max temperatures of the outer centroid annealer. R measures the normalized cooling ratio of the centroid annealer, i.e. the proportion of cooling that is complete.\n\\[(2)\\qquad T_{curr} = T_{initial\\_max}.R + T_{final\\_max} (1 - R) \\]\n\\[(3)\\qquad S_{curr} = \\lfloor (S_{initial} \\cdot R + S_{final} \\cdot (1 \u2013 R)) \\rfloor \\]"}, {"title": "B Guided Example of Centroid Generation", "content": "To better comprehend the centroid derivation process in Sections 4 and 5", "text": "Beethoven's Biamonti Sketch No. 461. The second STG is from Beethoven's Biamonti Sketch No. 811. Both STGs were built using the process in Section 3.\n(ii) We augment both STGs from (i) as in Section 4. The implicit structure encoded in the node labels in (i) is now explicitly encoded in the graph's topology in (ii) in Figure 8 via the yellow prototype nodes", "feature\\_name": "feature\\_value. The names and possible values of the features for each level of the STGs in Figure 8 are explicated in Table 7.\n(iii) Since all structure is now explicit and we can reason about the graphs isomorphically, we can now apply the nested simulated annealing procedure from Sections 4.1 and 5.1 to obtain the approximate centroid STG for the corpus. Some"}]}