{"title": "AirRadar: Inferring Nationwide Air Quality in China with Deep Neural Networks", "authors": ["Qiongyan Wang", "Yutong Xia", "Siru Zhong", "Weichuang Li", "Yuankai Wu", "Shifen Cheng", "Junbo Zhang", "Yu Zheng", "Yuxuan Liang"], "abstract": "Monitoring real-time air quality is essential for safeguarding public health and fostering social progress. However, the widespread deployment of air quality monitoring stations is constrained by their significant costs. To address this limitation, we introduce AirRadar, a deep neural network designed to accurately infer real-time air quality in locations lacking monitoring stations by utilizing data from existing ones. By leveraging learnable mask tokens, AirRadar reconstructs air quality features in unmonitored regions. Specifically, it operates in two stages: first capturing spatial correlations and then adjusting for distribution shifts. We validate AirRadar's efficacy using a year-long dataset from 1,085 monitoring stations across China, demonstrating its superiority over multiple baselines, even with varying degrees of unobserved data. The source code can be accessed at https://github.com/CityMind-Lab/AirRadar.", "sections": [{"title": "Introduction", "content": "Air pollution poses a significant global health threat, causing numerous premature deaths annually. Pollutants such as CO, SO2, and PM2.5 continuously contaminate the air we breathe, exceeding the World Health Organization (WHO) standards for over 90% of the global population (Vallero 2014). This widespread problem necessitates urgent and comprehensive solutions for social welfare, aligning with the Sustainable Development Goals (Rafaj et al. 2018).\nGiven this context, monitoring real-time air quality is crucial for informing effective interventions and policies aimed at safeguarding both public health and the environment. However, the substantial costs associated with establishing monitoring stations, often exceeding 0.2 million USD per station (Zheng, Liu, and Hsieh 2013), along with their limited quantity and distribution, present a significant challenge to achieving comprehensive data coverage.\nOver the past decade, air quality inference (Zheng, Liu, and Hsieh 2013) has focused on estimating real-time air quality in areas lacking sensors using data from existing ones. Early studies utilized non-parametric methods like k-Nearest Neighbors (Cover 1968) and Kriging (Oliver and Webster 1990). With deep learning advances, DL-based model have become prominent for capturing complex spatial correlations among monitoring stations (Cheng et al. 2018; Han, Lu, and Chen 2021; Hu et al. 2023; Cheng et al. 2024b). However, these models are mostly limited to small-scale tasks at the city level.\nIn this work, our focus shifts to inferring air quality spanning the Chinese Mainland based on thousands of available monitoring stations, as depicted in Figure 1. This encompasses regions with dense sensor coverage as well as remote areas where sensors are sparsely distributed. Such extensive coverage not only delivers more valuable information to the public with high social impacts but also provides a richer dataset that benefits model training (Zhao et al. 2015).\nNationwide air quality inference faces notable challenges, particularly in capturing complex spatial correla-"}, {"title": "Preliminary", "content": "Problem Formulation\nWe represent current air quality readings as X \u2208 R^{N\u00d7D}, where N is the number of monitoring stations and D the number of measurements, including air quality and meteorological data. Historical data is denoted as P \u2208 R^{N\u00d7T\u00d7D}, with T representing past time points. A set of nodes V includes observed and unobserved stations, where unobserved nodes lack readings. Given current and historical readings of observed nodes, the goal is to learn a function f to infer air quality at unobserved nodes:\nX' = f(X, P)  (1)\nwhere ~ represents masking. X' denotes the inferred results for all nodes, with PM2.5 as the primary pollutant."}, {"title": "Related Works", "content": "Air Quality Inference. Accurately inferring air quality is paramount for societal well-being. As air quality research progresses, models integrate multi-source data to make detailed inferences. Traditional methods (Fawagreh, Gaber, and Elyan 2014; Cheng, Peng, and Lu 2020; Cheng et al. 2024b) often rely on distance-based features, limiting their ability to capture site significance. Different from these models, certain studies (Cheng et al. 2018; Han, Lu, and Chen 2021) incorporate the attention mechanism to assign sensor weights automatically but face challenges with sparse data and providing detailed insights. Recently, STGNP (Hu et al. 2023) introduced the Graph Neural Process for spatial extrapolation tasks. STFNN (Feng et al. 2024) integrates both spatial and temporal viewpoints, utilizing fields and graphs to enhance the accuracy of air quality inference. While these models have made strides in air quality inference, they fall short in addressing two critical challenges: the complex spatial correlations and spatial heterogeneity.\nNeural Networks for Spatial Learning. Neural networks have been widely applied in spatial learning, leveraging various architectures to capture spatial dependencies. GNNs (Wu et al. 2022; Li et al. 2022) are commonly used to model spatial relationships in non-Euclidean space. CNNs (Guo et al. 2019b; Khosravi et al. 2020) are often employed to capture local spatial features by processing data with grid-like topologies, such as images or regular grids. Recently, Transformers (Wu et al. 2020; Hao et al. 2024) have also been adapted for spatial learning, offering an attention mechanism to capture long-range dependencies. Each of these approaches contributes uniquely to enhancing spatial learning capabilities in different tasks.\nCasual Inference. Causal inference (Pearl, Glymour, and Jewell 2016) aims to explore causal relationships between variables, promoting stable and robust learning and inference processes. The integration of deep learning techniques with causal inference has demonstrated significant potential in spatial-temporal mining tasks (Xia et al. 2024; Luo et al. 2024). In this study, we apply causal methods to address spatial heterogeneity in the air quality inference task."}, {"title": "Methodology", "content": "Figure 3 depicts the framework of AirRadar, which consists of input masking and three learning modules. To address the issue of the target node lacking prior information, a shared learnable token is employed to mask the features of target nodes. During training, stations are masked as target nodes, while areas lacking stations serve as target nodes during inference (See Figure 2 Right). We subsequently process the masked inputs with the following modules:\n\u2022 Embedding module: We utilize a fully-connected layer to transform the masked air quality data into feature space and integrate observed features with historical features to obtain an initial representation for each node.\n\u2022 Spatial Learning Module: This module integrates spatial correlation from both local and global perspectives. The local part uses dartboard projection to efficiently incorporate local spatial information, while the global part transforms the feature from the spatial domain to the frequency domain to effectively capture global relationships.\n\u2022 Casual Learning Module: We begin by constructing a structural causal model to illustrate how various contexts influence air quality. We then implement backdoor adjustment by dynamically allocating weights to each context, effectively mitigating confounding effects."}, {"title": "Embedding Module", "content": "Considering that observed data and historical data can provide essential information for inferring the air quality of unobserved nodes, we have taken these data into our input. However, the target nodes are without any prior information. Inspired by MAE (He et al. 2022), we employ a shared learnable token \u03c3 to mask the data of target nodes. Then we transform the masked data into feature space, resulting in X \u2208 R^{N\u00d7E} and P \u2208 R^{N\u00d7E}. Finally, we combine the observation and historical data to create an initial spatial representation for each node, denoted as H\u2208R^{N\u00d72E}."}, {"title": "Spatial Learning Module", "content": "We introduce the Spatial Learning Module, a novel spatial learner designed to capture spatial correlations from local and global perspectives based on the principle of spatial auto-correlation. Our Spatial Learning Module boasts a substantial receptive field with computational complexity less than quadratic. Figure 3b outlines its pipeline. Each block (indexed by l) takes the hidden state Z^{l\u22121} as input, with H serving as the initial embedding Z^0. This input is split into two parts: the local module (left side) and the global module (right side). In the subsequent parts of this section, we will detail these two key parts respectively.\nLocal Spatial Correlation. Beyond local emissions, a place's air quality is also affected by neighboring areas. Directly using standard MSA will result in a square increase in costs, thus our objective is find a new way to efficiently capture local spatial correlations. We drew inspiration from (Liang et al. 2023) and used a dartboard projection to achieve this. As depicted in Figure 4, node i's local range is defined using a dartboard, which divides its neighborhood space into several distinct regions. Nodes positioned beyond the outermost circle fall outside the local range. Different from (Liang et al. 2023), we modify the orientation of the central angle to align with the potential wind direction, thereby enhancing integration with external factors such as wind direction and the interpretability of the model.\nThe latent features Z^{l\u22121} are used to generate the query vector Q for each node. For the query nodes, the key vector and value vector are obtained via dartboard projection. The dartboard projection matrix for each node i is represented as M_i \u2208 R^{G\u00d7N}, indicating how nearby nodes are mapped to G regions defined by the line fragments and circles. Here, each entry m_{is} = 1 signifies that the s-th node belongs to the j-th region. We employ the dartboard projection matrix to project the node features into local regional representations. The projected features of each region R_i \u2208 R^{G\u00d72E} are generated by:\nR_i = M_iF = \\sum_{j=1}^{N} v_i m_{ij} f_j,  (2)\nwith projection matrix M_i and normalized node features f_j \u2208 R^{2E}. The ensuing step involves concatenating these representations after dartboard projection R = [R_1, R_2, ..., R_N]. Subsequently, we feed this regional representation into linear layers to generate the key vector K_h \u2208 R^{N\u00d7G\u00d72E} and value vector V_h \u2208 R^{N\u00d7G\u00d72E}. The implementation of multi-head self-attention efficiently captures detailed local spatial correlations between the query node and its neighboring regions, as articulated by:\nX_h = \\text{Softmax}(\\frac{Q_h K_h^T}{\\sqrt{E}} + B_h)V_h, (3)\nwhere B_h \u2208 R^{N\u00d7G} is a learnable relative position encoding. This local spatial learner integrates domain knowledge of air diffusion while addressing computational expense. With a smaller number of regions (G \u226a N), the computational complexity, O(NGE), grows linearly with the number of stations, proving more efficient than standard MSA with complexity O(N^2E).\nGlobal Spatial Correlation. In the context of air quality inference, beyond accounting for local spatial relationships, it is essential to incorporate considerations of global spatial relationships, i.e., impact from other cities.\nTo avoid the computational complexity growth with the quadratic cost, we consider using the Fourier Neural Operator (FNO) to reduce the computational burden, inspired by (Li et al. 2020a). We first conceptualize the process of self-attention as a continuous kernel integrals (Guibas et al. 2021; Li et al. 2020b), denoted as follows:\n\u03b6(\u03a7)(i) = \u222b_{D} \u03ba(i, j)X(j) dj \u2200i \u2208 D, (4)\nwhere (\u03b6(\u03a7))(i) is equivalent to the i-th row of the similarity matrix Att \u2208 R^{N\u00d7N}.\nThis means that when calculating (\u03b6(\u03a7))(i), the information on the entire domain is considered and the global information is captured. Furthermore, this operation can be efficiently implemented by FFT with computational complexity O(NElogN):\n\u03b6(X)(i) = F^{-1}(F(\u03ba) \u22c5 F(X))(i) \u2200i \u2208 D, (5)\nwhere \u22c5 denotes matrix multiplication and F, F^{-1} denote the FFT and its inverse, respectively.\nWe treat each node as the token in the sequence. For the input feature Z^{l\u22121} \u2208 R^{N\u00d72E}, we need to define the complex-valued weight tensor W to parameterize the kernel. To reduce the parameter count, we impose a block diagonal structure on W, where it is divided into K weight blocks of size 2E/K \u00d7 2E/K. Therefore, the global spatial mixing operations are defined as follows:\ng_i = [\\text{FFT}(Z^{l-1})]_i\ng^k_i = W_k g_i + b_k k = 1, 2, ..., K\n\u011d_i = [\\text{IFFT}(S(g_i^k))]_i (6)"}, {"title": "Casual Learning Module", "content": "In air quality inference, as the geographical scope widens, the challenge of spatial heterogeneity emerges. To tackle this, we leverage causality theory by establishing a Structural Causal Model (SCM) (Pearl et al. 2000). In the SCM shown in Figure 5a, C, X, and Y denote random variables for spatial context, observed data, and target area air pollutants, respectively, with arrows representing causal-effect relationships. Based on the above definitions, the causal relationships in Figure 5a can be denoted as P(X,Y|C) = P(X|C)P(Y|X, C').\nConfounder & Intervention. We observe that there exists a backdoor path X \u2190 C \u2192 Y between X and Y, where context C acts as a confounding factor. However, this confounding influence of C is undesirable for accurate inference, as it introduces potential bias in the model's inference. The backdoor adjustment (Yang et al. 2022; Sui et al. 2022; Xia et al. 2024) can cut off the causal relationship from C to X to mitigate the confounding effects, as shown in the red dashed arrow in Figure 5b. Therefore, we employ a backdoor adjustment to estimate Y via P(Y|do(X)) by stratifying into discrete pieces C = {C_i}_{i=1}^C as:\nP(Y|do(X)) = \\sum_{i=1}^{C} P(Y|X, C = c_i)P(C = c_i) (7)\nAlthough the backdoor path may seem effectively severed, optimizing with Eq. 7 becomes intractable due to challenges in defining c_i and the unknown prior distribution P(C). To overcome this, we treat C as a latent variable obtained by a variational distribution Q(C|X) (Yang et al. 2022).\nEstimating this distribution is facilitated by the Casual Learning Module, illustrated in Figure 3c. Assuming that the contexts are independent can lead to overfitting issues, thus we denote a context as a 0-1 matrix, i.e.,\nC_k = \\text{stack}[c^k_1, c^k_2, ..., c^k_n] (8)\nwhere U denotes the number of layers and K denotes the number of contexts. Each context type corresponds to a specific combination of inference units. To comprehensively consider the influence of various contexts, we design a network that can dynamically allocate weights:\nY^{l+1} = \\sum_{k=1}^{K} \u03a8^l(Y^l) [k] \u03a6(Y^l), (9)\nwhere \u03a8 is the dynamic weight allocation structure and \u03a6 is the context-specific encoder. The computation represents a realization of c drawn from the conditional distribution Q(CX = X). As shown in Figure 6, different contexts may be linked by sharing the same inference units at certain layers, serving as an effective inductive bias that helps the model eliminate the influence of spatial heterogeneity and generalize to unseen areas."}, {"title": "Inference & Optimization", "content": "Upon obtaining the final feature representation Y, we employ an MLP for feature reconstruction to restore the air quality data of all nodes as:\nX' = \\text{MLP}(Y) (10)\nwhere X' \u2208 R^{N\u00d7D} is the reconstrued data for all nodes. This process culminates in the completion of the target inference. For optimization, we utilize the L1 loss as the loss function L, expressed as follows:\n\u2112(X, X') = \\frac{1}{N_u} \\sum |X_i - X'_i| (11)\nwhere N_u is the number of unobserved nodes. Note that we exclusively compute the loss for the target nodes."}, {"title": "Experiments", "content": "In this section, we conduct experiments to address the following research questions:\n\u2022 RQ1: Can AirRadar outperform existing approaches on real-time air quality inference in the Chinese Mainland?\n\u2022 RQ2: How does each component affect performance?\n\u2022 RQ3: What is the effect of the major hyperparameters?\n\u2022 RQ4: How is the practicality of AirRadar?"}, {"title": "Model Comparison (RQ1)", "content": "To answer RQ1, we perform a model comparison in terms of MAE, RMSE, and MAPE. Table 1 presents the experimental results over the nationwide dataset. Our model significantly outperforms all competing baselines over all kinds of missing ratios. Compared to the STFNN, our approach reduces MAE by approximately 28% to 44.9% in each missing ratio. There are three primary reasons for the efficacy of our model. Firstly, our method effectively captures comprehensive spatial correlations. Secondly, AirRadar leverages backdoor adjustment to eliminate confounding effects and dynamically assigns weights to each potential context representation. Lastly, using the learnable token to represent the target node empowers robust inference even for unobserved nodes. In contrast, traditional models (KNN, RF) lack strong learning capabilities, while AE-based, NN-based, and NP-based models struggle with spatial range and diversity, limiting their adaptability for nationwide air quality inference."}, {"title": "Ablation Study (RQ2)", "content": "To evaluate the individual contributions of each component to our model's overall performance and address RQ2, we conduct ablation studies. The results are presented in Figure 7 and Table 2. Each study involves modifying only the corresponding part while keeping other settings unchanged.\nEffects of Historical Data. As a pivotal component of AirRadar, historical data plays a fundamental role in offering prolonged observations of the environmental background, encompassing factors such as meteorological conditions and seasonal variations. As illustrated in Figure 7, the exclusion of historical data leads to a noticeable decline in performance across all missing ratios.\nEffects of Spatial Learning Module. To assess the impact of the Spatial Learning Module, we examine the following variants for comparison: a) w/o Local: The local component in the Spatial Learning Module is disabled, meaning that no local spatial relationships are considered. b) w/o Global: The global component in the Spatial Learning Module is omitted, indicating that the global spatial correlation is not taken into account in this model. The results are shown in the Table 2. When eliminating both local and global components, we observe a significant deterioration in MAE, especially from removing the global part. This highlights the importance of considering spatial correlations from both perspectives. Second, AirRadar obtains lower inference errors overall missing ratios, while running 44% faster than GraphMAE. This advantage indicates that our Spatial Learning Module holds significant promise as a fundamental component for capturing complex spatial dependencies."}, {"title": "Effects of Casual Learning Module", "content": "To evaluate the effectiveness of the Casual Learning Module in addressing spatial heterogeneity challenges, we compare our model with the following variants: a) w/o Causal: The entire Casual Learning Module is omitted from our AirRadar. b) w/o Adaptive: The dynamic weight allocation mechanism is excluded from the Casual Learning Module. The outcomes are presented in Figure 7. When the causal module is omitted, the model fails to mitigate the influence of potential context and, consequently, cannot address the spatial heterogeneity issue. Absent the adaptive module, the model is unable to account for varying impacts introduced by different contexts, resulting in a performance decline."}, {"title": "Hyperarmeter Study (RQ3)", "content": "In response to the final research question, we explore the impact of varying the hidden dimension E, the number of Spatial Learning blocks L, the number of contexts C, and the sparsity threshold \u03bb on the MAE, with a fixed missing rate of 75%. Figure 8a presents the results of AirRadar with different values of C. Interestingly, we observe that the performance is not strictly proportional to the number of contexts, and we establish C = 4 as our default setting based on these findings. We experiment with different sparsity thresholds \u03bb ranging from 0 to 1. The MAE reaches its peak at \u03bb = 10\u22122, demonstrating the efficacy of the sparsity measure.\nFigure 8b investigates the number of Spatial Learning blocks (L). It becomes evident that the model's performance improves as L increases, but this improvement comes at the cost of a rapid growth in the number of parameters. Notably, when L = 3, we achieve a similar level of accuracy without the excessive parameter increase. Figure 8c further delves into the influence of the hidden dimension E. Here, we make two key observations: 1) A very small E (e.g., 8) results in diminished performance due to its limited capacity. 2) E = 64 yields similar performance, but it comes with a substantial increase in computational cost."}, {"title": "Practicality (RQ4)", "content": "To verify the model's practicality, we deploy a web-based system for monitoring air quality and inferring nationwide air quality in China, as shown in Figure 2. Each point on the map corresponds to an air quality monitoring station and the the associated number signifies the respective air quality data at that station. The system's practicality lies in integrating real-time data from numerous stations, providing accessible air quality information nationwide."}, {"title": "Conclusion & Future Work", "content": "In this paper, we introduce AirRadar for nationwide air quality inference in China. AirRadar efficiently captures intricate spatial correlations from both local and global perspectives, addressing the challenge of spatial heterogeneity through backdoor adjustment techniques with an adaptive weight mechanism. Our model can achieve state-of-the-art performance on a nationwide air quality dataset with different missing ratios. Accompanying our model, we develop a web system capable of leveraging air quality data from existing monitoring stations to infer air pollutants of regions without monitoring stations. In the future, we will consider online learning and explore the application of our model in other domains, such as traffic and climate."}]}