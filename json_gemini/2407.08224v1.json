{"title": "stEnTrans: Transformer-based deep learning for\nspatial transcriptomics enhancement", "authors": ["Shuailin Xue", "Fangfang Zhu", "Changmiao Wang", "Wenwen Min"], "abstract": "The spatial location of cells within tissues and organs is cru-\ncial for the manifestation of their specific functions. Spatial transcrip-\ntomics technology enables comprehensive measurement of the gene ex-\npression patterns in tissues while retaining spatial information. However,\ncurrent popular spatial transcriptomics techniques either have shallow\nsequencing depth or low resolution. We present stEnTrans, a deep learn-\ning method based on Transformer architecture that provides compre-\nhensive predictions for gene expression in unmeasured areas or unex-\npectedly lost areas and enhances gene expression in original and inputed\nspots. Utilizing a self-supervised learning approach, stEnTrans estab-\nlishes proxy tasks on gene expression profile without requiring additional\ndata, mining intrinsic features of the tissues as supervisory information.\nWe evaluate stEnTrans on six datasets and the results indicate superior\nperformance in enhancing spots resolution and predicting gene expres-\nsion in unmeasured areas compared to other deep learning and tradi-\ntional interpolation methods. Additionally, Our method also can help\nthe discovery of spatial patterns in Spatial Transcriptomics and enrich\nto more biologically significant pathways. Our source code is available at\nhttps://github.com/shuailinxue/stEnTrans.", "sections": [{"title": "Introduction", "content": "Traditional gene expression researches typically focus only on the overall gene\ntranscript counts in entire tissues, lacking the preservation of spatial positioning\ninformation within the tissue. The spatial position of cells within tissues can\nhave a significant impact on their functions. Therefore, neglecting the spatial\ninformation of cells may lead to an insufficient understanding of gene functions\nand regulatory mechanisms. Spatial transcriptomics (ST) technology aims to\ndetect the quantity of gene transcripts within tissues while preserving spatial\nlocation information [21]. ST technology provides the capability to examine in\ndetail the spatial distribution of gene expression at the tissue or cellular level."}, {"title": "Method", "content": "Our model undergoes two distinct phases: Pretrain and Enhance (Fig. 1). During\nthe Pretrain phase, We utilize down-sampling on the original gene expression"}, {"title": "Data Pre-processing", "content": "stEnTrans only requires a gene expression matrix with spatial coordinates. We\ndefine the ST data as two matrices: (1) gene expression matrix, \\(X_{m \\times n}\\), which\ncontains m spots and n genes. The value of \\(X_{ij}\\) represents the expression level\nof j-th gene in the i-th spot. (2) spatial coordinate matrix, \\(C_{m \\times 2}\\). Its i-th row\ncorresponds to the same spot as the i-th row of matrix \\(X_{m \\times n}\\). The values of \\(C_{i0}\\)\nand \\(C_{i1}\\) constitute the coordinate information of the i-th spot in two-dimensional\nspace. We treat the expression of each gene in space as a sample.\nData source All datasets analyzed in this paper are existing and publicly avail-\nable. The human melanoma ST data (HM) can be found at https://www.spatia\nlresearch.org/resources-published-datasets/doi-10-1158-0008-5472-c\nan-18-0747 [26]. The STARmap mouse placenta (MP) can be found at https:\n//codeocean.com/capsule/9820099/tree/v1 [9]. The Stereo-seq data from the\nadult mouse hemi-brain (AMHB) can be found https://db.cngb.org/stomic\ns/mosta/ [5]. The human breast cancer spatial transcriptomics data (HBC) is\navailable from the https://www.10xgenomics.com/products/xenium-in-sit\nu/preview-dataset-human-breast [12]. The Human Invasive ductal carcinoma\nspatial transcriptomics data (IDC) is available from the https://support.10xg\nenomics.com/spatialgene-expression/datasets/1.2.0/V1_Human_Invasive_\nDuctal_Carcinoma. The mouse brain sagittal posterior data (MBSP) is avail-\nable from the https://www.10xgenomics.com/datasets/mouse-brain-seria\nl-section-1-sagittal-posterior-1-standard-1-1-0.\nPre-processing for gene expression matrix The j-th column of X rep-\nresents the expression level of the j-th gene in the tissue. We denote this m-\ndimensional vector as \\(X^{j}\\). Based on spatial coordinate information of all spots,\n\\(X^{j}\\) can be mapped onto a plane and transformed into a matrix of shape (u,\nv). We denote this matrix as \\(G^{j}\\), which can be considered as a gene expression\nprofile. Specifically, the value at the \\(r_i\\)-th row and \\(c_j\\)-th column of \\(G^{j}\\) represents\nthe expression level of the j-th gene in the spot with coordinates \\((r_i, c_j)\\).In ad-\ndition, we need whether-in-tissue matrix M, which has the same shape as \\(G^{j}\\),\nto indicate the presence or absence of spots. All its elements are either 0 or 1."}, {"title": "Self-supervised learning", "content": "In the realm of data enhancement for spatial transcriptomics, where no labels\nare available, so we employ a self-supervised learning approach [13]. We design\nauxiliary tasks that utilize the data itself as supervisory information. The entire\nprocess is divided into two phases, denoted as Pretrain and Enhance (Fig. 1). In\nPretrain phase, we train the model using both LR and original gene expression\nprofiles. Then in Enhance phase, we input the original data and obtain HR gene\nexpression profiles.\nPretrain phase stEnTrans achieves gene expression interpolation by employing\nTransformer Encoder [27] to extract global features of the spatial distribution of\nall genes within the tissue, thereby extending the size of the gene expression pro-\nfiles from (u, v) to (2u, 2v) (Fig. 1). In this phase, we train model on the LR gene\nset \\(G_{lr} = \\{G_{lr}^{0}, G_{lr}^{1},\\dots,G_{lr}^{n-1}\\}\\) and original gene set \\(G = \\{G^{0},G^{1},\\dots,G^{n-1}\\}\\)."}, {"title": "Details of the proposed stEnTrans", "content": "Transformer uses self-attention mechanisms to capture dependencies among dif-\nferent positions in the input sequence, modeling interactions among all tokens\n[27] (Fig. 1). The standard Transformer architecture is designed for processing\n1-D sequential data. To adapt it for handling 2-D gene expression maps, we re-\nshape the maps into a series of patches [7]. P represents the height and width\nof the patches. Suppose that size of the input x is (H, W), so the desired size\nof the output is (2H, 2W). We achieve this by applying four trainable convo-\nlutional structures, where the convolutional kernel size and stride are both set\nto patch size, followed by concat, and finally flattening to map the tokens to\n\\(4 \\times P^{2}\\) dimensions. In addition, if the size of the input profile are not multiples\nof the patch size, we need to perform zero-padding on the profile. This process\ncorresponds to the patch embedding in stEnTrans:\n\\(x_{k} = x * W_{k} + b_{k}, k = 0,1,2, 3,\\)\n\\(x' = concat(x_{0}, x_{1}, x_{2}, x_{3}),\\)"}, {"title": "Experimental Results", "content": "To validate the interpolation capability of stEnTrans, we evaluated two genes\nwith different spatial patterns on IDC data, ZNF703 and MUC1. We used down-\nsampled data as simulation, the original data as ground truth, and applied stEn-\nTrans, DIST [32], Linear, Cubic, NN and NEDI [16] for interpolation on the"}, {"title": "More accurate interpolation capability", "content": "To further illustrate the superiority of stEnTrans, we calculated the Pearson cor-\nrelation coefficients (PCC) between ground truth and each imputed expression\nfor all spots of the genes after quality filtering across six datasets.\nTo illustrate that stEnTrans can also be applied to other platforms, we cre-\nated a simulated ST data from STARmap data. By proportionally mapping the\ncoordinates of these pseudo-spots in spatial dimensions and fine-tuning, we can\nsimulate array-based ST data. RNA molecules of 903 genes have been determined\nin the mouse placenta for this dataset. ClusterMap clusters RNA into subcel-\nlular structures, generating 7224 pseudo-spots representing subcellular sizes [9],\nwhich closely align with our simulated data. Continuing, we simulated another\nST data from Stereo-seq data, which provides subcellular resolution spatial ex-\npression in the adult mouse hemi-brain [5], using the same spatial coordinate\nmapping method as described above. Additionally, there is one real ST dataset\nand three 10X Visium datasets. We calculated PCCs between ground truth and\neach imputed expression for all spots of the genes after quality filtering across\nthe aforementioned six datasets and showed the results in (Fig. 3).\nstEnTrans achieved higher median in gene prediction PCCs between im-\nputed and true expression compared to all other methods across six different\ndatasets (median: in HM data, stEnTrans=0.636; in MP data, stEnTrans=0.554;\nin AMHB data, stEnTrans=0.513; in HBC data, stEnTrans=0.584; in MBSP\ndata, stEnTrans=0.606; in IDC data, stEnTrans=0.537). Even in HM data, HBC"}, {"title": "Better help to discover spatial patterns", "content": "Next, we explore whether stEnTrans can help discover spatial patterns in melanoma\nST data. We utilize a tool, Sepal, which employs diffusion-based modeling to\nidentify transcripts with spatial patterns in the transcript profiles [2]. This\nmethod is applied to original and imputed mel ST data using stEnTrans. Follow-\ning Sepal's standards, we rank each transcript profile according to their degree\nof randomness, and then extract the top-150 transcript profiles as experimental"}, {"title": "Ablation Study", "content": "To assess the contributions of absolute positional encoding (denote as Pos) and\nthe Res module to performance, we conducted a ablation study. Our ablation\nstudy is based on simulated ST data from STARmap mouse placenta (MP),\nsimulated ST data from Stereo-seq adult mouse hemi-brain (AMHB), human\nmelanoma ST data (HM), Human Invasive ductal carcinoma spatial transcrip-\ntomics data (IDC), human breast cancer spatial transcriptomics data (HBC),\nmouse brain sagittal posterior data (MBSP). All experiments are evaluated us-\ning PCC.\nSpecifically, we initially assessed the performance of the original model by\ncalculating PCCs on six datasets as the baseline for comparison. Subsequently,"}, {"title": "Discussion And Conclusion", "content": "In our research, we propose stEnTrans, a deep learning method based on Trans-\nformer, which can impute the gene expression on unmeasured areas that are not\ncovered between spots and accidentally lost locations during sequencing through\nself-supervised learning, enhance the expression of all spots, and thus compre-\nhensively improve the quality of spatial transcriptomics data. Our method does\nnot rely on any other data, such as histological images, and only requires a gene\nexpression matrix with spatial coordinates to improve gene expression profiles to\nhigh resolution. Compared with other methods of similar function, it has higher\nprecision and the obtaining high-resolution gene expression profiles have more\ndelicate and smooth characteristics.\nIn spatial transcriptomics studies, identifying genes with spatial expression\npatterns is very important for researching various physiological and pathologi-\ncal processes. However, due to limitations in existing technologies, the statistical\npower is often low, making it challenging to identify genes with spatial expression\npatterns within small local regions using raw spatial transcriptomic data. stEn-\nTrans has the capability to enhance the resolution of gene expression profiles,\nwhich can help to discover the spatial patterns of genes, making disease-related\ngenes have more significant spatial patterns. In addition, it can also help to\ndiscover more biologically meaningful pathways.\nThe results of ablation experiments show that both Res module and absolute\nposition encoding are indispensable to the network and can improve the perfor-\nmance of the network, but the use of absolute position encoding has a higher\nimpact on improving the network's performance."}]}