{"title": "On the design space between molecular mechanics and machine learning force fields", "authors": ["Yuanqing Wang", "Kenichiro Takaba", "Michael S. Chen", "Marcus Wieder", "Yuzhi Xu", "John Z. H. Zhang", "Kuang Yu", "Xinyan Wang", "Linfeng Zhang", "Daniel J. Cole", "Joshua A. Rackers", "Joe G. Greener", "Peter Eastman", "Stefano Martiniani", "Mark E. Tuckerman"], "abstract": "A force field as accurate as quantum mechanics (QM) and as fast as molecular mechanics (MM), with which one can simulate a biomolecular system efficiently enough and meaningfully enough to get quantitative insights, is among the most ardent dreams of biophysicists\u2014a dream, nevertheless, not to be fulfilled any time soon. Machine learning force fields (MLFFs) represent a meaningful endeavor towards this direction, where differentiable neural functions are parametrized to fit ab initio energies, and furthermore forces through automatic differentiation. We argue that, as of now, the utility of the MLFF models is no longer bottlenecked by accuracy but primarily by their speed (as well as stability and generalizability), as many recent variants, on limited chemical spaces, have long surpassed the chemical accuracy of 1 kcal/mol\u2014the empirical threshold beyond which realistic chemical predictions are possible-though still magnitudes slower than MM. Hoping to kindle explorations and designs of faster, albeit perhaps slightly less accurate MLFFs, in this review, we focus our attention on the design space (the speed-accuracy tradeoff) between MM and ML force fields. After a brief review of the building blocks of force fields of either kind, we discuss the desired properties and challenges now faced by the force field development community, survey the efforts to make MM force fields more accurate and ML force fields faster, and envision what the next generation of MLFF might look like.", "sections": [{"title": "Introduction: The past, present, and future of force fields.", "content": "Computational chemists and biophysicists are interested in characterizing the energy landscape of many-body systems- the distribution of coordinates x \u2208 IRN\u00d73 at a certain state with energy U(x), which adopts a Boltzmann form\u00b9:\n\npx expU(x)kT\n\n(1)\n\nwhere N is the number of particles in a many-body system, k the Boltzmann constant, and T the temperature. In a sim- ulation, since the true (reference) energy U is almost always inaccessible, and ab initio methods are usually prohibitively expensive, one resorts to a surrogate model which models the energy landscape as a function based upon the coordinates x, the identity of the particles in the system h \u2208 RN, and a set of parameters \u03a6:\n\npx exp\u00db (x;h, \u03a6)kT\n\n(2)\n\nEvidently, the closer U and \u00db are, the smaller the divergence between the true and simulated probability distribution p and p will be. We call this parametrized scalar field \u00db : RN\u00d73 \u2192 R\u00b9 a force field (FF). Molecular dynamics (MD) is usually employed to generate samples from this distribution.\nDating back to McCammon, Gelin, and Karplus2 in 1977, molecular mechanics (MM) force fields have been curated, us- ing structural and QM data, to capture the qualitative behav- ior of biomolecular systems3\u201310 to power the in silico model- ing of all aspects of chemistry, from drug discovery to mate- rial sciences. The blessing and the curse of MM force fields both lie in their simple functional forms (Equation 9). On the one hand, these terms afford linear (N) runtime complex- ity and can be further aggressively optimized in modern com- pute hardware namely graphics processing units (GPU), sim- ulating more than hundreds of nanoseconds per day for many biomolecular drug targets11\u201314 while still achieving useful ac- curacy for tasks such as predicting protein-ligand binding free energies15-17. At the same time, the limited expressiveness of this functional form dictates that it is impossible to fit the QM energies and forces well, especially in the high-energy region-see Figure 2 for a comparison of QM and MM ener- gies of a very simple ethanol molecule in the MD1718 dataset, although they recover the position of QM minima relatively well19. Worse still, even within the limits of this functional form, there is no guarantee that maximal expressiveness has been achieved, as the assignment of parameters to the chemi- cal motifs (atoms, bonds, angles, and torsions) in a MM force field has been relying on a human-derived, labor-intensive, and inextendable scheme termed atom typing, where atoms of distinct nature are forced to share parameters. Takaba et al. 20 shows that, on very limited chemical space and low energy re- gion, the energy disagreement between legacy force fields and QM is far beyond the chemical accuracy of 1 kcal/mol\u2014the empirical threshold under which we believe that the qualita- tive characterization of a many-body system is possible. And even when coupled with a trainable, flexible parametrization engine, the training accuracy still cannot exceed the chemical accuracy. Limitations exist in both the functional form and parametrization steps of MM force fields.\nAnother line of fruitful research22\u201333 focuses on develop- ing machine learning force fields (MLFFs) with flexible func- tional forms to fit the energy (and force) landscape of ab initio calculations. Typically, the energy is predicted by a (typically equivariant or invariant) neural network, whereas the forces are given by using automatic differentiation w.r.t. the posi- tions of particles. We argue that the energy and force accu- racy of machine learning force fields is no longer a limiting factor for the wide applications thereof, as most such models achieve an energy error well below the chemical accuracy of 1 kcal/mol. Besides stability and generalizability, the speed of MLFFs, is what prevents them from wide applications\u2014 although they are usually by magnitudes faster than QM cal- culations (and scale linearly w.r.t. the size of the system), they are still hundreds of times slower than MM force fields. For small molecule systems up to 102 atoms, some of the fastest MLFFs30 still take around 1 millisecond per energy and force evaluation on an A100 GPU, compared to less than 0.005 milliseconds for MM force fields. As such, to simulate any biomolecular system of considerable size for a reasonably long time frame would usually have a prohibitive computa- tional cost, significantly limiting its deployment to further our understanding of biologically relevant systems.\nIn this review, we direct our attention to the design space (in terms of the speed-accuracy tradeoff) between ML and MM force fields. Hoping that this would inspire the design of a class of MLFF incorporating MM philosophy that is signifi- cantly faster, more stable, more interpretable, and more gen- eralizable, than current state-of-the-art MLFFs albeit slightly less accurate/expressive, we organize this review as follows: First, in Section II, we outline the desiderata of force fields. Secondly, in Section III and Section IV we briefly review the building blocks of both MM and ML force fields and re- cent advances in the functional forms and parametrizations thereof. Finally, after a discussion surrounding the datasets"}, {"title": "II. Desiderata: The balance between speed and accuracy, and beyond.", "content": "The speed and accuracy are two natural axes the community is interested in (Figure 1)\u2014a faster and more accurate force field is almost always desired. With this in mind, we review the desired properties of a force field, regardless of its type, for the applications in physical modeling.\na. Invariance. Symmetries are inherent in all physical systems. To exploit these symmetries in model construction and parametrization enhances data efficiency as it avoids un- necessary replicated manifestations of the same piece of data and avoids unphysical model interpretations. Formally, we use equivariance and invariance to describe the symmetry in functional space:\nDefinition 1 (Equivariance and invariance). A function f : X \u2192 Y is said to be equivariant to a symmetry group G if\n\nf(Tg(x)) = Sg(f(x))\n\n(3)\nand invariant if\n\nf(Tg(x)) = f(x)\n\n(4)\n\u2200g \u2208 G and some equivalent transformations on the two spaces respectively Tg : X \u2192 X and Sg : Y \u2192 Y.\nIn the three-dimensional space we happen to dwell in, the true underlying energy function adopts E(3)-invariance, where the T = Sg in Equation 3 and Equation 4 are the rotations (T(x) = xR, where R \u2208 R3\u00d73 is a rotation ma- trix RRT = I), translations (T\uff61(x) = x + \u2206x), and reflections (T(x) = Ref(x)). These hold since the coordinate system on which the Euclidean coordinates are based is artificial and arbitrary. Similarly, since the indexing of the particles is ar- bitrary, permutation equivariance and invariance are also cru- cial: Tg(x) = Sg(x) = Px, where P is the associated permuta- tion matrix. We also point out that there have been recent ef- forts showing that non-equivariant/non-invariant models can also be trained to perform on equivariant tasks35\u201337.\nb. Linear runtime complexity. One of the key applica- tions of force fields in biomolecular simulations is modeling the energy landscapes of heterogeneous biomolecules, such as protein-ligand complexes. In such cases, the number of atoms of such systems can significantly exceed 103, making the training and inference unattainably expensive if the run- time complexity is anywhere higher than quadratic (N2). At first glance, it might not be intuitive that the popular force fields, including MM (Equation 9), which have pairwise in- teractions, are linear. In practice, however, not all N2 pair- wise interactions are present in the energy function, as a cutoff function is almost always employed to mask off any interac- tion with a distance longer than a threshold L:\n\n\u03bb (\u03a71,\u03a72) ={A(||X1-X2||), ||X1-X2|| < L,0, elsewhere.\n\n(5)\nwith smooth boundary condition lim A = 0. For both\n\n||X1-X2||\u2192L\n\nML force fields, A usually is typically implemented in the form of a cosine annealing; a reaction field method38,39 is typ- ically used for Coulomb interactions whereas a polynomial switching function is used for van der Waals interactions. This goes hand-in-hand with the assumption of constant sparsity: on average, the number of interactions that fall within the cut- off boundary for each particle stays constant. (Note that this is a strong assumption that would not stand without prior knowl- edge, i.e. p(x) adopts a uniform distribution.)\nC. Energy conservation. Since the potential energy U(x) is a state function, there is zero work associated with moving a particle through a trajectory starting and ending at the same place18:\n\nW = \u222b F \u00b7 dF = 0.\n\n(6)\nThis is satisfied if the force is always implemented as the neg- ative gradient of the energy:\n\nF = -VxU(x).\n\n(7)\nNumerically, Equation 6 always stand accurately for simple functional forms such as an MM force field, but less so for ML force fields with sophisticated functional forms.\nd. Differentiability. In the previous paragraph, we have discussed the differentiation of the energy \u00db(x;h,\u03a6) w.r.t. x, which yields the force prediction. In MLFF, to en- sure that at least the first- and second-order derivatives are smooth and further differentiable, neural activation function choices are limited to those with continuous first- and second- order derivatives, such as the ELU40-family. Meanwhile, if one wishes to optimize the MM force field parameters OFF, it is also crucial to evaluate the parameter derivative d\u00db (x;h, \u03a6FF)/d\u03a6FF.\ne. Universality. Typically, there is little prior knowledge to be encoded in the inductive bias about the ab initio energy landscape except for the fact that when particles are separated far enough, the energy approaches zero. As such, at least in a limited region, the force field should be expressive enough to represent a diverse set of functions, or ideally universal, modulo the group invariance.\nDefinition 2 (Universality of invariant functions). A parametrized invariant function f(\u00b7; \u03a6) is said to be universal w.r.t. a symmetry group G on a space X if for all transfor- mations in that symmetry group \u2200T \u2208 G, and for all invariant functions g satisfying g(T(x)) = g(x), there exists a set of pa- rameters \u03a6 such that f can be approximated arbitrarily well:\n\n||g(x) - f(x, \u03a6) || < \u03b5, \u2200x \u2208 X,\n\n(8)\nfor arbitrarily small \u025b > 0."}, {"title": "III. Molecular mechanics force fields: Simple, crude, but practical for wide applications", "content": "A. Classical MM force fields\nMolecular mechanics (MM) force fields63,64 are empirical models representing atomic point masses interacting through parametrized functions of atomic coordinates. These func- tions characterize the potential energy of a system via valence (bond, angle, and torsion) and nonbonded terms, typically expressed as the sum of polynomials and truncated Fourier series. The most popular and widely used MM force field in biomolecular modeling and simulation is the Class I MM force field, primarily due to its computational efficiency, aris- ing from its simplified functional form which can be typically expressed as:\n\nUMM (X; OFF) = \u03a3bondKr2(rij\u2212ro)22+ \u03a3angle\u039a\u03bf(\u03b8ijk \u2013 00) 2+\u03a3torsion\u2211n=1nmax\u039a\u03c6,n [1 + cos(noijkl \u2013 \u03a6\u03bf)]+\u03a3Coulomb14\u03c0\u03b5\u03bf\u2211 i,j 1qiqjrij+\u03a3van der Waals4&ij((\u03c3ijrij)12\u2212(\u03c3ijrij)6),\n\n(9)\n\nwhere the total potential energy Umm as a function of the coordinates of the system x and the collection of force field parameters (Also see Section VIB) OFF = {Kr, \u039a\u03b8,\u03b3\u03bf, \u03b8\u03bf, \u039a\u03c6,\u03b7, \u03a6\u03bf,q,\u03c3,\u03b5}i is modeled as the sum of bond, angle, torsion, and nonbonded energy. The bond, angle, and torsion force constants are represented as Kr, Ke and Ko,n, with their equilibrium values and phases denoted as ro, 00 and 40, respectively. The atomic point charges are represented by q, while & and radii o parametrize the Lennard-Jones energy well. ri,j, \u0472i,j,k, i,j,k,l\u2014which represents the distance between covalently bonded atoms i, j, the angle among i \u2013 j - k, and the dihedral angle between the planes formed by i, j,k and j,k,l, respectively are simple functions extracted from the coordinates xi,j,k,l. In practice, such operations can be imple- mented as:\n\nri,j = ||ij|| = ||Xi - Xj ||;\n\n0i,j,k = atan2(||\u0161ij \u00d7\u3121jk||, \u017dij \u2022\u3121jk);\n\n\u03a6i,j,k,l = atan2((Xij \u00d7 Xjk) \u00d7 (Xjk \u00d7 \u3121kl))\u00b7Xjk||jk||,((Xij xxjk) (Xjk \u00d7\u3121kl))).\n\n(10)\nAn out-of-plane term, known as the improper torsion, can be also introduced with the torsion term to enhance the molec- ular planarity and prevent chiral inversions. In theory, multi- pole expansion such as dipole and quadrupole moments- are necessary to accurately represent the quantum mechani- cal electrostatic potential. However, empirical force fields try to approximate this multipole expansion by assigning point charges localized at the nuclei of atoms, sometimes with vir- tual sites to model lone pairs and \u03c3-holes65\u201367, in order to reproduce the same electrostatic potential that would be given by the true electronic structure and electron density distribu- tion. The van der Waals interaction combines repulsive and at- tractive forces, typically represented by a 12-6 Lennard-Jones potential. The Lorentz\u2013Berthelot68 combining rules can be employed to determine \u03c3 and & between different atom types, though alternative combination rules are possible69. The r-12 term accounts for short-range repulsion due to Pauli exclu- sion, preventing atom collapse, while the r\u20136 term represents weak attraction from interactions between permanent and in- duced dipoles such as the London dispersions.\nThis subsection and Table III A have surveyed only the sim- plest and most traditional MM force fields, the efforts to en- hance the expressiveness via additional terms are discussed in Section VI A."}, {"title": "IV. The toolbox of composable operations for machine learning force fields.", "content": "While there has been a plethora of previous work focused on developing and applying system-specific MLFFs to ho- mogeneous media and benchmarking various MLFF archi- tectures on datasets of small biologically relevant organic molecules18,27,31,83\u201385, there have been relatively few appli- cations to date employing MLFFs in lieu of traditional MM models for extended MD simulations of large biomolecular systems.\nPart of the challenge in developing MLFFs for large biomolecular systems stems from the computational chal- lenge of constructing datasets of ab initio energies and forces for these large heterogeneous systems. Unlike homogeneous systems such as liquid water where one can simply train a MLFF on smaller periodic boxes or clusters of water and readily apply the trained MLFF to simulations for larger peri- odic boxes86, the chemical heterogeneity and the importance of long-range interactions in proteins87 renders their decom- position into smaller, computationally more tractable train- ing structures less straightforward. Alternatively, one could simply construct datasets encompassing the entirety of large biomolecular systems using energies and forces obtained from QM/MM evaluations. However, in addition to the QM/MM evaluations still potentially being expensive depending on the target QM method and size of the QM region, expending train- ing resources on such large structures where most of the inter- actions are probably described purely at the MM-level seems wasteful.\nRecently, several MLFFs trained to diverse datasets en- compassing tens of thousands molecules (See Table III and Sec. V A) have demonstrated the potential of bottom-up ap- proaches to developing general-purpose MLFFs that can be readily applied to large biomolecules not wholly represented in the respective training sets23,60,61,88\u201392. Some of the ear- lier general-purpose MLFFs were limited in applicability due to their training set and model architectures not explicitly ac- counting for charged species23,60, but were still usable for con- ducting stable MD simulations for smaller protein systems93 or in mixed-level ML/MM simulations94\u201399. However re- cently, general-purpose MLFFs based on the MACE56,61 and GEM91 models have been successfully used to gener- ate MD trajectories of the solvated crambin protein (18,000- 25,000 atoms) for which the simulated THz-region vibrational modes, characteristic of slow collective protein motions, seem"}, {"title": "V. Best practices and pitfalls.", "content": "We have been insofar discussing the functional form of force fields \u00db(x;h,\u03a6), but in order to design a practical \u00db, one needs to find a set of optimal parameters by maximizing the likelihood of some particular force and energy data. In this section, we briefly review the popular datasets used in the curation of MM and ML force fields and the best practices for training and evaluation.\nA. Datasets\na. A note on the QM target. There has been little con- sensus, when it comes to biomolecular applications, regarding which QM levels of theory might correspond best to experi- mental measurements141. As a result, popular datasets (see Table III) are curated with various levels of theory and sam- pling strategies, making the merging of the data difficult, de- manding meta-learning solutions142. Before further evidence would emerge, if the field were to agree on a single level of theory for a community-wide effort to push for high-quality, high-volume data for MLFF training, cheaper targets might be more appealing.\nWhen developing novel MLFFs, it is also worth remind- ing ourselves that all we are trying to fit is a known function that can be solved analytically. One can view the QM energy function not as a reservoir of data but a surrogate, from which repeated acquisition is possible. Active learning techniques, such as Smith et al. 24 Wang et al. 43, Schwalbe-Koda, Tan, and G\u00f3mez-Bombarelli 44. , present a useful avenue to gather data in a rationally parsimonious fashion.\nb. Chemical diversity and conformational diversity. Conceptually, to accurately fit energies and forces on all chemical spaces is no different than having the MLFF model able to solve the Schr\u00f6dinger's equation, which seems impos- sible, judging from the no free lunch theorem143. To this end, QM datasets are always curated with biases, in terms of the coverage on chemical spaces and conformational landscape.\nWithin the chemical space of (bio)organic molecules, MD1721 is among the most popular datasets used for MLFF benchmark. Consisting of DFT calculations of 10 small or- ganic molecules (benzene, uracil, naphthalene, aspirin, sal- icylic acid, malonaldehyde, ethanol, toluene, paracetamol, and azobenzene) with fewer than 1 million snapshots each, it is limited in chemical diversity. Christensen and von Lilienfeld 144 further revised this dataset to reduce the noise. There are also high-quality QM datasets focusing on single molecules such as 3BPA145, and AcAc146. ISO17130, on the other hand, is slightly more chemically diverse as it samples 129 isomers of C7O2H10 with 5000 snapshots each. In con- trast, QM9136, like its predecessors, is rich in chemical diver- sity but not conformational diversity-it contains more than 134k small molecules, although all in low-energy state.\nMoving on to larger datasets emphasizing utility beyond just proof-of-concept, ANI1137 and ANI226 dataset, con- taining 20 million off-equilibrium snapshots, is among the most popular datasets that are simultaneously chemically and conformationally diverse, albeit no QM forces were anno- tated, which would be more information-rich than energies. SPICE59,147 also displays a vast chemical and conformational diversity on 2 million conformations of small molecules and peptides, with forces annotated. The SPICE59 dataset, along with many diverse datasets for (bio)molecules, has been gen- erated on the QCFractal platform148, which is being used to actively run QM calculations to curate the next generation of datasets for MLFF fitting.\nAnother community-driven project, ColabFit149 Exchange curates an open-source, diverse database containing a large collection of systematically organized datasets from multiple chemistry/materials domains that are especially designed for ML atomistic model development (providing physical units standardization, a unified data standard, integrated data load- ers, etc.). To date, the database contains 372 datasets contain- ing more than 180M atomic configurations and 500M proper- ties, spanning over 100 thousand different chemistries, and it is constantly expanding.\nIn principle, topology-free MLFFs are more naturally suited for simulating chemical bond-breaking and forming events than standard FFs, and would enable the simulation of fundamental biochemical processes like enzymatic reactions for which ab initio accuracy and FF efficiencies would ideally be employed. However, in practice, the curation of datasets to train MLFFs to accurately model chemical reactions presents additional challenges150, the same age-old challenges associ- ated with sampling rare events, as compared to developing models for equilibrium sampling of unreactive systems. In order to efficiently sample higher-energy training configura- tions representative of reaction pathways, various techniques have been employed ranging from simply running unbiased MD simulations at elevated temperatures151,152 and identify- ing minimum energy paths153\u2013155 to other approaches incor- porating biased MD simulations leveraging enhanced sam- pling algorithms in active learning protocols156\u2013159.\nLastly, we note that training on condensed-phase proper- ties has only been very recently160 possible. MM force fields are, on the other hand, usually successful in faithfully repro- ducing these properties161. These largely depend upon the intermolecular interactions, whereas long-range interactions are traditionally neglected in MLFFs (prior to SPICE59, the datasets used to curate MLFFs only include intramolecular in- teractions)."}, {"title": "B. Training and evaluation", "content": "We observe that, in recent literature on MLFFs, the com- munity is converging on a set of practices for efficient training and fair comparison of MLFF models. Certain practices, such as extremely small batch size, exponentially decaying learn- ing rate, and parsimonious use of normalization, are common in the curation of highly performant MLFFs. Since the forces and energies, and thereby force errors LF and energy errors Lu, for instance measured in mean-squared-error, are of dif- ferent units, one has to apply a set of perhaps physically mean- ingless constants to combine them as the loss function L:\n\nLv = ||\u00db-U||2,\n\n(22)\n\nLF = 13N\u2211i=1N3\u2211\u03b1=1(\u2202\u00db\u2202ri,\u03b1--Fi,\u03b1) ||2,\n\n(23)\n\nL = \u03bb\u03c5L\u03c5 + AF LF.\n\n(24)\nEmpirically, when using atomic units, LF/Lu within the range 100 ~ 1000 usually yields the best results.\nIt is worth reminding that, while the MSE (Equation 23) and RMSE error on forces are E(3)-invariant, the MAE loss on forces is not, and is dependent upon the choice of the co- ordinate systems.\n\nLF, MAE = 13N\u2211i=1N3\u2211\u03b1=1|\u2202\u00db\u2202ri,\u03b1- Fi,\u03b1|\n\n(25)\nIn a sense, this error has a bias to favor the conformations more aligned with the axes. It is alarming to see that this biased and arguably erroneous metric has been used widely in both the training and evaluation stages of MLFF models incorporating force matching.\nThe aforementioned error is a typical example of how error- prone the implementation of MLFF modules is\u2014some intu- itively benign operations might break the symmetry without catching the eyes of a seasoned engineer-researcher. Thus, we recommend that an equivariance/invariance unit test be in- cluded in all modules of MLFF implementation. An example test suite for a function f that works on both SE(3) invariant (h) and equivariant (x) representations (See Equation 13) can be implemented in 5 lines, using NumPy162, for example:"}, {"title": "VI. Making MM more accurate", "content": "A. Functional forms: more, but only slightly more, than harmonics and Fourier series.\nThe choice and design of functional forms (see Table III A) themselves limit the flexibility and expressiveness of the force field. For instance, the Lennard-Jones 12-6 potential, de- scribed in Equation 9, was developed decades ago and has been widely adopted since, despite the existence of alterna- tive approaches69,80. Enriching the complexity of the MM functional form has long been an area of intensive research. Notably, Class II MM force fields163\u2013165 replace the harmonic terms in Equation 9 with more much more flexible terms such as:\n\u2022 Higher order polynomials: The harmonic terms for bonds and angles can be rewritten to incorporate higher k-order polynomials in the form of (reusing the notation from Equation 9):\n\n\u2211bond\u2211k\u039ak (rij-rk)2; \u03a3angle\u2211k\u039ak (\u03b8ij \u2013 \u03b8\u03ba)2.\n\n(26)\nSince the geometry of a system is uniquely defined by the inter-atomic distances, given sufficiently high-order polynomials and dense enough bond connections, this functional form can be made universal.\n\u2022 Coupling terms: Terms like bond displacement, angle displacement, and Fourier series for (proper and im- proper) torsions can be combined multiplicatively to form bond-bond coupling (showing here as an exam- ple),\n\n\u2211bond\u2211bondKbond, bond (riojo - ro) (rinji - 1),\n\n(27)\nangle-angle coupling, bond-angle coupling, bond- torsion coupling, angle-torsion coupling, or torsion- angle-angle coupling.\nIn a similar spirit, Xie, Rupp, and Hennig 166 constructs ultra-fast machine learning potentials using B-splines and parametrizes using machine learning approaches. On a simple test system, this force field has a favorable tradeoff between speed and accuracy and is guaranteed to be smooth.\nOn the other hand, polarizable force fields, such as Drude167 and AMOEBA force fields168, incorporate the abil- ity to dynamically adjust the distribution of atomic charges in response to the local electrostatic environment and gener- ally involve a self-consistent calculation of induced dipoles. Reactive force fields, such as ReaxFF169,170, can handle bond breaking and forming during simulations by dynamically up- dating bond orders, based upon interatomic distances, for every simulated MD frame and making the relevant energy terms dependent on those bond orders. Empirical valence bond (EVB) models171 also enable the use of standard MM force fields for reactive simulations172\u2013175, but require the parametrization of a coupling term between the reactant and product states for a particular system. These have tradi- tionally been system-specific, but recent work has focused on developing transferable parametrizations of EVB mod- els across different reactive systems176. However, improving force field accuracy by introducing more expressive and ad- ditional functional terms comes with increased computational costs, which may not justify the trade-off between accuracy and speed, and significantly increases the complexity of force field parametrization."}, {"title": "B. Parametrization: from engineer-years to GPU-days", "content": "Another challenge in developing a reliable, robust and ex- tensible MM force field is the parametrization scheme-the assignment of the parameter set OFF-which must ensure comprehensive chemical coverage across the broad and het- erogeneous chemical space relevant to biomolecular systems.\nThe determination of OFF has traditionally been reliant on a human labor-intensive, inflexible, and inextensible rule-based scheme named atom typing-it classifies atoms into discrete categories representing distinct chemical environments. This classification enables MM parameters to be subsequently as- signed from a tabulated table of relevant atomic, bond, an- gle, and torsion parameters. For example, in the case of small molecules, atom types are determined by the attributes of the atom, such as element identity, hybridization, and aromatic- ity, as well as the attributes of the neighboring atoms and their connected bonds, and the number of neighboring atoms. For amino acids, the atom types are traditionally assigned accord- ing to the residues. Most of these atom types have a recep- tive field of two or three bonds, and chemical motifs outside this receptive field are generally not realized. After the atom types are determined, the bond, angle, and torsion types are determined simply by composing (using the AND operation and dictionary look up) atom types, and as a result, K atom types can naively lead to K\u2074 torsion types without simplifica- tion. The van der Waals interactions, on the other hand, are usually described with Lennard-Jones 12\u20136 potentials using the Lorentz-Berthelot68 combining rules to determine \u03c3 and & between different atom types.\nThe force field parameters can be further optimized in a systematic manner using ensemble reweighting method177\u2013179 and machine-learning methods180,181. How- ever co-optimizing the discrete chemical perception defined by the rule-based atom types and continuous force field parameters remains intractable. In general, the force field accuracy is constrained by the resolution of chemical per- ception. Efforts to improve the accuracy by increasing the number of atom types lead to a combinatorial explosion of required types.\nAlthough there are efforts to automate the development and parametrization process182\u2013186, human expertise remains es- sential, introducing challenges in adjusting existing param- eters to accommodate new ones, particularly when extend- ing the force field to new chemical domains of interest. In addition, biomolecular systems are inherently heterogeneous, making MM force field optimization challenging. The popu- lar AmberTools 23 package, for instance, combines indepen- dently developed force fields for chemical subspaces includ- ing proteins 187, DNA 188,189, RNA 190, water191-193 valent 194,195 and divalent196\u2013198 counterions, lipids 199, car- bohydrates200, glycoconjugates201,202, small molecules203,204, post-translational modifications205, and nucleic acid modifi- cations206-crystallized from more than 100 engineer-years of effort. However, there is no guarantee that the parameters across these different regions are identical or fully compatible.\na. Substructure pattern matching Substructure pattern matching approaches207\u2013209 represent another class of force field parametrization schemes that focus more directly on chemical perception than the traditional atom-typing meth- ods. The Open Force Field Initiative210, for instance, has developed an ecosystem of toolkits211 and force field re- mono-"}, {"title": "VII. Making ML force fields faster", "content": "As of now, almost all the fastest ML force fields use dot- product scalarization (Lemma 3) to compute the energies and automatic differentiation to compute the forces.\na. Accelerating SO(3) convolutions. Although the spherical harmonics-based SO(3)-equivariant representations have been shown to be performant and data-efficient in con- structing MLFFs28,31,56,133, an L-degree tensor convolution would require (L) complexity. Passaro and Zitnick 220 addresses this issue by reducing SO(3) convolutions to SO(2) without losing information. Luo, Chen, and Krishnapriyan 221 also achieves such cubic complexity by performing the con- volution in the Fourier space and using Gaunt coefficient rather than the Clebsch-Gordan coefficients. Cheng 222, on the other hand, performs the atomic cluster expansion145 directly in the Cartesian coordinate system.\nb. Machine learning for coarse-graining. Coarse-graining (CG)223\u2013226 refers to the technique to group atoms into larger particles termed beads, whose interactions are used to approximate the interaction energy among atoms. This enables the simulation of slow, collective motions while averaging out fast, local movements. For N atoms with coordinates X \u2208 IRN\u00d73 and n beads x \u2208 Rn\u00d73, the CG operator can be written as:\n\nx = PX,\n\n(28)\nwhere P is right-stochastic (\u03a3; Pij = 1), hence the transla- tion and rotation equivariance discussed in Section II are nat- urally satisfied. While P has traditionally been pre-defined and discrete, it can be made continuous and optimizable with machine learning227-229. Coincidentally, Equation 28 also closely resembles the linear projection step in Linformer230, an approach to reduce the complexity of transformer231 mod- els from quadratic to linear."}, {"title": "VIII. The path forward: what would the next generation of force fields look like?", "content": "A. The dilemma of topology.\nIt is debatable to what degree chemical bonds (and angles and torsions) are real and not artificial constructs. Classical biomolecular MM force fields usually require a topology (ex- ceptions include Gale et al. 232) and to define bond and an- gle energy accordingly, which is equivalent to putting a (very strong) prior on the probability density \u00ee\u00ee in Equation 2 to re- strict x in a limited region. Such intense biases in a simula- tion ensure its stability and interpretability\u2014clashes and dis- tortions in the geometry will have near-zero likelihood under such formulation. At the same time, it also prohibits the force field model"}]}