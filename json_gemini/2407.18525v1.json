{"title": "Is larger always better? Evaluating and prompting large language models for non-generative medical tasks", "authors": ["Yinghao Zhu", "Junyi Gao", "Zixiang Wang", "Weibin Liao", "Xiaochen Zheng", "Lifang Liang", "Yasha Wang", "Chengwei Pan", "Ewen M. Harrison", "Liantao Ma"], "abstract": "Background: The deployment of Large Language Models (LLMs) in medical fields is increasing, but few research evaluate their ability to manage both structured Electronic Health Record (EHR) data and unstructured clinical notes. This study provides a comprehensive benchmark of various models, including GPT-based LLMs, BERT-based language models, and conventional clinical predictive models to determine their efficacy in non-generative medical tasks using widely recognized datasets.\nMethods: We evaluated 14 language models (9 GPT-based and 5 BERT-based) alongside 7 conventional clinical predictive models on the MIMIC dataset, which encompasses comprehensive ICU patient records, and the TJH dataset, which includes EHR data from early COVID-19 patients. The performance of these models was assessed through a series of both supervised and unsupervised tasks, including mortality and readmission predictions, disease hierarchy reconstruction, and biomedical sentence matching. The study focused on comparing zero-shot prediction capabilities of LLMs with conventional models and the effectiveness of finetuned BERT-based models in handling clinical texts.\nResults: LLMs demonstrated promising zero-shot predictive abilities on structured EHR data when equipped with well-designed prompting strategies, often surpassing traditional models trained with limited datasets. However, in tasks involving unstructured medical texts, LLMs did not outperform existing BERT-based models. Both in supervised and unsupervised scenarios, the performance of finetuned BERT models was superior, suggesting that the additional cost and complexity of implementing LLMs might not be justifiable for non-generative tasks.\nConclusion: While LLMs show significant potential in interpreting structured EHR data through zero-shot learning, their application in processing unstructured medical texts is less advantageous compared to finetuned BERT models. The findings underscore the importance of selecting appropriate models based on specific task requirements and the nature of the data, facilitating more efficient use of NLP technology in healthcare settings.", "sections": [{"title": "1 Introduction", "content": "In recent years, Large Language Models (LLMs), particularly those based on Generative Pretrained Transformers (GPT), have demonstrated outstanding capabilities across various domains. These models, characterized by a decoder-only architecture, mark a significant departure from traditional encoder-only or encoder-decoder architectures, such as BERT\u00b9. GPT-based models have achieved widespread application due to their scale and complexity, outperforming BERT-based models in tasks ranging from casual chatbots to complex scientific analyses. In the medical field, GPT-based LLMs\u00b9 trained on datasets like PubMed and clinical notes excel in generative tasks such as patient interaction\u00b2, complex medical query resolution\u00b3, and passing medical licensing exams4.\nDespite these advancements, challenges persist in non-generative prediction tasks involving structured Electronic Health Record (EHR) data and unstructured medical texts, such as patient mortality or readmission predictions5-7. These tasks typically involve transforming multivariate longitudinal EHR data and unstructured texts into patient embeddings, subsequently used with classifiers for predictions. Two prevalent assumptions within the research community are: (1) The next-token prediction training paradigm of generative models, which aims to predict the next word in a sequence based on the context of preceding words, is ill-suited for handling sparse, longitudinal, and multivariate structured data9,10. (2) The largest or most advanced models are presumed to inherently deliver superior performance, particularly in natural language generative tasks11,12. However, it remains uncertain whether LLMs are inferior to conventional prediction models in handling structured medical data, or if they can surpass conventional natural language process (NLP) models in non-generative medical NLP tasks solely based on their performance in generative tasks. Current research in medical LLMs primarily focuses on generative tasks, with few studies evaluating their efficacy on non-generative tasks, not to mention proposing a systematic and comprehensive benchmark evaluation 13, 14\nTo address the identified research gap, our study conducts a comprehensive benchmarking of various models across representative non-generative medical tasks. This benchmarking work compares conventional machine learning (ML) and deep learning (DL) models designed for clinical prediction with EHR data, BERT-based NLP models for processing medical texts, and both general and medically specialized Large Language Models (LLMs). Our aim is to provide actionable insights to medical researchers on selecting optimal models for different clinical tasks. Our evaluation is structured around the following key research questions:\n\u2022 For structured EHR data in non-generative clinical prediction tasks: How do LLMs compare to conventional small expert models designed for specific prediction clinical predictive tasks in terms of performance? Can enhanced prompting strategies improve the understanding of structured medical data by LLMs and their predictive accuracy? Additionally, considering the groundbreaking generalizability of LLMs on generative tasks, can LLMs directly conduct predictions on new datasets without fine-tuning (i.e., the zero-shot or few-shot learning settings)? Such settings evaluate the generalizability of LLMs' clinical applications.\n\u2022 For unstructured medical free-text data in non-generative clinical NLP tasks: Do LLMs outperform conventional BERT-based models in extracting clinical semantics from clinical notes in supervised tasks? Additionally, do LLMs exhibit a deeper understanding of clinical concepts and better embedding capabilities in unsupervised tasks?"}, {"title": "2 Methods", "content": "This section outlines the experimental setup and benchmarking approaches used in our study. We have chosen the following widely recognized clinical benchmarking tasks to assess our model's performance5, 7, 16,19.\n\u2022 In-hospital mortality prediction: This task involves predicting whether a patient will survive their hospital stay, based on EHR data or clinical notes from the admission.\n\u2022 30-day readmission prediction: This task predicts whether a patient will be readmitted within 30 days post-discharge, utilizing EHR data or clinical notes from the initial hospitalization.\nFollowing previous EHR benchmarking works5,7, both supervised tasks are evaluated using the Area Under the ROC Curve (AUROC) and the Area Under the Precision-Recall Curve (AUPRC). Both tasks are evaluated using structured EHR data and unstructured clinical notes separately. All data are sourced from publicly available datasets: Tongji Hospital COVID-19 dataset (TJH)25 and MIMIC dataset24. Our data preprocessing follows methodologies from established benchmarks5,7,19. Dataset statistics are detailed in Table 1.\nTo exploit the semantic capabilities of language models, we also include two unsupervised tasks to evaluate the model performance with clinical texts:\n\u2022 Medical sentence matching: This task evaluates the semantic similarity between pairs of medical sentences. Human experts rate the similarity of each pair, and models generate semantic embeddings for these sentences. Model performance is assessed by calculating the correlation between the similarity scores derived from the model-generated embeddings and the human ratings. Higher correlation scores indicate a better alignment with human judgments.\n\u2022 ICD code clustering: In this task, we explore the reconstruction of the hierarchical structure of ICD codes. The ICD coding system has a hierarchical structure that can be represented as a tree, with leaf nodes representing specific codes (e.g., E001, Congenital iodine-deficiency syndrome, myxedematous type) and parent nodes representing broader categories (e.g., E00, Congenital iodine-deficiency syndrome). By clustering the text embeddings of the disease names, we can evaluate the average hierarchical distance within clusters. A shorter average hierarchical distance suggests better preservation of the original ICD hierarchy in the embeddings.\nFor the medical sentence matching task, we utilize the BIOSSES dataset22, which is a benchmark resource comprising 100 sentence pairs specifically designed for evaluating semantic similarity in the biomedical domain. For the ICD code clustering task, we employ the 2023 ICD-10 data26, selecting 11,942 ICD-10 codes with fewer than five digits to focus on broader categories that encompass more general medical concepts."}, {"title": "3 Results", "content": "In this section, we report our benchmarking results, including: (1) supervised results comparing conventional EHR prediction models with LLMs using longitudinal EHR data; (2) supervised results comparing BERT-based models with LLMs using clinical notes data; (3) unsupervised results comparing BERT-based models with LLMs using disease hierarchy and biomedical text data."}, {"title": "3.1 Benchmarking Results of Supervised Tasks Using Structured EHR Data", "content": "In this subsection, we discuss the benchmarking of supervised tasks (i.e., mortality and readmission prediction) using structured EHR data. As previously discussed, the decoder-only architecture of LLMs, trained primarily on unstructured natural language texts, encounters challenges with the structured, sparse, and longitudinal nature of EHR data9, 10. To bridge the gap between the complex nature of EHR data and unstructured text-oriented LLMs, we develop a prompting strategy to better deliver structured EHR data to LLMs. As shown in Figure 3, the proposed prompting strategy employs a feature-wise list-style format for inputting EHR data and provides LLMs with feature units and reference range. An in-context learning strategy was also used to provide examples that guide the LLMs toward the correct output format. The prompting templates for the prediction tasks"}, {"title": "3.2 Benchmarking Results of Supervised Tasks Using Clinical Notes Data", "content": "This section assesses mortality and readmission prediction tasks using the MIMIC dataset, as the TJH dataset lacks clinical notes data. The results are detailed in Table 4.\nThree settings are considered for model evaluation: \u2018freeze', 'finetune', and 'generation'. In the 'freeze' setting, we use the pretrained model to generate text embeddings and train a classifier on these embeddings to assess the out-of-the-box performance of the language models. The \u2018finetune' setting involves further training of the language model during classifier training. The \u2018generation' setting prompts the language model to directly generate prediction results from clinical notes, akin to the previous EHR prediction approach. We only evaluate the performance of GPT-3.5 and GPT-4 under the generation setting, as these models are closed-sourced. The templates for the prediction tasks with clinical notes data are shown in Appendix D.3.\nSurprisingly, in the \u2018freeze' setting, BERT-based models, such as ClinicalBERT and GatorTron, perform comparably to LLMs for mortality prediction, and slightly better for readmission prediction."}, {"title": "3.3 Benchmarking Results of Unsupervised Tasks Using Biomedical Text Data", "content": "To further assess the models' proficiency with clinical concepts and their embedding capabilities, we conducted unsupervised tasks using unstructured biomedical texts. The performance of various language models on medical sentence matching and ICD code clustering is illustrated in Figure 4. For clarity, we use the Pearson distance44 ($\\sqrt{1 \u2013 r}$, where r is the Pearson correlation) to represent performance in the medical sentence matching task (indicated by purple bars on the left y-axis). For both tasks, lower bars indicate better clustering performance. BioGPT slightly outperforms others in sentence matching, whereas Clinical-Longformer excels in the ICD code clustering task. Overall, no significant performance differences are observed between BERT-based and GPT-based LLMs in these tasks. This finding suggests that large-scale LLMs may not be necessary for general medical text embedding tasks. Detailed performance analyses of these tasks are available in Appendix B, detailed in Table 7 and Figure 5."}, {"title": "4 Discussion", "content": "Our extensive analysis of various models across multiple tasks and datasets yields specific recommendations for model selection in clinical settings. For tasks using structured electronic health"}, {"title": "4.1 Model Selection Considerations in Real-world Clinical Tasks", "content": ""}, {"title": "4.2 Obstacles and explorative strategies for the applications of clinical LLMs", "content": "Our experimental results and practical experiences have uncovered several research gaps between current large language model (LLM) research and their real-world clinical applications:\n(1) Lack of comprehensive training and evaluations across medical tasks: Most clinical LLMs are trained on medical literature and evaluated on generative tasks. Few explore non-generative applications, possibly due to challenges in accessing quality, large-scale EHR data or requirements for deeper medical understanding. This gap significantly restricts LLM applications within decision-driven clinical workflows. Enhancing training and evaluation across diverse medical tasks could enable researchers to better gauge the capabilities and limitations of LLMs in clinical contexts.\n(2) Structural limitation in processing longitudinal EHR data: Despite promising zero-shot performance, LLMs lag behind traditional models when ample data is available. The inherent structure of LLMs struggles with longitudinal EHR data utilization. Integrating conventional predictive models using agent-based frameworks could leverage the accuracy and trustworthiness of clinical models with the expansive knowledge and adaptive capabilities of LLMs, potentially reducing prediction errors and hallucinations.\n(3) Deployment complexity, environmental impact, and privacy concerns: Deploying LLMs in secure healthcare environments presents challenges due to high computational costs and potential privacy issues. Our analysis, as detailed in Table 6, shows that larger models, especially generative ones, require substantial resources, increasing carbon emissions. The deployment in environments with limited GPU capacity and strict data privacy regulations poses further obstacles. Although solutions like Microsoft Azure's privacy-guaranteed LLM service exist, they may not align with all local data governance policies, particularly those restricting external internet access.\nIn conclusion, addressing these gaps calls for enhanced model training, evaluation, integration, and deployment strategies by clinical and NLP researchers, alongside better data governance from relevant institutions, to maximize the potential of LLMs in clinical settings."}, {"title": "4.3 Limitations and Future Works", "content": "Our study provides detailed benchmarking results for various models on non-generative medical tasks, yet it is not without limitations:\n\u2022 Limited task and dataset diversity: Our evaluations were confined to mortality and readmission predictions using the MIMIC and TJH datasets. Future research should broaden the scope to include diverse clinical tasks like diagnosis prediction, treatment recommendation, and adverse event forecasting, to provide a more thorough evaluation of model performance across various medical fields.\n\u2022 Model selection: Although our study included a comprehensive range of models, the rapid advancements in the field might have led to the development of newer models post our study period. Continuous incorporation of emerging state-of-the-art models will ensure that our benchmarks remain relevant and informative.\n\u2022 Ouput interpretability: The focus of our study was predominantly on performance metrics. Future efforts should emphasize the interpretability of LLMs, particularly the ability of LLMs to generate evidence supporting their decisions, which are pivotal in clinical settings.\n\u2022 Multimodal integration: We concentrated on text and structured data in our study. Investigating the integration of additional data modalities, such as medical imaging and genomics, could provide a more comprehensive understanding of patient health and enhance model efficacy.\nFuture research addressing these limitations will enhance our understanding of the potential and boundaries of AI models in healthcare, paving the way for more effective and trustworthy AI applications in medical settings."}, {"title": "A Detailed Experimental Setups", "content": "This section details our experimental setups, highlighting tasks, datasets, evaluation metrics, problem formulation, baseline models, and implementation details for reproducibility."}, {"title": "A.1 Tasks", "content": "In the context of deep learning, tasks can be broadly classified into two categories: generative and non-generative. Generative tasks involve creating or generating new content based on learned patterns and data, such as generating text summaries or translating languages. Non-generative tasks, typically are those discriminative tasks, which are our focus, involve classification, regression, or knowledge extraction without creating new content. These non-generative tasks analyze data to categorize, identify, or predict based on existing patterns46.\nWhile in the medical domain, non-generative diagnostic tasks are much more common and widely used, e.g., disease risk prediction47, mortality outcome prediction7, biomarker identification48, etc., are all non-generative tasks. Therefore, with a focus on non-generative medical tasks, we evaluate the performance of LLMs and conventional methods on the following non-generative tasks under two main data modalities in clinical practice: structured EHR and clinical notes38,49.\n(1) In-hospital mortality prediction: This task aims to predict patient mortality outcomes during their hospital stay, classifying whether a patient will survive (label 0) or die (label 1) based on various data modalities. Accurate mortality prediction models can assist healthcare providers in identifying high-risk patients, enabling timely interventions, optimizing resource allocation, and ultimately improving patient outcomes. Early identification of patients at risk of mortality allows for proactive care planning and targeted treatment strategies, potentially reducing mortality rates and enhancing the quality of care delivered.\n(2) 30-day readmission prediction: The goal of this task is to predict the likelihood of a patient being readmitted to the hospital within 30 days of their initial discharge, classifying patients into two categories: those not likely to be readmitted (label 0) and those with a higher probability of readmission (label 1). Accurate readmission prediction can help healthcare providers design targeted interventions and post-discharge care plans to reduce readmission rates, improve patient outcomes, and optimize healthcare resource utilization. By identifying patients at high risk of readmission, providers can implement personalized follow-up care, patient education, and care coordination to prevent avoidable readmissions and improve the continuity of care.\nThe two chosen non-generative diagnostic tasks serve as crucial references for patient health status in clinical decision-making, offering insights into outcomes, resource utilization, and care planning to aid personalized, high-quality care7,39,49, 50.\nIn addition to these conventional supervised prediction tasks, we also include two unsupervised prediction tasks to assess models' representation quality over unstructured clinical notes data.\n(1) Medical sentence matching: This task assesses the ability of models to determine the semantic similarity between pairs of sentences in the medical domain. Human experts evaluate and assign similarity scores to each pair of sentences, which the models then process to generate vector representations (embeddings) that capture the semantic information. The performance of the models is evaluated by comparing their predicted similarity scores against the human-labeled scores using metrics such as Pearson correlation, with higher correlations indicating better alignment with human judgments. The task enables healthcare professionals to group similar patient information, retrieve relevant literature, and support decision-making by identifying"}, {"title": "A.2 Datasets", "content": "This study utilizes two primary datasets: TJH25 (structured EHR data) and MIMIC24 (structured EHR data and unstructured clinical notes). The TJH dataset is chosen for its relevance to the early stages of the COVID-19 pandemic, a period characterized by a sudden surge in cases and significant pressure on healthcare services. As such, it serves as an ideal representation of an emerging disease scenario, aligning with our research scope of simulating the occurrence of a new emergency disease.\nThe MIMIC dataset, on the other hand, is selected for its extensive nature and wide usage in healthcare research7, particularly for simulating ICU scenarios. Its inclusion of both structured EHR data and unstructured clinical notes allows for a comprehensive evaluation of model performance across multiple data modalities. Therefore, the MIMIC dataset provides a solid foundation for comparative analysis. It supports both mortality (classification) and readmission (classification) prediction tasks, aligning with our research goals.\n\u2022 TJH Dataset25: Derived from Tongji Hospital of Tongji Medical College, the TJH dataset consists of 485 anonymized COVID-19 inpatients treated in Wuhan, China, from January 10 to February 24, 2020. It includes 73 lab test features and 2 demographic features. The dataset is publicly available on GitHub (https://github.com/HAIRLAB/Pre_Surv_COVID_19, also available in original paper's supplementary information and data and code availability section25.).\n\u2022 MIMIC Dataset24: Sourced from the EHRs of the Beth Israel Deaconess Medical Center, the MIMIC dataset is extensive and widely used in healthcare research, particularly for simulating ICU scenarios. It is divided into \u201cMIMIC-EHR\u201d, which contains the structured EHR data, and \"MIMIC-Note\u201d, which contains the clinical notes. For MIMIC-EHR, 17 lab test features and 2 demographic features are extracted. To minimize missing data, we consolidate every consecutive 12-hour segment into a single record for each patient, focusing on the first 48 records. For MIMIC-Note, unstructured text data from clinical reports records are utilized."}, {"title": "A.3 Evaluation Metrics", "content": "We employ following metrics for the binary classification task (including in-hospital mortality prediction and 30-day readmission prediction tasks):\n(1) AUROC: This is our primary metric in the binary classification task due to its widespread use in clinical settings and effectiveness in imbalanced datasets54.\n(2) AUPRC: AUPRC is particularly useful for evaluating performance in datasets with a significant imbalance between classes55.\n(3) Missing Rate: This metric is calculated as $\\frac{n_{test}-n_{decoded}}{n_{test}} \u00d7 100\\%$, where $n_{test}$ represents the total"}, {"title": "A.4 Problem Formulation", "content": "Let $D = \\{(x_i, y_i)\\}_{i=1}^{N}$ denote a dataset containing N samples, where $x_i$ represents the input data (either structured EHR or unstructured clinical notes) for the i-th patient, and $y_i$ denotes the corresponding label or target value. The goal is to learn a mapping function $f : x_i \u2192 y_i$ that predicts the output $y_i$ given the input $x_i$.\nSpecifically, for the structured EHR data, each input $x_i$ consists of a sequence of visits $x_i = (v_{i, 1}, v_{i,2},..., v_{i, T_i})$, where $v_{i,t}$ represents the data associated with the t-th visit of the i-th patient, and $T_i$ denotes the total number of visits for the i-th patient. The data for each visit $v_{i,t}$ includes dynamic information such as lab tests and vital signs, as well as static information like demographics.\nIn the context of LLMs, we utilize pre-designed prompt templates that encapsulate the raw EHR data $x_i$, along with optional external information such as system prompts56, units, or reference ranges. The LLM is instructed to perform a specific task based on the input prompt. For binary"}, {"title": "A.4.2 Medical Sentence Matching", "content": "Let $D_{MSM} = \\{(s_i, s_j, score_{ij})\\}_{k=1}^{M}$ be a dataset containing M pairs of medical sentences, where $s_i$ and $s_j$ are the sentences in the k-th pair, and $score_{ij}$ is the human-annotated similarity score for the sentence pair ($s_i, s_j$). The objective is to evaluate the correlation of the similarity derived from the model and the similarity annotated by humans, i.e., correlation : sim($s_i, s_j$) \u2192 $score_{ij}$.\nWe use embeddings $e_i$ and $e_j$ for the sentences $s_i$ and $s_j$, respectively, derived from the pretrained language model. The predicted similarity score $score_{ij}$ is computed using a similarity function sim($e_i, e_j$), such as cosine similarity:\nsim($s_i, s_j$) = sim($e_i, e_j$) = $\\frac{e_ie_j}{||e_i||||e_j||}$"}, {"title": "A.4.3 ICD Code Clustering", "content": "Let $D_{ICD} = \\{d_i\\}_{i=1}^{L}$ be a dataset containing L disease descriptions, where $d_i$ represents the i-th disease description. Each description $d_i$ is associated with an ICD code $ICD_i$. The objective is to evaluate models' representations $e_i$ for each disease description $d_i$, where the similar diseases (according to the ICD hierarchy) have more similar embeddings is treated as better representation quality.\nWe perform clustering on the embeddings $\\{e_i\\}$ (computed from the pretrained language model) using a clustering algorithm (e.g., K-means). The quality of the clustering is evaluated by measuring the average intra-cluster distance $dist_{avg}$, where $dist_{avg}$ is defined as the average pairwise distance between embeddings within the same cluster. The distance between two ICD codes is measured according to their positions in the ICD hierarchy:\ndistICD(ICDa, ICDb) = dist(ICDa, LCA(ICDa, ICDb))+dist(ICDb,LCA(ICDa, ICDb))"}, {"title": "", "content": "The average intra-cluster distance is given by:\n$dist_{avg} = \\frac{1}{|\\mathscr{C}|} \\sum_{C \\in \\mathscr{C}} \\frac{1}{|C|(|C| - 1)} \\sum_{i, j \\in C}{dist}_{ICD}(ICD_i, ICD_j)$"}, {"title": "A.5 Baseline Models", "content": "To perform the above tasks, we comprehensively select conventional EHR-specific models and text-specific models to compare with large language models (LLMs). LLMs serve as general-purpose models capable of performing on diverse data modalities and tasks, whether supervised or unsupervised. We aim to explore if these LLMs consistently outperform conventional models in non-generative tasks."}, {"title": "A.5.1 Clinical Predictive Models", "content": "The following models are applied on structured EHR prediction tasks, encompassing machine learning and deep learning methods, as well as models specifically designed for EHR data.\n(1) Decision Tree57: It splits data into branches at decision nodes represented visually as a tree structure. It utilizes simple rules inferred from features to progressively classify or predict outcomes, making it straightforward yet powerful for clinical decision-making tasks.\n(2) XGBoost35: It is an advanced implementation of gradient boosting, offering robust handling of various types of data and extensive support for fine-tuning and customization. Its efficiency and performance make it popular for predicting patient outcomes from EHR data.\n(3) GRU36: It efficiently captures dependencies in sequence data through gating mechanisms which regulate the flow of information. This capability is essential for processing time-series EHR data to predict future health events.\n(4) ConCare: It utilizes a multi-channel GRU with a time-aware attention mechanism to extract clinical features and re-encode the clinical information by capturing the interdependencies between features. It is specifically designed to handle the complexity of EHR data.\n(5) GRASP37: It is a generic framework for healthcare models, leveraging information extracted from patients with similar conditions to enhance cohort representation learning results. This approach improves the accuracy of patient outcome predictions.\n(6) M3Care38: It addresses the missing modality issue in EHR data by utilizing similar patients' existing modalities. Specifically, M3Care imputes task-related information in the latent space rather than generating raw missing data, enhancing stability and accuracy.\n(7) AICare39: It includes a multi-channel feature extraction module and an adaptive feature importance recalibration module. It learns personalized health status embeddings with both static and dynamic features, improving patient-specific predictions."}, {"title": "A.5.2 BERT-based Models", "content": "Building upon the BERT model, several variants are tailored for processing and extracting valuable information from unstructured clinical texts, enhancing the understanding and utility of medical documents.\n(1) BERT\u00b9: It leverages a transformer architecture with a focus on the encoder component, processing text bidirectionally to capture contextual information from both sides of each token across all layers. This makes BERT effective for tasks like medical document classification and information extraction.\n(2) ClinicalBERT19: It is an adaptation of BERT designed to effectively represent and extract information from unstructured clinical notes by capturing nuanced relationships between medical concepts. It is optimized for healthcare-specific language and tasks.\n(3) BioBERT40: It is a specialized version of BERT tailored for the biomedical field. It enhances the extraction of valuable information from biomedical literature, improving the effectiveness of biomedical text mining models.\n(4) GatorTron41: It is a clinical language model with 8.9 billion parameters, trained on over 90 billion words, including 82 billion de-identified clinical texts. It significantly improves performance on five clinical NLP tasks, including clinical concept extraction and medical question answering.\n(5) Clinical-Longformer42: It is a clinical knowledge enriched version of Longformer, pretrained using MIMIC-III clinical notes. It allows up to 4,096 tokens as the model input by utilizing a sparse attention mechanism."}, {"title": "A.5.3 Large Language Models", "content": "LLMs are basically general-purpose, designed to handle a wide range of tasks across various data types, including medical data, and can be adapted for more specific applications in the healthcare domain.\n(1) GPT-28: It is trained on a vast dataset of WebText and demonstrates the ability to perform NLP tasks. It improves log-linearly with increases in capacity and achieves competitive results on benchmarks, showing potential for medical text analysis.\n(2) Llama-327: It features significant upgrades to Llama-2 like a more efficient 128K token vocabulary and grouped query attention (GQA) in both 8B and 70B models. Additionally, Llama-3 offers improved reasoning and code generation capabilities, and has been trained on a substantially larger dataset of over 15 trillion tokens.\n(3) GPT-3.5 (ChatGPT)28: It employs Reinforcement Learning from Human Feedback (RLHF). The process begins with supervised fine-tuning and transitions to reinforcement learning, substantially improving its conversational abilities through the use of a structured dialogue format, which can be beneficial for interactive medical applications.\n(4) GPT-429: It is a large-scale, latest one of the most advanced LLM developed by OpenAI. It achieves human-level performance on various benchmarks, including the United States Medical Licensing Examination (USMLE), indicating its potential for high-stakes medical decision support.\nMedical LLMs are specifically designed and fine-tuned for the medical domain from the general-purpose LLMs, enhancing their effectiveness in healthcare-related tasks."}, {"title": "A.6 Implementation Details", "content": "Our experimental phase spans from December 19, 2023, to June 22, 2024. The experimental setup includes a server equipped with eight NVIDIA Tesla V100 GPUs, each with 32GB of memory, two Intel(R) Xeon(R) Gold 6146 CPUs (12 cores, 24 threads each) operating at 3.20GHz, and 384GB of RAM. The software environment comprises CUDA driver version 12.2, Python 3.11, PyTorch 2.1.1, PyTorch Lightning 2.1.2, and Transformers 4.40.2. This configuration is utilized to run the machine learning and deep learning model baselines presented in our benchmarked performance table.\nFor model training, we employ the AdamW optimizer across all experiments. Each model undergoes training for a maximum of 50 epochs using patient samples from the training set. To prevent overfitting, we implement an early stopping strategy monitored by the AUROC metric with a patience of 5 epochs. Notably, for most BERT-based model fine-tuning scenarios, optimal parameters are typically achieved within the first 3 epochs. The learning rate hyperparameter for training EHR prediction models is determined via grid search within the space of le-2, 1e-3, 1e-4. The hidden dimension for EHR prediction models is set to 128. The batch size in the TJH dataset is 64, while for the MIMIC dataset, it is 1024. The learning rate for fine-tuning BERT-based models is set to le-5, and for the freeze setting (training the MLP classifier), it is set to 1e-4. The batch size for BERT-based models is generally 32 on a single GPU. Due to GPU memory constraints, the batch size for GatorTron is 4 and for Clinical-Longformer is 16. The batch size for inferencing or obtaining embeddings from GPT-based LLMs is set to 1. BioGPT are run on a single GPU card, while other LLMs are run with eight GPUs in parallel.\nFor BERT-based models, we extract the embedding of the first token (CLS token) at the last layer in the backbone, and the last token at the last layer for GPT-based models. For clinical notes experiments, the max token count is set to 512 for all models (in both finetune and freeze settings). However, in the generation setting, we adjust the max token count to 4096 due to LLMs' longer context capacity. In addition, we use the default temperature in Ollama, and 0.1 temperature in HuggingFacePipeline's text-generation setting, with top_k=50 and max_new_tokens=20."}, {"title": "B Detailed Analysis of Unsupervised Task Results", "content": ""}, {"title": "B.1 Detailed Medical Sentence Matching Task Benchmarking Results", "content": "Table 7 shows the results of the medical sentence matching task. BERT-based models generally outperform GPT-based models, with the original BERT model surprisingly demonstrating the best performance among BERT variants (Pearson: 0.57, Spearman: 0.63, Kendall: 0.46 for cosine similarity), followed closely by GatorTron. Among open-sourced GPT-based models, BioGPT stands out, surpassing some BERT-based models with scores comparable to BERT (Pearson: 0.61, Spearman: 0.64, Kendall: 0.45 for cosine similarity). The consistency across different similarity measures (cosine, L1, L2) validates these findings."}, {"title": "B.2 Detailed ICD Code Clustering Task Benchmarking Results", "content": "Figure 5 illustrates the average code distance for each model across different cluster numbers (K = 10,20,30,40,50), with lower values indicating better performance. Clinical-Longformer achieves the best performance with a mean average distance of 4.77, indicating its strong capability in understanding medical terminology and relationships.\nOther models that are trained on medical corpora normally demonstrate their effectiveness in capturing the nuances of medical language. General-purpose large language models like GPT-2 show weaker performance in this task with the highest average code distance of 5.53, suggesting that its embeddings may not align well with the ICD code hierarchy."}, {"title": "C Construction Process of Prompting Framework for Structured EHR Tasks", "content": "The final construction of our proposed prompt template, as shown in Figure 3, is explored with the following question: What constitutes an effective EHR data prompt for LLMs? Structured EHR data differs significantly from the unstructured text or code data on which LLMs are typically trained58. It is characterized by its longitudinal nature, sparsity, and infusion with domain-specific knowledge.\nThe longitudinal aspect of EHR data demands prompts that effectively represent time series data. The sparsity requires the LLM to be aware of missing information. Additionally, the knowledge-infused nature necessitates the integration of reliable medical knowledge context. These characteristics present unique challenges. How can we enable LLMs to comprehend EHR data, which primarily consists of numerical time-series values\u2014a format that LLMs are not inherently skilled in handling59?\nTo address these challenges, we propose a more sophisticated approach to prompt engineering. We focus on the three key characteristics of structured EHR data: 1) longitudinal, 2) sparse, and 3) knowledge-infused. Our aim is to enhance the LLMs' reasoning abilities. We conduct our experiments progressively, building upon best practices derived from previous studies."}, {"title": "C.1 Harnessing Structured EHR", "content": "EHRs are inherently structured and longitudinal, capturing patient data over time. This characteristic is at odds with the typical unstructured text-based data formats to which LLMs are accustomed."}, {"title": "C.2 Explore Sparsity in EHR", "content": "EHR data often exhibits sparsity, characterized by missing features in the raw data, which poses a challenge for LLMs in understanding these omissions. Conventional ML and DL models typically require imputation before data input, whereas LLMs can directly handle textual inputs. We aim to explore whether the imputation process is necessary for LLMs. We intend to compare the outcomes when NaN (\u201cNot a Number\u201d) values are retained versus when they are replaced with"}]}