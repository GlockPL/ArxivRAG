{"title": "MambaDS: Near-Surface Meteorological Field Downscaling with Topography Constrained Selective State Space Modeling", "authors": ["Zili Liu", "Hao Chen", "Lei Bai", "Wenyuan Li", "Wanli Ouyang", "Zhengxia Zou", "Zhenwei Shi"], "abstract": "Abstract-In an era of frequent extreme weather and global warming, obtaining precise, fine-grained near-surface weather forecasts is increasingly essential for human activities. Downscaling (DS), a crucial task in meteorological forecasting, enables the reconstruction of high-resolution meteorological states for target regions from global-scale forecast results. Previous downscaling methods, inspired by CNN and Transformer-based super-resolution models, lacked tailored designs for meteorology and encountered structural limitations. Notably, they failed to efficiently integrate topography, a crucial prior in the downscaling process. In this paper, we address these limitations by pioneering the selective state space model into the meteorological field downscaling and propose a novel model called MambaDS. This model enhances the utilization of multivariable correlations and topography information, unique challenges in the downscaling process while retaining the advantages of Mamba in long-range dependency modeling and linear computational complexity. Through extensive experiments in both China mainland and the continental United States (CONUS), we validated that our proposed MambaDS achieves state-of-the-art results in three different types of meteorological field downscaling settings. We will release the code subsequently.", "sections": [{"title": "I. INTRODUCTION", "content": "N recent decades, the increasing frequency and intensity of extreme weather events have underscored the profound impacts of climate change on human societies and natural systems [1], [2]. Consequently, the need for accurate and reliable weather forecasting has never been more critical. Traditional numerical weather prediction methods [3], which have been developed over many years, along with the rapidly advancing deep learning-based forecasting models [4]\u2013[8] in recent years, have enabled increasingly accurate global-scale weather predictions. However, due to computational resource constraints, the resolution of global-scale forecasts is limited to tens of kilometers to 100 km [9]. Such coarse spatial resolution is insufficient for the refined forecasting needs of specific regions [10] and related downstream tasks [11], [12]. As a result, using downscaling techniques to generate high-resolution weather forecasts for specific regions is essential for addressing the spatial resolution limitations of global forecast models [13]\u2013[15].\nDownscaling methods for meteorological variables can be categorized into dynamical downscaling and statistical downscaling [15]. The former, often referred to as Regional Climate Models (RCMs), uses forecast results from Global Climate Models (GCMs) as boundary conditions. It incorporates topography and other regional information to construct regional dynamical processes, solving differential equations to obtain high-resolution meteorological fields at the regional level [16]. However, dynamical downscaling methods heavily rely on differential equations to describe dynamical processes, which often results in significant biases. In addition, the numerical solution process on fine-grained regional grids is computationally intensive, requiring the support of supercomputing platforms [14]. To alleviate the computational bottlenecks of dynamical downscaling, statistical downscaling methods directly learn the mapping from coarse-resolution to fine-resolution meteorological data. Early attempts use traditional machine learning techniques, such as multiple linear regression [17], random forests [18], and support vector machines [19], to model the mapping relationship. However, the nonlinear mapping capabilities of traditional machine learning methods are relatively limited, which has constrained the performance of early statistical downscaling approaches.\nIn recent years, machine learning methods, particularly deep learning [20], have rapidly advanced. Due to their powerful automatic feature extraction capabilities, they have been widely applied in fields such as computer vision [21], natural language processing [22], and earth system science [23]. The downscaling task of meteorological data draws heavily from the image super-resolution (SR) problem in the field of computer vision. The objective is to recover high-resolution images from low-resolution images, a process very similar to downscaling. Due to the vast amount of meteorological"}, {"title": "II. RELATED WORK", "content": "This section provides a brief overview of research related to meteorological field downscaling.\nA. Deep Models in Meteorological Field Downscaling\nMeteorological field downscaling can be broadly divided into dynamical downscaling and statistical downscaling based on modeling approaches [15]. This subsection will focus on the development of deep learning-based methods in statistical downscaling.\nIn the deep learning modeling paradigm, the downscaling process of meteorological fields is modeled as a nonlinear mapping from low-resolution meteorological grids to high-resolution grids, which is very similar to image SR. Therefore, the development of downscaling models has greatly drawn on the model structures of image SR. CNN-based SR models are the earliest and most common in the application and research of downscaling methods. Representative work includes DeepSD [25], which utilizes the SRCNN [51] to achieve the mapping from low-resolution to high-resolution meteorological fields. Subsequent improvement methods mostly utilize advanced super-resolution models like VDSR [52] and encoder-decoder-based UNet [53] to achieve downscaling for meteorological variables such as wind [26], temperature [54], [55], and precipitation [56], [57]. Additionally, to further enhance the recovery of high-frequency texture information, generative adversarial networks (GANs) [58] have been widely used in downscaling, mainly targeting high-ratio downscaling tasks [29] and meteorological variables with richer texture information, such as precipitation [31]. Despite these advancements, CNN models have limited capability in modeling global context, which restricts the performance of CNN-based downscaling models.\nTo further enhance the global context modeling capability of downscaling models, recent work has started using Transformer-based SR models to improve downscaling performance. Zhong utilizes SwinIR [32] and Uformer [33] models to achieve downscaling and bias correction for near-surface temperature and wind speed forecast fields, with model performance significantly surpassing CNN methods [36]. Other Transformer-based downscaling works have also achieved excellent model performance in areas such as climate variables [34], spatiotemporal downscaling [35], and station-scale downscaling [59], [60]. However, the quadratic computational complexity caused by the self-attention mechanism in Transformer models requires significant computational power and memory when handling high-resolution images. Some efficient Transformer improvements [38] can alleviate this issue but at the cost of losing the ability to model long-term correlations.\nTo address the issues of CNN and Transformer models in meteorological field downscaling, we propose MambaDS, pioneering the integration of the Mamba [39] into downscaling tasks with special design and improvements. The introduction of the Mamba ensures the ability to maintain long-term dependence while managing model complexity, thereby enhancing the overall performance of the downscaling model."}, {"title": "B. Auxiliary Data for Meteorological Field Downscaling", "content": "Although meteorological field downscaling has borrowed model structures from image SR, the downscaling process is not simply a mapping from low-resolution images to high-resolution images. It is influenced by various physical auxiliary information, such as topography and other meteorological variables [15]. Among these, topography information is the most significant factor affecting the meteorological downscaling process. Therefore, it is common in previous work to incorporate it as auxiliary information into the downscaling process. For instance, early precipitation downscaling efforts, such as DeepSD [25] and Nest-UNet [54], utilized digital elevation model (DEM) data as auxiliary information. They integrated high-resolution DEM information into feature maps through addition or concatenation, guiding the restoration of detailed texture information. However, such simple integration lacks semantic feature extraction of auxiliary information, limiting the effectiveness of DEM data. Recent improvements [36] address this issue by designing specialized encoder structures for topography data to extract features at different scales and integrate them into the downscaling process. Although experimental results show that this method can enhance downscaling performance, the additional feature encoder inevitably increases the overall model parameters and computational complexity. This makes it difficult to determine whether the performance improvement comes from increased model capacity or the incorporation of geographical information.\nTo more efficiently utilize topography information for enhancing and guiding downscaling, we design an efficient topography constraint layer. This layer imposes a hard constraint on the downscaled output through topography weighting at the final stage of the model. This approach ensures the effective use of topography information while avoiding additional parameters and computational complexity."}, {"title": "C. Visual State Space Model", "content": "Recently, state space models represented by Mamba [39] have gained significant attention and are widely applied in various fields such as computer vision and natural language processing [40], [41]. Its linear complexity and ability to model long-term dependence help alleviate the inherent issues present in CNN and Transformer models. Although Mamba was initially proposed for sequence data, recent work has demonstrated its strong performance in the visual and image domains [43]. Early works of visual Mamba primarily focus on image classification tasks [42], [47], [61], addressing the issue of position sensitivity in image information by introducing positional encoding and more complex scanning mechanisms. Building on this foundation, Mamba has been applied to a wider range of dense prediction tasks, including semantic segmentation [62], [63], remote sensing image change detection [64], [65], medical image segmentation [66], and even video tasks [67]. Besides, as an important low-level vision task, Mamba-based image SR works have recently begun to emerge. VMambaIR [45] embedding an improved SSM module into the UNet structure, achieving state-of-the-art results in image restoration and super-resolution tasks. Similarly, MambaIR [44], a simple but effective baseline, enhances the performance of vanilla Mamba using local enhancement and channel attention mechanisms. Xiao et al. achieved super-resolution of remote sensing images by introducing an additional frequency selection framework [68].\nAlthough Mamba has been widely studied in various visual and image domains, research in the meteorological field is still limited. Particularly for the critical task of meteorological downscaling, it is meaningful to explore how to leverage Mamba's strengths to enhance model performance, considering the specific characteristics of the task."}, {"title": "III. MAMBADS", "content": "This section will provide a detailed introduction to the proposed MambaDS structure.\nA. Preliminaries: State Space Models\nOriginal State Space Models (SSMs) [69] are mathematical representations used to describe dynamic systems, extensively applied in control theory, economics, signal processing, and more. They employ a set of first-order differential or difference equations to capture the system's dynamics. A common type of state space model is the Linear Time-Invariant (LTI) system [70], which uses a linear ordinary differential equation (ODE), as shown in Eq. 1, to describe the mapping relationship from the stimulation $x(t) \\in \\mathbb{R}$ to the response $y(t) \\in \\mathbb{R}$ through a latent state $h(t) \\in \\mathbb{R}^N$.\n$h'(t) = Ah(t) + Bx(t)$,\n$y(t) = Ch(t) + Dx(t)$,\t\t\t\t\t\t\t\t\t\t(1)\nwhere $A \\in \\mathbb{R}^{N\\times N}, B \\in \\mathbb{R}^{N\\times1}, C \\in \\mathbb{R}^{1\\times N}$, and $D\\in\\mathbb{R}$ represent the parameters of the ODE, N indicates the state size.\nTo further discretize the continuous differential equation for adaptation to deep learning algorithms, a timescale parameter \u25b2 is used to discretize the continuous parameters A and B using the Zero-Order Hold (ZOH) criterion. The discretized parameters can be expressed as:\n$\\bar{A} = exp(\\Delta A)$,\n$\\bar{B} = (\\Delta A)^{-1}(exp(A) - I) \\cdot \\Delta B$.\t\t(2)\nTherefore, the discretized version of Eq. 1 can be expressed as:\n$h_k = \\bar{A}h_{k-1}+ \\bar{B}x_k$,\n$Y_k = Ch_k + Dx_k$,\t\t\t\t\t\t\t\t\t\t\t(3)\nwhich is consistent with the representation of a recurrent neural network (RNN) [71]. However, the inherent structure of RNNs poses challenges for parallel processing. Additionally, the parameters of traditional SSM models are independent of input data, making it difficult to adapt to more complex dynamic systems.\nTo address the issues mentioned above, recent advancements in state space models, such as S4 and Mamba [39], have transformed the RNN-based representation into a parallelizable CNN form:\n$K \\triangleq (CB, C\\bar{A}B,......,C\\bar{A}^{L-1}B)$,\ny = x * K,\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t(4)\nwhere K\u2208 RL denotes the structured convolution kernel, L denotes the length of input sequence, * is the convolution operation. Additionally, Mamba modifies the parameters B, C, and A to be input-dependent, enhancing the modeling capability for complex systems. Parallel scan algorithms and hardware-aware algorithms have also been proposed to improve computational efficiency on GPUs."}, {"title": "B. Overall Structure", "content": "As shown in Fig. 1, our proposed MambaDS consists of three main stages: a shallow feature extraction, a residual hierarchical Mamba-based encoder, and a topography-constrained reconstruction, which is inspired by the overall architecture of SwinIR [32]. Specifically, given the input low-resolution meteorological fields $F_{input} \\in \\mathbb{R}^{h\\times w \\times V}$, where h and w indicate the number of vertical and horizontal grids, V represents the number of variables. We first utilize a 3\u00d73 convolutional layer to embed the input field to the dimension of $F_{embed} \\in \\mathbb{R}^{h\\times w \\times C}$, where C is the embedding dimension. Subsequently, $F_{embed}$ extracts deep features through multiple stacked Residual State Space Blocks (RSSBs), each containing several Multivariable Correlation-Enhanced Visual State Space Modules (MCE-VSSMs) and a final convolutional layer to refine extracted features. For each RSSB, the extracted feature is denoted as $F_{inter}^l \\in \\mathbb{R}^{h\\times w \\times C}, l \\in \\{1,2,......,L\\}$. The final deep feature obtained could be computed by $F_{feature} = F_{inter}+F_{embed}$ and is combined with the input low-resolution field $F_{input}$ to be fed into the topography-constrained reconstruction to achieve a high-resolution meteorological field $F_{output} \\in \\mathbb{R}^{H\\times W \\times V}$ with additional topography information."}, {"title": "C. Multivariable Correlation-Enhanced VSS Module", "content": "According to the description above, different meteorological variable fields are treated as channel dimensions of a natural image and stacked together. This approach is also widely used in other AI for meteorology fields, such as weather forecasting [6], bias correction [36], and assimilation [72]. However, unlike similar spectral channel distributions in images like RGB, different meteorological variables typically exhibit completely different distribution characteristics. Therefore, directly applying image super-resolution methods to multivariable meteorological downscaling tasks, as done in previous downscaling works [25], [36], is limited because it overlooks the different distribution characteristics of each variable. Additionally, there are relationships between variables, often described by atmospheric differential equations.\nTherefore, to enhance the modeling capability of correlations between different meteorological variables, as shown in Fig. 1(b), we propose a Multivariable Correlation-Enhanced Visual State Space Module (MCE-VSSM). Specifically, given the internal features of the extracted field $F_{inter} \\in \\mathbb{R}^{h\\times w \\times C}$, we apply the LayerNorm (LN) [73] first and then followed by a three-branched architecture. The output features can be computed by:\n$F_{inter}' = LN(F_{inter})$,\n$F_{inter,1} = SiLU(Linear(F_{inter}'))$,\n$F_{inter,2} = Linear(Conv(SiLU(SSM(LN(F_{inter}')))))$, (5)\n$F_{inter,3} = Linear(Avgpool(CA(F_{inter}')))$,\n$F_{intero} = Linear(F_{inter,1} \\odot F_{inter,2} \\odot F_{inter,3})$,\nwhere, SSM(\u00b7) indicates our proposed 5-Direction Selective Scan Module, CA(\u00b7) represents the channel attention operation. \\odot indicates the Hadamard product. In the above operation, this can be seen as integrating the correlation information"}, {"title": "D. 5-Direction Selective Scan Module", "content": "The vanilla Mamba [39], designed for one-dimensional sequence data in natural language, uses only two directions (forward and backward scanning) to capture the correlation between tokens. However, for image-like 2D grid data with a non-casual nature, both temporal and spatial correlations need to be captured. Therefore, the improved method uses four-directional scanning (top-left to bottom-right, bottom-right to top-left, top-right to bottom-left, and bottom-left to top-right) to enhance the model's spatiotemporal modeling capability [47].\nBuilding on this, to address the chaotic nature of meteorological processes, and inspired by [61], we added a random scanning branch to further enhance the model's ability to capture chaotic dynamic systems (as shown in Fig. 1(c)). Specifically, we predefine a random index list, shuffle the input tokens, and fed them into the Mamba module for feature extraction. Then, we restore the original order using the index list and integrate it with other scanning branches."}, {"title": "E. Efficient Topography-Constraint Layer", "content": "Topography is an important factor and prior information in the downscaling process of meteorological variables. Effectively utilizing high-resolution topographic data to guide the texture restoration of meteorological fields is key to enhancing downscaling performance [15]. This characteristic largely reflects the difference between downscaling and general natural image super-resolution, as natural images lack explicit prior texture information that can be utilized. In previous downscaling works [25], [36], [54], DEM and other topographic data have often been integrated as auxiliary information in the process. However, most studies incorporate topographic information as a separate additional input, directly integrating the raw or independently encoded topographic data into the feature vectors of the hidden layers. Although this approach can implicitly encode geographic information in the feature maps, the spatial information of high-resolution topography is lost during the feature map alignment process. This requires the model to recover detailed textures through encoded semantic features, which increases the learning difficulty to some extent. Additionally, the extra encoding and feature extraction of topography increase the number of parameters and computational complexity of the entire downscaling model.\nTherefore, we propose an efficient topography constraint layer for better preserving the detailed textures of the topography and avoiding additional computational overhead. Inspired by [74], as shown in Fig. 1(a), we placed it directly at the end of the MambaDS model to use topography information to constrain the downscaling model's output. Therefore, the proposed layer can be applied to any other downscaling model in the future to efficiently utilize geographic information and enhance downscaling performance.\nSpecifically, we use high-resolution DEM data from ETOPO [75] as topography information and interpolate it to match the spatial resolution of the target meteorological field. As illustrated in Fig. 2, for a given pixel $x_i$ from low-resolution field $F_{input}$, the downscaling model could produce the corresponding predicted high-resolution pixel $\\{y_1^i,y_2^i,......,y_n^i\\}$,"}, {"title": "IV. RESULTS", "content": "This section introduces the study area and dataset used in this paper, as well as the experimental setup and results.\nA. Study Area\nAs shown in Fig. 3, to fully validate the effectiveness of our proposed method, we selected two regions for our study: China mainland and the Continental United States (CONUS). Specifically, for the mainland China region, we selected the research area with a boundary of 80\u00b0E to 136\u00b0E and 18\u00b0N to 54\u00b0N, aligns with the study area of our previous work [59]. For the CONUS region, we selected the area with longitudes from 74\u00b0W to 121\u00b0W and latitudes from 25\u00b0N to 47\u00b0N. This area is the usable region of the HRRR CONUS data [50] in Lambert Conformal projection after geometric correction to a latitude-longitude grid.\nWe chose two study regions for two main reasons. First, we used different datasets and corresponding resolutions for experiments. These experiments roughly correspond to single-image super-resolution and real-world super-resolution tasks in image SR [44]. This helps to better validate the method's effectiveness. The second reason is that the two regions have significant differences in terrain and location. Testing the downscaling performance in different areas can better demonstrate the method's generalization capabilities.\nB. Dataset Description\nIn this paper, we use three different datasets to validate our method. Table I summarizes our dataset.\n1) ERA5 Reanalysis: ERA5 is a comprehensive reanalysis dataset produced by the European Centre for Medium-Range Weather Forecasts (ECMWF) [49]. It provides detailed climate data, combining past observations with models to produce consistent and accurate records of atmospheric conditions. ERA5 covers the global climate from 1950 to the present, offering high-resolution data on various parameters such as temperature, precipitation, wind speed, and more. This dataset is widely used for climate research, weather forecasting, and"}, {"title": "C. Experiment Setup", "content": "Building on the proposed MambaDS and the dataset mentioned above, as shown in Table I column four, we design three types of experiments to evaluate our proposed method: (1) ERA5 reanalysis downscaling, (2) HRRR analysis downscaling, and (3) Fengwu forecast downscaling. In the first experiment, the shape of input and output fields is 5 \u00d7 36 \u00d7 56 and 5 \u00d7 144 \u00d7 224 respectively, and sample label pairs were created by downsampling high-resolution fields. For the"}, {"title": "D. Performance comparison", "content": "1) ERA5 Reanalysis Downscaling: Downscaling the ERA5 reanalysis field is a simple baseline for assessing the performance of downscaling models and has recently been widely used in various meteorological benchmark tasks [80], [81]. Although ERA5 data is difficult to obtain in real-time for practical applications, its widespread use and accessibility make experiments based on it meaningful for research and application. Therefore, as shown in Table I, following our previous work, we selected five important near-surface variables as our research subjects and conducted experiments in the China mainland region. For comparison, we selected four different downscaling models, covering CNN-based [78], [79], Transformer-based [32], and the recent Mamba-based super-resolution model [45].\nTable II displays the test metrics for five variables using different methods. The results show that the proposed MambaDS method outperforms other methods across all metrics. The results also indicate that different downscaling methods effectively recover known downsampling processes. For instance, with the t2m variable, various models stabilize the MAE around 0.3K. This suggests that the experimental setup is relatively simple. Although different models still show some performance differences, this indicates that even simple tasks can effectively validate the performance of various models. It should be noted that another Mamba-based super-resolution model, VMambaIR [45], performed worse than the CNN model in this task. We believe that this is because the VMambaIR model is based on the UNet structure, which can improve the efficiency of calculations and reduce the complexity of calculations under the premise of the same number of parameters, but also reduces the model capacity. In addition, the downsampling of feature maps in the UNet structure in the encoder also leads to the loss of detailed texture information. Fig. 4 shows the visualization results of downscaling by different methods and the absolute error with the true value. It can be seen from the figure that the proposed MambaDS performs the best.\n2) HRRR Analysis Downscaling: The downscaling of the HRRR analysis field is a process of learning from the low-resolution ERA5 reanalysis field to the high-resolution analysis field. The two data are obtained from two different"}, {"title": "E. Ablation Studies", "content": "To further analyze the impact of different components of the proposed MambaDS on the model performance, we conducted ablation experiments. The experimental results listed in Table 3 show that each component in MambaDS improves the performance of the model to varying degrees, and adding all innovative components to MambaDS will achieve the best downscaling performance. Specifically, it can be seen that the addition of the MCE-VSSM module has improved all variables to varying degrees, which proves that compared with the vanilla VSSM module, the enhanced branch of multivariate correlation does provide additional modeling capabilities and model capacity for the downscaling process. As for the addition of the scanning mechanism of 5D-SSM, it can be seen that although it does not show a positive effect on all variables (such as u10), it has a positive effect on other variables. This also reflects to a certain extent that this module helps to improve the global modeling capabilities for meteorological downscaling tasks. Finally, the addition of the topography"}, {"title": "V. CONCLUSION", "content": "In this paper, we pioneer the selective state space model into meteorological field downscaling and propose a novel downscale model namely MambaDS. Compared to previous downscaling methods based on CNN and Transformer super-resolution models, MambaDS can model long-range dependencies while maintaining efficient linear computational complexity. Building on this, we made specific designs and improvements tailored to the characteristics of the downscaling task. Specifically, we first designed the MCE-VSSM to enhance the modeling of correlations between different meteorological variables, addressing the need for downscaling"}]}