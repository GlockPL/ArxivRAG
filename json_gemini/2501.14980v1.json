{"title": "A Deep State Space Model for Rainfall-Runoff Simulations", "authors": ["Yihan Wang", "Lujun Zhang", "Annan Yu", "N. Benjamin Erichson", "Tiantian Yang"], "abstract": "The classical way of studying the rainfall-runoff processes in the water cycle relies on conceptual or physically-based hydrologic models. Deep learning (DL) has recently emerged as an alternative and blossomed in hydrology community for rainfall-runoff simulations. However, the decades-old Long Short-Term Memory (LSTM) network remains the benchmark for this task, outperforming newer architectures like Transformers. In this work, we propose a State Space Model (SSM), specifically the Frequency Tuned Diagonal State Space Sequence (S4D-FT) model, for rainfall-runoff simulations. The proposed S4D-FT is benchmarked against the established LSTM and a physically-based Sacramento Soil Moisture Accounting model across 531 watersheds in the contiguous United States (CONUS). Results show that S4D-FT is able to outperform the LSTM model across diverse regions. Our pioneering introduction of the S4D-FT for rainfall-runoff simulations challenges the dominance of LSTM in the hydrology community and expands the arsenal of DL tools available for hydrological modeling.", "sections": [{"title": "1 Introduction", "content": "The rainfall-runoff relationship is a fundamental concept in hydrology. It describes how rainfall is transformed into surface runoff through interconnected hydrologic processes, such as infiltration, evapotranspiration, and the exchange of water between surface and subsurface flows (Beven & Kirkby, 1979). Thoroughly understanding these hydrologic processes and subsequently achieving accurate simulations of the rainfall-runoff relationship are critical for proactive flood forecasting and mitigation, efficient agricultural planning, and strategic urban development (Beven, 2012; Knapp et al., 1991; Moradkhani & Sorooshian, 2008).\nPhysically-based hydrologic models (PBMs), grounded in physical laws that govern hydrologic dynamics, are the standard tools for simulating rainfall-runoff relationships (Beven, 1996). However, the highly nonlinear nature of various hydrologic processes often challenges PBMs, limiting their accuracy in diverse conditions (Beven, 1989; Clark et al., 2017). Consequently, there is a growing need for innovative approaches to address the limitations of PBMs.\nDeep learning (DL) has emerged as an alternative to PBMs, showing success in capturing the complex, nonlinear patterns in rainfall-runoff simulations. The hydrology community also explores the applicability of DL models in rainfall-runoff simulations across diverse temporal scales and geospatial locations. For the large-scale studies that focus the model evaluation in the contiguous United States (CONUS), it is recognized that the decade-old Long Short-Term Memory (LSTM) networks (Hochreiter, 1997) continue to be the best-performing architecture for rainfall-runoff simulations, with even Transformers (Vaswani et al., 2017) unable to outperform LSTMs (Frame et al., 2022; Kratzert et al., 2019a,b; Liu et al., 2024).\nIn this work, we pioneer the uses of a new set of State Space Models (SSMs) (Gu et al., 2021a,b) for rainfall-runoff simulations. Since the original invention, the SSMs have achieved state-of-the-art performance across diverse tasks in video, audio, and time-series processing, excelling at long-range sequence modeling while being faster and more memory-efficient than LSTMs and Transformers (Gu & Dao, 2023; Patro & Agneeswaran, 2024). However, to the best of the authors' knowledge, there is no single study that tested out SSMs in hydrologic simulations and studied their capabilities in simulating the rainfall-runoff processes in the field of hydrology. Therefore, in this work, we raise the scientific question: Can SSMs enhance rainfall-runoff simulations and outperform the decades-old LSTM model that has been extensively used and widely accepted as the DL benchmark in hydrology community? To answer this question, we evaluate the Frequency Tuned Diagonal State Space Sequence (S4D-FT) model (Yu et al., 2025a) for rainfall-runoff simulations across 531 watersheds in CONUS and carry out a comprehensive evaluation of the model performance. Our evaluation follows a three-step approach. Firstly, the overall statistical performance of S4D-FT is compared with the basic S4D (without frequency tuning) (Gu et al., 2022), various existing DL benchmarks, and a traditional PBM (Sacramental Soil Moisture Accounting, Sac-SMA; Anderson & McDonnell (2005)) on CONUS-wide rainfall-runoff simulation tasks. Secondly, the spatial distribution of S4D-FT and LSTM performance across all study watersheds are illustrated to compare the model performance at different geographic locations. Lastly, a detailed investigation is conducted to analyze the possible factors driving regional variability in S4D-FT's performance across CONUS. Based on our three-step evaluation, we conclude that the S4D-FT model demonstrates overall better performance and identify the conditions under which S4D-FT outperforms or underperforms the LSTM model."}, {"title": "2 Datasets and Methodology", "content": "In this study, we train and test a basic S4D, a variant S4D with frequency tunning (i.e., S4D-FT), and LSTM for rainfall-runoff simulations. The methodologies for S4D and S4D-FT are described in Section 2.1. The LSTM follows the implementation of Kratzert et al. (2019a,b) to match state-of-the-art benchmarks. The hyperparameters of S4D and S4D-FT are manually tunned through a trial-and-error process (details provided in Supplementary Tables S2 and S3).\nThe training setup of the employed DL models aligns with existing LSTM and Transformer benchmarks Frame et al. (2022); Liu et al. (2024). Specifically, the DL models are trained using long-term hydrometeorological time series and catchment attributes of 531 unimpaired watersheds across CONUS from the Catchment Attributes and MEteorology for Large-sample Studies (CAMELS; Addor et al., 2017; Newman et al., 2015) as well as the corresponding streamflow measurements from the United States Geological Survey (USGS). In consistent with previous studies, we use 32 input variables (5 hydrometeorological variables from North American Land Data Assimilation System (NLDAS; Xia et al., 2012) and 27 static catchment attributes, detailed in Supplementary Table S1) from 10/1/1999 to 9/30/2008 for training and 10/1/1989 to 9/30/1999 for testing. We train each DL model with different random seeds to form an eight-member ensemble for robustness. All DL models are trained with the Adam optimizer using a sequence-to-one approach and a 365-day look-back window.\nStatistical performance of the employed DL models is evaluated at each study watersheds using six evaluation metrics, including Pearson-r correlation, Nash-Sutcliffe Efficiency (NSE; Nash & Sutcliffe, 1970), Kling-Gupta Efficiency (KGE; Gupta et al., 2009), percent bias in flow duration curve high-segment (top 2%) volume (FHV; Yilmaz et al., 2008), percent bias in flow duration"}, {"title": "2.1 State Space Models for rainfall-runoff simulations", "content": "State Space Models (SSMs) (Gu et al., 2021a,b) have recently gained increasing attention due to their strong performance in handling long-sequence data, and provide a promising alternative even to modern recurrent neural networks (RNNs) (Rusch et al., 2022; Erichson et al., 2021, 2025). SSMs' architecture enables them to efficiently model complex sequential data while addressing some of the computational and stability challenges commonly faced by recurrent neural networks. This makes SSMs well-suited for hydrologic applications, such as rainfall-runoff modeling, where long-term dependencies and evolving temporal patterns are critical.\nThe foundation of SSMs is built upon continuous-time linear time-invariant (LTI) systems, which provide a structured approach for capturing relationships between inputs, outputs, and latent states over time. These relationships can be represented by the following equations:\n$$x'(t) = Ax(t) + Bu(t), y(t) = Cx(t) + Du(t),$$\nwhere $u(t) \\in C^m$, $y(t) \\in C^P$, and $x(t) \\in C^n$ are the inputs, outputs, and latent states, respectively. Here, the matrices $A \\in C^{n \\times n}$, $B \\in C^{n \\times m}$, $C \\in C^{p \\times n}$, and $D \\in C^{m \\times p}$ are the trainable parameters. Each matrix serves a distinct role in the model: A defines how the state evolves over time, B determines how inputs influence the state, C maps the state to the output, and D directly relates inputs to outputs. This continuous formulation is later discretized for practical implementation, using a trainable sampling interval $\\Delta t > 0$, to yield the following discrete LTI system to process data sequentially over time:\n$$x_k = Ax_{k-1} + Bu_k, y_k = Cx_k + Du_k,$$\nAlthough LTI systems are linear, SSMs gain the ability to capture complex, nonlinear relationships by stacking multiple LTI systems and connecting them with nonlinear transformations, creating a deep model. At first glance, the SSM structure may resemble an RNN, leading one to question its effectiveness. However, SSMs have several unique advantages that address key limitations of RNNs and LSTMs, particularly in handling long-range dependencies. In an RNN or LSTM, each time step relies on previous steps, often resulting in slow training and inference. SSMs, on the other hand, leverage the linear properties of the LTI system, which allows them to process sequences in parallel, either in the time domain (Smith et al., 2023) or frequency domain (Yu et al., 2024; Parnichkun et al., 2024). This parallelism not only speeds up training but also improves the model's efficiency in handling long sequences.\nAdditionally, SSMs avoid the well-known issues of exploding and vanishing gradients that plague RNNs. They achieve this by constraining the spectrum of the state matrix A to the left half of the complex plane (Gu et al., 2021a, 2022), thus stabilizing gradients, and by reparameterizing A and adopting small sampling intervals $\\Delta t$ to prevent gradient decay (Wang & Li, 2023; Yu et al., 2025b)."}, {"title": "2.2 Attribution analyses of S4D-FT's relative performance over LSTM", "content": "To understand in what situations S4D-FT outperforms or underperforms LSTM, we divided the study watersheds into two groups for further attribution analysis. Group 1 includes watersheds where S4D-FT consistently outperforms LSTM, with both positive NSE and KGE skill scores. Group 2 includes the remaining watersheds with negative NSE and/or KGE skill scores, suggesting that S4D-FT does not completely outperform LSTM.\nThe analysis includes two parts. First, we identify which statistical aspects of S4D-FT's simulation drive NSE and KGE improvements or deteriorations. We compute correlations between NSE and KGE skill scores and improvements in additional evaluation metrics (FHV, Pearson-r, and PBias) across 531 study watersheds. To further validate our findings, we present simulated and observed hydrographs from the testing period for two representative watersheds from each group (i.e., one where S4D-FT performs well and one poorly). Formulations for computing FHV, Pearson-r, and PBias improvements are in Supplementary Table S4.\nSecond, we investigate how watershed characteristics influence S4D-FT's performance. We select eight hydrologic signatures as indicators of watershed streamflow characteristics, including mean daily discharge (q_mean), 5% flow quantile (low flow; q5), 95% flow quantile (high flow; q95), frequency of high-flow days (high_q_freq), average duration of high-flow events (high_q_dur), frequency of low-flow days (low_q_freq), average duration of low-flow events (low-q_dur), and frequency of no-flow days (zero_q_freq). Technical descriptions of each hydrologic signature are in Supplementary Table S5. Further, we calculate percentage differences in these signatures between Groups 1 and 2 and assess their correlation with NSE and KGE skill scores. Formulations for percentage differences are in Supplementary Table S4."}, {"title": "3 Results", "content": ""}, {"title": "3.1 Overall Performance of SSMs and Existing Benchmarks", "content": "The statistical performance of S4D-FT, basic S4D, and other benchmarks (Sac-SMA, LSTM, MC-LSTM, Transformers, and Modified Transformers) for rainfall-runoff simulations across CONUS is summarized in Table 1. Median values of evaluation metrics are presented for all study watersheds, with standard deviations across ensemble members shown in parentheses where available. The results for MC-LSTM, Transformers, Modified Transformers and Sac-SMA are directly adopted from previous studies. The results for S4D-FT, the basic S4D, and LSTM are produced by our own simulation experiments. Notably, our LSTM results align with benchmarks reported in the literature (Frame et al., 2022; Kratzert et al., 2019a,b; Liu et al., 2024).\nAccording to Table 1, S4D-FT demonstrates the best median NSE, KGE, Pearson-r, and FHV among all models. Moreover, S4D-FT shows the lowest standard deviation in NSE and Pearson-"}, {"title": "3.2 Regional Performance Comparison of S4D-FT and LSTM", "content": "Since LSTM is recognized as the leading model for CONUS-wide rainfall-runoff simulations, we focus on comparing S4D-FT and LSTM in regional performance. Figure 1(a) and 1(b) show NSE and KGE skill scores that demonstrate the relative improvement of S4D-FT over the baseline LSTM. Positive skill scores (red) indicate better performance by S4D-FT, while negative scores (blue) indicate LSTM outperforms S4D-FT. A skill score of 1 reflects theoretical best performance of S4D-FT (NSE or KGE = 1), and a skill score of 0 denotes equal performance between LSTM and S4D-FT. Darker colors represent greater differences.\nAccording to Figure 1(a) and 1(b), S4D-FT presents better NSE and KGE prevalently across much of the CONUS, as shown by the widespread distribution of red dots. The better performance of S4D-FT is particularly pronounced in the Pacific Southwest and Mid-South (including Kansas, Missouri, Arkansas, and Texas). However, S4D-FT underperforms LSTM in several regions with different spatial patterns between NSE and KGE skill scores. Specifically, NSE skill scores show clusters of negative values (blue markers) along the East Coast (e.g., Maine and Virginia) and scattered negative values in parts of the Midwest. In contrast, KGE skill scores display more frequent negative values, particularly along the East Coast (e.g., Virginia), Great Lakes, Midwest (e.g., Utah), and Pacific Northwest (Washington and Oregon)."}, {"title": "3.3 Investigating factors behind regional variability in S4D-FT performance", "content": "To further investigate the varying performance of the S4D-FT over LSTM, we divide all study watersheds into two groups based on the relative performance of S4D-FT over LSTM (described in Section 2.2). Figure 2(a) presents scatter plots overlaid with contour density of S4D-FT's NSE or KGE skill scores against its improvements or deterioration in FHV, Pearson-r, and PBias for the two groups of watersheds (Group 1 in red, Group 2 in blue). According to Figure 2(a), NSE skill scores strongly correlate with Pearson-r improvements (r = 0.61) across both groups but have limited correlation with improvements in FHV and PBias, especially for Group 2 watersheds. In contrast, for KGE skill scores, both groups of watersheds exhibit the strongest positive correlation with FHV improvements (r = 0.51 and r = 0.60 for Groups 1 and 2, respectively), followed by PBias improvements (r = 0.32 and r = 0.38 for Groups 1 and 2, respectively), but weak correlations with Pearson-r improvements.\nFigure 2(b) displays the simulated and observed hydrographs for two representative watersheds:"}, {"title": "4 Discussion", "content": "The growing use of DL models in hydrology highlights the need for a standardized evaluation framework to better understand their strengths and limitations. Current studies often differ in training and testing dataset, study periods, geospatial regions, and/or the number of watersheds analyzed, making direct comparisons difficult and potentially misleading. Therefore, we advocate adopting a standardized simulation setup (hereafter referred to as \"the standard setup\") following Frame et al. (2023) and Liu et al. (2024), which uses 531 CAMELS watersheds with NLDAS forcing, training from 10/1/1999\u20139/30/2008, and testing from 10/1/1989\u20139/30/1999.\nUnder the standard setup, the decades-old LSTM remains the top performer and prevailing benchmark in rainfall-runoff simulations, outperforming even newer architectures like Transformers. This has led to speculation that LSTM may have already reached, or is approaching, the predictive limit for rainfall-runoff simulations (Liu et al., 2024). In an effort to push the boundaries of simulation accuracy, we carry out this first-of-its-kind research in introducing the latest SSMs, specifically the S4D-FT, to the hydrology community, exploring its capability in advancing rainfall-runoff simulations, comparing its performance to the existing prevailing DL benchmark, and seeking to establish a new benchmark for this task."}, {"title": "5 Conclusions", "content": "This study proposes adopting a first-of-kind S4D-FT model for rainfall-runoff simulations of a total of 531 watersheds in CONUS. Through a comprehensive evaluation of statistical metrics and spatial performance, we demonstrate that S4D-FT outperforms the current leading model, i.e., the decades-old LSTM model, in large-scale rainfall-runoff simulations.\nOur analysis highlights that S4D-FT excels in watersheds where high- and low-flow events are frequent and prolonged, but with smaller high- and low-flow magnitudes among all study watersheds. These watersheds are often associated with snowmelt-driven regimes, such as those in the Rocky Mountains, and intermittent flow-dominated regions, like parts of the Great Plains. However, S4D-FT tends to be less effective in regions with high daily mean and peak streamflow values, such as the pluvio-nival watersheds in the Mid-Atlantic and Pacific Northwest. The limited performance of S4D-FT might be associated with less accurate simulations of high-flow regimes.\nTo conclude, our findings show that S4D-FT transcends the predictive limits of LSTM in rainfall-runoff simulations over a large number of study cases, demonstrating that S4D-FT sets a new community-based standard for CONUS-wide rainfall-runoff simulation tasks using DL models. By introducing S4D-FT to the hydrologic community and benchmarking its capabilities in rainfall-runoff simulations, we advocate for the broader use of S4D-FT in hydrologic applications as a more advanced alternative to the conventional LSTM model.\nFuture research should explore the integration of generative models for probabilistic time series forecasting Zhou et al. (2023); Naiman et al.; Lim et al. (2024) in hydrologic applications. These models can provide uncertainty estimates, which is critical for decision-making in water resource management and flood risk assessment. By capturing the inherent variability and uncertainty in rainfall-runoff processes, probabilistic approaches can provide more robust predictions, particularly in extreme flow scenarios. Combining the predictive power of SSMs like S4D-FT with generative frameworks could pave the way for next-generation hydrologic forecasting tools, offering both enhanced accuracy and actionable uncertainty estimates."}]}