{"title": "Cellpose+, a morphological analysis tool for feature extraction of stained cell images", "authors": ["Israel A. Huaman", "Fares D.E. Ghorabe", "Sofya S. Chumakova", "Alexandra A. Pisarenko", "Alexey E. Dudaev", "Tatiana G. Volova", "Galina A. Ryltseva", "Sviatlana A. Ulasevich", "Ekaterina I. Shishatskaya", "Ekaterina V. Skorba", "Pavel S. Zuna"], "abstract": "Advanced image segmentation and processing tools present an opportunity to study cell processes and their dynamics. However, image analysis is often routine and time-consuming. Nowadays, alternative data-driven approaches using deep learning are potentially offering automatized, accurate, and fast image analysis. In this paper, we extend the applications of Cellpose, a state- of-the-art cell segmentation framework, with feature extraction capabilities to assess morphological characteristics. We also introduce a dataset of DAPI and FITC stained cells to which our new method is applied.", "sections": [{"title": "1. Introduction", "content": "The understanding of a successful cell culturing is based on a correct assessment of the samples. Image analysis provides quantitative and qual- itative support for assessing cell health; microscopy also identifies nuclear damage, mycoplasma contamination, cell mutations, as well as visual signs of cell differentiation [1, 2, 3]. However, for the understanding of the biologi- cal mechanisms, precise analysis and statistical quantification requires a large amount of image data which constantly increases. This makes manual pro- cessing of the image data inefficient and time-consuming. Nowadays, much attention is paid to computerized methods and deep learning technologies as they can significantly improve the efficiency and objectiveness of bioim- age processing [4, 5]. It should be noted that the microscopy image analysis requires multiple parameters and time-consuming iterative algorithms for processing because they contain a lot of information due to different signal- to-noise ratios [5]. Advances in cell image analysis present tools to approach different visual characteristics [6, 7, 8] with the use of traditional algorithms.\nA further step is the segmentation and feature extraction of cells from culture images; a process that has been faced with the use of deep learn- ing algorithms [9, 10] and image analysis environments [11, 12, 13]. Cell segmentation task is a complex problem that has been approached from sim- pler solutions, such as image analysis tools and pre-processing techniques like binarization and thresholding, to more recent techniques, e.g. Super- Segger[14], use both image filtering and neural network resources to correct common image analysis errors. Early machine learning solutions were based on Mask R-CNN architecture[15], while recent algorithms like Stardist[16], MiSiC[17], Cellpose[18] and Omnipose[19] are based on U-net architecture variations. Our approach, the details of which can be seen in Figure 1, be- gins by selecting an extensible cell segmentation tool with a state-of-the-art performance, to couple it with feature extraction and analysis algorithms. Along with this tool, we also present a novel dataset of DAPI and FITC stained cells.\nDetection of nuclei and cells on photos is very important in microscopy image analysis. For example, nucleus or cell recognition can provide signif- icant support for object counting, segmentation, and tracking. Currently, convolutional neural networks (CNNs), fully convolutional networks (FCNs), and stacked autoencoders (SAEs) have all been successfully used for object detection in images, and the locations of objects are often suggested with identified single points near object centroids, which are indicated as seeds or markers [3]. Thus, object detection can be formulated as a pixelwise classifi- cation problem. Analyzing an input image, the network outputs a probability map, where each pixel value implies the probability of one pixel to be a seed. Therefore, the target objects can be located by seeking local maxima in the generated probability map. In practice, non-maximum suppression is often used to improve the accuracy [3, 20, 21]"}, {"title": "2. Methods", "content": ""}, {"title": "2.1. Polymer production", "content": "Poly-3-hydroxybutyrate-co-hydroxyvalerate (10% hydroxyvalerate) was synthesized by the batch culture of Cupriavidus necator B-10646, known for high PHA copolymer yields and substrate tolerance, according to the stan- dard protocol [22]. Cultivation was carried out in a BioFlo-115 automated laboratory fermentor (Bioengineering AG, Switzerland) under strictly aseptic conditions. Phosphate-buffered Schlegel medium with glucose as the main carbon source was used. Valeric acid was used as a precursor of valerate. To obtain high polymer yields, a two-stage process was carried out. In the first stage, cells were grown under nitrogen deficiency. In the second stage, cells were cultured in nitrogen-free medium.\nThe inoculum was prepared in a shaker incubator InnovaH 44 (New Brunswick Scientific, U.S.) by resuspending the museum culture [23]. Poly- mer recovery was performed with ethanol for elimination of lipids and fatty acids, followed by polymer extraction in dichloromethane. The dichloromethane extracts were evaporated twice using a rotary evaporator (Rotovapor R-300, Buchi, Germany). Then, the polymer was precipitated with hexane and dried.\nThe polymer content was determined using gas chromatography with a chromatograph-mass spectrometer. To purify the polymer, it was dissolved in chloroform multiple times and precipitated using either isopropanol or hexane. Finally, the resulting polymer was dried at 40\u00b0C [24].\nAnalysis of PHA structure, purity and physicochemical properties of P3HBV were determined using a standard set of tests. H 1 NMR spec- tra of copolymer were recorded in CDC13 on a Bruker AVANCE III 600 MHz spectrometer (Bruker, Germany) operating at 600.13 MHz. The molecular weight characteristics were determined by a gel permeation chromatography (\"Agilent Technologies\u201d 1260 Infinity, U.S.) with a refractive index detector and an Agilent PLgel Mixed-C column. Thermal characteristics were fixed by a DSC-1 differential scanning calorimeter (METTLER TOLEDO, Switzer- land). XRD structure analysis was carried out employing a D8ADVANCE X-Ray powder diffractometer equipped with a VANTEC fast linear detector, using CuKa radiation (\u201cBruker, AXS\", Germany), so as the determination of P3HBV crystallinity [25].\nP3HBV polymer films of different thicknesses were prepared by casting solution technique. P3HBV was dissolved in chloroform to obtain homo- geneous solutions with concentration of 1.0, 1.5, 2.0, 2.5 and 3.0%. These solutions were gently heated to 35\u00b0C for complete dissolution before being cast onto clean, degreased glass surfaces. The films were dried at room tem- perature for 48 hours in a dust-free environment, allowing the chloroform to evaporate completely and resulting in solid films. Thickness of samples was measured at six points for each film by Legioner EDM-25-0.001 microm- eter (Legioner, China) [26]. Upper surfaces of the films were used for cell cultivation."}, {"title": "2.2. Cell culture and image acquisition", "content": "Linear culture of mice fibroblasts NIH 3T3 was used to obtain the vi- sual data of cell adhesion on P3HBV film samples [27]. Cells were cultured under sterile conditions in a humidified atmosphere: at 37\u00b0C with 5% CO2 (MCO-19AIC SANYO Electric Co., Ltd., Japan). Dulbecco's Modified Eagle Medium, DMEM (Gibco, USA) supplemented with 10% fetal bovine serum, FBS, (HyClone, USA) and antibiotic/antimycotic (Sigma-Aldrich, USA) was used. Cells were detached from the bottom of culture flasks using trypsin (Gibco, USA) when reaching 85-95% confluence.\nTo assess the cytocompatibility of PHA samples, cells were seeded onto sterile polymer films samples at a density of 2 \u00d7 104 cells/cm\u00b2 and cultured for 72 hours. After the incubation, the samples were washed with phosphate- buffered saline and cells were fixed with 4% paraformaldehyde solution. Cell membranes were permeabilized with 0.2% Triton-X, and the cytoplasm was stained with fluorescein isothiocyanate, FITC (green) (Sigma-Aldrich, USA), for 1 hour in the dark at room temperature. The nuclei were visualized using 4',6-diamidino-2-phenylindole, DAPI (blue) (Sigma-Aldrich, USA).\nCells were visualized using a Leica DMI8 fluorescent microscope with cor- responding LAS X software. The images were recorded using Leica Microsys- tem CMS GmbH analyzer (Leica Microsystem, Germany). The scanned area was 1,08 mm\u00b2 containing 1920 \u00d7 1440 pixels. The photos were made using N PLAN EPI 10x/0.25 PH1 and N PLAN EPI 20x/0.40 PH1 objectives. Merged cells images are used in the following machine analysis."}, {"title": "2.3. Cell statistical analysis", "content": "The statistical analysis of cultured cells was performed by the operator using analysis of variance (ANOVA test). As biological objects are variable, the variance analysis finds dependencies in experimental data by examining the significance of differences in mean values. This method could compare samples based on their means and depict how different these samples are from one another. Besides, the ANOVA test can be used to describe complex relations among variables. The observed variance in a particular variable is partitioned into components attributable to different sources of variation. The simplest variant of the ANOVA test provides a statistical test of whether two or more population means are equal. Thus, ANOVA generalizes the t- test (Student's test) beyond two means. The cells counted by the human operator were then compared with the cell count obtained by Cellpose. The final counting from the software was refined until the standard deviation in the values obtained by the program matched the standard deviation obtained by the human operator."}, {"title": "3. Results and discussion", "content": ""}, {"title": "3.1. Cell segmentation", "content": "We make use of Cellpose 2.0 [18] framework to obtain segmented subjects from stained images for cytoplasm (FITC) or nuclei (DAPI). For batch pro- cessing of microscopy images, we use Cellpose in a noninteractive (command- line) mode. This tool allows the generation of a custom file (.npy) to store partial information as segmentation parameters. We extend the contents of this file to also store segmented masks, in order to allow a manual refinement.\nAs a solution for the large number of batches of cell images, we adopted a mixed processing workflow, composed by a script that performs the cell segmentation automatically with pre-defined parameters, and the use of tem- porary files to manually improve automatic results."}, {"title": "3.2. Implementation of features extraction", "content": "After a segmentation is performed, we proceed to extract characteristics from the segmented cells, which can be used to assess the biocompatibility of the substrate and the viability and state of the cells (see Figure 2). For this study, we make use of DIP and scipy libraries, which includes algorithms for image analysis. We select relevant features that can be used for further interpretation, which are listed below. When we refer to a subject detected in the image, this indicates either an area of cytoplasm belonging to a single cell or a nucleus.\n\u2022 Total amount of subjects in an image, which is the count of segmented cells per channel.\n\u2022 Area of a subject (\u00b5m\u00b2) is calculated using its chain code (contour). Each subject must be a connected component with a unique label. The area is calculated as pixels (px) primarily, then converted to square micrometers (\u00b5m\u00b2) using the dimensions of the image.\n\u2022 Roundness (R) of a subject (0.0 - 1.0), having 1.0 for a perfect circle. It is calculated as\n$R = \\frac{4 \\pi a}{p^2}$\nwhere a is the area and p is the perimeter."}, {"title": "3.3. Discussion", "content": "To detect a cell or nucleus, it is important to pay attention not only to its shape, but also to its size. In this regard, Cellpose identifies objects and compares them on average by area, discarding values that deviate from the target value (automatically calculated or manually set). In the present work, a human operator also adjusted these values.\nHowever, during mitosis, the size of the cell and its nucleus can increase significantly [28], which can lead to detection errors. In this regard, we also decided to pay attention to the ratio of the area of the nucleus and cytoplasm (see fig. 4). In addition, we are planning to use Cellpose+ for mitosis detec- tion in the future. For these purposes, we will additionally use a dataset of NIH 3T3 cells stained by hematoxylin and eosin. It has already been shown [29, 30, 31] that this type of cell staining separates fragments of the nucleus by color and can be used in deep learning methods based on pixel analysis and imaging such as Cellpose. It should be noted that the counting of nuclei can also be used to estimate the cell density on samples (fig. 4). Assuming that the number of cells on the sample corresponds to the number of nuclei and knowing the area of the analyzed image, it is possible to calculate the cell density (in cells per unit area), which characterizes the number of cells on the sample and can indirectly serve to assess the biocompatibility of the samples. By combining statistical analysis methods (for example, ANOVA) in the resulting method, we can estimate the cell density on samples quite accurately. It is known that cells are unevenly distributed on samples with different surface rigidity, which often correlates with the coating thickness and the nature of the material [32, 33]. Having tested Cellpose+ on images of cells on the surface of polyhydroxyalkanate films with different thickness and elasticity, we observed a correlation between the sample thickness and the cell density on the sample.\nThe data obtained by Cellpose+ were compared with experimental data processed by a human operator. It should be noted that the presented method allows you to quickly and efficiently determine the cell density per square millimeter or centimeter of the sample. It should also be noted that this method can be easily applied to assess cell viability. The most well- known is Live/Dead staining using acridine orange and propidium iodide [34, 35]. Cell viability in samples is defined as the ratio of the number of nuclei stained green (indicating living cells) to the number of nuclei stained red, corresponding to the total number of cells in the sample. Thus, Cell- pose+ can be easily adapted for this technique if you replace the recognition of nuclei in the blue channel (DAPI) with the orange color (RHOD) channel.\nIt should be mentioned that color and texture-based methods have some limitations as they need steady color/texture appearance for the individual nuclei to work optimally. For example, the initial version of Cellpose worked fine on well stained images, whereas due to the variations of staining and cell preparation methods, a number of images that were stained poorly, resulted in detection's fail on unfairly and fuzzily recorded images. We have taken into account some noisy edge pixels outside the true nuclei on the edge seg- ments because of the noise and extraneous tissue components in the image. Removing these signals is very important as the estimated number of nuclei may fall outside the true ones, which leads to an erroneous determination of which pixels are either valid or invalid for analysis. In our experiments, the number of such cases was small.\nIt should be noted that cell shape analysis is very important, since it allows us to suggest future differentiation of the cell. According to literature review [36, 37, 38, 39, 40], some cell lines are known to have a certain mor- phology before cell differentiation. For instance, control MSCs cells without pharmacological agents show 72% of MSC cells on the flower shape have an adipogenic fate compared to 67% of cells on the star shape showing an osteogenic fate [37]. In particular, star-like cells are found to promote expres- sion of noncanonical Wnt/Fzd signaling molecules (including down-stream effectors RhoA and ROCK previously shown to be involved in osteogene- sis [37, 38]. There is the same tendency for C2C12 cells which are capable to differentiate along several lineages and is used as a model system for osteogenic and myogenic differentiation [40]. The cells that adopted a star- like morphology tended to osteogenic differentiation while the cells having an elongated spindle-like cytoskeletal structure moderately exhibited myo- genic differentiation [40]. The geometric shape of a cell may be assigned to the mechanochemical signals and paracrine/autocrine factors that can direct MSCs to appropriate fates [38].\nAnother point why it is important to assess the shape of a cell, can be to predict its migration along the sample. It is known that when a cell moves, its morphology changes, becoming more elongated, rounded or spread-out. In addition to the cell skeleton, the shape of the cell nucleus also changes. Thus, in this work, we lay a foundation for future studies of complex cell analysis."}, {"title": "4. Conclusions", "content": "Given the relevance of segmentation procedures for cell imaging using deep learning models, the integration of morphological analysis algorithms to a high-end cell segmentation framework became a necessity that we satis- fied. The presence of a solid GUI makes the framework accessible for users with different backgrounds. Having this as priority, we selected the Cell- pose project to extend it with feature extraction algorithms. The repository of our Cellpose version was forked directly from the main source, so it is continuously synchronized. Although Cellpose allows 3D segmentation, our algorithms cover only 2D image analysis. Regarding the dataset, we provide the analyzed images samples with all their available features extracted, as well as the rest of the raw samples with their masks. For future steps, we would like to extend the number of features extracted, as well as improve the GUI according to the increase of functionalities, and then, provide the possibility to create and use plug-ins according to specific necessities."}]}