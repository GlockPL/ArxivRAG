{"title": "ENSEMBLE LEARNING FOR MICROBUBBLE LOCALIZATION IN SUPER-RESOLUTION ULTRASOUND", "authors": ["Sepideh K. Gharamaleki", "Brandon Helfield", "Hassan Rivaz"], "abstract": "Super-resolution ultrasound (SR-US) is a powerful imaging technique for capturing microvasculature and blood flow at high spatial resolution. However, accurate microbubble (MB) localization remains a key challenge, as errors in localization can propagate through subsequent stages of the super-resolution process, affecting overall performance. In this paper, we explore the potential of ensemble learning techniques to enhance MB localization by increasing detection sensitivity and reducing false positives. Our study evaluates the effectiveness of ensemble methods on both in vivo and simulated outputs of a Deformable DEtection TRansformer (Deformable DETR) network. As a result of our study, we are able to demonstrate the advantages of these ensemble approaches by showing improved precision and recall in MB detection and offering insights into their application in SR-US.\nIndex Terms- Super-resolution ultrasound, Ultrasound Localization Microscopy, Microbubbles, Transformers, Ensemble Learning.", "sections": [{"title": "1. INTRODUCTION", "content": "Traditional ultrasound techniques encounter an inherent compromise between image clarity and penetration. Enhancing resolution through increasing frequency of the propagated waves, comes at the cost of increased tissue absorption, limiting the depth of effective imaging. Conversely, lower frequencies allow for deeper penetration but yield less detailed images [1].\nFollowing the break-throughs in optical super-resolution imaging [2], Ultrasound Localization Microscopy (ULM) has been proposed, which employing the strong backscatter echo properties of ultrasound contrast agent microbubbles (MBs) can, theoretically, provide a ten-fold improvement in ultrasound blood flow imaging [3]. This advancement has significantly enhanced our understanding of disease states and progression, particularly in functional brain imaging [4], cancer [5] and diabetes [6].\nTo create super-resolution ultrasound (SR-US) images of the vascular maps, MBs injected into the bloodstream are identified, localized, and frequently monitored. The MBs, confined to blood vessels, enable detailed visualization of vascular structures [7].\nThe precision of MB localization in SR-US faces several challenges, such as Point Spread Functions (PSFs) distortion caused by MB vicinity, near-field imaging effects, variations in tissue speed of sound and attenuation [8, 9]. These factors collectively contribute to alterations in PSF shape, complicating accurate localization. On the other hand, while higher MB concentrations can reduce acquisition time, they may also lead to reduced localization precision as the MB signals coincide [10].\nAddressing these issues requires careful consideration of imaging parameters, processing techniques, and potentially the development of novel algorithms that can account for these various factors to maintain localization accuracy across diverse imaging conditions.\nIn the past few years, several methods of MB localization have been developed and evaluated. Conventional localization methods rely on the assumption of isolated scatterers within the region of interest [11]. However, this assumption breaks down as MB trajectories intersect.\nTo tackle the problem of overlapping PSFs while allowing for higher MB concentrations and shorter acquisition times, various Deep Learning (DL) networks were introduced which rely on learning complex patterns from simulations and incorporating temporal context into the localization process. A common framework employed in many DL methods is the Convolutional Neural Network (CNN) with an encoder-decoder architecture with variations in the upsampling techniques and the specific building blocks employed for feature encoding [12, 13, 14]. Shin et al. [15] introduced LOCA-ULM, which enhances localization accuracy by incorporating temporal context from adjacent frames employing two U-nets in sequence. Building on this concept, Pustovalov et al. [16] recently proposed an architecture inspired by DECODE [17]. Their method utilizes 3D CNNs to incorporate temporal context, potentially allowing for the integration of information from a larger number of frames.\nTransformer-based architectures have gained popularity in ULM due to their effectiveness in capturing long-range relationships in images. The ULM-TransUnet framework [18]"}, {"title": "2. METHODS", "content": "Object detection models can be formalized as functions h: X \u2192 Y, where X is an input image and Y = {y1,\u2026\u2026\u2026, yM} is a set of detections. The formulation here is partly based on [22]. Each detection yi is represented by a pair (ri, ci), where:\n\u2022 ri \u2208 R4 denotes the bounding box coordinates,\n\u2022 ci\u2208 [0, 1] indicates the confidence score for each bounding box.\nThis duo is generated using our previous work, DEDETR, which was shown to improve super-resolution performance both in the sense of precision and recall.\nWe consider a list LY = [Y1, . . ., Yn], where each Yi (i \u2208 {1,..., n}) is a set of detections for a frame X. While Y represents predictions from a single model.\nThe algorithm proceeds in four steps:\n1. Prediction: LY is flattened into E = [y1,..., yj], disregarding detection model.\n2. Grouping and Sorting: Elements of E are grouped based on bounding box overlap using the Intersection over Union (IoU) metric:\n$IoU (r_1,r_2) = \\frac{area(r_1 \\cap r_2)}{area(r_1 \\cup r_2)}$\nand then thresholded and sorted in descending order of their confidence score ci.\nThis produces H = [YG1, ...,YGn], where for all \u1ef9 = [\u0159, \u010d], y = [\u0159, \u010d] \u2208 YGi:\nIoU(\u0159,\u0159) > IOUthresh and \u010d, \u010d > scorethresh\n3. Ensemble Strategy: Apply one of three strategies to filter H:\n\u2022 NMS: For each YGi, keep only \u1ef9 = arg maxy\u2208YG; (c), where c is the detection score.\n\u2022 Soft NMS: Update the score of each y \u2208 Y Gi using:\nc' = c. g(IoU)\nwhere g(IoU) is a Gaussian or linear decay function.\n\u2022 Weighted NMS (NMSW): Compute the weighted average box for each YGi:\nr =  $\\frac{\\sum_{y \\in Y G_i} c y r}{\\sum_{y \\in Y G_i} c}$ (3)\n\u2022 Weighted Box Fusion (WBF): Retains all overlapping boxes and merges them into a prediction using the same weighted average as equation 3 without suppressing any boxes.\n4. Thresholding Apply the threshold that maximizes F1-score for simulation, or generates the most visually appealing results for in vivo.\nFinally the centers of MBs are found by finding the centers of the ensemble detection list Y = {y1,..., yM} of ensemble detections.\nEach of the ensemble strategies for handling overlapping detections in object detection has its strengths and limitations.\nNMS is popular for its simplicity and efficiency, retaining only the highest-scoring box while discarding others. However, this can lead to missed detections in high bubble-density regions due to its aggressive suppression. Soft-NMS mitigates this issue by reducing the scores of overlapping boxes rather than eliminating them, preserving more detections but with higher computational cost. NMSW strikes a balance by merging overlapping boxes through confidence-weighted averaging while still suppressing lower-scoring ones, improving localization accuracy but potentially discarding valid detections. Finally, WBF takes a different approach, retaining and merging all overlapping boxes to create a more accurate final prediction, making it ideal for our application. However, WBF is computationally intensive and can increase the risk of false positives (FPs) by incorporating weaker predictions. Each method thus offers trade-offs between accuracy, computational efficiency, and the preservation of overlapping detections, depending on the task requirements."}, {"title": "3. RESULTS", "content": "The data used for evaluating our method is from IEEE IUS 2022 Ultra-SR Challenge [26]. Our five networks are set as DE-DETR networks trained on different patch sizes. In this way, we can capture a variety of MB shapes in both higher density regions and deeper parts of imaging."}, {"title": "4. CONCLUSION", "content": "Our research demonstrates that ensemble techniques can significantly enhance MB localization accuracy, potentially improving disease diagnosis. However, these benefits come with trade-offs such as longer inference times, increased computational resource demands, greater complexity in debugging and interpreting predictions. While our experiments show that ensembling yields better results, the performance gains are not always proportional to the additional resources required. The enhanced reliability of our ensemble approach has significant implications for MB detection solutions, but implementation should be tailored to specific use cases. Future work should focus on optimizing the balance between performance gains and resource utilization, as well as improving the interpretability of ensemble predictions in clinical settings."}, {"title": "5. COMPLIANCE WITH ETHICAL STANDARDS", "content": "This research study was conducted retrospectively using datasets made available by [26]. This is a numerical simulation study for which no ethical approval was required."}]}