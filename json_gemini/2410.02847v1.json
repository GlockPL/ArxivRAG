{"title": "DEEP SIGNATURE: CHARACTERIZATION OF LARGE-SCALE MOLECULAR DYNAMICS", "authors": ["Tiexin Qin", "Mengxu Zhu", "Chunyang Li", "Terry Lyons", "Hong Yan", "Haoliang Lil"], "abstract": "Understanding protein dynamics are essential for deciphering protein functional mechanisms and developing molecular therapies. However, the complex high-dimensional dynamics and interatomic interactions of biological processes pose significant challenge for existing computational techniques. In this paper, we approach this problem for the first time by introducing Deep Signature, a novel computationally tractable framework that characterizes complex dynamics and inter-atomic interactions based on their evolving trajectories. Specifically, our approach incorporates soft spectral clustering that locally aggregates cooperative dynamics to reduce the size of the system, as well as signature transform that collects iterated integrals to provide a global characterization of the non-smooth interactive dynamics. Theoretical analysis demonstrates that Deep Signature exhibits several desirable properties, including invariance to translation, near invariance to rotation, equivariance to permutation of atomic coordinates, and invariance under time reparameterization. Furthermore, experimental results on three benchmarks of biological processes verify that our approach can achieve superior performance compared to baseline methods.", "sections": [{"title": "1 INTRODUCTION", "content": "Biological processes are fundamentally driven by the dynamical changes of macromolecules, particularly proteins and enzymes, within their respective functional conformation spaces. Typical examples of such processes include protein\u2013ligand binding, molecule transport and enzymatic reactions, and modern computational biologists investigate their underlying functional mechanisms by molecular dynamics (MD) simulations. Built upon density functional theory , MD has demonstrated remarkable capability in providing accurate atomic trajectories in three-dimensional (3D) conformational space and consist agreement with experimental observations."}, {"title": "2 RELATED WORKS", "content": "Molecular Representation. Encoding essential structural characteristics and biochemical properties into molecular representations is a long-standing research field in molecular biology, with wide applications in various drug discovery processes including virtual screening, similarity-based compound searches, target molecule ranking, drug toxicity prediction, and etc.\nThe current investigation into characterizing molecular dynamics, especially interatomic interaction dynamics, remains limited, with only a few studies close to ours. Among them, , are unsupervised methods that build local dynamics ensembles for manually selected particles and inspect each particle's contribution to the dynamics independently. proposes to convert MD conformations into images and employ convolutional neural network to identify diverse active states from MD trajectories. Nevertheless, these approaches cannot recognize subtle interatomic interactions among atomic pathways for dissecting protein function, nor is the complexity of their representations independent of time stamps.\nCoarse Graining (CG). CG is a widely adopted technique with the objective of preserving the crucial characteristics and dynamics inherent to a molecular system. This is achieved by grouping sets of atoms into CG beads, thereby enabling high-throughput MD simulations over larger time and length scales. Existing CG methods can be broadly categorized into two types: chemical and physical intuition-based approaches and machine learning-based approaches. The methods of first type construct the CG mapping by incorporating various biochemical properties derived from expert knowledge, for example, mapping each elaborately constructed cluster of four heavy (nonhydrogen) atoms into a single CG bead or simply assigning one CG bead centered at the a-carbon for each amino acid. Machine learning-based methods can rapidly learn accurate potential energy functions for reduced structures of MD by training on large databases. Recent advancements in this area include multiscale coarse graining that optimizes to maximize a variational force matching score, relative entropy minimization , and spectral graph approaches that account for structural typologies of proteins. However, their transferability to unseen molecules remains suspicious, and the representation capability for complex macromolecular systems without increasing dimension and complexity is still underexplored ."}, {"title": "3 METHODOLOGY", "content": "Consider various molecular systems $S^{(k)}$ that are distinct in their molecular behaviors. An MD simulation trajectory on $S^{(k)}$ provides the trajectories for all $N_k$ atoms constituting the molecules, and can be represented as a sequence of snapshots $X_{1:T_k}^{(k)} = \\{X_1^{(k)}, X_2^{(k)},...,X_{T_k}^{(k)}\\}$. Here, $X_t^{(k)} \\in \\mathbb{R}^{N_k \\times 3}$ indicates the atomic positions in 3D conformational space at time step $t \\in \\{1, ..., T_k \\}$ and $T_k$ is the total number of frames. To describe the structure of molecules within $S^{(k)}$, we define a molecular graph $G^{(k)} = \\{V^{(k)}, E^{(k)}\\}, |V^{(k)}| = N_k$, where $V^{(k)}$ is the node set corresponding to the atoms and $E^{(k)}$ is the edge set corresponding to chemical bonds. The adjacency matrix of $G^{(k)}$ is represented by $A^{(k)} \\in \\mathbb{R}^{N_k \\times N_k}$, with $A_{ij} = 1$ if $v_i, v_j \\in V^{(k)}$ and $(v_i, v_j) \\in E^{(k)}$. For the molecular property prediction task, we have access to MD trajectories from $K$ molecular systems, each endowed with property labels denoted as $\\{(X_{1:T_k}^{(k)}, y^{(k)})\\}_{k=1}^K$. The objective is to train algorithms to accurately predict the property label when provided with an previously unseen MD trajectory $X_{1:T_k}$."}, {"title": "3.2 DEEP SIGNATURE", "content": "Our proposed method, referred to as Deep Signature, consists of a deep spectral clustering module that uses GNNs to extract coarse grained dynamics from raw MD trajectories, a path signature transform module that collects iterated integrals to characterize interatomic interactions along pathways, and a classifier to enable property prediction. The overall architecture is illustrated in Fig. 1.\nDeep spectral clustering with GNNs. Given the MD trajectory $X_{1:T}$ and molecular graph $G$ for a molecular system $S$, we start with extracting the reduced trajectory $\\hat{X}_{1:T}$ by coarse gaining $X_{1:T}$ using deep spectral clustering. Specifically, we first obtain node representations via GNN layers as\n$H^{l+1} = \\sigma(\\hat{D}^{-1/2}\\hat{A}\\hat{D}^{-1/2}H^lW_{GNN}),$ (1)\nwhere $H^l$ denotes the node feature matrix at the $l$-th layer, $H^0 = X_{1:T}$, $\\hat{A} = A + I$ is the adjacency matrix $A$ plus the identity matrix $I$, $D$ is the degree matrix of $A$, $W_{GNN}$ are the learnable parameters of GNNs, and $\\sigma$ is a nonlinear activation function. After then, we compute the cluster assignment matrix $Q$ for the nodes using a multi-layer perceptron (MLP) with softmax on the output layer\n$Q = \\text{Softmax}(W_{MLP}H^L + b),$ (2)\nwhere $W_{MLP}$ and $b$ are trainable parameters of the MLP. For the assignment matrix $Q \\in \\mathbb{R}^{N \\times M}$, where $M < N$ specifies the number of clusters, each row of it represents the node's probability of belonging to a particular cluster. We employ the normalized-cut relaxation as our clustering objective for minimization\n$\\mathcal{L}_u =  \\text{Tr}(\\frac{Q^T\\tilde{A}Q}{Q^TQ}) + I_M - \\text{Tr}(\\frac{Q^TDQ}{Q^TQF_M}),$ (3)\nwhere the first term promotes strongly connected components to be clustered together, while the second term encourages the cluster assignments to be orthogonal and have similar sizes.\nUpon leveraging $Q$ from Eq. (2) for clustering, the corresponding reduced feature embedding matrix $H'$ and adjacency matrix $A'$ can be derived as follows\n$H' = Q^TH; A' = Q^T\\tilde{A}Q.$ (4)\nSince our model takes the sequence $X_{1:T}$ as input, $H'$ inherently maintains the temporal order in the form of $H'_{1:T}$. We utilize another MLP with the parameters $W_{MLP}$ and $b$ to map $H'_{1:T}$ back into a"}, {"title": "Path signature transform", "content": "Path signature transform. We now adopt the path signature method to characterize the interatomic temporal interactions among the coarse grained dynamics $\\hat{X}_{1:T} \\in \\mathbb{R}^{T \\times 3M}$. The basic idea of path signature is that, for a multidimensional continuous path, we can construct an ordered set consisting of all possible path integrals and combinations involving the path integrals among various individual dimensions as a comprehensive representation for this path. Striving for a more precise definition, consider our coarse grained trajectory $\\hat{X}_{1:T}$ with $(\\hat{X}_1, \\hat{X}_2, ..., \\hat{X}_{3M})$ for $t\\in \\{1, ...,T\\}$, let us define $X : [1,T] \\rightarrow \\mathbb{R}^{3M}$ as a piecewise linear interpolation of $\\hat{X}_{1:T}$ such that $X_t = \\hat{X}_t$ for any $t \\in \\{1,...,T\\}$, and a sub-time interval $[r_i, r_{i+1}]$ corresponding to a time partition of $[1, T]$ with $1 = r_1 < r_2 < \\cdots < r_i = T$. The depth-$D$ signature transform of $X$ over the interval $[r_i, r_{i+1}]$ is the vector defined as\n$\\text{Sig}_{r_i, r_{i+1}}^D(\\vec{X}) = \\Big( \\left( \\int_{r_i, r_{i+1}} d \\vec{X} \\right)_{j_1}, \\left( \\int_{r_i, r_{i+1}} \\! \\int_{r_i, t_1} \\cdots \\int_{r_i, t_{d-1}} d\\vec{X}_{t_1} \\cdots d\\vec{X}_{t_d} \\right)_{j_1, ..., j_d} \\Big)_{1 \\leq d \\leq D},$ (7)\nwhere for any $(j_1, . . ., j_d) \\in \\{1, . . .,3M\\}^D$,\n$S(\\vec{X})_{j_1,...,j_d}^{r_i, r_{i+1}} = \\int_{r_i, r_{i+1}} \\cdots \\int_{r_i, t_{d-1}} dX_{j_1} \\cdots dX_{j_d};$ (8)\nAfter that, we take the logarithm of the signature transform features presented in Eq. (7) to eliminate redundant elements according to the shuffle product identity and acquire some minimal collection of the stream over a time interval. Specifically, given the vector space described by depth-D signature in formal power series form as\n$Sig_{r_i, r_{i+1}}^D(\\vec{X}) = \\sum_{d=0}^D \\sum_{j_1,...,j_d \\in \\{1,...,3M\\}} S(\\vec{X})^{r_i, r_{i+1}}_{j_1,...,j_d} e_{j_1} \\cdots e_{j_d},$ (9)\nThe depth-D log-signature transform corresponds to taking the formal logarithm of Eq. (9), which can be expressed as\n$LogSig_{r_i, r_{i+1}}^D(\\vec{X}) =  \\sum_{n=1}^{3M}S(\\vec{X})^D +  \\sum_{1 \\leq n < m \\leq 3M} \\left( S(\\vec{X})^D e_n e_m - \\frac{1}{2} S(\\vec{X})^{r_i, r_{i+1}} [e_n, e_m] + \\cdots$ (10)\nwhere $[e_n, e_m]$ is the Lie bracket defined by $[e_n, e_m] = e_n \\times e_m - e_m \\times e_n$. Generally, log-signature possesses a lower dimension compared to the original signature feature while carrying exactly the same information. Through this transform, the interatomic dynamic correlations in 3D space are embedded as geometric areas into features. The resulting signature sequence, denoted as $(LogSig_{r_1,r_2}^D(\\vec{X}), LogSig_{r_2,r_3}^D(\\vec{X}),...)$, can be regarded as a discretization of dynamic data. In this work, we further utilize LSTM to tackle the nonlinear interactions between them.\nClassifier. Finally, we introduce a classifier $f$ implemented as a two-layer MLP which outputs the predicted label $\\hat{y} = f(LogSig_{1:T}^D(\\vec{X}))$ for molecular property prediction. To establish the classification objective function, we leverage cross-entropy loss defined as follows\n$\\mathcal{L}_c = -y \\log(\\hat{y}) - (1-y) \\log(1-\\hat{y}),$ (11)\nwhere $y$ is the ground truth label for the system and $\\hat{y}$ is the predicted label generated by our model.\nBy combining the loss terms from Eqs. (3), (6) and (11), we arrive at the overall loss function for training our Deep Signature model as\n$\\mathcal{L} = \\lambda_1 \\mathcal{L}_u + \\lambda_2 \\mathcal{L}_t + \\lambda_3 \\mathcal{L}_c.$ (12)"}, {"title": "3.3 EQUIVARIANCE & INVARIANCE OF LOG-SIGNATURE", "content": "Physical properties often exhibit well-defined symmetry characteristics, and integrating such equivariance into our learned feature space can enhance interpretability and mitigate learning difficulty. In the subsequent analysis, we rigorously examine the equivariance of our deep signature in relation to various geometric transformations including translation, rotation, and permutation on atomic coordinates, as well as reparameterization over time. The complete proofs are provided in Appendix A.\nTranslation invariance. The coarse-grained dynamics acquired by a linear mapping in Eq. (5) demonstrate that $X_{1:T}$ maintain equivariance with respect to translations on input trajectory $X_{1:T}$. Besides, since the path signature is composed of iterated integrals, it inherits the property of translation invariance. As a result, log-signature features are translation-invariant for the input trajectory.\nRotation invariance. When a rotation is applied to the 3D conformational space, an equivalent rotation exists in the coarse grained conformational space, indicating the equivariance of coarse grained dynamics $X'_{1:T}$ to rotations of the input trajectory $X_{1:T}$. Furthermore, while research on rotation invariance of path signatures for higher depth and multi-dimensional paths is still limited, we demonstrate that the majority of elements constituting our Deep Signature features are rotation-invariant, particularly in large-scale systems like the molecular systems studied in this work.\nPermutation equivariance. GCNs that aggregate contributions from neighboring atoms are invariant to permutations of those atoms, which implies that our coarse-grained dynamics are equivariant to permutations of atom indices. Additionally, the multi-indices used to index the iterated integrals in a signature are sorted in ascending order during implementation, ensuring that our signature features remain equivariant to permutations. This property is essential for facilitating the interpretability of our method, as it allows us to trace the dominant kinetic pathways that contribute to protein function.\nTime-reparametrization invariance. Path signature possesses a powerful property that it remains invariant under time-reparameterization of the underlying stream . This property substantially decreases the complexity of certain challenges by eliminating dependence on the sampling rate while preserving all other relevant information within the stream. Furthermore, it enhances the robustness of our method against deviations in molecular dynamics occurring over time scales."}, {"title": "3.4 IMPLEMENTATION", "content": "Architecture. Our introduced framework consists of three fundamental modules: a deep spectral clustering module, a path signature transform module and a classifier. We adopt a hierarchical pooling architecture to implement the deep spectral clustering module, which is schematically depicted in Fig. 2. As shown, it contains a stack of L graph pooling layers with each layer consisting of a GCN layer for obtaining node embeddings and an MLP layer for cluster assignment, such that it would gradually coarsen the dynamics from the atomic level. The last GCN layer and MLP take the node feature matrix and adjacency matrix processed by the L-th graph pooling layer as input and output the final coarse grained dynamics $\\hat{X}_{1:T}$."}, {"title": "5 CONCLUSION", "content": "In this paper, we introduce a novel deep learning framework, Deep Signature, to deal with the long-standing challenge of understanding protein dynamics in large-scale biological systems. It comprises soft spectral clustering to aggregate cooperative dynamics and log-signature transformation to characterize global interactive dynamics. Theoretically, our method exhibits desirable properties such as invariance to translation, near-invariance to rotation, and equivariance to atomic coordinate permutation. Experimental results on three biological process benchmarks verify the effectiveness of Deep Signature in capturing the complex interactive dynamics of large-scale molecular systems. We hope our work can offer a promising new direction for the analysis of protein dynamics."}]}