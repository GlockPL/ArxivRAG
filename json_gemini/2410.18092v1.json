{"title": "Two-Stage Radio Map Construction with Real Environments and Sparse Measurements", "authors": ["Yifan Wang", "Shu Sun", "Na Liu", "Lianming Xu", "Li Wang"], "abstract": "Radio map construction based on extensive measurements is accurate but expensive and time-consuming, while environment-aware radio map estimation reduces the costs at the expense of low accuracy. Considering accuracy and costs, a first-predict-then-correct (FPTC) method is proposed by leveraging generative adversarial networks (GANs). A primary radio map is first predicted by a radio map prediction GAN (RMP-GAN) taking environmental information as input. Then, the prediction result is corrected by a radio map correction GAN (RMC-GAN) with sparse measurements as guidelines. Specifically, the self-attention mechanism and residual-connection blocks are introduced to RMP-GAN and RMC-GAN to improve the accuracy, respectively. Experimental results validate that the proposed FPTC-GANs method achieves the best radio map construction performance, compared with the state-of-the-art methods.", "sections": [{"title": "I. INTRODUCTION", "content": "Environment-aware radio map construction [1] has emerged as one of the most promising channel modeling techniques for next-generation wireless communication systems, which reflects the actual behaviors of wireless signals in specific propagation conditions [2]. A radio map typically refers to a graphical representation of a communication environment, capturing superposition effects of the environment-dependent wireless channel quality given fixed transmitters and communication frequency, e.g., the average received signal power [3]. Among the techniques for radio map construction, traditional methods such as empirical path loss models are computationally simple and fast but fail to predict accurately in complex propagation environments. Deterministic modeling methods such as ray tracing are proposed to improve the accuracy, but they are computationally expensive and time-consuming.\nTo achieve satisfactory accuracy and speed, the latest works focus on utilizing artificial intelligence (AI). They can be categorized according to the acquired inputs: i) interpolation methods based on manual measurements, such as [4]. To ensure accuracy, a large number of manual measurements should be collected to gather the channel information from most areas, which requires substantial labor and time costs. ii) prediction methods based on environmental information, which can be obtained in advance or established by advanced real-time 3D environment sensing techniques. The frequently used environmental information includes the transmitter configuration [5], obstacle locations [6], obstacle heights [7], and top/side view of the area [8]. However, the available environmental information is usually limited, which results in low accuracy. iii) methods using both environmental information and measurements, such as [9]. Although more valuable features can be extracted from both inputs, their collecting time is usually different. Environment information is generally obtained in advance with minor changes for a long time, while the measurements are collected after real-time activities, which leads to time inconsistency. The construction accuracy and efficiency will be compromised due to this problem.\nTo compensate for the deficiencies of existing methods, we propose a new structure called first-predict-then-correct (FPTC), to reduce the negative impact of time inconsistency. Moreover, two novel sub-networks are designed with different functional modules based on generative adversarial networks (GANs), thus achieving a radio map prediction GAN (RMP-GAN) and a radio map correction GAN (RMC-GAN). The RMP-GAN utilizes environmental information to predict coarse radio maps for basic applications, and the RMC-GAN further corrects the coarse results with sparse measurements to reflect real-time communication quality. Specifically, the RMP-GAN introduces a self-attention (SA) mechanism to capture long-distance environment dependencies, and the RMC-GAN adopts residual-connection (RC) blocks to preserve more valuable low-level physical information of the inputs."}, {"title": "II. THE PROPOSED FPTC-GANS METHOD", "content": null}, {"title": "A. Overall Framework", "content": "Considering an urban communication scenario \u03a9 = {T, 0}, where multiple transmitters T = {t1, t2, ..., tr} are deployed and obstacles O = {01, 02, ..., 00} with various densities are spread in the whole area. A small part of the whole area is considered as the interest area, defined as \u03a9\u03af\u03b1 \u2208 \u03a9, reserving partial transmitters Tia \u2208 T and obstacles Oia \u2208 O inside Dia However, the reference signal received power (RSRP) inside the interest area may also be affected by the outside unknown environment (\u03a9 - \u03a9ia), such as closely deployed transmitters and nearby obstacles, due to radio propagation characteristics. Hence, the true radio map P is expressed as\n$P = \\xi(\\Omega_{i\\alpha}) + I(\\Omega - \\Omega_{i\\alpha}),$\nwhere \u00a7(\u00b7) is the modelling function based on \u03a9\u03af\u03b1, \u0399(\u03a9-\u03a9\u03af\u03b1) is the influence induced by outside unknown environments. Complete environmental information of Nia contains a lot of aspects such as the crowds and weather. To reduce the costs, Tia and Oia are considered as the accessible environmental information since they are relatively easy to obtain beforehand with minor changes for a long time. Deep-learning networks are adopted to better model \u03be(\u00b7). A prediction network fo(\u00b7) is used to predict coarse radio map $P_{pre}$ by\n$P_{pre} = f_0(T_{i\\alpha}, O_{i\\alpha}),$\nMoreover, we have to remark that in most existing works, the \u0399(\u03a9 \u2013 \u03a9ia) part is neglected ideally suggesting that the interest area is independent. However, there exists much influence in reality. Since I(\u00b7) is unpredictable, sparse radio measurements M are considered to revise the coarse prediction closer to P via a correction network ge(\u00b7). Additionally, the prediction error caused by other factors such as the unconsidered environment factors inside Nia can also be corrected in this step. The corrected radio map Pcor is computed by\n$P_{cor} = g_0(P_{pre}, M).$\nAs clarified in Sec. I, the inconsistency of access time between the environmental information and measurements may lead to negative effects on radio map construction. A two-stage FPTC-GANs method is proposed to solve this problem. The overall framework is illustrated in Fig. 1. This method follows a novel structure of FPTC, and it contains two sequentially connected sub-networks: an RMP-GAN fo(\u00b7) and an RMC-GAN go(). Specifically, the RMP-GAN is designed to process environmental information for coarse results Ppre, followed by the RMC-GAN to correct Ppre with sparse measurements for more accurate results Pcor. If the measurements are unavailable, Ppre can be directly used for basic applications. The proposed method has the advantage of obtaining the best possible results with all the available information, thus achieving a balance between efficiency, costs, and accuracy."}, {"title": "B. Environmental Information and Sparse Measurements", "content": "To make the networks fo(.) and go(.) better learn the mapping between inputs and outputs, the studied communication scenario Dia is rasterized as 2D images to represent the inputs and outputs of the networks. The Tia information is characterized by transmitter position Mtp, height, transmit power, and frequency. The obstacle information Oia is characterized by top view Mot and obstacle heights. They are combined to generate empirical radio map Mer and LoS/NLoS indicator map Min. The Mtp, Mot, Mer and Min serve as the inputs for the RMP-GAN. The sparse measurements M are aggregated in Msm, and interpolated to become Mip. The Msm, Mip and P serve as the inputs for the RMC-GAN.\nEmpirical radio map Mer generated by the COST-231 Hata empirical model [10] is used to guide the training process of the RMP-GAN. It is suitable for this work due to the appropriate frequency band and application scenarios. Most of the existing works such as [7] [8] [11] perform calibration on the empirical models using the training set. Although it brings more accurate results, the generalization is reduced since much more data is required for calibration. To avoid this problem, we only use the basic parameters. The path loss PL is:\n$PL = 46.3 + 33.9 log_{10}(f) - 13.82 log_{10}(h_b) - a_{hm} +(44.9 - 6.55 log_{10}(h_b)) log_{10}(d) + C_m,$\nwhere f is the frequency in MHz, and hy is the height of the transmitter above the ground in meters. For urban scenarios, $a_{hm} = 3.20(log_{10}(11.75h_r))^2 - 4.97$, where hr is the height of the receiver above the ground in meters. Cm is 3 dB, and d is the distance between the transmitter and receiver in kilometers.\nLoS/NLoS indicator map Min is generated according to the relative positions between transmitters and receivers with consideration of the obstacles. If a direct LoS path exists, signal propagation follows the rule of free space path loss; otherwise, the signal will be blocked and propagation rules become complicated. Therefore, Min can help the RMP-GAN better learn the propagation modes. For each position in a radio map, it is an LoS state if \u2200hi < hgmax, where hi represents the height of the ith point (x, y) on the line l between the transmitter (\u0445\u044c, \u0443\u044c) and receiver(xr,Yr), hgmax represents the boundary value of LoS and NLoS paths calculated using geometry methods. Otherwise, it is an NLoS state. Assuming that the receivers are set lower than the transmitters, i.e., hr <ht as in most cases, hgmax is calculated as:\n$h_{gmax} = h_r + \\frac{\\sqrt{(x - x_r)^2 + (y - y_r)^2}}{\\sqrt{(x_b - x_r)^2 + (y_b - y_r)^2}}h_b - h_r.$\nSparse measurements are obtained from drive tests or crowdsensing [4], which reflect the current situation on-site. Interpolated Mip is generated quickly by performing simple interpolation methods on sparse measurements. The obtained Mip is used as a guide for the RMC-GAN since the localized distribution trends around each measured point can be inferred. In this work, the radial basis function (RBF) [12] interpolation method is adopted since only a few points are known, leaving large blank areas. The calculated value Iz,y for each data-free position (x, y) is represented as:\n$I_{x,y} = \\sum_{j=1}^{N}\\phi(\\sqrt{(x_j - x)^2 + (y_j - y)^2})w_j,$"}, {"title": "C. Networks Architecture", "content": "As shown in Fig. 2, the RMP-GAN and RMC-GAN are elaborated differently based on the conditional GAN (CGAN) [13], which includes a generator G and a discriminator D. Different functional modules, i.e., SA layers or RC blocks, are added respectively for the two networks.\nThe commonalities of the two networks are first introduced: For the generator, the inputs x are first downsampled through a convolution (Conv) layer, batch normalization (BN), and leaky rectified linear units activation (Leaky ReLu); then concentrated and upsampled through deconvolution (ConvT), dropout (Drop), and activated to generate G(x). The discriminator distinguishes whether it is fake or real through downsampling structure, flattened and dense layers. As for the differences, SA layers are chosen for the RMP-GAN, and RC blocks are added for the RMC-GAN. The positions of these modules are highlighted using red color in Fig. 2. The improvements caused by these modules are verified in Sec. III-C.\nSince radio propagation is the mutual influence results of all obstacles in the entire scene, herein SA in the RMP-GAN helps understand spatial dependencies between long-distance locations, which contributes to capturing large-scale wireless channel features with a focus on key factors. Given the input feature Xin, SA enhances the feature extraction by\n$X_{out} = X_{in} + \\upsilon \\cdot (softmax(W_qW_k^T) \\cdot W_v),$\nwhere Wq, Wk and Wv are query, key, and value after 1 \u00d7 1 Conv layer; Wq and We are used to calculate attention scores through softmax. After that, it is multiplied by W for weighted result Xattention, which is scaled with a scalar y and added with the original Xin to get the output Xout.\nRC blocks in the RMC-GAN preserve more valuable information about Ppre and sparse measurements, such that the model focuses on learning to correct Ppre rather than reconstructing the entire radio map from scratch. RC blocks operate through xout = Relu(xin + Xmid), where Xmid is the intermediate features after Conv, BN, and ReLu. Then Xmid is added with Xin to conduct the final activation for Xout.\nThe two sub-networks use the same ground truth to compute the loss with the output Ppre for RMP-GAN and Pcor for RMC-GAN, respectively. The loss function adopts adversarial loss and L2 distance loss. The adversarial loss is:\n$L_{ad}(G, D) = E_{y~p_y}[log D(y)] + E_{x~p_x}[log(1 - D(G(x)))],$\nwhere px and py stand for the distribution of input x and ground truth y, respectively. The L2 distance loss is:\n$L_{L_2} = E_{x,y}[||x - G(y)||_2^2].$"}, {"title": "III. EXPERIMENT RESULTS AND ANALYSIS", "content": null}, {"title": "A. Dataset", "content": "The BART-Lab Radiomap Dataset\u00b9 is used to verify the proposed FPTC-GANs method. This dataset contains 2000 radio maps with different sizes varying from 140 \u00d7 268 pixels to 561 \u00d7 1313 pixels, each has corresponding top view maps and heights of the obstacles, as well as the positions and configuration of transmitters. Each map is cut to the interest areas with a fixed size of 128 \u00d7 128 pixels, preserving one transmitter and part of the obstacles inside the same map. In this work, 120 points (about 0.73%) are randomly sampled from each radio map. Since we focus on outdoor scenarios, the area with obstacles is avoided. The inputs are generated as introduced in Sec. II-B.\nAfter obtaining all inputs and corresponding target outputs, a dataset of 3518 groups of maps is created. The distribution"}, {"title": "B. Evaluation Criteria", "content": "To evaluate the model performance, four quantitative measures are used for fair comparison in different aspects, which are root mean squared error (RMSE), mean absolute error (MAE), structural similarity (SSIM), and peak signal-to-noise ratio (PSNR). RMSE and MAE are used to evaluate the error between the construction result and target in dBm; SSIM and PSNR treat the radio maps as images with [0-255] pixel values to measure the similarity of the construction result and target. Moreover, the computational complexity is measured with the inference time in seconds and the number of parameters, where lower values stand for less computational complexity.\nThe RMSE between the ground truth P and the generated radio map P is expressed as:\n$RMSE(P, \\hat{P}) = \\sqrt{\\frac{1}{N_p} \\sum_{n=1}^{N_p} (P_n - \\hat{P_n})^2},$\nwhere P and P both have Np signal-receiving points, the nth point are Pn and Pn, respectively. The MAE is expressed as:\n$MAE(P, \\hat{P}) = \\frac{1}{N_p} \\sum_{n=1}^{N_p} |P_n - \\hat{P_n}|.$\nFor the RMSE and MAE, lower values stand for better accuracy. The SSIM is expressed as:\n$SSIM(P, \\hat{P}) = \\frac{(2\\mu_P\\mu_{\\hat{P}} + C_1) (2\\sigma_{P\\hat{P}} + C_2)}{(\\mu_P^2 + \\mu_{\\hat{P}}^2 + C_1)(\\sigma_P^2 + \\sigma_{\\hat{P}}^2 + C_2)},$\nwhere up and \u03bc\u03b5 are the local means of P and P, \u03c3\u03b5 and are the local variances of P and P, opp is the local covariance between P and P. $C_1 = (k_1L)^2$ and $C_2 = (k_2L)^2$ are constants to stabilize the division when the denominator is close to zero, where L = 255 for 8-bit images, k\u2081 = 0.01 and k2 = 0.03. The PSNR is expressed as:\n$PSNR(P, \\hat{P}) = 10 log_{10} \\frac{N_p(2^q-1)^2}{\\sum_{n=1}^{N_p} (P_n - \\hat{P_n})^2},$\nwhere q = 8 for 8-bit images. For the SSIM and PSNR, higher values stand for better similarity between the two images."}, {"title": "C. Performance", "content": "Table I shows the average results of different methods. The effectiveness of extra SA layers is validated through the comparison between the RMP-GAN and cGAN in prediction tasks, and the results in correction tasks prove the capability of extra RC blocks (for fair comparison, both the RMC-GAN and CGAN in the correction part are realized using the same prediction results from the RMP-GAN). Both two novel networks show better accuracy than original cGANS, with acceptable increment in computational complexity.\nAlso, following the FPTC structure, the correction is carried out after the prediction. Comparing the results between the RMP-GAN and RMC-GAN, it is proved that the correction step is necessary since the accuracy is largely improved in all four aspects (RMSE, MAE, SSIM, and PSNR).\nMoreover, the overall performance of the FPTC-GANs is compared with state-of-the-art works. RadioUNet [6] generates radio maps with the WNet. GAN-CRME [9] utilizes an original GAN with a cooperative radio map estimation (CRME) approach. Pix2Pix+ [7] is optimized based on the Pix2Pix, focusing on the difference between real radio maps and empirical models to constrain the range. To ensure fairness, the empirical model used in Pix2Pix+ is not calibrated, which can cause a slight decrease in accuracy. All these three methods utilize environmental information and measurements, but they do not follow the FPTC structure to separate the information. DeepREM [4] carries out interpolation using generative Al with 5% measurements, which is much more than those used in other works. The results show that the proposed FPTC-GANs method outperforms other methods in accuracy. Although the computational complexity is slightly higher due to a second network and extra functional modules, the increment is acceptable compared with the advancement in accuracy, thus proving the effectiveness of this approach."}, {"title": "D. Ablation Study", "content": "Since there are multiple inputs for each network, it is necessary to verify the effect of each input. Following the idea of the ablation study, each input except the main inputs (information of obstacle top view and transmitter position in the RMP-GAN, coarse prediction and sparse measurements in the RMC-GAN) is removed separately to validate the importance of supporting information.\nAs shown in Table II, for the RMP-GAN, first the guidance provided by the empirical model and the LoS/NLoS information is verified, so Mer and Min are removed separately. Also, since Mer implicitly contains the approximate transmitter location, it is necessary to validate that Mtp is not redundant. As for the RMC-GAN, the guidance provided by the RBF interpolation needs to be confirmed, so Mip is removed. The results show that the accuracy decreases for all these experiments. Therefore, it is proved that all the supporting information contributes to accurate radio map construction."}, {"title": "IV. CONCLUSION", "content": "In this work, we presented a novel two-stage FPTC-GANS method to construct radio maps as close to reality as possible. The proposed method follows the FPTC structure and contains two generative deep-learning networks to carry out radio map prediction and correction tasks. Self-attention mechanism and residual-connection blocks are utilized respectively to adapt to the characteristics of corresponding tasks, thus yielding two novel models, the RMP-GAN and RMC-GAN, which can efficiently generate radio maps with high accuracy at low costs. The proposed FPTC-GANs method will benefit advanced emergency communication in the aspects of deterministic channel modeling, network deployment optimization, and autonomous vehicle trajectory planning."}]}