{"title": "E2E-SWIN-UNET++: AN ENHANCED END-TO-END SWIN-UNET ARCHITECTURE WITH DUAL DECODERS FOR PTMC SEGMENTATION", "authors": ["Maryam Dialameh", "Hossein Rajabzadeh", "Moslem Sadeghi-Goughari", "Jung Suk Sim", "Hyock Ju Kwon"], "abstract": "Efficiently managing papillary thyroid microcarcinoma (PTMC) while minimizing patient discomfort poses a significant clinical challenge. Radiofrequency ablation (RFA) offers a less invasive alternative to surgery and radiation therapy for PTMC treatment, characterized by shorter recovery times and reduced pain. As an image-guided procedure, RFA generates localized heat by delivering high-frequency electrical currents through electrodes to the targeted area under ultrasound imaging guidance. However, the precision and skill required by operators for accurate guidance using current ultrasound B-mode imaging technologies remain significant challenges. To address these challenges, we develop a novel AI segmentation model, E2E-Swin-Unet++. This model enhances ultrasound B-mode imaging by enabling real-time identification and segmentation of PTMC tumors and monitoring of the region of interest for precise targeting during treatment. E2E-Swin- Unet++ is an advanced end-to-end extension of the Swin-Unet architecture, incorporating thyroid region information to minimize the risk of false PTMC segmentation while providing fast inference capabilities. Experimental results on a real clinical RFA dataset demonstrate the superior performance of E2E-Swin-Unet++ compared to related models. Our proposed solution significantly improves the precision and control of RFA ablation treatment by enabling real-time identification and segmentation of PTMC margins during the procedure.", "sections": [{"title": "Introduction", "content": "Papillary Thyroid Microcarcinoma (PTMC) is characterized by tumors that are 1 cm or smaller in diameter [1]. Despite its small size, PTMC can still pose significant health risks if not managed properly [2].Radiofrequency Ablation (RFA) has emerged as a minimally invasive treatment option for PTMC treatment, particularly for patients who are not ideal candidates for open surgery [3]. RFA involves the use of high-frequency electrical currents to generate localized heat, effectively destroying cancer cells within the thyroid gland. During the RFA procedure, the physician relies on real-time ultrasound imaging to guide the ablation process [4]. However, this treatment faces two major challenges: 1) it becomes difficult for the physician to correctly identify the PTMC location and its boundaries; 2) distinguishing between normal tissue and a PTMC can be challenging in many cases [5].\nCurrently, ultrasound B-mode imaging is employed to guide RFA, allowing physicians to identify the tumor boundaries using images from the targeted area. Although ultrasound imaging offers a quick, cost-effective, and safe imaging solution, the precision of imaging and targeting, as well as the skill required from physicians, remain significant challenges [6]. First, ultrasound B-mode imaging suffers from limited resolution, which can lead to low accuracy in identifying tumor boundaries [7]. Additionally, during RFA treatment, each RF sonication generates microbubbles at the targeted area due to the ablation effect. These microbubbles can persist for minutes to hours, causing acoustic shadowing at the boundary of the PTMC. Consequently, subsequent sonications may face difficulties in accurately detecting the tumor boundary [8]. This can result in untreated tumor areas or necessitating repeated ablation procedures, increasing the risk of tissue overheating [9]. Despite advancements in medical imaging, the task of real-time targeting and tracking of the tumor area during RFA remains challenging, and clinicians continue to seek effective solutions for these issues.\nArtificial Intelligence (AI), particularly deep learning (DL) models, has been successfully employed across various fields, including medical applications [10]. One of the most prominent uses of deep learning in the medical sector is medical image segmentation [11]. Such technologies are increasingly considered as valuable tools for assisting RFA"}, {"title": "Proposed Method: E2E-Swin-Unet++", "content": "This section outlines our proposed model, E2E-Swin-Unet++, designed to address the task of PTMC segmentation from ultrasound images captured during RFA surgery. As illustrated in Figure 1 (a), the proposed E2E-Swin-Unet++ comprises one encoder and two decoders, each formed by stacking Swin-Unet blocks. The encoder receives the input grayscale patches of an ultrasound image captured during RFA surgery. These patches are first processed through a linear embedding layer, which transforms the raw pixel intensities into a sequence of tokens by splitting the image into 4 x 4 patches without overlap. Hence,each token at this stage is represented by a raw-intensity vector of size 4 \u00d7 4 \u00d7 1 = 16. Subsequently, these patches are passed through a second linear embedding layer, converting raw-pixel patches to the embedding space of size C. The embedded tokens are passed through three pairs of Swin-Transformers blocks and patch merging layers, with the same functionality as the reference encoder in vanilla Swin-Unet [21]. The workflow of the Swin-Transformers block, illustrated in Figure 1-(b), consist of two successive self-attention sub-blocks. The first sub-block employs a windowed multi-head self-attention (W-MSA) along with layer normalization and GeLU-activated MLP modules, while the second sub-block uses a shifted-window multi-head self-attention (SW-MSA).\nThe patch merging layers first normalize its input features and then reduce the spatial resolution by a factor of 2 while increasing the feature embedding size by a factor of 2. This process is computed through a linear projection operation. The encoder outputs are then passed to a bottleneck layer, comprising two consecutive Swin-Transformers layers.\nThe outputs of the bottleneck are directed towards two decoders: the first decoder predicts the thyroid gland segment, and the second decoder predicts the PTMC segment. Each decoder contains three layers, with each layer comprising a patch expanding module to up-sample the feature vector, a concatenation operator (depicted by \u00a9) to concatenate the patch expanding outputs with skip connections, a linear projection module, and finally a Swin-Transformers block. In both decoders, the linear projection modules are used to aggregate the concatenated features and maintain a consistent dimensions. Finally, a linear layer projects the decoders outputs to the generate pixel-level segmentation predictions.\nWhile both decoders are similar to each other with the same architecture, they are different in terms of their input skip connections. Specifically, the first decoder receives the encoder's intermediate features via skip connections. In contrast, the second decoder has access to information provided by the concatenated intermediate features of both the encoder and the first decoder. Therefore, the second decoder also has access to the information related to the thyroid gland, which further allows the second decoder to make more accurate predictions.\nThe proposed E2E-Swin-Unet++ is trained using an end-to-end (E2E) strategy. The training loss function consists of two components: 1) thyroid gland segmentation loss, and 2) PTMC segmentation loss. The first loss computes the prediction error for thyroid segmentation, while the second loss calculates the prediction error for PTMC segmentation. Equation 1 represents the training loss function, where \u03b1 and \u03b2 are hyper-parameters, DL(.) denotes Dice loss, and BCE(.) is the binary cross-entropy loss. Additionally, X represents the set of input samples, $F_{1}(X)$, $F_{2}(X)$ are the outputs of the first and second decoders, and $Y_{PTMC}$, $Y_{Thyroid}$ stand for the true labels for PTMCs and thyroids, respectively, associated with the inputs X."}, {"title": "Experiments", "content": "This section presents the evaluation and comparison results of our proposed E2E-Swin-Unet++ model against several relevant models. We utilized two datasets for the evaluation. The first dataset consists of 691 annotated ultrasound images collected from 101 anonymous patients who underwent RFA surgery. The dataset is divided into training, validation and test sets with proportions of 80%, 10%, 10%, respectively.The images are in jpg-format with a resolution of 786 \u00d7 531 pixels. We annotated them in collaboration with specialists, and all annotations were approved under their supervision."}, {"title": "Quantitative Evaluation", "content": "where A and B present the ground truth and the predicted segmentation, respectively. The Jaccard Index ranges from 0 to 1, where 0 indicates no overlap and 1 indicates perfect overlap. The Dice Coefficient, also known as the S\u00f8rensen-Dice Index, is a statistic used to gauge the similarity between two samples. It is calculated as twice the size of the intersection divided by the sum of the sizes of the two sets. The formula for the Dice Coefficient is:\n$D(A, B) = \\frac{2|A \\cap B|}{|A| + |B|}$"}, {"title": "Speed and Efficiency Comparison", "content": "The second experiment evaluates the performance of E2E-Swin-Unet++ in both segmentation accuracy and prediction time per sample, comparing it with several state-of-the-art models, including nnUnet, Swin-UNetr, UNetr, SegDiff, and Medsegdiff-v2. As shown in Table 2, E2E-Swin-Unet++ achieves the highest Dice score of 83.36%, outperforming all other models in terms of segmentation accuracy. This result demonstrates the effectiveness of our model in leveraging thyroid gland information and utilizing dual decoders to enhance the PTMC segmentation. When it comes to prediction time, E2E-Swin-Unet++ provides a balance between accuracy and efficiency. With an average prediction time of 0.18 seconds per sample, it is slightly slower than nnUnet and Swin-UNetr but significantly faster than UNetr, SegDiff, and Medsegdiff-v2. This result indicates that E2E-Swin-Unet++ achieves superior segmentation performance without a significant trade-off in computational efficiency. Moreover, the prediction time of less than 0.2 seconds per sample highlights the potential of E2E-Swin-Unet++ model for online prediction tasks. This rapid inference capability makes it promising for use as an AI assistant during RFA surgery, where real-time decision support is critical."}, {"title": "Ablation Study", "content": "This subsection explores the impact of different components of E2E-Swin-Unet++ on its segmentation performances. Specifically, we evaluate the effect of the first decoder, the types of skip connections and the number of skip connections on the model's overall performance.\nImpact of the first decoder: To evaluate the effectiveness of our proposed architecture, we assess the the effect of adding thyroid feature in E2E-Swint-Unet++. Specifically, we aim to understand how the first decoder enhances PTMC segmentation through the second decoder. To verify this, we removed the first decoder from the architecture and repeated the experiments outlined in Table 1. This change in the network downgrades the model to vanilla Swin-Unet. Interestingly, we observed a performance drop of 4.98% on our dataset and 3.11% on the TN3K benchmark. These results suggest that the inclusion of thyroid gland boundaries significantly enhances the model's performance.\nImpact of skip connections types: E2E-Swin-Unet++ employs Unet-like skip connections, where residual features are concatenated with current features and passed through a linear layer. This experiment explores the impact of using additive skip connections instead of concatenated ones. In this variation, residual features are added to the current features before passing them to the Swin-Transformers blocks. This modifications resulted in Dice score drops of 6.51% on our dataset and 5.11% on the TN3K benchmark. Hence, we conclude that the choice of Unet-like concatenated skip connections outperforms additive skip connections in this context.\nImpact of the number of skip connections: E2E-Swin-Unet++ employs six skip connections, with two per each layer. This experiment evaluates the impact of varying the number of skip connections on the performance. Similar to Swin-Unet, we use three skip connections from the encoder to the first decoder and three additional connections from the first decoder to the second one. In this experiment, we vary the number of skip connections from 0 to 6 and report the results in Table 3. The results indicate that increasing the number of skip connections consistently improves the model's performance, as evidenced by higher Jaccard and Dice scores on both our dataset and the TN3K benchmark. The highest performance is achieved with 6 skip connections."}, {"title": "Discussion", "content": "The proposed E2E-Swin-Unet++ model demonstrates significant promise for improving PTMC segmentation by incorporating thyroid gland information, leading to more accurate and efficient outcomes compared to existing models. The dual-decoder architecture effectively leverages thyroid features to enhance segmentation performance, as evidenced by the evaluation results. Ablation studies further validate the design choice, with substantial performance drops observed when thyroid feature integration is removed.\nLimitations: This project comes with two primary limitations. First, while the model shows promise for PTMC segmentation, its generalizability to other types of thyroid cancers or medical conditions remains uncertain. Additional studies are required to assess its applicability and performance in other medical imaging tasks. Second, the evaluation was conducted on a relatively limited set of datasets. Although the results are promising, broader validation using more diverse and larger datasets is necessary to ensure the generalizability of the model across different populations and imaging conditions.\nFuture Direction: To address these limitations, future research should focus on implementing continuous learning mechanisms that allow the model to be periodically updated with new data and feedback from clinical use, thereby maintaining its accuracy and relevance over time. Additionally, exploring hybrid models that combine convolutional neural networks with transformers or integrating multi-modal learning approaches that utilize different types of data could further enhance the model's accuracy and robustness."}, {"title": "Conclusion", "content": "This paper proposed E2E-Swin-Unet++, a novel model that incorporates thyroid gland information to enhance PTMC segmentation accuracy. The model leverages a dual decoder architectures, with the first decoder providing thyroid features to the second, leading to significant improvements in segmentation performance. Evaluation results demonstrate that E2E-Swin-Unet++ outperforms existing models. Ablation studies further confirm the importance of incorporating thyroid features, as their removal resulted in substantial performance drops, validating our design choice. Furthermore, time assessment results indicate that E2E-Swin-Unet++ also holds potential for real-time applications in clinical settings, such as AI-assisted decision-making during RFA surgeries."}]}