{"title": "3D Interaction Geometric Pre-training for Molecular Relational Learning", "authors": ["Namkyeong Lee", "Yunhak Oh", "Heewoong Noh", "Gyoung S. Na", "Minkai Xu", "Hanchen Wang", "Tianfan Fu", "Chanyoung Park"], "abstract": "Molecular Relational Learning (MRL) is a rapidly growing field that focuses on understanding the interaction dynamics between molecules, which is crucial for applications ranging from catalyst engineering to drug discovery. Despite recent progress, earlier MRL approaches are limited to using only the 2D topological structure of molecules, as obtaining the 3D interaction geometry remains prohibitively expensive. This paper introduces a novel 3D geometric pre-training strategy for MRL (3DMRL) that incorporates a 3D virtual interaction environment, overcoming the limitations of costly traditional quantum mechanical calculation methods. With the constructed 3D virtual interaction environment, 3DMRL trains 2D MRL model to learn the overall 3D geometric information of molecular interaction through contrastive learning. Moreover, fine-grained interaction between molecules is learned through force prediction loss, which is crucial in understanding the wide range of molecular interaction processes. Extensive experiments on various tasks using real-world datasets, including out-of-distribution and extrapolation scenarios, demonstrate the effectiveness of 3DMRL, showing up to a 24.93% improvement in performance across 40 tasks. Our code is publicly available at https://github.com/Namkyeong/3DMRL.", "sections": [{"title": "1 Introduction", "content": "Molecular relational learning (MRL) focuses on understanding the interaction dynamics between molecules and has gained significant attention from researchers thanks to its diverse applications [20]. For instance, understanding how a medication dissolves in different solvents (medication-solvent interaction) is vital in pharmacy [30, 26, 3], while predicting the optical and photophysical properties of chromophores in various solvents (chromophore-solvent interaction) is essential for material discovery [16]. Because of the expensive time and financial costs associated with conducting wet lab experiments to test the interaction behavior of all possible molecular pairs [31], machine learning methods have been quickly embraced for MRL.\nDespite recent advancements in MRL, previous works tend to ignore molecules' 3D geometric information and instead focus solely on their 2D topological structures. However, in molecular science, the 3D geometric information of molecules (Figure 1 (a)) is crucial for understanding and predicting molecular behavior across various contexts, ranging from physical properties [1] to biological functions [10, 46]. This is particularly important in MRL, as geometric information plays a key role in molecular interactions by determining how molecules recognize, interact, and bind with one another in their interaction environment [34]. In traditional molecular dynamics simulations, explicit solvent models, which directly consider the detailed environment of molecular interaction, have demonstrated superior performance compared to implicit solvent models, which simplify the solvent as a continuous medium, highlighting the significance of explicitly modeling the complex geometries of interaction environments [47].\nHowever, acquiring stereochemical structures of molecules is often very costly, resulting in limited availability of such 3D geometric information for downstream tasks [23]. Consequently, in the domain of molecular"}, {"title": "1.1 Our Approach", "content": "To address these challenges, we introduce a novel 3D geometric pre-training strategy that is applicable to various MRL models by incorporating the 3D geometry of the interaction environment for molecules (3DMRL). Specifically, instead of relying on costly traditional quantum mechanical calculation methods to obtain interaction environments, we first propose a virtual interaction environment involving multiple molecules designed to simulate real molecular interactions. Then, during the pre-training stage, a 2D MRL model is trained to produce representations that are aligned with those of the 3D virtual interaction environment via contrastive learning. Additionally, the 2D MRL model is trained to predict the forces between molecules within this virtual interaction environment, allowing the model to effectively learn fine-grained atom-level interactions between molecules. These two pre-training strategies enable the 2D MRL model to be pre-trained to understand the nature of molecular interactions, facilitating positive transfer to a wide range of downstream MRL tasks. In this paper, we make the following contributions:\n\u2022 Rather than relying on costly traditional quantum mechanical calculation methods to obtain interaction geometry, we propose a virtual interaction geometry made up of multiple molecules to mimic the molecular interaction environment observed in real-world conditions (Section 2.3).\n\u2022 We propose pre-training strategies that enable the 2D MRL model to learn representations aligned with the 3D virtual interaction environment and capture the intermolecular forces between interacting molecules within the environment (Section 2.4).\n\u2022 We conduct extensive experiments across various MRL models pre-trained with 3DMRL on a range of MRL tasks, including out-of-distribution and extrapolation scenarios. These experiments demonstrate improvements of up to 24.93% compared to MRL methods trained from scratch, underscoring the versatility of 3DMRL (Section 3).\nTo the best of our knowledge, this is the first paper proposing pre-training strategies specifically designed for molecular relational learning."}, {"title": "2 Method", "content": "In this section, we introduce our method, named 3DMRL, a novel pre-training framework for MRL utilizing 3D geometry information. We first formulate the MRL problem in Section 2.1. Then, in Section 2.2, we describe the 2D MRL model architecture. In Section 2.3, we introduce how to construct the virtual interaction geometry that can be utilized instead of expensive calculation of real interaction geometry of molecules. Then, in Section 2.4, we present pre-training strategies for the 2D MRL model to acquire representations aligned with the constructed virtual interaction geometry and to learn the intermolecular forces between the molecules"}, {"title": "2.1 Problem Statement", "content": "Notations. Given a molecule g, we first consider a 2D molecular graph, denoted as $g_{2D} = (X, A)$, where $X \\in \\mathbb{R}^{N \\times F}$ represents the atom attribute matrix, and $A \\in \\mathbb{R}^{N \\times N}$ is the adjacency matrix, with $A_{ij} = 1$ if a covalent bond exists between atoms i and j. Additionally, we define a 3D conformer as $g_{3D} = (X, R)$, where $R \\in \\mathbb{R}^{N \\times 3}$ is the matrix of 3D coordinates, each row representing the spatial position of an individual atom.\nTask Description. Given a 2D molecular graph pair $(g_{2D}^{1}, g_{2D}^{2})$ and 3D conformer pair $(g_{3D}^{1}, g_{3D}^{2})$, our goal is to pre-train the 2D molecular encoders $f_{2D}^{1}$ and $f_{2D}^{2}$ simultaneously with the virtual interaction geometry $g_{vr}$, derived from the 3D conformer pair. Then, the pre-trained 2D molecular encoders $f_{2D}^{1}$ and $f_{2D}^{2}$ are utilized for various MRL downstream tasks."}, {"title": "2.2 2D MRL Model Architecture", "content": "In this paper, we mainly focus on 1) the construction of virtual interaction geometry, and 2) pre-training strategies for MRL. Therefore, we employ existing model architectures for 2D MRL, i.e., CIGIN [30], which provides a straightforward yet effective framework for MRL as depicted in Figure 1 (c). However, since our pre-training strategies are applicable to various architectures beyond CIGIN, we will explain how our approach"}, {"title": "2.3 Virtual Interaction Geometry Construction", "content": "While the 3D geometry of molecules plays a significant role in predicting molecular properties, acquiring this information involves a trade-off between cost and accuracy. For example, RDKit's ETKDG algorithm [19] is fast but less accurate. In contrast, the widely adopted metadynamics method, CREST [12], achieves a more balanced compromise between speed and accuracy, yet still requires around 6 hours to process a drug-like molecule. This challenge is even more pronounced in MRL, which necessitates not just the geometry of individual molecules but also the relative spatial arrangements between multiple molecules [7, 35]. Therefore, this study aims to develop a virtual interaction geometry consisting of multiple molecules to mimic real-world molecular interactions utilizing the 3D geometry of individual molecules. However, it is not trivial to model the environment of real-world molecular interaction environments due to its chaotic nature as shown in Figure 1 (b).\nDrawing inspiration from the explicit solvent models used in traditional molecular dynamics simulations [9], we propose a one-to-many geometric configuration that involves a relatively larger molecule $g_{3D}^{1}$, determined based on its radius, surrounded by multiple smaller molecules $g_{3D}^{2}$ as shown in Figure 1 (d). Specifically, for a given conformer pair $(g_{3D}^{1} = (X_1, R_1), g_{3D}^{2} = (X_2, R_2))$, we create an environment by arranging the smaller molecules $(g_{3D}^{2,1},..., g_{3D}^{2,i},..., g_{3D}^{2,n})$ around a centrally placed larger molecule $g_{3D}^{1}$ as follows:\n\u2022 [Step 1] Select Target Atoms in the Larger Molecule. We start by randomly selecting n atoms from the larger molecule $g_{3D}^{1}$ that are not part of any aromatic ring. This choice is based on the fact that aromatic rings are more stable and less likely to engage in chemical reactions.\n\u2022 [Step 2] Positioning the Smaller Molecules. Each smaller molecule in $(g_{3D}^{2,1},..., g_{3D}^{2,i},..., g_{3D}^{2,n})$ is then placed close to one of the n selected atoms in the larger molecule $g_{3D}^{1}$. This positioning is achieved by transiting and rotating the original 3D coordinates $R^{2}$ of the smaller molecule $g_{3D}^{2}$.\n[Step 2-1] Determine Transition Direction and Distance. We generate a normalized random Gaussian noise vector $\\varepsilon$ (with a norm of 1), which will be used to set the direction for the transi-tion. We then scale this direction vector $\\varepsilon$ by the radius of the smaller molecule, $r^{2}$, to establish the transition distance.\n[Step 2-2] Transit and Rotate to the New Position. The new 3D coordinates for each smaller molecule are determined using the formula $R^{2,i} = R^{2} + \\varepsilon_{i} * r^{2} + R$, where $R_i \\in \\mathbb{R}^{3}$ represents the 3D position of the i-th selected atom in the larger molecule $g_{3D}^{1}$. This operation is performed through broadcasting, meaning $R_i$ and $\\varepsilon_{i}$ are added to each row of $R^{2}$. Additionally, we apply a random rotation matrix to rotate the small molecule after its transition. This transition and rotation operations ensure that each smaller molecule is positioned close to its corresponding selected atom on the larger molecule, simulating a realistic interaction environment.\n\u2022 [Step 3] Constructing Virtual Interaction Geometry. After positioning each smaller molecule $g_{3D}^{2,i}$ near the i-th selected atom in the larger molecule $g_{3D}^{1}$, we compile all the 3D coordinates to form a unified"}, {"title": "2.4 Pre-training Strategies", "content": "Once the virtual interaction geometry is established, we pre-train the 2D MRL model using two complementary strategies: interaction geometry contrastive learning (Section 2.4.1) and intermolecular force prediction (Section 2.4.2). Contrastive learning helps the model capture the overall interaction geometry of the molecules, while intermolecular force prediction allows the model to learn the fine-grained atom-level interaction behavior between molecules."}, {"title": "2.4.1 Interaction Geometry Contrastive Learning", "content": "Given a paired 2D molecular graphs $(g_{2D}^{1}, g_{2D}^{2})$ and its corresponding 3D virtual interaction geometry $g_{vr}$, we first encode them with a 2D MRL model, and a geometric deep learning model, respectively. For 2D molecular graphs, we compute the molecule-level representations, $z_{2D}^{1}$ and $z_{2D}^{2}$, for each molecule $g_{2D}^{1}$ and $g_{2D}^{2}$, respectively, as outlined in the Section 2.2. Following this, we derive the 2D interaction representation $Z_{2D}$, by concatenating these two representations, i.e., $Z_{2D} = (z_{2D}^{1}||z_{2D}^{2})$. On the other hand, to encode the 3D virtual interaction geometry $g_{vr} = (X_{vr}, R_{vr})$, we use geometric GNNS $f_{3D}$ that output SE(3) invariant [8] representations $Z_{3D}$ given the coordinates of atoms $R_{vr}$ in virtual interaction geometry [33], i.e., $Z_{3D} = f_{3D}(R_{vr})$. Then, as shown in Figure 1 (e), we align the 2D interaction representation $Z_{2D}$ and the 3D geometry representation $Z_{3D}$ via Normalized temperature-scaled cross entropy (NTXent) loss [4] as follows:\n$L_{cont} = \\frac{1}{N_{batch}} \\sum_{i=1}^{N_{batch}} [log\\frac{e^{sim(Z_{2D,i},Z_{3D,i}) / \\tau}}{\\sum_{k=1}^{N_{batch}} e^{sim(Z_{2D,i},Z_{3D,k}) / \\tau}} + log\\frac{e^{sim(Z_{3D,i},Z_{2D,i}) / \\tau}}{\\sum_{k=1}^{N_{batch}} e^{sim(Z_{3D,i},Z_{2D,k}) / \\tau}}]$\nwhere $sim(\\cdot, \\cdot)$ represents cosine similarity, $\\tau$ denotes the temperature hyperparameter, and $N_{batch}$ refers to the number of pairs within a batch. By training the 2D MRL model to output interaction representations that align with the 3D interaction geometry, the model can effectively learn the overall geometry of molecular interactions during the pre-training phase."}, {"title": "2.4.2 Intermolecular Force Prediction", "content": "Beyond the overall geometry of interaction, it is essential to learn about the intermolecular forces between molecules during molecular interactions, as these forces govern how molecules behave, interact, and react in various environments. Inspired by scientific knowledge, we propose a pre-training strategy to predict the direction of forces acting between molecules based on the assumption that forces are exerted between molecules during their interactions [25]. That is, we aim to pre-train the 2D MRL model to predict forces in the constructed virtual interaction geometry. However, predicting forces from a 2D representation is challenging because the prediction must adhere to the physical properties of forces, specifically being equivariant to rotations and transitions in 3D Euclidean space, also known as SE(3)-equivariance [8]. To address this, we propose predicting the force between molecules by utilizing local frame [6], which allows for flexible conversion between invariant and equivariant features."}, {"title": "3 Results", "content": "3.1 Experimental Results\nWe begin by comparing each model architecture trained from scratch with the same architecture pre-trained using our proposed strategy, referred to as +3DMRL in Table 1. We have the following observations: 1) 3DMRL obtains consistent improvements over the base graph neural networks in all 40 tasks (across various datasets and neural architectures), achieving up to 24.93% relative reduction in RMSE. While the paper is written based on CIGIN for better understanding in Section 2.2, we could observe perfor-mance improvements not only in CIGIN but also in various other model architectures, demonstrating the versatility of proposed pre-training strategies. We fur-ther demonstrate how our pre-training strategies are adopted to various model architectures in Appendix B. 2) We observe comparatively less performance im-provement of AttentiveFP in the Chromophore dataset, which can be attributed to its limited ability to predict dipole moments, which is highly related to the optical properties of molecules, as demonstrated in their own work [17]. 3) Furthermore, the comparison between CIGIN and CGIB showed that CIGIN, when pre-trained with 3DMRL, can match or even surpass the performance of CGIB. This demonstrates that 3DMRL allows the model to perform efficiently, without requiring a complex model design for improvement.\nAdditionally, we compare our pre-training strategies with recent molecular pre-training approaches proposed for molecular property prediction (MPP) of a single molecule. Table 2 and Table 3 show the results for the molecular interaction prediction task, and the drug-drug interaction (DDI) task, respectively. As these approaches are originally designed for single molecules, we first pre-train the GNNs using each strategy, then incorporate the pre-trained GNNs into the CIGIN architecture and fine-tune them for various MRL downstream tasks. We have the following observations: 4) Although MPP pre-training methods have demonstrated success in molecular property prediction in prior studies, they did not yield satisfactory results in molecular relational"}, {"title": "3.2 Extrapolation in Molecular Interaction Task", "content": "The model's generalization ability in out-of-distribution (OOD) datasets is crucial for its application in real-world scientific discovery processes. To this end, we further conduct experiments on molecular interaction tasks by assuming out-of-distribution scenarios, as shown in Table 4. Specifically, we split the dataset based on molecular structure, i.e., molecule split and scaffold split, similar to the approach used in the DDI task in Section 3. It is important to note that this scenario is significantly more challenging than the out-of-distribution DDI task in Section 3 because it involves a regression task, which can also be viewed as an extrapolation task. As shown in Table 4, we observe that pre-training approaches generally benefit model performance in extrapolation tasks, with the exception of one case, namely 3D Infomax for the Lifetime dataset. Among the pre-training approaches, 3DMRL performs the best, underscoring the extrapolation capability of 3DMRL."}, {"title": "3.3 Model Analysis", "content": "Ablation Studies. To further understand our model, we conduct an ablation study to investigate the impact of two key components on the final performance. Specifically, as shown in Equation 7, the objective function contains two terms: (i) contrastive learning-based loss and (ii) intermolecular force prediction loss; we curate two variants that involve only (i) (denoted only cont.) and only (ii) (denoted only force) in Figure 2 (a). As shown in Figure 2 (a), the contrastive learning-based loss plays a particularly critical role. Removing it from 3DMRL results in a significant performance drop, even falling below MPP pre-training strategies such as 3D Infomax and GraphMVP. This is because the contrastive loss allows the model to capture the overall interaction geometry at the molecular level, while the force prediction loss focuses on learning more fine-grained, atom-level interactions. However, combining both losses, as in 3DMRL, yields the best results, demonstrating the importance of leveraging the strengths of both levels of granularity. We provide further detailed results of ablation studies in Appendix D.2.\nEnvironment analysis. While we propose assigning a single small molecule to each target atom during molecular interaction in Section 2.3, we also investigate the impact of varying the number of assigned small molecules per atom in the larger molecule. As illustrated in Figure 2 (b), we observe a decline in model performance as the number of small molecules per atom increases, given a fixed number of target atoms n. This suggests that modeling interactions between multiple small molecules and a single atom in a larger"}, {"title": "4 Discussion", "content": "4.1 Application Areas\nThe proposed method for molecular relational learning (MRL) has broad and impactful applications across multiple fields. In pharmaceuticals, it can enhance the understanding of medication-solvent interactions, which is essential for optimizing drug solubility and bioavailability. This can lead to the development of more effective drug formulations and personalized medicine. In materials science, the method can predict the optical and photophysical properties of chromophores in different solvents, which is crucial for designing advanced materials with tailored properties for applications such as solar cells, sensors, and displays. In environmental chemistry, it can help in analyzing the interactions between pollutants and environmental matrices, supporting the development of more effective pollution monitoring and remediation strategies. In catalysis, the method can improve the understanding of catalyst-reactant interactions, leading to the design of more efficient and selective catalysts for industrial processes."}, {"title": "4.2 Broad Impact", "content": "Molecular relational learning (MRL) focuses on understanding the interaction dynamics between molecules and has gained significant attention from researchers due to its diverse applications. For instance, understanding how a medication dissolves in different solvents (medication-solvent interaction) is crucial in pharmacy, helping to optimize drug delivery and efficacy [30, 26, 3]. Similarly, predicting the optical and photophysical properties of chromophores in various solvents (chromophore-solvent interaction) is essential for material discovery, enabling the development of advanced materials with specific properties [16]. Given the high time and financial costs associated with conducting wet lab experiments to test all possible molecular interactions [31], AI-based MRL methods offer a cost-effective and efficient alternative. These methods can rapidly screen and predict molecular interactions, accelerating the discovery and optimization of new drugs and materials, thereby significantly impacting fields such as pharmaceuticals, materials science, and environmental chemistry."}, {"title": "4.3 Related Works", "content": "4.3.1 Molecular Relational Learning (MRL)\nMolecular Relational Learning (MRL) focuses on understanding the interaction dynamics between paired molecules. Delfos [22] employs recurrent neural networks combined with attention mechanisms to predict solvation-free energy, a key factor influencing the solubility of chemical substances, using SMILES string as input. Similarly, CIGIN [30] utilizes message-passing neural networks [11] along with a cross-attention mechanism to capture atomic representations for solvation-free energy prediction. In a different context, Joung et al. [16] use graph convolutional networks [18] to generate representations of chromophores and solvents, which are then used to predict various optical and photophysical properties of chromophores, essential for developing new materials with vibrant colors. Meanwhile, MHCADDI [5] introduces a co-attentive message passing network [38] designed for predicting drug-drug interactions (DDI), which aggregates information from all atoms within a pair of molecules, not just within individual molecules. Recently, CGIB [20] and CMRL [21] have introduced a comprehensive framework for MRL tasks, such as predicting solvation-free energy, chromophore-solute interactions, and drug-drug interactions. These models achieve this by identifying core functional groups involved in molecular interactions using information bottleneck and causal theory, respectively. However, prior studies have largely ignored molecules' 3D geometric information despite its well-established importance in comprehending various molecular properties.\n4.3.2 3D Pre-training for Molecular Property Prediction (MPP)\nRecently, the molecular science community has shown increasing interest in pre-training machine learning models with unlabeled data, primarily due to the scarcity of labeled data for downstream tasks [21, 37, 43]. A promising approach in this area leverages molecules' inherent nature, which can be effectively represented as both 2D topological graphs and 3D geometric graphs. For instance, 3D Infomax [36] aims to enhance mutual information between 2D and 3D molecular representations using contrastive learning. GraphMVP [23] extends this concept by introducing a generative pre-training framework alongside contrastive learning. More recently, Noisy Nodes [45] and MoleculeSDE [24] have introduced methods to learn the 3D geometric distribution of molecules using a denoising framework, thereby uncovering the connection between the score function and the force field of molecules. Although the 3D structure of molecules has been effectively leveraged in pre-training for predicting single molecular properties, it remains surprisingly underexplored in the context of molecular relational learning (MRL)."}, {"title": "4.4 Conclusion", "content": "In this work, we have proposed 3DMRL, a novel pre-training framework that effectively integrates 3D geometric information into molecular relational learning (MRL). By constructing a virtual interaction geometry and employing contrastive learning and intermolecular force prediction, our approach successfully injects complex 3D geometry information of molecular interactions into 2D MRL models. Experimental results demonstrate that 3DMRL significantly enhances the performance of 2D MRL models across various downstream tasks and neural architectures, validating the importance of incorporating 3D geometric data."}, {"title": "4.5 Limitations", "content": "In this paper, we employ virtual interaction geometry and pseudo-forces to simulate the real-world molecular interaction environment.\nThe real-world interaction geometry between molecules is highly complex, with the number of small molecules in the environment varying over time and depending on specific conditions. As such, obtaining an exact time- and condition-dependent configuration of the environment would be advantageous, achievable through conventional molecular dynamics simulations.\nAdditionally, computing the ground truth forces between molecules is computationally expensive. To address this, we propose using pseudo-forces as labels for calculating intermolecular force prediction losses. However, molecular interactions involve a range of forces such as hydrogen bonds, van der Waals forces, and ion-dipole interactions each differing considerably in magnitude. Therefore, acquiring ground truth force values through computational methods would be highly beneficial for improving the accuracy of our simulations.\nThis modeling approach was motivated by the high computational cost associated with accurately calculating the environment and forces using conventional methods. Given that a key advantage of AI in scientific applications lies in its ability to deliver efficient solutions without requiring extensive calculations, we argue that our approach strikes an effective balance between computational efficiency and accuracy, showcasing the strengths of AI-driven methodologies in addressing complex scientific challenges."}, {"title": "4.6 Future Works", "content": "Future work will extend the current research in several key directions to address more complex and challenging tasks in the field of drug discovery and materials science. Specifically, the following areas will be explored: (1) drug-target binding affinity prediction: One of the fundamental tasks in drug discovery is predicting the binding affinity between a drug molecule and its target protein. This involves understanding the interactions between small drug molecules and large, complex protein structures. Accurate prediction of binding affinities is crucial for identifying potential drug candidates and optimizing their efficacy. Future research will focus on developing advanced models that can handle the intricate structural and chemical features of protein targets. These models will aim to provide more precise predictions, thereby streamlining the drug discovery process and reducing the need for extensive experimental validation. (2) organic-inorganic interaction prediction: Another important area of research is the prediction of interactions between organic and inorganic components, particularly in the context of mimicking the dissociation process. Organic-inorganic complexes are prevalent in various applications, including catalysis, materials science, and environmental remediation. Accurately modeling the behavior of these complexes is essential for understanding and controlling their dissociation and recombination processes. Future work will involve developing sophisticated computational methods to simulate and predict the interactions between organic and inorganic species. This will require integrating knowledge from multiple disciplines, such as chemistry, physics, and materials science, to create robust and reliable models. The goal is to enhance our ability to design and optimize organic-inorganic hybrid materials for a wide range of applications."}, {"title": "C Implementation Details", "content": "C.1 Model architecture\nFor the 2D MRL model, following a previous work [30], we use 3-layer MPNNs [11] as our backbone molecule encoder to learn the representation of solute and solvent for the molecular interaction prediction, while we use a GIN [44] to encode both drugs for the drug-drug interaction prediction task [20]. We utilize a hidden dimension of 56 for molecular interaction tasks and 300 for drug-drug interaction tasks, employing the ReLU activation function for both. For the 3D virtual environment encoder $f_{3D}$, we utilize SchNet [33], which guarantees an SE(3)-invariant representation of the environment. For both molecular interaction and drug-drug interaction tasks, we configure SchNet with 128 hidden channels, 128 filters, 6 interaction layers, and a cutoff distance of 5.0.\nC.2 Model training\nFor model optimization during Pre-training stage, we employ the Adam optimizer with an initial learning rate of 0.0005 for the chromophore task, 0.0001 for the solvation free energy task, and 0.0005 for the DDI tasks. The model is optimized over 100 epochs during pre-training.\nIn the downstream tasks, the learning rate was reduced by a factor of $10^{-1}$ after 20 epochs of no improvement in model performance in validation set, following the approach in a previous work [30], with the initial learning rate of 0.005 for the chromophore task, 0.001 for the solvation free energy task, and 0.0005 for the DDI tasks.\nComputational resources. We perform all pre-training on a 40GB NVIDIA A6000 GPU, whereas all downstream tasks are executed on a 24GB NVIDIA GeForce RTX 3090 GPU.\nSoftware configuration. Our model is implemented using Python 3.7, PyTorch 1.9.1, RDKit 2020.09.1, and Pytorch-geometric 2.0.3. Our code is publicly available at https://github.com/Namkyeong/3DMRL."}, {"title": "D Additional Experimental Results", "content": "D.1 Molecular Property Prediction Pre-training with Large-Scale Datasets\nAlthough MPP pre-training approaches demonstrate unsatisfactory performance in Section 3, a positive aspect is their ability to leverage large-scale datasets containing both 2D and 3D molecular information. Consequently, we further explore whether utilizing a large-scale pre-training dataset can enhance MPP pre-training strategies in MRL tasks. To do so, we pre-train the encoders with each strategy with randomly sampled 50K molecules in GEOM dataset [2], which consists of 2D topological information and 3D geometric information, following the previous work [23]. In Table 6, we observe that a large-scale pre-training dataset does not consistently result in performance improvements for MRL downstream tasks and can still cause negative transfer in various tasks. On the other hand, we note that MoleculeSTM benefits the most from the large-scale dataset among the strategies, likely due to the complexity of its denoising framework, which necessitates a large-scale dataset to learn the data distribution effectively. Nevertheless, it still exhibits negative transfer in the FreeSolve dataset and performs worse than 3DMRL, highlighting the need for a pre-training strategy specifically tailored to molecular relational learning.\nD.2 Ablation Studies\nWe provide further ablation studies on molecular interaction task and drug-drug interaction task in Table 7 and 8, respectively.\nD.3 Environment Analysis\nWe provide further environment analysis in Figure 3. Once again, we observe that modeling a one-to-one relationship between target atoms and small molecules generally yields the best performance when the number of target atoms is fixed."}, {"title": "E Pseudocode", "content": "In this section", "3DMRL.\n1": "Input:\n\u2022 2D molecular topology graphs $g_{2D"}, {"f_{3D}$\n2": "Pre-Training Stage:\n3: For epoch in epochs:\n4: $z_{2D"}, {"g_{2D}^{2}$)\n5": "Z_{2D"}, "z_{2D}^{1}||z_{2D}^{2})$\n6: $g_{vr}$ = VIRTUAL INTERACTION GEOMETRY CONSTRUCTION ($g_{3D}^{1}, g_{3D}^{2}$)\n7: $Z_{3D} = f_{3D}(g_{vr})$ /* Virtual Geometry Encoding via SchNet */\n8: $L_{cont}$ = INTERACTION GEOMETRY CONTRASTIVE LOSS ($Z_{2D}, Z_{3D}$)\n9: $L_{force}$ = -1 INTERMOLECULAR FORCE PREDICTION LOSS ($g_{3D}^{1}, H^1, H^2$)\n10: $L_{pre-train} = L_{cont} + \\alpha \\cdot L_{force}$\n11: Update $f_{2D}^{1}, f_{2D}^{2}$, and $f_{3D}$\n12: Function 2D MRL ENCODER ($g_{2D}^{1}, g_{2D}^{2}$)\n13: $E^1 = f_{2D}^{1}(g_{2D}^{1}), E^2 = f_{2D}^{2}(g_{2D}^{2})$\n14: $I_{ij} = sim(E_i^1, E_j^2)$ where sim(,) is cosine similarity\n15: $\\tilde{E}^1 = I E^2, \\tilde{E}^2 = I^T E^1$\n16: $H^1 = (E^1||\\tilde{E}^1), H^2 = (E^2||\\tilde{E}^2)$\n17: $z_{2D}^{1} = Set2set(H^1), z_{2D}^{2} = Set2set(H^2)$\n18: return $z_{2D}^{1}, z_{2D}^{2}, H^1, H^2$\n19: Function VIRTUAL INTERACTION GEOMETRY CONSTRUCTION ($g_{3D}^{1}, g_{3D}^{2}$)\n20: Randomly select n atoms in larger molecule $g_{3D}^{1}$\n21: Copy small molecule $g_{3D}^{2}$ to n small molecules $g_{3D}^{2,1},...,g_{3D}^{2,i},...,g_{3D}^{2,n}$\n22: Generate a normalized random Gaussian noise vector $\\varepsilon$\n23: Create new 3D coordinates for each smaller molecule $g_{3D}^{2,i}$ /* Broadcasting operation */\n24: $R^{2,i} = R^2 + \\varepsilon_{i} * r^{2} + R$\n25: Create virtual interaction geometry $g_{vr}$\n$R_{vr} = (R^1||R^{2,1} || ... ||R^{2,i} || ... ||R^{2,n})$\nX_{vr} = (X^1 || X^2 || ... || X^2)\n$g_{vr} = (X_{vr}, R_{vr})$\nreturn $g_{vr}$\n26: Function INTERACTION GEOMETRY CONTRASTIVE LOSS ($Z_{2D}, Z_{3D}$)\n27: return $L_{cont} = \\frac{1}{N_{batch}} \\sum_{i=1}^{N_{batch}} [log\\frac{e^{sim(Z_{2D,i},Z_{3D,i}) / \\tau}}{\\sum_{k=1}^{N_{batch}} e^{sim(Z_{2D,i},Z_{3D,k}) / \\tau}} + log\\frac{e^{sim(Z_{3D,i},Z_{2D,i}) / \\tau}}{\\sum_{k=1}^{N_{batch"]}