{"title": "RAREAGENTS: Autonomous Multi-disciplinary Team for Rare Disease Diagnosis and Treatment", "authors": ["Xuanzhong Chen", "Ye Jin", "Xiaohao Mao", "Lun Wang", "Shuyang Zhang", "Ting Chen"], "abstract": "Rare diseases, despite their low individual incidence, collectively impact around 300 million people worldwide due to the huge number of diseases. The complexity of symptoms and the shortage of specialized doctors with relevant experience make diagnosing and treating rare diseases more challenging than common diseases. Recently, agents powered by large language models (LLMs) have demonstrated notable improvements across various domains. In the medical field, some agent methods have outperformed direct prompts in question-answering tasks from medical exams. However, current agent frameworks lack adaptation for real-world clinical scenarios, especially those involving the intricate demands of rare diseases. To address these challenges, we present RareAgents, the first multi-disciplinary team of LLM-based agents tailored to the complex clinical context of rare diseases. RareAgents integrates advanced planning capabilities, memory mechanisms, and medical tools utilization, leveraging Llama-3.1-8B/70B as the base model. Experimental results show that RareAgents surpasses state-of-the-art domain-specific models, GPT-40, and existing agent frameworks in both differential diagnosis and medication recommendation for rare diseases. Furthermore, we contribute a novel dataset, MIMIC-IV-EXT-RARE, derived from MIMIC-IV, to support further advancements in this field.", "sections": [{"title": "1 Introduction", "content": "Rare diseases are defined as disorders with low prevalence, typically affecting fewer than 1 in 2,000 individuals in Europe or fewer than 1 in 1,500 individuals in the United States (Valdez et al., 2016). Despite their rarity, over 7,000 rare diseases have been identified, impacting approximately 300 million people worldwide (Nguengang Wakap et al., 2020). Rare diseases often present with complex and heterogeneous symptoms that overlap with common diseases. As a result, patients frequently experience several years of misdiagnosis, referred to as a \"diagnostic odyssey\" (Schieppati et al., 2008). Such delays not only limit access to timely and effective treatments but also cause the worsening of the disease. While deep learning models have shown promise in medication recommendation (Zhang et al., 2017; Shang et al., 2019b; Yang et al., 2021b), their performance for rare diseases remains suboptimal. Experimental studies on the MIMIC-III and MIMIC-IV datasets (Johnson et al., 2016, 2023) reveal that current state-of-the-art (SOTA) models for medication recommendation are substantially less effective for rare diseases than common ones (Zhao et al., 2024).\nLarge language models (LLMs), trained on the massive and diverse text corpora, have demonstrated remarkable potential across a wide range of natural language interaction tasks (Achiam et al., 2023; Dubey et al., 2024). In particular, LLM-based agents exhibit impressive capabilities in augmented reasoning and problem-solving within complex environments (Wang et al., 2024). In the domain of rare diseases, RareBench (Chen et al., 2024) introduced the first benchmark to evaluate LLMs in phenotype extraction and differential diagnosis. Experimental results indicate that advanced LLMs, such as GPT-4 (Achiam et al., 2023), can achieve notable diagnostic accuracy under zero-shot settings, even outperforming human specialist physicians for certain rare diseases.\nPatients with rare diseases often experience the involvement of multiple organs and systems, necessitating multi-disciplinary team (MDT) care that integrates expertise from various specialties to enhance diagnostic accuracy and develop personalized treatment plans (Xie et al., 2023). Although several multi-agent frameworks have been proposed for general medical applications (as summarized in Table 1), these methods primarily demonstrate improved performance in tasks like multiple-choice question answering (MCQA) (Tang et al., 2024; Jin et al., 2024) and basic question answering (QA) (Kim et al., 2024), where candidate options are provided or the decision-making is confined to limited and small scopes (Li et al., 2024b). These settings differ from the complexity and uncertainty of real-world clinical scenarios. Moreover, existing approaches tend to emphasize planning capabilities while placing less focus on the integration of memory and tool use. Additionally, the definition of different agent roles is frequently left to LLMS themselves, which can lead to potential hallucinations in medical contexts (Lee et al., 2023).\nTo address these challenges, we propose a patient-centered, personalized autonomous MDT framework tailored for real-world rare disease patients, fully leveraging the planning, memory, and tool-using capabilities of LLM agents. As illustrated in Figure 1, the system simulates a rare disease patient through a Patient Agent, which communicates the patient's personal profile (e.g., symptoms) and diagnosis/treatment requests to an Attending Physician Agent. The Attending Physician Agent assembles an MDT of specialists from a predefined pool of physician agents, designed with dynamic long-term memory and the ability to utilize specialized medical tools. This approach enhances the performance of LLMs in diagnosing and treating rare diseases, ultimately offering more accurate and personalized medical care for patients.\nOverall, our contributions are three-fold: (1) We propose RareAgents, a novel patient-centered multi-disciplinary agent-based framework for enhanced diagnosis and treatment of rare diseases. Each physician agent within RareAgents is equipped with dynamic long-term memory, and can effectively utilize a wide range of medical tools, simulating the behavior of a human doctor. Additionally, RareAgents is a plug-and-play framework, easily extensible for various medical decision-making scenarios. (2) We evaluate RareAgents using Llama-3.1 models (8B and 70B), demonstrating superior diagnostic performance and improved accuracy in medication recommendations compared to state-of-the-art (SOTA) domain-specific models, GPT-40, and existing medical agent frameworks. We also validate the effectiveness of each module within the RareAgents architecture. (3) To the best of our knowledge, this work first extends the medication recommendation task"}, {"title": "2 Related Work", "content": "2.1 LLM-based Agents\nLarge language models (LLMs) as agents have demonstrated remarkable capabilities in reasoning and decision-making within complex interactive environments (Liu et al., 2023). Generative agents (Park et al., 2023) first simulated human behavior. LLM-based agents are typically composed of three key components: planning (Yao et al., 2023; Shinn et al., 2023), memory (Zhong et al., 2024), and tool-using (Nakano et al., 2021; Schick et al., 2023). Existing agent frameworks can be broadly categorized into two paradigms: single and multi-agent systems (Li et al., 2023). Among these, role-playing (Shanahan et al., 2023) is a widely adopted approach that assigns agents distinct personalities or roles, allowing them to adapt to specific task scenarios and exhibit diverse behaviors. LLM-based agents have shown significant potential in applications across domains such as education (Zhang et al., 2024b), finance (Yu et al., 2024), and healthcare (Mehandru et al., 2024).\n2.2 Medical Agents\nMed-Palm (Singhal et al., 2023) and Med-Gemini (Saab et al., 2024) have demonstrated promising single-agent capabilities as medical domain LLMs. Beyond this, MedAgents (Tang et al., 2024) introduce a multi-disciplinary collaboration framework for medical question-answering by leveraging the planning capabilities of multiple agents. MDAgents (Kim et al., 2024) adaptively adjust to the difficulty of medical questions and extend to visual-question-answering tasks. Agent Hospital (Li et al., 2024b) creates a virtual hospital environment that simulates task stratification within medical workflows. Furthermore, current applications of medical agents encompass a range of scenarios, including clinical triage (Lu et al., 2024), electronic health record reasoning (Shi et al., 2024), and medical imaging analysis (Li et al., 2024a).\n2.3 AI Models for Rare Diseases\nMost AI diagnostic models for rare diseases primarily rely on phenotypic and genotypic information (Javed et al., 2014; Robinson et al., 2020), utilizing both statistical and machine learning approaches (K\u00f6hler et al., 2009, 2017; Yang et al., 2015; Peng et al., 2016; Jia et al., 2018; Zhai et al., 2023). RareBERT (Prakash et al., 2021) introduces a Transformer-based (Vaswani et al., 2017) model aimed at identifying rare disease patients. In the realm of LLMs, dynamic few-shot prompting methods (Chen et al., 2024) have been explored to enhance diagnostic performance for rare diseases. RAREMed (Zhao et al., 2024) focuses on addressing fairness in drug recommendation systems and proposes a novel approach to improving therapeutic recommendations for rare disease patients."}, {"title": "3 Problem Formulation and Datasets", "content": "3.1 Definition of Rare Disease Tasks\nCurrent medical agent frameworks typically formulate tasks as multiple-choice questions or limited-answer problems. However, real-world clinical scenarios are far more complex. To better simulate these conditions, we provide only the patient's profile records R and require the agent to make decisions A based on the specific task demands (query). For rare disease diagnosis and treatment, we define the following task scenarios:\nDifferential Diagnosis The goal of differential diagnosis for rare diseases is to identify a specific rare disease by distinguishing it from other disorders, especially common diseases with overlapping symptoms. This task focuses on phenotype-based differential diagnosis. Specifically, the patient's profile R is represented as a set of symptoms ({$s_n$}): R = {$s_1,s_2,...,s_n$ | query = diagnosis}. No candidate disease list is provided, nor is it explicitly stated that the patient has a rare disease. The agent relies solely on the symptom information to reason and output the most likely diagnoses (e.g., the top 10 potential diseases): A = {$d_1,d_2, ..., d_{10}$}.\nMedication Recommendation This task involves patients who may have multiple admission visits. During each visit, the patient's profile R comprises a sequence of diagnosed diseases ({$d_j$}) and procedures ({$p_k$}), along with the full set of available medications M: R = {$d_1,d_2,...,d_j;p_1,p_2,\u2026\u2026,p_k;$ M | query = treatment}, where M can include hundreds of drugs (e.g., |M| = 122). The objective is to generate the optimal combination of medications to match the patient's treatment needs (exponential complexity): A = {$m_1, m_2, ..., m_l$} C M.\n3.2 Datasets\nIn this research, we utilize two publicly available datasets, RareBench (Chen et al., 2024) and MIMIC-IV (Johnson et al., 2023), for distinct tasks. RareBench is primarily employed for rare disease differential diagnosis, whereas MIMIC-IV supports various medical tasks, with medication recommendation being one of them. From MIMIC-IV, we derive MIMIC-IV-Ext-Rare, a specialized dataset for medication recommendations tailored to rare disease patients. Detailed statistics for both datasets are presented in Table 2."}, {"title": "4 Overview of RAREAGENTS.", "content": "This section introduces the proposed RareAgents framework for rare disease diagnosis and treatment. Figures 1 and 2 provide an overview of the framework and a step-by-step example of its pipeline, respectively. The RareAgents framework is composed of three core modules: (1) Multi-disciplinary Team Collaboration: The attending physician agent selects the most relevant specialists from a predefined specialist pool based on the patient's clinical information to form an MDT. These special physician agents engage in multiple rounds of discussion to reach a consensus on the diagnosis and treatment plan. (2) Dynamic Long-term Memory: Each agent, whether the attending physician or a specialist, maintains a personalized long-term memory. These memories, built from past consultation processes, act as dynamic experience bases that can be retrieved and updated continuously to assist decision-making. (3) Medical Tool Utilization: Throughout the reasoning process, all physician agents can access and utilize various diagnostic and treatment tools to support and enhance their decision-making capabilities. The complete algorithm is detailed in Appendix A.1.\n4.1 Multi-disciplinary Team Collaboration\nPrevious implementations of LLM-based MDTs often have the LLMs autonomously define the roles and responsibilities of various specialists (Tang et al., 2024; Kim et al., 2024). In contrast, our approach mirrors real-world clinical practice by leveraging specialist departments commonly involved in rare disease cases (Xie et al., 2023). Under human specialist physicians' guidance, we constructed a Specialist Pool (SP), which consists of 41 distinct clinical departments. Detailed definitions are provided in Appendix A.2. The entire MDT consultation process is divided into three stages: (i) MDT Formation (Line 3-6 of Algorithm 1): The attending physician agent assembles a patient-centric MDT. (ii) Expert Consensus (Line 15-22 of Algorithm 1): Specialist agents within the MDT engage in multi-turn discussions (up to a maximum of R rounds) to reach a consensus opinion O(R) based on patient's information R. (iii) Report Generation (Line 25 of Algorithm 1): The attending physician agent synthesizes the opinions from all MDT members to generate a final discussion report DR, where\n$DR = SUMMARY \\left(\\bigcup_{r=0}^{R} \\bigcup_{s \\in MDT} O^{(r)}_s(R)\\right)$"}, {"title": "4.2 Dynamic Long-term Memory", "content": "In real-world clinical practice, physicians rely on both personal experience and historical patient records within the healthcare system for decision-making (Trafton, 2018). Llama 3.1 (Dubey et al., 2024), with its expanded context window from 8K to 128K tokens, provides a significantly larger capacity for developing long-term memory. Inspired by these, we design a dynamic long-term memory mechanism for the physician agents in RareAgents, enabling them to store, retrieve, and update memories like human physicians (Line 12, 26, 31-33 of Algorithm 1). Agents can facilitate personalized diagnosis and treatment based on historical interactions. For diagnosis, we use the rare disease patient embeddings (Emb(*)) from RareBench (Chen et al., 2024) to dynamically retrieve the top-k most similar cases from the patient database. In subsequent experiments, we select k = 5. For treatment, we leverage the longitudinal nature of patient records in the MIMIC-IV-Ext-Rare dataset, where each patient may have multiple admission records. During the n-th admission, the physician agent retrieves the patient's records from the previous n - 1 visits. Denote MR as the result of dynamic long-term memory retrieval, where\n$MR_{diagnosis} = arg \\max_{Top-K} (Emb(R))$,\n$MR_{treatment}^{(n)} = \\bigcup_{i=1}^{n-1} MR_{treatment}^{(i)}(R)$.\n4.3 Medical Tools Utilization\nPhysicians frequently use various tools to assist decision-making in clinical practice (Kawamoto et al., 2005). Similarly, the physician agents in RareAgents have access to diagnostic and therapeutic tools to enhance their clinical reasoning capabilities (Line 14, 27 of Algorithm 1). Llama 3.1's built-in tool integration and function-calling capabilities enable the agents to interact with external environments dynamically (Dubey et al., 2024). In this research, diagnostic tools include Phenomizer (K\u00f6hler et al., 2009, 2017), LIRICAL (Robinson et al., 2020), and Phenobrain (Mao et al., 2024), all of which are accessible via APIs or web interfaces. Therapeutic tools are knowledge bases like DrugBank (for drug information) (Wishart et al., 2008) and DDI-graph (for drug-drug interaction relationships). Detailed tool functions are provided in Appendix A.3. Let T = {T1, T2, ...} denote the set of medical tool functions, and TR represents the aggregated output from the tools' feedback, where\n$T_R = CONCAT\\left(\\bigcup_{T \\in T} T_i(R)\\right)$.\nFinally, RareAgents synthesize the results from specialist consensus, dynamic long-term memory, and tools' feedback to generate the final decision A:\nA = LLM(R, DR, MR, TR)."}, {"title": "5 Experimental Setup and Main Results", "content": "5.1 Evaluation Metrics\nDifferential Diagnosis The diagnostic task is evaluated using two primary metrics: top-k recall (Hit@k, where k=1, 3, 10) and median rank (MR). Hit@k measures diagnostic accuracy by checking if the true disease is among the top-k predictions, while MR represents the median position of the correct diagnosis across all cases.\nMedication Recommendation The therapeutic task is assessed with four metrics: Jaccard coefficient (Jaccard), F1-score (F1), Drug-Drug Interaction rate (DDI), and average number of recommended medications (#MED). Jaccard measures the overlap between the recommended and ground truth medication sets, normalized by their union. F1 quantifies recommendation precision and recall, with higher values indicating better performance. DDI reflects the frequency of potential adverse interactions among recommended drugs, with lower values indicating safer prescriptions. #MED evaluates the consistency between the number of recommended medications and those prescribed by clinicians. Detailed formulas for all metrics are provided in Appendix A.4.\n5.2 Baselines\nThe baselines are divided into three categories: (1) domain-specific state-of-the-art models, (2) general and medical large language models (LLMs), and (3) open-source medical multi-agent frameworks.\nDomain-specific SOTA models For the differential diagnosis task, the domain-specific SOTA models include Phenomizer (K\u00f6hler et al., 2009, 2017), LIRICAL (Robinson et al., 2020), BASE_IC, Phen2Disease (Zhai et al., 2023), and Phenobrain (Mao et al., 2024). For the medication recommendation task, we leverage ten models: Logistic Regression (LR), LEAP (Zhang et al., 2017), RETAIN (Choi et al., 2016), G-Bert (Shang et al., 2019a), GAMENet (Shang et al., 2019b), SafeDrug (Yang et al., 2021b), COGNet (Wu et al., 2022), MICRON (Yang et al., 2021a), MoleRec (Yang et al., 2023), and RAREMed (Zhao et al., 2024). Notably, these models for medication recommendation require training on the dataset. We conduct 5-fold cross-validation based on the number of patients in MIMIC-IV-Ext-Rare and report the average results. In each fold, 20% of the data is used as the test set, while the remaining 80% is split into 80% training and 20% validation subsets. Appendix A.6.2 provides additional details on these baselines and their configurations.\nGeneral and Medical LLMs General LLMs evaluated are the latest version of GPT-40 and GPT-3.5-turbo-0125 (Achiam et al., 2023). The medical LLMs include OpenBioLLM (Ankit Pal, 2024) and UltraMedical (Zhang et al., 2024a), both fine-tuned on medical datasets using Llama-3 (8B and 70B). All models are evaluated in a zero-shot Chain-of-Thought (CoT) (Wei et al., 2022) setting with the temperature parameter set to 0.\nOpen-Source Medical Multi-Agents For open-source medical multi-agent frameworks, we select MedAgents (Tang et al., 2024) and MDAgents (Kim et al., 2024), both originally implemented using GPT-4 APIs. We have adapted them to operate on the local Llama-3.1 models.\n5.3 Main Results\nTable 3 presents the performance of all models on RareBench-Public for differential diagnosis and MIMIC-IV-Ext-Rare for medication recommendation. Detailed case studies are provided in Appendix A.8.\nDifferential Diagnosis RareAgents (Llama-3-70B) outperform all baselines across all eval-"}, {"title": "6 Analysis and Discussion", "content": "6.1 Ablation Study\nRareAgents consists of three key components: Multi-disciplinary Team (MDT) collaboration, dynamic long-term memory, and medical tools utilization. To assess the contribution of each module, we conduct ablation experiments by removing one component at a time. The results are presented in Table 4. These experiments, conducted on Llama-3.1 (8B and 70B), demonstrate that removing any single component leads to a performance decline to varying degrees. Among them, the performance drop is most significant when the memory module is removed, underscoring its critical role in dynamically retrieving information from similar patients or historical records. In the medication recommendation task on MIMIC-IV-Ext-Rare, the DDI rate increases significantly when removing the tools module, highlighting the importance of drug knowledge bases in ensuring medication safety.\n6.2 Ways to Define Agent Roles\nWe investigate two strategies for defining specialist roles: (1) autonomously generated by the LLM (Tang et al., 2024; Kim et al., 2024), and (2) selecting roles from a predefined specialist pool (SP), which is curated by medical professionals and includes 41 distinct medical specialties. Both strategies use the same number of specialist agents. Figures 3a and 3b illustrate that specialists chosen from the predefined pool consistently outperform those autonomously defined by the LLM, highlighting the value of leveraging expert-curated knowledge for role definition in complex medical tasks.\n6.3 Random vs. Dynamic of Memory Setting\nTo evaluate the efficacy of the dynamic retrieval mechanism in long-term memory, we compare it with a baseline approach that randomly selects an equivalent number of cases. The results are shown in Figures 3c and 3d. The dynamic memory mechanism thereby achieves significant performance improvements by retrieving only a small number of similar cases or previous visit records (e.g., just 5 cases). Conversely, random retrieval offers limited utility even when retrieving a vast number of cases.\n6.4 Effectiveness of Different Medical Tools\nWe further assess the individual contributions of tools in a single-agent setup, where the agent is restricted to using one tool at a time. The results, shown in Figures 3e and 3f, indicate that each tool independently enhances the agent's performance, with more effective tools contributing greater enhancements. Combining all tools delivers the best overall results. Moreover, incorporating the DDI-graph significantly reduces the DDI rate in treatment, promoting medication safety and efficacy."}, {"title": "7 Conclusion", "content": "This paper introduces RareAgents, a patient-centered framework that integrates multidisciplinary team collaboration, dynamic long-term memory, and medical tools to deliver personalized diagnosis and treatment for rare diseases. As a plug-and-play framework, RareAgents demonstrates superior performance on Llama-3.1 (8B and 70B), surpassing domain-specific state-of-the-art models, general and medical large language models, as well as medical multi-agent frameworks. Furthermore, we contribute MIMIC-IV-Ext-Rare, a curated dataset specifically for rare disease patients, providing a valuable resource for future research."}, {"title": "Limitations", "content": "In this study, we utilize pre-extracted symptoms and clinical codes from patients' original electronic health records (EHRs), focusing solely on textual data. While this approach provides valuable insights, it is important to acknowledge that the diagnosis and treatment of rare diseases often benefit from integrating multimodal data, such as medical imaging and genotypic information. RareAgents is designed as a flexible, plug-and-play framework with easy integration and adaptability. However, the current implementation does not include domain-specific fine-tuning of the underlying large language models (LLMs) for medical or rare disease contexts. In future work, we plan to address these limitations by incorporating more comprehensive patient data and performing targeted fine-tuning on state-of-the-art open-source LLMs, aiming to achieve more accurate diagnostic and therapeutic outcomes."}, {"title": "Ethical Considerations", "content": "Licenses In our research, we utilize two public datasets while adhering to the highest ethical standards. Both datasets are free from content that could compromise patient privacy or disclose personally identifiable information. The RareBench dataset (Chen et al., 2024) is released under the Creative Commons Attribution 4.0 International License (CC BY). MIMIC-IV (Johnson et al., 2023) is governed by the PhysioNet Credentialed Health Data License 1.5.0. The MIMIC-IV-Ext-Rare dataset, derived from MIMIC-IV, is strictly intended for research purposes and will be shared on PhysioNet under the same licensing terms as the original dataset.\nPotential Risks Although RareAgents has demonstrated promising performance in tasks related to differential diagnosis and medication recommendations for rare diseases, it is important to acknowledge the inherent limitations of LLMs, including potential biases and hallucinations in their outputs. Therefore, it is critical to emphasize that LLMs should currently be viewed only as supplementary tools. For specific diagnostic or treatment decisions, the guidance of qualified medical professionals must be fully followed."}, {"title": "A Appendix", "content": "A.1 RAREAGENTS Algorithm\nAlgorithm 1 provides a detailed overview of the RareAgents framework, in which the attending physician agent coordinates the entire patient-centered medical decision-making process by integrating three essential components: multidisciplinary team collaboration, dynamic long-term memory, and medical tools, ensuring the delivery of personalized diagnostic and treatment plans.\n$DR = SUMMARY \\left(\\bigcup_{r=0}^{R} \\bigcup_{s \\in MDT} O^{(r)}_s(R)\\right)$"}]}