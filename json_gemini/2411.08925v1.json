{"title": "Retrieval of sun-induced plant fluorescence in the O2-A absorption band from DESIS imagery", "authors": ["Jim Buffat", "Miguel Pato", "Kevin Alonso", "Stefan Auer", "Emiliano Carmona", "Stefan Maier", "Rupert M\u00fcller", "Patrick Rademske", "Uwe Rascher", "Hanno Scharr"], "abstract": "We provide the first method allowing to retrieve spaceborne SIF maps at 30 m ground resolution with a strong correlation (r2 = 0.6) to high-quality airborne estimates of sun-induced fluorescence (SIF). SIF estimates can provide explanatory information for many tasks related to agricultural management and physiological studies. While SIF products from airborne platforms are accurate and spatially well resolved, the data acquisition of such products remains science-oriented and limited to temporally constrained campaigns. Spaceborne SIF products on the other hand are available globally with often sufficient revisit times. How- ever, the spatial resolution of spaceborne SIF products is too small for agricultural applications. In view of ESA's upcoming FLEX mission we develop a method for SIF retrieval in the O2-A band of hyperspectral DESIS imagery to provide first insights for spaceborne SIF retrieval at high spatial resolution. To this end, we train a simulation-based self-supervised network with a novel perturbation based regularizer and test performance improvements under additional supervised regularization of atmospheric variable prediction. In a validation study with correspond- ing HyPlant derived SIF estimates at 740 nm we find that our model reaches a mean absolute difference of 0.78 mW nm-1 sr-1 m-2.", "sections": [{"title": "1 Introduction", "content": "The potential of sun-induced flurorescence (SIF) for agricultural management and phenotyping tasks was recognized early in the development of retrieval al- gorithms [41]. Since SIF is fuelled by a residual energy flux of photosynthetically active radiation (PAR) that is not consumed by processes related to the plant's photochemistry and thermal energy dissipation it provides a causal link between"}, {"title": "2 Data", "content": "The DLR Earth Sensing Imaging Spectrometer (DESIS) is a hyperspectral imag- ing sensor onboard the International Space Station (ISS) [38]. It measures at-sensor radiance in 235 bands in the spectral range from 400 nm to 1000 nm with a nominal spectral sampling interval (SSI) of 2.55 nm and a full width at half maximum (FWHM) of 3.55 nm. The spatial dimensions of DESIS acquisitions are fixed to 1024 \u00d7 1024 pixels with a nominal pixel width of 30 m. See [2] for a complete description of the DESIS sensor, data products and associated uncertainties. We make use of a polynomial emulator formulation [46,47] to re- construct DESIS radiance spectra around the O2-A absorption band. We found small domain shift errors with respect to smile-corrected L1B DESIS products (see Sec. 4.1). For training, we assembled a data set of 96 DESIS data takes (L1B and L2A in sensor geometry) matching either OCO-3 or HyPlant record- ings [6]. The georegistration of DESIS SIF estimates was conducted with the operationally provided DESIS L2A geolayers."}, {"title": "2.2 HyPlant campaigns 2020 and 2023", "content": "HyPlant is an airborne spectrometer system providing hyperspectral radiance measurements with an SSI of 0.11 nm and a nominal FWHM of 0.25 nm [55]. It is the airborne demonstrator version for FLEX [16] which is first spaceborne sensor specifically designed for SIF retrieval. As a result, HyPlant measurements have been used for SIF retrieval in yearly field campaigns since 2014 [18-21,52-54]. For this contribution, spatially overlapping acquisitions of DESIS and HyPlant could be recorded on 13/06/2023. Six HyPlant and two DESIS acquisitions were acquired within small time intervals of 1 - 25 minutes at around 14:30 CEST (cf. Fig. 1 and Tab. 1). Additionally, we found close spatial matches between six HyPlant and two DESIS acquisitions on 23/06/2020 in the same region. In this case the HyPlant acquisitions were recorded at least an hour earlier than the DESIS acquisitions (12:08 CEST). This unique disposition of spatially and temporally matching spaceborne and airborne radiance measurements allowed us to compile a comparative data set of georegistered HyPlant and DESIS SIF estimates. To this end, we processed the HyPlant at-sensor radiance with the Spectral Fitting Method (SFM) [11] to derive high-quality SIF estimates. The alignment of DESIS and HyPlant SIF products involved downscaling (isotropic Gaussian smoothing and spatial resampling) HyPlant SIF to DESIS resolution."}, {"title": "2.3 OCO-3 SIF estimates", "content": "OCO-3 is a spectrometer assembly originally designed for the retrieval of col- umn carbon dioxide [17]. As DESIS, OCO-3 is located onboard the ISS. The high SR of the radiance measurements around the O2-A absorption band of this sensor allows for SIF retrieval in this spectral region similarly to earlier space- borne sensors designed for the retrieval of atmospheric gas compositions [60]. Since both OCO-3 and DESIS are on the ISS, there exists a set of overlapping acquisitions with small time differences (< 10 minutes). We have identified a set of approximately 100 DESIS acquisitions that are partially covered by OCO-3 measurements, exhibit a low ratio of cloud cover and are flagged to be of accept- able quality. We make use of an OCO-3 SIF product of those acquisitions [15,44] as a complementary performance validation of our DESIS SIF estimates. These OCO-3 SIF estimates were compared to DESIS pixels in a 300 m radius around the center of individual soundings."}, {"title": "3 Architecture and Simulation-Based Loss", "content": "The SIF retrieval method for DESIS imagery presented in this work is based on the Spectral Fitting Method Neural Network (SFMNN) [5, 7]. This network implements in an encoder-decoder type architecture to fit parameters p; of a sim- ulation model of observational at-sensor radiance data. The simulation model pa- rameterizes the physical signal generation as a function of surface, atmospheric, sensor and geometrical variables. As a result, SIF retrieval is formulated as a feature optimization for optimal spectral decomposition and reconstruction. In order to constrain the solution space, the output dimensionality of the prediction of the simulation parameters is variable (Fig. 2). While surface parameters are al- lowed to vary in a pixelwise fashion, the atmospheric parameters are constrained to a single scalar value for pixels in a single input patch, i.e., within the same spatial neighbourhood. This is motivated by the large spatial auto-correlation distance of the atmospheric variables which is typically larger than the patches of 30 \u00d7 30 DESIS pixels (900 \u00d7 900 m) used during training. Equally, simulated sensor miscalibration only varies along the across-track dimension.\nWe implement an encoder, decoders dpx and dpatch for the surface and at- mospheric variables and a module q for the sensor variables. The module archi- tecture consists of stacked multi-layer perceptrons (MLPs) with residual links"}, {"title": "3.2 Loss formulation", "content": "We propose a simulation-based loss l = lres + lm + l\u2206f+ln + lc where lres eval- uates the reconstruction residuals of the model with respect to the observational input, lm and laf ensure that the network matches prior knowledge, IN ensures the physiological plausibility of the SIF estimates and le denotes a perturbation based regularization that enhances the decorrelation between predicted variables by means of a physically accurate augmentation. Self-supervised learning with radiance observations is addressed by adopting the methodology of [5, 7], where the reconstructed signal is compared to the observation similarly to other self- supervised methods such as masked auto-encoders [29,31]. A squared residual over the whole spectrum as well as a weighted residual boosting the loss in spec- tral regions with high average fluorescence contributions punish the network for not reproducing the at-sensor observations. This is implemented by\n$l_{ees} (L,L) = ((L-1)^2)_{\u03bb, \u03b1}+ \\frac{\\gamma_f}{W_{out}^2} \\sum_{\u03bb \\epsilon W_{out}} w_\u03bb (L(\u03bb)- L(\u03bb))^2 ,$\nwhere (...), denotes the batchwise mean over the spatial and spectral dimen- sion, and where L and \u00ce denote the observations and emulated predictions in the spectral range Wout. The weighting w\u03bb is resampled from the weights originally proposed in [5, 7] for the specific sensor characterization of the DESIS sensor. Furthermore, we also adopt the selective gradient backpropagation of the second term which is set to only affect the fluorescence prediction f740.\nThe inclusion of prior information on atmospheric variables and the SIF emission are implemented as regularization terms\n$l_m = \\sum_{KEK}Y_{pk} (P_k - P_k)^2$ and $l_{\u2206f} = y_f (f - finit)^2$\nwhere finit denotes the prediction of the supervised SIF predictor and where K = {H2O, AOT550}. We denote by H2O the water vapour density and by AOT550 the aerosol optical thickness at 550 nm, which are derived operationally and distributed with DESIS L2A products. Thus, lm introduces a supervised regression training of ancillary data from DESIS products as a secondary task. As an alternative strategy, we test in Sec. 4.3 a set-up where the ancillary data is passed directly to the input and the emulator for training and prediction. Ac- cordingly, our model does not provide predictions of the atmospheric parameters (H2O, AOT550) in this latter variant.\nThe SIF estimate finit, which we gain from a predictor trained on simulated DESIS data, is included in the loss parallelly to lm. This effectively controls the range of deviation that the residual module Af is allowed to introduce. Additionally, the fluorescence estimate of the residual module is controlled by the constraint\n$l_n = y_v f \u03b4 (NDVI(L) \\leq T)$\nto ensure vanishing SIF predictions in pixels without vegetation, i.e., with small NDVI [5, 7]. We fix \u03c4 = 0.15 in all experiments."}, {"title": "4 Results", "content": ""}, {"title": "4.1 Reconstruction Performance & Validation", "content": "The network must reconstruct observed spectra with high accuracy. The model trained on all DESIS acquisitions with matching HyPlant or OCO-3 SIF products (Tab. 1) with the proposed loss (with \u03b3f = 1, Af = 5, H2O = 1 and YN = 10 fixed during preliminary experimental runs and YAOT = 100 and ye = 5 \u00d7 103 being the best configuration) reaches a mean relative reconstruction error of 1.6 % (Fig. 3 (a)). The spectral variation of the reconstruction error is small (Fig. 3 (b)) which evidences the model's capacity to plausible signal generation across the spectral domain. We equally observe that the reconstruction error is reduced under inclusion of f740 compared to reconstructions where we fixed f740 = 0.\nIn Fig. 4 we show an exemplary result. The prediction of f740 exhibits a re- duced noise level compared to finit and correlates with the distribution of agricul- tural fields. In order to assess the performance quantitatively we compare DESIS SIF estimates to matching HyPlant and OCO-3 SIF estimates (Tab. 1). Since existing SIF retrieval methods are not adapted to DESIS data (cf. Sec. 3) we rely on these estimates as ground truth. The same configuration as above yields a mean absolute difference (Af740)HyP23 = 0.78 mW nm-1 sr-1 m-2 (smaller\nis better) and a coefficient of determination rHyP23 = 0.6 (larger is better) in the HyPlant (2023) data set. The DESIS estimates perform worse in a compar- ison with HyPlant (2020) data ((Af740)HyP20 = 0.86 mWnm-1sr-1 m-2 and\n\"HyP20 = -0.01) due to a large overestimation of our approach. This is expected since the data was recorded closer to solar noon when the diurnal course of SIF peaks [9,66]. Finally, we find \u3008Af740)OCO3 = 0.58 mW nm\u00af\u00b9 sr-1 m-2 and roco3 = 0.2 compared to OCO-3 data (cf. Fig. 5).\nWe evaluated the consistency regularization and the inclusion of ancillary data on the SIF prediction. We only validated with respect to the HyPlant (2023) and OCO-3 data sets as the acquisition time difference of HyPlant (2020) would"}, {"title": "4.2 Consistency Regularization Weighting Ye", "content": "In order to evaluate the impact of the consistency regularization le on DESIS SIF, we perform a grid search over Ye (Fig. 6 (a) and (b)) without including lm in the training loss. In the OCO-3 data set the inclusion of le at all tested weights Ye outperforms the case Ye = 0 in terms of (\u2206f740) (smaller is better) and generally also in terms of R\u00b2 (larger is better) (Figs. 6 (a) and (b)). With HyPlant (2023) we find only a localized performance optimum at c ~ 5 \u00d7 103 in terms of (Af740) and r\u00b2. We show in Fig. 6 (c) that we find particularly strong overestimation at p780 > 0.5 Improved performance under le in HyPlant, however, can be seen in terms of MAE, and (R2) A (Fig. 6 (d)). Specifically, we find (R2) A > 0 only if the consistency regularization is applied."}, {"title": "4.3 Inclusion of Ancillary Data", "content": "To assess the impact of including ancillary data in the SIF retrieval, we con- duct a grid search over YAOT (while fixing\nH2O = 1). First, we establish the performance difference between using the proposed regularization scheme in Eq. (3) and providing the data directly to the input and the emulator. We denote this configuration by YAOT = 0 in Fig. 7. We find decreased r\u00b2 and"}, {"title": "5 Discussion", "content": ""}, {"title": "5.1 Decorrelating Impact of Consistency Regularization", "content": "The introduction of le proved beneficial to the overall SIF retrieval performance. In a study of the performance of (R2) A we isolated the model performance independent of the empirical correlation between SIF and p780. We found im- proved performance in terms of (R2) A under the inclusion of le (Fig. 6 (c) and (d)) indicating that the consistency regularization le has the intended effect of decorrelating the target signal from confounding factors. The weighting Ye has to be chosen carefully, however. Increased MAE at large Ye may have been due (i) to imperfect sample generation in le introducing a domain gap between the observations and the augmentations and (ii) a trade-off between reconstruction accuracy and minimization of le."}, {"title": "5.2 Inclusion of Ancillary Data Sources", "content": "In order to reduce the retrieval problem's ill-posedness we have proposed the use of a regularization that implements the supervised learning of atmospheric emu- lator prediction variables with ancillary data sources as labels. The regularization"}, {"title": "6 Conclusion", "content": "In this contribution we have presented a deep learning architecture for SIF re- trieval from DESIS imagery. This work is the first to use hyperspectral DESIS data for SIF retrieval. A unique data set of spatially and temporally closely matching HyPlant SIF estimates has allowed us to perform a detailed val- idation study of the methodology proposed in this work. The good perfor- mance of our model with respect to these high-quality SIF estimates (\u3008\u2206f740) =\n0.78 mW nm-1 sr-1 m\u22122, r2 = 0.6) supports our finding that it is possible to derive SIF from DESIS products. Further comparison with a data set of glob- ally distributed OCO-3 SIF estimates could establish the sensitivity of our SIF product in a wider variety of observational and ground conditions and may form the basis for an operational SIF product from DESIS data.\nTo achieve the good SIF prediction performance, we have extended a self- supervised simulation-based deep learning approach [5, 7]. Several changes to the loss formulation were necessary to address the lower SR and SNR of DESIS imagery. Most importantly, we have (i) introduced a perturbation based augmen- tation to improve signal decorrelation and (ii) tested the inclusion of ancillary data by formulating a secondary supervised downstream task. We could show that both the perturbation based augmentation and the supervised downstream task formulations improved SIF retrieval performance when comparing both with HyPlant and OCO-3 SIF products. We furthermore could observe improved decorrelation of DESIS SIF from p780 when making use of the augmentation during training. Since this perturbation based regularization strategy is not re- stricted to remote sensing data it may be implemented in other simulation-based deep learning applications to decrease the influence of confounding factors."}]}