{"title": "Tailoring Graph Neural Network-based Flow-guided Localization to Individual Bloodstreams and Activities", "authors": ["Pablo Galv\u00e1n", "Sergi Abadal", "Filip Lemic", "Gerard Calvo", "Xavier Costa P\u00e9rez"], "abstract": "Flow-guided localization using in-body nanodevices in the bloodstream is expected to be beneficial for early disease detection, continuous monitoring of biological conditions, and targeted treatment. The nanodevices face size and power constraints that produce erroneous raw data for localization purposes. On-body anchors receive this data, and use it to derive the locations of diagnostic events of interest. Different Machine Learning (ML) approaches have been recently proposed for this task, yet they are currently restricted to a reference bloodstream of a resting patient. As such, they are unable to deal with the physical diversity of patients' bloodstreams and cannot provide continuous monitoring due to changes in individual patient's activities. Toward addressing these issues for the current State-of-the-Art (SotA) flow-guided localization approach based on Graph Neural Networks (GNNs), we propose a pipeline for GNN adaptation based on individual physiological indicators including height, weight, and heart rate. Our results indicate that the proposed adaptions are beneficial in reconciling the individual differences between bloodstreams and activities.", "sections": [{"title": "1 INTRODUCTION", "content": "The introduction of in-body nanodevices to the field of medicine has a potential to revolutionize medical applications by enabling early diagnostics, continuous monitoring, and precise interventions within the human bloodstreams [1-3]. The nanodevices are envisioned to be passively flowing in the bloodstream, periodically sensing for biological indicators of interest, and communicating their findings to on-body anchors for further processing. Assigning location indicators to the sensed events, which is the main proposition of flow-guided localization, is expected to further enhance the diagnostic, monitoring, and treatment possibilities [4].\nFlow-guided nanoscale localization is a technique for locating an event of medical interest using nanodevices within the bloodstream, without requiring the nanodevices to determine their own location [5], as indicated in Figure 1. In contrast, as a minimum requirement the nanodevices are envisioned to communicate their event detection indicators to an on-body anchor positioned in the proximity of the heart, as the heart represents the only bodily region in which the nanodevices pass in each of their iterations through the bloodstream. The communication is usually assumed to be done using high-frequency pulse-based wireless communication in the Terahertz (THz) frequency band to meet the stringent constraints on the physical size of the nanodevices [6, 7].\nIn-body nanodevices face operational constraints due to their physical size and energy limitations, as well as due to their erratic movement in the bloodstream. Thus, the communication with the anchor is generally erroneous [8], while an event might not be detected by a nanodevice, despite the fact that the nanodevice passed through the cardiovascular path containing the event. For this reason, flow-guided localization is a challenging task to achieve with traditional algorithms, resulting in several proposals that utilize Machine Learning (ML) for this purpose [8-10].\nWhile these solutions have yielded promising performance in a reference bloodstream of a resting patient, none of them considered tailoring the approaches to individual bloodstreams and activities. Such considerations are necessary for seamless administration of flow-guided localization systems across patients, as well as for enabling continuous (i.e., activity agnostic) localization within the bloodstreams. Understanding how individual factors such as weight, height, and heart rate affect the localization accuracy is crucial for optimizing the performance of such systems.\nToward addressing these concerns, we explore how variations in patients' physiological indicators affect the performance of a contemporary flow-guided nanoscale localization approach based on Graph Neural Networks (GNNs) [8]. The reference GNN model is extended so that it utilizes biological indicators including weight, height, and heart rate as attributes for the GNN adaptation. Nine individual profiles have been defined and employed to evaluate the impact of profile adaptations on localization accuracy. Our results indicate that the proposed extensions to the State-of-the-Art (SotA) GNN-based flow-guided localization approach can enhance the adaptability of the model, suggesting that its operability can be extended beyond the reference bloodstream of a resting patient toward individual bloodstreams and activities."}, {"title": "2 RELATED WORKS", "content": "This work is built on top of the study conducted by Calvo et al. [8], which leverages GNNs for flow-guided localization while accounting for communication and energy limitations at the nanodevice level. Specifically, our research includes the following contributions:\n\u2022 Addition of a master node to the graph structure, holding information about the body shape and heartbeat rate.\n\u2022 Improvement of edge weights in the input graph design by including the probability of a region being visited by the nanodevices in a single iteration through the bloodstream.\n\u2022 Performance improvement on most body types and activity levels in comparison to the original GNN design from [8].\nThe promise of in-body localization has been demonstrated in [11], where the authors propose a backscatter-based in-body communication and localization system. The system is experimentally shown to yield centimeter-level accuracy in human phantoms and animal tissue. The initial promise encouraged further research on downscaling the physical size of in-body devices to the nanoscale, paving the way toward the administration of in-body nanodevices into patients' bloodstreams. Their physical sizes have to be comparable to or smaller than those of the red blood cells, or around 5 microns. Localization of such devices in the bloodstream is coined under the term flow-guided nanoscale localization.\nSeveral approaches have been proposed for flow-guided localization of events of diagnostic interest. The proposal in [4] envisions using Software-Defined Metamaterials (SDMs) as on-body anchors and multi-hopping-based wireless communication for localizing in-body nanodevices. While this approach promises high localization accuracy, it requires a large number of nanodevices and their complex functionalities such as the support for multi-hopping communication. This is currently infeasible in practice, primarily due to the operational constraints at the nanodevice level.\nMoreover, the approach proposed in [10] leverages conceptual nanoscale Inertial Measurement Units (IMUs) to measure nanodevices' acceleration and rotation. This data is sent to an anchor near the heart and used to determine the location of the nanodevices over time. After communicating the data to the anchor, the IMUS are reset to prevent error accumulation. While this approach shows encouraging results, using IMUs adds complexity and introduces challenges to nanodevice fabrication, integration, and data storage.\nThe approach in [9] envisions the nanodevices to provide their travel concentration level to the anchor near the heart. This data is then clustered using a k-means algorithm, where each group corresponds to a different closed loop in the circulatory system. These clusters are fed to a decision tree that classifies the data into different bodily regions, providing region-level location estimation. This is followed by utilizing an ML model to determine the transition probabilities in a Markov chain.\nIn addition, the approach in [8] leverages GNNs to localize diagnostic events in the cardiovascular system. The circulation times from different nanodevices are reported to an anchor, which aggregates them to create features for the GNNs model from which the event location is predicted. In particular, Heterogeneous Graph Transformers (HGTs) are used, allowing for multiple types of nodes, i.e., anchor and region nodes. Each anchor is connected to all regions, and each region is connected to its neighbor regions based on their structure in the human bloodstream. The authors have demonstrated that the GNN approach yields higher localization accuracy and offers an extended coverage compared to the alternative approaches and is, therefore, selected as a baseline for this study.\nFinally, [5] provides an analytical model of raw data for flow-guided localization. The model's outputted data is shown to be highly comparable to the corresponding data generated by a flow-guided localization approach. The approach from [5] is envisioned to be used for training flow-guided localization approaches in a non-invasive way, which in turn paves the way toward eventually deploying flow-guided localization in patients' bloodstreams. As such, it is envisioned to be utilized to train approaches from [8, 9].\nHowever, the related works have yet to consider the physiological differences between individual bloodstreams or the adaptability of approaches to different patient activities. Therefore, these approaches might be only suitable for a reference bloodstream and a resting patient, limiting flow-guided localization's seamlessness and deployability potential."}, {"title": "3 CONSIDERED GNN MODEL", "content": ""}, {"title": "3.1 GNN-enabled Flow-guided Localization", "content": "As a reference model, we use the SotA GNN model from [8], which acts as a pattern-matching function to locate the sensed events within the cardiovascular system given the set of observed signal features measured by the anchor. Since the cardiovascular system is a structured and highly connected environment, it can be naturally represented as a graph (as shown in Figure 2), which is why this approach holds significant potential for individualized flow-guided localization. In the graphs used in the reference study, each node corresponds to a body region of an arbitrary granularity, and the edges define the constraints for the movement of the nanodevices by linking adjacent regions in the cardiovascular system.\nThe GNN model utilizes region and anchor nodes. Region nodes hold the information of said regions, such as their type (e.g., organs, limbs or head, veins, arteries), length, and blood speed. Anchor nodes carry the information on the circulation times of the positive bits received from the nanodevices for the localization process. Because the raw data can be of varying length (the anchor receives an undefined number of positive event bits), the used GNN expects the circulation time for positive event bits to be modeled as a Gaussian Mixture Model (GMM) with two Gaussian clusters. With this approach, the distribution parameters derived from the GMM serve as features for the anchors alongside the average number of positive bits received, thus providing a fixed-length feature set for each anchor."}, {"title": "3.2 GNN Architecture", "content": "The original GNN architecture is depicted in Figure 3 and leverages the inherent structure of the graph representing the bloodstream. It is based on a HGT, providing versatility to handle the system's multiple types of nodes, i.e., region nodes and anchors. The GNN starts by generating unique embeddings for each node type (applying a ReLU activation function to the initial node features, transforming the information into a latent space of higher dimensionality). Next, these embeddings are fed to an initial set of graph layers, which might be Graph Attention Networks (GATs) [?] or Graph Convolutional Networks (GCNs) [12] depending on the hyperparameter configuration, and it is followed by a suite of HGT layers and a concluding convolution layer.\nThe initial convolution layers introduce non-linearity and adaptability into the model, aggregating information from each region node's neighbors depending on the weight between the nodes. In the case of GATs, this weight is calculated as an attention score, a measure learned during training that assigns different relative importance to each node during the aggregation of features. Following the initial layers, the HGT layers deal with the complex interactions between different types of nodes. These layers incorporate the information from the anchors to region nodes, enabling the model to capture the dynamic propagation of nanodevices through different body regions. By dynamically adjusting the importance of different nodes based on the information they carry, the HGT layers are able to provide a nuanced representation that encapsulates the spatial and temporal aspects of the nanodevices' propagation.\nThe model links the anchor node to all region nodes, eliminating the need for multiple stacked message-passing layers to ensure that information from the anchor reaches all region nodes. After the HGT layers have processed the information, a final set of convolution layers is applied to refine the region nodes' representations. The architecture concludes with a final linear layer applied to the refined representations of the region nodes. The output then undergoes a sigmoid activation function to produce the final predictions, indicating the likelihood of an event occurring in each region. This HGT model provides initial probabilities for the occurrence of the detected event across all regions in the cardiovascular system."}, {"title": "4 GNN-BASED LOCALIZATION TAILORED TO INDIVIDUAL PROFILES", "content": ""}, {"title": "4.1 Extended Graph Designs", "content": "The reference graph design was extended in several ways to improve the accuracy of the GNN on individual profiles. This included providing the GNN with information associated with each profile and making modifications to improve the structure itself. Firstly, every extended design includes a master node connected to all other nodes (both region and anchor nodes). The basic version of this node uses the three attributes of each profile as features, i.e., the weight, the height, and the heart rate affecting the speeds of blood. In addition to these features, the master node can hold the inverted value of these three attributes. These inverted values might benefit the model since increasing the weight and height might cause the nanodevices' iterations through the cardiovascular systems to require more time (since the vessels might be longer). Therefore, normalizing the circulation time by providing the GNN with the inverse value of the features might help.\nBesides the master node, a graph design with different edge types was tested. This new design connects the two heart region nodes (left and right heart) to all the other region nodes except for themselves. The weight of each of these new edges is the probability that the nanodevices visit the region adjacent to the heart node in one iteration. These probabilities were estimated through a Monte-Carlo search, using the evaluation setup outlined in Section 5. This design was considered as it allows the model to know which regions are more likely to be visited in an iteration, which allows it to infer more information regarding the path followed by the nanodevices. As indicated in Figure 4, three combinations of these designs were tested and compared: a) graph with inverted master features only, b) graph with probability edges only and c) graph with probability edges and inverted master features."}, {"title": "4.2 Raw Data Transformation", "content": "For evaluating the GNN performance in different physiological settings, nine profiles were defined, as shown in Figure 5. The intuition behind defining the profiles lies in the fact that they feature different combinations of weight, height, and activity levels, representing the diverse situations the model may encounter in real-life scenarios. On the one hand, some of these profiles test the effect of modifying features individually, i.e., \u201ctall\u201d and \"short\" for the height, \"heavy\" and \"light\" for the weight, and \u201cactive\u201d and \u201cinactive\" for the blood speed scale. On the other, the \"big\" and \"small\" profiles allow for assessing the model's performance when several attributes are modified simultaneously.\nAs the y-axis is assumed to represent the \"vertical axis\" of the nanodevice in the bloodstream, a modification in their height can be easily approximated by simply multiplying the Y coordinate by a height scaling ratio. When modifying the subject's weight, accurately estimating its impact on flow-guided localization is significantly more challenging, given that an actual increase in a person's weight does not always cause the same body regions to increase in size. Regardless, scaling the subject's weight in these experiments aims to determine whether a non-vertical change in the subject's vessels' positions affects the localization's performance. Therefore, the weight scaling of the simulation's subject for our experiments is considerably simplified, and it merely consists of a constant scaling of the X and Z coordinates, similar to the height modification. For this, we approximate the body's shape to a cylinder assumed to have uniform density, such that an increase of the weight is directly proportional to an increase in the cylinder's volume. Since the weight and height scaling ratios are known, the radius scaling proportion $k$ can be obtained based on the cylinder volume equation, resulting in the square root of the product of the weight ratio and the inverse height ratio.\nChanging the coordinates alone would not impact the performance of the studied model, since the coordinates are not used as features themselves. Instead, the circulation time is used to infer the location of the detected events. In order to estimate how the circulation time varies based on the modified blood vessels, the time differences between circulation moments are scaled accordingly, and these are then added cumulatively for each simulation. To scale these, two cases are assumed for each pair of reported circulation times: i) both times are reported in the same region, and ii) each time is reported in a different region.\nThe first case is significantly simpler, as it merely requires the time difference to be scaled based on the length ratio of the current vessel with the new coordinates and the original coordinates (assuming a linear variation). The second case, however, is more complex, since the vessel length ratio of each region will be different, and the exact original speed of the nanodevices in each region is unknown (only the distance between both coordinates and the total time difference are known). For this reason, the speed is estimated to be constant during the region transition, and the speed is calculated as the original traversed distance divided by the original time difference, which is then used to compute the new time difference using the scaled traversed distance. While this is not completely accurate (as the flow speed is different depending on the region type), most of the reported circulation times fall within the first case, and this is simply an approximate estimation of a real case, so we consider this as a negligible inaccuracy.\nAs a result, the final circulation time difference is the scaled time difference divided by the blood speed scale (representing the activity level). Using these modifications, the circulation times of each simulation are processed by the pipeline, which uses them to extract the anchor features explained in Section 3.1. These, along with the weight, the height and the activity level, are used to build the input graph, which is fed to the GNN and outputs a vector of probabilities of an event being located in each region, with the highest probability representing the estimated one."}, {"title": "5 EVALUATION METHODOLOGY AND RESULTS", "content": ""}, {"title": "5.1 Evaluation Methodology", "content": "In our evaluation, we utilize a framework for objective performance evaluation of THz-based flow-guided localization from [14]. The framework combines two simulators, i.e., BloodVoyagerS (BVS) [15] and TeraSim [16]. BVS offers a bloodstream simulation environment for flow-guided nanodevices. Terasim is an ns3-based platform for modeling THz communication networks, both an macro and nanoscale. The combined framework offers the possibility of simulating the movement of flow-guided nanodevices across the bloodstream, where they are envisioned to detect events of diagnostic interest and communicate the sensing indicators to the on-body anchors. This framework uses a set of input parameters defining an evaluation scenario, as shown in Table 1. The inputs are envisioned to be passed to the framework for generating raw data for streamlined evaluation of a given flow-guided localization approach for the assumed scenario, resulting in a performance benchmark.\nAlong with these parameters, the framework is given information about the number and locations of anchors (nb., one anchor in the proximity of the heart is assumed in this work), which are assumed to be static entities and feature sufficient energy for continuous operation. The nanodevices are assumed to be mobile energy-harvesting entities within the bloodstream. Then, BVS is invoked for generating the mobility profiles of the nanodevices in the bloodstream within a simulation time-frame. At each BVS-originating location of a nanodevice, the nanodevice is assumed to carry out a sensing/actuation task. This is followed by attempting at communicating the data (i.e., a binary event detection indicator, iteration time since last communication with the anchor, and the nanodevice identifier) to the anchor at THz frequencies, which is then used by the GNN. Table 1 summarizes the main simulation parameters, with the rest using the same values as the original GNN model [8] for providing meaningful comparison with the baseline.\nOur evaluation is carried out by hard-coding the location of an event of diagnostic interest in each of the 25 cardiovascular regions of the bloodstream representing organs, limbs, and head. We obtained the simulated raw data for two event locations per region. This procedure was repeated for the nine defined profiles, resulting in 450 simulated raw data profiles to be fed into the both of the considered GNN solutions for benchmarking purposes.\nFor evaluating the performance of the considered flow-guided localization, [14] proposed a set of standardized performance metrics. These metrics are the region accuracy, the point accuracy, the reliability, and the nanodevice energy consumption. Since [8] has demonstrated the rather high reliability of the proposed GNN model, as well as due to the fact that the nanodevices' energy consumption is related to their energy harvesting capabilities, which are unchanged across approaches, we focus on the region and point accuracies as the performance metrics relevant for this study.\nRegion accuracy represents the fraction of correctly estimated regions over the total number of estimations, while the point accuracy corresponds to the amplitude of localization errors obtained as the Euclidean distance between the predicted and ground truth location coordinates. The point accuracy distributions are captured across the considered 25 region types, which are depicted using regular box-plots. This metric allows for the performance analysis based on the prediction's spatial location instead of just the strict region, so predicting a neighboring region to the ground truth region yields better point accuracy than predicting a distant region."}, {"title": "5.2 Hyperparameter Tuning", "content": "We trained the considered models using grid search with the hyperparameter configuration search space shown in Table 2. These grid search runs were executed separately for each of the three extended graph designs for finding their optimal configurations. The graph design with the best validation accuracy after the hyperparameter tuning was then used in the evaluation on each of the nine profiles under study and compared to the baseline.\nFigure 6 depicts a snapshot of the hyperparameter tuning process for the best performing extended GNN design (i.e., GNN design c, featuring both the probability edges and inverted master features), as well as for the baseline. The results are depicted for the best four runs only for visibility purposes. As visible, the three designs yielded a best validation accuracy of 30%, 32.22% and 36.67%, respectively, showing that the best option is the extended design c, with the inclusion of both probability edges and inverted features. This is to be expected, as both of these changes were expected to provide useful additional information to the model. In addition, the baseline model was trained on the original profile and using original graph design without a master node, probability edges, or inverted features, achieving the validation accuracy of 21.88%."}, {"title": "5.3 Evaluation Results", "content": "Figure 7 depicts the point and region accuracies for each profile achieved by the considered baseline and best performing extended GNN model. The region accuracy of the baseline is shown to decrease for the small and active profiles compared to the original, while for the other profiles it remains around 20%. In contrast, the proposed model displays a significantly higher region accuracy for all except the heavy profile with equal accuracies and the inactive profile, where the proposed model performs slightly worse than the baseline. This is due to the time scaling dramatically modifying the circulation times, significantly more than in the other profiles, which makes them hardly distinguishable by both models. Similarly, the low region accuracy in the heavy profile is contributed to the significant cylindric distortion along causing an unequal scaling of iteration times across regions. This is demonstrated in Figures 8 and 9, respectively depicting the spatial distributions of localization errors and confusion matrices of the selected profiles, both featuring significant performance distortion in the heavy profile.\nMoreover, the point accuracy distributions across models demonstrate that in cases where the proposed model does not surpass the baseline in terms of region accuracy, its point accuracy is either the same or higher than the one achieved by the baseline. This suggests that the incorrectly predicted regions by our model are not far from the ground truth spatially. Similarly, the small difference in the distribution of localization errors is observed across models in cases the proposed model substantially outperforms the baseline. This can be attributed to the fact that the baseline, when distorted, predicts regions neighboring to the correct one."}, {"title": "6 CONCLUSION", "content": "Our investigation into individualized factors affecting flow-guided nanoscale localization reveals that individual differences in the bloodstream sizes or patients' activities can substantially impact localization accuracy. Toward addressing this issue, we provide a pipeline for adapting the raw data for flow-guided localization based on physiological attributes. The enhancements introduced in this work are beneficial in terms of the Graph Neural Network (GNN) model's adaptability, given that they are almost generally yield better performance than the reference model without adaptations. In more general terms, these findings underscore the importance of tailoring localization strategies to individual bloodstreams, considering variations in height, weight, and heart rate. As flow-guided nanoscale localization advances, understanding and accommodating individual differences will be pivotal for realizing its full potential in medical applications.\nWhile this study focused on the performance of our framework on the nine discrete patients' profiles, the proposed graph adaptations of the original GNN are expected to support continuous adaptation of the physiological parameters by taking data from time windows when these values remain approximately constant. The performance of the GNN model and proposed graph adaptations when continuously changing the physiological parameters such as weight and activity levels will be considered as a part of our future efforts. In addition, future work will focus on creating methods for further mitigation of temporally variable philological parameters by either improving the preprocessing of the input data or by enhancing the GNN with new features, parameters, or architecture elements. Here we will primarily focus on the activity levels as the most dynamic of the considered physiological parameters. Since we only use the raw data received by a single anchor in the proximity of the heart, our model is by-design unable to distinguish between left and right counterparts on the body (e.g., limbs). Using multiple anchors is expected to further refine the proposed model accuracy, but potentially also its adaptability, which might render it useful for currently challenging body profiles."}]}