{"title": "SurgBox: Agent-Driven Operating Room Sandbox with Surgery Copilot", "authors": ["Jinlin Wu", "Xusheng Liang", "Xuexue Bai", "Zhen Chen"], "abstract": "Surgical interventions, particularly in neurology, represent complex and high-stakes scenarios that impose substantial cognitive burdens on surgical teams. Although deliberate education and practice can enhance cognitive capabilities, surgical training opportunities remain limited due to patient safety concerns. To address these cognitive challenges in surgical training and operation, we propose SurgBox, an agent-driven sandbox framework to systematically enhance the cognitive capabilities of surgeons in immersive surgical simulations. Specifically, our SurgBox leverages large language models (LLMs) with tailored Retrieval-Augmented Generation (RAG) to authentically replicate various surgical roles, enabling realistic training environments for deliberate practice. In particular, we devise Surgery Copilot, an AI-driven assistant to actively coordinate the surgical information stream and support clinical decision-making, thereby diminishing the cognitive workload of surgical teams during surgery. By incorporating a novel Long-Short Memory mechanism, our Surgery Copilot can effectively balance immediate procedural assistance with comprehensive surgical knowledge. Extensive experiments using real neurosurgical procedure records validate our SurgBox framework in both enhancing surgical cognitive capabilities and supporting clinical decision-making. By providing an integrated solution for training and operational support to address cognitive challenges, our SurgBox advances surgical education and practice, potentially transforming surgical outcomes and healthcare quality.", "sections": [{"title": "I. INTRODUCTION", "content": "Surgical interventions represent some of the most complex and high-stakes scenarios in medicine, with outcomes directly impacting treatment efficacy and life quality [1]. In particular, neurosurgical interventions involve intricate workflows and critical decision-making throughout complicated surgical stages [2]\u2013[5]. This procedural complexity creates substantial cognitive burdens for surgical teams, who must simultaneously process multiple information streams while maintaining precision in their actions. Studies have shown that such cognitive demands significantly increase the risk of surgical errors [6], [7], potentially leading to devastating patient outcomes [8].\nAlthough deliberate education practice has been proven effective in enhancing cognitive capabilities [9], safety and ethical concerns severely limit surgeons' opportunities to practice in actual surgical procedures [10], especially for high-risk or rare conditions. Therefore, leveraging advanced AI techniques to coordinate surgical information stream and support clinical decision-making shows great promise in addressing cognitive challenges from both training and operational perspectives.\nRecent AI advances have sparked a growing interest in developing safe, controllable virtual environments through generative agents to simulate real-world scenarios. Smallville [11] introduces architectural and interaction patterns for enabling believable simulations of human behavior, and MetaGPT [12] provides solutions for collaborative software engineering by imitating efficient human workflows. In the healthcare domain, pioneer studies (e.g., AI Hospital [13] and MedAgents [14]) have explored using large language models (LLMs) agents to mimic clinical roles, interactions and decision-making. Concurrently, Agent Hospital [15] aims to build AI systems that involve interactive pipelines across various medical scenarios.\nInspired by these LLM-based simulation methods, we introduce SurgBox, an innovative agent-driven framework designed to systematically enhance cognitive capabilities of surgeons through immersive surgical simulations. Our framework employs LLM agents enhanced with specialized Retrieval-Augmented Generation (RAG) banks to authentically replicate various surgical roles, including chief surgeon, assistant surgeon, nurses, and anesthetists. Through deliberate practice in these high-fidelity simulations, surgeons can develop automatic responses to various surgical scenarios, improving their ability to process complex information streams and make critical decisions under pressure. This repeated exposure to diverse surgical situations in a risk-free environment helps build robust cognitive schemas, enabling more efficient information processing and decision-making during actual procedures.\nTo amplify the training benefits of SurgBox and further reduce cognitive load during live surgeries, we devise the Surgery Copilot, the first AI-driven assistant designed to actively support surgical decision-making and workflow management in real time. This specialized agent helps surgeons maintain situational awareness by effectively coordinating and filtering information streams, providing contextually relevant guidance, and proactively identifying potential risks before they escalate into complications. By implementing a Long-"}, {"title": "II. RELATED WORK", "content": "Recent studies [16] indicate that LLMs have been extensively used to simulate real-world dynamics and demonstrated their capability to interact in a competitive, dynamic real-world simulation, especially in fields such as epidemiology, sociology, and economics. LLM-based agents play a central role to enhance the predictive and analytical capabilities of models by simulating human decision-making processes [17]."}, {"title": "A. LLM-Based Multi-Agent Framework", "content": "Many current agent-related works tend to simulate human-like understanding of human activities to generate human-like instructions [18] and facilitate complex interactions and decision-making in a wide range of situations [19], [20]. For instance, game simulation [21] verifies the ability of large models to participate in complex communication games. Software companies [22] employ Standard Operating Procedures (SOPs) to coordinate multi-agent systems based on LLMs, thus implementing metaprogramming technologies. Social simulation [23] represents a pioneering step in the field of social network simulation utilizing LLM-based agents.\nWhile these applications have shown the potential of LLMs in simulating real-world dynamics, there are still some areas that have not been fully explored. In the domain of medical and health simulation, existing research usually focuses on simulating treatment tasks rather than simulating the complete closed loop of treating patients' diseases [24]. This study aims to address this research gap by leveraging LLMs to enhance medical decision-making processes and improve the accuracy and efficacy of diagnosis and treatment protocols."}, {"title": "B. Role-Play Agents", "content": "Currently, open-source general-purpose foundational models have demonstrated impressive capabilities, and more and more work has begun to study models for role-playing. These models can adapt to complex environments [25], recall key information from long-term memory, and demonstrate continuous learning capabilities. [26] introduces a language agent role-playing framework that employs a modular approach for memory processing, decision-making, and interactive learning within the environment. [27] enhances the agent's capabilities through fine-tuning on a role-specific corpus. [28] presents a systematic evaluation framework for role-playing agents, spanning from individual to group-level assessments. [29] augments the agent's role-playing capabilities by integrating retrieval enhancement techniques.\nIn the medical domain, AI Hospital [13] investigates the application of LLMs as clinical diagnosticians for real-time interactive consultation scenarios. However, ensuring robust diagnostic capabilities remains a significant challenge. The MedAgent-Zero [15] approach employs a simulation system based on a knowledge base and LLM to model disease occurrence and progression, enabling doctor agents to accumulate experience from both successful and failed cases. Nevertheless, its efficacy in complex medical scenarios remains limited.\nOur research endeavors to address the gap in the application of intelligent agents within the domain of clinical surgery. We have developed an advanced clinical intelligent surgery simulation system capable of managing complex surgical scenarios and simulating risk outcomes influenced by multiple clinical factors. This system facilitates intelligent agents in learning from both successful and suboptimal surgical cases, synthesizing lessons from failures, and continuously enhancing their capabilities, thus improving their proficiency in surgical decision-making and execution. The development of this comprehensive clinical surgery simulation system [30] aims to advance the practical application of LLM technology in the medical domain and provide clinicians with more reliable decision-making support."}, {"title": "III. METHOD", "content": "In this section, we introduce SurgBox, a novel framework designed to comprehensively simulate the entire surgical process. Sec. III-A elucidates the advanced role-playing methodology employed by SurgBox to accurately model the diverse medical professionals within an operating room environment. This approach meticulously captures the complex interactions and collaborative dynamics essential for completing surgical procedures. In Sec. III-B, we present the Surgery Copilot, a pivotal component of SurgBox engineered to enhance surgical safety and optimize inter-professional collaboration efficiency. Sec. III-C delineates the implementation of a sophisticated long-short memory mechanism integrated into the Surgery Copilot, which significantly improves the accuracy of surgical planning and interactions."}, {"title": "A. Role Playing for SurgBox", "content": "Role Playing of Medical Staffs. As shown in Fig. 2, SurgBox meticulously designs various surgical roles and employs LLM-based agents to accurately simulate the dynamics of operating rooms, establishing critical clinical roles including the patient, chief surgeon, surgeon assistant, scrub nurse, ward nurse, room nurse, and anesthetist. Each role's information and actions are generated using a tailored LLM, resulting in realistic and context-aware interactions. The characters take corresponding actions according to the stage task theme and event progression, engaging in dialogue with their counterparts.\nThe SurgBox system employs a sophisticated role-playing mechanism that enables a realistic simulation of a surgical environment. This is achieved through a combination of predefined role-specific knowledge bases, contextual awareness, and dynamic interaction logic. Each role, such as Chief Surgeon or Anesthesiologist, is underpinned by a comprehensive database encompassing domain-specific terminology, procedures, and responsibilities. This allows the LLM to generate role-appropriate dialogues and behaviors. The system's contextual awareness tracks the progression of the surgery, ensuring that each role's responses align with the current surgical stage. Predefined interaction rules govern the communication patterns and hierarchical structures typical of a real operating room. The LLM's capacity for dynamic response generation, based on preceding dialogues and current circumstances, facilitates a natural flow of conversation. Integration of specialized medical and surgical vocabulary enhances the authenticity and professionalism of the generated dialogues. Each role is programmed to perform specific tasks and duties, such as the anesthetist monitoring vital signs or the nurse preparing instruments. The system also incorporates event-triggered mechanisms, where certain dialogues or actions may precipitate specific events, like changes in patient status, influencing subsequent responses from other roles. Furthermore, the LLM maintains conversational coherence by retaining and utilizing previous information in subsequent dialogues.\nKnowledge Enhancement of Roles. To enhance the authenticity, effectiveness, and adaptability of the simulation, we implement an augmented domain knowledge retrieval and generation (RAG) method. This involves constructing a dedicated medical knowledge base for each key role in the operating room. The specialized knowledge bases encompass not only general medical knowledge but also focus on the specific expertise required by each role during the operation. For instance, the Chief Surgeon's knowledge base contains detailed surgical techniques, anatomical information, and complication treatment methods; the anesthetist focuses on anesthetic drug properties and patient monitoring protocols; and the nurse includes information on instrument preparation, aseptic techniques, and patient care. This refined knowledge base design ensures that each virtual role can access relevant and specialized knowledge support during the simulation, facilitating more accurate decision-making and actions.\nInteraction Between Roles. As shown in Fig. 3, SurgBox structures each operation into distinct stages and subtasks to promote collaborative communication, facilitating multiple rounds of interaction between different roles and enabling the proposition and verification of solutions for each stage. The simulation encompasses the entire surgical process from pre-operative to postoperative phases, segmented into three main stages: Preoperative, Intraoperative, and Postoperative. Each stage comprises specific tasks and participants, illustrating the patient's progression through key phases including transfer, anesthesia, surgical preparation, surgical operation, and postoperative care, with each phase involving the participation of corresponding medical personnel. This comprehensive approach not only replicates the surgical procedure itself but also incorporates preoperative preparation and postoperative care, providing a platform for medical teams to practice and optimize the entire surgical process in a virtual environment.\nConsider a simulated neurosurgery procedure in SurgBox: During the preoperative phase, the Chief Surgeon reviews the patient's MRI scans and medical history, collaborating with the Anesthetist to develop a tailored anesthesia plan. The Scrub Nurse prepares the surgical instruments based on the procedure requirements. In the intraoperative phase, the Chief Surgeon performs the operation step by step according to the surgical plan, communicating with the Surgical Assistant for auxiliary operations. The anesthetist continuously monitors the patient's vital signs, adjusting anesthesia as needed, while the Scrub Nurse anticipates and provides necessary instruments. Post-surgery, the team transitions the patient to recovery, with Nurses monitoring vital signs and managing pain according to the anesthetist's instructions. Throughout this process, each role accesses its specialized knowledge base to inform decisions and actions, resulting in a highly realistic and educational simulation of the entire surgical experience."}, {"title": "B. Surgery Copilot for SurgBox", "content": "At the core of the SurgBox system lies the innovative Surgery Copilot, an advanced LLM-based assistant designed to orchestrate and optimize the entire surgical process. This Copilot serves as a central hub for coordination, planning, and support within the virtual operating room environment.\nThe Surgery Copilot functions as an intelligent virtual assistant, seamlessly integrating into the SurgBox ecosystem to enhance surgical performance and outcomes. Its primary roles encompass real-time guidance, decision support, and adaptive learning as shown in Fig. 4. The Copilot continuously monitors the surgical procedure, analyzing the operation of different surgery room roles to provide contextual insights and recommendations. It offers step-by-step guidance, alerts the team to potential risks, and suggests optimal techniques based on the current surgical context and patient-specific factors. The Copilot leverages a vast database of surgical experiences, constantly updated with the latest medical research and best practices, to offer evidence-based recommendations tailored to each unique surgical scenario. By integrating with other SurgBox components, the Copilot enhances team coordination, optimizes resource utilization, and provides real-time risk assessment. Its natural language interface allows seamless interaction with the surgical team, offering instant access to relevant information, from patient history to surgical plan. This comprehensive support system empowers surgeons to make informed decisions rapidly, potentially reducing procedural time and improving patient outcomes while serving as an invaluable educational tool for surgical trainees.\nThe Surgery Copilot orchestrates seamless interactions with various roles throughout the surgical process, ensuring efficient workflow management and optimal team coordination across three key phases. In the preoperative phase, it collaborates with surgeons to refine the surgical plan, assists anesthetists in reviewing the anesthesia strategy, and helps nurses prepare the operating room. During the intraoperative phase, the Copilot's interactions intensify, providing real-time guidance to surgeons, assisting scrub nurses with instrument preparation and aseptic techniques, supporting anesthetists in monitoring patient vitals, and coordinating with circulating nurses for equipment and supply management. In the postoperative phase, the Copilot aids in developing care plans, guides the monitoring of post-surgical complications, assists with pain management protocols, and facilitates a comprehensive debriefing session. Throughout all stages, the Copilot's continuous and tailored interactions with each role ensure clear communication, efficient coordination, and optimal patient care, significantly enhancing the overall efficacy of the surgical process by providing role-specific support and maintaining a cohesive team environment.\nConsider a simulated neurosurgery procedure in SurgBox. The process unfolds as follows:\n*   Preoperative: The Copilot analyzes the patient's MRI scans and medical history to generate a detailed surgical plan, briefs the team on potential challenges, and guides instrument preparation.\n*   Intraoperative: During the critical tumor resection, the Copilot provides real-time guidance to the surgeon, monitors vital signs, and quickly retrieves relevant case studies when an unexpected complication arises.\n*   Postoperative: The Copilot assists in formulating a detailed recovery plan, provides critical care instructions to the ICU team, and facilitates a debriefing session to highlight learning points.\n*   This comprehensive support demonstrates how the Surgery Copilot enhances team coordination, decision-making, and overall surgical outcomes within the SurgBox environment, providing an invaluable tool for medical training and simulation."}, {"title": "C. Long-short Memory for Surgery Copilot", "content": "The Surgery Copilot is enhanced with a short-term memory mechanism that focuses on real-time information during the current surgery, including environmental data, inter-role dialogues, and ongoing operations. This feature enables the Copilot to swiftly retrieve relevant information about the corresponding stage and role during a single operation, ensuring timely and effective instructions without interference from historical data. The short-term memory significantly improves the Copilot's ability to respond rapidly to changes in surgical scenes and flexibly address emergencies.\nComplementing the short-term memory, the long-term memory component of the Surgery Copilot continuously accumulates experience from multiple surgeries. This comprehensive knowledge base not only contains clear and complete records of each operation but also synthesizes experiential summaries, providing crucial guidance for future similar procedures. The long-term memory is continuously updated through an iterative learning process, involving thorough evaluation of each simulation, extraction of key lessons, and systematic integration of new insights. This mechanism allows the Copilot to build a rich repository of surgical knowledge and best practices over time.\nWe integrate short-term and long-term memory mechanisms to enhance Surgery Copilot's ability to iteratively improve its surgical planning and execution. While short-term memory is cleared after each operation to maintain focus, long-term memory is updated with new insights, allowing the Copilot to refine its strategies based on accumulated experience. This approach enables more comprehensive pre-operative planning by leveraging past procedures while maintaining agility in real-time support. The Copilot can analyze performance indicators, manage unexpected events, and identify best practices across various scenarios. As a result, Surgery Copilot becomes increasingly proficient at optimizing surgical workflows, anticipating complications, and providing guidance for each case."}, {"title": "IV. DATASET", "content": "We collect the dataset of 128 real clinical surgery reports, as shown in Fig. 7. To enhance physician agent performance, we have enriched the operative reports with additional contextual information, including basic information, patient history, and MRI findings in Fig. 5. This comprehensive dataset enables physician agents to practice and refine their decision-making skills. The dataset facilitates continuous improvement of agents' capabilities in complex environments that simulate real-world surgical scenarios. The ultimate goal is to equip physician agents with reliable, practical knowledge applicable to actual clinical situations."}, {"title": "B. Simulated Surgery Report Dataset", "content": "This dataset consists of 1,000 simulated surgical reports generated through multiple SurgBox simulation processes. It is based on different types of surgical procedures and comprehensive patient examination results, covering a wide range of information such as preoperative examination, surgical details, postoperative observations, and results."}, {"title": "V. EXPERIMENTS", "content": "In this section, we present the experimental details to validate the effectiveness of the proposed SurgBox framework and Surgery Copilot from various perspectives."}, {"title": "A. Experimental Settings", "content": "We utilize real neurosurgery records as experimental datasets. These records contain detailed MRI analysis reports, surgical procedures, and clinical decision information. To protect patient privacy, all data were anonymized prior to analysis. The dataset encompasses neurosurgeries employing various surgical methods. We divide the dataset into training and test sets. The training set is used for the initialization and optimization of the SurgBox system, while the test set is used to evaluate the performance of the system.\nTo evaluate the performance of SurgBox, we employ two evaluation metrics specifically designed for SurgBox.\n1)  Surgical Route Accuracy: Evaluate the ability of LLM-based agents to select the best surgical route based on a given patient's condition. We compare the system's choices with the judgment of experienced neurosurgeons. 2)  Surgical Plan Accuracy: Evaluate the ability of LLM-based agents to correctly plan and complete the entire surgery.\nThe SurgBox system is built on advanced LLMs, and all our simulation experiments are based on the GPT-3.5-turbo-16k API. Specific prompt engineering techniques are employed to optimize the model's comprehension of medical terminology and surgical procedures. To simulate diverse surgical roles, dedicated knowledge bases, and behavior models are created for each role. As a core component, Surgery Copilot is allocated enhanced decision weights and expanded knowledge access. An iterative optimization method is adopted for the training process. The system initially underwent training on a limited number of surgical records, followed by a gradual expansion of the training set size, with continuous adjustment of model parameters and decision logic based on expert feedback. To ensure the repeatability and fairness of the experiments, we conducted all experiments in a fixed hardware environment and initialized the model with the same random seed."}, {"title": "B. Experimental Results and Analysis", "content": "As shown in TABLE I, our Surgery Copilot demonstrates superior performance in both Surgery Route and Surgery Plan categories, achieving scores of 88.00% and 88.02%, respectively. These results indicate that Surgery Copilot possesses substantial advantages in surgical route planning and surgical plan formulation.\nThe implementation of specific domain RAG technology substantially enhanced the performance of the baseline model, particularly in the Surgery Route category. This observation suggests that the incorporation of external knowledge retrieval can significantly enhance model performance in specialized domains. SurgBox demonstrated a distinct advantage over all other models by integrating a surgical field-specific knowledge base with the React method, effectively mitigating hallucinations and enhancing overall accuracy.\nThe SurgBox shows remarkable performance in all stages from TABLE II. The system consistently maintained a superior completion rate, particularly in Stage 2 and 3. Concurrently, its accuracy remained elevated throughout all stages, with notably high and stable performance in the later stage, indicative of its robustness and reliability in complex surgical scenarios. Generally, the completion rate and accuracy of all models declined as stages progressed, reflecting the escalating complexity and challenges in the later phases of the surgical process. In contrast, while SurgBox exhibits a marginal decrease in completion rate, its accuracy diminished less significantly, demonstrating superior consistency and adaptability. This discrepancy underscores the advantages of models optimized for surgical scenarios, over general LLMs, particularly in managing complex late-stage surgical procedures. This trend emphasizes the significance and challenges associated with developing surgical simulation systems capable of maintaining high performance throughout the entire surgical process.\nAs the sample size increases, Surgery Copilot's performance in both surgical path and surgical planning tasks demonstrates significant improvement, exhibiting an upward but gradually plateauing trend. Notably, the model exhibits robust performance even with smaller sample sizes, which has substantial implications for real-world medical scenarios with resource constraints.\nSurgery Copilot performed well on primary non-functioning pituitary adenomas and recurrent pituitary corticosteroid adenomas, as illustrated in Fig. 9, highlighting its advantage in diagnosing these specific diseases. The varied performance across different diseases suggests that the complexity and characteristics of each condition significantly influence the model's efficacy.\nThe implementation of various technologies demonstrates differential impacts on the baseline model's performance in surgical planning and routing in Table III. Notably, our specific domain RAG technology showed significant improvement, particularly in the Surgery Route category, increasing the score from 72.00% to 84.00%. This substantial enhancement of SurgBox suggests that integrating external knowledge retrieval and long-short term memory is highly effective in specialized domains, including surgery.\nThe Surgbox, which integrates a surgery-specific knowledge base with the React method, demonstrated superior performance across both categories, achieving 88.00% for the surgery route accuracy and 88.02% for the surgery plan accuracy. This demonstrates that the combination of domain-"}, {"title": "VI. CONCLUSION", "content": "In this work, we present an integrated approach to address the critical cognitive challenges in surgical interventions. First, we propose SurgBox, an agent-driven sandbox framework that enables surgeons to systematically enhance their cognitive capabilities through deliberate practice in risk-free virtual environments. By leveraging LLM-based agents with tailored RAG knowledge banks, SurgBox creates highly realistic simulations of operating room dynamics, allowing surgeons to develop"}]}