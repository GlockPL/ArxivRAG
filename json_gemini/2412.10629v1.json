{"title": "Rapid Reconstruction of Extremely Accelerated Liver 4D MRI via Chained Iterative Refinement", "authors": ["Di Xu", "Xin Miao", "Hengjie Liu", "Jessica E. Scholey", "Wensha Yang", "Mary Feng", "Michael Ohliger", "Hui Lin", "Yi Lao", "Yang Yang", "Ke Sheng"], "abstract": "Purpose: 4D MRI with high spatiotemporal resolution is vital to characterize the tumor/tumor motion for liver\nradiotherapy. However, high-quality 4D MRI requires an impractically long scanning time for dense k-space signal\nacquisition covering all respiratory phases. Accelerated sparse sampling followed by reconstruction\nenhancement is desired but often results in degraded image quality and long reconstruction time. We hereby\npropose the chained iterative reconstruction network (CIRNet) for efficient sparse-sampling reconstruction while\nmaintaining clinically deployable quality.\nMethods: CIRNet adopts the denoising diffusion probabilistic framework to condition the image reconstruction\nthrough a stochastic iterative denoising process. During training, a forward Markovian diffusion process is\ndesigned to gradually add Gaussian noise to the densely sampled ground truth (GT), while CIRNet is optimized\nto iteratively reverse the Markovian process from the forward outputs. At the inference stage, CIRNet performs\nthe reverse process solely to recover signals from noise, conditioned upon the undersampled input. CIRNet is\nstructured with a U-Net architecture, optimized to minimize the L2 difference between estimated and GT noises.\nCIRNet processed the 4D data (3D+t) as temporal slices (2D+t). The proposed framework is evaluated on a data\ncohort consisting of 48 patients (12332 temporal slices) who underwent free-breathing liver 4D MRI. 3-, 6-, 10-,\n20- and 30-times acceleration were examined with a retrospective random undersampling scheme. Compressed\nsensing (CS) reconstruction with a spatiotemporal constraint and a recently proposed deep network, Re-Con-\nGAN, are selected as baselines.\nResults: CIRNet consistently achieved superior performance compared to CS and Re-Con-GAN (e.g., PNSR of\nCIRNet, CS and Re-Con-GAN is at 22.35\u00b12.94, 13.27\u00b13.89 and 13.27\u00b13.89 dB in 30 times acceleration). The\ninference time of CIRNet, CS, and Re-Con-GAN are 11s, 120s, and 0.15s.\nConclusion: A novel framework, CIRNet, operating under stochastic iterative refinement for accelerated MR\nreconstruction, is presented. Compared with published methods, CIRNet maintains useable image quality for\nacceleration up to 30 times, significantly reducing the burden of 4DMRI.", "sections": [{"title": "1. Introduction", "content": "Owing to its superior soft tissue contrast compared to computed tomography, magnetic resonance imaging (MRI)\nhas been increasingly adopted for image-guided liver radiation therapy (RT)1\u20133. 4D MRI, a volumetric imaging\ntechnique for respiratory-resolved images, is suited for characterizing tumor morphologies and motions4\u20136.\nDuring the planning for free-breathing liver RT, the internal target volume (ITV) for free-breathing or gated\ntreatments is determined based on individually contoured 4D MRIs. An inaccurately defined ITV may lead to\ninsufficient tumor coverage or over-dosing of the surrounding normal tissue.\nA typical motion-insensitive technique for 4D MRI acquisition is via continuous free-breathing scan of 3D golden\nangle stack-of-stars spokes, where radial sampling is conducted in the kx \u2013 ky plane to reduce motion\nsensitivity and incoherent k-space understanding; Cartesian sampling is applied in the kz plane to allow for\nflexible selection of volumetric coverage\u00ba. Yet, such scans usually take 8-10 minutes to achieve acceptable\nspatiotemporal resolution for all respiratory phases. The long scan time is a significant burden to patients,\nconsidering the need to acquire other essential images. Though undersampling in the kx \u2013 ky plane can\neffectively reduce the scan time, it also leads to streaking artifacts, uneven brightness, and blurriness using\nconventional reconstruction methods. Parallel imaging10,11, which simultaneously acquires numerous views with\nmultiple receiver coils, and compressed sensing (CS)12\u201315, a constrained iterative optimization framework, have\nbeen previously proposed to mitigate these problems. Still, the images are unusable with high acceleration\nratios16.\nIn the past decade, numerous deep learning (DL) based algorithms have been proposed for 4D MRI\nreconstruction. Ample studies have demonstrated that well-trained DL models can match/exceed CS\nperformance with significantly faster reconstruction16\u201318. Existing works have explored using convolutional\nneural networks (CNNs)18, recurrent neural networks (RNNs)16, Transformers19, or generative adversarial training\n(GAN) assisted networks for 4D MR reconstruction20. For instance, Schlemper et al. proposed a cascade 3D CNN\narchitecture for 4D MRI reconstruction18 and demonstrated their model performance in a dataset with up to 11-\nfold undersampling. Adapting from the UNet architecture, Dracula 21 and Moivenet22 were proposed to\naccelerate 4D MR reconstruction using multi-coil images with 1.5, 2 and 2.5-fold acceleration explored. Moreover,\nHuang et al. introduced a motion-guided framework using RNN-inspired Conv-GRU for initial 2D frame\nreconstruction and U-FlowNet for motion estimation in the optical flow field23. The proposed pipeline\nreconstructed a 5 and 8 times accelerated (5x and 8x) cardiac dataset. Xu et al. then proposed a 2D CNN-assisted\nReconstruction Swin Transformers (RST), a variant of Video Swin Transformers24, and validated the algorithm on\na 9x accelerated cardiac dataset19. Xu et al. recently explored a GAN-based framework (Re-Con-GAN) with up to\n10x acceleration on liver 4D MRI pursued 20. However, the performance of most existing methods declines rapidly\nbeyond 10x. Since those frameworks require carefully designed regularization and optimization tricks, which are\noften hard to seek in challenging tasks to tame the optimization instability25,26 and avoid model collapsing27,28.\nRecently, stochastic diffusion probabilistic models, such as Denoising Diffusion Probabilistic Model (DDPM)29,30\nand Super Resolution via Repeated Refinement (SR3)31, have been demonstrated to be superior in natural image\nsuper-resolution tasks compared to the regression-based CNNs/RNNs/Transformers and GAN enhanced\nframeworks. Such diffusion architectures have two major advantages. 1) Modelling imaging noise instead of the"}, {"title": "2. Materials and Methods", "content": "The study was approved by the local Institutional Review Board at UCSF (#14-15452). 48 patients were scanned\non a 3T MRI scanner (MAGNETOM Vida, Siemens Healthcare, Erlangen, Germany) after injecting hepatobiliary\ncontrast (gadoxetic acid; Eovist, Bayer). A prototypical free-breathing T1-weighted volumetric golden angle stack-\nof-stars sequence was used for 4D MRI acquisition. The scanning parameters were - TE=1.5 ms, TR=3 ms, matrix\nsize = 288x288, FOV = 374 mm x 374 mm, in-plane resolution=1.3 mm \u00d7 1.3 mm, slice thickness=3 mm, radial\nviews (RV) per partition=3000, number of slices or partitions = 64-75, acquisition time = 8-10 min. The pulse\nsequence ran continuously over multiple respiratory cycles. Images reconstructed from the entire space data of\n3000 radial spokes (RV-3000) were treated as the fully sampled ground truth reference (Based on Nyquist\nsampling theorem, fully sampled radial images require sampling points \u00d7 spokes, resulting in 452 spokes for a\nmatrix size of 288 \u00d7 288. After motion binning, each of the eight bins has, on average, 375 spokes with RV3000,\nclose to fully sampled 452 spokes). Retrospective under-sampling was performed by randomly selecting 1000,\n500, 300, 150, and 100 spokes from the 3000 spokes, corresponding to acceleration ratios of 3x, 6x, 10x, 20x,\nand 30x. For initial image reconstruction, data sorting based on a self-gating signal was performed to divide the\ncontinuously acquired k-space data into 8 respiratory phases. nonuniform fast Fourier transform (nuFFT)\nalgorithm was applied to reconstruct each phase individually. Only regular breathers (48 patients) were included\nin the current project. Breathing regularity was quantified using the self-gating signal waveform36\u201338. The peak-\nto-trough range and mid-level amplitude (A), i.e., (peak-A + trough-A)/2, were calculated for each respiratory\ncycle. The average mid-level amplitude across all respiratory cycles normalized with the average peak-to-trough"}, {"title": "2.1 Data Cohort", "content": "The study was approved by the local Institutional Review Board at UCSF (#14-15452). 48 patients were scanned\non a 3T MRI scanner (MAGNETOM Vida, Siemens Healthcare, Erlangen, Germany) after injecting hepatobiliary\ncontrast (gadoxetic acid; Eovist, Bayer). A prototypical free-breathing T1-weighted volumetric golden angle stack-\nof-stars sequence was used for 4D MRI acquisition. The scanning parameters were - TE=1.5 ms, TR=3 ms, matrix\nsize = 288x288, FOV = 374 mm x 374 mm, in-plane resolution=1.3 mm \u00d7 1.3 mm, slice thickness=3 mm, radial\nviews (RV) per partition=3000, number of slices or partitions = 64-75, acquisition time = 8-10 min. The pulse\nsequence ran continuously over multiple respiratory cycles. Images reconstructed from the entire space data of\n3000 radial spokes (RV-3000) were treated as the fully sampled ground truth reference (Based on Nyquist\nsampling theorem, fully sampled radial images require sampling points \u00d7 spokes, resulting in 452 spokes for a\nmatrix size of 288 \u00d7 288. After motion binning, each of the eight bins has, on average, 375 spokes with RV3000,\nclose to fully sampled 452 spokes). Retrospective under-sampling was performed by randomly selecting 1000,\n500, 300, 150, and 100 spokes from the 3000 spokes, corresponding to acceleration ratios of 3x, 6x, 10x, 20x,\nand 30x. For initial image reconstruction, data sorting based on a self-gating signal was performed to divide the\ncontinuously acquired k-space data into 8 respiratory phases. nonuniform fast Fourier transform (nuFFT)\nalgorithm was applied to reconstruct each phase individually. Only regular breathers (48 patients) were included\nin the current project. Breathing regularity was quantified using the self-gating signal waveform36\u201338. The peak-\nto-trough range and mid-level amplitude (A), i.e., (peak-A + trough-A)/2, were calculated for each respiratory\ncycle. The average mid-level amplitude across all respiratory cycles normalized with the average peak-to-trough"}, {"title": "2.2 CIRNet Framework", "content": "The source-target image sequence pairs, D = {xi, Yi}i=1,\nare samples drawn from the unknown distribution\np(y|x). Our goal is to learn a parametric approximation of p(y|x) that can map x to y. We approach this\nproblem through the forward and backward stochastic iterative diffusion refinement process. As seen in Figure\n1, the forward diffusion process q incrementally adds Gaussian noise to the fully sampled image sequence Yo\nover T timesteps through a fixed Markov chain Po(YtYt-1). The backward diffusion process po is\nparameterized with CIRNet, which aims to iteratively recover signals from noise yr conditioned on the\ninformation in source x.\nThe CIRNet architecture is a modified U-Net from SR331. We replace the original residual blocks with that from\nBigGAN39, rescale the skip connections by $\\frac{1}{\\sqrt{2}}$ and replace the input/output number of channels (C = 3) in\nnatural images with the number of motion bins (C = T = 8) in our image sequence. Therefore, the input to the\nnetwork is of shape C(T) \u00d7 H\u00d7W\u00d7Z=8 \u00d7 256 \u00d7 256 \u00d7 1, where H, W and Z are the input height, width\nand number of slices, respectively. The forward training noise schedule uses a piece-wise distribution y that\nconducts uniformly sampling through the iteration timesteps T, where T = 800 across our experiments.\nAssuming the forward diffusion process can be viewed as a fixed approximate posterior to the inference process,\nwe derive the variational lower bound on the marginal log-likelihood as Equation (1). Given a particular\nparameterization po, we derive the negative variational lower bound as the simplified L2 loss for pe\noptimization, defined in Equation (2), up to a constant weighting of each term for each time step29.\n$E_{(x,y_0)}logp_{\\theta} (y_0|x) \\geq E_{q(y_T)}E_{q(y_{t-1}|y_t,y_0)} [log \\frac{p_{\\theta}(y_{t-1} | y_t, x)}{q(y_t|y_{t-1})} ]$ (1)\n$E_{x,y_0,\\epsilon} [\\frac{1}{T}\\sum_{t=1}^{T} \\left | \\epsilon - \\epsilon_{\\theta} (x, \\sqrt{\\overline{\\gamma_t}} y_0 + \\sqrt{1-\\overline{\\gamma_t}}\\epsilon, t) \\right |_2^2]$ (2)"}, {"title": "2.3 Model Training", "content": "CIRNet was trained for 1,000,000 iterations with a batch size of 4 \u00d7 1 across all the acceleration ratios, with the\nbest performer selected via cross-validation saved as final model weights. Adam optimizer was used with a linear\nwarmup schedule of over 10,000 training iterations, followed by a fixed learning rate of 0.0001 for the rest of\nthe training. The model was implemented in PyTorch with all the experiments carried out on a 4\u00d7 RTXA6000\nGPU cluster."}, {"title": "2.4 Baseline Algorithms and Model Evaluation", "content": "A conventional CS algorithm and a GAN-based DL method, Re-Con-GAN20, were included as benchmarks. For Re-\nCon-GAN, ResNet9 generator was selected. The CS algorithm was implemented with close-sourced Siemens ICE\nplatform, while Re-Con-GAN was implemented with the author's original experimental codes.\nThe model performance was evaluated using the following metrics: root mean squared error (RMSE), peak-\nsignal-to-noise ratio (PSNR), structure similarity indexed measurement (SSIM), and inference time, as shown in\nEquation (3-5).\n$RMSE = \\sqrt{\\frac{\\sum_{i=1}^{N}(G(x, z) \u2013 y)^2}{N}}$ (3)\n$PSNR = 20 \\cdot log_{10}\\frac{MAX_1}{RMSE}$ (4)"}, {"title": "3. Results", "content": "The quantitative results and selected visualization of the test set are reported in Table 1, Figure 2, and Figure 3.\nVisually, Figure 2 shows that as the acceleration ratio increases from 3x to 30x, the under-sampled nuFFT images\n(first column) become unusable with rapidly increasing streaking artifacts and image noises. In comparison,\nCIRNet is robust to increasing undersampling, showing useable images at the highest acceleration with a\nmarginally decreased detail retention and slightly more noticeable artifacts and noises. CIRNet consistently\noutperforms comparison methods both visually and quantitatively. The Re-Con-GAN has smoother predictions\nwith notable detail loss at higher acceleration ratios (10x and 30x). At 3x acceleration, CIRNet achieves superior\n1-SSIM (0.04) and RMSE (0.06), with well-preserved anatomical details. As acceleration increases, CIRNet\nmaintains better quantitative performance (e.g., 1-SSIM: 0.05 at 6x, 0.06 at 10x, 0.08 at 20x and 0.11 at 30x),\nand image detail retention, compared with more pronounced detail loss and degraded quantitative performance\nby Re-Con-GAN (1-SSIM: 0.07 at 6x, 0.12 at 10x, 0.16 at 20x and 0.17 at 30x) and CS (1-SSIM: 0.08 at 6x, 0.13 at\n10x, 0.18 at 20x and 0.19 at 30x). Speed-wise, the averaged reconstruction time of CIRNet for a 4D volume\n(around 11 s) is around 10 times faster than CS (120 s), though less efficient than the Re-Con-GAN (sub-second),\nwhich does not require test-phase optimization. Figure 3 shows that CIRNet is robust across all acceleration\nlevels and can maintain useable contrast and sharpness across all motion phases."}, {"title": "4. Discussion", "content": "Hepatocellular carcinoma (HCC) ranks at the top ten most prevalent cancers globally, and it has become one of\nthe leading and fastest-growing causes of cancer-related death40,41. Moreover, the liver is a frequent site for\nmetastases from various cancer types, including colorectal, pancreatic, melanoma, lung, and breast cancers42.\nAlthough surgical resection remains the standard of care for HCC43, RT is an effective alternative for unresectable\npatients44. Owing to its superior soft-tissue contrast, 4D MRI is a crucial imaging tool for image-guided RT (IGRT)\nin liver cancer.\nThough existing DL and analytical methods reported promising results for accelerated 4D MRI reconstruction,\nnone maintain usable image quality with >10x acceleration. The current paper shows that CIRNet can maintain\nits reconstructed image quality up to 30x acceleration, leading to around 20-second acquisition, significantly\nreducing the patient burden. There are several theoretical and practical advantages to using CIRNet for 4D MRI\nreconstruction. First, CIRNet demonstrates superior retention of subtle tissue textures, which is essential for the\naccurate delineation of liver tumors. In comparison, Re-Con-GAN suffers from detail loss due to the inherent\nsmoothing effects of CNNs, while CS methods tend to lose the structures and leave more pronounced artifacts\nthat worsen steeply with high acceleration rates. Second, CIRNet offers significantly faster reconstruction (11s)\nthan the CS method (120s), making them practical for time-sensitive adaptive IGRT. Though CIRNet is slower\nthan Re-Con-GAN (<1s) inference-wise, CIRNet offsets longer reconstruction time with shorter acquisition. The\nacquisition time using CIRNet approaches the duration of a breathing cycle, indicating the potential of capturing\nreal-time motion with minimal binning/averaging.\nNevertheless, the current work is not without room for improvement. First, our implementation is limited to\nlearning 2D+t image series. Training with 3D+t data would enable more effective learning of inter-slice anatomy\nbut would demand an impractically large GPU memory capacity. Second, the current method functions in the\nimage domain, which leads to potential information loss and added latency due to preliminary k-space to image\ntransformation. Future work will explore frameworks working in k-space or using multi-coil data as the model\ninput. Lastly, CIRNet can be complex and less interpretable, especially when trained on 4D data, which could\npose potential challenges in clinical validation, where model interpretability is essential. In the future,\nexplainable artificial intelligence techniques, such as gradient-weighted class activation mapping45, saliency\nmaps46, and feature attribution analysis47, can be incorporated to improve the transparency and trustworthiness\nof the current framework."}, {"title": "5. Conclusion", "content": "An ultra-sparse liver 4D MRI reconstruction framework, CIRNet, is proposed in the current work. CIRNet employs\na stochastic diffusion process to iteratively model the source noise for robust image reconstruction. The\nevaluation conducted on an in-house data cohort demonstrates promising imaging quality at ultra-high\nacceleration ratios."}]}