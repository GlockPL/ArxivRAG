{"title": "Large-scale Urban Facility Location Selection with Knowledge-informed Reinforcement Learning", "authors": ["Hongyuan Su", "Yu Zheng", "Jingtao Ding", "Depeng Jin", "Yong Li"], "abstract": "The facility location problem (FLP) is a classical combinatorial optimization challenge aimed at strategically laying out facilities to maximize their accessibility. In this paper, we propose a re- inforcement learning method tailored to solve large-scale urban FLP, capable of producing near-optimal solutions at superfast in- ference speed. We distill the essential swap operation from local search, and simulate it by intelligently selecting edges on a graph of urban regions, guided by a knowledge-informed graph neu- ral network, thus sidestepping the need for heavy computation of local search. Extensive experiments on four US cities with dif- ferent geospatial conditions demonstrate that our approach can achieve comparable performance to commercial solvers with less than 5% accessibility loss, while displaying up to 1000 times speedup. We deploy our model as an online geospatial application at https://huggingface.co/spaces/randommmm/MFLP.", "sections": [{"title": "INTRODUCTION", "content": "In real cities, facility layout tends to deviate from residential de- mands for corresponding services, leading to costly travel [12, 13]. Therefore, optimizing accessibility by strategically locating urban facilities is crucial for creating more sustainable and inclusive cities. In fact, facility location problem (FLP) is a classic combinatorial optimization (CO) problem [2, 8], which is notoriously challenging due to the NP-hardness inherent in selecting p urban regions to place facilities from N candidate regions [5]. As both N and p are typically large in urban contexts, designing a reliable algorithm that delivers satisfactory solutions within reasonable timeframes is dif- ficult. Furthermore, unlike the standard FLP setup, urban facilities exhibit multiple types, each with distinct budgets and residential needs, further complicating the task.\nFLP is traditionally addressed using heuristics, metaheuristics [3, 4, 7] and commercial mixed integer programming (MIP) solvers [1]. Despite the near-optimal solutions they offer, the heavy compu- tation of local search inherent in these approaches renders them suitable only for small-scale problems, while they tend to be unac- ceptably slow [11]. On the other hand, machine learning models are proposed to tackle FLP, i.e., ML4CO [9, 10, 14], which replace inten- sive local search with learnable neural networks. Though ML4CO significantly accelerates solution generation through fast model inference, it has drastically degenerated accessibility performance for the overlooking rich prior knowledge inherent in FLP.\nIn this paper, we present a deep reinforcement learning (DRL) method to solve the large-scale urban facility location problem, which is able to achieve comparable accessibility performance to commercial solvers while generating solutions with up to 1000 times speedup. Specifically, we construct a graph of urban with geospatial information, based on which we distill the essential swap operation in local search, replacing inefficient exploration with rapid edge selections which informed by a GNN tailored to the FLP. Additionally, we integrate tabu search [7] and node benefits [6] into the graph via dynamic wiring to avoid redundant and low-quality solutions. Finally, to address practical urban FLP with multiple types of facilities, we design a divide-and-conquer algorithm to solve the problem with two stages, which first accomplishes single facility solutions independently, then conducts adjustments, both using the unified SWAP operation and GNN model."}, {"title": "2 PROBLEM FORMULATION", "content": "Given the total number of facilities P, candidate locations for fa- cilities $N = \\{N_1, N_2,\\cdots, N_n\\}$, and corresponding demands $H = \\{h_1, h_2,..., h_n\\}$, the FLP aims to maximize the accessibility of facil- ities. Different from the FLP, which focuses on a single type of facil- ity, we investigate Multi-Facility Location Problem (MFLP), which involves K different types of facilities which are distinguished by different superscripts, and the type k facility have to be placed in $p_k$ different regions among N, with the corresponding residential demands are denoted as $H^k = \\{h^k_1, ..., h^k_n\\}$. The MFLP aims to op- timize accessibility to all types of facilities, which can be measured by the access cost (AC) as follows:\n$AC = \\sum_{k \\in K} \\sum_{i=1}^n \\sum_{j=1}^n d_{ij} Y^k_{ij}$         (1)\nwhere $d_{ij}$ denotes the distance between location $N_i$ and $N_j$, and $Y^k_{ij}$ indicates whether demand $h_i$ at $N_i$ is satisfied by a facility at $N_j$.\nFor the purpose of modeling the interactions between different facilities aforementioned, we introduce incompatibility to MFLP, which is the key to differentiating MFLP from multiple independent FLPs. Incompatibility requires only one specific type of facility can be placed at each region, and can be characterized as,\n$x^p_i x^q_i = 0, \\forall p, q \\in K, p \\neq q, N_i \\in N$, (2)\nwhere $x^p_i$ is an indicator variable to whether a facility of type p is placed at $N_i$.\nFigure 1 provides an illustrative example of MFLP for two differ- ent types of urban facilities. In particular, when |K| = 1, the MFLP will degenerate into the standard FLP problem."}, {"title": "3 METHOD", "content": "We introduce a knowledge-informed DRL approach to solve the large-scale FLP. Inspired by local search methods, the SWAP opera- tor is developed to fully leverage the searched solution space. Based on the SWAP operator, we define a swap graph for the large-scale FLP and formulate the FLP as a sequential edge selection prob- lem with a domain knowledge-driven dynamic wiring to identify high-quality SWAP operations. Additionally, a divide-and-conquer framework is further proposed to address the real-world MFLP, taking into account constraints between different types of facilities with a two-stage process."}, {"title": "3.1 The Universal SWAP operator", "content": "Cities of large scale contain thousands of candidate regions and require hundreds of facilities, making it time-consuming to gen- erate solutions from scratch due to its repeated computations. To make full use of the already obtained solutions, we distill the uni- versal SWAP operator based on the idea of local search [7], which generates new solutions by fine-tuning and improving the current solution. Specifically, each SWAP operator takes two locations, in- sert and remove, and moves the facility at remove to insert. Through successive SWAP operators, the initial solution can be adjusted towards better solutions iteratively until reaching the optimal."}, {"title": "3.2 Knowledge-Informed RL", "content": "As introduced previously, heuristic methods are accurate but slow, while ML4CO approaches accelerate solution generation with sig- nificant accuracy deterioration. We propose a knowledge-informed RL method that uses the best of both worlds, generating accurate solutions at a superfast speed, as illustrated in Figure 2.\nMDP on Graph. We regard all the candidate locations as nodes and add edges between nodes with and without facility to construct a swap graph, which can be formulated as follows,\n$G_t = \\{N,\\&_t\\}, e_{ij,t} = 1\\{X_{i,t} < X_{j,t}\\}.$  (3)\nThe SWAP operator is thus equivalent to edge selection on the swap graph, as illustrated in Figure 2 (b). Moreover, since the solution of MFLP is generated through a sequence of SWAP operators, solving MFLP can be framed as an MDP with the following elements:\n\u2022 State summarizes the information about the topology of urban regions and the placement of facilities.\n\u2022 Action denotes choosing an edge on the swap graph and ex- changing the corresponding facility placement.\n\u2022 Reward is the reduction of access cost defined by Equation (1).\nDynamic Wiring by FLP Knowledge. Not all edges on the swap graph benefit the reduction of the access cost, particularly when the solution is close to the optimal or falls into a local optimum. Here, we introduce a dynamic wiring technique informed by FLP knowledge, to initially assess the exploration value of each action. Specifically, as shown in Figure 2, our dynamic wiring involves filtering two categories of edges that contribute less to the optimal solution. Tabu Edges are inspired by Tabu Search [7], and recently visited locations by SWAP operators will be recorded as Tabu nodes, and edges containing Tabu Nodes are considered as Tabu Edges. Negative Benefit Edges indicate actions with significant negative returns. The change of total access cost after taking action can be"}, {"title": "3.3 Divide-and-Conquer Framework", "content": "The proposed RL framework solves FLP with superior efficiency. We now extend it to address the incompatibility in the MFLP with a divide-and-conquer framework, which consists of two succes- sive stages. In Stage I, the agent searches for the optimal locations for each type of facility using the SWAP operator independently, starting from a greedily constructed initial solution. Since these independent solutions may conflict with the incompatibility con- straints described by Equation (2), in Stage II the agent further refines these independent solutions by eliminating the conflicts via the SWAP operators as well. Stage II continues until all incompati- bility conflicts are resolved.\nWith this divide-and-conquer framework, we can reuse the pro- posed RL algorithm for large-scale FLP to address the MFLP. On the one hand, both of the two stages share the aligned objective of minimizing the access cost, i.e., generating separate optimal place- ments for each type of facility with lowest access cost in Stage I and resolving incompatibilities with the minimal increase in access cost in Stage II. On the other hand, we accomplish both stages employing the same universal SWAP operator. Consequently, our knowledge-informed RL approach kills two birds with one stone by intelligently conducting SWAP operators to optimize access cost, unifying the two challenging problems of FLP and MFLP."}, {"title": "4 EXPERIMENTS", "content": "We conduct extensive experiments based on the real world urban geospatial data and human mobility data from SafeGraph. Our method is compared against traditional methods such as genetic algorithm (GA), tabu search (TS), local search (LS). Moreover, ad- vanced machine learning approach for CO problem (CardNN) [11] and commercial solver Gurobi are included."}, {"title": "4.1 Overall Performance", "content": "We evaluate our model across different large-scale cities with the results illustrated in Table 1, from which we have the following observations,"}, {"title": "5 CONCLUSION", "content": "In this paper, we present a knowledge-informed RL method tailored to solve real-world FLP and MFLP. By infusing rich prior knowledge into the dynamical wiring of GNN, our application can produce near-optimal solutions for large-scale FLP with up to 1000 times speedup compared to commercial solvers. Particularly, for New York city-scale scenarios, which are too large such that existing commercial solvers fail to handle, our method generates reliable"}]}