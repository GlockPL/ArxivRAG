{"title": "An AI-driven framework for rapid and localized optimizations of urban open spaces", "authors": ["Pegah Eshraghi", "Arman Nikkhah Dehnavi", "Maedeh Mirdamadi", "Riccardo Talami", "Zahra-Sadat Zomorodian"], "abstract": "As urbanization accelerates, open spaces are increasingly recognized for their role in enhancing sustainability and well-being, yet they remain underexplored compared to built spaces. This study introduces an AI-driven framework that integrates machine learning models (MLMs) and explainable AI techniques to optimize Sky View Factor (SVF) and visibility\u2014key spatial metrics influencing thermal comfort and perceived safety in urban spaces. Unlike global optimization methods, which are computationally intensive and impractical for localized adjustments, this framework supports incremental design improvements with lower computational costs and greater flexibility. The framework employs SHapley Adaptive Explanations (SHAP) to analyze feature importance and Counterfactual Explanations (CFXs) to propose minimal design changes. Simulations tested five MLMs, identifying XGBoost as the most accurate, with building width, park area, and heights of surrounding buildings as critical for SVF, and distances from southern buildings as key for visibility. Compared to Genetic Algorithms, which required approximately 15\u201330 minutes across 3\u20134 generations to converge, the tested CFX approach achieved optimized results in 1 minute with a 5% RMSE error, demonstrating significantly faster performance and suitability for scalable retrofitting strategies. This interpretable and computationally efficient framework advances urban performance optimization, providing data-driven insights and practical retrofitting solutions for enhancing usability and environmental quality across diverse urban contexts.", "sections": [{"title": "1. Introduction", "content": "As urbanization accelerates globally, cities face growing challenges in achieving sustainability, livability, and resilience. Balancing built and open spaces is essential for creating healthier, more inclusive, and environmentally responsive communities (Andreucci et al., 2021; Johari et al., 2020). While buildings and their energy performance have been widely studied (Toutou et al.,2018; Yan et al.,2022), open spaces such as parks and green corridors remain underexplored, despite their vital role in mitigating urban heat islands (UHIs), improving air quality, regulating microclimates, and promoting well-being (Chen et al., 2012s; Olszewska-Guizzo et al., 2022). Open spaces also support social interaction, recreation, and environmental sustainability (Bourbia and Boucheriba, 2010), but their usability and functionality depend heavily on the surrounding urban morphology, including building height, density, orientation, and proximity (Stamps, 1999s; Kaplan and Kaplan, 1989). These factors influence solar access, visibility, and thermal comfort, shaping perceptions of safety, accessibility, and usability (Zheng et al.,2023; T\u00fcrkseven Do\u011frusoy and Zengel, 2017).\nAmong spatial metrics, Sky View Factor (SVF) and visibility have emerged as key indicators for evaluating openness and visual access in urban environments. SVF quantifies sky openness, serving as a measure of thermal comfort, solar exposure, and microclimatic regulation (Miao et al., 2020; Wang and Akbari, 2014), while visibility affects safety perceptions, navigation, and social interactions, making it essential for urban design (T\u00fcrkseven Do\u011frusoy and Zengel, 2017). Despite the importance of spatial metrics like SVF and visibility, existing tools often emphasize the evaluation of built environments rather than the dynamics of open spaces. While SVF and visibility are widely recognized as indicators of openness, light availability, and perceived safety, most approaches focus solely on measuring these metrics without proposing adjustments to improve usability or environmental performance (Jim and Chen, 2006; Zavadskas et al.,2019; Sezavar et al.,2023). Furthermore, several studies have optimized SVF through simulation and parametric modeling techniques (Geng et al. 2024; Xu et al., 2019). However, these approaches primarily rely on global search algorithms that are computationally demanding and require large-scale redesigns, making them impractical for localized adjustments (Toutou et al., 2018; Xu et al., 2019). Given that urban open spaces are often embedded within existing contexts, large-scale modifications may not always be feasible. Instead, localized interventions are more suitable, preserving existing structures while enhancing performance. This underscores the need for optimization approaches that balance computational efficiency, flexibility, and interpretability, enabling targeted modifications without requiring complete transformations, making them practical for retrofitting as well as new designs.\nCounterfactual Explanations (CFXs) address this need by focusing on minimal, actionable changes to optimize spatial performance metrics. Unlike traditional optimization approaches such as genetic algorithms (GA) and multi-objective methods like Non-Dominated Sorting Genetic Algorithm (NSGA-II) which emphasize global solutions (Saad and Araji, 2021)\u2014CFXs prioritize localized adjustments, enabling incremental changes with lower computational costs, making them ideal for retrofitting and urban design optimizations (Tsirtsis and Gomez-rodriguez, 2020; Regenwetter et al.,2023).\nTo address these challenges, this study introduces an AI-driven framework that combines machine learning models (MLMs) with explainable AI techniques for interpretable and actionable optimization. To enhance interpretability, the framework leverages SHapley Adaptive Explanations (SHAP) for feature importance analysis (Zhong et al., 2022) and CFXs to suggest minimal design changes to enhance SVF and visibility (Tsirtsis and Gomez-rodriguez, 2020). By integrating these methods, this approach provides an efficient, scalable, and transparent framework for optimizing urban open spaces."}, {"title": "Aims, Objectives, and Contributions", "content": "This study develops an AI-driven framework that integrates SHAP and CFXs to evaluate and optimize spatial metrics in urban open spaces. Unlike traditional approaches that emphasize energy metrics and require global redesigns, this framework focuses on localized interventions, making it scalable, interpretable, and practical for urban retrofitting and design optimization. The focus on SVF and visibility highlights their location-independent nature, as they are determined solely by urban morphology rather than climate or geographical conditions. This characteristic ensures the generalizability of findings across diverse urban contexts. The framework's flexibility and scalability are demonstrated using Tehran, Iran as a case study, leveraging its varied urban configurations, including high-density cores and low-density areas, to test its adaptability. The primary aim of this study is to combine MLMs with explainable AI techniques to optimize spatial metrics in urban design. Key objectives include:\n\u2022 Evaluating the influence of urban morphology parameters on SVF and visibility to assess their role in usability and environmental performance.\n\u2022 Developing predictive models using MLMs to estimate SVF and visibility with high accuracy and computational efficiency.\n\u2022 Employ SHAP to explain the importance of spatial features, enabling transparent analysis.\n\u2022 Optimize spatial configurations through CFXs, proposing minimal changes (e.g., building heights and distances) without requiring global redesigns.\nThis research makes several key contributions to urban planning and design. It introduces a novel AI-based framework that integrates SHAP and CFXs to optimize SVF and visibility, addressing gaps in traditional methods. By enabling incremental optimizations, it reduces computational costs and supports data-driven decision-making. Tested in Tehran's diverse urban configurations, the framework demonstrates its flexibility, scalability, and generalizability across different urban contexts. It establishes a new standard for balancing built and open environments, showing how AI techniques can inform urban retrofitting and design flexibility.\nThe paper is organized as follows: Section 2 reviews prior research; Section 3 outlines methodology; Section 4 discusses findings; and Section 5 concludes with planning implications."}, {"title": "2. Literature review", "content": "Urban parks are essential for enhancing health, quality of life, and urban aesthetics while mitigating negative impacts like UHIs and pollution (Chen et al., 2012). Several studies have explored how parks contribute to physical and mental well-being through recreation and social interaction (Chiesura, 2004; Luymes and Tamminga, 1995). However, the usability and functionality of parks are not solely determined by their internal layouts but also by their spatial relationships with surrounding buildings.\nBuilding density, height, and spatial arrangements have been shown to influence safety, accessibility, and comfort (Stamps, 1999; Kaplan and Kaplan, 1989). For instance, Kothencz and Blaschke (2017) demonstrated that building density impacts perceptions of accessibility and safety. Despite these findings, most studies analyze these factors in isolation, failing to consider their interactions in shaping visibility and openness within open spaces. While some research investigates the effects of vegetation, spatial enclosure, and layout on safety and comfort (Jim and Chen 2006; Sezavar et al.2023), relatively few studies focus on the specific influence of building height and density on SVF and visibility-key factors that directly impact light exposure, perceived openness, and user safety (Lyu et al., 2019; Miao et al., 2020).\nSVF, first introduced by Oke (1981), evaluates thermal comfort, microclimates, and solar exposure (Lyu et al.,2019; Wang and Akbari, 2014). While traditional methods like mathematical models and satellite imagery (Watson and Johnson, 1987; Chang et al., 2020; Shams Amiri et al., 2023) are reliable, they often lack scalability and computational efficiency for larger urban scenarios. Existing approaches to optimizing SVF, such as parametric modeling and simulation-based methods (Geng et al. 2024; Xu et al., 2019), frequently rely on global optimization strategies that require large-scale redesigns of urban configurations. These methods are computationally intensive and less suitable for retrofitting existing spaces or making localized adjustments.\nOptimization techniques, particularly GAs and their variants, such as NSGA-II, have been widely used to explore urban design alternatives and optimize spatial configurations (Saad and Araji, 2021). Tools like Galapagos and Octopus leverage these algorithms to generate design solutions (Jiaweiyao et al., 2021). However, their reliance on global search methods and high computational costs often limit their practicality, especially for localized adjustments (Toutou 2018; Xu et al., 2019). Although problem decomposition methods have been proposed to improve computational efficiency and scalability (Talami et al., 2020) their ability to handle localized interventions in urban optimization remains underexplored. While NSGA-II effectively diversifies solutions and improves convergence speed (Liu et al., 2023), its time-intensive computational process restricts flexibility in applications requiring rapid and targeted adjustments (Saad and Araji, 2021).\nTo overcome these limitations, recent advances in MLMs and Explainable AI techniques offer new pathways for scalable and interpretable optimization. MLMs reduce computational processing times while maintaining accuracy, making them suitable for spatial metric analysis (Slack et al., 2020). Tools like SHAP highlight influential features in predicting metrics such as energy consumption (Dinmohammadi et al., 2023; Sun et al., 2022), thermal comfort (Zhang et al., 2021; Yang et al., 2022), and UHI (Yu et al., 2020; McCarty et al., 2021), as well as in the development of tools for building performance analysis (Eshraghi et al., 2024; Shen and Pan, 2023). However, SHAP focuses on interpretation rather than suggesting design changes, limiting its application to optimization tasks.\nTo complement SHAP, CFXs propose actionable modifications for improving spatial metrics. CFXs, widely used in economics and medicine (Tsirtsis and Gomez-rodriguez, 2020; Regenwetter et al., 2023), offer potential in urban planning for optimizing spatial metrics by providing actionable recommendations. Unlike global search algorithms, which propose complete redesigns, CFXs deliver incremental changes, such as modifying building heights or distances, making them practical for both new developments and retrofitting existing layouts. This capability is particularly useful in urban contexts, where flexibility and minimal disruption are often priorities."}, {"title": "3. Method", "content": "The research methodology comprises four phases: (1) Performance Simulation, (2) Building the Predictive Models, (3) Feature Importance Assessment, (4) CFXs for Scenario-specific Feature Evaluation, and (5) Validation by Grasshopper and GA optimization through the Galapagos plug-in (Figure 1). The subsequent sections detail each phase.\n3.1. Development of urban setting scenarios\nDue to variations in building heights and street widths, a series of urban blocks were developed following the typical configuration observed in Tehran, Iran, using Rhino, Grasshopper, and plugins like Ladybug, Dragonfly, and Honeybee 1.6.0. The modeling, performed on a regular grid, featured buildings ranging from 3 to 10 floors, each 3.5 meters high. The minimum urban block area was set at 1 hectare (100x100 meters) with street widths of 6 and 12 meters, consistent with Tehran's master plan. Divisions along the X and Y axes generated blocks with 6 to 24 parcels, each containing two buildings or a park. Building coverage ratios were set at 60% and 45%, with a fixed WWR of 40% on both north and south facades. Orientations were set at 40, -40, and 0 degrees, aligning with Tehran's layout, and green space ratios were 20% and 40%. In addition, the research was conducted with a constant Floor Area Ratio (FAR) of 4.5 and 6.5.\nAfter modeling each urban block, the heights and distances of neighboring buildings surrounding parks in eight directions were recorded to analyze their individual effects on SVF and visibility. By treating height and distance as separate variables, the study aimed to isolate their distinct impacts on environmental performance, allowing for a more precise understanding of how each factor influences SVF and visibility independently. While these variables could interact, separating them provides valuable insights into their unique contributions, which might be obscured if analyzed together. To solely assess the impact of building adjacencies, it was assumed that there were no trees or vegetation influencing SVF or visibility. This controlled approach aligns with the hypothesis of this study, which focuses exclusively on the spatial arrangement of built structures. Incorporating vegetation would add complexity, increasing the number of solutions and potentially complicating the algorithm's testing process. With these defined input variables, the tool generated 1152 urban blocks randomly.\n3.2. Prediction models\nAfter modeling and preparing the dataset, the study evaluates five MLMs\u2014CatBoost, XGBoost (Extreme Gradient Boosting), Support Vector Machine (SVM), K-Nearest Neighbors (KNN), and Artificial Neural Network (ANN)\u2014to predict spatial metrics. These algorithms were selected for their diverse strengths in predictive modeling. CatBoost(Banik and Biswas, 2023) handles categorical features efficiently through ordered boosting. XGBoost(Mohammadiziazi and Bilec, 2020) is optimized for speed and performance using decision tree ensembles. KNN(Singaravel, 2020) classifies data based on proximity to neighboring points, making it effective for certain datasets. SVM(Drucker et al., 1997) excels at defining hyperplanes for complex decision boundaries, while ANN (Ali et al., 2020) is well-suited for learning intricate patterns in highly complex tasks.\nSVF, which measures sky openness from specific points, is critical for environmental and climatic assessments. Its continuous nature makes regression modeling ideal for capturing variations, providing detailed insights into sunlight exposure and thermal comfort. In contrast, visibility influences human perception and space utilization, making classification more suitable for intuitive analysis. Based on simulation results, visibility is categorized into three levels\u2013Level 0 (30-50%), Level 1 (50\u201375%), and Level 2 (75\u2013100%)\u2014to enhance interpretability and decision-making. This dual approach (1) Aligns each metric's analysis with urban planning needs, maximizing relevance and utility, (2) Improves result clarity, ensuring outputs are accessible for practical applications, and (3) Utilizes SHAP and CFXs across regression and classification models to analyze feature importance and performance.\nFollowing model selection, the dataset is split into 80% training and 20% testing to validate accuracy and performance. Table 1 outlines the MLMs and their evaluation parameters.\nEvaluation indicators: Evaluation metrics are essential for assessing the performance of MLMs in predicting target outcomes. In this study, MLMs are evaluated based on their ability to predict visibility (classification) and SVF (regression) accurately. For visibility, Accuracy and F1-Score are used: Accuracy measures the proportion of correct predictions, indicating overall model effectiveness, and F1-Score combines precision and recall, offering a nuanced view by balancing the model's ability to correctly identify relevant instances. For SVF, regression metrics include R2, a measure of the explained variance; MSE (Mean Squared Error), which measures the average squared difference between predicted and actual values; and MAE (Mean Absolute Error), which computes the average absolute difference between predicted and actual values.\n3.3. Significance of features\nSHAP is used to investigate relationships between input features and target variables, providing interpretable insights by estimating feature contributions. The complexity of MLMs, often seen as \"black boxes,\" poses challenges for domain experts during decision-making process (Doshi-Velez and Kim, 2017). The lack of transparency in these models can undermine users' ability to trust and understand the results (Chen et al., 2023). To address this, post hoc explanation techniques like SHAP are applied for interpretability and transparency.\nSHAP, based on game theory, calculates Shapley values to assess feature contributions and interactions, offering a comprehensive perspective on their importance (Slack et al., 2020). It is preferred over traditional methods like gain or split count due to its fairness, stability, and ability to explain individual predictions. By ranking feature contributions clearly, SHAP reveals patterns in complex models and aids experts in making informed decisions (Markarian et al., 2024). SHAP calculates feature importance using the definitions shown in Equation 1 (Nourkojouri et al., 2021):\n$\\Phi_i(p) = \\sum_{S \\subseteq N \\setminus \\{i\\}} \\frac{|S|!(n- |S|-1)!}{n!} [p (S \\cup \\{i\\}) - p(S)]$\n\u2022 N: A set containing n features\n\u2022 S: A subset excluding the specific feature i for which $\\phi_i$ is being determined\n\u2022 SU{i}: A subset of features that includes the features in S plus the feature i\n\u2022 S\u2286N\\{i}: All possible subsets S derived from the complete set N, excluding the feature i\n3.4. Model Validation and Computational Efficiency Analysis\nUnlike SHAP, which explains feature contributions, CFXs methodology using the KD (KD-Tree) optimization approach is designed to efficiently generate minimal, actionable changes in input parameters to achieve specific objectives (Alfeo et al., 2023), such as increasing SVF or enhancing visibility. The process begins by defining the objective and organizing the parameter space (e.g., building height, distance, orientation) using a KD-tree, which divides the space to quickly search for and locate the closest feasible point that meets the objective, minimizing the computational time. The algorithm evaluates which features are most influential, prioritizing these to achieve the desired counterfactual outcome. By leveraging the efficiency of the KD-tree, it avoids exhaustive searching and focuses on finding the nearest valid scenario that adheres to all constraints, such as zoning regulations or orientations.\nOnce a feasible scenario is identified, the algorithm refines it to ensure minimal and practical adjustments, such as small increases in building height or slight distance changes. The KD-tree structure allows rapid evaluation until the optimal solution is found, providing detailed recommendations and showing the impact of changes. This approach is particularly effective for scenarios that require rapid evaluation and adaptation of urban configurations, offering a significant efficiency advantage over iterative methods like GA.\nIn this study, CFXs are tested on both classification and regression models to ensure robustness across different prediction scenarios. Together, SHAP and CFXs enhance model interpretability, supporting transparent decision-making and practical guidelines for optimizing SVF and visibility in urban design."}, {"title": "4. Results and discussion", "content": "This section presents the study's findings in four parts. First", "models.\nSVF": "Table 2 presents evaluation indicators of the five regression models for predicting SVF. Analyzing the R\u00b2 values", "dataset.\nVisibility": "When evaluating MLMs for the three-class classification task", "SVF": "The SHAP plot analysis for SVF in Figure 2 highlights the multifaceted influences of urban features. The broad distribution of the park area indicates its crucial role in increasing SVF", "visibility": "In the SHAP plot for visibility (Figure 3)", "goals": "increasing the SVF percentage and elevating the visibility class by one level. Figure 4 shows the main scenarios for SVF and visibility. Targeted space is the park at the center of the each block.\nHumans often consider alternative outcomes by modifying controllable"}, {"SVF": "Table 4 presents a comparative analysis between the original characteristics of an urban block and different strategies (S1 to S5) proposed by CFX models to achieve specific SVF goals. Each strategy provides solutions for altering building heights and distances to enhance the SVF of the urban block. The \"main\" column displays the baseline measurements", "visibility": "These changes in visibility are aimed at upgrading the visibility class from 0 to 1 across all strategies (Table 5). Notably", "Evaluation": "The GA was used to benchmark the optimization time in comparison to the CFXs approach for improving SVF and visibility across the urban configurations. The objective was to assess which method achieves the desired results in the shortest time while maintaining accuracy.\nThe time comparison between the GA and CFX approaches reveals significant differences in computational efficiency. For the GA", "Validation": "Grasshopper simulations were conducted to validate the CFX recommendations for each of the 10 urban configurations. The accuracy of the"}]}