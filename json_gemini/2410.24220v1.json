{"title": "Bridging Geometric States via Geometric Diffusion Bridge", "authors": ["Shengjie Luo", "Yixian Xu", "Di He", "Shuxin Zheng", "Tie-Yan Liu", "Liwei Wang"], "abstract": "The accurate prediction of geometric state evolution in complex systems is critical for advancing scientific domains such as quantum chemistry and material modeling. Traditional experimental and computational methods face challenges in terms of environmental constraints and computational demands, while current deep learning approaches still fall short in terms of precision and generality. In this work, we introduce the Geometric Diffusion Bridge (GDB), a novel generative modeling framework that accurately bridges initial and target geometric states. GDB leverages a probabilistic approach to evolve geometric state distributions, employing an equivariant diffusion bridge derived by a modified version of Doob's h-transform for connecting geometric states. This tailored diffusion process is anchored by initial and target geometric states as fixed endpoints and governed by equivariant transition kernels. Moreover, trajectory data can be seamlessly leveraged in our GDB framework by using a chain of equivariant diffusion bridges, providing a more detailed and accurate characterization of evolution dynamics. Theoretically, we conduct a thorough examination to confirm our framework's ability to preserve joint distributions of geometric states and capability to completely model the underlying dynamics inducing trajectory distributions with negligible error. Experimental evaluations across various real-world scenarios show that GDB surpasses existing state-of-the-art approaches, opening up a new pathway for accurately bridging geometric states and tackling crucial scientific challenges with improved accuracy and applicability.", "sections": [{"title": "1 Introduction", "content": "Predicting the evolution of the geometric state of a system is essential across various scientific domains [46, 88, 55, 17, 20, 101], offering valuable insights into difficult tasks such as drug discovery [25, 29], reaction modeling [9, 24], and catalyst analysis [13, 105]. Despite its critical importance, accurately predicting future geometric states of interest is challenging. Experimental approaches often face obstacles due to strict environmental requirements and physical limits of instruments [102, 3, 69]. Computational approaches seek to solve the problem by simulating the dynamics based on underlying equations [81, 88]. Though providing greater flexibility, such calculations are typically driven by first-principle methods or empirical laws, either requiring extensive computational costs [68] or sacrificing accuracy [40]."}, {"title": "2 Background", "content": ""}, {"title": "2.1 Problem Definition", "content": "Our task of interest is to capture the evolution of geometric states, i.e., predicting future states from initial states. Formally, let  $S$ denote a system consisting of a set of objects located in the"}, {"title": "2.2 Diffusion Models", "content": "Diffusion models [95, 37, 99] have emerged as the state-of-the-art generative modeling approaches across various domains [83, 85, 47, 115, 113, 117]. The main idea of this method is to construct a diffusion process that maps data to noise, and train models to reverse such process by using a tractable objective.\nFormally, to model the data distribution  $q_{data}(X)$, where  $X \\in \\mathbb{R}^d$, we construct a diffusion process  $(X_t)_{t\\in[0,T]}$, which is represented as a sequence of random variables indexed by time steps. We set  $X_0 \\sim q_{data}(X)$ and  $X_T \\sim p_{prior}(X)$, where  $p_{prior}(X)$ has a tractable form to generate samples efficiently, e.g. standard Gaussian distribution. Mathematically, we model  $(X_t)_{t\\in[0,T]}$ as the solution to the following stochastic differential equation (SDE):\n\n$dX_t = f(X_t, t)dt + \\sigma(t)dB_t,$\n\nwhere  $f(\\cdot,\\cdot) : \\mathbb{R}^d \\times [0,T] \\rightarrow \\mathbb{R}^d$ is a vector-valued function called the drift coefficient,  $\\sigma(\\cdot) : [0, T] \\rightarrow \\mathbb{R}$ is a scalar function known as the diffusion coefficient, and  $(B_t)_{t\\in[0,T]}$ is the standard Wiener process (a.k.a., Brownian motion) [26]. We hereafter denote by  $p_t(X)$ the marginal distribution of  $X_t$. Let  $p(x', t'|x, t)$ denote the transition density function such that  $P(X_{t'} \\in A|X_t = x) = \\int_A p(x',t'|x,t)dx'$ for any Borel set A. By simulating this diffusion process forward in time, the distribution of  $X_T$ will become  $p_{prior}(X)$ at the final time  $T$. In the literature, there exist various design choices of the SDE formulation in Eqn. (1) such that it transports the data distribution into the fixed prior distribution [98, 37, 99, 72, 97, 47].\nIn order to sample  $X_0 \\sim p_0(X) := q_{data}(X)$, an intriguing fact can be leveraged: the reverse of a diffusion process is also a diffusion process [2]. This reverse process runs backward in time and can be formulated by the following time-reversal SDE:\n\n$dX_t = [f(X_t, t) - \\sigma^2(t)\\nabla_{x_t} \\log p_t(X_t)] dt + \\sigma(t)dB_t,$\n\nwhere  $\\nabla_{x_t} \\log p_t(X)$ denote the score of the marginal distribution at time  $t$. If the score is known for all time, then we can derive the reverse diffusion process from Eqn. (2), sample from  $p_{prior}(X)$, and simulate this process to generate samples from the data distribution  $q_{data}(X)$. In particular, the score  $\\nabla_{x} \\log p_t(X)$ can be estimated by training a parameterized model  $s_\\theta(X, t)$ with a denoising score matching objective [98, 97]. In theory, the minimizer of this objective approximates the ground-truth score [99] and this objective is tractable."}, {"title": "3 Geometric Diffusion Bridge", "content": "As discussed in the introduction, effectively capturing the evolution of geometric states is crucial, for which three desiderata should be carefully considered:"}, {"title": "3.1 Equivariant Diffusion Bridge", "content": "Our key design lies in the construction of equivariant diffusion bridge, a tailored diffusion process  $(R_t)_{t\\in[0,T]}$ for bridging initial states  $R_0 \\sim q_{data}(R_{t_0})$ and target states  $R_T \\sim q_{data}(R_{t_1}|R_{t_0})$, completely preserving coupling of geometric states and satisfying symmetry constraints. Firstly, we investigate necessary conditions for a diffusion process on geometric states to meet the symmetric constraints:\nProposition 3.1. Let  $\\mathbb{R}$ denote the space of geometric states and  $f_R(\\cdot,\\cdot) : \\mathbb{R} \\times [0,T] \\rightarrow \\mathbb{R}$ denote the drift coefficient on  $\\mathbb{R}$. Let  $(W_t)_{t\\in [0,T]}$ denote the Wiener process on  $\\mathbb{R}$. Given an SDE on geometric states  $dR_t = f_R(R_t,t)dt + \\sigma(t)dW_t, R^0 \\sim q(R^0)$, its transition density  $p_R(z',t'|z,t), z, z' \\in \\mathbb{R}$ is SE(3)-equivariant, i.e.,  $p_R(R_{t'}, t'|R_t,t) = p_R(\\rho_{\\mathbb{R}}(g)[R_{t'}], t'|\\rho_{\\mathbb{R}}(g)[R_{t}],t),\\forall g \\in SE(3),0 < t,t' < T$, if these conditions are satisfied: (1)  $q(R^0)$ is SE(3)-invariant; (2)  $f_R(\\cdot, t)$ is SO(3)-equivariant and T(3)-invariant; (3) the transition density of  $(W^t)_{t\\in[0,T]}$ is SE(3)-equivariant.\nUsing Proposition 3.1, we can obtain a diffusion process that respect symmetry constraints by prop- erly considering conditions for key components. Next, we modify a useful tool in probability theory called Doob's h-transform [82, 81, 16], which plays an essential role in the construction of our equivariant diffusion bridge for preserving coupling of geometric states:\nProposition 3.2. Let  $p_R(z',t'|z,t)$ be the transition density of the SDE in Proposition 3.1. Let  $h_R(\\cdot,\\cdot) : \\mathbb{R} \\times [0,T] \\rightarrow \\mathbb{R}_{>0}$ be a smooth function satisfying: (1)  $h_R(\\cdot, t)$ is SE(3)-invariant; (2)  $h_R(z,t) = \\int p_R(z',t'|z,t)h_R(z',t')dz'$. Then we can derive the following  $h_R$-transformed SDE on geometric states:\n\n$dR_t = [f_R(R_t, t) + \\sigma^2(t)\\nabla_{R_t} \\log h_R(R_t,t)] dt + \\sigma(t)dW_t,$\n\nwith SE(3)-equivariant transition density  $p_R^h(z', t'|z, t)$ equals to  $p_R(z', t'|z, t)\\frac{h_R(z',t')}{h_R(z,t)}$.\nAccording to Theorem 3.3, given an initial geometric state  $R_{t_0}$, we can predict tar- get geometric states  $R_{t_1}$ by simulating the equivariant diffusion bridge  $(R^t)_{t\\in[0,T]}$ from  $R^0 \\sim R_{t_0}$, which arrives at  $R^T \\sim q_{data}(R_{t_1}|R_{t_0})$. However, the score  $E_{q_R(R_T,T|R_t,t;R_{0,0})} [\\nabla_{R_t} \\log p_R(R_T, T|R_t, t)|R_0, R_t]$ in Eqn. (4) is not tractable in general. Inspired by the score matching objective in diffusion models [99], we use a parameterized model  $v_\\theta(R_t, t; R^0)$ to estimate the score by using the following training objective:\n\n$\\mathcal{L}(\\theta) = \\mathbb{E}_{(z_0, z_1) \\sim q_{data}(R_{t_0}, R_{t_1}), R_t \\sim q_r(R_t, t|z_1, T; z_0, 0)} \\lambda(t) ||v_\\theta(R_t, t; z_0) - \\nabla_{R_t} \\log p_r(z_1, T|R_t, t)||^2,$\n\nwhere  $t \\sim U(0,T)$ (the uniform distribution on  $[0,T]$), and  $\\lambda(\\cdot) : [0,T] \\rightarrow \\mathbb{R}_{\\ge 0}$ is a positive weighting function. Theoretically, we prove that the minimizer of Eqn. (5) approximates the ground- truth score (see Appendix B.5 for more details). Moreover, this objective is tractable because the transition density  $p_r$ and  $q_r$ can be designed to have simple and explicit forms such as Gaussian, which we will elaborate on in Sec. 3.3."}, {"title": "3.2 Chain of Equivariant Diffusion Bridges for Leveraging Trajectory Guidance", "content": "In this subsection, we elaborate on how to leverage trajectories of geometric states as a fine-grained guidance in our framework. Let  $(\\widetilde{R}^i)_{i\\in[N]}$ denote a trajectory of  $N + 1$ geometric states and  $q_{traj}(\\widetilde{R}^0, ..., \\widetilde{R}^N)$ denote the joint probability density function of geometric states in a trajectory. In practice, the markov property of trajectories typically holds [109, 78]. Under this assumption,  $q_{traj}(\\widetilde{R}^0, ..., \\widetilde{R}^N)$ can be equivalently reformulated into  $q_{traj}(\\widetilde{R}^0) \\prod_{i=1}^N q_{traj}(\\widetilde{R}^i|\\widetilde{R}^{i-1})$ by the chain rule of probability. If  $q_{traj}(\\widetilde{R}^i|\\widetilde{R}^{i-1})$ can be well modeled, we can capture the distribution of trajectories of geometric states completely.\nAccording to Theorem 3.3, given  $\\widetilde{R}^0 \\sim q_{traj}(\\widetilde{R}^0)$, an equivariant diffusion bridge  $(R^t)_{t\\in [0,T]}$ can be constructed to model the joint distribution  $q_{traj}(\\widetilde{R}^0, \\widetilde{R}^1)$ and hence  $q_{traj}(\\widetilde{R}^1|\\widetilde{R}^0)$ is preserved. Therefore, if we construct a series of interconnected equivariant diffusion bridges, the distribution of trajectories can be modeled:\nTheorem 3.4 (Chain of Equivariant Diffusion Bridges). Let  $\\{(R^i_t)_{t\\in[0,T]}\\}_{i\\in[N-1]}$ denote a series of  $N$ equivaraint diffusion bridges defined in Theorem 3.3. For the  $i$-th bridge  $(R^i_t)_{t\\in[0,T]}$, if we set\n(1)  $h_R(z, t; z_0) = \\int p_R(z', T|z, t) \\frac{q^i_{data}(z'|z_0)}{p_R(z', T; z_0)} dz'$; (2)  $\\widetilde{R}^0 \\sim q_{traj}(\\widetilde{R}^0), \\widetilde{R}^i = \\widetilde{R}^{i-1},\\forall 0 < i < N$,\nthen the joint distribution  $q(\\widetilde{R}^0, R_1, \\widetilde{R}^1, ..., \\widetilde{R}^{N-1})$ induced by  $\\{(R^i_t)_{t\\in[0,T]}\\}_{i\\in[N-1]}$ equals to  $q_{traj}(\\widetilde{R}^0, ..., \\widetilde{R}^N)$. We call this process a chain of equivariant diffusion bridges."}, {"title": "3.3 Practical Implementation", "content": "In this subsection, we elaborate on how to practically implement our framework. According to Eqn. (5), it is necessary to carefully design (1) tractable distribution  $q_r(R_t, t|z_1, T; z_0, 0)$ for sampling  $R_t$; (2) closed-form matching objective  $\\nabla_{R_t} \\log p_r(z_1, T|R_t, t)$.\nMatching objective. Inspired by diffusion models that use Gaussian transition kernels for tractable computation, we design the SDE on geometric states in Proposition 3.1 to be:\n\n$dR_t = \\sigma dW_t$, with transition density  $p_r(z',t'|z,t) = N(z_0, \\sigma^2(t' - t)I)$\n\nThe explicit form of the objective can be directly calculated, i.e.,  $\\nabla_{R_t} \\log p_r(z_1,T|R_t,t) = \\frac{z_1-R_t}{\\sigma^2(T-t)}$.\nSampling distribution. According to Theorem 3.3, the transition density  $q_r(R_t, t|z_1, T; z_0, 0)$ can be calculated by using the Doob's h-transform in Proposition 3.2, i.e.,  $q_r(R_t, t|z_1, T; z_0, 0) = p_R(R_t, t| z_1, T) \\frac{h_R(R_t,t;z_0)}{h_R(z_1,T;z_0)}$. Moreover,  $h_R$ is determined by  $q_{data}$ and  $p_r$, which is already specified in Eqn. (7). Therefore, we can also calculate  $q_r(R_t, t|z_1, T; z_0, 0) = N(\\frac{z_t\\sigma^2(T-t)+z_0}{\\sigma^2T}, \\frac{\\sigma^2t(T-t)}{T}I)$.\nSymmetry constraints. In proposition 3.1, we have several conditions that should be satisfied to meet the symmetry constraints. Firstly, since a parameterized model  $v_\\theta(R_t, t; R^0)$ is used to estimate the score of our equivariant diffusion bridge, it should be SO(3)-equivariant and T(3)- invariant. Besides, we follow [50, 115] to consider CoM-free systems: given  $R = \\{r_1, ..., r_n\\}$, we define  $\\overline{r} = \\frac{1}{n}\\sum_{i=1}^n r_i$ and the CoM-free version of  $R = \\{r_1 - \\overline{r}, ..., r_n - \\overline{r}\\}$. To sample from  $N(z_0, \\sigma^2I)$ with  $z_0 \\in \\mathbb{R}$ consisting of  $n$ objects, we (1) sample  $\\epsilon = \\{\\epsilon_i\\}_{i=1}^n$ by i.i.d. drawing  $\\epsilon_i \\sim N(0, I^3)$; (2) calculate the CoM-free  $\\epsilon'$ of  $\\epsilon$; (3) obtain  $z_0 + \\sigma\\epsilon'$.\nTrajectory guidance. According to Eqn. (6), both  $p_r$ and  $q_r$ for all  $i\\in[N-1]$ should be determined. Similarly, we set  $p_r(z_{i+1}, T|R_{t'}, t')=N(R_{t'}, \\sigma^2(T-t')I)$, which further induces\n$q_R (R_{t'}, t'|z_{i+1}, T; z_i, 0) = N(\\frac{z_{i+1}T+z_it'}{T}, \\frac{\\sigma^2t' (T-t')}{T}I)$.\nCombining all the above design choices, we have the following algorithms for training our Geo- metric Diffusion Bridge (Alg. 3) and leveraging trajectory guidance if available (Alg. 4). After the"}, {"title": "4 Experiments", "content": "In this section, we empirically study the effectiveness of our Geometric Diffusion Bridge on crucial real-world challenges requiring bridging geometric states. In particular, we carefully design several experiments covering different types of data, scales and scenarios, as shown in Table 2. Due to space limits, we present more details in Appendix D."}, {"title": "4.1 Equilibrium State Prediction", "content": "Task. Equilibrium states typically represent local minima on the Born-Oppenheimer potential energy surface of a molecular system [54], which correspond to its most stable geometric state and play an essential role in determining its properties in various aspects [4, 21]. In this task, our goal is to accurately predict the equilibrium state from the initial geometric state of a molecular system.\nDataset. Two popular datasets are used: (1) QM9 [79] is a medium-scale dataset that has been widely used for molecular modeling, consisting of 130,000 organic molecules. In convention, 110k, 10k, and 11k molecules are used for train/valid/test sets respectively; (2) Molecule3D [116] is a large-scale dataset curated from the PubChemQC project [67, 71], consisting of 3,899,647 molecules in total and its train/valid/test splitting ratio is 6:2:2. In particular, both random and scaffold splitting methods are adopted to thoroughly evaluate the in-distribution and out-of-distribution performance. For each molecule, an initial geometric state is generated by using fast and coarse force field [73, 52] and geometry optimization is conducted to obtain DFT-calculated equilibrium geometric structure.\nSetting. In this task, we parameterize  $v_\\theta(R_t, t; R^0)$ by extending a Graph-Transformer based equivariant network [92, 63] to encode both time steps and initial geometric states as conditions. For inference, we use 10 time steps with the Euler solver [12]. Following [111], we choose several strong baselines for a comprehensive comparison, and use three metrics for measuring the error be- tween predicted target states and ground-truth states: C-RMSD, D-MAE and D-RMSE. The detailed descriptions of the baselines, evaluation metrics and training settings are presented in Appendix D.1.\nResults. Results on QM9 and Molecule3D are shown in Table 3 and 4 respectively. It can be eas- ily seen that our GDB framework consistently surpasses all baselines by a significantly large margin"}, {"title": "4.2 Structure Relaxation", "content": "Task. Catalyst discovery is crucial for various applications. Adsorbate candidates are placed on catalyst surfaces and evolve through structure relaxation to adsorption states, in which the adsorption structures can be determined for measuring catalyst activity and selectivity. Our goal is thus to accurately predict adsorption states from initial states of adsorbate-catalyst complexes.\nDataset. We adopt Open Catalyst 2022 (OC22) dataset [105], which has great significance for the development of Oxygen Evolution Reaction (OER) catalysts. Each data is in the form of the adsorbate-catalyst complex. Both initial and adsorption states with trajectories connecting them are provided. The training set consists of 45,890 catalyst-adsorbate complexes. To better evaluate the model's performance, the validation and test sets consider the in-distribution (ID) and out-of-distribution (OOD) settings which use unseen catalysts, containing approximately 2,624 and 2,780 complexes respectively.\nSetting. Following [105], we use the Average Distance within Threshold (ADwT) as the evaluation metric, which reflects the percentage of structures with an atom position MAE below thresholds. We parameterize  $v_\\theta(R_t, t; R^0)$ by using GemNet-OC [34], which also serves as a"}, {"title": "5 Related Works", "content": "Direct Prediction. One line of approach for bridging geometric states is direct prediction, i.e., training a model to directly predict target geometric states given initial states as input. Models that carefully respect symmetry constraints such as the equivariance to 3D rotations and translations are typically used, which are called Geometric Equivariant Networks [11, 36, 120, 27]. Different techniques have been explored to encode such priors, which mainly include vector operations such as scalar and vector product [35, 87, 89, 41, 103, 14], e.g., the scalar-vector product used in EGNN [87], and tensor product based operations [104, 31, 8, 57, 64]. Despite its simplicity and efficiency, direct prediction requires encoding the iterative evolution of geometric states into a single-step prediction model, which lacks the ability to capture the underlying dynamics and cannot leverage trajectories of geometric states.\nMachine Learning Force Field. Another line of approach is called machine learning force field (MLFF) [106, 5, 6, 70, 75, 58], which are trained to predict intermediate labels, such as the po-"}, {"title": "6 Conclusion", "content": "In this work, we introduce Geometric Diffusion Bridge (GDB), a general framework for bridging ge- ometric states through generative modeling. We leverage a modified version of Doob's h-transform to constructe an equivariant diffusion bridge for bridging initial and target geometric states. Trajec- tory data can further be seamlessly leveraged as guidance by using a chain of equivariant diffusion bridges, allowing complete modeling of trajectory data. Mathematically, we conduct a comprehen- sive theoretical analysis showing our framework's ability to preserve joint distributions of geometric states and capability to completely model the evolution dynamics. Empirical comparisons on dif- ferent settings show that our GDB significantly surpasses existing state-of-the-art approaches and ablation studies further underscore the necessity of several key designs in our framework. In the future, it is worth exploring better implementation strategies of our framework for enhanced perfor- mance, and applying our GDB to other critical challenges involving bringing geometric states."}, {"title": "Broader Impacts and Limitations", "content": "This work newly proposes a general framework to bridge geometric states, which has great signif- icance in various scientific domains. Our experimental results have also demonstrated considerable positive potential for various applications, such as catalyst discovery and molecule optimization, which can significantly contribute to the advancement of renewable energy processes and chemistry discovery. However, it is essential to acknowledge the potential negative impacts including the development of toxic drugs and materials. Thus, stringent measures should be implemented to mitigate these risks.\nThere also exist some limitations to our work. For the sake of generality, we do not experiment with advanced implementation strategies of training objectives and sampling algorithms, which leave room for further improvement. Besides, the employment of Transformer-based architec- tures may also limit the efficiency of our framework. This has also become a common issue in transformer-based diffusion models, which we have earmarked for future research."}]}