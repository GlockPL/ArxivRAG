{"title": "Leveraging Large Language Models as Knowledge-Driven Agents\nfor Reliable Retrosynthesis Planning", "authors": ["Qinyu Ma", "Yuhao Zhou", "Jianfeng Li"], "abstract": "Identifying reliable synthesis pathways in materials chemistry is a complex task, particularly in polymer science, due to\nthe intricate and often non-unique nomenclature of macromolecules. To address this challenge, we propose an agent\nsystem that integrates large language models (LLMs) and knowledge graphs (KGs). By leveraging LLMs' powerful\ncapabilities for extracting and recognizing chemical substance names, and storing the extracted data in a structured\nknowledge graph, our system fully automates the retrieval of relevant literatures, extraction of reaction data, database\nquerying, construction of retrosynthetic pathway trees, further expansion through the retrieval of additional literature\nand recommendation of optimal reaction pathways. A novel Multi-branched Reaction Pathway Search (MBRPS)\nalgorithm enables the exploration of all pathways, with a particular focus on multi-branched ones, helping LLMs\novercome weak reasoning in multi-branched paths. This work represents the first attempt to develop a fully automated\nretrosynthesis planning agent tailored specially for macromolecules powered by LLMs. Applied to polyimide synthesis,\nour new approach constructs a retrosynthetic pathway tree with hundreds of pathways and recommends optimized\nroutes, including both known and novel pathways, demonstrating its effectiveness and potential for broader applications.", "sections": [{"title": "1 Introduction", "content": "Retrosynthesis planning\u00b9 plays an important role in chemical en-\ngineering and chemistry research, offering a systematic approach\nto designing synthetic pathways for target compounds. By decon-\nstructing complex molecules into simpler precursors, retrosynthe-\nsis enables researchers to navigate the vast possibilities of chem-\nical transformations and efficiently plan synthesis routes. This\nprocess is also crucial for the advancement of material discovery,\nthe optimization of chemical production, and the support of inno-\nvative research across disciplines. Current methods for single-step\nchemical retrosynthesis analysis primarily include computational\napproaches such as density functional theory for precise calcu-\nlations2 and using deep learning models for prediction. Deep\nlearning-based prediction methods can be broadly categorized\ninto template-based approaches 3,4, which rely on predefined re-\naction templates for high precision but have limited applicability,\nand template-free approaches 5,6, which offer greater flexibility\nbut often sacrifice precision. However, these techniques primar-\nily focus on decomposing target compounds into one intermedi-\nate and multiple starting molecules, leaving more complex multi-\nintermediate pathways largely unexplored. Moreover, research\nefforts have predominantly focused on small molecules, with lim-\nited attention to macromolecules such as polymers and proteins.\nThe challenges in applying retrosynthesis planning to macro-\nmolecules are particularly noteworthy. Unlike small molecules,\nmacromolecules often lack extensive, well-documented reaction\ndatabases, making the use of deep learning models for prediction\ntricky. Moreover, the large number of atoms in macromolecu-\nlar systems, as well as the fact that chemical reactions are of-\nten influenced by complex interactions, make accurate calcula-\ntions challenging. Therefore, researchers are often required to\nbrowse a large amount of academic papers for retrosynthesis\nplanning of macromolecules. Unfortrunately, the extraction of re-\naction information from the literature and the construction of ret-\nrosynthetic pathways for macromolecules is further complicated\nby their complex and variable nomenclature, which makes tra-\nditional rule-based methods insufficient for accurately identify-\ning relevant reactions. For instance, the polymer widely known\nas \"polystyrene\" may also appear as \"Poly(1-phenylethylene)\"\nbased on structure-based naming or as \"Poly(vinylbenzene)\" and\n\"Poly(ethenylbenzene)\" under source-based conventions. To ad-\ndress these issues, more intelligent approaches are necessary.\nA promising solution lies in leveraging LLMs to ensure the consis-\ntency of polymer material names, thereby enabling the construc-\ntion of an entity-aligned knowledge graph to facilitate the au-\ntomated construction of retrosynthetic pathways. Despite the po-\ntential of this approach, no prior studies have investigated the in-\ntegration of LLMs and knowledge graphs specifically for retrosyn-\nthesis planning. While Bran et al. 10 previously utilized LLMs to\nautomate aspects of chemistry research, their work treated ret-\nrosynthesis planning as a supporting tool, relying on underlying\ndeep-learning methods for its implementation.\nOn the other hand, Large language models (LLMs) 11,12 have\nreshaped natural language processing with their human-like text\ngeneration, complex pattern recognition, and adaptability to\ntasks including translation, summarization, and question answer-\ning 13. Leveraging deep learning, they process vast amounts of\ntext data 14,15, proving invaluable for text mining 16,17, research\nplanning 10,18,19, and chemical applications 20. Despite these ad-\nvantages, LLMs face critical limitations. 21,22 Their probabilistic\nnature 23,24 and reliance on unverified data can lead to halluci-\nnations 25,26, while static datasets delay knowledge updates. 27\nThey also struggle with precise math, logic 28 and interpreting\nnon-textual data like molecular structures or reaction schemes. In\nretrosynthesis planning\u00b9, these limitations are particularly prob-\nlematic, as the process requires accurate multi-step reaction pre-\ndictions, real-time scientific knowledge, and the ability to assess"}, {"title": "2 Method", "content": "2.1 Automated Literature Retrieval\nThe workflow of the automated retrosynthesis planning agent\nis illustrated in Fig. 1. A demo video in SI is also provided,\nshowcasing the agent's ability to execute the entire workflow au-\ntonomously without any human intervention. The Agent first\nutilizes the Google Scholar API32 to retrieve relevant paper ti-\ntles based on predefined keywords. These titles are then used\nto download literature PDFs via web scraping. Text is extracted\nfrom the PDFs using PyMuPDF33. Following extraction, the data\nis cleaned by removing special characters and symbols to enhance\nreadability and ensure better comprehension by large language\nmodels (LLMs).\n2.2 Knowledge Graph Construction from Extracted Informa-\ntion\nOur agent is built upon the ChatGPT-40 API 34. By utilizing\nthis model, the agent employs prompt engineering 11, in-context\nlearning 35 and Chain-of-Thought (CoT) 36 to perform tasks in-\ncluding entity and relation extraction, knowledge graph construc-\ntion, and entity alignment (Fig. 2).\nIt processes the cleaned text and images to extract chemi-\ncal reactions, which are then output in a standardized format.\nThe extracted chemical reaction information includes the names\nof reactants and products, reaction temperature, pressure, cata-\nlysts, solvents, atmosphere, reaction duration, and yield. Lever-\naging ChatGPT-40's inherent proficiency in text comprehension\nand standardized output, these tasks are effectively accomplished\nwithout the need for fine-tuning in most cases. 17,37 However,\nthere are occasional instances where non-reactive reagents are\nincorrectly listed as reactants, even with the use of prompting to\nconstrain the model. We use the CoT technique to conduct a sec-\nondary verification to avoid this issue (See Section I of SI).\nBased on the model's structured outputs, the agent uses regu-\nlar expressions to extract entities and relationships. Specifically,\neach reactant and product is treated as an entity, while reaction\nconditions, numerical identifiers and yields are considered as re-\nlations, forming unidirectional edges from reactants to products.\nUltimately, the agent converts unstructured chemical reaction in-\nformation from literature into a structured knowledge graph for\nefficient information retrieval and expansion.\nAlthough prompt engineering and in-context learning can en-\nsure consistency in chemical substance names within a single pa-\nper, it is challenging to maintain consistency across multiple pa-\npers due to the input length limitations of LLMs. Therefore, the\nagent rechecks the knowledge graph to identify cases where dif-\nferent nodes represent the same substance. If such cases exist, the\nagent unifies them and updates the knowledge graph accordingly\n(See Section II of SI)."}, {"title": "2.3 Retrosynthetic Pathway Tree Construction and Expan-\nsion", "content": "Utilizing the constructed knowledge graph, the agent employs a\nMemoized Depth-first Search (MDFS) algorithm 29\u201331 to build the\nretrosynthetic pathway tree, with the target product as the root\nand leaf nodes representing commercially available compounds.\nThe goal of constructing a retrosynthetic pathway tree is to\ntrace the reaction pathway step by step from the target substance\nback to the initial reactants. Specifically, each node in the ret-\nrosynthetic pathway tree represents a chemical substance, gen-\nerated through a specific reaction. The construction of retrosyn-\nthetic tree follows a set of rules:\n1. If the target substance is already present in the accessible\nset of initial reactants, it is marked as a leaf node, requiring no\nfurther expansion.\n2. If the substance can be synthesized through any known re-\nactions, it is considered expandable; otherwise, if it cannot be\nsynthesized, it is considered non-expandable.\nFor expandable nodes, the MDFS algorithm traverses all reac-\ntions producing the substance, retrieves reactants one by one, and\nadds them as child nodes to the current node. To prevent cycles,\nthe algorithm discards a path if the new node already exists in\nthe set of parent nodes. This process is carried out recursively,\nensuring the validity of each route. Ultimately, only valid reaction\npathways are retained, while for nodes that cannot be further ex-\npanded or form a cycle, the corresponding reaction pathways will\nbe completely removed, ensuring that the final tree structure ac-\ncurately reflects the synthesis route from the target substance to\nthe initial reactants.\nDuring the recursive tree construction, the agent queries\ndatabases such as eMolecules 38 and PubChem 39, along with ad-\nditional commonly used polymers, to verify whether the current\nnode represents a commonly uses substance. Additionally, the\nagent uses RDKit 40 to convert the names of small molecules into\nstandardized SMILES strings for database matching. If a node\ncorresponds to a commonly used substance, it is designated as\na leaf node, halting further expansion. To further enhance the\nefficiency of tree construction, a memory-augmented approach\nis employed, where the results of database queries, regarding\nwhether a node substance corresponds to commonly used mate-\nrials, are stored in a cache. This strategy eliminates the need for\nrepeated database lookups of the same substance, significantly\nreducing computational overhead.\nIt is worth noting that not all reactants in a single paper are\ntypically commercially available. Therefore, it is necessary to fur-\nther investigate the literature on the synthesis of intermediate re-\nactants, until commercially available compounds can be used to\nsynthesize the intermediate. Similarly, during retrosynthesis tree\nconstruction, if a node cannot be further expanded to a leaf node,\nthe agent will query the relevant literature on the synthesis of the\nintermediate corresponding to that node, extract relevant chemi-\ncal reactions from it, and add them to the knowledge graph, thus\nhelping the node successfully expand to a leaf node, enabling the\nconstruction of a complete reaction pathway. Ultimately, an ex-\npanded retrosynthetic pathway tree with the target substance as"}, {"title": "2.4 Chemical Reaction Pathways Search and Recommenda-\ntion", "content": "Upon constructing the retrosynthetic pathway tree for the target\nproduct, the agent employs the Multi-branched Reaction Pathway\nSearch Algorithm (MBRPS) (Algorithm 1), to identify all valid\nchemical reaction pathways, as illustrated in Fig. 3. This algo-\nrithm is specially designed for multi-branched reaction pathways,\nwhich are common in practical retrosynthesis planning (see Dis-\ncussion section for more details). Each reaction pathway iden-\ntified provides all the reactions required to synthesize the tar-\nget product from commercially available compounds, with vali-\ndation from a database. Specifically, a product can be synthesized\nthrough various reactions with corresponding reactants, each rep-\nresenting a node in the retrosynthetic pathway tree. For nodes\nassociated with the same reaction index, they form an \"AND\" re-\nlationship, meaning that all child nodes with the same index must\nbe included to synthesize the target compound. On the other\nhand, nodes with different reaction indices represent an \"OR\" re-\nlationship, indicating that the target compound can be synthe-\nsized by selecting one of several possible reactions. Based on\nthis relationship, we use a recursive method to obtain all reaction\npaths for each node. This method identifies all valid synthesis\nroutes, including multi-branched ones, helping LLMs overcome\nweak reasoning in multi-branched paths and enabling compre-\nhensive exploration of reaction pathways."}, {"title": "3 Results", "content": "3.1 Retrosynthetic Pathway Tree of Polyimide\nThe aforementioned method is applied to Polyimide (PI), a high-\nperformance polymer renowned for its exceptional thermal sta-\nbility, chemical resistance, and mechanical strength. These prop-\nerties make PI indispensable in industries such as aerospace, elec-\ntronics, and high-temperature applications. 41 However, its com-\nplex synthesis and high production costs have driven research\ninto optimizing its synthetic routes. . 42 Therefore, we have chosen\npolyimide for retrosynthesis pathway analysis to explore more ef-\nficient and cost-effective approaches. By designating \"polyimide\"\nas the target substance for retrosynthetic analysis, the agent re-\ntrieved 39 research papers on polyimide synthesis methods, ex-\ntracting chemical reactions from these sources, and converted\nthem into a structured knowledge graph format, in the first round\nof searching process. By integrating database searches, a chemi-\ncal retrosynthetic pathway tree was recursively constructed.\nWhen the agent encounters an intermediate node that cannot\nbe expanded, it queries about five additional articles on its synthe-\nsis methods to extract supplementary chemical reactions, thereby\nhelping to extend the reaction pathway to available compounds\nas initial reactants. In the end, the agent supplemented with 158\nadditional papers on intermediate synthesis reactions, processed\na total of 197 papers, and obtained an expanded chemical ret-\nrosynthetic pathway tree for polyimide (Fig. 4). Ultimately, the\nnumber of nodes in the Rretrosynthetic Pathway Tree increased\nfrom the original 322 to 3099, and the number of synthesis path-\nways identified through the MBRPS algorithm increased from 55\nto 292."}, {"title": "3.2 Evaluation and Recommendation for Chemical Synthesis\nPathways", "content": "Most studies for retrosynthesis planning focus solely on reactants\nand products, neglecting reaction conditions. 1,3\u20136 However, fac-\ntors such as reaction mildness, reactant availability and cost, yield\nand scalability, and safety profile are crucial considerations in ret-\nrosynthesis planning. Due to the large number of obtained re-\naction pathways, the agent initially screens reactions within the\nretrosynthetic pathway tree based on these conditions (see Sec-\ntion III of SI for details).\nFinally, the agent employs Chain-of-Thought (CoT) 36 reason-\ning to conduct a comprehensive evaluation of each reaction path-\nway that has passed the initial screening and been validated. This\nevaluation considers each pathway's advantages and disadvan-\ntages based on the specific criterion designated by humans. In"}, {"title": "4 Discussion", "content": "4.1 Challenges and Proposed Solutions in Macromolecule\nRetrosynthesis Planning\nInformation extraction for polymer materials presents greater\nchallenges compared to small-molecule chemicals. Small\nmolecules benefit from standardized representations such as\nSMILES (Simplified Molecular Input Line Entry System) 43,44\nand IUPAC (International Union of Pure and Applied Chemistry)\nnomenclature, which provide unique and structured identifiers\nfor molecular structures. In contrast, polymers lack a single, uni-\nversally recognized naming standard. Their nomenclature often\nvaries based on their naming systems, monomer composition,\ntopology, material properties, application scenarios, and other\nfactors. For instance, Poly(vinyl acetate) (PVA) can be named\n\"Poly(1-acetoxyethylene)\" or \"Poly(ethenyl acetate)\" based on dif-\nferent nomenclature systems. 7,8 Similarly, polyimides (PI) can\nbe named \"poly(amide-imide)\" or \"poly(1,3-dioxoisoindoline-2-"}, {"title": "4.2 Advantages of Using Knowledge Graphs in Macro-\nmolecule Retrosynthesis Planning", "content": "When processing large volumes of academic literature, traditional\nRetrieval-Augmented Generation (RAG) techniques 27 are helpful\nin reducing hallucinations by linking answers to retrieved docu-\nments. However, they face significant limitations, including poor\ndocument retrieval quality, suboptimal ranking of relevant docu-\nments, and unstructured data management. 27,46,47 These short-\ncomings often lead to incomplete or misleading responses, partic-\nularly in retrosynthesis planning, where precision is paramount.\nTo address these issues, we adopt a structured knowledge"}, {"title": "4.3 Key Advantages of Our Method for Macromolecule Ret-\nrosynthesis Planning", "content": "The current methods for single-step chemical retrosynthesis anal-\nysis (predicting reactants based on a given product) primarily in-\nclude utilizing deep learning models for prediction 3-6 and em-\nploying density functional theory (DFT) for precise calculations 2.\nThese methods are generally limited to the study of small chem-\nical molecules, mainly due to the lack of databases on polymer\nchemical reactions, the large number of atoms in macromolecu-\nlar systems (typically on the order of 102 \u2013 106) 48, and the fact\nthat chemical reactions often involve long-range interactions in\nmacromolecules and solvent effects, making accurate calculations\nchallenging. To address these limitations, we propose a novel and\npractical approach that employs an LLM agent using authoritative\nacademic papers as the knowledge source to perform multi-step\nchemical retrosynthesis analysis for polymer materials.\nOur method stands out for its high interpretability and relia-\nbility, as it is grounded in experimental validation from authorita-\ntive academic papers. In comparison, template-free deep learning\nmodels for single-step retrosynthesis struggle with relatively low\nprediction accuracy (around 40-60%) 5,6, making it challenging\nto generate complete and valid pathways. Although template-\nbased deep learning methods achieve higher accuracy (approxi-\nmately 70-100%) 3,4, they rely heavily on predefined annotated\nreaction templates, limiting their flexibility. In contrast, our ap-\nproach not only provides highly accurate and valid reaction path-\nways for polymer materials, such as polyimides, with accuracy\nestimated to be in the high 90s, validated by databases and trace-\nable source literature, but also offers multiple viable pathways\ntailored to different application needs, thereby enhancing practi-\ncal value in retrosynthesis planning. Additionally, the vast major-\nity of these methods are based on a \"one-to-one\" decomposition\nstrategy (where a product is decomposed into at most one re-\naction intermediate), resulting in unbranched reaction pathways\nthat facilitate search using Monte Carlo Tree Search (MCTS). In\npractical scenarios, however, \"one-to-more\" decomposition strate-\ngies (where a product decomposes into one or more reaction in-\ntermediates) are more common, leading to multi-branched re-\naction pathways. To better align with practical application sce-\nnarios, we utilize the Memoized Depth-first Search (MDFS) al-"}, {"title": "5 Conclusion", "content": "This study represents the first attempt to develop a fully au-\ntomated retrosynthesis planning agent specifically designed for\nmacromolecules by integrating large language models with\nknowledge graphs. Demonstrated through a case study on\npolyimide, the approach automates literature retrieval, reaction\ndata extraction, database querying, construction of retrosynthetic\npathway trees, further expansion through the retrieval of addi-\ntional literature on intermediates, finally searching, evaluation\nand recommendation of the optimal route based on conditions,\nreactants, safety, and other factors. Our approach is versatile and\nnot limited to small molecules but extends to complex macro-\nmolecules. In contrast to previous methods that have been lim-\nited to \"one-to-one\" decomposition strategy, our method is suit-\nable for \"one-to-many\" decomposition strategy, a scenario more\ncommonly encountered in practical chemical synthesis analysis.\nBy applying this approach to the widely-used polyimide, the agent\nsuccessfully constructs the retrosynthesis pathway tree, and rec-\nommend both established and novel pathways without human in-\ntervention. This example demonstrates that with more powerful\nLLMs, an automated retrosynthesis planning agent could signifi-\ncantly accelerate the discovery of reverse chemical reaction path-\nways, thereby greatly enhancing research efficiency."}, {"title": "Code availability", "content": "The source code of RetroSynthesisAgent is available at\nhttps://github.com/QinyuMa316/RetroSynthesisAgent, where\nwe provide a demo video of its usage."}, {"title": "Supporting Information", "content": "The Supporting Information is available free of charge at A demo\nvideo demonstrating the operation process of the automated ret-\nsysthesis planning (MP4)."}, {"title": "Conflicts of interest", "content": "There are no conflicts to declare."}]}