{"title": "Deep Learning for Fetal Inflammatory Response Diagnosis in the\nUmbilical Cord", "authors": ["Marina A. Ayad", "Ramin Nateghi", "Abhishek Sharma", "Lawrence Chillrud", "Tilly Seesillapachai", "Lee A.D. Cooper", "Jeffery A. Goldstein"], "abstract": "Introduction: Inflammation of the umbilical cord can be seen as a result of ascending intrauterine\ninfection or other inflammatory stimuli. Acute fetal inflammatory response (FIR) is characterized\nby infiltration of the umbilical cord by fetal neutrophils, and can be associated with neonatal sepsis\nor fetal inflammatory response syndrome. Recent advances in deep learning in digital pathology\nhave demonstrated favorable performance across a wide range of clinical tasks, such as diagnosis\nand prognosis. In this study we classified FIR from whole slide images (WSI). Methods: We digitized 4100 histological slides of umbilical cord stained with hematoxylin and\neosin (H&E) and extracted placental diagnoses from the electronic health record. We build models\nusing attention-based whole slide learning models. We compared strategies between features\nextracted by a model (ConvNeXtXLarge) pretrained on non-medical images (ImageNet), and one\npretrained using histopathology images (UNI). We trained multiple iterations of each model and\ncombined them into an ensemble.\nResults: The predictions from the ensemble of models trained using UNI achieved an overall\nbalanced accuracy of 0.836 on the test dataset. In comparison, the ensembled predictions using\nConvNeXtXLarge had a lower balanced accuracy of 0.7209. Heatmaps generated from top\naccuracy model appropriately highlighted arteritis in cases of FIR 2. In FIR 1, the highest\nperforming model assigned high attention to areas of activated-appearing stroma in Wharton's\nJelly. However, other high-performing models assigned attention to umbilical vessels.\nDiscussion: We developed models for diagnosis of FIR from placental histology images, helping\nreduce interobserver variability among pathologists. Future work may examine the utility of these\nmodels for identifying infants at risk of systemic inflammatory response or early onset neonatal\nsepsis.", "sections": [{"title": "1. Introduction", "content": ""}, {"title": "1.1. The umbilical cord", "content": "The umbilical cord acts as a lifeline between the fetus and the placenta, developing as early as the\nthird week and is fully formed by the seventh week\u00b9. Its main structures include the umbilical vein\nand two umbilical arteries, all of which are surrounded by a gelatinous extracellular matrix known\nas the Wharton's Jelly\u00b2. This matrix is rich in proteoglycans and plays a significant role in\nsupporting the cord's flexibility and integrity through the fetal development. The umbilical arteries\ncarry deoxygenated blood along with the waste products from the fetus to the placenta, where gas\nand nutrient exchange takes place. The vein then carries the oxygenated, nutrient-rich blood from\nthe placenta back to the fetus.\nGiven its essential role in fetal development, histopathological examination of the umbilical cord\nis critical for identifying of any abnormalities or diseases that may have impacted fetal\ndevelopment\u00b3. Anomalies in the umbilical cord such as single umbilical artery (SUA), thrombosis,\nand aneurysm have been associated with stillbirth, asphyxia, preeclampsia, gestational diabetes,\nintrauterine distress and higher risk of congenital malformations2,4-6."}, {"title": "1.2. Fetal Inflammatory Response", "content": "Intrauterine inflammation plays a crucial role in adverse neonatal outcomes, more specifically in\nthe context of ascending infections. These infections occur when pathogens reach amniotic cavity\nfrom the lower genital tract after rupture of membranes. Microorganisms localized in the decidua\nof the supracervical region can propagate through the chorioamnionitic membranes. Neutrophils\nare not normally present in the chorioamnionitic membranes but in response to infection they\nmigrate from the decidua in case of acute chorioamnionitis. Neutrophil infiltration in different\nregions of the placenta is considered a hallmark of acute inflammatory lesions. A chemotactic\ngradient drives neutrophil migration into the intervillous space and the chorionic plate,\ncharacterized as a maternal inflammatory response (MIR).\nIn contrast, acute inflammation of the umbilical cord and the chorionic vessels of the chorionic\nplate is of fetal origin, known as Fetal Inflammatory Response (FIR). The infiltration of neutrophils\nof fetal origin into the umbilical vessel wall or vessels of the chorionic plate are diagnostic signs\nof FIR7. FIR is linked to elevated levels of Interleukin IL-6 driving elevated concentration of\nchemokines in the amniotic fluid, resulting in a chemotactic gradient which attracts neutrophils\nfrom the umbilical vessel lumens into the Wharton's jelly. The severity of funisitis, an\ninflammation of the umbilical cord, is correlated with the fetal plasma IL-6 levels, reflecting the\nintensity of the intraamniotic inflammatory responses.\nFIR is staged into three levels based on the location of neutrophil infiltration. An uninflamed\numbilical cord, free of neutrophil infiltration, has no FIR, which we will refer to as FIR 0 (Fig. 1.\nA and B). FIR 1, umbilical phlebitis, is characterized by neutrophil infiltration into the muscle\nlayers of the umbilical vein (Fig. 1.C). FIR is also diagnosed when there is acute inflammation of\nthe chorionic plate vessels, which we will not further address in this work. FIR 2, umbilical\narteritis, is described as neutrophil infiltration into the muscle of the arterial walls (Fig. 1.E). FIR"}, {"title": "3 involves necrotizing funisitis, inflammation in Wharton's Jelly with circumferential neutrophils\nor necrosis (Fig. 1.F and G). Inflammation of Wharton's Jelly without necrosis, \u201cfunisitis,\u201d may\nbe seen in the context of FIR 1 or 2 when neutrophils migrate past the muscle layers of artery or\nvein, but does not impact the staging of FIR(Fig. 1.D).", "content": "Although staging of FIR is important, interobserver variability remains challenging. An overall\nagreement of 6 examiners showed a Fleiss' \u043a of 0.73 for stage 2 diagnosis, and an interrater\ncorrelation coefficient of 0.68 for stages 1 to 310. Another study compared general practice surgical\npathologists with an expert placental pathologist and showed a Cohen's kappa of 0.49 for any\ndiagnosis of FIR (FIR0 vs FIR1,2,3)\u00b9\u00b9. The development of diagnostic tools could mitigate the\nscarcity of expert placental pathologists and improve diagnostic consistency."}, {"title": "1.3. Deep learning in digital pathology diagnostics", "content": "The field of AI in diagnosis and prognosis of pathology images has shown rapid advances 12-14.\nWith the growing demand of precision medicine and the increase in treatment options, AI allows\nthe quantitative extraction of information from whole slide images (WSI) across various medical\nspecialties. Al algorithms assist in tasks such as biomarker detection15-18, prognosis19-21, and\ndiagnosis22-24. One of the major promising advantages of AI in digital pathology is its potential to\nreduce interobserver variability which can improve prognostic and treatment outcomes especially\nin regions with limited access to specialized pathologists and medical resources25-29.\nA major computational challenge in digital pathology is the large size of the scanned WSIs which\naverages 120,000 \u00d7 80,000 pixels significantly larger than traditional computational analysis tasks\nthat are typically 256 \u00d7 256-pixel images30,31. Attention-based multiple instance learning (MIL)\napproaches have been shown to yield highly accurate models for generating whole-slide diagnoses.\n32-34. This mechanism allows models to be trained using patient or WSI-level labels instead of\npatch-level labels minimizing the annotation burden on pathologists and easing future clinical\nimplementation. A useful byproduct of attention-based approaches is that they assign an attention\nvalue to each portion of the image, based on the degree to which each portion of the image\ncontributes to the model output. Despite the risk of over-interpretation, examination of these\nmodels can aid in validating or troubleshooting model performance35.\nIn this study, we developed ML models to classify the FIR stages using WSI of umbilical cord.\nThe attention maps generated by these models provide a visualization of their ability to identify\ncritical regions in the umbilical cord, such as umbilical vessels and differentiate between the\narteries and the vein, to diagnose FIR."}, {"title": "2. Methods", "content": ""}, {"title": "2.1. Patients and diagnosis", "content": "We identified patients who underwent delivery and examination of the placenta and umbilical cord\nin our institution between years 2011 and 2023. Slides were digitized on a Leica GT450 scanner\nwith a 40x objective magnification (0.263 \u00b5m per pixel). The corresponding placental pathology\nreports were obtained from the institutional Electronic Data Warehouse (EDW). Natural Language\nProcessing (NLP) was used to parse the reports36. Our inclusion criteria consist of singleton\ndeliveries 12-42 week gestation. Twins or higher multiples, cases with no umbilical cords, and\nsurgical terminations were excluded from this study. Patients and diagnostic data were stored in\nREDcap37. The study was approved by Northwestern institutional review board (STU00214052)."}, {"title": "2.2. Model overview", "content": "Our model is divided into two sections, the first is a feature extraction which transforms the slides\ninto embedding in the latent space to be used for down streaming tasks. The second part is the\nclassification using weakly supervised whole-slide learning. This model provides both the final\nclassification and attention score for each patch in the slide. Due to the rarity of FIR 3 slides, we\ncombined FIR 3 with FIR 2, resulting in a 3-level classification (FIR 0, FIR 1, FIR 2,3)."}, {"title": "2.2.1. Feature extraction encoders", "content": "One slide per patient was used. Tissue regions were segmented using Otsu's method on low-power\nslide images38. Segmented tissue regions at 20\u00d7 magnification was divided into 224\u00d7244 pixel\npatches, which resulted in 208-33650 patches per slide and passed for feature extraction.\nConventional approaches in pathology machine learning have performed feature extraction using\nmodels pretrained on the ImageNet collection of everyday objects39. More recently, several groups\nhave released foundation models, that have been trained on very large datasets of histology images\nfrom diverse tissues 40-44. We compared feature extraction from the ConvNeXtXLarge model45\ntrained on ImageNet39 and the pathology foundation model UNI46NI was trained using a self-\nsupervised learning approach on 100,000 slides across multiple tissue types and consistently ranks\namong the top performance foundational model across different tissue types and downstream\ntasks47,48. Significantly for our application, the UNI dataset does not include placenta."}, {"title": "2.2.2. Attention-based multiple instance learning", "content": "We used attention-based MIL approach for classification and attention map evaluation (Fig. 2). In\nthis framework, the WSI is divided into smaller patches - 224x224 pixels in our case. The WSI is\ntreated as a collection of multiple patches, each of which may or may not be informative for the\ndiagnosis. In the first step, patches are embedded using the feature extractor either UNI or\nConvNeXtXLarge. The patch embeddings, represented as a list of numbers describing the features,\nare passed through a batch normalization layer followed by a dimensionality reduction layer using\na fully connected layers with 512 outputs and a rectified linear unit (ReLU) activation. The\nactivation is diverged into two branches with a fully connected dense layer of 256 output, one\nusing a tanh activation and the other using a sigmoid activation. The tanh and sigmoid are two\nnon-linear functions that gives the model the ability to capture different aspects of the input. An\nelement-wise product on the outputs of both branches is evaluated and used as an input for the\nmulti-class attention section. We used 3 branches \u2013 1 each for the diagnoses of FIR 0, FIR 1, and\nFIR 2,3 - with a fully connected layer of 64 output followed by a ReLU activation. A linear\nactivation is applied, and the output of the linear layer is passed through a sigmoid activation\nfunction. The attention mechanism assigns weights to different features based on their importance.\nA weighted average pooling is applied to the outputs of all three branches by applying an element-\nwise multiplication and normalization. This is then saved for the attention maps and passed for the\nclassification task. The classification network is a linear activation layer followed by a softmax\nactivation."}, {"title": "2.3. Hyperparameter Optimization Experiments", "content": "A fundamental challenge in deep learning design, is hyperparameter optimization. Searching the\noptimal combination of optimization algorithm, optimization parameters, number of epochs,\nlearning rate, and use of exponential moving average and momentum is not straightforward, and\ntrial and error is inefficient and time consuming. We used population-based training (PBT) to train\na group of models concurrently, allowing rapid recognition of the optimal settings49. Initially,\nneural networks are trained in parallel with random hyperparameters. During training of the\npopulation of networks, parameters of successful networks are copied (\u201cexploited\") and then\nmodified (\u201cexploring\u201d). This way PBT can dedicate more training time and usage of computational\nresources in more promising models. We used the Ray-tune package for PBT with the target metric"}, {"title": "2.4. Model Ensembles", "content": "Population-based training results in multiple models that not only have different performance but\nmay capture different aspects of the underlying biology51-54. By averaging the results of models\nwith different strengths, higher performance may be seen. For ConvNextXLarge and UNI, we\ntrained 900 models each. To determine how many models to include in our ensemble, we\nempirically tested for the group with the highest accuracy. Ensemble predictions were performed\nby weighting model outputs based on the model's AUROC."}, {"title": "2.5. Attention Maps", "content": "Each branch of the model \u2013 FIR0, FIR1, FIR2,3 \u2013 assigns an attention value to each patch. These\nvalues can be plotted to show the relative contribution of different parts of the umbilical cord to\nthe final result."}, {"title": "3. Results", "content": "We developed a dataset of 4100 slides, which included 3337 umbilical cords with no inflammation,\nFIR 0, 480 as FIR 1, 252 as FIR 2, and 31 as FIR 3. Due to the low numbers of FIR3, we combined\nthose cases with FIR2, resulting in three-classes. The dataset was stratified and split into an 80%\ntraining, 10% validation, 10% testing sets. A one-way\nANOVA was calculated to assess difference in maternal and gestational age across the three FIR\nclasses, revealing significant difference (p < 0.05). Additionally, the counts of parous individuals\nshowed a significant difference, as calculate be a chi-square test ($\\chi\u00b2$). In contrast, fetal sex showed\nno significant difference across FIR classes."}, {"title": "3.1. Model Performance", "content": "For classification, we implemented MIL using both the ConvNeXtXLarge pretrained with\nImageNet and UNI features. To evaluate the impact of different embeddings, we utilized the same\nhyperparameter optimization pipeline for both models. The top performing UNI model achieved a\nbalanced accuracy of 0.7993, higher than the best result from ConvNeXtXLarge\nembeddings, balanced accuracy of 0.72"}, {"title": "3.2. Ensembling", "content": "The ensembling the top 4 ConvNeXtXLarge trained models resulted in a balanced accuracy of\n0.72. In comparison, the ensemble of UNI models achieved a balanced accuracy of 0.836. This\nwas markedly higher than the individual models, suggesting that, despite similar accuracy values,\nthe models have complementing strengths. The confusion matrices of the ensembled models of\nboth embeddings are shown in Fig. 3."}, {"title": "3.3. Attention Maps and explainability", "content": "Interpretation of Al decision-making processes may be challenging. Our models assign an\nattention value to each patch in the WSI, which reflects the contribution of that patch to the model's\noutput. Extracting the attention values can highlight the important patches \u2013 but not why they are\nimportant or how the model is using them. Within the ensembles, each models generates its own\nattention maps. We began by analyzing the attention values of the top performing member of the\nUNI ensemble (Representative images: Fig. 4, Full images: Supplementary Fig. 1-3), showing\nsamples that were correctly predicted by that model. In FIR 0, representing uninflamed umbilical\ncord, the model's attention was low and diffusely distributed across the umbilical cord. The top\ntwo attention patches were unremarkable Wharton's jelly, and umbilical cord surface, respectively,\nwhich reflects the nonspecific focus of this attention. In FIR 1, attention maps show the highest\nfocus within Wharton's Jelly. The umbilical veins, which are critical for the diagnosis of FIR 1,\nshow low attention. For a case of FIR 2, the model focuses on portions of the umbilical arterial\nwall with neutrophilic inflammation \u2013 reflecting the portions of the image that a pathologist would\nuse to make the diagnosis of arteritis."}, {"title": "3.4. How does the UNI ensemble recognize FIR 1?", "content": "The UNI ensemble has good performance in diagnosing FIR 1, despite the difficult-to-justify\nattention map produced by the top performing model. We therefore examined the output and\nattention maps of the other 5 members of the ensemble. 5/6 models in the ensemble gave the correct\nprediction, while the #4 ranked model gave an incorrect prediction. Examining the attention maps\nshowed significant variability (Fig. 5). The top performing model as well as the 3rd and 4th ranked\nmodels showed attention in Wharton's Jelly. The 2nd and 5th highest ranked models showed\nmoderate-high attention in the vessels. Unlike FIR 2, where the models attend to the arteries\nspecifically, the FIR 1 models that attend to vessels do so equally between the arteries and the vein.\nThe 6th ranked model showed diffuse low attention across the cord, differing from the other\nmembers of the ensemble. We examined several cases of FIR 1, which showed similar patterns of\nattention (Not Shown). In contrast to FIR 1, The different members of the ensemble showed very"}, {"title": "3.5. Feature Embeddings Analysis", "content": "To further examine why UNI shows higher performance in classification of FIR, we compared the\nability of feature extractors to classify patches from different regions of the umbilical cord. We\nused a clustering approach, in which the class of a tissue region is inferred based how its image\nfeatures, as extracted by a feature extractor, cluster. We examined the clustering using t-SNE (Fig.\n6). t-SNE projects the 1024-dimensional feature vectors of ConvNeXtXLarge and UNI into two\ndimensional space and places points with similar feature vectors closer together. The t-SNE for\nConvNeXtXLarge show some separation of points by class, but with significant intermixture. In\ncontests, plots demonstrate tight clusters for the features extracted by UNI. The balanced accuracy\nof KNN for ConvNeXtXLarge was 0.6522. For UNI it was 0.9681. These results highlight how\nfoundational models pretrained using histopathology images result in a better classification, even\nthough UNI was not pretrained on placental tissue."}, {"title": "4. Discussion", "content": "We developed machine learning-based classifiers that identify FIR in the umbilical cord. We show\nthat grouping models together in ensembles improves performance and that differences in attention\nmechanism may allow models to compensate for one another. We show that the use of a foundation\nmodel, trained on pathology images, improves performance in this diagnosis, even though the\nmodel was not trained using placenta. Finally, we suggest that this difference may be due to better\ndistinction between different classes of tissue at baseline.\nOur method does not require manual annotation of the specific regions such as the arteries nor the\nvessel in the umbilical cord. We process the WSI with the FIR stage diagnosis as the labels. Our\nslides consist of two or three slices of the umbilical cord with different morphologies. One\ncomputational challenge is that inflammation is typically focal \u2013 localized to only a single or few\nvessels. An ideal model would assign high attention to these areas, particularly those that are\ninformative for a particular diagnosis. This behavior is seen in FIR 2,3 models. A perquisite for\nthis behavior is successfully distinguishing umbilical arterial and venous tissue, which is not\nalways straightforward.\nIn contrast, none of the high-performing models attend to the vein specifically in FIR 1. Three\nmodels attended to Wharton's Jelly, two attended to all vessels, and one showed diffuse low\nattention. We are confronted by two possibilities. Artificial intelligence has shown the potential to\nincrease performance by highlighting regions in the tissue that have been overlooked by\npathologists 12,21,55. For example, a deep learning model identified stroma in non-cancerous area of\nprostate tissue to be a prognostic factor in the histology of prostate cancer55. Another model\nshowed that breast cancer prognosis worsens when cancer-associated fibroblasts are located closer\nthe invasive edge of the tumor56.\nAlternatively, and perhaps more likely, is that this is an example of \u201cshortcut learning\" - the model\nhas failed to encode the underlying biological process and is relying on correlations that are not\ndirectly related to the diagnosis.57 Inflammation in Wharton's Jelly or the umbilical arteries is\nalmost invariably accompanied by phlebitis, so the apparent strategies of focusing on Wharton's\nJelly and any vessel can work. Even low diffuse attention could work in some circumstances\nfinding a neutrophil anywhere on the slide is correlated to the diagnosis of phlebitis. Combining\nmultiple models in an ensemble resulted in improved performance, however classification of FIR\n1 was still a weak point for the ensemble, perhaps due to the apparent reliance on shortcuts."}, {"title": "5. Conclusion", "content": "In conclusion, we developed an attention-based multiple instance learning model, a weakly\nsupervised method, to predict FIR stage from the WSI of umbilical cords. Using population-based\ntraining we generated an ensemble of models to enhance prediction accuracy. Additionally, we\ngenerated attention maps corresponding to the predicted FIR stages providing insights the regions\nthat contributed to the model's decision-making mechanism."}]}