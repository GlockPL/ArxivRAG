{"title": "Adaptive Behavioral AI: Reinforcement Learning to Enhance Pharmacy Services", "authors": ["Ana Fern\u00e1ndez del R\u00edo", "Michael Brennan Leong", "Paulo Saraiva", "Ivan Nazarov", "Aditya Rastogi", "Moiz Hassan", "Dexian Tang", "\u00c1frica Peri\u00e1\u00f1ez"], "abstract": "Pharmacies are critical in healthcare systems, particularly in low- and middle-income countries. Procuring pharmacists with the right behavioral interventions or nudges can enhance their skills, public health awareness, and pharmacy inventory management, ensuring access to essential medicines that ultimately benefit their patients. We introduce a reinforcement learning operational system to deliver personalized behavioral interventions through mobile health applications. We illustrate its potential by discussing a series of initial experiments run with SwipeRx, an all-in-one app for pharmacists, including B2B e-commerce, in Indonesia. The proposed method has broader applications extending beyond pharmacy operations to optimize healthcare delivery.", "sections": [{"title": "1 INTRODUCTION", "content": "Pharmacies are a crucial element of healthcare delivery everywhere and are often the first line of patient contact. For many patients in low- and middle-income countries (LMICs) who face significant barriers to accessing primary care facilities, pharmacies are the only option for obtaining essential healthcare services such as testing, drugs, and treatment advice. While the role of pharmacies in promoting medication adherence and responsible usage, and providing patient-centered care is unquestionable, pharmacies in many LMICs face substantial challenges, including a shortage of well-trained pharmacists, adequate channels to remain connected to the rest of the healthcare system and updated on emerging public health threats, medication availability and indications, and fragmented and undercapitalized supply chains that complicate adequate restocking and inventory management [11, 14, 23]."}, {"title": "1.1 Nudges for Pharmacists and Public Health", "content": "Pharmacists, and ultimately their patients, can hence benefit from digital tools and mobile applications that can help them manage their stocks and order supplies, connect to other facilities and peers, refine their skills, and access updated public health news and drug reference guides with the latest information on applicability, clinical requirements, side effect prevalence, contraindications, and pharmacological substitutes. These tools can turn pharmacies from drug procurement points into health hubs where patients can get treatment advice, testing, and health education.\nEquipping these tools with data-driven behavioral nudges contributes to keeping their users adequately engaged. It can provide them with additional timely support as needed, be that in the form of an adaptive continuous professional development program, restocking reminders based on demand prediction, patient-specific prescription recommendations, or actual incentives to reward adherence to medical guidelines (e.g., requiring a positive malaria test before dispensing antimalarials). We propose an Artificial Intelligence (AI) data-centric platform (described in Section 1.2) that can integrate with different tools to enrich them with nudging capabilities through Reinforcement Learning (RL) based recommendations that can be delivered directly through the applications.\nWe will illustrate this adaptive intervention framework through ongoing experiments with a concrete mobile health solution for pharmacists (described in Section 1.3). More technical details and a more thorough discussion of the results, including an additional experiment, can be found in a longer version of this paper [10]. The same approach, however, can be used with other digital tools within the broader health ecosystem, including applications for patient management [26], clinical decision support, capacity building, reporting, and efficiency monitoring for patients, healthcare workers, facilities, and decision-makers. See [25] for a general discussion in the context of health systems. Substantial transformative potential for health systems lies in such behavioral nudging frameworks."}, {"title": "1.2 The AI Platform", "content": "Architecturally, the platform consists of a Software Development Kit (SDK), which is embedded into mobile apps and digital tools; analytics, model management, intervention, and adaptive experimentation frontend interfaces; and the backend server. The backend is the backbone of the platform, responsible for log ingestion, data organization, and labeling, scheduled dispatch of nudges (push notifications, in-app messages, and adaptive UI components), as well as hosting predictive modeling and algorithmic decision-making engine and facilitating configuration thereof through the frontend UI."}, {"title": "1.3 The App: SwipeRx", "content": "SwipeRx is an all-in-one app for pharmacies in Southeast Asia. It connects over 235,000 professionals across 45,000 pharmacies in Indonesia, the Philippines, Malaysia, Thailand, Cambodia, and Vietnam, providing them with online education, centralized purchasing, logistics and financing, news, drug directory, and adverse event reporting, among other services. SwipeRx's community-driven B2B e-commerce model uses medication demand data and bulk purchases to enable small, pharmacy-owned pharmacies (the majority in Southeast Asia) to remain well-stocked by offering medicines at competitive prices and financing mechanisms."}, {"title": "2 METHODOLOGY", "content": "After integrating with the AI platform, the first interventions for SwipeRx users have been adaptive, personalized item (a pharmaceutical product in this context) pair recommendations. These aim to increase the basket size by promoting products the user has seldom or never ordered through the app. Leveraging opportunity costs can have positive spillover effects that improve the availability of relevant supplies in pharmacies. Different recommendation strategies, such as demand forecast-based ones to prevent stock-outs, as well as interventions targeting specific public health concerns through other app functionalities, will be run in the future."}, {"title": "2.1 General Intervention Setup", "content": "The interventions consist of personalized item pair recommendations (see Section 2.3) that can be sent weekly through in-app messages with the text (in Bahasa, the local language): Pharmacies in your area typically purchase A and B. Click here to order now! If the user is inactive when the in-app message is scheduled, they will find it on their homepage when reopening the app. Messages expire after a week to prevent their accumulation. Users targeted are those associated with pharmacies in Indonesia with only one or two SwipeRx users, with the app language set to Bahasa, which have connected on average at least every week in the last two months and at least once in the previous 40 days. The top 20% spenders were excluded. The total pharmacy expenditure on the six days following the recommendation was the objective metric used as a reward for the sequential decision-making algorithm (see Section 2.2) that weekly assigns each user either to treatment (i.e., the message is sent) or control (i.e., the message is not sent). Section 2.5 describes the particularities distinguishing the two concluded experiments run so far with this intervention."}, {"title": "2.2 Contextual Bandits", "content": "RL [30] is the machine learning paradigm best suited to make sequential decisions and, thus, for adaptive intervention delivery. The full Markov Decision Process (MDP) will be required as the underlying model for interventions where the reconciliation of short and long-term goals and the optimization of a sequence of interventions is critical, which is the case for complex inventory management use cases [3, 13, 19\u201321, 34]. Multi-Armed Bandits (MABs) are, however, an adequate framework to deal with the interventions described in this paper [1, 4, 17, 18], with non-linear models and other extensions providing additional representational complexity to drive the bandit towards regret minimization through more comprehensive personalization [5, 6, 8, 24, 28, 29, 32, 36]. The algorithm of choice for this intervention was a Gauss-Gamma linear bandit using Thompson sampling.\nContextless or linear bandits [4, 18] are a natural setup for adaptive experimentation, allowing for the introduction of statistical power constraints to guide the decision process [2, 7, 31, 33]."}, {"title": "2.3 Item Pair Recommendation", "content": "We use a rule-based pair recommendation algorithm that considers products typically purchased together, ranks the pairs by revenue, and retains the first 100 pairs, and of them, only those pairs that are currently in stock, creating a list of candidates. When determining what to recommend to a specific user, the algorithm selects from this list of candidate pairs the one that includes one product the user frequently buys and another the user has either not purchased before or has purchased infrequently. Frequent or infrequent here is determined by the average of each user's purchasing history for that item. Priority is given to recommending products the user has not purchased previously, else to those with a larger discrepancy in relative frequencies."}, {"title": "2.4 Impact Analysis", "content": "The effectiveness of the recommendations is assessed as a combination of three different perspectives."}, {"title": "2.4.1 RCT angle", "content": "We compare participants' average expenditure (among other engagement metrics) in the adaptive intervention with those in pure control by performing t-tests comparing daily and accumulated (since the beginning of the experiment) expenditure values and analyzing the evolution of significance, effect as given by Cohen's d, and statistical power throughout the experiment. We also use logit regressions on the accumulated expenditures and linear mixed models (LMMs) on the longitudinal expenditure values to estimate the effect of the adaptive intervention with baseline and other covariate adjustments. We probe for heterogeneous effects through a combination of stratified t-tests and estimation of different effects through LMMs."}, {"title": "2.4.2 Bandit angle", "content": "Within the adaptive intervention, we look mainly into the evolution of the fraction of users assigned to each arm (treatment or control) as dictated by the objective metric observed for these so far. We compute the sensitivity to contextual metrics as the Jacobian of the arm probability based on Thompson sampling approximation soft-thresholded using half the sample's standard deviation and averaged across the participants to understand heterogeneous effects. We plot the t-distributed stochastic neighbor embedding (t-sne) visualization [12, 22] using the contextual traits of best arm assignments and the difference in assignment probabilities of the best arm and the second best arm, to gain intuition on whether the context as a whole was well chosen."}, {"title": "2.4.3 Recommendation success angle", "content": "Finally, we also look into how the user reacted to the recommendation (if they opened it, closed it, or ignored it) and whether the recommended item (the one previously infrequently purchased) was purchased at a later time during the experiment."}, {"title": "2.5 Experiments", "content": "Two experiments have been completed so far with the item pair recommendations. Besides running over different periods (they have been run consecutively), they used different contexts for the adaptive arm. Sample sizes also differ, as all participants in the adaptive intervention of the first experiment (XP1) were excluded from the second one (XP2). The in-app message is sent at 6 am local time on Monday for both experiments except for the first four weeks of XP1 when they were scheduled for 6 am Tuesday. This change was made mid-experiment to match the day of recommendation with the day of the week when a large part of all purchases and logins happen."}, {"title": "2.5.1 First item pair recommendation experiment (XP1)", "content": "Ran for 8 weeks between December 2023 and January 2024, with around 30% of cohort users assigned to pure control. Context used consisted in the region (one-hot encoded), normalized days since the last nudge, days with purchase orders and expenditure in the last 90 days."}, {"title": "2.5.2 Second item pair recommendation experiment (XP2)", "content": "Ran for 10 weeks between February and April 2024, with around 40% of participants assigned to pure control. Context used consisted on average days between logins in the last 60 days, days since first login, expenditure in the last month, days with orders in the last 30 days, normalized days since last nudge, nudges opened in the last 2 weeks, and time spent using the app in the last 30 days."}, {"title": "3 RESULTS", "content": "The experiments consistently indicate a small positive impact on pharmacy expenditure, stabilizing once the users are habituated. There is also evidence of delayed effects, i.e., recommendations not acted on immediately but purchased later. This section summarizes our main findings. The complete analysis is not included due to length limitations but will be published elsewhere [9]. Table 1 collects a few impact metrics across the two experiments.\nWhile the t-test accumulated expenditure throughout XP1 was not significant at any point for the required level of confidence, it came close, particularly after the change in the nudge schedule. Some daily values were significantly higher in the adaptive arm and for daily and accumulated values for certain strata, such as pharmacies in Jakarta. The LMM also estimated a significant positive impact of being in the adaptive arm despite the bandit learning to assign decreasing numbers of users to treatment. The sensitivity analysis suggests the context helped discriminate which users would benefit from the recommendation, with the days since the last nudge preventing fatigue effects and the purchasing frequency having a large negative impact on the probability of assigning to treatment. All of this, together with the fact that this experiment ran over the atypical Christmas period, encouraged an experimental design for XP2 that mirrored that of XP1, with the scheduling on Monday since the beginning, with only a modified context.\nFor XP2, despite the smaller sample sizes used, we see a growing impact in accumulated values that reaches significance after a week and remains so for 40 days, as depicted in Figure 2. Opposite to XP1, the bandit in XP2 learns to nudge most users after three assignments. This could be related to the allocation by chance at that decision point of a large fraction of the top spenders to treatment, skewing its learning process. In turn, this appears to hinder the bandit's capacity to adequately learn how to use its context, as indicated by the sensitivity analysis, where, for example, most traits were negligible and the impact of days since the last nudge the opposite of XP1 and is reasonable to expect. The large correlation between being in the adaptive arm and being nudged close to every week also explains why, for XP2, the LMM only estimates the parameter associated with the latter as significant (opposite to XP1).\nThe faction of successful recommendations is very similar and relatively large in both XP1 and XP2. The LMM baseline estimated effects are also consistent in both cases. Exploration of heterogeneous effects through stratified analysis, LMM effect estimation, and sensitivity analysis indicate areas that should be explored in more detail, such as regional effects and the impact of the user's typical purchasing frequency, as the pairs appear to be particularly useful in nudging both very frequent purchasers and extremely infrequent purchasers."}, {"title": "4 SUMMARY AND CONCLUSIONS", "content": "We developed a framework to enhance digital tools for pharmacies and healthcare providers with RL-based behavioral nudging. Applied to SwipeRx, a leading app for Southeast Asian pharmacists, our approach is illustrated through interventions aiming to increase basket size by helping pharmacists discover new products. The positive impact observed in our experiments underscores the potential of this approach to support and improve pharmacy services."}]}