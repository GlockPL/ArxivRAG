{"title": "Multi-Objective Deep-Learning-based Biomechanical\nDeformable Image Registration with MOREA", "authors": ["Georgios Andreadis", "Eduard Ruiz Munn\u00e9b", "Thomas H. W. B\u00e4ckb", "Peter A. N. Bosman", "Tanja Alderliesten Da"], "abstract": "When choosing a deformable image registration (DIR) approach for images with large deformations and con-\ntent mismatch, the realism of found transformations often needs to be traded off against the required runtime.\nDIR approaches using deep learning (DL) techniques have shown remarkable promise in instantly predicting a\ntransformation. However, on difficult registration problems, the realism of these transformations can fall short.\nDIR approaches using biomechanical, finite element modeling (FEM) techniques can find more realistic trans-\nformations, but tend to require much longer runtimes. This work proposes the first hybrid approach to combine\nthem, with the aim of getting the best of both worlds. This hybrid approach, called DL-MOREA, combines a\nrecently introduced multi-objective DL-based DIR approach which leverages the VoxelMorph framework, called\nDL-MODIR, with MOREA, an evolutionary algorithm-based, multi-objective DIR approach in which a FEM-like\nbiomechanical mesh transformation model is used. In our proposed hybrid approach, the DL results are used\nto smartly initialize MOREA, with the aim of more efficiently optimizing its mesh transformation model. We\nempirically compare DL-MOREA against its components, DL-MODIR and MOREA, on CT scan pairs captur-\ning large bladder filling differences of 15 cervical cancer patients. While MOREA requires a median runtime\nof 45 minutes, DL-MOREA can already find high-quality transformations after 5 minutes. Compared to the\nDL-MODIR transformations, the transformations found by DL-MOREA exhibit far less folding and improve or\npreserve the bladder contour distance error.", "sections": [{"title": "1. INTRODUCTION", "content": "Many applications in image-guided radiation treatment could benefit from the transfer of information between\nmultiple medical images of the same patient. However, local tissue deformations or content mismatch can hinder\nthis transfer, requiring deformable image registration (DIR) to establish a spatial correspondence between the\nimages. In this work, DIR entails registering a source image onto a target image. As this task has been shown\nto be inherently multi-objective,\u00b9 a set of conflicting objectives should be optimized, simultaneously. The aim\nof multi-objective DIR is to find a so-called approximation set of transformations that covers the trade-off front\nof Pareto optimal transformations spanned by these objectives. To be of value, the transformations must be\nbiomechanically plausible (i.e., realistic). Furthermore, to be useful in various clinical applications, they typically\nneed to be calculated within a short time frame. These two requirements, however, can be in conflict.\nTwo predominant types of DIR approaches have emerged, each excelling in one of these two requirements.\nOn the one hand, DIR approaches using deep learning (DL) techniques,2-4 such as the recently introduced multi-\nobjective DL-MODIR approach,5 can instantly predict a transformation for a given registration problem, after\nbeing trained on a set of prior problems. On problems with large deformations and content mismatch, however,\nthis speed often comes at the expense of transformation realism, as current prediction models are not grounded\nin a realistic transformation model. On the other hand, DIR approaches which use biomechanical, finite element"}, {"title": "2. MATERIALS AND METHODS", "content": "The registration problems in this study are derived from pelvic CT scans of 75 cervical cancer patients, acquired\nfor radiation treatment planning purposes, using a Philips Brilliance Big Bore scanner. For each patient, we\ninclude a source image with a full bladder and a target image with an empty bladder, taken shortly thereafter. For\nbetter visibility, the empty bladder was typically imaged after a bladder fluid contrast agent was administered.\nThis was the case in 64 of the 75 patients. On both source and target images, 7 organs are delineated by\na radiation therapy technologist (RTT), as seen in Figure 2. The image pair is resampled to a resolution of\n3\u00d73\u00d73 mm and rigidly registered to align the bony anatomies, using the bone contours. Both images are then\ncropped to an axis-aligned bounding box around the bladder with a 30 mm margin, using the maximal bounds\nfrom either image. To comply with the dimensionality requirements of DL-MODIR, all images are padded to in-\nplane dimensions of 96 \u00d7 96 voxels and a minimum depth of 48 voxels. If images exceed a depth of 48, overlapping"}, {"title": "2.1 Dataset", "content": "The registration problems in this study are derived from pelvic CT scans of 75 cervical cancer patients, acquired\nfor radiation treatment planning purposes, using a Philips Brilliance Big Bore scanner. For each patient, we\ninclude a source image with a full bladder and a target image with an empty bladder, taken shortly thereafter. For\nbetter visibility, the empty bladder was typically imaged after a bladder fluid contrast agent was administered.\nThis was the case in 64 of the 75 patients. On both source and target images, 7 organs are delineated by\na radiation therapy technologist (RTT), as seen in Figure 2. The image pair is resampled to a resolution of\n3\u00d73\u00d73 mm and rigidly registered to align the bony anatomies, using the bone contours. Both images are then\ncropped to an axis-aligned bounding box around the bladder with a 30 mm margin, using the maximal bounds\nfrom either image. To comply with the dimensionality requirements of DL-MODIR, all images are padded to in-\nplane dimensions of 96 \u00d7 96 voxels and a minimum depth of 48 voxels. If images exceed a depth of 48, overlapping\nfragments of depth 48 are prepared. The total patient cohort is divided into a training and validation set of 60\npatients, with no. 2-61, and a test set of 15 patients, with no. 62-76.\nFrom the test set, three representative patients are automatically chosen for illustration by clustering the\npatients on their relative bladder volume change $V_t/V_s$, where $V_s$ is the source bladder volume and $V_t$ is the\ntarget bladder volume. A $V_t/V_s$ value of 1.0 therefore indicates no change between the bladder volumes, while\na value lower than 1.0 represents a target bladder volume that is smaller than its corresponding source bladder\nvolume. We employ this relative change as an indicator of their registration difficulty. Using K-Means clustering,\nwe identify three clusters, with a small, medium, and large relative volume change, respectively. The relative\nbladder volume change of each patient and their corresponding cluster is depicted in Figure 3. The derived\nclustering thresholds of the relative bladder volume change metric are: 0.5 (between the small change cluster\nand the medium change cluster), and 0.3 (between the medium change cluster and the large change cluster)."}, {"title": "2.2 DIR Approaches", "content": "DL-MODIR This approach combines a recently proposed multi-objective learning technique10 with the well-\nknown DL-based VoxelMorph approach\u00b9\u00b9 to perform multi-objective, DL-based DIR.5 A set of encoders and\ndecoders are trained to predict transformations that together maximize the hypervolume\u00b9\u00b2 of the transforma-\ntions in the approximation set. Three loss functions are optimized simultaneously: (1) the smoothness of the\ntransformation (the squared sum of spatial gradients of the deformation), (2) the image similarity (the normal-\nized cross correlation between target and transformed source image), and (3) the organ segmentation similarity\n(the Dice score of target and transformed source organ segmentations). As shown in Figure 2, the following\norgan segmentations are modelled: anal canal, bladder, body, bones, bowel, rectum, and sigmoid. The output\nof this approach is a set of 15 transformation deformation vector fields (DVFs), each representing a different\ntrade-off of these loss functions.\nMOREA This approach employs a biomechanical, dual-dynamic mesh transformation model in which two\ncorresponding meshes are used, one for each image. These meshes are deformed through optimization with a\nmodern, GPU-parallelized evolutionary algorithm (EA), which enables MOREA to capture large deformations\nand content (dis) appearances. The EA optimizes a population of individuals, each representing a transformation."}, {"title": "2.3 Experimental Setup", "content": "The DL-MODIR approach is trained for 150,000 iterations, with a batch size of 1 and a learning rate of 0.0001,\nusing 5-fold cross validation. After training, the model of the first fold is used for further evaluation. MOREA\nis configured to perform multi-resolution DIR, starting with 200 mesh points and refined once to a finer mesh by\nplacing intermediate points on edges of the coarse starting mesh and thereby subdividing the tetrahedra of the\ncoarse mesh. 13 The number of mesh points in this configuration was determined through preliminary experiments.\nRegistration results obtained with the coarse mesh are used to initialize deformations of the finer resolution mesh.\nIn the automatically generated coarse mesh, 20% of the point budget is allocated to bladder surface modelling,\n40% to points on other organ contours, and the rest of the budget to mesh quality enhancements, by placing\npoints in regions with lower point density. This distribution of the point budget was empirically determined for\nthe anatomical site at hand. The mesh is cropped to the field of view, thereby excluding padded empty regions\nrequired for DL-MODIR. Optimization with MOREA is performed using 10 clusters, a population size of 600\nregistration solutions, and an elitist archive of 1000 registration solutions. This optimization is performed on\nDell Precision 7920R machines with NVIDIA RTX A5000 GPUs.\nThe MOREA and DL-MOREA approaches are repeated 5 times for each patient with different random seeds,\nin the interest of reproducibility. Qualitative results are reported for the first run of each configuration, while\nquantitative results are reported for the median and standard deviation values of all runs. The DL-MODIR\napproach is only run once as inference is deterministic. The training procedure is not deterministic, but was\nnot repeated due to time constraints. During the MOREA and DL-MOREA approaches, an early stop after\n5 minutes is simulated by recording the state at that time point. Preliminary experiments indicated that this\nduration was sufficient for MOREA to successfully model the main components of the deformation. We report\non outcomes both after the simulated early stop time-point and after full convergence."}, {"title": "2.4 Evaluation", "content": "From each approximation set, one transformation is automatically selected for reproducibility, by sorting the\ntransformations by their segmentation (or contour) similarity objective and choosing the transformation with the\nsecond-best value. The cardinality of approximation sets differs strongly between approaches, with hundreds of\nsolutions being found by (DL-)MOREA but only 15 registration solutions being found by DL-MODIR, making\nit difficult to choose a consistent automatic selection strategy. The chosen strategy proved robust enough in\npreliminary experiments against overfitting on one objective, while still accurately capturing the exploitative\nstrengths of each approach. We performed both a qualitative and a quantitative comparison of the chosen\ntransformations."}, {"title": "2.4.1 Qualitative comparison", "content": "For a qualitative comparison, the transformed contours and inverse DVFs are inspected and compared. Trans-\nformed contours are visualized by transforming the corresponding organ mask and applying a Gaussian blur with\na standard deviation of 0.6 voxels for smoothing."}, {"title": "2.4.2 Quantitative comparison", "content": "Quantitatively, we compare the Hausdorff 95th percentile distance between the target contour and the trans-\nformed source contour of the bladder. In this comparison, we also test for statistical significance of any observed\ndifference between MOREA and the proposed hybrid, DL-MOREA. The relative change between the medians of\ntwo distance distributions for a certain patient and time point is reported (i.e., 1 \u2013 $(H_{MOREA}/H_{DL-MOREA})$, with\n$H_x$ being the median Hausdorff 95th percentile distance for a certain approach configuration x). This is tested\nusing the Mann-Whitney U test, as we do not assume a normal distribution of measurements, using an alpha level\nof 0.05. In addition to contour distance, we also compare the inverted (i.e., folded) volume of the inverse DVF,\ncomputed as the image volume for which the Jacobian of the DVF is negative. Moreover, we show convergence\nplots and report required runtimes, for the optimization runs performed by MOREA and DL-MOREA."}, {"title": "3. RESULTS", "content": "We show the annotated images of the three selected patients in Figure 2. In Figure 4, we show the transformed\ncontours found by the three approaches and their underlying transformations as captured after 5 minutes, to\nassess the impact of the DL-based initialization. The fully converged results are shown in Figure 5. Across all\nthree patients, it can be observed that the bladder deformation is modeled in a more uniformly spread fashion\nby MOREA and DL-MOREA (see area marked in red in Figure 4) already after 5 minutes of optimization, while\nthe DL-MODIR transformations are mainly facilitated by movement outside the bladder. On the patient with\na large relative difference in bladder volume depicted in row 4c, only the contours transformed by the hybrid\nDL-MOREA approach approximate the reference well, with MOREA not yet having converged after 5 minutes,\nand the transformation of DL-MODIR leaving bladder mass in the bowel region. On patients with a smaller\nchange (rows 4a and 4b), the differences in contour quality between approaches are smaller, even though the\nunderlying deformations still differ strongly.\nWhen comparing the early stop results of Figure 4 with the converged results of Figure 5, small refinements\nsuch as in the transformed contours of DL-MOREA in row 5b compared to row 4b can be observed. However,\nthe overall changes in contour quality and deformations are minimal, indicating that the results obtained after\n5 minutes are largely indicative of final achieved results."}, {"title": "3.1 Qualitative comparison", "content": "We show the annotated images of the three selected patients in Figure 2. In Figure 4, we show the transformed\ncontours found by the three approaches and their underlying transformations as captured after 5 minutes, to\nassess the impact of the DL-based initialization. The fully converged results are shown in Figure 5. Across all\nthree patients, it can be observed that the bladder deformation is modeled in a more uniformly spread fashion\nby MOREA and DL-MOREA (see area marked in red in Figure 4) already after 5 minutes of optimization, while\nthe DL-MODIR transformations are mainly facilitated by movement outside the bladder. On the patient with\na large relative difference in bladder volume depicted in row 4c, only the contours transformed by the hybrid\nDL-MOREA approach approximate the reference well, with MOREA not yet having converged after 5 minutes,\nand the transformation of DL-MODIR leaving bladder mass in the bowel region. On patients with a smaller\nchange (rows 4a and 4b), the differences in contour quality between approaches are smaller, even though the\nunderlying deformations still differ strongly.\nWhen comparing the early stop results of Figure 4 with the converged results of Figure 5, small refinements\nsuch as in the transformed contours of DL-MOREA in row 5b compared to row 4b can be observed. However,\nthe overall changes in contour quality and deformations are minimal, indicating that the results obtained after\n5 minutes are largely indicative of final achieved results."}, {"title": "3.2 Quantitative comparison", "content": "In Table 1, we list the distance errors of the transformed bladder contours and the inverted transformation\nvolumes. We observe that the contour distances are often larger for DL-MODIR than for (DL-)MOREA or"}, {"title": "4. DISCUSSION AND CONCLUSIONS", "content": "For the first time, a DL-based DIR approach has been combined with a biomechanical DIR approach. In\naddition, this work is also the first to achieve this with a multi-objective approach. The proposed hybrid, called\nDL-MOREA, is initialized with the predicted transformations of an existing DL DIR model and multi-objectively\noptimizes these with a biomechanical mesh transformation model. On pelvic CT scans with large deformations,\nexperiments show that the proposed hybrid is able to improve on the folding and bladder contour distance\nperformance of the original DL-based DIR approach, within 5 minutes. The added value of the hybrid is greatest\nin difficult registration cases, although it also provides benefits in easier cases, e.g., through folding reduction.\nDL-MOREA therefore shows promise to combine the best of both worlds in a multi-objective setting: the speed\nof DL-based registration and the realism of biomechanical registration.\nThere are limitations to the validity of this experimental study. For example, the process of selecting a\nregistration from each approximation set for comparison obscures the complexity of a true multi-objective com-\nparison of approximation sets. Furthermore, the qualitative comparison of registrations was not performed by a\ngroup of multiple experts, leading to potential observer bias. A third limitation of this comparison is the used\ndataset, which has a limited image resolution and field of view. However, image features and structures that are\nimportant to the region of interest remain visible in the dataset. Finally, the limited size of the training dataset\nposes another potential limitation.\nFuture work should address these concerns by involving multiple expert observers in an a posteriori manual\nselection and assessment process, to model the intended real-world use more closely. The full approximation\nsets should also be compared using independent metrics, to evaluate their diversity and quality in a quantitative\ncomparison. In general, the proposed hybrid should also be evaluated across other registration tasks and anatom-\nical sites to assess how its performance generalizes. Furthermore, hybrid combinations of other DIR approaches\nshould also be studied, to investigate the impact of the DIR components chosen in this work."}]}