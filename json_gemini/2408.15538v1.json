{"title": "TrafficGamer: Reliable and Flexible Traffic Simulation for Safety-Critical Scenarios with Game-Theoretic Oracles", "authors": ["Guanren Qiao", "Guorui Quan", "Jiawei Yu", "Shujun Jia", "Guiliang Liu"], "abstract": "While modern Autonomous Vehicle (AV) systems can develop reliable driving poli- cies under regular traffic conditions, they frequently struggle with safety-critical traffic scenarios. This difficulty primarily arises from the rarity of such scenarios in driving datasets and the complexities associated with predictive modeling among multiple ve- hicles. To support the testing and refinement of AV policies, simulating safety-critical traffic events is an essential challenge to be addressed. In this work, we introduce Traf- ficGamer, which facilitates game-theoretic traffic simulation by viewing common road driving as a multi-agent game.In evaluating the empirical performance across various real-world datasets, TrafficGamer ensures both fidelity and exploitability of the simu- lated scenarios, guaranteeing that they not only statically align with real-world traffic distribution but also efficiently capture equilibriums for representing safety-critical sce- narios involving multiple agents. Additionally, the results demonstrate that TrafficGamer exhibits highly flexible simulation across various contexts. Specifically, we demonstrate that the generated scenarios can dynamically adapt to equilibriums of varying tight- ness by configuring risk-sensitive constraints during optimization. To the best of our knowledge, TrafficGamer is the first simulator capable of generating diverse traffic sce- narios involving multiple agents. We have provided a demo webpage for the project at: https://qiaoguanren.github.io/trafficgamer-demo/.", "sections": [{"title": "Introduction", "content": "As a cutting-edge technology, autonomous driving has been a critical component of future transportation systems. The development of Autonomous Vehicles (AV) requires extensive testing and calibration of their control systems. Given the significant risks of conducting these tasks on real roads, the industry commonly relies on traffic simulation systems to ensure the safe development of AVs. Within these simulation systems, the commonly studied goals include traffic flow simulation (e.g., SUMO [1] and CityFlow[2]), sensory data simulation (e.g.,"}, {"title": "", "content": "Airsim [3] and Unisim [4]), driving policy simulation (e.g., Highway-Env [5], SUMMIT [6], Metadrive [7], Commonroad [8], Intersim [9], Tbsim [10], Waymax [11], TorchDriveEnv [12] and CarDreamer [13]), vehicle dynamics simulation (e.g., Carsim [14] and Matlab [15]) and multi-task simulation (e.g., Carla [16], NVIDIA's Drive Sim [17] and VI Worldsim [18]).\nThe major advancements in traffic simulation have primarily focused on improving fidelity by replicating observed vehicle trajectories. While these methods can guarantee the expected accuracy of reproducing real-world traffic flows, they often fail to capture rare events that occur at the long-tail end of the data distribution. Conversely, a significant challenge for modern AVs is their difficulty in managing these safety-critical \"tail\u201d events, rather than the more commonly observed traffic scenarios. This situation reveals the importance of actively simulating safety-critical but infrequent events, which are crucial for thoroughly testing the reliability and robustness of AV control systems.\nBeyond replicating realistic traffic, some recent studies have specifically focused on modeling safety-critical events. These event generating strategies can be categorized into [19]: 1) Data-driven generation detects and reproduces safety-critical scenarios recorded in real-world datasets. Some recent advancements, including Simnet [20], TrafficGen [21], Trafficsim [22], VBD [23], NeuralNDE [24], Goal-LBP [25] and SceneGen [26], model the distribution of traffic scenarios by maximizing the likelihood of observed vehicle trajectories. 2) Adversarial generation intentionally creates risky scenarios by manipulating the generation process of autonomous vehicle (AV) systems [27]. Under this setting, Advsim [28] and STRIVE [29] manipulated the scenario's initial conditions or provided the complete trajectory upfront. The Reinforcement Learning (RL)-based methods constructed an adversarial policy network [30, 31, 32] to control autonomous vehicles 3) Knowledge-based Generation leverages external domain knowledge to facilitate the generation of safety-critical events. To achieve this goal, RobustTraj [33], ChatScene [34], CGT [35], RTR [36] and GCRL [37] incorporated latent embeddings or constraint signals of traffic rules into the trajectory prediction model.\nThe aforementioned approaches primarily depend on imitating human demonstrations and manually-crafted heuristics. However, as shown in Figure 1a, safety-critical traffic scenarios involve complex systems with multiple agents. These high-risk events are sparsely represented in real-world demonstration data, leading to higher predictive errors and crash rates in the imitation model. Such discrepancies impact the effectiveness of data imitation and human experience. More importantly, the agents' behaviors in these systems are intricately interconnected and interdependent. The reactions of one agent are largely dependent on the movements of others. Moreover, these reactions are shaped by the agents' specific objectives and shared safety concerns. Figure 1b shows that referring only to log-reply is insufficient. There is a lack of a mechanism that can effectively model the strategic behaviors of AV agents and actively discover safety-critical events conditioning on different environments.\nTo this end, a critical step toward strategic traffic simulation is to develop a game-theoretic traffic simulation algorithm designed to model the complex interactions among multiple agents in traffic scenarios. Moreover, such a system must be reactive, enabling vehicles to adapt to the movements of other traffic participants. From the perspective of game theory, whenever we modify the policy of a vehicle, the multi-agent system can converge to a new equilibrium where no agent has an incentive to deviate. These characteristics distinguish our proposal from other simulators primarily relying on imitation learning."}, {"title": "", "content": "To ensure the practical application of these simulated strategic behaviors, it is essential to resolve the following challenges shown in Figure 1c: 1) Distributional Fidelity: The generated vehicle trajectories should closely replicate the behaviors of actual drivers to provide realistic driving scenarios. Unlike imitation-based methods that focus on point-wise regression, the simulated scenarios should maintain a minimal distribution distance from the realistic dataset to ensure their alignment in naturalistic driving behaviors. 2) Efficient Exploitability: The algorithm simulates the competitive interactions among multiple agents. This algorithm should efficiently identify and converge to an equilibrium, where no agent has an incentive to deviate. Furthermore, this process must be scalable to accommodate a large number and diverse types of vehicles. 3) Flexible Simulation: While an equilibrium typically assumes that agents aim to maximize their expected returns, human drivers' behaviors are inherently diverse and sensitive to various safety risks (i.e., bounded rationality). Maintaining an overly tight equilibrium may result in an inaccurate representation of drivers' behaviors and limit the opportunities for controllers to develop safe policies. Therefore, it is crucial to control the tightness of the equilibrium. This advancement can ensure safety and flexibility for policy improvement, accommodating the nuanced and variable nature of human driving behaviors.\nIn response to the outlined challenges, we propose TrafficGamer, a game-theoretic algorithm designed to facilitate distributional fidelity, efficient exploitability, and flexible simulation in multi-agent traffic simulations within complex environments. Figure 2a shows the overall framework of TrafficGamer. Specifically, TrafficGamer pre-trains a generative world model using large-scale traffic data collected from a variety of traffic scenarios. The pre-training is implemented through an end-to-end motion prediction task, which forecasts the future position of a vehicle based on historical observations of dynamic features (e.g., surrounding vehicles) and state features (e.g., map attributes). This approach ensures that the traffic model accurately reflects a high fidelity to drivers' preferences under realistic conditions. Subsequently, TrafficGamer fine-tunes this model by following a game-theoretic oracle. This refinement process involves minimizing the distributional distance to the pre-trained model, thereby maintaining the fidelity of the realistic data distribution while capturing its competitive behaviors among different AV agents. The AVs' policies derived from our model can be mathematically characterized by a Coarse Correlated Equilibrium (CCE). As is shown in Figure 2b, we develop a multi-agent CCE-Solver algorithm to efficiently approximate this equilibrium. The theoretical foundation for the optimality of our algorithm is grounded by recent advancements in multi-agent CCE [38, 39, 40]. Additionally, the empirical performance of the algorithm draws upon principles from Magnetic Mirror Descent (MMD) [41, 42, 43, 44]. This combination of theoretical and empirical insights ensures that our approach is robust and effective in complex traffic simulation scenarios. To dynamically adapt the tightness of the equilibrium, TrafficGamer incorporates a configurable safety constraint into CCE policies (See Figure 2c). For example, by maintaining a larger distance between cars, we derive a softer CCE by implementing risk-preventing constraints. In this setting, agents are inclined to cooperate to meet joint safety constraints, such as maintaining appropriate distances between vehicles. This strategy ensures both safety and flexibility in traffic simulation.\nAs a scalable algorithm, TrafficGamer can be adapted to various datasets. To demonstrate the scalability of TrafficGamer, we evaluated its empirical performance using well-known traffic datasets such as Argoverse 2 [45] and Waymo Open Motion Dataset [46], as well as a"}, {"title": "", "content": "commonly used simulator. In specific, we mainly conduct three sections of experiments and illustrate the results under a variety of driving scenarios (twelve in total): 1) Fidelity Validation for the Generated Motion Trajectories: We demonstrate that the trajectories generated by TrafficGamer can accurately characterize real-world traffic scenarios. Specifically, by quantifying the distributional divergence between generated traffic features (including distance between vehicles, speed, and collision rate) and those observed in the dataset, we show that the scenarios from TrafficGamer can statistically match the data distribution in the real world. 2) Efficient Exploitability under a Variety of Scenarios: We illustrate that TrafficGamer can most effectively close the CCE-Gap (Coordinated Compliance and Enforcement Gap), thereby efficiently capturing the equilibrium necessary for representing safety-critical scenarios under a variety of traffic conditions. 3) Simulation of Diverse Safety-Critical Scenarios: To demonstrate the flexibility of our traffic simulation, TrafficGamer supports both 2D and 3D visualizations of each driving scenario from multiple perspectives. These visualizations show that TrafficGamer can generate a variety of intriguing and infrequent safety-critical traffic scenarios. Additionally, it can effectively configure the degree of competition and collaboration among vehicles within these scenarios. Illustrative videos are provided in the supplementary materials."}, {"title": "Results", "content": "While these scenarios are crucial for the development and evaluation of autonomous vehicle (AV) systems, real-world datasets for safety-critical scenarios are rarely available. Therefore, we assess the performance of our model using the publicly available dataset Argoverse 2[45], which contains 250,000 scenarios extracted from six distinct urban driving environments across the United States. Argoverse 2 provides diverse and intriguing vehicle trajectories and environments for constructing autonomous driving systems. It records 10 various object types between dynamic and static categories including cars, buses, pedestrians, bicycles, etc. Each scenario is accompanied by a local vector map and 11 seconds (at a rate of 10 Hz) of trajectory data, detailing the 2D position, velocity, and orientation for all observed tracks relative to the ego vehicle's perspective within the local environment. More details about the dataset can be found in Supplementary Section 1a.\nAdditionally, to demonstrate the robustness and generalization of our approach, we further evaluate our method using the Waymo Open Motion Dataset v1.2.0 [46]. This dataset features over 570 hours of unique data, covering 1,750 kilometers of roadways and over 100,000 scenes, each lasting 20 seconds and recorded at 10 Hz. It includes detailed interactions between vehicles, pedestrians, and cyclists across six cities in the United States. More detailed results about this dataset are available in the Supplementary Section 1a."}, {"title": "Experiment Settings", "content": "Based on the trajectory prediction task setting, our generative world model predicts the agent's future states by observing the agent's historical information, map features, and the surroundings of neighboring agents. By iteratively performing this prediction process, TrafficGamer learns a"}, {"title": "", "content": "CCE solver to generate traffic congestion scenarios with varying degrees of competition. To verify the generative performance of our algorithm, we select six representative scenarios in the validation dataset of Argoverse 2 and Waymo respectively, including 1) Merge where two separate lanes of traffic join into a single lane, 2) Dual-lane intersection where five cars with different destinations are driving through a two-way intersection, 3) T-Junction where one road ends at a perpendicular junction with another road, forming a \"T\" shape, 4) Dense-lane intersection where cars enter a four-way intersection with dense traffic. 5). Roundabout where traffic flows counterclockwise around a central circle, and 6) Y-Junction where three directions of traffic flow converge at a single intersection. Figure 3 showcases the road map of our experiments in the last time step of historical trajectories. In the training procedure, we utilize all training datasets to learn the generative world model. During validation, we leverage validation datasets to evaluate our world model's performance. For the Fine-tuning stage, TrafficGamer controls 5-7 agents within the 6 scenarios selected from the validation datasets to obtain various safety-critical events by modeling different traffic congestion levels. More details about experiment settings can be found in Supplementary Section 1b."}, {"title": "Evaluation Metrics", "content": "We leverage a comprehensive set of statistical metrics to evaluate the fidelity and effectiveness of the proposed TrafficGamer. The metrics include:\nFidelity. The fidelity metrics measure how well the simulated traffic distribution (i.e., the distribution of vehicles' temporal and spatial features) matches the observed data distribution. We implement these fidelity metrics by f-Divergence $D_f(P||Q)$ which measures the divergence between two probability distributions P and Q over the space X, so that:\n$D_{f_\\alpha}(P||Q) = \\int_X f_{\\alpha} (\\frac{dP}{dQ}) dQ$                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  }"}]}