{"title": "Cost-Control in Display Advertising: Theory vs Practice", "authors": ["Anoop R Katti", "Rui C. Gon\u00e7alves", "Rinchin Iakovlev"], "abstract": "In display advertising, advertisers want to achieve a marketing objective with constraints on budget and cost-per-outcome. This is usually formulated as an optimization problem that maximizes the total utility under constraints. The optimization is carried out in an online fashion in the dual space - for an incoming Ad auction, a bid is placed using an optimal bidding formula, assuming optimal values for the dual variables; based on the outcome of the previous auctions, the dual variables are updated in an online fashion. While this approach is theoretically sound, in practice, the dual variables are not optimal from the beginning, but rather converge over time. Specifically, for the cost-constraint, the convergence is asymptotic. As a result, we find that cost-control is ineffective. In this work, we analyse the shortcomings of the optimal bidding formula and propose a modification that deviates from the theoretical derivation. We simulate various practical scenarios and study the cost-control behaviors of the two algorithms. Through a large-scale evaluation on the real-word data, we show that the proposed modification reduces the cost violations by 50%, thereby achieving a better cost-control than the theoretical bidding formula.", "sections": [{"title": "1 INTRODUCTION", "content": "In online display advertising, advertisers run Ad campaigns with a goal of achieving some marketing objectives, e.g. increasing the awareness/engagement of their brand, boosting sales, etc. Online Ads are often sold using auction mechanisms where the competing Ads place a bid and are charged for a user view or a click."}, {"title": "3 METHOD", "content": "We consider the problem of maximizing the total advertiser utility (cost-adjusted value) given a target budget and a target cost-per-view. Ad opportunities are sold using an auction mechanism. Similar to the literature [9, 16], we derive the optimal bidding formula for participating in Ad auctions. We then share a practical issue with cost-control and propose a modification that deviates from the theoretical derivation, but works in practice."}, {"title": "3.1 Optimal Bidding", "content": "Consider a single Ad campaign with an advertising budget of B and a target cost-per-view of Cview. Let the campaign participate in N Ad opportunities (i.e. Ad auctions). For the ith Ad opportunity, let bidi be the bid placed by this Ad campaign in the auction, xi be the resulting probability of a user view, vi be the value of the view to the advertiser and ci denote the cost of the view. We define the optimization objective as $\\sum_{i=1}^{N} x_{bidi} \\cdot (v_i - \\alpha c_i)$, where $0 \\leq \\alpha \\leq 1$ is the fraction of cost considered in the objective. If $\\alpha = 1$, we optimize for utility and if $\\alpha = 0$, we optimize for value. The optimization problem is formulated as:\n\n$\\begin{aligned}\n\\max & \\sum_{i=1}^{N} x_{bidi} \\cdot (v_i - \\alpha c_i) \\\\ \\\\\nsubject \\space to & \\sum_{i=1}^{N} x_{bidi} c_i \\leq B, \\\\ \\\\\n& \\sum_{i=1}^{N} x_{bidi} \\cdot c_i \\leq C_{view} \\cdot \\sum_{i=1}^{N} x_{bidi}, \\\\ \\\\\n& x_{bidi} \\in [0,1]^{N}\n\\end{aligned}$\n\nFor second-price auctions, solving the above optimization problem results in the following optimal bidding formula [9, 16]:\n\n$bid_{i} = \\frac{v_{i} + \\mu \\cdot C_{view}}{\\alpha + \\lambda + \\mu}$\n\nwhere $\\lambda > 0$ and $\\mu > 0$ are dual variables associated with the budget and the cost-per-view constraints respectively.\nEq 2 assumes that the dual variables are at their optimal values, $\\lambda^*$ and $\\mu^*$. However, $\\lambda^*$ and $\\mu^*$ are not known from the beginning. Rather, the dual variables are updated towards their optimal values in an online-fashion. Concretely, after each mini-batch of n auctions, $i_{t}: i_{t+1}$, the xi's materialise into binary outcomes, i.e. viewed or not viewed. Let $\\epsilon_{\\lambda}$ and $\\epsilon_{\\mu}$ be the learning rates for the online updates. Then $\\lambda$ and u are updated as 1:\n\n$\\begin{aligned}\n\\lambda^{t+1} & = max \\bigg[ \\lambda^{t} + \\frac{\\epsilon_{\\lambda}}{n} \\bigg( \\sum_{i_{t}}^{i_{t+1}} x_{i} c_{i} - B\\bigg), 0 \\bigg] \\\\ \\\\\n\\mu^{t+1} & = max \\bigg[ \\mu^{t} + \\frac{\\epsilon_{\\mu}}{n} \\bigg( \\sum_{i_{t}}^{i_{t+1}} x_{i} (c_{i} - C_{view})\\bigg), 0 \\bigg]\n\\end{aligned}$"}, {"title": "3.2 Practical Issue with Cost-control", "content": "In this section, we analyse the optimal bidding formula. Suppose budget is not an active constraint, i.e. B is sufficiently high. In this case, $\\lambda^{t} = \\lambda^* = 0$. Say, advertisers want a return on Ad-spend of R > 1. Then, the expected value, E[v] = R Cview and the (average)"}, {"title": "3.3 Improving Cost-control", "content": "As before, suppose budget is sufficiently high and is, therefore, not an active constraint. Intuitively, if the current cost-per-view is greater than Cview, u should increase over some $\\mu' < \\infty$, bid should drop below Cview and the cost-per-view should gradually decrease to Cview. Further, once the cost is under control, i.e. cost-per-view equals Cview, $\\mu$ should stabilise at $\\mu'$. Let's consider introducing an artificially discounted $C_{view} = \\beta\\cdot C_{view}$, $\\beta \\in [0, 1)$ in the original optimization (Eq 1c). With this change, the bid can now go below Cview and this happens at some $\\mu' < \\infty$. However, even after the cost-per-view decreases to Cview, the (average) error in Eq 3b continues to remain positive (as the errors are computed against Cview ). Consequently, u will not stabilise at $\\mu'$, but instead keeps increasing (asymptotically) to $\\infty$. This unnecessarily pushes the cost-per-view below the real target, Cview and negatively impacts the value generated to the advertiser.\nBased on this intuition, we propose the following change that does not conform to the theory, but takes the best of both worlds: modify the bidding formula as if there is a discounted target cost-per-view and leave the online updates in Eq 3a and Eq 3b unchanged. This results in the alternative bidding formula shown below:\n\n$bid_{i} = \\frac{v_{i} + \\mu \\cdot \\beta\\cdot C_{view}}{\\alpha + \\lambda + \\mu}$"}, {"title": "4 EVALUATION", "content": "In this section, we will first analyse the cost-control behaviors of the two bidding algorithms in different practical scenarios - the theoretically derived bidding formula and the proposed bidding formula. Then, we will perform quantitative comparison on large-scale real-world Ad opportunities and campaigns."}, {"title": "4.1 Simulations on Synthetic Data", "content": "The goal of the simulations is to qualitatively study the cost-control behaviors of the algorithms in different scenarios that are relevant in practice."}, {"title": "4.1.1 Set-up", "content": "We consider a single campaign with B as the budget for one day and Cview as the target cost-per-view. For simplicity of simulation, we choose the awareness objective, i.e. obtain user views; however, the analysis on cost-control should generalise to other marketing objectives such as engagement (i.e. clicks) and purchase (i.e. sales). In our simulations, we maximise utility, i.e. $\\alpha = 1$. The value of a view is set to, $v_{i} = R \\cdot C_{view}$, where R > 1 is a constant representing the advertisers' return on Ad spend. From real auctions, we have constructed a relationship between bid and view-rate. This is a property of the market. This relationship is visualised in Fig 2a. Notice that as bid increases, view-rate increases (polynomial with a degree 4). The price per view is 95% of the bid to emulate a second-price auction. We consider $O(10^6)$ Ad opportunities and that they are distributed as shown in Fig 2b to mimic the real traffic distribution. The dual variables, $\\lambda$ and $\\mu$, are initialised such that the initial bid is Cview (and $\\lambda = \\mu$). Further, they are updated every 1 minute with learning rate recommended in [9]."}, {"title": "4.1.2 Variants", "content": "We consider three variants\n(i) Max-cap: here, we apply a hard cap on the bid, where the cap is the target cost-per-view; specifically, $bid_{i} = min(v_{i}/(1 + \\lambda), C_{view})$.\n(ii) Cost-control-theoretical: here, we employ the bidding formula from Eq 2 to achieve the target cost-per-view.\n(iii) Cost-control-practical: here, we employ the proposed bidding formula from Eq 4 to achieve the target cost-per-view. We set $\\beta = 0$ as this provides the most flexibility to the algorithm to drop the bid all the way to 0, if necessary."}, {"title": "4.1.3 Metrics", "content": "We visualize the evolution of the dual variables, $\\lambda$ and $\\mu$, the actual and target cost-per-view and the actual and target spend."}, {"title": "4.1.4 Practical Scenario 1", "content": "Budget is the active constraint. Consider a scenario where budget is the active constraint, i.e. target cost-per-view is set to some high value. In this case, the optimal values for the dual variables are: $(R-1) < \\lambda^* < \\infty$ for all variants and $\\mu^* = 0$ for variants (ii) and (iii) (variant-(i) does not have $\\mu$). We find that after a few iterations, all three variants converge to the optimal values. This is visualised in Fig 3."}, {"title": "4.1.5 Practical Scenario 2", "content": "Cost is the active constraint. Consider a scenario where cost-per-view is the active constraint, i.e. budget is sufficiently high. In this case, the optimal values for the dual variables are $\\lambda^* = 0$ for all variants; variant-(i) does not have $\\mu$; for variant-(ii), $\\mu^* = \\infty$; for variant-(iii), $\\mu^* = R - 1$.\nWe find that variants-(i) and (iii) converge to their optimal values after a few iterations; variant-(ii) converges to $\\mu^{t} = 0$, but, as expected, $\\mu^t$ keeps growing. More importantly, in variant-(ii), since $\\mu^t$ never reaches to its optimal value, the cost-per-view is always higher than the target. On the other hand, Max-cap and Cost-control-practical reach the target cost-per-view. This is shown in Fig 4."}, {"title": "4.1.6 Practical Scenario 3", "content": "Budget is the active constraint and a cost-sensitive advertiser decreases the target cost-per-view. Consider a scenario where the advertiser is highly sensitive to the costs (and ultimately, return on Ad spend). At the beginning of the campaign, budget is the active constraint. However, the advertiser realises during the campaign that they are not achieving the desired return on Ad spend and decreases the target cost-per-view. Now the cost becomes the active constraint and $\\mu^t$ should go from $\\mu^* = 0$ to $\\mu^* = \\infty$ in the case of variant-(ii). This takes a long time and it leads"}, {"title": "4.1.7 Practical Scenario 4", "content": "Cost is the active constraint and advertiser moves the budget to a different channel. Consider a scenario where cost is the active constraint and that Cost-control-theoretical has reached a very high value asymptotically converging to the optimal, i.e. $\\mu^t > 0$. Imagine the advertiser realises that they could move the budget to, say, a different marketing channel where they are able to spend the budget. Suddenly, budget becomes the active constraint. Now, $\\mu^t$ should go from $\\mu^t > 0$ to $\\mu^t = 0$, which takes a long time. This results in a less efficient behavior from variant-(ii), which ends with a higher cost-per-view. This is shown in Fig 6."}, {"title": "4.1.8 Practical Scenario 5", "content": "Cost is the active constraint and the traffic becomes 2x. Consider a scenario where cost is the active constraint and that Cost-control-theoretical has reached a very high value asymptotically converging to the optimal, i.e. $\\mu^t > 0$. Assume the traffic on the platform dynamically doubles \u2013 this could be because of the traffic variation during the day or due to some special event like a sale. Suddenly, budget becomes the active constraint. As before, $\\mu^t$ should go from $\\mu^t > 0$ to $\\mu^t = 0$, which takes a long time. This results in a less efficient behavior from variant-(ii), which ends with a slightly higher cost-per-view. This is shown in Fig 7."}, {"title": "4.1.9 Practical Scenario 6", "content": "Budget is the active constraint and the traffic drops to 0.5x. Consider a scenario where budget is the active constraint and $\\mu^t = \\mu^* = 0$ for variants (ii) and (iii). Now consider that the traffic on the platform halves \u2013 this could happen due to the traffic variations within a day or a more drastic event like a system failure. Suddenly, cost becomes the active constraint. For Cost-control-theoretical, $\\mu^* > 0$ and the algorithm has to move towards this optimal value. This takes a long time, which leads to a higher violation of the cost-per-view constraint as compared to other variants. This can be observed in Fig 8."}, {"title": "4.1.10 Summary", "content": "We consider six different practical scenarios. Scenarios 1 and 2 are the most frequent ones. Scenarios 3 and 4, although less frequent, might be critical for a single advertiser who cares about costs (ultimately, return on Ad spend) and is optimizing for it. Scenarios 5 and 6 demonstrate the dynamic nature of the environment and they may be important for designing the algo-rithm. Moreover, the simulation, here, is simplistic (e.g. all views are equally valuable, view-rate increases smoothly with increasing bid, etc.). In the real-world, the actual impact from different scenarios may be different. This is presented in the next section."}, {"title": "4.2 Large-scale Evaluation on Real-world Data", "content": "The goal of the large-scale evaluation is to observe to what extent the target costs will be achieved on real-world campaign data and real-world Ad opportunities at scale. Additionally, we also want to observe the utility (cost-adjusted value) generated to the advertisers."}, {"title": "4.2.1 Set-up", "content": "For large-scale evaluation, we choose a click objective (engagement campaigns) as this differentiates the valuation of views based on their probability to convert to a click. We maximise utility, i.e. $\\alpha = 1$. We consider $O(10^7)$ Ad opportunities and $O(10^3)$ Ad campaigns. Each campaign participates in only a fraction of auctions due to targeting. The ads compete with organic content for user views (with organic content effectively acting as floors). For a given page, all variants receive the same number of views (regardless of the ranking of the content). If a page has K views, then they go to the top-K contents on the page. The clicks for each viewed content is sampled from the predicted click-through-rate. This assumes that the user behavior changes only after viewing the content, not before. The auction pricing is second-price. The payment event is view and the advertisers specify a target cost-per-view. The dual variables are updated every 1 minute with learning rate as recommended in [9]."}, {"title": "4.2.2 Variants", "content": "We test six variants: (i) Max-cap, (ii) Cost-control-theoretical, (iii)-(vi) Cost-control-practical with $\\beta = 0.8, 0.5, 0.2, 0.0$."}, {"title": "4.2.3 Metrics", "content": "Let M be the number of campaigns and let $C_{view}$ and $c_{view}^{j}$ be the target and actual cost-per-view of the jth campaign. Then, we measure the number of campaigns for which the cost-per-view constraint is violated by more than 5% of the target cost. That is,\n$M_{violations} = \\frac{1}{M} \\sum_{j=1}^{M} \\mathbb{1} \\bigg[\\frac{|c_{view}^{j} - C_{view}|}{C_{view}} > 0.05\\bigg]$\nAdditionally, let $u^j$ be the utility accrued by the jth campaign. We define Max-cap as the baseline variant and measure the relative uplift in the utility. That is,\n$U_{advertiser} = \\frac{1}{M} \\sum_{j=1}^{M} \\frac{(u_{variant}^{j} - u_{baseline}^{j})}{u_{baseline}^{j}}$\nWe find that the number of views for some campaigns can be very low and the number of clicks can be even lower (usually, 2 orders of magnitude smaller). This results in high variance in the above metrics that are based on cost-per-view and advertiser value (i.e. clicks). Therefore, we keep only those campaigns with more than 300 views and at least, 1 click in the baseline, still leaving $O(10^3)$ Ad campaigns, and we report the metrics on those campaigns."}, {"title": "4.2.4 Results", "content": "We show the results in Tab 1. From the table, we can see that Max-cap has zero violations on the target cost-per-view, but generates the lowest utility to the advertisers. Cost-control-theoretical violates the target cost-per-view on 8.15% of campaigns, but generates +22.09% uplift in utility compared to Max-cap. Cost-control-practical with $\\beta = 0.8, 0.5, 0.2, 0.0$ violate the target cost-per-view on only 4.12%, 5.13%, 5.21%, 5.46% of campaigns respectively while generating +22.60%, +25.84%, +17.49%, +11.68% uplifts in utility over Max-cap respectively. Moreover, compared to Cost-control-theoretical, Cost-control-practical reduces the cost violations by 50% while generating the same utility, with $\\beta = 0.8$ making the best trade-off. Based on the results, we also find that Cost-control-practical provides a more reliable cost lever to advertisers for steering their campaigns towards the desired volume and efficiency."}, {"title": "5 CONCLUDING REMARKS", "content": "Summary: We considered a scenario where advertisers run a marketing campaign to achieve a certain objective under budget and cost-per-outcome constraints. We showed the ineffectiveness of the theoretically derived bidding formula in meeting the cost constraints and proposed an adjusted bidding formula with a new $\\beta$ parameter. Through simulations and large-scale evaluations, we demonstrated that the proposed bidding formula reduces cost vio-lations by 50%.\nHow to select $\\beta$: The optimal value of $\\beta$ depends on how close the prices are to the bids, which is a property of the market itself. If the market competition is high, then prices (in second-price auctions) closely follow the winning bids. In this case, we need a lower $\\beta$ (say, 0.5) to push the bids and correspondingly, the prices down to achieve an effective cost control. On the other hand, if the market competition is low, then prices are much lower than the winning bids. In this case, a $\\beta$ slightly lower than 1 (say, 0.9) is already enough to push the prices down and control costs. A $\\beta$ close to 0 is not recommended as it negatively impacts the utility generated to the advertiser (as shown in Tab 1). Ultimately, $\\beta$ should be viewed as a hyperparameter that is tuned for the market.\nFuture work: While we proposed an alternative bidding formula and proved its effectiveness in an empirical manner, it still lacks a theoretical justification. Moreover, it is also not clear if this mod-ification is the most effective one. Future work will be to explore and compare with other modifications and possibly arrive at a theoretical justification."}, {"title": "6 AUTHOR CONTRIBUTIONS", "content": "Anoop leads the bidding algorithm design and contributed to setting up the problem, identifying the improvement, running simulations on the synthetic data and producing the results for large-scale evaluation. Rui contributed to identifying the improvement, running simulations on the synthetic data and the engineering implementa-tion. Rinchin contributed to the engineering implementation."}]}