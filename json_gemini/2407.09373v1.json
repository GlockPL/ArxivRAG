{"title": "Towards Personalised Patient Risk Prediction Using Temporal Hospital Data Trajectories", "authors": ["Thea Barnes", "Enrico Werner", "Jeffrey N. Clark", "Raul Santos-Rodriguez"], "abstract": "Quantifying a patient's health status provides clinicians with insight into patient risk, and the ability to better triage and manage resources. Early Warning Scores (EWS) are widely deployed to measure overall health status, and risk of adverse outcomes, in hospital patients. However, current EWS are limited both by their lack of personalisation and use of static observations. We propose a pipeline that groups intensive care unit patients by the trajectories of observations data throughout their stay as a basis for the development of personalised risk predictions. Feature importance is considered to provide model explainability. Using the MIMIC-IV dataset, six clusters were identified, capturing differences in disease codes, observations, lengths of admissions and outcomes. Applying the pipeline to data from just the first four hours of each ICU stay assigns the majority of patients to the same cluster as when the entire stay duration is considered. In-hospital mortality prediction models trained on individual clusters had higher F1 score performance in five of the six clusters when compared against the unclustered patient cohort. The pipeline could form the basis of a clinical decision support tool, working to improve the clinical characterisation of risk groups and the early detection of patient deterioration.", "sections": [{"title": "1 Introduction", "content": "In recent years, hospitals have transitioned from paper-based to electronic health records (EHR), enabling automatic data-processing to support clinical decisions [22, 15, 8, 6, 16]. To assist clinical decision-making, several Early Warning Scores (EWS) have been developed and deployed, including the National Early Warning Score 2 (NEWS2) which supports clinicians in the UK [5, 21, 20, 12]. These scoring systems make use of routinely collected data to measure a patient's overall health, with the aim of allowing early detection of patient deterioration towards in-hospital mortality, admission to ICU and/or cardiac arrest [11].\nWhilst the simplicity of the metric makes it easily understood, interpreted, and trusted by clinicians, the lack of patient personalisation means that the scoring system is less effective for certain patient subgroups such as the elderly, pregnant, paediatric, and COVID-19-positive patients [9, 6]. Furthermore, EWS are limited through their evaluation of instantaneous measurements [3]. We argue that ignoring the temporal dimension is suboptimal by not utilising similarities in patient trajectories observed in medical environments.\nPrevious studies have utilised patients' medical history and temporal EHR data, such as to predict hospital admissions [4], detect cardiovascular events and survival analysis [13]. Clustering algorithms have been applied to identify groups of patients such as those in ICU [22], ward patients [23], and cardiovascular clusters in sepsis patients [10], yet most studies have focused on static sets of observations. Few studies have applied clustering with longitudinal trajectories [1, 19]. Accounting for and embedding temporal information into patient subtyping could provide insights into the progression of deterioration, allowing earlier detection of serious adverse events in patients.\nHence, this study presents a pipeline in which patients are clustered based on the trajectories of their vital signs over the course of their stay in ICU. The identified clusters are then applied for prediction of in-hospital mortality risk, a frequent component of early warning scores. Explainability techniques are embedded to aid clinicians in understanding the models. With further development the presented pipeline could become a decision support tool by providing a personalised EWS, improving patient care."}, {"title": "2 Methodology", "content": null}, {"title": "2.1 Data Source", "content": "Electronic health records (EHR) were extracted from the Medical Information Mart for Intensive Care (MIMIC)-IV 2.0, covering hospital admission to the intensive care unit (ICU) between 2008 and 2019. In order to reduce computation time, 6,000 patients were randomly selected for which all vital sign measurements were available: comprising 48,994 sets of vital measurement readings in total. Vital sign measurements are respiration rate, oxygen saturation (SATS), temperature, systolic blood pressure, heart rate, and the Glasgow Coma Scale (GCS) which consists of eye-opening, motor, and verbal responsiveness.\nThough the vitals are collected routinely, individual vital measurements are usu-ally not taken at the same time and sets of measurements are not collected at regular intervals. Measurements taken within a period of 30 mins were grouped together. Missing vitals were imputed by taking the mean value of the patient's stay. Follow-ing existing protocol [23, 24] features found to be normally distributed (temperature, systolic blood pressure, respiration rate, and GCS eye) were scaled to unit variance, all others were scaled using the Min-Max scaler. The dataset contained a mixture of ICD-9 and ICD-10 codes. ICD codes (International Classification of Diseases) are a global standard for diagnostic health information and have a tree-like structure. For uniformity and comparability, this article used only the top-level classification layer and converted all ICD codes to the ICD-9 code standard. Conversion was achieved through backward mapping using GEM files (general equivalence mapping), follow-ing established protocol [7]."}, {"title": "2.2 Clustering of Trajectories", "content": "Clustering was carried out on the trajectories of temporally changing measurements. In order to compute pairwise similarities between misaligned patient vital time se-ries, independent Dynamic Time Warping (DTW) was used (Figure 1). DTW finds the optimal alignment between two time-series by minimizing the distance/cost func-tion. This technique allows the matching of patients with similar vital measurement progressions, albeit at different time intervals. DTW was computed independently for each vital sign and an overall distance matrix was computed by summing over the distance matrices for all vitals. This resulted in a 6,000 x 6,000 distance matrix of pairwise similarities between patient vitals.\nUniform Manifold Approximation and Projection (UMAP) was used for dimen-sion reduction as it preserves global and local structures [14]. Next, Hierarchical density-based spatial clustering of applications with noise (HDBSCAN*) was used to cluster the UMAP embeddings. UMAP coupled with HDBSCAN* is found to be the best pairing for time series clustering [2, 18, 17]. The number of clusters"}, {"title": "2.3 Mortality Prediction", "content": "After clustering, explainable boosting machine models were developed to predict risk of in-hospital mortality. In addition to the vital signs, features for risk prediction included patient characteristics: age and gender, admission details: first care-unit, last care-unit, admission type, admission location, length of stay, most occurring ICD code, second most occurring ICD code, and total number of unique ICD codes. Last care-unit and length of stay were not included in the models where reduced time frames of patient stays were considered. Feature importance was analysed for each cluster's model. Class imbalance resulting from low mortality rates (Table 1), was dealt with during training by implementing Synthetic Minority Over-sampling Technique for Nominal and Continuous (SMOTE-NC). Each model's performance was evaluated using stratified k-fold cross-validation with 10 folds. Predictive ability was compared between clusters against the entire unclustered patient cohort. We have made code available to run the entire pipeline 1."}, {"title": "3 Results and Discussion", "content": null}, {"title": "3.1 Entire ICU Stay", "content": "We identified six clusters with distinct characteristics in terms of vital signs, asso-ciated diagnostic codes, and length of stay and outcome (Right panel of Figure 1, Table 1). Internal validity, and therefore the optimal number of clusters, was veri-fied when the silhouette score was maximised, and the Calinksi-Harabasz index and Davis-Bouldin index reached a near local minimum at a minimum sample parameter of 60. The same number of clusters were identified in an independent study carried out across intensive care units at another US hospital system [22].\nF1 scores computed for five of the six cluster classifier models suggest improved risk prediction performance compared to the classifier developed on the unclustered data (Table 2). Models trained and tested on the data of patients belonging to cluster 2 averaged a precision of 0.862 up to a recall of 0.843 over ten train-test splits.\nPerformance for at least one cluster appeared better than the unclustered data across all computed metrics. Using feature trajectories as part of the pipeline limits the ease of interpretability and explainability compared to using individual measurement readings to cluster and predict patient outcomes. Prior to deployment, further work should be carried out to understand and describe the patient subtypes identified by these clusters, as demonstrated by previous studies [22, 24]. Sub-clustering may enable the identification of more clearly defined sub-types [24].\nFor most cluster models, age was the most important feature in predicting mor-tality, followed by the three features that include a reference to ICD codes which relate to patient diagnosis (Figure 2). Variations in the impact of features across the models are observed, demonstrated by the outliers where importance differs greatly between models. For instance, the two most important features for most clusters, age and the number of ICD codes, have an outlier each, suggesting these features are less important for clusters 4 and 5 respectively. Two of the interaction terms are more important in predictions for cluster 0 than models trained for other clusters. Future work could consider how some vital signs may be more important for certain patients than for others, for instance by computing their deviation from a healthy baseline and using this as a feature. Missing values were imputed with the patient's average value across the entire ICU stay for that feature. This would be problematic for deployment and is therefore a limitation of the presented method. Future work should consider more appropriate methods of imputation, such using the last known value: forward fill.\nCurrently the pipeline has been implemented on a single dataset with relatively few patients for demonstration purposes. Future work should include analysis on additional datasets to explore generalisability of the presented results."}, {"title": "3.2 Changing Time Horizons of ICU Stays", "content": "Figure 3 visualises cluster evolution. Using data from a time frame of the first 4 hours since admission, the highest risk cluster as discovered with the entire ICU stay data is already distinct (cluster 2, red). Cluster 3, the lowest risk cluster, and cluster 1, the second highest risk cluster are initially distinct (Figure 3a, top left) but merge over the 24 hour and 72 hour time frames. Once data comprising all measurements up to one week since admission are included, all six clusters have formed, with the majority of the same cluster labels as when the entire stay is used. However, of note clusters 1, 3, 4 and 5 appear least separated when using 24 and 72 hours of data (Fig 3b and c) compared to using less data (first four hours, Fig 3a) or more data (first week, Fig 3d). This suggests that the stages of patient journeys warrant investigation and could result in identifying the optimum length of time, or proportion of the total ICU stay, to use in the pipeline to results in the most distinct and clinically useful clusters. Future work should compare clustering and prediction performance when computed with all time points considered independent: i.e. not using trajectories.\nThe time points of diagnoses and associated knowledge of the development of health issues during the ICU stay could also be added as features in an effort to better subtype and warn of patient deterioration.\nIn general, it is observed that the embeddings of the reduced time frames of data all bear a strong resemblance to the structure and partitioning when utilising the data for the whole stay, despite the average length of stay for some clusters being several days longer than the trajectories considered in these reduced time frames (Table 1). A patient from Cluster 0 is particularly likely to be consistently assigned at all time frames considered, with over 80% of patients assigned to the same cluster at all time points. This suggests that certain patient subtypes can be successfully identified using a greatly limited subset of their trajectory data.\nAverage predictive performance varied across considered time frames (Figure 4). When data from the entire stay for each patient is considered, the highest average sensitivity and F1 score were observed. Specificity remains high across all time frames and achieves the lowest standard deviation across clusters compared to the other performance metrics. When only the first four hours of ICU stay data is considered, the weighted average standard deviation of specificity is smallest. A trend is seen where the mean F1 scores and sensitivities are high for the first four"}, {"title": "4 Conclusion", "content": "We present a pipeline to subtype patients based on the trajectories of their routinely collected vital signs over the course of their stay in ICU, and to predict in-hospital mortality risk on these patient clusters.\nThe pipeline is demonstrated in 48,994 sets of vital measurement readings across 6,000 patients' stays, revealing distinct patient characteristics and showing that sub-typing patients prior to risk prediction can boost predictive performance. Moreover, subsets of data from the entire stay are considered, down to the first four hours since admission, showing how patient trajectories and risk prediction evolve during their stay in ICU.\nFuture work should validate these findings from a larger cohort of patients from at least one alternative hospital, alongside addressing limitations of the presented study and suggestions for future work as described. A clinical decision support tool utilising the temporal dimension and grouping patients on their common trajectories,"}]}