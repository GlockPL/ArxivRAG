{"title": "Towards Personalised Patient Risk Prediction\nUsing Temporal Hospital Data Trajectories", "authors": ["Thea Barnes", "Enrico Werner", "Jeffrey N. Clark", "Raul Santos-Rodriguez"], "abstract": "Quantifying a patient's health status provides clinicians with insight into\npatient risk, and the ability to better triage and manage resources. Early Warning\nScores (EWS) are widely deployed to measure overall health status, and risk of ad-\nverse outcomes, in hospital patients. However, current EWS are limited both by their\nlack of personalisation and use of static observations. We propose a pipeline that\ngroups intensive care unit patients by the trajectories of observations data throughout\ntheir stay as a basis for the development of personalised risk predictions. Feature\nimportance is considered to provide model explainability. Using the MIMIC-IV\ndataset, six clusters were identified, capturing differences in disease codes, obser-\nvations, lengths of admissions and outcomes. Applying the pipeline to data from\njust the first four hours of each ICU stay assigns the majority of patients to the\nsame cluster as when the entire stay duration is considered. In-hospital mortality\nprediction models trained on individual clusters had higher F1 score performance\nin five of the six clusters when compared against the unclustered patient cohort.\nThe pipeline could form the basis of a clinical decision support tool, working to\nimprove the clinical characterisation of risk groups and the early detection of patient\ndeterioration.", "sections": [{"title": "1 Introduction", "content": "In recent years, hospitals have transitioned from paper-based to electronic health\nrecords (EHR), enabling automatic data-processing to support clinical decisions. To assist clinical decision-making, several Early Warning Scores (EWS)\nhave been developed and deployed, including the National Early Warning Score 2\n(NEWS2) which supports clinicians in the UK. These scoring systems\nmake use of routinely collected data to measure a patient's overall health, with the\naim of allowing early detection of patient deterioration towards in-hospital mortality,\nadmission to ICU and/or cardiac arrest.\nWhilst the simplicity of the metric makes it easily understood, interpreted, and\ntrusted by clinicians, the lack of patient personalisation means that the scoring system\nis less effective for certain patient subgroups such as the elderly, pregnant, paediatric,\nand COVID-19-positive patients. Furthermore, EWS are limited through their\nevaluation of instantaneous measurements. We argue that ignoring the temporal\ndimension is suboptimal by not utilising similarities in patient trajectories observed\nin medical environments.\nPrevious studies have utilised patients' medical history and temporal EHR data,\nsuch as to predict hospital admissions, detect cardiovascular events and survival\nanalysis. Clustering algorithms have been applied to identify groups of patients\nsuch as those in ICU, ward patients and cardiovascular clusters in sepsis\npatients, yet most studies have focused on static sets of observations. Few\nstudies have applied clustering with longitudinal trajectories. Accounting for\nand embedding temporal information into patient subtyping could provide insights\ninto the progression of deterioration, allowing earlier detection of serious adverse\nevents in patients.\nHence, this study presents a pipeline in which patients are clustered based on the\ntrajectories of their vital signs over the course of their stay in ICU. The identified\nclusters are then applied for prediction of in-hospital mortality risk, a frequent\ncomponent of early warning scores. Explainability techniques are embedded to aid\nclinicians in understanding the models. With further development the presented\npipeline could become a decision support tool by providing a personalised EWS,\nimproving patient care."}, {"title": "2 Methodology", "content": null}, {"title": "2.1 Data Source", "content": "Electronic health records (EHR) were extracted from the Medical Information Mart\nfor Intensive Care (MIMIC)-IV 2.0, covering hospital admission to the intensive\ncare unit (ICU) between 2008 and 2019. In order to reduce computation time,\n6,000 patients were randomly selected for which all vital sign measurements were\navailable: comprising 48,994 sets of vital measurement readings in total. Vital sign\nmeasurements are respiration rate, oxygen saturation (SATS), temperature, systolic\nblood pressure, heart rate, and the Glasgow Coma Scale (GCS) which consists of\neye-opening, motor, and verbal responsiveness.\nThough the vitals are collected routinely, individual vital measurements are usu-\nally not taken at the same time and sets of measurements are not collected at regular\nintervals. Measurements taken within a period of 30 mins were grouped together.\nMissing vitals were imputed by taking the mean value of the patient's stay. Follow-\ning existing protocol features found to be normally distributed (temperature,\nsystolic blood pressure, respiration rate, and GCS eye) were scaled to unit variance,\nall others were scaled using the Min-Max scaler. The dataset contained a mixture of\nICD-9 and ICD-10 codes. ICD codes (International Classification of Diseases) are a\nglobal standard for diagnostic health information and have a tree-like structure. For\nuniformity and comparability, this article used only the top-level classification layer\nand converted all ICD codes to the ICD-9 code standard. Conversion was achieved\nthrough backward mapping using GEM files (general equivalence mapping), follow-\ning established protocol."}, {"title": "2.2 Clustering of Trajectories", "content": "Clustering was carried out on the trajectories of temporally changing measurements.\nIn order to compute pairwise similarities between misaligned patient vital time se-\nries, independent Dynamic Time Warping (DTW) was used (Figure 1). DTW finds\nthe optimal alignment between two time-series by minimizing the distance/cost func-\ntion. This technique allows the matching of patients with similar vital measurement\nprogressions, albeit at different time intervals. DTW was computed independently\nfor each vital sign and an overall distance matrix was computed by summing over\nthe distance matrices for all vitals. This resulted in a 6,000 x 6,000 distance matrix\nof pairwise similarities between patient vitals.\nUniform Manifold Approximation and Projection (UMAP) was used for dimen-\nsion reduction as it preserves global and local structures. Next, Hierarchical\ndensity-based spatial clustering of applications with noise (HDBSCAN*) was used\nto cluster the UMAP embeddings. UMAP coupled with HDBSCAN* is found to\nbe the best pairing for time series clustering. The number of clusters"}, {"title": "2.3 Mortality Prediction", "content": "After clustering, explainable boosting machine models were developed to predict\nrisk of in-hospital mortality. In addition to the vital signs, features for risk prediction\nincluded patient characteristics: age and gender, admission details: first care-unit,\nlast care-unit, admission type, admission location, length of stay, most occurring\nICD code, second most occurring ICD code, and total number of unique ICD codes.\nLast care-unit and length of stay were not included in the models where reduced\ntime frames of patient stays were considered. Feature importance was analysed for\neach cluster's model. Class imbalance resulting from low mortality rates (Table 1),\nwas dealt with during training by implementing Synthetic Minority Over-sampling\nTechnique for Nominal and Continuous (SMOTE-NC). Each model's performance\nwas evaluated using stratified k-fold cross-validation with 10 folds. Predictive ability\nwas compared between clusters against the entire unclustered patient cohort. We\nhave made code available to run the entire pipeline."}, {"title": "3 Results and Discussion", "content": null}, {"title": "3.1 Entire ICU Stay", "content": "We identified six clusters with distinct characteristics in terms of vital signs, asso-\nciated diagnostic codes, and length of stay and outcome (Right panel of Figure 1,\nTable 1). Internal validity, and therefore the optimal number of clusters, was veri-\nfied when the silhouette score was maximised, and the Calinksi-Harabasz index and\nDavis-Bouldin index reached a near local minimum at a minimum sample parameter\nof 60. The same number of clusters were identified in an independent study carried\nout across intensive care units at another US hospital system.\nF1 scores computed for five of the six cluster classifier models suggest improved\nrisk prediction performance compared to the classifier developed on the unclustered\ndata (Table 2). Models trained and tested on the data of patients belonging to cluster\n2 averaged a precision of 0.862 up to a recall of 0.843 over ten train-test splits.\nPerformance for at least one cluster appeared better than the unclustered data across\nall computed metrics. Using feature trajectories as part of the pipeline limits the ease\nof interpretability and explainability compared to using individual measurement\nreadings to cluster and predict patient outcomes. Prior to deployment, further work\nshould be carried out to understand and describe the patient subtypes identified by\nthese clusters, as demonstrated by previous studies. Sub-clustering may\nenable the identification of more clearly defined sub-types.\nFor most cluster models, age was the most important feature in predicting mor-\ntality, followed by the three features that include a reference to ICD codes which\nrelate to patient diagnosis (Figure 2). Variations in the impact of features across the\nmodels are observed, demonstrated by the outliers where importance differs greatly\nbetween models. For instance, the two most important features for most clusters,\nage and the number of ICD codes, have an outlier each, suggesting these features\nare less important for clusters 4 and 5 respectively. Two of the interaction terms are\nmore important in predictions for cluster 0 than models trained for other clusters.\nFuture work could consider how some vital signs may be more important for certain\npatients than for others, for instance by computing their deviation from a healthy\nbaseline and using this as a feature. Missing values were imputed with the patient's\naverage value across the entire ICU stay for that feature. This would be problematic\nfor deployment and is therefore a limitation of the presented method. Future work\nshould consider more appropriate methods of imputation, such using the last known\nvalue: forward fill.\nCurrently the pipeline has been implemented on a single dataset with relatively\nfew patients for demonstration purposes. Future work should include analysis on\nadditional datasets to explore generalisability of the presented results."}, {"title": "3.2 Changing Time Horizons of ICU Stays", "content": "Figure 3 visualises cluster evolution. Using data from a time frame of the first 4\nhours since admission, the highest risk cluster as discovered with the entire ICU stay\ndata is already distinct (cluster 2, red). Cluster 3, the lowest risk cluster, and cluster\n1, the second highest risk cluster are initially distinct (Figure 3a, top left) but merge\nover the 24 hour and 72 hour time frames. Once data comprising all measurements\nup to one week since admission are included, all six clusters have formed, with the\nmajority of the same cluster labels as when the entire stay is used. However, of note\nclusters 1, 3, 4 and 5 appear least separated when using 24 and 72 hours of data\n(Fig 3b and c) compared to using less data (first four hours, Fig 3a) or more data (first\nweek, Fig 3d). This suggests that the stages of patient journeys warrant investigation\nand could result in identifying the optimum length of time, or proportion of the total\nICU stay, to use in the pipeline to results in the most distinct and clinically useful\nclusters. Future work should compare clustering and prediction performance when\ncomputed with all time points considered independent: i.e. not using trajectories.\nThe time points of diagnoses and associated knowledge of the development of health\nissues during the ICU stay could also be added as features in an effort to better\nsubtype and warn of patient deterioration.\nIn general, it is observed that the embeddings of the reduced time frames of data\nall bear a strong resemblance to the structure and partitioning when utilising the data\nfor the whole stay, despite the average length of stay for some clusters being several\ndays longer than the trajectories considered in these reduced time frames (Table 1).\nA patient from Cluster 0 is particularly likely to be consistently assigned at all time\nframes considered, with over 80% of patients assigned to the same cluster at all\ntime points. This suggests that certain patient subtypes can be successfully identified\nusing a greatly limited subset of their trajectory data.\nAverage predictive performance varied across considered time frames (Figure 4).\nWhen data from the entire stay for each patient is considered, the highest average\nsensitivity and F1 score were observed. Specificity remains high across all time\nframes and achieves the lowest standard deviation across clusters compared to the\nother performance metrics. When only the first four hours of ICU stay data is\nconsidered, the weighted average standard deviation of specificity is smallest. A\ntrend is seen where the mean F1 scores and sensitivities are high for the first four"}, {"title": "4 Conclusion", "content": "We present a pipeline to subtype patients based on the trajectories of their routinely\ncollected vital signs over the course of their stay in ICU, and to predict in-hospital\nmortality risk on these patient clusters.\nThe pipeline is demonstrated in 48,994 sets of vital measurement readings across\n6,000 patients' stays, revealing distinct patient characteristics and showing that sub-\ntyping patients prior to risk prediction can boost predictive performance. Moreover,\nsubsets of data from the entire stay are considered, down to the first four hours since\nadmission, showing how patient trajectories and risk prediction evolve during their\nstay in ICU.\nFuture work should validate these findings from a larger cohort of patients from\nat least one alternative hospital, alongside addressing limitations of the presented\nstudy and suggestions for future work as described. A clinical decision support tool\nutilising the temporal dimension and grouping patients on their common trajectories,"}]}