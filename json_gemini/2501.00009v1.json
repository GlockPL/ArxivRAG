{"title": "Model-Driven Deep Neural Network for Enhanced AoA Estimation Using 5G gNB", "authors": ["Shengheng Liu", "Xingkang Li", "Zihuan Mao", "Peng Liu", "Yongming Huang"], "abstract": "High-accuracy positioning has become a fundamental enabler for intelligent connected devices. Nevertheless, the present wireless networks still rely on model-driven approaches to achieve positioning functionality, which are susceptible to performance degradation in practical scenarios, primarily due to hardware impairments. Integrating artificial intelligence into the positioning framework presents a promising solution to revolutionize the accuracy and robustness of location-based services. In this study, we address this challenge by reformulating the problem of angle-of-arrival (AoA) estimation into image reconstruction of spatial spectrum. To this end, we design a model-driven deep neural network (MoD-DNN), which can automatically calibrate the angular-dependent phase error. The proposed MoD-DNN approach employs an iterative optimization scheme between a convolutional neural network and a sparse conjugate gradient algorithm. Simulation and experimental results are presented to demonstrate the effectiveness of the proposed method in enhancing spectrum calibration and AoA estimation.", "sections": [{"title": "Introduction", "content": "Development of the forthcoming wireless communications entails the exploration and integration of cutting-edge technologies and paradigms for diverse and emerging applications (You et al. 2023). Among the essential components, high-accuracy positioning functionality assumes a critical role in guaranteeing a seamless user experience and accommodating various use cases such as emergency response, asset tracking, and location-based services (Sun, Melamed, and Kitani 2021). Despite being in its nascent stages, an escalating number of 5G mobile base stations (a.k.a. gNBs) have been deployed on a massive scale in both indoor and outdoor areas, offering an extraordinary platform for supporting positioning services (Pai and Kumar 2019). As a result, there is a renewed drive for the perception of the surrounding environment and the provision of location-aware services from the physical layer to the application layer.\nIn Release 16 of the 3GPP, which was finalized in 2021, several positioning schemes for 5G new radio (NR) have been introduced. These include Downlink-time-difference-of-arrival (DL-TDoA), uplink-time-difference-of-arrival (UL-TDoA), downlink-angle-of-departure (DL-AoD), uplink-angle-of-arrival (UL-AoA), and multi-round trip time (Multi-RTT) positioning. Among these schemes, UL-AoA has been identified as more feasible for mitigating the multipath effect of the receive signal and enhancing the positioning performance, as it aligns with the trend towards increasing array size and bandwidth. However, purely model-driven AoA estimation algorithms usually suffer from hardware impairments that can affect the array response used in the estimation process (Pan et al. 2022).\nBy leveraging artificial intelligence (AI) algorithms, such as machine learning and deep neural networks (DNN), wireless networks can now dynamically learn and adapt to real-world conditions, compensating for hardware impairments and environmental variations (Dai et al. 2022; Lee et al. 2023). To address this issue, data-driven methods, such as DNN-based direction finding techniques, have surged exponential popularity (Ghourchian, Allegue-Martinez, and Precup 2017; Mo and Morgado 2023). Nonetheless, the accuracy of such methods is heavily reliant on the availability of massive data sets, which hinders their translation to practical uses. The integration of neural network (NN) and model-driven methods (Zhu et al. 2022; Huang et al. 2023) provides inspiration for developing a model-driven deep learning method to mitigate the impact of hardware impairments and improve the AoA estimation performance.\nBuilding on these recent advancements, this paper presents an innovative model-driven deep neural network (MoD-DNN) framework, featuring spectrum calibration capabilities to enhance AoA estimation. Simulation and experimental results demonstrate that the proposed framework yields superior AoA estimation performance compared to both purely model-driven and data-driven methods. To the best of our knowledge, this study marks the first AI-empowered positioning endeavor utilizing commodity 5G NR gNB. The key contributions of this paper include: (1) The problem formulation of an inverse problem from the coarray spatial spectrum (CSS) to a sparse solution of the over-completed AoA set; (2) Employing a one-dimensional convolutional neural network (1D-CNN) for CSS calibration, followed by a sparse conjugate gradient (SCG) algorithm for sparse AoA spectrum recovery; and (3) Proposing an iterative optimization strategy utilizing shared CNN coefficients between the CNN and SCG modules to establish"}, {"title": "Related Work", "content": "Recently, the success of machine learning across a wide range of disciplines gave rise to NN-aided AoA estimation. With the continuous enhancement of computational power, NN have widespread application in localization systems.\nNumerous studies utilize deep CNNs to directly map input signals to estimated AoA parameters in an end-to-end fashion (Xuan et al. 2023). Augmenting the DNN architecture enables both offline and online learning for AoA estimation (Huang et al. 2018), with multiple hidden layers enhancing recognition potential and sparse feature extraction within the angular domain (Gehring et al. 2021). However, their efficacy hinges on NN's generalization capacity (Kotary et al. 2021), necessitating substantial training data and associated labels.\nAlternative methodologies incorporate a feature learning strategy (Hou et al. 2019), yielding a subtle improvement in physical interpretability. By leveraging neural networks, specific input parameter features (Naseri et al. 2022) are acquired and refined, subsequently applied for AoA estimation, thereby reinforcing the linkage between input and estimated parameters with discernible physical significance. Nonetheless, these approaches, centered solely on training a single parameter (Jiang et al. 2019), run the risk of omitting valuable information pertinent to other critical feature parameters.\nDiverging from pure data-driven neural networks, certain methodologies integrate principled mathematical models with data-driven systems, reaping the strengths of both paradigms (Zhou, Li, and Wang 2020; Zhu et al. 2020; Fan et al. 2023). Hybrid model-driven deep learning schemes have been advanced to synergize prior statistical models (Merkofer et al. 2022; Hasanzade-Zonuzy, Kalathil, and Shakkottai 2021). These hybrid methods strategically harness partial domain knowledge provided by mathematical structures tailored to specific problems, while also leveraging learning from limited data.\nEnd-to-End Learning\nFeature Learning\nModel-Driven Learning"}, {"title": "Problem Formulation", "content": "To begin with, we consider the ideal signal output in an uplink positioning scenario. Without loss of generality, the field of view is quantified using uniform discrete AoA set $\\theta = [\\theta_1, \\theta_2,\\ldots\\ldots, \\theta_L]^T$ with a size of L, the antenna array of 5G gNB is an M-element uniform linear array (ULA) with unit inter-element spacing equivalent to half wavelength. Assuming that the uniform frequency increment of the orthogonal frequency division multiplexing (OFDM) signal with K-subcarrier is much smaller than the central carrier frequency, the signal of the k-th subcarrier is expressed as\nIdeal Signal Model\n$$x_k(t) = \\sum_{l=1}^L a(\\theta_l)s_{l,k}(t) + n_k(t)$$\n$$= A(\\theta)s_k(t) + n_k(t), t = 1,\\ldots, T,$$\nwhere $s_{l,k}(t)$ represents the component on the k-th subcarrier of the sounding reference signal (SRS) transmitted by the UE locating at azimuth $\\theta_l$. $n_k(t)$ denotes the additive white Gaussian noise (AWGN). $a(\\theta_l) = [1,\\ldots, e^{j\\pi(M-1)sin\\theta_l}]^T$ and $A(\\theta) = [a(\\theta_1),\\ldots,a(\\theta_L)]$ are the steering vector and array manifold, respectively. Note that, the above ideal array manifold A is exactly determined by the azimuth of the UE and the ideal array configuration. By implementing fast Fourier transform (FFT), the channel state information (CSI) of the k-th subcarrier is derived as\n$$h(k) = A(\\theta)\\check{s}(k) + \\check{n}(k), k = 1,\\ldots, K,$$\nwhere $\\check{s}(k)$ and $\\check{n}(k)$ are signal and noise in frequency domain. In this case, h(k) is equivalent to a single snapshot signal. As hardware impairments generally exist in real-world systems, leading to the mismatch of the steering vectors $a(\\theta_l)$ in the real system and the ideal $a(\\theta)$, the performance of purely model-driven AoA estimators based on the ideal signal model usually degrade in practice.\nSeveral types of error are proposed to model the effect of hardware impairments, which are the element position error, gain and phase inconsistencies, and mutual coupling (Pan et al. 2023). In most cases, the hardware impairments lead to phase error versus different AoAs. To precisely model the phase error into the signal model, the CSI-form receive signal of a practical system can be expressed as\nEffect of Hardware Impairments\n$$h(k) = \\sum_{l=1}^L \\gamma(\\theta_l) \\odot a(\\theta_l)s_{l,k}(t) + n_k(t)$$\n$$= \\Gamma A(\\theta)\\check{s}(k) + \\check{n}(k),$$\nwhere $\\gamma(\\theta_l) = [\\gamma_1(\\theta_l),\\ldots, \\gamma_M(\\theta_l)]^T$ and error matrix $\\Gamma = [\\gamma(\\theta_1); \\cdots ; \\gamma(\\theta_L)]$. The coefficient $\\gamma_m(\\theta_l)$ denotes the phase error of the m-th antenna for azimuth $\\theta_l$. Thus, the practical steering vector $\\tilde{a}(\\theta_l) = \\gamma(\\theta_l) \\odot a(\\theta_l)$, and practical array manifold $\\tilde{A}(\\theta) = [\\tilde{a}(\\theta_1),\\ldots\\ldots,\\tilde{a}(\\theta_L)]$. Formula (3) reveals that the hardware impairment results in angular-dependent and nonlinear phase error in practical system."}, {"title": "Network Framework", "content": "To overcome the aforementioned influence, we propose a MoD-DNN framework with the ability of spectrum calibration to enhance AoA estimation performance. A sketch of the proposed framework is illustrated in Figure 1. In the preprocessing module, we first reformulate the input signal to a co-array signal form. Then, the MoD-DNN reconstruct the sparse spatial spectrum via iterative optimization between 1D-CNN and SCG. In the following, we respectively introduce those modules of the proposed framework in detail.\nConsidering the discrete AoA set $\\theta$, the covariance matrix of h(k) in practical system is\nPreprocessing\nCoarray Spatial Spectrum"}, {"title": "MOD-DNN Module", "content": "As shown in the overall iteration illustrated in Figure 2(a), the AoA resolution of the CSS is relatively low, and the position of the peak is inaccurate. To enhance the AoA estimation performance, the reconstruction of the spatial spectrum is expressed as the following optimization problem\n$$ \\eta = \\arg \\min_{\\eta} ||P\\eta - \\hat{\\eta}||_3 + \\lambda ||E_w(\\eta)||_2,$$\nwhere $E_w$ is a regularization term denoting the combination of noise and hardware impairments, which can be learned by training a w-weighted CNN. The regularization coefficient $\\lambda$ is set as a trainable parameter as trade-off between calibration and reconstruction and can be fixed during the iterations. As such, the regularization term can be further expressed as $E_w(\\eta) = (I - C_w)(\\eta) = \\eta - C_w(\\eta)$, where $C_w(\\eta)$ is a calibrated version of $\\eta$ after the repairment of hardware impairments and noise. By utilizing the method of alternative optimization, the problem (6) is equivalent to the following iterations\nIterative Optimization\n$$z^i = C_w(\\eta^i),$$\n$$ \\eta^{i+1} = \\arg \\min_{\\eta} ||P\\eta - \\eta^i ||^2 + \\lambda ||\\eta - z^i||^2.$$\nNow we introduce the SCG algorithm used in the MoD-DNN module. We reconstruct the spatial spectrum $\\eta$ by solving the sub-problem (7b) using a forward model. Conjugate gradient (CG) algorithm is usually utilized to solve such problem efficiently. All CG-steps have closed-form solutions which means no parameter needs extra training, and the gradients can be backpropagated from\nSCG Algorithm\n$$ \\eta^{i+1} = \\arg \\min_{\\eta} ||P\\eta - \\eta^i ||^2 + \\lambda ||\\eta - z^i||^2 + \\mu \\cdot s(\\eta),$$\nwhere $\\mu$ is the regularization coefficient with respect to sparsity constraint. Then, the minimization problem can be solved in an iterative method between CG solutions and sparsity modification. Without loss of generality, we can use reweighted zero attracting function as\n$$ s(\\eta^{(n)}) = log (1 + ||\\eta^{(n)}||_{1/\\epsilon}),$$\nwhere $\\epsilon$ is an approximation parameter. The corresponding subgradient function in expressed as\n$$ \\nabla s(\\eta^{(n)}) = \\frac{sgn(\\eta^{(n)})}{1 + \\epsilon ||\\eta^{(n)} ||_1},$$\nwhere $sgn(.)$ is the signum function. We summarize the SCG-based spatial spectrum reconstruction (SSR) algorithm in Algorithm 1.\nIn this subsection, we introduce the 1D-CNN structure which is used as the spectrum calibrator in (7a) to effectively calibrate non-linear hardware impairments widespread in real-world systems. Unlike the mapping relationships between array output and angle information in end-to-end learning method (Yang et al.\nTraining of CNN-based Calibrator"}, {"title": "Experimental Results", "content": "In this section, we demonstrate the effectiveness of AoA estimation with existence of hardware impairments using the proposed MoD-DNN, especially in comparison with multiple signal classification (MUSIC) algorithm, DeepMUSIC algorithm (Elbir 2020) and CNN (Liu et al. 2023). All novel datasets and codes introduced in this paper will be made publicly available upon publication of the paper with a license that allows free usage for research purposes.\nWe consider a simulation scenario where a 5G gNB receives SRS signals transmitted by a user equipment (UE) in LOS condition. The CSI data is generated by the latest link-level 5G communications simulator (Jia et al. 2023). The simulator can incorporate customized hardware impairment functions and simulate channels in line with the 3GPP TR 38.901 standard. The indoor factory LoS channel at sub-\nNumerical Simulations"}, {"title": "Simulation Settings", "content": "The central carrier frequency of the OFDM signal is $f_c$, and uniform frequency increment is $\\Delta f$. The distance of UE from 5G gNB is fixed at R. The AoA of UE varies in with angular interval $\\Delta \\theta$. The parameter settings are listed in Table 1. Note that, B and $P_{UE}$ respectively denote system bandwidth and power of UE. For each AoA, 45 SRS symbols are generated with the existence of error matrix $\\Gamma$ by the simulator. As such, We extract 1201 \u00d7 40 = 48040 groups of data for network training and 1201 x 5 = 6005 for validation."}, {"title": "Spatial Spectrum Results", "content": "In the first set of simulations, the spatial spectrum results of MUSIC, DeepMUSIC and MoD-DNN at -45\u00b0, 45\u00b0 are presented in Figure 4, in which signal-to-noise ratio (SNR) is fixed to 10 dB. It can be observed that MUSIC, DeepMUSIC and MoD-DNN can yield the spatial spectrum with a single peak which indicates the AoA of UE. However, due to the spectrum, the AoAs estimated by MUSIC and DeepMUSIC obviously deviate from the true value. As one of model-driven deep learning schemes, DeepMUSIC's performance is constrained without appropriate calibration for phase errors. Meanwhile, the spatial spectrum of the DeepMUSIC algorithm exhibits more fluctuations compared to the original MUSIC algorithm, which indicates a more severe impact of phase errors. As a comparison, the proposed MoD-DNN has the sharpest peak which accurately estimate the AoA."}, {"title": "RMSE of AoA Estimation", "content": "In order to further compare the estimation accuracy, we observe the RMSE of different algorithms versus SNR. As shown in Figure 5(a), the performance of MUSIC and DeepMUSIC almost remain unchanged as SNR varies. This phenomenon indicates that these algorithm are statistically invalid with the existence of hardware impairments. Different from that, the RMSES of CNN and the proposed MoD-DNN both decrease while MOD-DNN consistently outperforms the CNN. Compared to the purely data-driven CNN, the proposed MoD-DNN can effectively utilize the knowledge of signal model. Accordingly, we observe that the advantage of MoD-DNN becomes more obvious in high SNR region. To validate the effectiveness for impairment calibration of the proposed method, we further compare the RMSEs for different cases of impairment. Specifically, we use a weight coefficient $p$ for error matrix $\\Gamma$ varies from 0 to 1 to simulate the degree of impairment. As illustrated in Figure 5(b), DeepMUSIC and MUSIC perform well under low impairment condition. However, the performances become worse as $p$ increases. On the contrary, the performances of CNN and MoD-DNN only fluctuates slightly. Owing to the integration of NN and SCG, MoD-DNN successfully mitigates the influence of hardware impairments and outperforms the data-driven CNN."}, {"title": "Convergence Speed of Algorithms", "content": "In the final simulation, we observe the standard deviation (SD) of loss versus epoch to evaluate the convergence speed of different algorithms. It is worth mentioning that we take the convergence value as the expectation to calculate the standard deviation. As shown in Figure 5(c), the SD of MoD-DNN converges rapidly compared to CNN and DeepMUSIC, which showcase the advantage of MoD-DNN with respect to training efficiency. So far, the effectiveness in terms of impairment calibration and estimation accuracy are validated by the numerical simulation."}, {"title": "Experiment in an Anechoic Chamber", "content": "In this subsection, we compare the AoA estimation performance of different methods in an anechoic chamber. Experiments conducted in an anechoic chamber provide valuable insights as NLoS and multipath propagation are absent. In this controlled environment, hardware impairments are the primary challenges to the accuracy of AoA estimation. The experimental setups are illustrated in Figure 6."}, {"title": "Experimental Settings", "content": "We employs the UE and gNB for signal transmitting and receiving, respectively. The AoA of UE is rotated from -60\u00b0 to 60\u00b0 by a uniform angle interval of 1\u00ba during the data acquisition process. For each AoA, 450 SRS symbols are transmitted by the UE. Then, the sounded CSIs are collected by the 5G gNB, yielding 121 \u00d7 450 = 54450 groups of CSI data. We extract 121 \u00d7 400 = 48400 groups of data for network training and 121 \u00d7 50 = 6050 for validation."}, {"title": "CDF of AoA Estimation Error", "content": "The cumulative distribution function (CDF) curves of AoA estimation error are provided in Figure 7(a), which affirm the remarkable accuracy of the proposed MoD-DNN, outperforming all other methods. Particularly noteworthy is the MoD-DNN's capacity to achieve a minimum 95% reduction in the 80th percentile of AoA estimation error, from around 3\u00b0 to 0.15\u00b0."}, {"title": "Boxplots of AoA Estimation Error", "content": "We proceed to evaluate the AoA estimation performance of various methods through boxplots portraying estimation errors across varying angular sectors. Specifically, the field of view is segmented into four subregions: [-60\u00b0, -30\u00b0), [-30\u00b0, -0\u00b0), [0\u00b0, 30\u00b0), and [30\u00b0, 60\u00b0]. The box's lower and upper boundaries correspond to the first quartile (Q1) and third quartile (Q3), respectively. The upper and lower whiskers respectively indicate the maximum and minimum estimation errors after removal of outliers (data with errors exceeding 1.5 times Q3). The median is represented by a horizontal line positioned above the box.\nAs displayed in Fig, 7(b), within the angular regions of [-30\u00b0, -0\u00b0) and [0\u00b0, 30\u00b0), the estimation results of all algorithms exhibit relatively accurate performance, with median errors of approximately less than 1\u00b0. This outcome is attributed to the minimal impact of angular-dependent phase errors in these specific regions. As the AoA of the User Equipment (UE) extends to the angular regions of [-60\u00b0, -30\u00b0) and [30\u00b0, 60\u00b0], the severity of phase errors escalates. Consequently, the MUSIC and DeepMUSIC algorithms experience significant performance degradation. For these two algorithms, the maximum errors are approximately 10\u00b0 and 6.5\u00b0, respectively, while the medians hover around 2\u00b0. The substantial fluctuation in phase errors also contributes to a high IQR for MUSIC and DeepMUSIC.In comparison, CNN and MoD-DNN are less affected by these conditions. Remarkably, the proposed MoD-DNN algorithm demonstrates superior performance across all assessed indicators represented by the box plots, encompassing maximum error, median error, and IQR in all angular regions. This phenomenon indicates a robust estimation performance of MoD-DNN and validates the effectiveness of error calibration for MoD-DNN."}, {"title": "Computational Complexity", "content": "Lastly, the computational efficiency of MUSIC, DeepMUSIC, CNN, and MoD-DNN are compared. The running times are all recorded by the timer of PyTorch on a PC with Intel(R) Core(TM) i7-1065G7 CPU and a 16-GB RAM. The result is shown in TABLE. 2 while the training time is mentioned in hours, whereas the testing time is mentioned in milliseconds.\nIn comparison to algorithms generating spatial spectra as output, the CNN algorithm boasts a notably shorter training duration due to its direct output of low-dimensional AoA values. In the case of the MoD-DNN algorithm and the DeepMUSIC algorithm, the former capitalizes on the weight-sharing strategy within the CNN module and the closed-form solutions of the SCG algorithm. Consequently, the training parameters number of MoD-DNN is fewer than that of DeepMUSIC, resulting in a clear advantage in training time. In terms of testing time, it's clear that the computational time for all algorithms stays within the millisecond range, thus ensuring efficient real-time implementation."}, {"title": "Conclusion", "content": "This study addresses AoA estimation in the presence of hardware impairments. We reformulate direction finding as spatial spectrum reconstruction through an inverse problem formulation. The iterative optimization between CNN and SCG enhances spatial spectrum calibration, leading to improved estimation precision. Simulation and experimental findings confirm the superiority of our proposed framework over both pure model-driven and data-driven approaches. Our insights into hybrid AI-and-model-driven methodologies hold promise for mitigating radio-frequency hardware-related challenges and enhancing the overall system reliability and efficiency for the broader spectrum of wireless tasks."}]}