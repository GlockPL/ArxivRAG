{"title": "Classifier-Free Diffusion-Based Weakly-Supervised Approach for Health Indicator Derivation in Rotating Machines: Advancing Early Fault Detection and Condition Monitoring", "authors": ["Wenyang Hu", "Gaetan Frusque", "Tianyang Wang", "Fulei Chu", "Olga Fink"], "abstract": "Deriving health indicators of rotating machines is crucial for their maintenance. However, this process is challenging for the prevalent adopted intelligent methods since they may take the whole data distributions, not only introducing noise interference but also lacking the explainability. To address these issues, we propose a diffusion-based weakly-supervised approach for deriving health indicators of rotating machines, enabling early fault detection and continuous monitoring of condition evolution. This approach relies on a classifier-free diffusion model trained using healthy samples and a few anomalies. This model generates healthy samples. and by comparing the differences between the original samples and the generated ones in the envelope spectrum, we construct an anomaly map that clearly identifies faults. Health indicators are then derived, which can explain the fault types and mitigate noise interference. Comparative studies on two cases demonstrate that the proposed method offers superior health monitoring effectiveness and robustness compared to baseline models.", "sections": [{"title": "1. Introduction", "content": "Intelligent health monitoring techniques for rotating machines are crucial for ensuring stable operation throughout their lifecycle. Health monitoring and early fault detection typically rely on data collected from accelerometer measurements, from which health indicators (HI) are learned or constructed to assess the machine's condition. These HIs can be viewed as a type of anomaly score that provides information on the severity of the anomalous condition [1, 2, 3]. By tracking the constructed HI, the evolution of the degradation severity in rotating machines can be monitored, enabling the optimization of effective maintenance strategies. One of the main challenges is distinguishing variations in the health indicator caused by changes in environmental and operational conditions or noisy environments from those that genuinely stem from abnormal conditions. The induced noise is particularly challenging as it is often complex, multi-sourced.\nRotating machines typically operate under healthy conditions for most of their lifecycle, which limits the availability of anomalous samples [4]. To address these challenges, weakly-supervised or unsupervised health monitoring and early fault detection approaches have been developed[5, 3]. These models can be broadly categorized into classical machine learning-based methods [6] and more recently developed deep learning methods [7]. Over the past decade, classical machine learning methods, such as Gaussian mixture models (GMM) and hidden Markov models(HMM), have been introduced to many rotating machine health monitoring and early fault detection tasks [8]. Although these methods have achieved good results in some applications, they still lack the ability to construct robust and effective health indicators for complex time series data, such as the data with long time dependency or large noise interference [9].\nIn contrast, deep learning techniques have rapidly developed in recent years and have been successfully employed in various applications of rotating machines health monitoring[7]. A widely used approach is to construct anomaly scores and monitor the health condition of assets with the reconstruction errors [10]. In reconstruction-based methods, autoencoder-based approaches, auto-regressive models, and methods mapping from operating conditions to sensor measurements are utilized [11, 12, 10]. These methods aim to learn the distribution of healthy samples and use the deviations"}, {"title": "2. Preliminaries", "content": ""}, {"title": "2.1. Denoising Diffusion Probabilistic Models", "content": "The denoising diffusion probabilistic models (DDPM) were first proposed by Ho et al. in 2020[19]. After this method was proposed, it has achieved a series of applications, such as data augmentation, image generation, and video generation[20, 21, 22]. The DDPM generally consists of two processes: the forward process and the backward process. In the forward process, Gaussian noise is progressively added to the original training sample xo over T time steps. This forward process q at step t can be expressed as:\n$q(X_t|X_{t-1}) = N(x_t; \\sqrt{\\bar{\\alpha}_t} x_{t-1}, (1 - \\alpha_t)I)$\nwhere t \u2208 {1, ...,T}. 1 $a_t$ corresponds to the noise intensity at each step. For an arbitrary step t, the processed sample $x_t$ can be expressed as:\n$x_t = \\sqrt{\\bar{\\alpha}_t} x_0 + \\sqrt{1 - \\bar{\\alpha}_t} \\zeta, \\zeta \\sim N(0, I)$\nwhere $\\bar{\\alpha_t} = \\prod_{i=1}^t \\alpha_i$.\nConversely, the reverse process aims to denoise and recover the initial distribution from the noisy samples $x_T$. For an arbitrary time step t, the reverse denoising process p can be expressed as:\n$p_\\theta(x_{t-1}|x_t) = N(x_{t-1}; \\mu_\\theta(x_t, t), \\Sigma_\\theta(x_t,t))$"}, {"title": "2.2. Controlled samples generation based on Diffusion models", "content": "Controlled sample generation refers to the process of systematically generating sample data or instances under specific constraints and conditions. In practical applications, many of these tasks require label information. By incorporating the classifier guidance mechanism, the diffusion model can generate samples based on class labels[23]. This classifier guidance mechanism can be expressed as:\n$\\nabla log p(x_t|y) = \\nabla log p(x_t) + \\nabla log p(y|x_t)$\nwhere y refers to the label information and $p(x_t|y)$ is a classifier. Here, $\\nabla log p(x_t|y)$ represents the gradient of the controlled synthesizing process corresponding to the related label information y. It can be seen that $\\nabla log p(x_t)$ is the gradient for the unconditional synthesizing process, and $\\nabla log p(y|x_t)$ corresponds to the classifier gradient.\nHowever, classifier-guidance Diffusion models (CG-Diffusion) require an additional well-trained classifier to guide the sample synthesis, as reflected in Eq. (6). During inference with the trained Diffusion model under the guidance of the trained classifier, additional gradient calculations are needed at each step. Moreover, the quality of the generated controlled samples depends on the classifier's performance. If the training data contains significant noise, the distribution of noisy samples $x_T$ after the forward process can be similar across different sample classes, complicating the training of a robust classifier.\nTo address these issues, the classifier-free mechanism has been proposed[24]. The core principle of this mechanism is to replace the explicit classifier and"}, {"title": "3. Methodology", "content": "In this paper, we propose an anomaly map-guided health monitoring and early fault detection method based on a CF-Diffusion model. The workflow of our proposed method is illustrated in Fig. 1. In the first step, we use healthy samples and minor anomalies to train a specifically designed classifier-free Diffusion model. With this well-trained end-to-end model, we input each measured sample of original condition monitoring data to generate samples that have a distribution similar to that of the original healthy samples. Subsequently, we apply the Hilbert transform to both the generated samples and the original condition monitoring samples to obtain an anomaly map in the envelope spectral domain. This anomaly map effectively indicates the type of fault present in the rotating machine. In addition, this anomaly map can be used to construct a HI corresponding to potential faults."}, {"title": "3.1. Condition monitoring data collection and preprocessing", "content": "The initial step involves collecting raw condition monitoring data using the the collection system. Subsequently, this raw data undergoes preprocessing. Specifically, the window cropping method is employed to segment the raw condition monitoring data into multiple samples. This approach not only reduces computational time but also ensures the diversity of the training samples. The resulting preprocessed data is denoted as xo."}, {"title": "3.2. Training of conditional Diffusion model with classifier-free guidance", "content": "In this section, we aim to develop a CF-Diffusion model tailored for condition monitoring of rotating machinery. This model is trained using preprocessed condition monitoring data xo, comprising healthy samples, Xh, and anomalies, xa. The labels for these samples are denoted as yh and Ya, respectively. The training process involves two main sub-processes."}, {"title": "1. Forward Process", "content": "Noise is progressively added to the original training data, described by the equation:\n$x_{t,\\theta} = \\sqrt{\\bar{\\alpha_t}}x_0 + \\sqrt{1 - \\bar{\\alpha_t}} \\zeta, \\zeta \\sim N(0, I), t \\in {1, 2, ..., T}$\nHere, T represents the total number of time steps in the forward process."}, {"title": "2. Reverse Process", "content": "This sub-process aims to remove the noise added during the forward process and recover the original distribution. It is mathematically represented as:\n$x_{t-1,\\theta} = \\frac{1}{\\sqrt{\\alpha_t}}(x_{t,\\theta} - \\frac{1-\\alpha_t}{\\sqrt{1-\\bar{\\alpha_t}}} \\epsilon_\\theta(x_{t,\\theta}, t, u_\\theta)) + \\sigma_t\\zeta$\nwhere\n$u_\\theta = y_\\theta c, c =\\begin{cases}1, p\\leq uncon\\\\0, p > uncon\\end{cases}, \\rho \\sim U(0,1)$\nThe parameter uncon is a hyper-parameter that controls the mix of unconditional and conditional models during the joint training phase. The $\\epsilon_\\theta$ represents the neural network parameterized by $\\theta$, tailored to this model.\nThe training objective is to minimize the deviation of the noise model from the desired trajectory, formalized as:\n$min ||\\zeta - \\epsilon_\\theta(\\sqrt{\\bar{\\alpha_t}}x_0 + \\sqrt{1 - \\bar{\\alpha_t}}\\zeta, t, u_\\theta)||$"}, {"title": "3.3. Generating Healthy Samples for Anomaly Detection", "content": "Once the network converges, it can be utilized to generate samples that closely mimic the distribution of the initial healthy samples. These synthetic samples are crucial for generating anomaly maps by highlighting discrepancies between the original input and the synthetic samples. In the first step, anomaly samples, denoted as xa, are fed into the network. Here, the input labels are assigned as healthy, yh, to ensure that the synthetic samples resemble the distribution of healthy condition monitoring samples. The synthesizing process is defined by the equation:\n$x_{t-1,a} = \\frac{1}{\\sqrt{\\alpha_t}}(x_{t,a} - \\frac{1-\\alpha_t}{\\sqrt{1-\\bar{\\alpha_t}}} \\epsilon_\\theta(x_{t,a}, t, u_h)) + \\sigma_t\\zeta$"}, {"title": "3.4. Anomaly map construction", "content": "After obtaining synthetic samples, anomaly maps are constructed in the envelope spectral domain. First, the Hilbert transform is applied to the anomalous sample $x_a$ and its corresponding synthetic sample $x_{h,a}$. The transform results, as shown in Eq. (14), are used to obtain the analytic signals, which are represented in Eq. (15). Based on these analytic signals, their spectrum is obtained through Fast Fourier Transform (FFT). This spectrum of analytic signals is regarded as the envelope spectrum of the original signals, denoted as $h_a$ and $h_{h,a}$, respectively. In this context, fault features can be identified by subtracting the two envelope spectra, as shown in Eq. (16).\n$x_a(k) = \\frac{1}{\\pi} \\int_{-\\infty}^{\\infty} \\frac{x_a(\\tau)}{k - \\tau}d\\tau$, $x_{h,a}(k) = \\frac{1}{\\pi} \\int_{-\\infty}^{\\infty} \\frac{x_{h,a}(\\tau)}{k - \\tau}d\\tau$\n$\\hat{x_a} = \\sqrt{x_a^2 + \\hat{x_a}^2}$, $\\hat{x_{h,a}} = \\sqrt{x_{h,a}^2 + \\hat{x_{h,a}}^2}$\n$A = [0, ..., 1, ..., 0]$, $p = arg \\underset{i}{max} |h_a(l) - h_{h,a}(l)|$\nAn anomaly map A is essentially a pulse vector consisting of only 0s and 1s, where the index corresponding to the pulse location indicates the anomaly frequency. This anomaly frequency can be compared with the theoretical fault feature frequency to determine kind of potential faults the rotating machines have. This anomaly map will be used to furthermore construct HIs for health monitoring purpose."}, {"title": "3.5. HI construction", "content": "After generating the anomaly maps for specific anomalies, these maps are used to construct HIs for each measured sample of the monitoring data. This method differs from traditional approaches that construct anomaly scores by comparing distributions between reconstructed samples. Instead, we utilize the detailed fault feature information pinpointed by the anomaly maps. Based on these anomaly maps, the differences in distribution between fault"}, {"title": "4. Experiments", "content": "In this section, we present two case studies to demonstrate the effectiveness and the robustness of our proposed method. The first case involves a simulation experiment, which allows direct access to the ground truth HI information and provides full interpretability of the results, which can be more challenging to achieve with real faults. Additionally, a real experimental data will also be adopted to further illustrate the superiority of the proposed method."}, {"title": "4.1. Case I: Bearing simulation", "content": ""}, {"title": "4.1.1. Experimental setting", "content": "In this case study, we used a simulation dataset specifically designed for conducting comparative studies and demonstrating the superior performance and robustness of our proposed method. This dataset was generated using a simulation model of a roller bearing with an outer-race fault, as depicted in Fig. 2[25]. It captures the steady-state response of the simulation model in the vertical direction across different defect depths. The fundamental simulation parameters are detailed in Table 1. It is important to note that for the purposes of this experiment, states exhibiting minimal impairment were classified healthy. In these states, the defect depth $h_a$ was set to 1\u00d710-3 mm. States indicating more significant damage, where the defect depth was 100 \u00d7 10-6 mm, contributed a smaller number of anomalies.Additionally, the experiment included four distinct fault conditions with varying defect depths $h_a$, as specified in Table 2. This setup allowed for a thorough evaluation of the model's effectiveness across a spectrum of fault severities."}, {"title": "1. Forward Process", "content": "Noise is progressively added to the original training data, described by the equation:\n$x_{t,\\theta} = \\sqrt{\\bar{\\alpha_t}}x_0 + \\sqrt{1 - \\bar{\\alpha_t}} \\zeta, \\zeta \\sim N(0, I), t \\in {1, 2, ..., T}$\nHere, T represents the total number of time steps in the forward process."}, {"title": "2. Reverse Process", "content": "This sub-process aims to remove the noise added during the forward process and recover the original distribution. It is mathematically represented as:\n$x_{t-1,\\theta} = \\frac{1}{\\sqrt{\\alpha_t}}(x_{t,\\theta} - \\frac{1-\\alpha_t}{\\sqrt{1-\\bar{\\alpha_t}}} \\epsilon_\\theta(x_{t,\\theta}, t, u_\\theta)) + \\sigma_t\\zeta$\nwhere\n$u_\\theta = y_\\theta c, c =\\begin{cases}1, p\\leq uncon\\\\0, p > uncon\\end{cases}, \\rho \\sim U(0,1)$\nThe parameter uncon is a hyper-parameter that controls the mix of unconditional and conditional models during the joint training phase. The $\\epsilon_\\theta$ represents the neural network parameterized by $\\theta$, tailored to this model.\nThe training objective is to minimize the deviation of the noise model from the desired trajectory, formalized as:\n$min ||\\zeta - \\epsilon_\\theta(\\sqrt{\\bar{\\alpha_t}}x_0 + \\sqrt{1 - \\bar{\\alpha_t}}\\zeta, t, u_\\theta)||$"}, {"title": "3.3. Generating Healthy Samples for Anomaly Detection", "content": "Once the network converges, it can be utilized to generate samples that closely mimic the distribution of the initial healthy samples. These synthetic samples are crucial for generating anomaly maps by highlighting discrepancies between the original input and the synthetic samples. In the first step, anomaly samples, denoted as xa, are fed into the network. Here, the input labels are assigned as healthy, yh, to ensure that the synthetic samples resemble the distribution of healthy condition monitoring samples. The synthesizing process is defined by the equation:\n$x_{t-1,a} = \\frac{1}{\\sqrt{\\alpha_t}}(x_{t,a} - \\frac{1-\\alpha_t}{\\sqrt{1-\\bar{\\alpha_t}}} \\epsilon_\\theta(x_{t,a}, t, u_h)) + \\sigma_t\\zeta$"}, {"title": "3.4. Anomaly map construction", "content": "After obtaining synthetic samples, anomaly maps are constructed in the envelope spectral domain. First, the Hilbert transform is applied to the anomalous sample $x_a$ and its corresponding synthetic sample $x_{h,a}$. The transform results, as shown in Eq. (14), are used to obtain the analytic signals, which are represented in Eq. (15). Based on these analytic signals, their spectrum is obtained through Fast Fourier Transform (FFT). This spectrum of analytic signals is regarded as the envelope spectrum of the original signals, denoted as $h_a$ and $h_{h,a}$, respectively. In this context, fault features can be identified by subtracting the two envelope spectra, as shown in Eq. (16).\n$x_a(k) = \\frac{1}{\\pi} \\int_{-\\infty}^{\\infty} \\frac{x_a(\\tau)}{k - \\tau}d\\tau$, $x_{h,a}(k) = \\frac{1}{\\pi} \\int_{-\\infty}^{\\infty} \\frac{x_{h,a}(\\tau)}{k - \\tau}d\\tau$\n$\\hat{x_a} = \\sqrt{x_a^2 + \\hat{x_a}^2}$, $\\hat{x_{h,a}} = \\sqrt{x_{h,a}^2 + \\hat{x_{h,a}}^2}$\n$A = [0, ..., 1, ..., 0]$, $p = arg \\underset{i}{max} |h_a(l) - h_{h,a}(l)|$\nAn anomaly map A is essentially a pulse vector consisting of only 0s and 1s, where the index corresponding to the pulse location indicates the anomaly frequency. This anomaly frequency can be compared with the theoretical fault feature frequency to determine kind of potential faults the rotating machines have. This anomaly map will be used to furthermore construct HIs for health monitoring purpose."}, {"title": "3.5. HI construction", "content": "After generating the anomaly maps for specific anomalies, these maps are used to construct HIs for each measured sample of the monitoring data. This method differs from traditional approaches that construct anomaly scores by comparing distributions between reconstructed samples. Instead, we utilize the detailed fault feature information pinpointed by the anomaly maps. Based on these anomaly maps, the differences in distribution between fault"}, {"title": "4. Experiments", "content": "In this section, we present two case studies to demonstrate the effectiveness and the robustness of our proposed method. The first case involves a simulation experiment, which allows direct access to the ground truth HI information and provides full interpretability of the results, which can be more challenging to achieve with real faults. Additionally, a real experimental data will also be adopted to further illustrate the superiority of the proposed method."}, {"title": "4.1. Case I: Bearing simulation", "content": ""}, {"title": "4.1.1. Experimental setting", "content": "In this case study, we used a simulation dataset specifically designed for conducting comparative studies and demonstrating the superior performance and robustness of our proposed method. This dataset was generated using a simulation model of a roller bearing with an outer-race fault, as depicted in Fig. 2[25]. It captures the steady-state response of the simulation model in the vertical direction across different defect depths. The fundamental simulation parameters are detailed in Table 1. It is important to note that for the purposes of this experiment, states exhibiting minimal impairment were classified healthy. In these states, the defect depth $h_a$ was set to 1\u00d710-3 mm. States indicating more significant damage, where the defect depth was 100 \u00d7 10-6 mm, contributed a smaller number of anomalies.Additionally, the experiment included four distinct fault conditions with varying defect depths $h_a$, as specified in Table 2. This setup allowed for a thorough evaluation of the model's effectiveness across a spectrum of fault severities."}, {"title": "1. Forward Process", "content": "Noise is progressively added to the original training data, described by the equation:\n$x_{t,\\theta} = \\sqrt{\\bar{\\alpha_t}}x_0 + \\sqrt{1 - \\bar{\\alpha_t}} \\zeta, \\zeta \\sim N(0, I), t \\in {1, 2, ..., T}$\nHere, T represents the total number of time steps in the forward process."}, {"title": "2. Reverse Process", "content": "This sub-process aims to remove the noise added during the forward process and recover the original distribution. It is mathematically represented as:\n$x_{t-1,\\theta} = \\frac{1}{\\sqrt{\\alpha_t}}(x_{t,\\theta} - \\frac{1-\\alpha_t}{\\sqrt{1-\\bar{\\alpha_t}}} \\epsilon_\\theta(x_{t,\\theta}, t, u_\\theta)) + \\sigma_t\\zeta$\nwhere\n$u_\\theta = y_\\theta c, c =\\begin{cases}1, p\\leq uncon\\\\0, p > uncon\\end{cases}, \\rho \\sim U(0,1)$\nThe parameter uncon is a hyper-parameter that controls the mix of unconditional and conditional models during the joint training phase. The $\\epsilon_\\theta$ represents the neural network parameterized by $\\theta$, tailored to this model.\nThe training objective is to minimize the deviation of the noise model from the desired trajectory, formalized as:\n$min ||\\zeta - \\epsilon_\\theta(\\sqrt{\\bar{\\alpha_t}}x_0 + \\sqrt{1 - \\bar{\\alpha_t}}\\zeta, t, u_\\theta)||$"}, {"title": "3.3. Generating Healthy Samples for Anomaly Detection", "content": "Once the network converges, it can be utilized to generate samples that closely mimic the distribution of the initial healthy samples. These synthetic samples are crucial for generating anomaly maps by highlighting discrepancies between the original input and the synthetic samples. In the first step, anomaly samples, denoted as xa, are fed into the network. Here, the input labels are assigned as healthy, yh, to ensure that the synthetic samples resemble the distribution of healthy condition monitoring samples. The synthesizing process is defined by the equation:\n$x_{t-1,a} = \\frac{1}{\\sqrt{\\alpha_t}}(x_{t,a} - \\frac{1-\\alpha_t}{\\sqrt{1-\\bar{\\alpha_t}}} \\epsilon_\\theta(x_{t,a}, t, u_h)) + \\sigma_t\\zeta$"}, {"title": "3.4. Anomaly map construction", "content": "After obtaining synthetic samples, anomaly maps are constructed in the envelope spectral domain. First, the Hilbert transform is applied to the anomalous sample $x_a$ and its corresponding synthetic sample $x_{h,a}$. The transform results, as shown in Eq. (14), are used to obtain the analytic signals, which are represented in Eq. (15). Based on these analytic signals, their spectrum is obtained through Fast Fourier Transform (FFT). This spectrum of analytic signals is regarded as the envelope spectrum of the original signals, denoted as $h_a$ and $h_{h,a}$, respectively. In this context, fault features can be identified by subtracting the two envelope spectra, as shown in Eq. (16).\n$x_a(k) = \\frac{1}{\\pi} \\int_{-\\infty}^{\\infty} \\frac{x_a(\\tau)}{k - \\tau}d\\tau$, $x_{h,a}(k) = \\frac{1}{\\pi} \\int_{-\\infty}^{\\infty} \\frac{x_{h,a}(\\tau)}{k - \\tau}d\\tau$\n$\\hat{x_a} = \\sqrt{x_a^2 + \\hat{x_a}^2}$, $\\hat{x_{h,a}} = \\sqrt{x_{h,a}^2 + \\hat{x_{h,a}}^2}$\n$A = [0, ..., 1, ..., 0]$, $p = arg \\underset{i}{max} |h_a(l) - h_{h,a}(l)|$\nAn anomaly map A is essentially a pulse vector consisting of only 0s and 1s, where the index corresponding to the pulse location indicates the anomaly frequency. This anomaly frequency can be compared with the theoretical fault feature frequency to determine kind of potential faults the rotating machines have. This anomaly map will be used to furthermore construct HIs for health monitoring purpose."}, {"title": "3.5. HI construction", "content": "After generating the anomaly maps for specific anomalies, these maps are used to construct HIs for each measured sample of the monitoring data. This method differs from traditional approaches that construct anomaly scores by comparing distributions between reconstructed samples. Instead, we utilize the detailed fault feature information pinpointed by the anomaly maps. Based on these anomaly maps, the differences in distribution between fault"}, {"title": "4. Experiments", "content": "In this section, we present two case studies to demonstrate the effectiveness and the robustness of our proposed method. The first case involves a simulation experiment, which allows direct access to the ground truth HI information and provides full interpretability of the results, which can be more challenging to achieve with real faults. Additionally, a real experimental data will also be adopted to further illustrate the superiority of the proposed method."}, {"title": "4.1. Case I: Bearing simulation", "content": ""}, {"title": "4.1.1. Experimental setting", "content": "In this case study, we used a simulation dataset specifically designed for conducting comparative studies and demonstrating the superior performance and robustness of our proposed method. This dataset was generated using a simulation model of a roller bearing with an outer-race fault, as depicted in Fig. 2[25]. It captures the steady-state response of the simulation model in the vertical direction across different defect depths. The fundamental simulation parameters are detailed in Table 1. It is important to note that for the purposes of this experiment, states exhibiting minimal impairment were classified healthy. In these states, the defect depth $h_a$ was set to 1\u00d710-3 mm. States indicating more significant damage, where the defect depth was 100 \u00d7 10-6 mm, contributed a smaller number of anomalies.Additionally, the experiment included four distinct fault conditions with varying defect depths $h_a$, as specified in Table 2. This setup allowed for a thorough evaluation of the model's effectiveness across a spectrum of fault severities."}, {"title": "4.1.2. Results and discussions", "content": "Afterward, HIs for various experimental settings listed in TABLE 2 were constructed using the derived anomaly map to monitor the degradation process of the bearings, as outlined in Eq. (17). The results are illustrated in Fig. 6(a). To further evaluate the robustness of our proposed method, we introduced noise to the original experimental data to create datasets with varying signal-to-noise ratios (SNR). We then compared our method against established unsupervised or weakly-supervised baseline models for time series anomaly detection, including Feature Encoding with Auto-encoders for Weakly-supervised Anomaly Detection (FEAWAD)[26], the anomaly-transformer [27], and the Wasserstein generative digital twin (WGDT)[1]. The comparative results are displayed in Fig. 6 (b)-(d). Despite strong noise interference at -20dB, the HIs generated by our method consistently reflected the degradation trend of outer ring fault damage, whereas the HI constructed from FEAWAD failed to accurately track the degradation trend at noise levels above -10dB. Similarly, the Anomaly-transformer and WGDT models struggled to trace the bearing degradation trend accurately under high noise conditions exceeding -10dB. These findings quantitatively demonstrate the superior robustness of our proposed method.\nFurthermore, we employed quantitative metrics such as cosine similarity and the Pearson correlation coefficient, detailed in Eq. 18 and Eq. 19, to cassess the alignment between the actual bearing outer-ring defect depth and the HIs constructed by different models under various noise conditions. The results, depicted in Fig. 7, show that as noise levels increased, the"}, {"title": "4.1.3. Ablation studies", "content": "We conducted two ablation experiments to validate the effectiveness of the proposed methods. These experiments primarily assessed the impact of incorporating the anomaly map in the envelope domain, comparing it against the performance of traditional reconstruction error based methods. The experimental approach involved comparing the HIs constructed using the reconstruction-errors of both the original samples and synthetic samples generated by the CF-Diffusion model across time domain and envelope spectrum, against our proposed Anomaly map guidance mechanism based on the CF-Diffusion model. The results of these experiments are illustrated in Fig. 8. They clearly show that the HI created using the anomaly map guidance mechanism exhibit a higher correlation with the actual degradation of the bearing, particularly as noise levels increase. This indicates that incorporating anomaly map guidance mechanism significantly enhances the model's ability to accurately track degradation, underscoring its superiority over traditional methods.\n$cos(HI,h_d) = \\frac{HI\\cdot h_d}{||HI||||h_d||}$\n$r(HI,h_d) = \\frac{(HI - \\overline{HI})^T(h_d - \\overline{h_d})}{||HI - \\overline{HI}||||h_d - \\overline{h_d}||}$"}, {"title": "4.2. IMS experiment", "content": ""}, {"title": "4.2.1. experimental setting", "content": "In this case study, we will use a real dataset to further evaluate the superiority of our proposed method under practical working conditions. We selected the IMS dataset due to its widespread use in the evaluation of numerous health monitoring methods [28, 1, 10]. The test rig and the corresponding sensor placement are illustrated in Fig. 9. The sampling frequency was set at 20kHz, using Rexnord ZA-2115 bearings. The experiment comprises three"}, {"title": "4.2.2. Results and discussion", "content": "Following the generation of an anomaly map as per Eq. (16), we constructed HIs for No. 2 dataset of the IMS dataset, as depicted in Fig.11. To evaluate the effectiveness of our proposed method in health monitoring and early fault detection, we benchmarked it against several established models, including the Anomaly-transformer[27], Omni-VAE[29], FEAWAD[26], and WGDT[1]. These models were selected as they represent the SOTA unsupervised and weakly-supervised methods. The HIs derived from our method demonstrated less fluctuation under normal operating conditions compared to those from the baseline models, as seen in Fig.11. For a quantitative assessment, we applied standard anomaly detection metrics such as AUROC and AUPRC. In addition, we analyzed early fault detection capabilities using a common threshold selection strategy outlined in [30] and detailed in Eq. (20). Furthermore, we established the detection results of the AE-LSTM-OCSVM as our baseline for comparison, analyzing how many measured samples earlier the other baseline models and our proposed AMG-CF-Diffusion could detect faults. This approach allows us to present quantitative in a more intuitive manner. These results, detailed in Table. 3 demonstrate that our proposed method achieves the highest scores across these three quantitative metrics (AUROC, AUPRC, Earlier detection time), indicating that it significantly outperforms the other baseline models in both health monitoring and early fault detection."}, {"title": "4.2.3. Ablation studies", "content": "Furthermore, we conducted ablation studies to assess the effectiveness of the classifier-free mechanism. The experimental approach was consistent with that used in Case I, focusing on performance comparisons of HIs generated using different methods: the time-domain reconstruction based on the CF-Diffusion model, the envelope-spectrum reconstruction based on the CF-Diffusion model, and our anomaly map guidance mechanism, also based on the CF-Diffusion. The results, displayed in Fig. 12, reveal that the HIs derived from time-domain and envelope-spectrum-reconstructions exhibit greater fluctuation compared to those produced using the anomaly map guidance mechanism. Notably, the HI curve from the anomaly map guidance mechanism, illustrated in Fig. 12(c), demonstrates a steady and gradual upward trend that aligns closely with the degradation pattern of the bearing. This outcome emphasizes the superior stability and reliability of the anomaly map guidance mechanism in tracking the progressive deterioration"}, {"title": "5. Conclusion", "content": "In this paper, we proposed an anomaly map guidance mechanism for health monitoring and early fault detection of rotating machines, designed to enhance robustness against strong noise interference and provide clearer"}, {"title": "CRediT authorship contribution statement", "content": "Wenyang Hu: Writing-review & editing, Writing-original draft, Validation, Software, Methodology, Conceptualization. Gaetan Frusque: Writing-review & editing, Conceptualization. Tianyang Wang: Supervision, Resources, Funding acquisition. Fulei Chu: Supervision, Resources, Funding acquisition. Olga Fink: Writing-review & editing, Supervision, Resources, Conceptualization."}]}