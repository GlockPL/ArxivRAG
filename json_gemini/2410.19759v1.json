{"title": "PINNing Cerebral Blood Flow: Analysis of Perfusion MRI in Infants using Physics-Informed Neural Networks", "authors": ["Christoforos Galazis", "Ching-En Chiu", "Tomoki Arichi", "Anil A. Bharath", "Marta Varela"], "abstract": "Arterial spin labeling (ASL) magnetic resonance imaging (MRI) enables cerebral perfusion measurement, which is crucial in detecting and managing neurological issues in infants born prematurely or after perinatal complications. However, cerebral blood flow (CBF) estimation in infants using ASL remains challenging due to the complex interplay of network physiology, involving dynamic interactions between cardiac output and cerebral perfusion, as well as issues with parameter uncertainty and data noise. We propose a new spatial uncertainty-based physics-informed neural network (PINN), SUPINN, to estimate CBF and other parameters from infant ASL data. SUPINN employs a multi-branch architecture to concurrently estimate regional and global model parameters across multiple voxels. It computes regional spatial uncertainties to weigh the signal. SUPINN can reliably estimate CBF (relative error \u22120.3 \u00b1 71.7), bolus arrival time (AT) (30.5 \u00b1 257.8), and blood longitudinal relaxation time (T\u2081\u2081) (-4.4 \u00b1 28.9), surpassing parameter estimates performed using least squares or standard PINNs. Furthermore, SUPINN produces physiologically plausible spatially smooth CBF and AT maps. Our study demonstrates the successful modification of PINNs for accurate multi-parameter perfusion estimation from noisy and limited ASL data in infants. Frameworks like SUPINN have the potential to advance our understanding of the complex cardio-brain network physiology, aiding in the detection and management of diseases. Source code is provided at: https://github.com/cgalaz01/supinn.", "sections": [{"title": "1 INTRODUCTION", "content": "Arterial spin labelling (ASL) is a non-invasive magnetic resonance imaging (MRI) technique that measures cerebral blood flow (CBF) without exogenous contrast agents (Lindner et al., 2023). CBF maps can be computed on a voxel-by-voxel basis by fitting mathematical models of haemodynamics based on ordinary differential equations (ODEs) (Alsop et al., 2015). These models help capture the complex temporal dynamics of blood flow, which is essential for understanding the intricate cardiac-brain network physiology. This understanding may aid diagnosing and managing various conditions, such as some forms of dementia and stroke (Rossi et al., 2022; Tahsili-Fahadan and Geocadin, 2017).\n\nThe bidirectional cardiac-brain network physiology operates as an intricate system where the heart and brain continuously influence each other (Candia-Rivera et al., 2024). The heart supplies oxygenated blood to the brain, affecting cerebral perfusion and pulsatile flow (Silverman and Petersen, 2020), while the brain regulates cardiac function through the two autonomic nervous systems, the sympathetic and parasympathetic (Gordan et al., 2015). This network incorporates feedback loops such as cerebral autoregulation and neurovascular coupling to maintain optimal function (Claassen et al., 2021).\n\nIn infants, particularly those with conditions like congenital heart disease (CHD) or preterm birth, this network is especially vulnerable due to immature autoregulation and developmental sensitivity (De Silvestro et al., 2024; Claassen et al., 2021). These factors can result in altered cerebral haemodynamics, leading to issues such as delayed brain maturation, an increased risk of cerebral white matter injury, and potentially adverse long-term neurodevelopmental outcomes (McQuillen et al., 2010). Preterm neonates are often admitted to hospital to receive external physiological support whilst their bodies mature, which brain perfusion must be sufficient during this period.\n\nThe infant demographic thus benefits from non-invasive CBF monitoring techniques like ASL (Counsell et al., 2019). ASL can provide insights into the complex physiological interplay between the heart and brain, guiding interventions to support optimal brain development and overall cardiovascular healthy (McQuillen et al., 2010; Castle-Kirszbaum et al., 2022).\n\nA thorough understanding of this cardiac-brain network is crucial for managing infant health. Specifically, it is essential for optimizing neuroprotection strategies, improving surgical and medical management, and enhancing the long-term neurodevelopmental prospects of these infants (De Silvestro et al., 2023). However, further research is needed to fully understand the independent effects and mechanisms of cardio-cerebral coupling (Castle-Kirszbaum et al., 2022; Meng et al., 2015), particularly in the developing infant brain (Baik-Schneditz et al., 2021). Achieving this understanding in infants will require the development of even more accurate CBF monitoring techniques than those currently available.\n\nComputing voxel-by-voxel CBF maps is achieved by fitting mathematical models of haemodynamics based on ODEs (Alsop et al., 2015). Many of these perfusion model ODEs assume very simplified physiology (e.g., plug blood flow to the brain, single magnetization compartments in the brain) and can therefore be solved analytically (Buxton et al., 1998; Alsop et al., 2015). It is often further assumed that the perfusion model parameters are perfectly known. In these conditions, CBF is estimated from a single perfusion-weighted image (PWI). These assumptions do not apply to CBF estimates in pathological conditions or groups with heterogeneous physiological properties, such as infants.\n\nImaging infants, particularly those born preterm, presents further challenges due to lower signal-to-noise ratio (SNR). This is attributed to lower baseline CBF and longer arrival times (AT) of the magnetically labelled bolus (Dubois et al., 2021; Varela et al., 2015). Additionally, the need for higher spatial resolution in smaller infant brains further reduces SNR (Dubois et al., 2021). Motion during scanning is also common in infants, further degrading image quality and leading to artifacts (Dubois et al., 2021; Varela et al., 2015).\n\nUnfortunately, voxel-by-voxel ASL analysis is susceptible to spatial inconsistencies, amplified by the lower SNR noise in infant perfusion weighted image (PWI) signals (Krishnapriyan et al., 2021; Wang et al., 2022). Haemodynamic models are challenging to parameterise in the infant population due to dramatic physiological changes in the first weeks of life, during which most physiological parameters"}, {"title": "2 METHODS", "content": "Our source code is publicly available at: https://github.com/cgalaz01/supinn.\n\n2.1 Dataset\n\nASL brain MRI studies were conducted on seven infants aged 32 to 78 weeks postmenstrual age. The cohort included three infants with no pathology, one with periventricular leukomalacia, one with basal ganglia and white matter atrophy along with mild ventriculomegaly, one with agenesis of the corpus callosum, brain atrophy, and mild ventriculomegaly, and one with mild ventriculomegaly. Although this study does not include infants with known cardiac impairment, it is sufficient as our focus at this stage is on evaluating PINNs within the available diverse cohorot.\n\nAll images were acquired in a Philips 3T Achieva scanner using an 8-element head coil under ethical approval following informed parental consent (REC: 09/H0707/83). PWIs were acquired on a single mid-brain transverse plane at 12 time points (every 300 ms) following a single pulsed labelling event (Petersen et al., 2006), at a spatial resolution of 3.04 \u00d7 3.04 \u00d7 5.5 mm\u00b3. For a representative PWI time series and accompanying signal plot, refer to Figure 1.\n\nIn all subjects, our analysis focused on a manually segmented region of interest that includes the thalami and basal ganglia (Figure 2). This deep grey matter region shows better SNR and fewer partial volume effects than cortical grey matter.\n\n2.2 Mathematical Model for ASL\n\nThe relationship between the PWI signal, S(t), and CBF can be expressed as the temporal convolution between an arterial input function, AIF(t), and a tissue response function, R(t): S = AIF * R (Buxton et al., 1998). AIF is a top-hat function, here with a known duration \u03c4 = 900 ms, that arrives at each voxel at a variable t = AT, and R(t) is dominated by magnetization relaxation over venous outflow. As in (Alsop et al., 2015), we assume that the longitudinal magnetization relaxation of the blood is well described by T1b throughout.\n\nWe neglect the effect of the repeated excitation pulses on apparent T1b and assume that all PWI scaling constants are known, as in (Varela et al., 2015). Then:\n\n$\n\\begin{cases}\n0 & \\text{if } t < AT \\\\\nCBF \\times (t - AT) \\times e^{-t/T_{1b}} & \\text{if } AT < t < AT + \\tau \\\\\nCBF \\times \\tau \\times e^{-t/T_{1b}} & \\text{if } AT + \\tau < t\n\\end{cases}\n$\n(1)\n\nThis model can be differentiated to yield an ODE defined in 3 branches:\n\n$\n\\frac{dS}{dt} = \n\\begin{cases}\n0 & \\text{if } t < AT \\\\\n\\frac{CBF}{\\tau} \\times e^{-t/T_{1b}} \\times (1 - \\frac{t-AT}{T_{1b}}) & \\text{if } AT < t < AT + \\tau \\\\\n-\\frac{CBF}{\\tau} \\times e^{-t/T_{1b}} \\times \\frac{\\tau}{T_{1b}} & \\text{if } AT + \\tau < t\n\\end{cases}\n$\n(2)\n\nThe three branches in Eqs. 1 and 2 depict three distinct signal evolution phases: the periods before, during, and after the arrival of labelled blood at each voxel. We found that approximating the discontinuous 3-branched ODE in equation 2 using a NN leads to poor convergence properties. To circumvent this issue, we combine the three phases using smoothing hyperbolic tangent functions (see Supplementary Table S1).\n\n2.3 Ground Truth Estimation\n\nAn auxiliary MRI scan was used to estimate ground-truth T\u2081b in each subject (Varela et al., 2011). Then, a robust LSF was performed using the analytical haemodynamic model in Eq 2 to estimate ground-truth CBF and AT on a voxel-by-voxel basis.\n\nMost biomedical problems described by DEs do not have an analytical solution and can only be solved numerically. For these, the accuracy of parameter identification methods is typically estimated using in silico data, which do not capture the complexities of experimental measurements. The existence of an"}, {"title": "2.4 Loss Function and Training Scheme", "content": "PINNs are optimized to learn a solution that both matches the data and satisfies known known cardiac- brain network physiology principles. They minimize the combined loss function defined as: L = LODE +\n\u03b3Ldata. Due to the high noise in the data, Ldata is weighted using an empirically-set coefficient \u03b3 = 0.005.\nInitial conditions, S(t = 0) = 0, are enforced by rescaling S(t) using a hyperbolic tangent function (Lu et al., 2021).\n\nLODE measures the agreement with Eq. 2. This loss is calculated by evaluating the residual of the differential equation at a set of collocation points (No) using the network's predictions and taking the mean squared error:\n\n$\nL_{ODE} = \\frac{1}{N_O} \\sum_{i}^{N_O} (\\frac{d\\hat{S}}{dt}(t_i) - f(t_i, \\hat{S}(t_i))^2\n$\n(3)\n\nLdata is the data loss, which measures the mean squared error between the network's PWI estimation and the values measured across the 12 time points (ND) acquired in each voxel:\n\n$\nL_{data} = \\frac{1}{N_O} \\sum_{i}^{N_D} (w_{t_i} \\times ||\\hat{S}(t_i) - S(t_i)||^2),\n$\n(4)\n\nwhere w 1 is the weight of each PWI time point. w is used in SUPINN with details available in section 2.6.\n\nWhen optimizing the PINNs' weights, we propose a three-tier hierarchical optimization scheme (see Supplementary Table S2). We initially optimize the PINNs in forward mode, focusing on aligning the network approximately with the underlying ODE without estimating specific parameters. We then solve the ODE in inverse mode to estimate the local parameters CBF and AT, and the global parameter T1b. We finalise by fine-tuning the parameter estimation."}, {"title": "2.5 PINN Architecture", "content": "PINNs are implemented using DeepXDE v1.11 (Lu et al., 2021) and TensorFlow v2.15 (Abadi et al., 2016). As a baseline PINN architecture (Raissi et al., 2019; Karniadakis et al., 2021), we use a fully connected neural network with hyperbolic tangent activation functions and two hidden layers, each consisting of 32 units. It includes one input unit for time t and one output unit for the PWI signal S(t)."}, {"title": "2.6 SUPINN Architecture", "content": "The baseline PINN models the signal from each voxel separately, ignoring the spatial relationships between the different sets of measurements. We expect, however, that neighbouring voxels have similar CBF and AT values, with deviations primarily due to noise. To incorporate this information in the model, we propose a spatial uncertainty PINN, SUPINN (Figure 2). SUPINN inversely weighs the contribution of each PWI time point, w (see Eq 4), by their uncertainty levels. The uncertainty is estimated by calculating the standard deviation of the PWI signal in immediate neighbouring voxels within the region of interest at a given time point: $w_t = 1/\\sqrt{\\sum_i (S(t_i)-\\mu_{t_i})^2}$, where w is the weight at time point t. The weights for each voxel across time are then scaled such that the highest uncertainty corresponds to a weight of w = 0.1 and the smallest uncertainty to w = 1. The weights in data loss Ldata (Eq 4) are updated accordingly.\n\nSUPINN use a multi-branch architecture to reliably estimate global (subject-specific) parameters, such as T1b by pooling information from more than one voxel. It simultaneously estimates voxel-specific parameters CBF and AT. The subnetworks' graphs are merged, allowing information sharing through backpropagation.\n\nEach SUPINN branch employs the baseline PINN architecture described in section 2.5. Voxels are selected randomly within the region of interest, with preliminary findings suggesting that a 3-branch network combining data from 3 voxels gives the optimal balance between estimation accuracy and computational efficiency. While voxel-specific CBF and AT parameters are estimated independently in each branch, T1b is shared across the selected voxels. The loss function, L, for this architecture is the sum of the data agreement and ODE agreement losses (Eqs. 3 and 4) for each branch: $L = \\sum_{i=3} L_{i,ODE} + L_{i,data}$."}, {"title": "2.7 Experimental Setup", "content": "We compared SUPINN against several benchmarks: a standard PINN (Section 2.5), a robust LSF method (Varela et al., 2015), and a modified LSF (LSF-multi) that averages parameter estimations from 3 selected voxels. As we have limited data, evaluation against deep NN is not currently possible. All computations were performed on a 3XS Intel Core i7. The average execution times per voxel were approximately 0.05s for LSF/LSF-multi, 31s for PINN, and 40s for SUPINN.\n\nEvaluation metrics include the mean and standard deviation of the relative error (RE), computed as (predicted \u2013 target)/target \u00d7 100 for each parameter. When a method led to CBF estimates"}, {"title": "3 RESULTS", "content": "Our proposed SUPINN architecture, designed to address variable data noise levels and simultaneously estimate local and global parameters, showed excellent performance on infant ASL data (see Table 1). SUPINN showed improvements in both PWI signal (forward) and parameter (inverse) estimations compared to the standard PINN and LSF/LSF-multi methods at the cost of increased computational time.\n\nSUPINN led to more accurate parameter estimates, especially for CBF. Specifically, SUPINN achieved a RE of -0.3 \u00b1 71.7 for CBF, 30.5 \u00b1 257.8 for AT, and -4.4 \u00b1 28.9 for T1b. Additionally, the predicted PWI signal closely matched the ground truth, as evidenced by the smallest MSE of 0.4 \u00b1 0.8, as shown in Table 1. Finally, both the base PINN and SUPINN achieved high parameter convergence rate, with rates of 99.9% and 100%, respectively.\n\nWe typically observe higher noise levels in the PWI signal of younger infants. Despite this challenge, Supplementary Figure S1 shows that SUPINN consistently achieved lower RE in CBF across all subjects compared to other methods despite low SNR. Additionally, SUPINN achieved the most accurate estimates of AT and T1b in the majority of cases. Notably, SUPINN also demonstrated resilience in estimating parameters for infants with neurological disorders (indicated with an asterisk in the figure).\n\nThe robustness of our model is further demonstrated in Supplementary Figure S2, where we evaluated its performance on synthetic signals. White Gaussian noise was added to each of the synthetically generated PWI signals, with the standard deviation progressively increased in increments of 0.1, up to a maximum of 0.5. Despite increasing the standard deviation of the noise, SUPINN maintained stable parameter estimations, especially for CBF and AT. This highlights the model's ability to handle noisy data effectively. In comparison, the baseline PINN also exhibited resilience in estimating AT and T1b, but its CBF estimations deteriorated progressively as the noise level increased. On the other hand, the LSF method showed the greatest sensitivity to noise, with parameter estimations degrading noticeably even with a small amount of added noise.\n\nFigure 3 illustrates the spatial maps of the CBF and AT predictions for a representative infant. The SUPINN estimates, shown in the first column, exhibit higher spatial consistency for both CBF and AT"}, {"title": "4 DISCUSSION", "content": "We introduce SUPINN, a novel multi-branch PINN technique for estimating parameters from noisy data. By solving ODEs over neighbouring regions with similar properties and estimating uncertainty through voxel comparisons, SUPINN simultaneously estimates local and global parameters with high accuracy. We test it on the challenging task of estimating haemodynamic parameters from extremely noisy infant multi-delay ASL data, where it outperforms both standard PINNs and LSF.\n\nSUPINN's strong performance is also underpinned by our three-tier optimization regime, use of hard initial conditions and the replacement of non-differentiable transitions in the baseline model (Eq. 2) by a smoothly interpolated version. These enhancements are crucial for accurately capturing the complex cerebral haemodynamics in infants, in whom subtle alterations in perfusion can have implications for brain development."}, {"title": "CONFLICT OF INTEREST STATEMENT", "content": "The authors declare that the research was conducted in the absence of any commercial or financial relationships that could be construed as a potential conflict of interest."}, {"title": "AUTHOR CONTRIBUTIONS", "content": "The author contributions are as following: CG - Software, Methodology, Writing \u2013 original draft; CC - Software, Writing \u2013 review & editing; TA - Data curation, Writing \u2013 review & editing; AB - Supervision, Writing - review & editing; MV - Conceptualization, Supervision, Data curation, Writing \u2013 review & editing."}, {"title": "FUNDING", "content": "This work was supported by the UK Research and Innovation (UKRI) Centres of Doctoral Training (CDT) in Artificial Intelligence for Healthcare (AI4H)http://ai4health.io (Grant No. EP/S023283/1), the NIHR Imperial Biomedical Research Centre (BRC), and the British Heart Foundation Centre of Research Excellence at Imperial College London (RE/18/4/34215)."}]}