{"title": "Tumor likelihood estimation on MRI prostate data\nby utilizing k-Space information", "authors": ["Moritz Rempe", "Fabian H\u00f6rst", "Constantin Seibold", "Boris Hadaschik", "Marco Schlimbach", "Jan Egger", "Kevin Kr\u00f6ninger", "Felix Breuer", "Martin Blaimer", "Jens Kleesiek"], "abstract": "We present a novel preprocessing and prediction\npipeline for the classification of magnetic resonance imaging\n(MRI) that takes advantage of the information rich complex\nvalued k-Space. Using a publicly available MRI raw dataset with\n312 subject and a total of 9508 slices, we show the advantage\nof utilizing the k-Space for better prostate cancer likelihood\nestimation in comparison to just using the magnitudinal infor-\nmation in the image domain, with an AUROC of 86.1%\u00b11.8%.\nAdditionally, by using high undersampling rates and a simple\nprincipal component analysis (PCA) for coil compression, we\nreduce the time needed for reconstruction by avoiding the time\nintensive GRAPPA reconstruction algorithm. By using digital\nundersampling for our experiments, we show that scanning and\nreconstruction time could be reduced. Even with an undersam-\npling factor of 16, our approach achieves meaningful results, with\nan AUROC of 71.4%\u00b12.9%, using the PCA coil combination and\ntaking into account the k-Space information. With this study, we\nwere able to show the feasibility of preserving phase and k-Space\ninformation, with consistent results. Besides preserving valuable\ninformation for further diagnostics, this approach can work\nwithout the time intensive ADC and reconstruction calculations,\ngreatly reducing the post processing, as well as potential scanning\ntime, increasing patient comfort and allowing a close to real-time\nprediction.", "sections": [{"title": "I. INTRODUCTION", "content": "MAGNETIC Resonance Imaging (MRI) is often the\nfavored medical imaging technique for clinical exam-\nination due to its high resolution, soft tissue contrast and\nlack of harmful exposure to radiation. One drawback of MRI\nacquisitions is the long imaging time, which can not only lead\nto artifacts in the image itself due to patient movement, but\nalso be exhausting for the patient. To speed up the imaging\nprocess, nowadays, scanner acquire the image information\nwith multiple coils and often use a technique called undersam-\npling [1][2]. The concept of undersampling involves acquiring\nonly a reduced amount of information and subsequently re-\nconstructing it, resulting in imaging acceleration of up to 48\ntimes [3], although in clinical practice, it is often limited to\nup to 10 times.\nEven though the scanning time for the patient is greatly\nimproved, the undersampled data leads to wrapping artifacts\nas well as lower signal values, decreasing the signal-to-noise\nratio (SNR) by by the square root of the undersampling rate.\nAs a consequence, complex reconstruction methods, such as\nfor example the commonly used algorithms GRAPPA [4] or\nSENSE [5] have to be applied on the raw data, which can be\nvery time intensive and introduce additonal noise amplification\n(also known as geometry factor, g-factor) [6].\nWith a fatality rate of 11% and being the most frequent\nmalignancy among men in 2023 [7], the detection for prostate\ncancer (PCa) is an urgent task. Because downstream tasks,\nsuch as segmentation and classification rely on fully recon-\nstructed image data, there is a great urge to reduce the\nreconstruction time. Due to advances in the field of deep\nlearning in the past years, the quality of reconstruction of the\nundersampled data has greatly improved, while reducing the\ncomputation times [8][9]. While all common reconstruction\nalgorithms output an image interpretable for radiologist and\nother clinicians, raw MRI data is acquired in the so called\nk-Space. This complex valued raw data, which is normally\ndiscarded after reconstruction, holds more information than\ncurrently used by downstream tasks [10], such as tumor\nclassification.\nIn this work, we show that by utilizing the MRI k-Space,\nclassification on MRI data can be improved. Additionally,\ndue to the elimination of time-intensive reconstruction tech-"}, {"title": "II. RELATED WORK", "content": "For prostate cancer detection and classification, multiple\ndifferent clinical methods can be used, such as [11]:\n\u2022\n\u2022 prostate-specific antigen (PSA),\n\u2022 digital rectal exam,\n\u2022 trans-rectal ultrasound (TRUS),\n\u2022 multiparametric magnetic resonance imaging (mpMRI).\nBecause the first three methods often lead to more discomfort\nfor the patient, today MRI, especially multiparametric MRI,\nincluding diffusion weighted imaging (DWI), is the preferred\nmethod for detecting PCa [12][13]. The scans are commonly\nranked by the clinical Pi-RADS score in a range between\none (clinically significant cancer is highly unlikely) to five\n(clinically significant cancer is highly likely) [14].\nOne major issue of MRI is the aspect of time needed\nfor performing the scan itself, with DWI scans taking up\nto 10 minutes. By reducing the imaging time, which also\nincreases the comfort for the patient, more subjects can be\nscanned in the clinical routine. One common way of reducing\nthe scanning time is to undersample the so called k-Space,\ne.g. only scanning every forth k-Space line, thus reducing\nthe overall scanning time by the factor of \u00d74. Another time\nconsuming aspect of MRI is the k-Space reconstruction after\nthe initial scan, such as GRAPPA, which can take more than\n10 additional minutes.\nWith the advent of machine learning, especially in the\nmedical domain [15][16], radiologist have new, powerful tools\nat their hand to support them in their search for clinically\nsignificant PCa. Convolutional Neural Networks (CNNs), such\nas the ConvNeXt [17], show superhuman performance on a\nwide range of classification tasks and are adaptable to many\ndifferent fields of work. Novel algorithms can detect PCa\nbased on the DWI images automatically [18]. Schelb et al.\n[19] showed that their U-Net trained with T2-weighted and\ndiffusion MRI was able to achieve similar performance to Pi-\nRADS assessment.\nBut all state-of-the art algorithms for prostate cancer de-\ntection have two things in common: they only work on fully\nsampled or reconstructed data and they perform the detection"}, {"title": "III. MATERIAL AND METHODS", "content": "The Fourier Transformation [21] is one of the most im-\nportant equations in signal theory. It converts a 2D-signal\nfrom the time-domain into the frequency-domain or from the\nspatial-domain into the spatial-frequency-domain. By using the\ninverse form, one can convert the raw MRI data (k-Space) into\nthe image domain. This process is completely reversible and\ndoes not lose any information, as long as both magnitude and\nphase are preserved.\nB. k-Space & Data Acquisition\nThe so-called k-Space is the complex valued raw data\ndomain of MRIs. By applying the inverse Fourier Transforma-\ntion, one can convert the data into the complex valued image\ndomain. Today, MRI scanner use multiple coils to acquire\ndifferent parts of the image simultaneously, which are then\ncombined by performing a root square sum (RSS) calculation\nover all coils in the image domain. By using the sensitivity of\neach coil, the final image can be modulated out of the resulting\nset of k-Space matrices.\nCommonly used images for downstream tasks, such as\ntumor classification, are only the magnitudinal data of the\nimage domain, leading to a loss of phase information. Phase\ninformation was shown to be useful for many downstream\ntasks, an example being flow detection [22].\nC. Datasets\nThe amount of publicly available datasets which include\nMRI raw data is scarce, as this data is not commonly saved in\nclinical practice. We are only aware of a single dataset, suitable\nfor classification tasks. Nevertheless we are able to show the\nadvantage of using the raw data over only using magnitudinal\ndata.\nThe FastMRI Prostate dataset [23] contains T2 and DWI\nraw data with different amounts of coils (14 - 30) and slices\n(24 - 38), with a in-plane resolution of 2.0 \u00d7 2.0 mm. The\ndata was acquired on two clinical 3T systems (MAGNETOM\nVida, Siemens Healthineers, Germany). The DWI raw data has"}, {"title": "D. Preprocessing & Network Architecture", "content": "To get from the initial MRI raw data to the final image used\nin clinical workflows, a lot of preprocessing steps, some being\nvery time intensive, have to be performed. In the case of the\nDWI raw data, the shape of the k-Space is [Average, Coil,\nDepth, Width, Height]. The averages are used to calculate the\nfinal data over multiple scans to reduce noise. Each coil in\nthe data covers a different part of the image with different\nintensity.\nThe first necessary preprocessing steps are calculating the\ndata average and combining the coils. A comparison of the\nstandard preprocessing pipeline and the proposed pipeline is\nshowed in Fig. 3.\nTo simplify the averaging calculation, instead of splitting\nthe DWI data into b50, b1000 and adc channel, which will be\nsubject of future work, we sum all averages into one channel.\nIn the next step, the data is then either fed into the principal\ncomponent analysis (PCA) [24] pipeline or the GRAPPA\nalgorithm. The PCA transforms the data such that it results\nin multiple principal components, with a descending amount\nof variance in the data. The very first principal component is\nthe k-Space of interest for us. While MRI coils are typically\ncombined in the image domain by using their coil sensitivity\nmaps or RSS, PCA can compress the coils directly in the k-\nSpace. Because PCA is a compression method, information\nare lost when just using the very first principal component.\nNevertheless, in our experiments it showed, that in the case\nof DWI data, using more than the first component does not\nattribute to better classification results. The resulting data will\nbe the sum over all averages and compressed into one single\ncoil.\nThe GRAPPA algorithm interpolates missing multi-coil k-\nSpace signals by convolution. Coil combination is done after\nFFT in the image domain, e.g. by a root-sum-of squares\ncombination or an adaptive coil-combination [25].\nThe general implementation of the GRAPPA algorithm does\nnot save the k-Space information, as it is supposed to output\na reconstructed magnitudinal image in the image domain. We\nadapted it such that intermediate k-Space results are saved.\nIn our experiments, to preserve the k-Space, we again use a\ncoil compression via PCA after the GRAPPA reconstruction\nto. Thus, both PCA and our GRAPPA implementation outputs\nare complex valued and still in the frequency domain. To feed\nthe data into the real valued ConvNeXts, the data is split\ninto magnitude and phase in the image domain, by applying\nthe inverse Fourier transformation, as well as into real and\nimaginary parts in the k-Space. Depending on the experiment,\nthese parts are then stacked as multiple channels and fed into\nthe networks.\nIn case of the GRAPPA and \"gold-standard\" data, the\nimage domain data and k-Space data are given into two\nseparate neural networks. The output it then averaged and\nback-propagated through both networks.\nExemplary data can be seen in Fig. 4.\nThe top row shows the resulting magnitudinal image domain\ndata, the middle row the corresponding phase information.\nThe phase is wrapped into the range of $[-\\pi; \\pi]$. The bottom\nrow shows the magnitudinal k-Space data, which is plotted\nlogarithmically for better visuality.\nIt has to be stated, that our implementation is not opti-\nmized as it is for algorithms directly implemented on MRI\nscanner. These implementations are often optimized for the\nspecific vendor and can perform quicker reconstructions. The\nfollowing experiments and results are supposed to emphasize\nthe speed-up achieved by performing predictions at higher\nundersampling rates. Using PCA data instead of performing\nreconstruction can save additional time and also reduce the\nenergy footprint, but the extent of these benefits depends on\nthe final implementation on the scanner.\nAs a state-of-the-art neural network, we implement the\nConvNeXt with roughly 3 million parameters using the timm\nframework [26]- This framework allows us to easily change the\nnumber of channels of ConvNeXt. The network is pretrained\non ImageNet [27].\nAn overview of the pipeline is shown in Fig. 1."}, {"title": "E. Undersampling Augmentation", "content": "A key ingredient for the successful training of a neural\nnetwork is data augmentation. Training data is altered to\nartificially create and thus increase the available data. By\napplying multiple augmentations, the network becomes more\nrobust against unseen data. We propose a new undersampling\nmethod, tailored for MRI data, the simulated undersampling\naugmentation. To artificially undersample the data and to\nimplement the undersampling augmentation, a cartesian under-\nsampling pattern is applied, by evenly cutting out every n-th\nline in the k-Space, as can be seen in Fig. 4 (bottom). We only\nsimulate the strategy of evenly undersampling the k-Space, as\nit is the commonly used technique in DWI. Future experiments\nwill show different undersampling patterns on other imaging\nsequences."}, {"title": "IV. EXPERIMENTS", "content": "In a first experiment, we compare the prediction results on\nthe \"gold-standard\u201d data with and without additionally k-Space\ninformation. The image domain data consists of reconstructed\ndata via GRAPPA and combined coils with the coil sensitivity\nmaps. The additional k-Space data is compressed after the\nGRAPPA reconstruction via PCA and no further postprocess-\ning is performed. The two methods are compared on the fully\nreconstructed data, as well as at the native undersampling rate\nof x2. For this experiments, both models are trained with\nundersampling rates of up to x2.\nIn the second experiment, we compare the GRAPPA recon-\nstruction method with the PCA pipeline to show the theoretical\ntime benefits at higher undersampling rates of up to x64. The\nundersampling is digital by removing lines in the k-Space and\nthus does not fully simulate real undersampling at these high\nrates. The b50 data is summed over the x, y and z values to\ncreate one channel for each coil and then compressed via a\nPCA. Both models are trained with simulated undersampling\nrates of up to x8 and tested on rates of up to x64.\nFor training, the Adam optimizer [28] with an initial learn-\ning rate of le-4, a beta coefficient of 0.99 and an epsilon\nvalue of le-08 is used. The learning rate is scheduled using\na cosine annealing schedule. Early stopping with a patience\nof 10 is used to stop the training when the validation loss is\nnot further decreasing. The networks predictions are compared\nwith the ground truth using the Cross-Entropy loss with a\nweight of 17 to 1, reflecting the imbalance of the dataset. In\nall experiments, the training data is augmented by additionally\napplying random horizontal flips. All input data is normalized\nand standardized batch wise and over each channel separately.\nWith a batch size of 128, the overall training time takes less\nthan 30 minutes on average on an NVIDIA A6000 GPU with\n48GB of graphics memory.\nThe hyperparameter have been selected by applying a grid\nsearch for all input types."}, {"title": "B. Evaluation Metrics", "content": "For evaluation we decided to use two metrics, one being\nthe area under the receiver operating characteristic curve\n(AUROC), which describes the area under the curve when\nplotting the True Positive Rate (TPR) against the False Positive\nRate (FPR).\nThe other metric used is the area under the precision recall\ncurve (AUPRC), describing the area under the curve when\nplotting the recall against the sensitivity,\n$Precision = \\frac{TR}{(TR + FP)}$ (1)\n$Recall = \\frac{TR}{(TR + FN)}$ (2)\nwith TR being true positives, FP being false positives and FN\nbeing false negatives.\nTo gather confidence intervals, the bootstrapping method\nwith 1000 iterations has been applied on the test dataset."}, {"title": "V. RESULTS", "content": "Fig. 5 shows the results for the fully reconstructed \"gold-\nstandard\" data. We compare the use of only the image domain\ndata (Mag) with the use of additional k-Space data. The combi-\nnation of ADC, Trace50 and Trace1000 takes into account all\navailable image domain information. The k-Space data for the\nADC map can not be calculated, as it depends on calculations\nin the magnitudinal image domain. Nevertheless, the model\nwith additional k-Space information achieves better results\nthan its image domain counterpart at an undersampling rate of\nx2 with an AUROC of 86.1% \u00b1 1.8%. When not taking into\naccount the ADC map, thus eliminating the need for an addi-\ntional bo image, the additional k-Space information leads to\nbetter results for no additional undersampling (85.3%\u00b11.3%),\nas well as for x2 undersampling (83.9% \u00b1 1.8%). Additional\nAUPRC values can be found in Tab. I."}, {"title": "VI. DISCUSSION", "content": "In this paper, we proposed a novel MRI raw data preprocess-\ning pipeline in combination with a state-of-the art classification\nneural network to utilize the hidden information in the k-Space\nfor better prediction results as well as faster acquisition and\nreconstruction times, while still achieving meaningful results\nfor prostate cancer likelihood predictions. Using additional k-\nSpace information with a dual network structure we were able\nto improve the predictions for different data combinations,\nincluding the \"gold-standard\", consisting of ADC, Trace50\nand Trace1000 maps. By applying a PCA instead of time\nintensive reconstruction techniques such as GRAPPA, as well\nas using high undersampling factors, the scanning time, as\nwell as the time needed for a first initial diagnosis can be\ngreatly reduced by more than 80%. When performing PCa\nprediction at undersampling factors greater than eight, the\nadditional information in phase and k-Space show improved\nstability of the network, enabling it to reach sound results,\nwhile the model with only magnitudinal data (which is the\ndata radiologists use for their review) starts to fail making\nmeaningful predictions.\nNevertheless, this study comes with limitations, one being\nthe simple form of undersampling used. The undersampling by\nevenly leaving out k-Space lines can simulate the correspond-\ning artefacts. It can not reproduce the lower signal-to-noise\nratio (SNR) due to fewer acquired measurements [29] or the\nreduced motion artifacts due to shorter acquisition times. For\nDWI imaging with EPI, higher undersampling rates may result\nin a different image contrast due to reduced T2* weighting as\nwell as distortions due to the shorter echo train.\nPerformance on more complex undersampling techniques\nfor other imaging sequences will be explored in future ex-\nperiments. Additionally, the digital undersampling on the\nGRAPPA output does not reflect the actual data we would use\nwhen GRAPPA is applied. Undersampling would be applied\nbefore performing reconstruction. Reconstruction techniques"}, {"title": "VII. CONCLUSION", "content": "By saving valuable raw data information of MRI DWI\nimages, we were able to show the benefits of using additional\ninformation hidden in the k-Space, to predict the PCa like-\nlihodod on DWI data. Applying high undersampling rates in\ncombination with additional k-Space data leads to a reduction\nof time needed for scanning as well as reconstruction by\nup to 90% in comparison to no applied undersampling and\ncommonly used reconstruction techniques such as GRAPPA.\nTo the best of our knowledge, this is the first work to explore\nthe feasibility of using MRI raw data for a classification tasks\nsuch as PCa likelihood estimation.\nMachines need different data than humans. We hope that\nmore research with raw MRI data will emerge in the future,\nwhich will lead to improved diagnostics and patient comfort."}]}