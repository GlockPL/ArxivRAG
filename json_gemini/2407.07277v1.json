{"title": "Lifestyle-Informed Personalized Blood Biomarker Prediction via Novel Representation Learning", "authors": ["A. Ali Heydari", "Naghmeh Rezaei", "Javier L. Prieto", "Shwetak N. Patel", "Ahmed A. Metwally"], "abstract": "Blood biomarkers are an essential tool for healthcare providers to diagnose, monitor, and treat a wide range of medical conditions. Current reference values and recommended ranges often rely on population-level statistics, which may not adequately account for the influence of inter-individual variability driven by factors such as lifestyle and genetics. In this work, we introduce a novel framework for predicting future blood biomarker values and define personalized references through learned representations from lifestyle data (physical activity and sleep) and blood biomarkers. Our proposed method learns a similarity-based embedding space that captures the complex relationship between biomarkers and lifestyle factors. Using the UK Biobank (257K participants), our results show that our deep-learned embeddings outperform traditional and current state-of-the-art representation learning techniques in predicting clinical diagnosis. Using a subset of UK Biobank of 6440 participants who have follow-up visits, we validate that the inclusion of these embeddings and lifestyle factors directly in blood biomarker models improves the prediction of future lab values from a single lab visit. This personalized modeling approach provides a foundation for developing more accurate risk stratification tools and tailoring preventative care strategies. In clinical settings, this translates to the potential for earlier disease detection, more timely interventions, and ultimately, a shift towards personalized healthcare.", "sections": [{"title": "I. INTRODUCTION", "content": "Blood biomarkers are used in disease diagnosis (e.g. glycated hemoglobin [HbA1c] to diagnose diabetes), or determining specific therapies (e.g. prescribing cholesterol-lowering medication to people with hypercholesterolimia). A critical step in the clinical use of blood biomarkers is establishing reference values and recommended ranges (RR) for each biomarker. Currently, a majority of traditional references do not take into account age, sex, or other individual factors, which is considered a meaningful limitation [1], [2]. A growing body of evidence suggests that personalizing references can lead to more accurate and reliable diagnoses and better patient outcomes: For example, Zaninetti et al. [1] showed the impact of personalizing RRs on the number of people diagnosed with unexplained thrombocytopenia. Rappoport et al. [3] compared the differences in laboratory tests based on ethnicity and found the distributions of more than 50% of blood biomarker RRs to differ among self-identified racial and ethnic groups. Beutler et al. [4] presented age- and ethnicity-adjusted RRs for hemoglobin and showed the impact on diagnosing anemia. Cohen et al. [2] found significant differences in numerous blood biomarker distributions for numerous laboratory tests based on age and biological sex. Though such studies highlight the significance of personalized RR based on demographics, none account for the impact of lifestyle (e.g. physical activity and sleep) on biomarker reference values, despite several studies reporting the impact of lifestyle on blood biomarekrs in lowering glucose [5], [6], increasing insulin sensitivity [7], [8], and improving lipid profiles [9], [10].\nWhile the significance of personalizing disease management based on lifestyle factors has been the subject of numerous studies (see review paper by Minich et al. [11]), research on personalizing blood test ranges based on individual factors, such as lifestyle, are rare [11]. Similar to our goal of predicting future (next visit) blood biomarker values, Cohen et al. [2] investigate the effect of personalizing biomarker reference values and propose three strategies for predicting an individual's biomarker values forward in time using untransformed representations (normalized raw data), which, importantly, do not utilize individuals' lifestyle. These strategies are: (1) \"Single-Lab\" (marker of interest), Single Time Point: Using previous laboratory visits, the authors take the average age- and sex-adjusted laboratory values to perform a 2-year forward regression. (2) \u201cMulti-Lab\u201d (all available blood biomarkers), Single-Time Point: The authors use all available laboratory values and patients' current age to predict the value for the marker of interest two years forward in time.(3) \u201cMulti-Lab, Multi Time Point\": The authors use multiple biomarker time points for the prediction of future values. Given our goal of predicting future blood test values from a single visit, the \"Multi-Lab, Multi Time Point\" technique of Cohen et al. is not relevant to our work.\nCapturing the relationship between biomarkers and lifestyle factors is crucial for developing effective computational predictive strategies [12]. Recent evidence suggests that the interplay between various biomarkers and lifestyle factors is complex [13], which highlights the importance of considering nonlinear dependencies between various biomarkers and lifestyle. As a result, the field has shifted towards utilizing machine learning (ML) methods to model health and patient outcomes [2], [14]. Recent studies have shown promising results in employing deep learning (DL) approaches that out-"}, {"title": "A. Novel Deep Metric Learning Approach for Learning Patient Similarity", "content": "We introduce a valuable modification to the traditional triplet loss with the goal of producing embeddings that are more compact for each class and well-separated from dissimilar classes. Although our formulation is focused on EHR, our modified triplet loss can be applied to other domains as well.\nModel Formulation. We aim to learn a transformation $\\phi$ that can map similar data points closer together (e.g. subjects with comorbidities), and dissimilar data points farther apart (e.g. healthy and unhealthy subjects). To do so, we leverage the traditional triplet framework and propose a novel objective based on distances between triplets of data points (anchor, positive, negative).\nLet $\\mathcal{X}$ be the collection of features for individuals with $c \\in \\mathbb{N}$ many distinct conditions (e.g. diabetes, cancer, etc.). Let $p_i$ and $a_i$ represent the traditional positive and anchor points that are chosen at random from the same class, while the negative vector $n_i$ is chosen to be from a different class randomly (i.e. positive or anchor cannot have the same labels as negative). The reasoning behind such selection is to make the naive assumption that all conditions are completely dissimilar, which in turn would force the model to better learn similarities between conditions and comorbidities on its own. Using the selected vectors, and given a margin $\\epsilon_0 > 0$ (a hyperparameter), the traditional objective for a triplet network would be formulated as:\n$L_{Triplet}(p_i, a_i, n_i) = [d(\\phi(a_i), \\phi(p_i)) - d(\\phi(a_i), \\phi(n_i)) + \\epsilon_0]_+,$ (1)\nwith $\\phi$ denoting a neural network, $[\\u00b7]_+ = max{\\u00b7, 0}$, and $d(\\cdot)$ being the Euclidean distance. This objective would force the model to satisfy\n$d(\\phi(a_i), \\phi(n_i)) > d(\\phi(a_i), \\phi(p_i)) + \\epsilon_0$.\nHowever, given that healthcare records often suffer from high in-class variability within each condition, enforcing additional restrictions on the distance between positive and negative samples could improve learning. Moreover, given our goal to encourage learning similarities from different conditions, we must also enforce additional regularization between dissimilar samples. However, minimizing Eq. (1) only ensures that the negative pairs fall outside of an $\\epsilon_0$-ball around $a_i$, while bringing the positive sample $p_i$ inside of this ball, which may be insufficient. For example, many of the healthy patients (those without a clinical diagnosis) may be close to the bona fide healthy group, but others in the healthy population may have undiagnosed conditions, therefore being closer to other participants with clinical diagnosis. As a result of the underlying biology and the shortcomings of traditional triplet objective, we add a regularization term with the goal of addressing these two issues, as shown in Eq. (2):\n$L(p_i, a_i, n_i) = [d(\\phi(a_i), \\phi(p_i)) - d(\\phi(a_i), \\phi(n_i)) + \\epsilon_0]_+ + [d(\\phi(p_i), \\phi(n_i)) - d(\\phi(a_i), \\phi(n_i))]^p$ (2)\nwhere $p \\in \\mathbb{N}$. The regularization term in Eq. (2) will enforce the positive samples to be roughly the same distance away as all other negative pairings in the training triplets, while still minimizing their distance to the anchor tensors. However, if not careful, this approach could result in the model learning to map $n_i$ such that $d(\\phi(a_i), \\phi(n_i)) > max{\\epsilon_0, d(\\phi(p_i), \\phi(n_i))}$, which would ignore the triplet term, resulting in a minimization problem with no lower bound. To avoid such issues, we restrict $p \\ge 2$ (or more generally, $p = 0 \\pmod 2$) as shown in Eq. (3):\n$L_{Proposed}(p_i, a_i, n_i) = [d(\\phi(a_i), \\phi(p_i)) - d(\\phi(a_i), \\phi(n_i)) + \\epsilon_0]_+ + [d(\\phi(p_i), \\phi(n_i)) - d(\\phi(a_i), \\phi(n_i))]^2$. (3)\nAnalytically, we can express the effect of regularization term and the rational behind allowed values of $p$ as the following:\n$\\delta_+ = d(\\phi_a, \\phi_p); \\ \\delta_- = d(\\phi_a, \\phi_n); \\ \\rho = d(\\phi_p, \\phi_n)$.\nWith this notation, we can rewrite our proposed objective as:\n$\\frac{1}{N} \\sum_{(p_i,a_i,n_i) \\in T} [\\delta_+ - \\delta_- + \\epsilon_0]_+ + (\\rho - \\delta_-)^p$. (4)\nNote that the since $[\\delta_+ - \\delta_- + \\epsilon_0]_+ > 0$, $L_{Proposed} = 0$ if and only if the summation of each term is identically zero. This yields the following relation:\n$-((\\rho - \\delta_-)^p) = [\\delta_+ - \\delta_- + \\epsilon_0]_+$ (5)\nwhich, when $p = 0 \\pmod 2$, is only valid if $\\rho = \\delta_-$, and given that $\\delta_- > \\delta_+ + \\epsilon_0$, we arrive at $\\rho > \\delta_+ + \\epsilon_0$ (considering the real solutions). As a result, the regularization term enforces that the distance between the positive and the negative to be at least $\\delta_+ + \\epsilon_0$, leading to denser clusters that are better separated from other classes in space."}, {"title": "Network Architecture and Training Procedure", "content": "Our transformtion is a neural network consisting of three fully connected layers, each followed by a nonlinear activation (Parametric Rectified Linear Units [PReLU]) and probabilistic dropout layers. Let $x_i \\in \\mathbb{R}^{b \\times n}$ denote the input (b samples with n features), $L(m,q)$ denote a linear operator in $\\mathbb{R}^{m \\times q}$, $PReLU(.)$ denote Parametric ReLU (a pointwise function), and $D(q)$ denote a dropout layer with probability q, then our architecture can be written in pseudocode form as:\n$x_i \\rightarrow PReLU(L(n \\times 512)) \\rightarrow D(0.1)$\n$\\rightarrow PReLU(L(512 \\times 256)) \\rightarrow D(0.1)$\n$\\rightarrow PReLU(L(256 \\times d)) \\rightarrow \\phi(x_i)$\nwhere d represents the output dimension, in our case d = 32. During training, we tuned the hyperparameters via grid search on the validation set. Our search resulted in $\\epsilon_0 = 1$ and initial $lr = 0.001$ with the Adam optimizer, and the architecture listed above. To improve learning, we employed an exponential learning rate decay ($\\Upsilon = 0.95$) to decrease after every 50 epochs, starting after 500 epochs until epoch 800 (last epoch)."}, {"title": "B. Personalized Blood Biomarker Models", "content": "To predict future biomarker values from a single lab visit, we leverage our learned representations in addition to current value of the marker of interest. The rational for including these embeddings is to inform the donwstream prediction model of the complex relationship between various blood markers and lifestyle factors learned by our deep metric learning approach. We define three downstream prediction (regression) models where each differs only in its input, as shown in Fig. 1(a), with age and sex used as common inputs to all models. For a biomarker of interest, let us denote the current value as $b_t$ and the future value as $b_{t+1}$. Using these notations, we define our prediction models as the following:\n\\begin{itemize}\n    \\item Marker of interest + all other biomarkers + lifestyle: Using dempgraphics and all current biomarkers as well as lifestyle factors to predict $b_{t+1}$.\n    \\item Marker of interest + deep-learned embeddings: Leveraging DL embeddings, age, sex and $b_t$ to predict $b_{t+1}$.\n    \\item Marker of interest + deep-learned embeddings + lifestyle: Adding lifestyle factors to the previous model to predict $b_{t+1}$.\n\\end{itemize}\nIn order to showcase the improvements made by model inputs, particularly lifestyle and deep-learned embeddings, and to allow for valid benchmarking of our results with the current state-of-the-art approach, we use the same XGBoost algorithm presented in Cohen et al. [2], including all same parameters, learning objective, and five-fold cross-validation strategy."}, {"title": "C. Data and Data Pre-Processing", "content": "To show the potential of our approach on a broad population, we apply our methodology to the United Kingdom Biobank (UKB), a large-scale dataset consisting of EHR. UKB contains deep genetic and phenotypic data from approximately 500,000 individuals between 39-73 years, collected over many years across Great Britain. Initial assessments were collected between 2006 and 2010 which included a self-administered questionnaire, blood biomarkers (through blood biochemistry), and anthropometric measurements (Fig. 1(b)). UKB data also includes subsequent follow-ups where a subset of patients is invited for a repeat blood test assessment. The follow-up blood test measurements were done between 2012-2013 on approximately 20,000 participants from the first assessment (with many measurements missing, see Fig. 1(b)). Given our goal of predicting future biomarkers from a single visit, we utilize the follow-up assessment as our prospective validation data. That is, we only included participants' first visits for training regression models, and used the 2012-2013 follow-ups to evaluate the biomarkers predictions.\nGiven the complexity of the UKB and the scope of this research, we subset data to include participants' age and sex (demographics), all available blood biomarkers (that passed our quality assessment, described below), Metabolic Equivalent Task (MET) scores for physical activity, and self-reported hours of sleep and physical activity (complete list of features are provided in Fig. 1(c)). We leveraged both ICD-10 code and self-reported diagnosed conditions as well as current medication to assess participants' health, subsequently assigning each participant a label. After selecting these features, we ensured all features are at least 75% complete, dropping any features that did not meet this conditions. We then removed all patients with any null values. Then, we split the resulting data according to biological sex (male or female), and performed quantile normalization.\nFor each sex, we labeled patients based on their diagnosed condition or medication (e.g. participants with diabetes) or as the \"apparently healthy\" population (who do not have any serious health conditions and do not take illness-related medications). Due to age distribution imbalance, and to keep participants with similar ages close, we found the best distribution of individuals when age ranges were grouped unevenly. Each age group was constructed to approximate uniformity in the number of individuals while considering biological differences, with the age groups being [36, 45], [46, 50], [51, 55], [56, 60], [61, 65], [66, 75]. Additionally for the prospective validation cohort, we removed individuals whose repeat assessment were shorter than 2 years or longer than 5 years from the first visit. We then found the overlapping set of individuals who appear in both visits (after processing), ensuring that the first visit of these individuals do not appear in the training set of our representation learning model.\nTo stratify individuals based on lifestyle for our statistical analyses, following the American Heart Association guidelines, we considered 150 minutes of moderate activity or 75 minutes of vigorous activity per week as \"active\" lifestyle. Using the Metabolic Equivalents (METS) fields for moderate and vigorous activity, we placed a simple binary filter to classify individuals as \"active\" if they met the sufficient activity thresholds, or \u201cless-active\u201d otherwise. For sleep, we took the median hours of sleep in each age group as the reference value, and divided participants into those who sleep greater than or equal to the median hours (called \u201cmedian sleep\" group) or those who sleep less than the median hours of the group (labeled as \u201cless sleep\u201d individuals).\nCreation of Triplets and Inference Data. To identify conditions (labels), we considered diagnosis and related medication. Due to the large number of diagnoses, we selected a subset of all conditions, prioritizing cardiometabolic conditions and comorbidities based on their prevalence: Our selected conditions were \u201cDiabetes\u201d, \u201cDiabetes and Cardiovascular\u201d, \u201cDiabetes and Other Serious Conditions\u201d, \u201cDiabetes, Cardiovascular and Other Serious Conditions\u201d, \u201cMultiple Conditions (non-metabolic)\u201d, \u201cCardiovascular (not having Diabetes)\u201d, \u201cCardiovascular and Other Serious Conditions (not Diabetes)\", \u201cRespiratory\u201d, \u201cCancer\u201d. All individuals with no diagnosis or medications were first labeled as \"Apparently Healthy\". Using traditional reference ranges, we labeled an apparently-healthy individual as bona fide healthy if all blood biomarkers were within the traditional recommended ranges. The above steps resulted in 12 disease groups.\nFor modeling, we separated individuals based on biological sex and randomly selected 70% of each sex for training and 10% of participants for validation, ensuring that individuals with repeat assessment do not appear in these two sets. We used the remaining 20% of data for testing. From the training data for each sex, we created 100,000 unique triplet pairs randomly selecting positive and anchor points from the same conditions, and negative pairs from a different condition. We repeated these steps five times for evaluating our results.\""}, {"title": "III. RESULTS", "content": "To quantitatively test the importance of physical activity and sleep on blood biomarker ranges, we compared the distributions of participants stratified by sex (male or female), age, and lifestyle. Given the general Gaussian assumption on blood biomarker distributions and our empirical analysis, we performed Student's t-test to measure the difference in each age-sex group based on activity levels for 30 markers (highlighted with asterisks in Fig. 1(c)). In order to reduce type I error, we adjusted our p-value using Benjamini-Hochberg correction, with a false discovery rate of q = 0.05. For female participants, our analysis showed that 22 out of the 30 (\u224873%) blood metrics were significantly different in at least one of the age groups, with 18 of 30 metrics (~60%) being significantly different in at least half of all age groups. Similarly, for male patients, we found that 19 of 30 metrics (\u224863%) were significantly different in one age group or more, with 18 being different in at least half of the age groups (~60%). We present our results for a subset of common blood biomarkers in Fig. 2(b). Similarly, we performed a t-test (with the same p-value adjustment as before) for detecting significant differences in the age-sex groups based on sleep levels for the same 30 biomarkers. Our analysis found 10 of 30 markers (\u224833%) in females and 11 of 30 (\u224836%) in males to be significantly different in at least one age group, 3 of 30 blood biomarkers (10%) and 4 of 30 (\u224813%) to be significantly different in at least half of age groups for females and male. Our analyses indicate that considering lifestyle, especially physical activity, in addition to age and sex, may improve personalized predictions and downstream tasks."}, {"title": "B. Deep Representation Learning Improves Downstream Tasks", "content": "Using each individual's demographics, blood tests, and lifestyle signals as inputs (a total of 64 features), we trained our model to minimize the distance between individuals with the same conditions with respect to an anchor point, leveraging each person's existing conditions as labels to separate them from one another in space. As a qualitative assessment, we compared raw subject representations with our proposed embeddings in lower dimensions (using Uniform Manifold Approximation and Projection [UMAP]), which showed stark differences in individual's spatial distribution based on their conditions (Fig. 3(a)). Moreover, even though we did not explicitly express the relationship between comorbidities, our model was able to learn the similarities between these people and embed them closer to one another (e.g., see Diabetes + Comorbidities panels in Fig. 3(a)).\nTo quantitatively assess the quality of various embeddings, we started by performing a binary classification of whether any health conditions exist, i.e. separating people based on those with doctor-confirmed conditions (or medications) and those without any conditions or condition-specific medications. For traditional approaches, we identified Principal Component Analysis (PCA) (linear transformation), and Diffusion Maps (DiffMap) (nonlinear transformation) as two of the most common transformations used for representing EHR data. Using these methods, we transformed the UKB data and classified individuals as \u201chealthy\u201d or \u201cunhealthy\u201d using four common classifiers to show the true effect of embedding on identifying conditions. Our results, presented in Fig. 3(b)-Table II, indicate that our model's embeddings significantly improve classification accuracy across all tested classifiers (over 10% improvement in weighted F1 score for both males and females). To further validate our results, we also trained each of the classifiers to predict the underlying conditions (twelve aggregated conditions in total), thus constituting a multi-class classification. Similar to the binary case, our deep-learned embeddings enabled significant improvements in classifying different conditions, with over 9% improvement compared to the next-best approach (Figure 3(b), Table II). These results indicate the tremendous potential of transforming raw blood biomarkers with our proposed apporach, which can facilitate and enhance various downstream tasks. To further demonstrate the effectiveness of our novel metric learning approach, we compared our model with current state-of-the-art metric learning models on the UK Biobank for the same classification tasks. Our results showed our approach outperforming networks trained with common metric learning objectives and contrastive architectures (loss function and data curation), as shown in Fig. 3(c)-Table III, thus showing the improvements of our proposed objective."}, {"title": "C. Personalized Blood Biomarker Model for Future Value Prediction", "content": "To measure the accuracy of our future lab results prediction, we calculated the $R^2$ values of our prediction on 6440 apparently-healthy individuals in the prospective validation cohort (using the first visit to predict the next blood biomarker values), with the resulting $R^2$ ranging from 0.05 to 0.81. For 43 of 55 biomarkers, we found that adding lifestyle factors alone improved $R^2$ scores over the baseline (marker of interest only) and the current best model for single time prediction (marker of interest + all other biomarkers by Cohen et al's) by over 5% in at least half of the age groups, with notable enhancements among the metabolic blood biomarkers. Additionally, our results indicated that the addition of our proposed deep-learned embeddings further increased $R^2$ scores in 50 of 55 blood biomarkers compared to the other strategies by over 10%. Moreover, we found that adding lifestyle factors directly to the \"Marker of interest + Embeddings\" model (resulting in the \"Marker of interest + Embeddings + Lifestyle\" model) achieved the best performance in at least half of the age groups for 47 of 55 tested laboratory markers. We present our results for four randomly-selected metabolic markers in Fig. 4."}, {"title": "IV. CONCLUSIONS AND DISCUSSION", "content": "In this work, we introduced a framework for personalized blood biomarker models which aim to move beyond population-level statistics, and incorporating individual lifestyle and demographics factors that significantly impact and personalize these reference values. We demonstrated that lifestyle, particularly physical activity levels, plays a crucial role in shaping blood biomarker distributions, often more prominently than even age or sex in specific cohorts. This highlights the limitations of population-level statistics and underscores the need for personalized approaches that account for individual variability.\nWe introduced a novel deep metric learning approach that aims to capture the complex interactions between biomarkers by learning a similarity-based embedding space. Our method outperforms commonly used traditional representation learning techniques, e.g. PCA and Diffusion Map, and models trained with state-of-the-art contrastive and metric learning objectives, demonstrating our model's ability to capture clinically-relevant information in the produced embeddings. Furthermore, we showed that integrating these embeddings into future biomarker prediction models lead to significant improvements in prediction accuracy, particularly for metabolic markers. The addition of lifestyle features directly into these models amplifies their predictive power, highlighting the critical role of lifestyle in shaping future biomarker values. Our results showcase the utility of our approach in a clinical setting where future value of blood biomarkers can be estimated using only a single laboratory visit. Additionally, our personalized approach is able to provide important context and interpretability for out-of-norm blood biomarker values using patients' history, which can be of significant value for preventive care and diagnosis in clinical applications.\nA limitation of our work is the lack of large longitudinal cohort that has continuous phenotypes and lifestyle dataset, where we can train models to predict future outcome at specific time horizon. We used the UK Biobank, which currently is the largest available dataset (500K participants), where only 4% of participants (20K) have a second follow-up blood test. Hence, our approach was designed specifically for single-time representation learning and prediction. However, the inclusion of additional timepoints and visits, when available, can potentially provide valuable context and insights, a feature that is not currently possible with our framework. Additionally, UK Biobank is less diverse cohort with majority from European ancestry. We hypothesize that our results can be further strengthened through training and validation on more diverse set of patient populations. In the future, we plan to include \"All of Us\" data [33], which consists of a more diverse cohort, in our training pipeline.\nBy enabling the prediction of personalized blood biomarker values from a single patient visit, our framework has the potential to empower (1) early disease detection and risk stratification, since personalized reference ranges provide a more accurate baseline for individual patients, enabling earlier detection of deviations that may indicate underlying health risks, (2) Tailored interventions and preventative care by understanding the influence of lifestyle on individual biomarker trajectories, and (3) improved patient outcomes through leveraging advanced ML models to better analyze EHR, holding the potential to improve diagnostic accuracy and optimize treatment strategies. Our findings pave the way for a new paradigm in healthcare where individual variability and lifestyle are no longer seen as confounding factors, but as essential components for personalized care and treatments."}, {"title": "CONFLICT OF INTEREST", "content": "This study was funded by Google LLC. All authors are employees of Google and may own Alphabet Inc. stock as part of their standard compensation package."}, {"title": "CONTRIBUTIONS", "content": "AA.H, N.R, J.L.P, S.N.P, and A.A.M. conceived the project. N.R and J.L.P selected the dataset and scope of the project. AA.H designed the experiments with feedback and inputs from N.R, J.L.P, and A.A.M. AA.H implemented the algorithms and performed evaluations. N.R, J.L.P, S.N.P, A.A.M. provided feedback on the methodology and results. All authors helped in writing and revising the manuscript."}]}