{"title": "Neural Network Tire Force Modeling for Automated Drifting (AVEC '24)", "authors": ["Nicholas Drake Broadbent", "Trey Weber", "Daiki Mori", "J. Christian Gerdes"], "abstract": "Automated drifting presents a challenge problem for vehicle control, requiring models and control algorithms that can precisely handle nonlinear, coupled tire forces at the friction limits. We present a neural network architecture for predicting front tire lateral force as a drop-in replacement for physics-based approaches. With a full-scale automated vehicle purpose-built for the drifting application, we deploy these models in a nonlinear model predictive controller tuned for tracking a reference drifting trajectory, for direct comparisons of model performance. The neural network tire model exhibits significantly improved path tracking performance over the brush tire model in cases where front-axle braking force is applied, suggesting the neural network's ability to express previously unmodeled, latent dynamics in the drifting condition.", "sections": [{"title": "1 Introduction", "content": "The maneuvering capability of a vehicle is fundamentally limited by the friction between the tires and the road. Vehicle operation at the friction limits may require large lateral and longitudinal tire slip, a regime that can be difficult to model accurately in the presence of parameter variation [1]. This is due in part to the many empirically defined characteristics of tire material composition (e.g. coefficient of friction between tire and road, cornering stiffness of the tire, thermal properties) and the geometry of tire and suspension subassemblies (e.g. camber, caster, and toe angles) that can significantly impact the overall vehicle dynamics [2]. The resulting force and moment computations of physics-based models are sensitive to the precise representation of these dynamic characteristics, particularly when operating in coupled slip regions at the limits of handling [1].\nRecently, autonomous racing and drifting have emerged as challenge problems for demonstrating precise vehicle control at the friction limits. While interesting problems on their own, the insights gained from automated racing and drifting also lay the foundation for future automated systems that could improve safety. To succeed, controllers must reliably control tire forces in these nonlinear, coupled slip regions. Autonomous drifting, in particular, poses challenges as the tires are not only operating in these coupled slip regions but also heating and disintegrating over the course of the test [3]."}, {"title": "2 Experimental Setup", "content": "2.1 Neural Network Model Development\nWe structure the input layer of the neural network around the same terms that define lateral tire force generation within the Fiala brush model, as shown in"}, {"title": "2.2 Trajectory Generation", "content": "The same tire force observer that generates front tire lateral force labels for the neural network training assists in fitting front and rear axle tire parameters. In addition to fully defining the Fiala brush model that served as the point of comparison for these experiments, these tire parameters and the resulting model are used in computing the offline reference trajectory, similar in approach to Weber [7]. This trajectory features a 15 meter radius circle path with a constant sideslip angle of -40 degrees. By incorporating front axle braking, the target velocity decreases from the equilibrium value without the use of brakes $(V_{sol})$ with each revolution of the map (lap 1: $V_{des}$ = $V_{sol}$, lap 2: $V_{des}$ = 0.95. $V_{sol}$, lap 3: $V_{des}$ = 0.875. $V_{sol}$), allowing us to compare model performance in the condition of increasing front axle longitudinal force (lap 1: $F_{xf,ref}$ = 0 N, lap 2: $F_{xf,ref}$ = 1000 N, lap 3: $F_{xf,ref}$ = 2150 N)."}, {"title": "2.3 Control Architecture", "content": "Nonlinear Model Predictive Control (NMPC) can handle multi-input, multi-output systems with nonlinear dynamics and constraints on both states and inputs while predicting future system behavior. These properties are advantageous in trajectory tracking for automated drifting, as exhibited by both Goel and Weber [5,7]. The implementation of NMPC for these experiments is very similar to that of the latter contribution, with a similar cost function (reformulated as a velocity tracking problem) and slightly different costs. The baseline physics-based MPC incorporates a Fiala brush front tire model. The neural network MPC (NNMPC) features an otherwise identical control framework with the same rear tire model and the learning-based front tire lateral force model as a drop-in replacement for the Fiala brush tire model."}, {"title": "3 Results and Discussion", "content": "While both controllers slightly undershoot desired velocity after initiation, NN-MPC is able to respond to the error more quickly and with less oscillation, as shown in Fig. 2a. This is consistent throughout the run, whereas the physics-based MPC tends to respond to changes in desired speed more slowly, incurring\na higher frequency of large absolute velocity errors in the process. This hesitation persists in sideslip angle tracking as well, where physics-based MPC shows some greater deviation from the desired -40 degree sideslip while negotiating control in the other states, as shown in Fig. 2b. Conversely, NNMPC is able to more quickly achieve and maintain the desired sideslip angle, leading to higher frequencies of small absolute sideslip angle errors in the process.\nNNMPC's trend of high performance in the velocity states translates well to path tracking performance, where it exhibits a relatively low mean and max absolute lateral error, as shown in Fig. 2c. In contrast, the physics-based control appears to cause Takumi to slowly slide out from the desired path as the experiment progresses. This trend is consistent with the fact the tire temperature increases throughout the experiment and proportionally reduces friction, as shown by Kobayashi [3]. Conversely, the neural network-based model does not rely upon explicit tire parameterization for the front axle. The neural network may potentially be underfitting these temperature-dependent friction dynamics by generalizing to tire force generation characteristics that are indicative of a wide range of tire temperatures.\nNNMPC's comparatively strong performance trends in both velocity and path state tracking appears to yield an overall reduced steering control effort required to maintain the drift equilibrium throughout the maneuver, as shown in Fig. 2d. However, if we decompose the stages of this experiment further into the drift initiation region (s = 90.7:112.5) and steady state equilibrium region (s = 112.5:435.3), we gain further insights into the advantages and disadvantages of each respective modeling approach-particularly when we focus into the initiation region dynamics, as shown in the insets of Fig. 2. For example, while it may appear that NNMPC is outperforming physics-based MPC in the initiation region, the mean absolute errors of velocity, sideslip angle, and steering angle are higher with NNMPC than with physics-based MPC\u2014and the percent difference is significant (49%, 31%, and 26%, respectively). This is in stark contrast to the steady state equilibrium region of the experiment, where the mean absolute errors of velocity, sideslip angle, lateral error, and steering angle are lower with NNMPC than with physics-based MPC, where the percent difference is significant once again (41%, 46%, 55%, and 53%, respectively). One explanation for this behavior may be found in the way in which the neural network was trained. Of the approximately 30 minutes of data used to train the model, less than 5% can be prescribed to the drift initiation region. This imbalance in data representation can potentially lead to a bias toward solely capturing the dynamics of the steady state equilibrium region. Since the gradients calculated from the dominant region will have a greater influence on the network's parameter updates, this can cause the model to prioritize minimizing the loss in the steady state equilibrium region at the expense of capturing the dynamics of the drift initiation region, further exacerbating the imbalance represented in the data.\nAnother explanation for this behavior may be rooted in how the features and targets were labelled and synchronized. Latencies inherent in observers such as the one used to label tire force targets can cause a temporal misalignment"}, {"title": "4 Conclusion", "content": "This investigation presents a novel neural network architecture for predicting front tire lateral forces as a substitute for traditional physics-based models, with a specific focus on autonomous vehicle drifting maneuvers. Through comparative experimentation using a full-scale automated vehicle, we demonstrated that the neural network model significantly enhances path tracking performance, especially under conditions involving front-axle braking forces. The implications of this study are significant for the development of advanced control systems in au-tonomous vehicles, particularly those designed to operate in extreme conditions. As we continue to build trust and understanding in machine learning techniques, we may be able to achieve higher levels of precision and reliability in vehicle dy-namics modeling, paving the way for safer and more efficient autonomous driving technologies.\nThis research may be extended in several ways to ultimately achieve similar closed-loop performance in trajectories of increasing complexity. Since observer latency and temporal misalignment of labeled data may have been an issue with this approach, we are currently investigating approaches with target labeling that rely solely upon vehicle-collected measurements to potentially eliminate this be-havior. Additional performance enhancements can conceivably be obtained with the inclusion of additional relevant states as input to the neural network (e.g. tire temperature, in order to capture temperature-dependent dynamics) or sim-ply expanding the complexity of the network itself as computational limitations allow."}]}