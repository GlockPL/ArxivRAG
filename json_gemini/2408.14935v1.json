{"title": "Quotient Normalized Maximum Likelihood Criterion for Learning Bayesian Network Structures", "authors": ["Tomi Silander", "Janne Lepp\u00e4-aho", "Elias J\u00e4\u00e4saari", "Teemu Roos"], "abstract": "We introduce an information theoretic criterion for Bayesian network structure learning which we call quotient normalized maximum likelihood (qNML). In contrast to the closely related factorized normalized maximum likelihood criterion, qNML satisfies the property of score equivalence. It is also decomposable and completely free of adjustable hyperparameters. For practical computations, we identify a remarkably accurate approximation proposed earlier by Szpankowski and Weinberger. Experiments on both simulated and real data demonstrate that the new criterion leads to parsimonious models with good predictive accuracy.", "sections": [{"title": "INTRODUCTION", "content": "Bayesian networks Pearl (1988) are popular models for presenting multivariate statistical dependencies that may have been induced by underlying causal mechanisms. Techniques for learning the structure of Bayesian networks from observational data have therefore been used for many tasks such as discovering cell signaling pathways from protein activity data Sachs et al. (2002), revealing the business process structures from transaction logs Savickas and Vasilecas (2014) and modeling brain-region connectivity using fMRI data Ide et al. (2014).\nLearning the structure of statistical dependencies can be seen as a model selection task where each model is a different hypothesis about the conditional dependencies between sets of variables. Traditional model selection criteria such as the Akaike information criterion"}, {"title": "BAYESIAN NETWORKS", "content": "Bayesian networks are a general way to describe the dependencies between the components of an n-dimensional random data vector. In this paper we only address the case in which the component Xi of the data vector X = (X1,..., Xn) may take any of the discrete values in a set {1,...,ri}. Despite denoting the values with small integers, the model will treat each Xi as a categorical variable."}, {"title": "Likelihood", "content": "A Bayesian network B = (G,0) defines a probability distribution for X. The component G defines the structure of the model as a directed acyclic graph (DAG) that has exactly one node for each component of X. The structure G = (G1, ..., Gn) defines for each variable/node Xi its (possibly empty) parent set Gi, i.e., the nodes from which there is a directed edge to the variable Xi.\nGiven a realization x of X, we denote the sub-vector of x that consists of the values of the parents of Xi in x by Gi(x). It is customary to enumerate all the possible sub-vectors G\u00bf(x) from 1 to qi = \\u220fTheG; rh. In case Gi is empty, we define qi = 1 and P(Gi(x) = 1) = 1 for all vectors x.\nFor each variable X\u2081 there is a qi xri table di of parameters whose kth column on the jth row bij defines the conditional probability P(X\u2081 = k | G\u2081(X) = j; 0) = Oijk. With structure G and parameters 0, we can now express the likelihood function of the model as\n\n P(x|G, 0) = \\prod_{i=1}^{n} P(x_i | G_i(x); \\theta_i) = \\prod_{i=1}^{n} \\theta_{iG_i(x)x_i} \\ (1)"}, {"title": "Bayesian Structure Learning", "content": "Score-based Bayesian learning of Bayesian network structures evaluates the goodness of different structures G using their posterior probability P(G|D,\u03b1), where a denotes the hyperparameters for the model parameters 0, and D is a collection of N n-dimensional i.i.d. data vectors collected to a Nxn design matrix. We use the notation Di to denote the ith column of the data matrix and the notation Dy to denote the columns that correspond to the variable subset V. We also write Di,G; for D{i}UG; and denote the entries of the column i on the rows on which the parents Gi contain the value configuration number j by Di,G\u2081=j, j\u2208 {1, ..., qi}.\nIt is common to assume the uniform prior for structures, in which case the objective function for structure learning is reduced to the marginal likelihood P(DIG, a). If the model parameters Oij are further assumed to be independently Dirichlet distributed only depending on i and Gi and the data D is assumed to have no missing values, the marginal likelihood can be decomposed as\n\n P(DIG, a) = \\prod_{i=1}^{n} \\prod_{j=1}^{q_i} P(D_{i,G_i=j}; \\alpha)\n= \\prod_{i=1}^{n} \\prod_{j=1}^{q_i} \\int P(D_{i,G_i=j}|\\theta_{ij})P(\\theta_{ij}; \\alpha)d\\theta_{ij}. \\ (2)"}, {"title": "Problems, Solutions and Problems", "content": "Finding satisfactory Dirichlet hyperparameters for the Bayesian mixture above has, however, turned out to be problematic. Early on, one of the desiderata for a good model selection criterion was that it is score equivalent, i.e., it would yield equal scores for essentially equivalent models Verma and Pearl (1991). For example, the score for the structure X1 \u2192 X2 should be the same as the score for the model X2 \u2192 X1 since they both correspond to the hypothesis that variables X1 and X2 are statistically dependent on each other. It can be shown Heckerman et al. (1995) that to achieve this, not all the hyperparameters a are possible and for practical reasons Buntine Buntine (1991) suggested a so-called BDeu score with just one hyperparameter a \u2208 R++ so that dij. ~ Dir(,..., ).\nHowever, it soon turned out that the BDeu score was very sensitive to the selection of this hyperparameter Silander et al. (2007) and that for small sample sizes this method detects spurious correlations Steck (2008) leading to models with suspiciously many parameters.\nRecently, Suzuki Suzuki (2017) discussed the theoretical properties of the BDeu score and showed that in certain settings BDeu has the tendency to add more and more parent variables for a child node even though the empirical conditional entropy of the child given the parents has already reached zero. In more detail, assume that in our data D the values of Xi are completely determined by variables in a set Z, so that the empirical entropy HN(X\u00bfZ) is zero. Now, if we can further find one or more variables, denoted by Y, whose values are determined completely by the variables in Z, then BDeu will prefer the set ZUY over Z alone as the parents of Xi. Suzuki argues that this kind of behavior violates regularity in model selection as the more complex model is preferred over a simpler one even though it does not fit the data any better. The phenomenon seems to stem from the way the hyperparameters for the Dirichlet distribution are chosen in BDeu as using Jeffreys' prior, \u03b8ijk ~ Dir(,...,), does not suffer from this anomaly. However, using Jeffreys' prior causes marginal likelihood score not to be score equivalent. In Section 3.4, we will give the formal definition of regularity and state that qNML is regular. In addition, we provide a proof of regularity for fNML criterion, which has not appeared in the literature before. The detailed proofs can be found in Appendix B in the Supplementary Material.\nA natural solution to avoid parameter sensitivity of BDeu would be to use a normalized maximum likelihood (NML) criterion Shtarkov (1987); Rissanen (1996), i.e., to find the structure G that maximizes\n\n P_{NML}(D; G) = \\frac{P(D|\\hat{\\theta}(D; G))}{\\Sigma_{D'} P(D'|\\hat{\\theta}(D'; G))}, \\ (3)\nwhere denotes the (easy to find) maximum likelihood parameters and the sum in the denominator goes over all the possible N\u00d7n data matrices. This information-theoretic NML criterion can be justified from the minimum description length point of view Rissanen (1978); Gr\u00fcnwald (2007). It has been shown to be robust with respect to different data generating mechanisms where a good choice of prior is challenging, see Eggeling et al. (2014); M\u00e4\u00e4tt\u00e4 et al. (2016). While it is easy to see that the NML criterion satisfies the requirement of giving equal scores to equal structures, the normalizing constant renders the computation infeasible.\nConsequently, Silander et al. Silander et al. (2008) suggested solving the BDeu parameter sensitivity problem by using the NML code for the column partitions, i.e., changing the Bayesian mixture in equation (2) to\n\n P_{NML} (D_{i,G_i=j}; G) = \\frac{P(D|\\hat{\\theta}(D_{i,G_i=j};G))}{\\Sigma_{D'} P(D'|\\hat{\\theta} (D'; G))}. \\ (4)\nwhere D' \u2208 {1,...,ri}|Di,G\u2081=j|. The logarithm of the denominator is often called the regret, since it indicates the extra code length needed compared to the code length obtained using the (a priori unknown) maximum likelihood parameters. The regret for PNML depends only on the length N of the categorical data vector with r different categorical values,\n\n reg(N,r) = log \\Sigma_{D\\in{1,...,r}^N} P(D|\\hat{\\theta}(D)). \\ (5)\nWhile the naive computation of the regret is still prohibitive, Silander et al. approximate it efficiently using a so-called Szpankowski approximation Kontkanen et al. (2003):\n\n reg(N,r) \\approx \\frac{\\sqrt{2r}\\Gamma(\\frac{1}{2})}{3\\sqrt{N}\\Gamma(\\frac{r}{2})} + (\\frac{r-1}{2}) log(\\frac{N}{r}) - log(\\frac{\\sqrt{3}}{2}) + \\frac{r^2\\Gamma^2(\\frac{r}{2})}{9\\Gamma^2(\\frac{1}{2})} + \\frac{2r^3-3r^2 - 2r + 3}{36N}.\\ (6)\nHowever, equation (6) is derived only for the case where r is constant and N grows. While with fNML it is typical that N is large compared to r, an approximation for all ranges of N and r derived by Szpankowski and Weinberger Szpankowski and Weinberger (2012) can also be used:\n\n reg(N,r) \\approx N(\\log \\bar{C} + (\\bar{a}+2) \\log C_{\\bar{a}}) - C \\ -\\frac{1}{2}log(C_{\\bar{a}+2}) \\ (7)\nwhere \\bar{a} = \\frac{N}{\\alpha} and C_{\\bar{a}} = \\frac{\\Gamma(\\bar{a})}{\\Gamma(N) + \\sqrt{1+\\Gamma(\\bar{a})}} These approximations are compared in Table 1 to the exact regret for various values of N and r. For a constant N, equation (6) provides a progressively worse approximation asr grows. Equation (7) on the other hand is a good approximation of the regret regardless of the ratio of N and r. In our experiments, we will use this approximation for implementation of the qNML criterion.\nfNML solves the parameter sensitivity problem and yields predictive models superior to BDeu. However, the criterion does not satisfy the property of giving the same score for models that correspond to the same dependence statements. The score equivalence is usually viewed desirable when DAGs are considered only"}, {"title": "QUOTIENT NML SCORE", "content": "We will now introduce a quotient normalized maximum likelihood (qNML) criterion for learning Bayesian network structures. While equally efficient to compute as BDeu and fNML, it is free from hyperparameters, and it can be proven to give equal scores to equivalent models. Furthermore, it coincides with the actual NML score for exponentially many models. In our empirical tests it produces models featuring good predictive performance with significantly simpler structures than BDeu and fNML.\nLike BDeu and fNML, qNML can be expressed as a product of n terms, one for each variable, but unlike the other two, it is not based on further partitioning the corresponding data column\n\n $qNML (D; G) := \\Sigma_{i=1}^{n}  INML (D; G)\n:= \\Sigma_{i=1}^{n}  \\log \\frac{P_{NML}(D_{i,G_i}; G)}{P_{NML}(D_{G_i};G)} \\ (8)\nThe trick here is to model a subset of columns as though there were no conditional independencies among the corresponding variables S C X. In this case, we can collapse the \u03a0x\u2081esri value configurations and consider them as values of a single variable with Ixies ri different values which can then be modeled with a one-dimensional PNML code. The sqNML score does not necessarily define a distribution for D, but it is easy to verify that it coincides with the NML score for all networks that are composed of fully connected components. The number of such networks is lower bounded by the number of nonempty partitions of a set of n elements, i.e., the nth Bell number.\nWe are now ready to prove some important properties of the qNML score."}, {"title": "qNML Is Score Equivalent", "content": "qNML yields equal scores for network structures that encode the same set of independencies. Verma and Pearl Verma and Pearl (1991) showed that the equivalent networks are exactly those which a) are the same when directed arcs are substituted by undirected ones and b) which have the same V-structures, i.e. the variable triplets (A, B, C) where both A and B are parents of C, but there is no arc between A and B (in either direction). Later, Chickering Chickering (1995) showed that all the equivalent network structures, and only those structures, can be reached from each other by reversing, one by one, the so-called covered arcs, i.e. the arcs from node A to B, for which B's parents other than A are exactly A's parents (GB = {A} UGA).\nWe will next state this as a theorem and sketch a proof for it. A more detailed proof appears in Appendix A in the Supplementary Material.\nTheorem 1. Let G and G' be two Bayesian network structures that differ only by a single covered arc reversal, i.e., the arc from A to B in G has been reversed in G' to point from B to A, then\n\n sqNML (D;G) = sqNML(D; G').\nProof. Now the scores for structures can be decomposed as SqNML (D; G) = 1 SINML (D;G) and sqNML (D; G') = \u2211-18NML(D; G'). Since only the terms corresponding to the variables A and B in these sums are different, it is enough to show that the sum of these two terms are equal for G and G'. Since we can assume the data to be fixed we lighten up the notation and write PNML(i, Gi) := PNML(Di,G\u2081;G) and"}, {"title": "qNML is Consistent", "content": "One important property possessed by nearly every model selection criterion is consistency. In our context, consistency means that given a data matrix with N samples coming from a distribution faithful to some DAG G, the qNML will give the highest score to the true graph G with a probability tending to one as N increases. We will show this by first proving that qNML is asymptotically equivalent to the widely used BIC criterion which is known to be consistent Schwarz (1978); Haughton (1988). The outline of this proof follows a similar pattern to that in Silander et al. (2010) where the consistency of fNML was proved.\nThe BIC criterion can be written as\n\n BIC(D; G) = \\sum_{i=1}^{n}log P(D_i | G_i) - \\frac{q_i (r_i - 1)}{2} log N,\\ (9)\nwhere DiG; denotes the maximum likelihood parameters of the conditional distribution of variable i given its parents in G.\nSince both the BIC and qNML scores are decomposable, we can focus on studying the local scores. We will next show that, asymptotically, the local qNML score equals the local BIC score. This is formulated in the following theorem:\nTheorem 2. Letri and qi denote the number of possible values for variable Xi and its possible configurations of parents Gi, respectively. As N\u2192 \u221e,\n\n SINML (D; G) = log P(D_i | \\hat{\\theta}_i\\G_i) - \\frac{q_i (r_i - 1)}{2} log N.\nIn order to prove this, we start with the definition of qNML and write\n\n SINML (D; G) = log \\frac{P(D_{i,G_i} | \\Theta_{i,G_i})}{P(D_{G_i}G)} - (reg(N, qiri) - reg(N, qi)). \\ (10)\nBy comparing the equations (9) and (10), we see that proving our clam boils down to showing two things: 1) the terms involving the maximized likelihoods are equal and 2) the penalty terms are asymptotically equivalent. We will formulate these as two lemmas.\nLemma 1. The maximized likelihood terms in equations (9) and (10) are equal:\n\n \\frac{P(D_{i,G_i}|\\hat{\\theta}_{i,G_i})}{P(D_{G_i}G)} = P(D_i | \\hat{\\theta}i\\G).\nProof. We can write the terms on the left side of the equation as\n\n \\frac{P(D_{i,G_i}|\\hat{\\theta}_{i,G_i})}{P(D_{G_i}G)} = \\frac{\\prod_{j,k} (\\frac{N_{ijk}}{N})^{N_{ijk}}}{\\prod_{j} (\\frac{N_{ij}}{N})^{N_{ij}}}, and P(DGG) = \\prod_{j} (\\frac{N_{ij}}{N})^{N_{ij}}.\nHere, Nijk denotes the number of times we observe Xi taking value k when its parents are in jth configuration in our data matrix D. Also, Nij = \u2211k Nijk (and \u03a3k,j Nijk = N for all i). Therefore,\n\n \\frac{P(D_{i,G_i} | \\hat{\\theta}_{i,G_i})}{P(D_{G_i}G)} = \\frac{\\prod_{j,k} (\\frac{N_{ijk}}{N})^{N_{ijk}}}{\\prod_{j} (\\frac{N_{ij}}{N})^{N_{ij}}}\n= \\frac{\\prod_{j,k} (\\frac{N_{ijk}}{N_{ij}})^{N_{ijk}}}{\\prod_j (\\frac{N_{ij}}{N})^{N_{ij}}}\n= \\prod_j \\prod_k (\\frac{N_{ijk}}{N_{ij}})^{N_{ijk}} = P(D_i | G_i).\nNext, we consider the difference of regrets in (10) which corresponds to the penalty term of BIC. The following lemma states that these two are asymptotically equal:\nLemma 2. As N \u2192 \u221e,\n\n reg(N, qiri) - reg(N, qi) = \\frac{q_i (r_i - 1)}{2} log N + O(1).\nProof. The regret for a single multinomial variable with m categories can be written asymptotically as\n\n reg(N, m) = \\frac{m - 1}{2} log N + O(1). \\ (11)\nFor the more precise statement with the underlying assumptions (which are fulfilled in the multinomial case) and for the proof, we refer to Rissanen (1996); Gr\u00fcnwald (2007). Using this, we have\n\n reg(N, qiri) \u2014 reg(N, qi)\n= \\frac{q_iri - 1}{2} log N - \\frac{q_i - 1}{2} log N + O(1)\n= \\frac{qiri - qi}{2} log N + O(1)\n= \\frac{qi(ri - 1)}{2} log N + O(1).\nThis concludes our proof since Lemmas 1 and 2 imply Theorem 2."}, {"title": "qNML Equals NML for Many Models", "content": "The fNML criterion can be seen as a computationally feasible approximation of the more desirable NML criterion. However, the fNML criterion equals the NML criterion only for the Bayesian network structure with no arcs. It can be shown that the qNML criterion equals the NML criterion for all the networks G whose connected components are tournaments (i.e., complete directed acyclic subgraphs of G). These networks include the empty network, the fully connected one and many networks in between having different complexity. While the generating network is unlikely to be composed of tournament components, the result increases the plausibility that qNML is a reasonable approximation for NML in general\u00b9.\nTheorem 3. If G consists of C connected components (G\u00b9,...,GC) with variable sets (V1,...,VC), then log PNML (D;G) = sqNML(D;G) for all data sets D.\nProof. The full proof can be found in Appendix C in the Supplementary Material. The proof first shows that NML decomposes for these particular structures, so it is enough to show the equivalence for fully connected graphs. It further derives the number a(n) of different n-node networks whose connected components are tournaments, which turns out to be the formula for OEIS sequence A000262\u00b2. In general this sequence grows rapidly; 1, 1, 3, 13, 73, 501, 4051, 37633, 394353, 4596553, ...."}, {"title": "qNML is Regular", "content": "Suzuki Suzuki (2017) defines regularity for a scoring function Qn (X | Y) as follows:\nDefinition 1. Assume HN (X | Y') \u2264 HN(X | Y), where Y' CY. We say that QN(\u00b7|\u00b7) is regular if QN (X | Y') \u2265 QN(X | Y).\nIn the definition, N denotes the sample size, X is some random variable, Y denotes the proposed parent set for X, and HN (\u00b7 | \u00b7) refers to the empirical conditional entropy. Suzuki Suzuki (2017) shows that BDeu violates this principle and demonstrates that this can cause the score to prefer more complex networks even though the data do not support this. Regular scores are also argued to be computationally more efficient when applied with branch-and-bound type algorithms for Bayesian network structure learning Suzuki and Kawahara (2017).\nBy analyzing the penalty term of the qNML scoring function, one can prove the following statement:\nTheorem 4. qNML score is regular.\nProof. The proof is given in Appendix B in the Supplementary Material.\nAs fNML criterion differs from qNML only by how the penalty term is defined, we obtain the following result with little extra work:\nTheorem 5. fNML score is regular.\nProof. The proof is given in Appendix B in the Supplementary Material.\nSuzuki Suzuki (2017) independently introduces a Bayesian Dirichlet quotient (BDq) score that can also be shown to be score equivalent and regular. However, like BDeu, this score features a single hyperparameter a, and our initial studies suggest that BDq is also very sensitive to this hyperparameter (see Appendix D in the Supplementary Material), the issue that was one of the main motivations to develop a parameter-free model selection criterion like qNML."}, {"title": "EXPERIMENTAL RESULTS", "content": "We empirically compare the capacity of qNML to that of BIC, BDeu (a = 1) and fNML in identifying the data generating structures, and producing models that are predictive and parsimonious. It seems that none of the criteria uniformly outperform the others in all these desirable aspects of model selection criteria."}, {"title": "Finding Generating Structure", "content": "In our first experiment, we took five widely used benchmark Bayesian networks\u00b3, sampled data from them, and tried to learn the generating structure with the different scoring functions using various sample sizes. We used the following networks: Asia (n = 5, 8 arcs), Cancer (n = 5, 4 arcs), Earthquake (n = 5, 4 arcs), Sachs (n = 11, 17 arcs) and Survey (n = 6, 6 arcs). These networks were picked in order to use the dynamic programming based exact structure learning Silander and Myllym\u00e4ki (2006) which limited the number n of variables to less than 20. We measured the quality of the learned structures using structural Hamming distance (SHD) Tsamardinos et al. (2006).\nFigure 2 shows SHDs for all the scoring criteria for each network. Sample sizes range from 10 to 10000 and the shown results are averages computed from 1000 repetitions. None of the scores dominates in all settings considered. BIC fares well when the sample size is small as it tends to produce a nearly empty graph which is a good answer in terms of SHD when the generating networks are relatively sparse. qNML obtains strong results in the Earthquake and Asia networks, being the best or the second best with all the sample sizes considered."}, {"title": "Prediction and Parsimony", "content": "To empirically compare the model selection criteria, we took 20 UCI data sets Lichman (2013) and ran train and test experiments for all of them. To better compare the performance over different sample sizes, we picked different fractions (10%, 20%,..., 90%) of the data sets as training data and the rest as the test data. This was done for 1000 different permutations of each data set. The training was conducted using the dynamic programming based exact structure learning algorithm.\nWhen predicting P(dtest|Dtrain, S, 0) with structures S learned by the BDeu score, we used the Bayesian predictive parameter values (BPP) \u03b8ijk & Nijk +1. In the spirit of keeping the scores hyperparameter-free, for structures learned by the other model selection criteria, we used the sequential predictive NML (sNML) parametrization Dijk Xe(Nijk)(Nijk + 1), where e(n) = (n+1)\" as suggested in Rissanen and Roos (2007).\nFor each train/test sample, we ranked the predictive performance of the models learned by the four different scores (rank 1 being the best and 4 the worst). Ta-ble 2 features the average rank for different data sets, the average being taken over 1000 different train/test samples for each 9 sample sizes. BIC's bias for simplicity makes it often win (written bold in the table) with small sample sizes, but it performs worst (underlined) for the larger sample sizes (for the same reason), while fNML seems to be good for large sample sizes. The striking feature about the qNML is its robustness. It is usually between BIC and fNML for all the sample sizes making it a \"safe choice\". This can be quantified if we further average the columns of Table 2, yielding the average ranks of 2.95, 2.57, 2.10, and 2.37, with standard deviations 0.49,0.90,0.76, and 0.43. While fNML achieves on average the best rank, the runner-up qNML has the lowest standard deviation.\nFigure 1 shows how fNML still sometimes behaves strangely in terms of model complexity as measured by the number of parameters in the model. qNML, instead, appears to yield more parsimonious models. To study the concern of fNML producing too complex models for small sample sizes, we studied the number of parameters in models produced by different scores when using 10% of each data set for structure learning.\nLooking at the number of parameters for the same 20 data sets again features BIC's preference for simple models (Table 3). qNML usually (19/20) yields more parsimonious models than fNML that selects the most complex model for 7 out of 20 data sets.\""}, {"title": "CONCLUSION", "content": "We have presented qNML, a new model selection criterion for learning structures of Bayesian networks. While being competitive in predictive terms, it often yields significantly simpler models than other common model selection criteria other than BIC that has a very strong bias for simplicity. The computational cost of qNML equals the cost of the current state-of-the-art criteria. The criterion also gives equal scores for models that encode the same independence hypotheses about the joint probability distribution. qNML also coincides with the NML criterion for many models. In our experiments, the qNML criterion appears as a safe choice for a model selection criterion that balances parsimony, predictive capability and the ability to quickly converge to the generating model."}]}