{"title": "SCALABLE WHOLE SLIDE IMAGE REPRESENTATION USING K-MEANS CLUSTERING AND FISHER VECTOR AGGREGATION", "authors": ["Ravi Kant Gupta", "Shounak Das", "Ardhendu Sekhar", "Amit Sethi"], "abstract": "Whole slide images (WSIs) are high-resolution, gigapixel-sized images that pose significant computational challenges for traditional machine learning models due to their size and heterogeneity. In this paper, we present a scalable and efficient methodology for WSI classification by leveraging patch-based feature extraction, clustering, and Fisher vector encoding. Initially, WSIs are divided into fixed-size patches, and deep feature embeddings are extracted from each patch using a pre-trained convolutional neural network (CNN). These patch-level embeddings are subsequently clustered using K-means clustering, where each cluster aggregates semantically similar regions of the WSI. To effectively summarize each cluster, Fisher vector representations are computed by modeling the distribution of patch embeddings in each cluster as a parametric Gaussian mixture model (GMM). The Fisher vectors from each cluster are concatenated into a high-dimensional feature vector, creating a compact and informative representation of the entire WSI. This feature vector is then used by a classifier to predict the WSI's diagnostic label. Our method captures local and global tissue structures and yields robust performance for large-scale WSI classification, demonstrating superior accuracy and scalability compared to other approaches.\nKeywords Clustering, Fisher Vector, Whole Slide Imaging", "sections": [{"title": "1 Introduction", "content": "Whole slide images (WSIs) are used in digital pathology for diagnosis and research, offering detailed histological views of entire tissue sections. Despite their value, their large size and complexity pose significant challenges for machine learning and deep learning, particularly in terms of computational and memory requirements. Efficient methods to process and classify WSIs are critical for advancing automated pathology. A common approach to handling WSIs is to divide them into smaller patches for independent processing, reducing computational load. However, this can overlook broader structural information. Recent research addresses this by extracting and aggregating patch-level features to capture a more comprehensive representation of the entire WSI.\nIn this study, we present a framework for WSI classification that combines patch-based feature extraction, clustering, and Fisher vector encoding to create a compact yet detailed representation of the entire WSI. The WSI is divided into fixed-size patches, and feature embeddings are extracted using pre-trained CNNs [1] and transformers [2]. K-means clustering [3] is used to group similar patches, and Fisher vectors [4] are computed for each cluster using a GMM [5], which are then concatenated into a high-dimensional feature vector capturing local and global information.\nThis vector is fed into a classifier to predict the WSI's diagnostic label, effectively combining patch-level features with global context for large-scale WSI classification. We validated our method on multiple datasets: Warwick [6] for HER2 scoring and HER2+ vs HER2- classification, TCGA-BRCA [7] for HER2 classification, TCGA-LUAD for mutation prediction (EGFR vs Non-EGFR) [8], and CAMELYON17 dataset [9] for metastasis detection. Across all datasets, the proposed approach consistently outperformed traditional patch-based methods while maintaining computational efficiency across diverse classification tasks and medical imaging modalities."}, {"title": "2 Methodology", "content": "In this study, we propose a method for classifying whole slide images (WSIs) by extracting features from patches, clustering these features, and encoding them using Fisher vectors. The following steps outline the entire process:\nWe begin by preprocessing WSIs using [10] model to remove artifacts and non-tissue regions, ensuring that only tissue areas are retained for further analysis. After getting quality tissue regions, we extract 512x512 pixel patches.\nFor each extracted patch, we compute feature embeddings using pre-trained networks. We experimented with a variety of deep learning models, including convolutional neural networks (CNNs) and transformer-based architectures.\nWhile patch-level feature extractors capture local features, our key ideas for complementing those with global features are the following. After obtaining patch-level feature embeddings, firstly, we apply K-means clustering to group patches based on feature similarity, thus reducing dataset complexity. The optimal number of clusters is determined using the elbow method, balancing the trade-off between cluster count and data compactness. Each cluster represents meaningful tissue patterns. Secondly, we then compute Fisher vector encoding to model the distribution of feature embeddings within each cluster. Fisher vectors provide a robust representation of the distribution by modeling the feature space with a Gaussian mixture model (GMM). The Fisher vector for a set of descriptors {f(x1), ..., f (xn)} is formulated as:\n$\\frac{1}{N}\\sum_{i=1}^{N} FV (f(x_i); \\lambda_1,..., \\lambda_m)$ where the Fisher Vector (FV) function is defined as:\n$FV(.) = [\\frac{s_{i1}}{c_1}(f(x_i) - \\nu_1)^2,..., \\frac{s_{im}}{c_m}(f(x_i) - \\nu_m)^2]$\nIn this equation, $c_j$ and $\\hat{c_j}$ are constants used to scale the feature distributions. During GMM fitting, we set the number of coding centers to 5, ensuring a balance between model complexity and performance. The Fisher vector captures both the mean and variance of the components of feature distributions in each cluster, providing a compact and informative representation for the clustered patch embeddings.\nFinally, the Fisher vectors from all clusters are concatenated to form a single high-dimensional vector. This concatenated vector effectively encapsulates both local and global information from the whole-slide image (WSI) by aggregating features across all patches and clusters. The resulting vector is then input into a permutation-invariant classifier for final classification."}, {"title": "3 Datasets, Experiments, and Results", "content": "We experimented with various datasets, backbones, and comparative methods, as described below.\nWe worked with four datasets, focusing on classification and prediction tasks using H&E-stained whole-slide images (WSIs):\n\u2022 TCGA-BRCA: We utilized data from the TCGA-BRCA cohort, which consists of 92 slides. Out of 92 slides, 36 are HER2-, and 56 are HER2+.\n\u2022 Warwick HER2: This dataset provided 52 WSIs for training and 34 for testing for the Warwick University HER2 challenge, with tasks including binary classification of HER2+ vs. HER2- cases and HER2 score prediction.\n\u2022 TCGA-LUAD: The dataset consisted of 159 slides, including 79 with EGFR mutations and 80 without. For this task, we performed binary classification between EGFR mutations vs. Non-EGFR mutations.\n\u2022 CAMELYON17: Comprising 500 WSIs from multiple centers, the dataset includes four classes: Negative, Isolated Tumor Cells (ITC), Macro-metastases, and Micro-metastases. We applied a binary classification task to distinguish between Metastasis Positive (including ITC, Macro, and Micro) and Negative classes.\nWe employed various pre-trained encoders, including SimCLR [20], ResNet50 [14], EfficientNet [15], RegNet [17], ConvNeXT Tiny [13], and Swin Tiny [11] \u2013 all trained on ImageNet [21] \u2013 to extract features from image patches. These features were clustered using K-Means with the elbow method to determine the optimal cluster count, reducing feature space dimensionality. Ablation and validation studies were performed to compare various feature encoders, and the best-performing encoder was selected for each task, enhancing classification accuracy and robustness. For our experiments, we set k = 10 clusters across all datasets. Fisher vector encoding was applied with five m = 5 centers (performed ablation study with m=10,15 and 3 but found best at m=5), with encoding parameters $\\pi_m = 0.2$ and $\\sigma_m = 0.1$ as in [5]. These hyperparameters are decided based on performance for test dataset.\nTo augment the clustered features, we applied feature scaling (range: 0.9 \u2013 1), jittering (jitter level: 0.01), and mixup (\u03b1 = 0.2). These enhanced features were processed through an Attention Multi-Instance Learning (AMIL) block and optimized using AdamW with a learning rate of 0.001 and weight decay of 0.0001.\nFor the Warwick dataset, our model outperformed baselines in HER2 scoring into three classes (negative, equivocal, positive) and binary HER2+ vs HER2- classification (Tables 1 and 2). Similarly, in the TCGA-BRCA dataset, our approach achieved superior performance for HER2 status classification (Table 3), demonstrating its robustness. To test the robustness of our approach further, we extended the experiments to the TCGA-LUAD dataset for EGFR mutation prediction and the CAMELYON17 dataset for metastasis detection, with solid results in both tasks for the proposed model (Table 4). Overall, our patch-based feature extraction, K-means clustering, and Fisher vector encoding approach outperformed baselines in HER2 classification tasks and adapted well to mutation and metastasis prediction, showcasing its broad applicability in digital pathology."}, {"title": "4 Conclusion and Discussion", "content": "In this work, we propose an efficient approach for whole slide image (WSI) classification by combining patch-based feature extraction, K-means clustering, and Fisher vector encoding. Our method captures both local and global tissue features, providing a compact representation of the entire WSI. By transforming patch clusters into Fisher vector representations, we reduce the dimensionality while preserving important tissue heterogeneity, making it well-suited for large-scale WSI classification. Our approach showed excellent performance across various datasets, including HER2 scoring (Warwick, TCGA-BRCA), mutation prediction (TCGA-LUAD), and metastasis detection (CAMELYON17). The consistency of results across different tasks highlights the generalizability of the method. While it holds promise for clinical deployment, future work should assess real-time performance and explore interpretability to build trust in clinical applications."}]}