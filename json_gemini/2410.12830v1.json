{"title": "Incorporating Metabolic Information into LLMs for Anomaly Detection in Clinical Time-Series", "authors": ["Maxx Richard Rahman", "Ruoxuan Liu", "Wolfgang Maass"], "abstract": "Anomaly detection in clinical time-series holds significant potential in identifying suspicious patterns in different biological parameters. In this paper, we propose a targeted method that incorporates the clinical domain knowledge into LLMs to improve their ability to detect anomalies. We introduce the Metabolism Pathway-driven Prompting (MPP) method, which integrates the information about metabolic pathways to better capture the structural and temporal changes in biological samples. We applied our method for doping detection in sports, focusing on steroid metabolism, and evaluated using real-world data from athletes. The results show that our method improves anomaly detection performance by leveraging metabolic context, providing a more nuanced and accurate prediction of suspicious samples in athletes' profiles.", "sections": [{"title": "1 Introduction", "content": "Clinical time series, also known as longitudinal profiles of individuals, represent repeated measurements of biological samples such as blood, urine, or other biological specimens collected over time [1,2]. These profiles are important in capturing the dynamic nature of biological processes, as they provide a time-evolving perspective of various physiological processes. The biomarkers measured within these samples often reflect underlying metabolic pathways [3].\nIn clinical settings, anomaly detection in these longitudinal profiles is an important task [4]. Identifying abnormal behaviour in such data can reveal critical insights, ranging from disease diagnosis to sample tampering as potential doping activity in sports [5,6]. It mainly helps biochemists or clinicians to monitor biological and physiological changes over time and detect suspicious behaviour. Therefore, anomaly detection plays a significant role in both sports integrity and healthcare. Several studies have highlighted the potential and limitations of Large Language Models (LLMs) in clinical domain-specific tasks [7,8,9]. Despite their success in text generation, completion tasks, etc., their ability to process and analyse clinical time-series data, particularly in the context of metabolic pathways and biological changes, remains under explored [10,11]. Understanding how these models can leverage metabolic information to make informed decisions is critical for improving their performance in anomaly detection tasks."}, {"title": "2 Proposed Method", "content": "2.1 Problem Formulation\nLet the multivariate clinical time-series data be represented as longitudinal profile of athletes X = {X1,X2,...,Xn}, where xt \u2208 Rm represents the measurements at time t, containing m biological parameters (e.g., metabolite concentrations) and xt,i represents the measurement of metabolite i at time t. We define the temporal difference as \u2206xi = Xt,i - X(t\u22121),i representing the change in metabolite i over time. The anomaly detection task is to learn a function f(xt) that gives an anomaly score to each sample xt in the longitudinal profile X. The function flags the anomalous sample if the magnitude of the sum of \u2206x exceeds a predefined threshold 8, indicating significant deviation from the expected rate of change:\nf(xt) =\n{1, if \\sum_{i=1}^{m} \\Delta x_{t,i} > \\delta, 0, otherwise.\n(1)\nWhile temporal changes in clinical data are important, the metabolic structural dependencies between metabolites Axi = Xt,i \u00b7 Xt,(i+1) needs to be considered.\n2.2 Metabolism Pathway-driven Prompting (MPP)\nWe propose a targeted prompting method that integrates metabolic pathway structures and their temporal evolution as shown in Fig.2. First, we ask LLM (Pre-Prompt I) to analyse the longitudinal profile and detect anomalies using zero-shot learning. Here, the LLM usually considers the temporal changes between consecutive samples. If these changes exceed the statistically significant threshold, it flags the corresponding sample as anomalous with an explanation. In a different session, we input LLM (Pre-Prompt II) with metabolic and temporal graph representation of the given longitudinal profile and task to extract the domain-specific contextual information from these graph structures. The LLM generates a detailed textual explanation by assessing whether the temporal changes are consistent with the expected metabolic behaviour based on known pathways. Now, we give this textual representation of domain knowledge to the previous LLM and task to rethink now (Prompt) by incorporating this domain information. The LLM refines the initial prediction by combining the detailed domain-specific information and provide more accurate, and contextually aware prediction.\nMetabolic Graph The graph G\u043c = (\u0474\u043c,\u0415M) represents the directional flow of m different metabolites (in this case steroids) in the pathway. We define nodes VM = {S1, S2, ..., Sm}, where each node Si represents a steroid. The edges EM represent the interactions or metabolic conversions between these steroids. The weight of an edge w\u043c (Si \u2192 Sj) represents the conversion rate from steroid Si to steroid Sj, where i, j = 1, 2, ..., m and i \u2260 j. If there is no conversion between two"}, {"title": "3 Experiments", "content": "Datasets We used two real-world datasets (Steroid-M and Steroid-F) consisting of longitudinal steroid profiles collected from male and female athletes respectively [13,14], each with a varying number of samples collected over time. The Steroid-M dataset contains 755 profiles with 4214 samples and Steroid-F dataset contains 375 profiles with 2307 samples. The data contains less than 20% anomalous longitudinal profile.\nModels and Metrics We conduct experiments using different open-source LLMs: (i) LLaMa 2-7B [15], (ii) Mistral-7B [16], (iii) Falcon-7B [17], and (iv) GPT2 [18]. These models are selected due to their efficiency in providing quicker results, which is particularly suitable for the size of the dataset. We compare the performance of our method with different prompting methods like Zero-Shot prompting (ZS) [19], In-Context Learning (ICL) [20] and Chain-of-Thought (CoT) [21]. We use classification metrics such as accuracy, sensitivity, specificity, and F1-score for the anomaly detection task. These metrics provide a balanced evaluation of the model's performance."}, {"title": "4 Results", "content": "Performance Comparison Tablel shows that by incorporating domain-specific knowledge of metabolic pathways, MPP improves the LLMs' understanding of clinical data, leading to better performance. For the LLaMA 2-7B model, MPP achieves an accuracy of 71.4% and an F1 score of 57.0%, outperforming ZS's 65.2% accuracy and 40.3% F1 score on Steroid-M. Notably, MPP improves both sensitivity and specificity, which is important in clinical settings to balance correctly identifying actual anomalies while minimising false positives. In contrast, ICL and CoT generally underperform due to their lack of domain-specific guidance, i.e., ICL with GPT2 on Steroid-M yields only 28.2% accuracy and a negligible 0.2% F1 score. This underperformance highlights the importance of incorporating domain knowledge, as MPP does, to improve model performance for specialised tasks like clinical anomaly detection."}, {"title": "5 Conclusion", "content": "Wee propose the Metabolism Pathway-driven Prompting (MPP) method in improving anomaly detection within longitudinal clinical data. By integrating the metabolic and temporal graphs for contextual understanding, MPP improves LLM's ability to detect anomalies, particularly in steroid metabolism, which is important for doping detection in sports. The results show improved accuracy and sensitivity compared to conventional prompting methods, demonstrating the significance of incorporating domain-specific knowledge for more precise and effective anomaly detection in clinical and sports integrity applications."}, {"title": "A Prompting Methods", "content": "A.1 Zero-Shot Learning\nIt involves making predictions or identifying anomalies without explicit task-specific training. For longitudinal clinical data, we task LLM to infer whether certain samples are anomalous based on its prior general knowledge about statistical significance and typical clinical trends. Let X = {X1,X2,...,Xn}, where xt \u2208 Rm represents the measurements at time t and let At represent an anomaly indicator, where:\nAt = {1, if an anomaly is detected at time t, 0, otherwise.\n(4)\nThe model attempts to predict At directly from the input data X without prior training on labeled clinical anomaly data. \nA.2 In-Context Learning\nIt involves providing the model with a few examples of what constitutes \"normal\" and \"anomalous\" patterns within the context of the prompt. The LLM uses these examples to generalise and apply its learned knowledge to unseen data points in the clinical data. Le us consider we are provided with k examples of clinical longitudinal profiles over time, which are labeled {(X1, A1), (X2, A2), ..., (Xk, Ak)}. These examples are included as part of the prompt.\nNow, we give the longitudinal profile X to LLM to infer the anomaly label At by leveraging the information gained from the previous examples.\nAt = f(X | {(X1, A1), (X2, A2), ..., (Xk, Ak)}),\n(5)\nwhere function f(.) generalises from the given examples. \nA.3 Chain-of-Thought (CoT)\nIt encourages the model to reason through a multi-step process, explicitly following a logical progression before reaching its conclusion. For anomaly detection in longitudinal clinical data, this means that LLM is prompted to analyse how clinical values evolve over time and their relationships with other biomarkers before flagging an anomaly. We gave the following instructions:"}, {"title": "B Metabolism Pathway-driven Prompting", "content": "Fig.7 shows a Pre-prompt I for LLM that we used for an example longitudinal profile. Fig.8 shows a pre-prompt II that we used in another session for the same longitudinal profile. Finally, Fig.9 shows a Prompt that integrates the response of the Pre-prompt II that we used for the same longitudinal profile."}, {"title": "\\u2022 Step 1: Analyse the range of each parameter", "content": "We task to examine the values of each steroid parameter across all the samples and calculate the mean (\u03bc) and standard deviation (\u03c3) for each parameter to quantify the \"normal\" range:\n\u03bc = \\frac{1}{n} \\sum_{i=1}^{n} Xi and \u03c3 = \\sqrt{\\frac{1}{n} \\sum_{i=1}^{n} (Xi \u2013 \u03bc)^2}\n(6)"}, {"title": "\\u2022 Step 2: Identify deviations across parameters", "content": "After understanding the range of each parameter, we focus on finding deviations across multiple parameters within a sample to check if a particular sample shows unusually high or low values for more than one parameter. In addition, ratios between key parameters such as the Testosterone-to-Epitestosterone (T/E) ratio-can be useful indicators of abnormalities. Similarly, other useful ratios include:\nRT/E = \\frac{T}{E}, RT/50 Adiol = \\frac{T}{5a Adiol}, RT/5\u03b2 Adiol = \\frac{T}{5\u03b2 Adiol}\n(7)\nSudden deviations in these ratios compared to the rest of the samples can signal an abnormal sample."}, {"title": "\\u2022 Step 3: Conclude the anomalous samples", "content": "Finally, based on the findings from previous steps, we identify and return the sample number(s) that show significant anomalies. The anomaly is flagged based on either exceeding the calculated range (\u03bc \u00b1 2\u03c3) or abnormal changes in the parameter ratios. If no significant anomalies are detected, the conclusion should state that the profile is clean."}]}