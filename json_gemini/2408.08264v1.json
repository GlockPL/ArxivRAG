{"title": "INVAERT NETWORKS FOR AMORTIZED INFERENCE AND IDENTIFIABILITY ANALYSIS OF LUMPED PARAMETER HEMODYNAMIC MODELS", "authors": ["Guoxiang Grayson Tong", "Carlos A. Sing Long", "Daniele E. Schiavazzi"], "abstract": "Estimation of cardiovascular model parameters from electronic health records (EHR) poses a significant challenge primarily due to lack of identifiability. Structural non-identifiability arises when a manifold in the space of parameters is mapped to a common output, while practical non-identifiability can result due to limited data, model misspecification, or noise corruption. To address the resulting ill-posed inverse problem, optimization-based or Bayesian inference approaches typically use regularization, thereby limiting the possibility of discovering multiple solutions. In this study, we use inVAErt networks, a neural network-based, data-driven framework for enhanced digital twin analysis of stiff dynamical systems. We demonstrate the flexibility and effectiveness of inVAErt networks in the context of physiological inversion of a six-compartment lumped parameter hemodynamic model from synthetic data to real data with missing components.", "sections": [{"title": "Introduction", "content": "Lumped parameter (a.k.a. zero-dimensional or 0D) hemodynamic models provide computationally inexpensive representations of the human cardiovascular system and are widely used either as low-fidelity surrogates or to provide closed-form boundary conditions in 3D cardiovascular simulations [39, 4, 14, 43]. Such representations model the evolution of bulk hemodynamic quantities of interest (QoI), simulating the time evolution of organ-level pressure, volume and flow [39, 30], disregarding any spatial dependence. They can be represented as circuit models arranged by compartments, and formulated as systems of ODEs whose solution is computed using numerical solvers.\nDespite their simplicity, working with OD models can be challenging. First, these models are often described by stiff ODE systems [7, 25], requiring the careful selection of the numerical algorithm and time step size. Second, due to their reduced computational cost, these systems tend to be overparametrized, which typically induces structural non-identifiability [49, 34] in inverse problems aiming to assess cardiovascular function from the observed physiological response [37, 12, 31, 32, 25]. Additionally, practical non-identifiability may also manifest as a result of poor data quality, model misspecification and aleatoric uncertainty. Lack of identifiability can induce solution non-uniqueness, excessive uncertainty, and convergence failure in numerical algorithms [49, 35].\nParameter estimation, sensitivity, and identifiability analysis of lumped parameter hemodynamic models are extensively studied in the literature. An incomplete list of contributions include the analysis of structural identifiability in a six-compartment OD cardiovascular model in [31], which shows that global identifiability can be achieved by adjusting the clinical targets and modifying the state equations accordingly. The method of profile likelihood [34] is applied"}, {"title": "1.1 Background and notation", "content": "The input-to-output (forward) map for an hypothetical cardiovascular model is denoted as $f : V \\rightarrow y$, mapping a vector of parameters $v \\in V \\subset \\mathbb{R}^{\\text{dim}(v)}$ to a set of clinical targets $y \\in Y \\subset \\mathbb{R}^{\\text{dim}(y)}$, with $V$ and $Y$ representing the abstract input and output spaces, respectively. In this context, the operator $f$ involves both solving a system of ODEs and post-processing quantities of clinical interest from the time-dependent solution, e.g., extracting minimum, maximum (diastolic and systolic) or time-average values over the cardiac cycle, computing acceleration times, etc. The input $v$ provides a zero-dimensional, simplified characterization of the physiology through the hydrodynamic analogy [26], relating major viscous losses to Ohm resistance, vascular compliance to electric capacitance and blood flow inertia to inductance. Despite the simplicity of this approximation, varying $v$ can span a broad spectrum of physiological conditions from healthy to disease [1, 12]."}, {"title": "2 Methods", "content": "Determining lumped parameters point estimates from observations (clinical data) is possible by solving the inverse problem $v = h(y)$, but, in practice a number of challenges are associated with this task. First, the inverse or pseudo-inverse operator $h : Y\\rightarrow V$ is often ill-posed due to non-uniqueness in structurally non-identifiable models. Specifically, for a given output $y$, there may exist $M_y \\subset V$ such that $f(v) = y$ for all $v \\in M_y$. We call $M_y$ the non-identifiable manifold, embedded in $V$ and associated with the observation $y$, where the complexity in determining this manifold depends on the nonlinearity of the forward map $f$, the properties of its gradient, and the dimensionality mismatch between $v$ and $y$ [42]. The existence of $M_y$ is related to redundancy in the parameterization of the map $f$ (or, in other words, the map $f$ is not injective), as changes in one component of the input $v$ can be entirely compensated by adjusting the remaining components, while leaving the output $y$ unaffected [49, 34, 20].\nStructural non-identifiability typically occurs in partially observed systems (or observed under the so-called small data regime) where dim$(y) <$ dim$(v)$ [49], and therefore there is not enough information to uniquely determine the input parameters. By design, InVAErt networks [42] leverage input-dependent latent variables $w \\in W$ to compensate for this information gap (see Section 2.2), where, generally, a higher dimensional $W$ increases the ability to capture complicated manifolds $M_y$.\nSecond, ill-posedness of an inverse problem can also arise due to data scarcity, model misspecification or presence of noise. All these factors lead to the violation of Hadamard's conditions for well-posedness, that is, the existence of a unique solution that is stable [11, 17, 22]. In particular, real-life clinical data may not be adequately characterized by a simplified mathematical model or, formally, real measurements may be such that $y \\notin \\text{Range}(f)$. This may be due to random noise originating from the finite precision of sensors and acquisition devices used in the clinic, or even human errors in reporting the data, which can push data outside the range of $f$ significantly, increasing the complexity of inverse problems. Contrary to structural non-identifiability due to the inherent model parameterization, the above issues typically occur when dealing with real data, hence the name of practical non-identifiability [34].\nFinally, input training data is generated from an assumed prior $v \\sim p(v)$ which induces a distribution in the outputs $f(v) = y \\sim p(y)$. Sampling from and evaluating the output distribution $p(y)$ are of critical importance when modeling physics-based systems. Therefore inVAErt networks, beside learning the forward $v \\rightarrow y$ and inverse $y \\rightarrow v$ maps, are also equipped with a flow-based density estimator (See Section 3.3.3, Section 3.4)."}, {"title": "2.1 The CVSim-6 hemodynamic model", "content": "CVSim-6 is a six-compartment OD model, originally proposed for teaching cardiovascular physiology using computers [7]. Additional studies related to the use of CVSim-6 for educational tool development, numerical simulation and parameter estimation can be found in [13, 27, 36, 41]. It simulates the evolution of blood pressures, flows and volumes through the left and right ventricular chambers, systemic arteries, systemic veins, pulmonary arteries and pulmonary veins as shown in Figure 1. The subscripts $(\u00b7)_l, (\u00b7)_r, (\u00b7)_a, (\u00b7)_v, (\u00b7)_{pa}, (\u00b7)_{pv}$ refer to quantities specific to each compartment.\nThe input parameters $v \\in \\mathbb{R}^{23}$ are reported in Table 1, with reference values listed from [7]. Each of the six compartments is characterized by a capacitance (compliance) $C$, a resistance $R$ and an unstressed (zero-pressure filling) volume $V^0$, except for the two ventricles, where prescribed systolic and diastolic capacitances are responsible for ventricular contraction and relaxation. Models for the atrial chamber are not included in CVSim-6. Consistent with the compartmental nature of the model and its formulation in terms of a close-loop autonomous system of ODEs, we follow the convention where the outflow resistance of one compartment coincides with the inflow resistance of the subsequent compartment. Additional parameters include the heart rate $H_r$, transthoracic pressure $P_{th}$ (disregarding any circulatory-respiratory coupling), and the systolic fraction $r_{sys}$ of a heart cycle.\nThe CVSim-6 system is governed by the six ODEs in (1), one per compartment, with six pressures as state variables, i.e., $[P_l, P_a, P_v, P_r, P_{pa}, P_{pv}]^T$ whose evolution is governed by a combination of Kirchhoff's law, two-element Windkessel models, and four ideal (no regurgitation) unidirectional heart valves, as detailed in [7]. Generalized Ohm"}, {"title": "2.2 InVAErt networks", "content": "InVAErt networks [42] provide a comprehensive, data-driven methodology for physics-based digital twins (see diagram in Figure 2). They consist of (1) an emulator $NN_e : V \\rightarrow Y$ as a surrogate for the input-to-output map $f$, (2) a L-layer flow-based density estimator $NN_f : Z \\rightarrow Y$ for the output distribution $p(y)$, (3) a variational encoder $NN_{\\nu} : V \\rightarrow W$ generating an input-dependent latent space responsible for the lack of bijectivity between inputs and outputs. Finally, (4) a decoder $NN_d : Y \\times W \\rightarrow V$ approximates the inverse map from combined outputs and latent variables to model inputs. Given a dataset $D = \\{(v_j, y_j)\\}_{j=1}^N$, optimal weights and biases for each inVAErt network"}, {"title": "2.2.1 Noise injection as training data augmentation", "content": "To tackle challenging inference tasks involving practical non-identifiability, we add artificial Gaussian noise to the labels $y$ during the training for $NN_f, NN_{\\nu}$ and $NN_d$, as a regularization strategy. Incorporating training noise as a form of data augmentation has been shown to improve model generalization and reduce overfitting [46, 3]. This is helpful in inference tasks when dealing with out-of-distribution data, measurement noise, and model misspecification (see Section 3.4).\nNote that the forward map $f$ is assumed to be deterministic in this study, hence no noise injection is performed when training the neural emulator $NN_e$. However, when training all other inVAErt network components, we consider the output labels corrupted by zero-mean, uncorrelated and heteroskedastic Gaussian noise, i.e.,\n$y' = y + \\eta, \\; \\eta \\sim \\mathcal{N}(0, \\text{diag}(s^2)), \\; s^2 = [s_1, \\dots, s_{\\text{dim}(y)}]^T,$\\nwith known standard deviations for each output component. The random noise is independent to both the input and output data, with a new realization generated at each epoch. In summary, $y'$ replaces $y$ in all terms in (3), except for the MSE emulator loss."}, {"title": "3 Numerical experiments", "content": "In this section, we provide a number of new results for inVAErt networks in the context of computational physiology. We first characterize the stiffness of the differential system used throughout this section, showing that lumped parameters models give rise to stiff system of ODEs. We also highlight the most important mechanisms that are responsible for this stiffness. We then use synthetically generated data from a baseline set of parameters (the so-called default parameter set) to show the ability of inVAErt networks to identify entire manifolds of non-identifiable parameters and provide ways to graphically characterize such manifolds. Finally, we show how to select the parameter prior, the amount of noise, and how to deal with missing data, demonstrating the use of inVAErt networks for parametric inversion in the presence of practical non-identifiability."}, {"title": "3.1 Stiffness analysis", "content": "Like other pulsatile cardiovascular models driven by periodic forcing [25], the CVSim-6 system exhibits stiffness and may suffer from numerical instability without a careful selection of the integration time step. To formally study this phenomenon, we first write equations (1) in matrix form\n$P(t) = A(t) P(t) + b(t),$\\nwhere $P(t) = [P_l(t), P_a(t), P_v(t), P_r(t), P_{pa}(t), P_{pv}(t)]^T$ represents the state vector, $A(t)$ denotes the time-dependent coefficient matrix and $b(t)$ is a time-varying forcing vector which quantifies the contribution of the intrathoracic pressure [7].\nRather than following a rigorous definition, stiffness in ODE systems is often identified by its effects on numerical solutions [38, 2, 21]. One way to analyze stiffness is through the eigen-decomposition of the RHS Jacobian of (6), i.e. $A(t) = Q_t \\Lambda_t Q_t^{-1}$. Here, $\\Lambda_t \\in \\mathbb{C}^{6 \\times 6}$ is a diagonal matrix with entries equal to the eigenvalues $\\lambda_1(t), ..., \\lambda_6(t)$, with $|\\text{Re}(\\lambda_1(t))| > \\dots > |\\text{Re}(\\lambda_6(t))|$, and $Q_t \\in \\mathbb{C}^{6 \\times 6}$ is the matrix of eigenvectors, i.e., $Q_t = [Q_1(t), \\dots, Q_6(t)]$. As $A(t)$ depends on the state vector $P(t)$ via indicator functions (see (2)), $A(t)$ is approximated using a 5-th order implicit Runge-Kutta method (Radau) with adaptive step [47] as discussed in [7]. The simulation runs for 12 cardiac cycles, i.e., $12 \\cdot T_{tot} = 12 \\cdot 60/H_r$, utilizing the default set of input parameters listed in Table 1.\nAll six eigenvalues of $A(t)$ are real, with time histories over the last two heart cycles shown in Figure 3. The first two modes are associated with the largest magnitudes occurring at the same time during each heart cycle.\nAt any time $t$, the stiffness ratio SR$(t)$ is defined as\n$\\text{SR}(t) = \\frac{\\text{max} |\\text{Re}(\\Lambda_t)|}{\\text{min} |\\text{Re}(\\Lambda_t)|}$,$\\nand can inform on the degree of stiffness of a given system. Specifically, a large SR implies significant difference in the rate of change between solution components, so that a smaller time step is required to capture both fast- and slow-varying dynamics [44, 38, 2, 21]. In addition, it is possible for min $|\\text{Re}(\\Lambda_t)|$ to be zero for some $t$ (see Figure 3), indicating a solution component remaining constant (e.g., due to a time-varying capacitance driving the autonomous system response). In such a case, the denominator in equation (7) is replaced by the non-zero eigenvalue with the smallest magnitude, plus a tolerance tol (tol $= 1 \\cdot 10^{-14}$ is used here, see Remark 1).\nThe maximum stiffness is observed when the magnitudes of $\\lambda_1$ and $\\lambda_2$ are maximized (see Figure 3 and Figure 4), with intrinsic timescale constants equal to [44]\n$\\tau_1 = 1/|\\lambda_1| = 0.0019 \\;(s), \\quad \\tau_2 = 1/|\\lambda_2| = 0.0028 \\;(s).$"}, {"title": "3.2 Output selection", "content": "The selection of output attributes $y \\in \\mathbb{R}^{16}$ for the CVSim-6 system (see Table 2) is based on the EHR dataset [12] to be studied in Section 3.4. This dataset includes patient-specific measurements of heart rate, systolic and diastolic blood pressures, mean venous pressure, left ventricular volumes, cardiac output, and vascular resistance. Corresponding model outputs are computed from the CVSim-6 solutions over the final three of 12 simulated heart cycles (we refer to these three cycles as $T_p$ with size $n_p$) due to a fully converged periodic response.\nNote that the pulmonary wedge pressure $P_w$ and central venous pressure $P_{cvp}$ are indirect measures for the left and right atrial pressures [18], respectively, despite the absence of atrial compartments in CVSim-6. Furthermore, the stroke volume (SV) is calculated as the difference between diastolic and systolic volumes in the left ventricle, i.e., $SV = V_{l,dia} - V_{l,sys}$ and from which, the cardiac output can be alternatively estimated as CO = SV \u00d7 Hr (see, e.g., [18]). Finally, to account for measurement noise, we use standard deviations for each output component as reported in Table 2, based on values suggested in the literature [12, 10, 24, 50]."}, {"title": "3.3 Structural non-identifiability analysis with synthetic data", "content": "We first investigate structural non-identifiability in CVSim-6 using noiseless synthetic data. A set of N=54,000 input-output pairs is generated by numerically solving the CVSim-6 system, and then subdivided in 37,500 training data, 12,500 online testing data, and 4,000 offline validation data. Input parameters are randomly selected from a uniform prior, centered around the default parameter combination (see Table 1). Specifically, the compliance parameters are allowed to vary by up to \u00b150%, and other input parameters can fluctuate up to \u00b130%, relative to their default value. For brevity, we summarize results of the forward emulation and output density estimation in Appendix C.1 and focus on the inverse problem in this section. The choice of hyperparameters and other training details can be found in Appendix B.1.\nWe first validate the ability of an inVAErt network to solve amortized inverse problems by checking if a given output y can be reconstructed via the decoded parameters v. To do so, we extract all 4,000 labels from the validation dataset and sample an equal number of latent variables from the standard normal, i.e., $w \\sim \\mathcal{N}(0,I)$. Then, concatenated outputs and latent space samples $[y, w]^T$ are fed to the trained decoder $NN_d$, resulting in 4,000 inverse predictions v. Finally, we evaluate this parameters through the exact CVSim-6 simulator, i.e., $\\hat{y} = f(\\hat{v})$, and record the absolute reconstruction difference $|y-\\hat{y}|$ of each output component in Table 3. Errors are very limited on average. In particular, we observe a maximum absolute error in the systolic arterial pressure equal to 3.4 mmHg, due to either an output $y$ or a latent variable w belonging to the tail of the respective distribution."}, {"title": "3.3.1 Going beyond point estimates", "content": "In the previous section, each output y was associated with a single latent variable realization w, thereby generating a single inverse problem solution. However, structurally non-identifiable systems are characterized by the possibility that infinitely many inputs $v \\in M_y \\subset V$ may map to a common output y, i.e., $f(v) = y$ for any $v \\in M_y$. For an inVAErt network, discovering multiple solutions from the non-identifiable manifold $M_y$ is as easy as drawing more latent samples from W, and perform one decoder evaluation for each of these samples. To test this, we first select a representative output from the trained density estimator $NN_f$, denoted as $y^*$, with its components listed in Table 4.\nFor this output, we draw 100 samples w from the latent space and process each $[y^*, w]^T$ through $NN_d$, generating 100 predictions of v. To confirm these predictions are indeed associated with the non-identifiable manifold $M_{y^*}$, we use them to reconstruct $y^*$ via the exact numerical simulator $f$, achieving a maximum relative error of approximately 0.139%. When compared to the components in $y^*$ as presented in Figure 8, the pressure/volume trajectories computed through v, are able to accurately reproduce both systolic and diastolic targets."}, {"title": "3.3.2 Analysis of non-identifiable manifolds", "content": "A parallel coordinate plot of the manifold $M_{y^*}$ is presented in Figure 9. First, a significant variability can be observed in some of the input components, confirming that the CVSim-6 system is structurally non-identifiable. From the picture, parameters such as $C_r, C_{r,sys}, C_{pv}, R_{l,in}, R_{l,out}$ and most of the unstressed volumes appear to be mostly responsible for the lack of identifiability, as their predicted values cover almost entirely their prior ranges. However, input parameters such as $R_a, R_{pv}$ show very limited variations. This suggests the non-identifiable manifold $M_{y^*}$ embedded in the 23-dimensional input space V may be characterized by a smaller intrinsic dimension, and, in turn, that some of the parameters are actually identifiable."}, {"title": "3.3.3 Missing data analysis", "content": "Consider now the situation where the components $\\{P_{a,dia}, P_{r,dia}, P_{pa,dia}, P_w, V_{l,sys}, \\text{SVR}, \\text{PVR}\\}$ of $y^*$ are missing, e.g., unobserved. We wonder whether one can infer these missing elements through the pre-trained density estimator $NN_f$, and then solve the inverse problem using the decoder network $NN_d$. We answer this question using Algorithm 1. The ranking mechanism in Algorithm 1 promotes certain combinations of components that are most frequently observed in the solution of the CVSim-6 system, providing an approach for physics-based multiple imputation (see, e.g., [40]).\nTo show the accuracy of this approach, we remove the previously mentioned components (assumed missing) from $y^*$, and extract the top four most probable outputs using Algorithm 1. Next, for each output, we solve the inverse problem by sampling 5 latent variables w from the standard normal, resulting in 4 groups of inverse predictions of v. We then evaluate these parameters with the exact CVSim-6 simulator $f$, and plot the resulting pressure/volume curves in Figure 11, using a different color for each group."}, {"title": "3.4 Inverse problem with real clinical measurements", "content": "We now consider data from a real EHR dataset provided through a Google's ATAP research project [12, 41], containing clinical measurements from 84 fully anonymized adult patients. Each patient has up to 26 features but none of the patients has data for all the features. While the missing components vary among the cohort, attributes like heart rate,"}, {"title": "3.4.1 Inversion results", "content": "In this section, we quantify how much noise should be added to the CVSim-6 outputs so an inVAErt network could achieve sufficient generalization on real data in general, and our EHR dataset in particular. To do so, we introduce a scale factor \u03b4 which amplifies the values of standard deviation in Table 2. This parameter quantifies the amount of noise added during training where, for example, \u03b4 = 0.0 corresponds to no noise added, and \u03b4 = 2.0 is used to denote a zero-mean Gaussian noise with standard deviation twice as the value reported in Table 2.\nAdditionally, an error criterion to quantify the accuracy of the inversion task on a per output component basis is defined in equation (9) below\n$e_k = \\frac{1}{|P_k| N_w} \\sum_{q \\in P_k} \\sum_{i=1}^{N_w} |\\frac{\\hat{Y}_{i,k}^{\\text{EHR}, (q)} - Y_k^{\\text{EHR},(q)}}{Y_k^{\\text{EHR}, (q)}}|, \\quad k=1:16,$\\nwhere $P_k$ contains the IDs of the patients whose k-th attribute is not missing, and $|P_k|$ is the cardinality of this set, reported under the \"Counts\" column in Table 5. Inversion is performed with four noise levels (d = 0.25, 0.5, 1.0, 2.0),"}, {"title": "4 Discussion and conclusions", "content": "In this paper, we propose a new approach for model synthesis in stiff dynamical systems, and demonstrate its potential using both synthetic and real data with missing components from an EHR dataset. Once an inVAErt network is trained, it can be used as an enhanced digital twin that can instantaneously (i.e., at the cost of a single network evaluation) perform a number of tasks including emulation, amortized inversion, output generation and missing data imputation. In addition, a unique feature of inVAErt networks is their ability to solve ill-posed inverse problems with multiple solutions, by computing an entire manifold of parameters whose model outputs correspond to the same clinical observation. We believe that a paradigm where all the solutions of an inverse problem are provided to the analyst (with an accuracy that only depends on the amount of training data provided to the system) is superior to any form of regularization.\nMoreover, besides using a latent space to handle structural non-identifiability, for the first time, noise from a closed-form model is added during training of an inVAErt network to alleviate practical non-identifiability in the solution of inverse problems. We focus on an application in computational physiology, using the CVSim-6 six-compartment lumped parameter model. We analyze this system in detail, showing that its stiffness is due to the presence of ideal uni-"}, {"title": "A Additional details on the CVSim-6 model formulation", "content": "The following physiological quantities can be computed from the input parameters listed in Table 1:\nTotal unstressed blood volume:\nDuration of cardiac cycle:\nSystolic time per cardiac cycle:\nDiastolic time per cardiac cycle:\n$V_{tot}^{0} = V_l^0 + V_a^0 + V_v^0 + V_r^0 + V_{pa}^0 + V_{pv}^0 \\; (\\text{mL}),$\n$T_{tot} = 60/H_r \\; (\\text{s}),$\n$T_{sys} = T_{tot} r_{sys} \\; (\\text{s}),$\n$T_{dia} = T_{tot} - T_{sys} \\; (\\text{s}),$\nand we assume a constant total blood volume $V_{tot} = 5000 \\; (\\text{mL})$, representative of an adult male weighing 70 kg [7]. To begin the in-silico simulation of the CVSim-6 system and preserve mass conservation at t = 0, the initial pressures in the ODE system (1) are determined by solving the following set of equations [7]"}]}