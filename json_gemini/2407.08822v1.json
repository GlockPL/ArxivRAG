{"title": "FedMedICL: Towards Holistic Evaluation of Distribution Shifts in Federated Medical Imaging", "authors": ["Kumail Alhamoud", "Yasir Ghunaim", "Motasem Alfarra", "Thomas Hartvigsen", "Philip Torr", "Bernard Ghanem", "Adel Bibi", "Marzyeh Ghassemi"], "abstract": "For medical imaging AI models to be clinically impactful, they must generalize. However, this goal is hindered by (i) diverse types of distribution shifts, such as temporal, demographic, and label shifts, and (ii) limited diversity in datasets that are siloed within single medical institutions. While these limitations have spurred interest in federated learning, current evaluation benchmarks fail to evaluate different shifts simultaneously. However, in real healthcare settings, multiple types of shifts co-exist, yet their impact on medical imaging performance remains unstudied. In response, we introduce FedMedICL, a unified framework and benchmark to holistically evaluate federated medical imaging challenges, simultaneously capturing label, demographic, and temporal distribution shifts. We comprehensively evaluate several popular methods on six diverse medical imaging datasets (totaling 550 GPU hours). Furthermore, we use FedMedICL to simulate COVID-19 propagation across hospitals and evaluate whether methods can adapt to pandemic changes in disease prevalence. We find that a simple batch balancing technique surpasses advanced methods in average performance across FedMedICL experiments. This finding questions the applicability of results from previous, narrow benchmarks in real-world medical settings. Code is available at: https://github.com/mlk2zoo/FedMedICL.", "sections": [{"title": "1 Introduction", "content": "Machine learning increasingly impacts medical imaging [15,30]. Yet, most FDA-approved models are validated on datasets unrepresentative of real demographic distributions, leading to potential inaccuracies in medical diagnostics [11]. This lack of diversity in data is problematic when models encounter distribution"}, {"title": "2 Related Work", "content": "Distribution Shifts in Medical Imaging. Research in long-tailed recongi-tion [1], fairness [24], and continual learning [6] targets label imbalance [18], demographic [31], and temporal shifts [9] respectively, yet typically operates in isolation. Recent works like SubpopBench [31] have made advances by formal-izing subpopulation shifts, yet they do not study them together, and do not model temporal shifts. Similarly, MEDFAIR [34] comprehensively evaluates de-mographic fairness but leaves label imbalance and temporal shifts unexplored. Furthermore, these studies typically overlook the siloed nature of medical data, a crucial aspect of real-world healthcare settings. In contrast, we offer a holis-tic approach to evaluate label, demographic, and temporal distribution shifts in medical imaging, while also considering the siloed nature of medical data."}, {"title": "3 FedMedICL: Problem and Benchmark", "content": "We study three types of distribution shifts associated with classification for real-world federated medical imaging. Individual hospitals possess small, isolated"}, {"title": "3.1 Background on Federated and Continual Learning", "content": "Assume we are given an input image $x \\in X$ and its ground truth diagnosis label $y \\in Y$ with $y = {1,2,..., L}$. We aim to build a classifier $f_\\theta : X \\rightarrow P(Y)$, parameterized by $\\theta$, that can correctly classify $x$, where $P(Y)$ is the probability simplex over the label space. Furthermore, medical data is often coupled with a set of attributes $a_1, a_2,... a_m \\in A$, e.g, the age or sex of patients.\nIn federated learning, client splitting divides a dataset $D$ into $K$ segments ${D^1,... D^K}$, each corresponding to a hospital. Each hospital may have a dif-ferent distribution of attributes. Let $D^k$ be the training distribution at hospital $k$. $D^k$ is characterized by the set of probabilities of observing the different at-tributes at that hospital, denoted by ${p_i^k}_{i=1}^m$ where $P_{(x,y)\\sim D^k}(a = a_i) = p_i^k$. That is, $p_i^k \\geq 0$ is the probability that the attribute $a_i$ is observed at hospital $k$.\nIn continual learning, temporal task splitting divides a hospital's dataset $D^k$ into $T$ sequential segments, ${D_1^k,...D_T^k}$, which are called temporal tasks."}, {"title": "3.2 Benchmark Construction Methodology", "content": "We propose a benchmark construction method that precisely mirrors the com-plex scenarios in real-world medical federated and continual learning tasks.\nClient Splitting. We introduce a scalable method to simulate the dis-tribution of medical data across $K$ clients, each representing a medical insti-tution, by dividing them into two types: Balanced and Skewed. A Balanced client $k$ maintains a homogeneous demographic distribution, defined as $\\forall i, j \\in {1, ..., m}, p_i^k \\approx p_j^k$. Conversely, a Skewed client $k$ is marked by an uneven distri-bution, with at least one attribute $a_i$ having a significantly higher than average probability, i.e, $p_i^k > 1/m$. We create a mix of Balanced and Skewed clients to reflect the diverse demographic imbalances both within and across different hospitals, mimicking the heterogeneity of real-world medical data.\nTemporal Task Splitting. We now address the temporal aspect of medi-cal data, necessitating continual learning [9]. We define the localized split, which models demographic-based temporal shifts. We also consider novel disease emer-gence, which is a label-based temporal shift.\n1- Localized Split. Hospital admission rates for different demographic groups vary seasonally, potentially due to local factors. To model these localized factors, we let $p_i^l \\neq p_i^k \\neq p_i^j$. That is, the distribution of attributes at each client evolve"}, {"title": "3.3 Evaluation and Datasets", "content": "Baselines. We implement baseline methods from various fields: data augmenta-tion (MixUp [33]), domain generalization (SWAD [4]), continual learning (ER [6]), group-imbalanced learning (GB for group-balancing), and class-imbalanced learn-ing (CB for class-balancing, CRT [16]). Each method tackles a single challenge and is unable to handle all scenarios that FedMedICL simulates. Therefore, we adapt these methods by augmenting them with federated averaging (Fe-dAvg) [19]. The modified version of each method is prefixed with \u201cF-\u201d (e.g F-CRT) throughout the paper. For comprehensive comparisons, we implement local training with Empirical Risk Minimzation (ERM), which does not use fed-erated learning, serving as a reference point for minimum expected performance. Following MEDFAIR [34], we used a ResNet-18 backbone for all the baselines.\nDatasets. We utilize five public medical imaging datasets: CheXpert [14], Fitzpatrick17k [12], HAM10000 [27], OL3I [32], and PAPILA [17]. We also con-struct a new dataset, CheXCOVID, combining images from CheXpert and the COVID-19 image data collection [8]. Our choice of datasets is based on their scale, coverage of a wide range of imaging tasks, and availability of demographic metadata.\nReported Metric. These datasets exhibit skewed class distributions, so a naive classifier that overpredicts the majority label achieves a high overall accu-racy. Thus, we follow the Long-Tailed Recognition (LTR) literature and measure the LTR Accuracy [1]: $LTR = \\sum_{j=1}^L \\frac{1}{N_j} \\sum_{i s.t. y_i=j} \\mathbb{1}{argmax_j f_\\theta (x_i) = j}$, where $N_j$ denotes the number of instances in the $j$th class. To quantify label imbalance, we report the Imbalance Factor (IF), $IF = \\frac{max N_i}{min N_i}$.\nEvaluation. As shown in Figure 1b, we evaluate adaptation to local shifts via temporally aligned test tasks, and generalization across diverse demographics via a hold-out set $D_h$ that preserves the original dataset's demographic distribution."}, {"title": "4 Benchmark Results", "content": "We evaluate the baselines using our localized split framework, detailed in Sec-tion 3. This framework models distributed hospitals experiencing independent"}, {"title": "5 Spread of the COVID-19 Pandemic Between Hospitals", "content": "FedMedICL can simulate novel disease outbreaks and evaluate algorithms under such conditions. We simulate COVID-19 spreading between hospitals using a"}, {"title": "6 Conclusions and Future Research", "content": "We envision FedMedICL as a first step towards holistic evaluation of federated medical imaging. It paves the way for research on distribution shifts in siloed medical datasets, showing that a simple batch-balancing technique outperforms existing methods. Our experiments focus on variations in age and skin type, motivated by evidence of significant performance disparities across these at-tributes [34]. Yet, we have designed FedMedICL with flexibility in mind, enabling easy integration of additional singular attributes (e.g., device manufacturer) and dual attributes (e.g., intersection of sex and age). FedMedICL can also easily ex-tend to any modality, such as text and tabular data. We encourage researchers to expand our benchmark to include more data attributes and modalities."}]}