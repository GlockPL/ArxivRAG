{"title": "Short-term Streamflow and Flood Forecasting based on Graph Convolutional Recurrent Neural Network and Residual Error Learning", "authors": ["Xiyu Pan", "Neda Mohammadi", "John E. Taylor"], "abstract": "Accurate short-term streamflow and flood forecasting are critical for mitigating river flood impacts, especially given the increasing climate variability. Machine learning-based streamflow forecasting relies on large streamflow datasets derived from rating curves. Uncertainties in rating curve modeling could introduce errors to the streamflow data and affect the forecasting accuracy. This study proposes a streamflow forecasting method that addresses these data errors, enhancing the accuracy of river flood forecasting and flood modeling, thereby reducing flood-related risk. A convolutional recurrent neural network is used to capture spatiotemporal patterns, coupled with residual error learning and forecasting. The neural network outperforms commonly used forecasting models over 1-6 hours of forecasting horizons, and the residual error learners can further correct the residual errors. This provides a more reliable tool for river flood forecasting and climate adaptation in this critical 1-6 hour time window for flood risk mitigation efforts.", "sections": [{"title": "1 Introduction", "content": "Global river floods and the associated risks are one of the major impacts of climate change (Winsemius et al. 2016). There has been extensive research revealing the exacerbation and changes in the flooding possibilities (Alifu et al. 2022), magnitude (Li et al. 2023), frequency (Tarasova et al. 2023), duration (Rohde 2023), and timing (Bl\u00f6schl et al. 2017), caused by climate changes in the form of heat, land cover, precipitation, etc., in the western U.S. (Touma et al. 2022), East Asia (Li et al. 2023), Europe (Bl\u00f6schl et al. 2017), Africa (Marshall 2023), and other parts of the world. The impact of climate change is projected to exacerbate human loss due to river floods by 70\u201383% and economic losses by 160\u2013240% with a temperature increase of 1.5 \u00b0C (Dottori et al. 2018), and the regional direct losses caused by these floods can propagate within the global trade and supply network with more profound impacts (Willner et al. 2018). In response to increased river flood risks, adaptation strategies such as reducing flood peaks using detention areas, strengthening protection through dyke systems, river flood modeling, and population relocation have been studied (Dottori et al. 2023). Accurate short-term (i.e., hourly and daily (Wang et al. 2023)) streamflow forecasting is the input for many flood mitigation operations (Najafi et al. 2024), informing the storage and release of water in detention areas, dyke systems reinforcement ahead of high flows, flood simulation and risk anticipation, etc.\nA significant trend in streamflow forecasting is the prevalence and rapid growth of machine learning, especially deep learning approaches (Cui et al. 2022; Fang et al. 2023; Nguyen et al. 2022), which have demonstrated great potential in implicitly capturing complex temporal and spatial patterns (Fang et al. 2023; Habert et al. 2016; Niu and Feng 2021). Most machine learning- based streamflow forecasting studies employed supervised learning models and conducted the training in an end-to-end manner. This paradigm relies on large amounts of streamflow data as the"}, {"title": "ground truth for computing loss function values. Because streamflow is difficult to measure directly, in most relevant studies, the large streamflow ground truth dataset (hereafter referred to as reported streamflow) was derived from water level gauge heights using rating curves, which are fitted using water levels and a small number of field-measured streamflow (hereafter referred to as measured streamflow) data points (Hodson et al. 2024; Westerberg et al. 2011).\nDespite their well-established modeling methods and widely supported effectiveness, rating curves are not immune to errors when estimating streamflow from measured water level data. As per the results of prior studies, the errors from rating curves are not negligible in many cases. In some studies, the error rates of rating curves were in the range of about 5% to 25% (Das Bhowmik et al. 2020), and some studies have reported error rates exceeding 50% (Bahreinimotlagh et al. 2019). Because machine learning-based short-term streamflow forecasting relies on large streamflow datasets as ground truth, errors introduced by rating curves in reported streamflow could affect the accuracy of streamflow forecasting. Therefore, even if a machine learning model for streamflow forecasting can make perfect forecasts of the reported streamflow, it still may fail to accurately inform corresponding flood management.\nErrors in the reported streamflow due to rating curves can be more evident in flood streamflow forecasting scenarios. On the one hand, among the major reasons why rating curves may deviate from real-world conditions, anthropogenic (e.g., sand extraction, dam construction) and natural (e.g., weed growth) change of river channels can be addressed by updating rating curves every several weeks (U.S. Geological Survey 2024), and streamflow field measurement errors are often modeled as white noise (Coxon et al. 2015). However, errors from unsteady flows (e.g., abrupt streamflow change) and imperfect rating curve fitting (e.g., function form selection, extrapolation) (Coxon et al. 2015; Kiang et al. 2018; Wolfs and Willems 2014) are still prone to", "content": ""}, {"title": "exist in rating curves. During flood rising, the water surface slope will be greater than the steady flow slope at the same water level, due to the abrupt and rapid increase in inflow. Thus, the streamflow would be greater than that indicated by the rating curve, and vice versa when a flood recession occurs (Wolfs and Willems 2014).\nAlthough some prior studies attempted to reduce the error resulted from imperfect forecasting by machine learning models (Li et al. 2017, 2021), only a few studies have focused on reducing the error between the reported and measured streamflow (Das Bhowmik et al. 2020; Habert et al. 2016; Zeroual et al. 2016). In the study closest to the present one, Das Bhowmik et al.(Das Bhowmik et al. 2020) aimed to propose a method for reducing the error induced by rating curves for streamflow forecasting, but the error was modeled using hypothesized distributions and studied in a simulation environment. In this study, we aim to propose a method to reduce the impact of reported streamflow errors on machine learning-based hourly streamflow and flood forecasting. It first forecasts the reported streamflow and then further learns and reduces the errors regarding measured streamflow. The proposed method has two parts, where the first part is a streamflow forecasting base model. The base model is built on a graph convolutional recurrent neural network, and it uses the water level at gauging stations and the rainfall in the watershed at past time points to forecast the reported streamflow. For the base model, the forecasting error is computed as the difference between the forecasts and the reported streamflow, while in the second part of the method, the error is computed regarding the measured streamflow and referred to as residual error. The river water level and the change in water level were used to learn and forecast the residual error, which was then utilized to modify the initial streamflow forecasts. The proposed method is expected to reduce the impact of reported streamflow data errors on short-term streamflow", "content": ""}, {"title": "forecasting, improve the accuracy of forecasting, especially during flood periods, and contribute to relevant flood management decisions (e.g., water releases) that rely on streamflow estimates.", "content": ""}, {"title": "2 Literature review", "content": ""}, {"title": "2.1 Short-term streamflow forecasting based on machine learning", "content": "The proposed research builds on previous studies of machine learning-based short-term streamflow forecasting. In related studies, short-term forecasting usually refers to hourly streamflow forecasting one to six hours in advance (Kao et al. 2020; Lin et al. 2021; Nguyen et al. 2022; Zhang et al. 2022). Some studies have tried to extend the forecast horizon. In the work by Cui et al., (2022), the forecasting is made every three hours, with a three to 12-hour forecast horizon. Olfatmiri et al. (2022) tested the hourly forecasting performances under the 1, 2, 6, 12, 18, 24, and 48 hours horizon, but the forecasting accuracy decreases quickly with increasing horizons. On the other hand, very few studies reduced the forecasting horizon to less than an hour (Kurian et al. 2020).\nThe relatively short horizon of streamflow forecasting influences the choice of machine learning model features. Unlike long-term streamflow forecasting, which often uses forecasted precipitation, soil moisture, and climatic factors, etc. as features, the most commonly used features for short-term streamflow forecasting are the flow information (e.g., streamflow, water level) and rainfall at past time points (Cui et al. 2022; Kao et al. 2020). To simplify the inputs to the machine learning model, rainfall is aggregated to the average of the data from multiple upstream rainfall measurement stations in most prior studies (Lin et al. 2021). A small number of studies used other features, such as maximum and minimum 2m daily air temperatures (Zhang et al. 2022), and rainfall forecasts (Kurian et al. 2020). A notable feature is the streamflow or water level from the upstream gauging stations. In prior studies, many of the studied locations did not have upstream"}, {"title": "gauging stations, but where they do exist, including the upstream information as an input to the machine learning model is a favorable modeling practice for better accuracy (Nguyen et al. 2022).\nMany machine learning models have been used to extract patterns from features and targets. Neural network models have gained popularity in recent studies. The basic multilayer perceptron is often used as the baseline model for model comparison (Kao et al. 2020; Zhang et al. 2022). The suggested model is usually based on recurrent neural (RNN) network architecture. Because short- term future streamflow is highly correlated with the streamflow and rainfall at past time points, RNNs are a natural choice, whose architecture is designed to extract temporal patterns between features and targets. As one of the RNN variants, the Long Short-term Memory (LSTM) model was widely adopted (Cui et al. 2022). Different modeling techniques, such as encoder-decoder structure (Kao et al. 2020), and time series differencing (Lin et al. 2021), have been used to enhance the performance of the basic LSTM. In addition, a few studies have applied Transformer to the problem of short-term streamflow forecasting, considering its potential advantage of memorizing more historical information (Xu et al. 2023). However, although previous studies have used time series of streamflow and rainfall from multiple gauging stations in the watershed as model inputs, models designed to capture spatial patterns have rarely been used. Therefore, except for following the usual modeling practices of previous studies (i.e., 1\u20136 hour forecasting horizons, the use of streamflow and rainfall as features, and the adoption of the RNN architecture), our study adopts a graph convolution technique, inspired by prior research in spatiotemporal forecasting of urban systems (Wang et al. 2024; Wu et al. 2023; Zanfei et al. 2022). The graph convolution aggregates information from gauging stations in the watershed, enabling the model to capture spatial dependencies crucial for a more realistic representation of the hydrological system and more accurate streamflow forecasting at the target location.", "content": ""}, {"title": "2.2 Streamflow forecasting with residual error learning", "content": "Previous studies have considered the residual error in streamflow forecasting. The residual error is defined as the difference between the forecasted streamflow and the streamflow working as the ground truth. It comes from the uncertainties in hydro-climatological data measurements, the errors in the forecasting model inputs, the flawed parameters of the forecasting model, the imperfect design of the conceptual model, etc. (Panchanathan et al. 2023). Not only in hydrologic models, but these sources of residual error may also exist in precipitation forecasting models for streamflow forecasting. For medium- and long-term streamflow forecasts, the residual error from the precipitation forecasting models is also a major concern in previous studies (Khatun et al. 2023; McInerney et al. 2020).\nA foundational assumption by the studies on residual error learning and reduction is that the residual errors could be described by explicit or sometimes implicit patterns, such as biases, variances, autocorrelations, and distributions. While various attempts have been made to identify and decompose the errors into explainable sources, many studies in recent years primarily consider the overall forecasting errors and their underlying patterns (Li et al. 2016). For instance, McInerney et al. (2020) managed to model and forecast the residual error considering seasonal variability, dynamic biases, and non-Gaussian residual errors. Roy et al. (2023) assumed that residual error is not a white noise following Gaussian distribution, and it is time-dependent or has other definite patterns.\nWhile the previous study managed to forecast both streamflow and residual errors with a single model by redesigning the structure of regression models considering the residual error patterns (McInerney et al. 2020), most relevant studies relied on an additional residual error module beyond the base model. For example, Khatun et al. (2023) used LSTM to model and"}, {"title": "forecast the residual error, and Roy et al. (2023) attached a random forest model to learn the residual error beyond the base simulation model. M. Li et al. (2016, 2017) proposed an alternative strategy of residual error learning. Instead of using a complex or deep model to learn the residual error, applying multiple simple regression models at consecutive stages is possible to obtain better results. After applying a sine and logarithmic transformations on the residual errors, they used the average of forecasted streamflow, the residual error in the last time point, and a mixture Gaussian distribution to model and reduce the error.\nPrevious studies of streamflow forecasting with residual error learning have established a deep understanding of residual errors and ways to deal with them. However, the residual errors regarding measured streamflow are rarely studied. A few studies have focused on this problem (Das Bhowmik et al. 2020; Habert et al. 2016; Zeroual et al. 2016). Das Bhowmik et al. (2020) proposed a method for reducing the residual error regarding measured streamflow. They designed some scenarios of errors and the corresponding error reduction and investigated the benefits of the \u201cknowledge of error\u201d in forecasting streamflow in a simulated environment, instead of using a real-world dataset. With the same research objective, Habert et al. (2016) modeled the rating curve error due to temporal change of friction coefficients and bed geometry in the river channel, using data assimilation. However, they did not consider other sources of rating curve error, such as unsteady flow and imperfect fitting.", "content": ""}, {"title": "3 Methods", "content": ""}, {"title": "In response to the shortcomings of prior studies, this study proposes a method based on machine learning models for short-term streamflow and flood forecasting, with residual error learning for reducing the errors introduced by rating curves. As shown in Fig. 1, the proposed method follows the paradigm of previous studies, in which a base model is used together with an additional residual error learning module. In the base model, average rainfall in the watershed and the water level at the target gauging station as well as upstream stations at past time points are used as features, and the streamflow 1-6 hours later is the target. The base model is built on the Gated Recurrent Unit (GRU) structure (a variant of RNN) for capturing temporal patterns and the graph convolution is utilized to extract spatial patterns in the data. The residual error learning part adopts the strategy suggested by M. Li et al. (2016). Instead of using a single complex model, multiple", "content": ""}, {"title": "linear regression models were used to learn the errors introduced by unsteady flows and the imperfect fitting of rating curves, respectively. Inspired by the work of Roy et al. (2023), an XGBoost model is attached to the end of the process to learn the non-linear residual error patterns that are not covered by the linear models. The three stages of residual error learning were implemented sequentially. The model in the following stage is built on the data processed by the last stage model. The learned and forecasted residual error is used to revise the original forecasting by the base model and improve the forecasting.", "content": ""}, {"title": "3.1 Data sources and preprocessing", "content": "To support the basic idea of this study and to validate the effectiveness of the proposed method, multiple public datasets were collected and analyzed. We first implemented a large-scale data analysis to measure the magnitude of differences between reported and measured streamflow in the U.S. streamflow databases. The USGS operates one of the largest stream gauge networks within the U.S. and its data are widely used in machine learning-based streamflow prediction studies. Therefore, we started the analysis with all 10,754 stream gauges operated by the USGS that were active on Dec. 31, 2023 (waterdata.usgs.gov/nwis).\nBecause the motivation of this study is focused on forecasting streamflow and its impacts during floods and high flows, 3,488 surface water gauges monitoring medium-to-large streams were considered, and 1,548 out of them that experienced at least one flood condition during recent years were selected. Specifically, 1) streams with long-term streamflow greater than 10m\u00b3/s (i.e., streams rated higher than Level 5) in the HydroSHEDS V1 dataset (www.hydrosheds.org) were identified as medium-to-large streams, and the corresponding USGS gauges on these streams were identified based through spatial join. 2) To determine whether streams are prone to flooding and high flows in recent years, instantaneous (i.e., 15 minutes time interval) gauge height values from"}, {"title": "Jan. 1, 2018, to Dec. 31, 2023, were retrieved from the USGS NWIS and resampled to obtain the maximum daily gauge height values for the selected gauges. 3) Thresholds of flood stages determined by NOAA were downloaded from USGS WaterWatch (waterwatch.usgs.gov). Among the five flood stages (www.weather.gov/lot/hydrology_definitions), the \u201caction stage\u201d was selected as the threshold due to its action and decision-making significance.\nFor the selected gauging stations, streamflow field measurements and instantaneous reported streamflow between January 1, 2018, and December 31, 2023, were collected from the NWIS. 1) Field measurements are streamflow values measured on-site by USGS hydrologic technicians every few weeks or months using equipment such as the current meter or Acoustic Doppler Current Profiler. Missing values in the raw data and values that were not used in rating curve development were excluded from the analysis. 2) Instantaneous reported streamflow was modeled by the USGS using gauging heights and the temporary rating curve used at the corresponding period. Provisional values were removed from the reported streamflow. The pre- processed reported and measured streamflow data were used to calculate the differences between the two and it is analyzed in the Results section.\nTo implement and validate the proposed method, candidate gauging stations were further filtered based on criteria such as multiple flooding events in recent years, multiple stations within the watershed, a minimum number of streamflow field measurements at the target station during the test period, and sufficient water level and streamflow data. The proposed method was tested on two gauging stations, which matches the number of test sites, i.e., one to two, in most prior relevant studies (Cui et al. 2022; Lin et al. 2021; Nguyen et al. 2022). USGS 01573560 is located at Swatara Creek near Hershey, Pennsylvania, U.S.A., which is one of the upstream rivers of a medium-sized city, Harrisburg, PA. The annual average streamflow in 2023 is 572 cubic feet per", "content": ""}, {"title": "second and the drainage area is 483 square miles. USGS 03320000 is located at Green River at Calhoun, Kentucky, U.S.A. It is on the major upstream river of Evansville, Indiana, U.S.A. The average streamflow of the gauge's location in 2021 is 12,300 cubic feet per second, and the drainage area is 7,566 square miles.\nFor the selected gauging stations, 1) instantaneous water levels, instantaneous reported streamflow, and measured streamflow from Jan. 1, 2004, through Dec. 31, 2023, were collected from the NWIS and were either down-sampled or rounded to hourly data. 2) The geographic information required includes river channels, gauging stations, and watersheds. The geographic data for river channels is from HydroSHEDS V1. The geographic locations of gauging stations, as well as upstream gauging stations, were collected from the USGS Hydro Network-Linked Data Index (waterdata.usgs.gov/blog/nldi-intro). Geographic information of watersheds was collected from the USGS StreamStates database (streamstats.usgs.gov/ss/). 3) In addition, rainfall data were downloaded from the JAXA Global Rainfall Watch (GSMaP) database (sharaku.eorc.jaxa.jp/GSMaP/). The rainfall data has the same time frame as the streamflow data and is geographically scoped within the bounding box of the watershed.", "content": ""}, {"title": "3.2 Graph convolution recurrent neural network for streamflow forecasting", "content": "This section describes the base model for streamflow forecasting. In the base model, average rainfall in the watershed and the water level at the target gauging station as well as upstream stations at past time points are used as features, and the streamflow 1-6 hours later is the target. The base model is built on the Gated Recurrent Unit (GRU) structure (a variant of RNN) for capturing temporal patterns and the graph convolution is utilized to extract spatial patterns in the data. The predicted water level is converted to the predicted streamflow using the rating curves from the USGS for the corresponding periods."}, {"title": "To make a formal problem formulation, the studied watershed is conceptualized as a weighted and directed graph G = (V, E, A), where V (|V| = N) is the set of nodes representing gauging stations, & is the connectedness between nodes, and A \u2208 RNXN is the weighted adjacency matrix of nodes. Each entry Ai,j represents a node proximity, which is a function of the traveling distance in the river network between each pair of connected nodes. It is calculated as Ai,j =\n1"}]}