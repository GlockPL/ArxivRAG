{"title": "Zeoformer: Coarse-Grained Periodic Graph Transformer\nfor OSDA-Zeolite Affinity Prediction", "authors": ["Xiangxiang Shen", "Zheng Wan", "Lingfeng Wen", "Licheng Sun", "Ou Yang Ming Jie", "XUAN TANG", "Xian Zeng", "Mingsong Chen", "Xiao He", "Xian Wei"], "abstract": "To date, the International Zeolite Association\nStructure Commission (IZA-SC) has cataloged\nmerely 255 distinct zeolite structures, with millions\nof theoretically possible structures yet to be dis-\ncovered. The synthesis of a specific zeolite typi-\ncally necessitates the use of an organic structure-\ndirecting agent (OSDA), since the selectivity for\na particular zeolite is largely determined by the\naffinity between the OSDA and the zeolite. There-\nfore, finding the best affinity OSDA-zeolite pair is\nthe key to the synthesis of targeted zeolite. How-\never, OSDA-zeolite pairs frequently exhibit com-\nplex geometric structures, i.e., a complex crystal\nstructure formed by a large number of atoms. This\ngeometric structure exhibits coarse-grained crystal\nperiodicity and fine-grained local variability: (1)\nFine-grained local variability: From the perspective\nof fine-grained structure, each unit cell shares the\nsame crystal lattice, but there are subtle structural\ndifferences, such as the different poses of OSDA\nin an OSDA-zeolite pair, as shown in figure 1(c).\n(2) Coarse-grained periodicity: Despite the subtle\ndifferences within the unit cell, the overall struc-\nture of an OSDA-zeolite pair can still be viewed\nas the periodic repetition of the unit cell in space\nfrom a coarse-grained structural perspective. Al-\nthough some existing machine learning methods\ncan represent the periodicity of crystals, they can-\nnot accurately represent crystal structures with lo-\ncal variability. To address this issue, we propose a\nnovel approach called Zeoformer, which can effec-\ntively represent coarse-grained crystal periodicity\nand fine-grained local variability. Zeoformer recon-\nstructs the unit cell centered around each atom and\nencodes the pairwise distances between this central\natom and other atoms within the reconstructed unit\ncell. The introduction of pairwise distances within\nthe reconstructed unit cell more effectively repre-\nsents the overall structure of the unit cell and the\ndifferences between different unit cells, enabling\nthe model to more accurately and efficiently predict", "sections": [{"title": "1 Introduction", "content": "Zeolite (a type of porous crystal) materials have garnered\nwidespread attention for their applications in gas adsorption\n[P\u00e9rez-Botella et al., 2022; Ackley et al., 2003], catalysis\n[Weitkamp, 2000; Chai et al., 2021], and drug delivery [Ser-\nvatan et al., 2020; Serati-Nouri et al., 2020]. Zeolite struc-\ntures are entirely composed of a periodic repeating structure\nof $TO_4$ tetrahedra (where T represents Si, Al, or P), which\nform three-dimensional (3D) networks by sharing vertex oxy-\ngen atoms O [Li and Yu, 2014]. The diversity in how these\nperiodic tetrahedra connect results in a wide variety of zeolite\nstructure types, theoretically allowing for millions of possi-\nble configurations [Schmidt et al., 2014]. However, design-\ning synthetic routes for target zeolite topologies is a labor-\nintensive task. To date, the International Zeolite Association\nStructure Commission (IZA-SC) [Baerlocher and McCusker,\n2021] has cataloged only 255 distinct zeolite structure types.\nIn chemical reactions, zeolites typically crystallize under hy-\ndrothermal conditions in the presence of inorganic precursors\nand organic templates, forming as metastable phases that re-\nquire organic structure-directing agents (OSDAs) to compen-\nsate for energy loss and provide additional energy to stabi-\nlize these phases and enable diversification [Shin et al., 2019;\nMoliner et al., 2015; Dusselier and Davis, 2018].\nSpecifically, synthesizing a specific zeolite usually requires\nan OSDA, since the selectivity for a particular zeolite is\nlargely determined by the affinity between the OSDA and the\nzeolite [Shin et al., 2019]. Therefore, finding the best affin-\nity OSDA-zeolite pair is the key to the synthesis of targeted\nzeolite. An example in Figure 1 shows the combination of\nzeolite and OSDA forms the structure of the OSDA-zeolite\npair. However, the OSDA-zeolite pair often has a complex\ngeometric structure, i.e., a complex crystal structure formed\nby a large number of atoms. This geometric structure exhibits\ncoarse-grained crystal periodicity and fine-grained local vari-\nability: (1) Fine-grained local variability: From the perspec-\ntive of fine-grained structure, each unit cell shares the same\ncrystal lattice, but there are subtle structural differences, such\nas the different poses of OSDA in an OSDA-zeolite pair, as\nshown in 1(c). (2) Coarse-grained periodicity: Despite the\nsubtle differences within the unit cell, the overall structure of\nan OSDA-zeolite pair can still be viewed as the periodic repe-\ntition of the unit cell in space from a coarse-grained structural\nperspective. Therefore, this kind of crystal structure cannot\nbe accurately represented by simply repeating a unit cell ac-\ncording to lattice parameters. This complex geometric struc-\nture challenges most existing deep-learning methods.\nBased on the assumption that the relative coordinates of\natoms between different unit cells in a crystal remain un-\nchanged, many deep learning methods [Yan et al., 2022;\nLin et al., 2023; Yan et al., 2024] represent crystal struc-\ntures by modeling the crystal graph of a single unit cell along\nwith its periodic pattern. For example, Matformer [Yan et\nal., 2022] directly encodes periodic patterns by assigning six\nself-connected edges determined by a manually defined lat-\ntice matrix $L = [l_1, l_2, l_3] \\in \\mathbb{R}^{3\\times3}$ for each atom within the\nunit cell, as shown by the six solid blue lines in Figure 2(c).\nIn Figure 2(a), the black arrows show the periodic encoding\nof an atom in a two-dimensional structure based on lattice pa-\nrameters, which may point to non-existent atomic positions.\nConformer [Yan et al., 2024] encodes periodicity by incorpo-\nrating the spatial distances between different replicas of each\natom along three directions as edge information, as shown in\nFigure 2(d). As shown by the black arrows in Figure 2(b), the\nperiodic encoding based on this method reflects the differ-\nences for specific atoms. However, for unit cells with a large\nnumber of atoms, this method may not adequately capture the\nlocal differences between different unit cells. Although these\nperiodic encoding methods achieve periodicity, they overlook\nfine-grained local variability. Specifically, in OSDA-zeolite\nstructures, there are differences in the relative coordinates of\natoms between different unit cells. Conformer and Matformer\nencode periodicity at the level of each individual atom, mak-\ning them ineffective at capturing local variability caused by\nchanges in atomic positions across different unit cells. More\nrelated methods and detailed discussions are presented in Ap-\npendix D.\nTo effectively capture the differences between different\nunit cells, we need to encode the coarse-grained periodic pat-\ntern from the perspective of the entire unit cell, rather than\nconsidering each atom individually. Therefore, we recon-\nstruct the unit cell centered around each atom in the original\nunit cell and encode the pairwise distances between the cen-\ntral atom and other atoms within the reconstructed unit cell.\nThis method encodes the spatial distances between a given\natom and the nearest replicas of other atoms within the unit\ncell, rather than only considering the replicas of the atom it-\nself. When overlapping the reconstructed unit cells for all\natoms, the extent of the atom-reconstructed unit cells in two-\ndimensional space, as shown in Figure 2(e) (indicated by the\ngreen box), can extend up to four times the range of the origi-\nnal unit cell (indicated by the black box), and up to eight times\nin three-dimensional space, forming a supercell. This encod-\ning method better identifies subtle differences between dif-\nferent unit cells, allowing the model to more accurately rep-\nresent the geometric structure of OSDA-zeolite pairs, specif-\nically the coarse-grained crystal periodicity and fine-grained"}, {"title": "2 Related Work", "content": "2.1 OSDA-guided Zeolite Synthesis\nSome studies [Moliner et al., 2008; Daeyaert et al., 2019]\npropose candidate OSDAs for specific zeolite structures using\ncomputational methods, including density functional theory\nand molecular dynamics. Schwalbe and Gomze [Schwalbe-\nKoda and G\u00f3mez-Bombarelli, 2021] address biases in sim-\nulation methods by comparing different approaches to cal-\nculate the interaction energy between zeolites and OSDAs,\nproviding robust guidelines for computing binding energies\nin zeolite-OSDA pairs. Jensen et al. [Jensen et al., 2021] em-\nploy data-driven approaches to study the relationship between\nOSDAs, qualitative gel chemistry, and resulting zeolite struc-\ntures. Machine learning has been applied in studies that do\nnot explicitly model OSDA-zeolite interactions, including the\ninvestigation of specific zeolites within finite chemical spaces\n[Corma et al., 2006; Manuel Serra et al., 2007], OSDA-free\nzeolite systems [Muraoka et al., 2019], and zeolite phase\ntransformations [Schwalbe-Koda et al., 2019]. However, ex-\nisting research often simplifies OSDA representation to basic\nattributes such as molecular volume [Jensen et al., 2019] or\nis limited to single zeolite structures [Daeyaert et al., 2019].\nIn contrast, we adopt the concept of graph neural networks to\nmodel OSDA-zeolite pairs as graphs, aiming to predict their\naffinities for screening suitable OSDAs to guide zeolite syn-\nthesis.\n2.2 Crystal Property Prediction with Deep\nLearning\nCGCNN [Xie and Grossman, 2018] learns material proper-\nties from the connections between atoms in crystals. MegNet [Chen et al., 2019] is a graph network with global state at-\ntributes. GATGNN [Louis et al., 2020] uses multiple graph\nattention layers (GAT) to learn properties of local neighbor-\nhoods and global attention layers to weight global atomic fea-\ntures. ALIGNN [Choudhary and DeCost, 2021] and M3GNet\n[Chen and Ong, 2022] incorporate angle information into\nmessage passing to produce richer and more discriminative\nrepresentations. CrysMMNet [Das et al., 2023] uses a mul-\ntimodal framework that integrates graph and text represen-\ntations to generate joint multimodal representations of crys-\ntalline materials. CrysDiff [Song et al., 2024] is a pretraining-\nfinetuning framework based on diffusion models. However,\nthese aforementioned methods struggle with accurately repre-\nsenting lattice parameters and crystal periodicity. Matformer\n[Yan et al., 2022] encodes periodic patterns through self-\nconnecting edges of atoms. PotNet [Lin et al., 2023] con-\nsiders the infinite summation of pairwise atomic interactions.\nCrystalformer [Taniai et al., 2024] considers infinitely con-\nnected attention, thereby performing infinite summations of\ninteratomic potentials. ComFormer [Yan et al., 2024] repre-\nsents the geometric information of crystals using equivariant\nvector representations and invariant geometric descriptors of\nEuclidean distances and angles."}, {"title": "3 Preliminaries", "content": "This section provides a brief introduction to crystal structures\nand OSDA-zeolite structures. For detailed information on\nOSDA-zeolite structures and the periodic invariance of crys-\ntals, please refer to Appendix C.\nThe Structure of Crystals. The crystal is a substance with\na highly ordered structure. By selecting an appropriate struc-\ntural unit, the entire crystal can be viewed as the periodic rep-\netition of this unit in space. This property of atoms within a\ncrystal repeating in 3D space according to a specific pattern is\ncalled periodicity, with the smallest repeatable structural unit\nbeing the unit cell of the crystal. The unit cell fills the crys-\ntal space when the structural unit is translated through lattice\nvectors. Thus, the unit cell can be defined as $U = (X,P)$,\nwhere X and Z can be represented in matrix form. Typically,\n$X = [x_1, x_2 ... x_{n-1},x_n] \\in \\mathbb{R}^{n\\times1}$, where n represents the\nnumber of atoms and $x_i \\in \\mathbb{R}^1$ represents the atomic type of\natom i in the unit cell. $P = [p_1, p_2 ... p_{n-1},p_n] \\in \\mathbb{R}^{n\\times3}$\nis the atomic position matrix, where $p_i \\in \\mathbb{R}^3$ represents the\nCartesian coordinates of the atom i in the unit cell in 3D\nspace. To further encode the periodic pattern, additional lat-\ntice vectors $L = [l_1, l_2, l_3]^T \\in \\mathbb{R}^{3\\times3}$ are used to describe how\nthe unit cell repeats itself in three directions. Therefore, in 3D\nspace, we can represent the crystal as (X, P, L).\nDefinition 1 (Unit Cell E(3) Invariance): A function $f :$\n$(X,P,L) \\rightarrow Y'$ is unit cell E(3) invariant if, for all $Q \\in$\n$\\mathbb{R}^{3\\times3}$, where |Q| = 1, and $b \\in \\mathbb{R}^3$, we have $f (X,P,L) =$\n$f (X, QP + b, QL)$.\nIn other words, the crystal structure remains unchanged\nwhen the position matrix P of the unit cell structure under-\ngoes rotation, translation, or reflection.\nThe Structure of OSDA-zeolite. OSDA-zeolite is a vari-\nant of crystal structure. It still adheres to the geometric con-"}, {"title": "4 The Proposed Zeoformer", "content": "In this section, we propose Zeoformer, with a key focus on en-\ncoding the coarse-grained Periodic Pattern Encoding of crys-\ntal structures, referred to as PPE, as illustrated by the Up-\ndate PPE layer in Fig 5. We first demonstrate how to con-\nstruct coarse-grained periodic patterns that reflect differences\nbetween different unit cells, and then explain how the crystal\ngraphs are built upon periodic patterns to ensure the E(3) in-\nvariance of the crystal graphs. Finally, we present the overall\nframework of Zeoformer.\n4.1 Encoding of Coarse-grained Periodic Pattern\nPrevious methods [Yan et al., 2022; Lin et al., 2023; Yan et\nal., 2024] for constructing periodic patterns typically rely on\nthe assumption that the relative coordinates of atoms between\ndifferent unit cells in a crystal remain unchanged. However,\nin OSDA-zeolite structures, the atomic coordinates can vary\nbetween different unit cells. As a result, we cannot encode pe-\nriodic structures independently for each atom, as was done in\nthe past using lattice parameters. Instead, we need to encode\nperiodicity from the perspective of the entire unit cell. This\nmeans that when constructing periodicity, the focus should\nbe on the overall structure of all atoms within the unit cell,\nrather than treating each atom as an independent entity for\nencoding. We achieve this by reconstructing the unit cell cen-\ntered around each atom and encoding the pairwise distances\nbetween this central atom and other atoms within the recon-\nstructed unit cell.\nFormally, given the position pi of the atom i and the mod-\nified positions of other atoms within the reconstructed unit\ncell $P_j = p_j + k_1l_1+k_2l_2+k_3l_3$, where $k_1,k_2, k_3$ belong to\n[-1,0,1]. These positions represent the nearest copies of the\ncentral atom i and the remaining atoms in its reconstructed\nunit cell, as shown in Figure 3. The following equation\nprovides the periodic pattern encoding, denoted as PPE:\n$D_i = {\\sqrt{(p_i - p_j)^2} | i, j\\in \\mathbb{Z},p_i, p_j \\in P,1 \\leq j \\leq n}$\n$d_i = \\sqrt{(p_i - p_j)^2} = \\sqrt{(x_i \u2013 x_j)^2 + (y_i \u2013 y_j)^2 + (z_i \u2013 z_j)^2 }$,\n$PPE = { UD_i | i \\in \\mathbb{Z},1 \\leq i \\leq n, d_i > D_i \\neq 0 }$\nwhere Di represents the union of feature vectors of distances\nbetween the atom i and other atoms within the unit cell\ncentered on the atom i, with $D_i \\in \\mathbb{R}^n$, and nrepresenting the\nnumber of atoms in the unit cell. $PPE \\in \\mathbb{R}^{n\\times n}$ represents\nthe union of distance features between all atoms. Since\nthe interaction energy between an atom and its neighboring\natoms is usually inversely proportional to the distance, we\ntake the reciprocal of the distance feature after removing\nzeros.\n4.2 Crystal Graph Construction\nWe represent our crystal graph based on the method of\nconstructing multi-edge crystal graphs. In the graph, each\nnode represents an atom i and all its infinite duplicates in\n3D space, with positions ${P_i | P_i = P_i + k_1l_1 + k_2l_2 +\nk_3l_3, k_1,k_2, k_3 \\in \\mathbb{Z}}$, and node features xi. An edge is\nestablished from node j to node i when the Euclidean dis-\ntance $|e_{ji}|$ between a duplicate of j and i satisfies $|e_{ji}|^2 =$\n$|P_j + k_1l_1 + k_2l_2 + k_3l_3 - p_i|^2 < r$, where r \\in R is the cut-\noff radius. We select the nearest t edges within the cutoff\nradius, each with a corresponding edge feature $e_{ji}|^2$. As\nshown in Figure 3(b), the blue circles represent the region\ndefined by the cutoff radius. At the same time, the black\nboxes indicate the atoms included in our periodic pattern en-\ncoding. Formally, we represent the constructed crystal graph\nas $G = (X,X^T,E,PPE)$. Therein, $x_i \\in X$ is the feature\nvector of the atom i, $e_{n_i} \\in E$ is the feature vector of the h-th\nedge between nodes i and j, and we denote XI as the indices\nof the nodes i and j that form the edge. $PPE \\in \\mathbb{R}^{n \\times n}$ is\nthe periodic pattern encoding we introduced above, where n\nis the number of atoms in the constructed graph.\nProof of the E(3) Invariance of the Constructed Crystal\nGraphs. As shown in Figure 4, applying E(3) transforma-\ntions alters the absolute positions of atoms within the unit\ncell but does not change the types of atoms, their relative po-\nsitions within the crystal, or the lattice parameters; in other\nwords, it changes the spatial distances between atoms, but"}, {"title": "4.3 The Architecture of Zeoformer", "content": "In this section, we introduce the information propagation\nscheme of Zeoformer. The information propagation scheme\nof Zeoformer consists of four parts: the graph embedding\nlayer, node-wise transformer layer, PPE message passing\nlayer, and output layer. Figure 5 illustrates the overall frame-\nwork architecture of Zeoformer.\nFeature Embedding Layer. First, let's introduce the con-\nstruction of the graph embedding layer. We use the atomic\nencoding from CGCNN for embedding. For the edge infor-\nmation $e_{ji}$, we use radial basis functions to encode the dis-\ntance between two adjacent nodes in the graph, represented\nby Equation 1, where $\\gamma$ and $\\mu$ are hyperparameters. For the\nperiodic pattern encoding, we perform matrix multiplication\non PPE to carry out the initial aggregation of atomic infor-\nmation, obtaining information for the PPE message passing\nlayer. Thus, we obtain the graph embedding as\n$A = CGCNN(X), e_{ij} = exp(- \\frac{||P_i - P_j||^2}{\\mu}),$\n$PPE = PPE * A$\nwhere denotes the Hadamard product.\nNode-wise Transformer Layer. Building upon the con-\nstructed graph, we aggregate the node information. Let $a_i^l$\nrepresent the input feature vector of node i at layer l in Ze-\noformer. The information propagation scheme for layer l is\ndescribed as follows. We use $\\oplus$ and $\\odot$ to denote concatena-\ntion and element-wise product. The message from node j to i\nis formed by the corresponding query $q_{ij}$, key $k_{ij}$, and value\nfeatures $v_{ij}$ as follows :\n$q_{ij} = LQ (a_i^l), k_{ij} = (LK (a_i^l) \\oplus LK (a_j^l) \\oplus LE (e_{ji})),$\n$v_{ij} = (LV (a_i^l) + LV (a_j^l) + LE (e_{ji})),$\n$v_{ij} = v \\odot sigmoid (LNorm (LN_{update} (v_{ij}))),$\n$att_{ij} = LN_K (k_{ij}),$\n$\\bar{\\alpha}_{ij} = \\frac{exp(att_{ij})}{\\sum_{j \\in N_i} exp(att_{ij})},$\n$\\bar{m}_{ij} = q_{ij} \\oplus sigmoid (BN (att'_{ij})) \\oplus LN_v (v_{ij})$\nwhere LQ, LK, LV, and LE are the linear transformations for\nquery, key, value, and edge features. $LN_K, LN_v$ are the\nnonlinear transformations for key and value, including two\nlinear layers and an activation layer in between. $LE_{update}$\nrepresents the linear transformation for updating messages,\nand LNorm denotes the layer normalization operation. BN\ndenotes the batch normalization layer, and $d_q$ is the dimen-\nsion of $q_{ij}$.\nThen, we obtain the message $M_i^l$ by aggregating the infor-\nmation from the neighborhood of node i over multiple edges,\nand $A_i^{l+1}$ is realized as follows :\n$M_i^l = \\sum_{j \\in N_i} \\sum_{h} LN_{msg} (\\bar{m}_{hij}),$\n$A_i^{l+1} = softplus (a_i^l + BN (M_i^l))$\nwhere LNmsg is the linear transformation used for updating\nthe edge messages."}, {"title": "4.4 PPE Message Passing Layer.", "content": "$A^l$ and $PPE^l$ represent the\natomic features and 3D periodic pattern encoding at layer l,\nrespectively. Its message-passing mechanism is as follows:\n$PPE' = PPE^l + A^{l+1},$\n$A_1, A_2 = LN_{PPE} (BN (PPE^{l+1})),$\n$A^{l+1} = A^l + LN_{update}$\n$(LN_{update} (A_1) \\oplus Drop(\\text{\u0120ELU} (A_2)))$"}, {"title": "5 Experimental Studies", "content": "5.1 Experimental Setup\nWe conducted experiments on one OSDA-zeolite pair dataset\n(referred to as the OSDB [Schwalbe-Koda et al., 2021]\ndataset) and two material benchmark datasets, namely the\nMaterials Project [Chen et al., 2019] and Jarvis [Choudhary\net al., 2020]. Detailed descriptions of the three datasets\ncan be found in the Appendix A. Baseline methods include\nCFID [Choudhary et al., 2018], CGCNN [Xie and Grossman,\n2018], SchNet [Sch\u00fctt et al., 2017], MEGNET [Chen et al.,\n2019], GATGNN [Louis et al., 2020], ALIGNN [Choudhary\nand DeCost, 2021], M3GNet [Chen and Ong, 2022], Mat-\nformer [Yan et al., 2022], PotNet[Lin et al., 2023], CrysMM-\nNet [Das et al., 2023], CrysDiff [Song et al., 2024], Crys-\ntalformer [Taniai et al., 2024], and ComFormer [Yan et al.,\n2024]. For all baseline methods on the material datasets, we\nreport the results provided in the cited papers. Results for\nall baseline models on the OSDB dataset are based on exper-\nimental replications using their open-source code. Detailed\nZeoformer configurations for different tasks are provided in\nthe Appendix G.\n5.2 Experimental Results\nOSDB Dataset. The dataset can be accessed through\n[Schwalbe-Koda et al., 2021], comprising 112, 424 OSDA-\nzeolite pairs. We retrained all baseline models. To ensure\na fair comparison, all baseline models were retrained under\nidentical conditions, ensuring identical training, validation,\nand test sets, and reported the results for the prediction of"}, {"title": "5.3 Ablation Studies", "content": "In this section, we demonstrate the impact of periodic pattern\nencoding on the representation learning of OSDA-zeolite and\ncrystal materials through ablation studies. Specifically, we\nconducted experiments on the OSDB and JARVIS datasets by\ncomparing the results for Banding total and Ehull attributes,\nusing testing MAE as the quantitative evaluation metric.\nBy comparing models with different layers of periodic pat-\ntern encoding against models without periodic pattern encod-\ning but retaining the PPE message passing layer, we vali-\ndate the importance of periodic pattern encoding. The results\nshow that compared to networks without periodic pattern en-\ncoding, we achieved improvements of 28.2% and 17.5% in\nthe Banding total and Ehull tasks, respectively. Compared to\nthe models that retain only the PPE message passing layer\nbut lack periodic pattern encoding, we achieved improve-\nments of 18.9% and 7.2% in these two tasks, respectively."}, {"title": "6 Conclusions", "content": "In order to predict the OSDA-Zeolite Affinity, we proposed\na novel model called Zeoformer. By reconstructing the unit\ncell centered on each atom and encoding the pairwise dis-\ntances between this central atom and other atoms, Zeoformer\nbetter represents the geometric structure of OSDA-zeolite\npairs, capturing both coarse-grained crystal periodicity and\nfine-grained local variability. Experimental results on three\ndatasets demonstrate that our Zeoformer significantly outper-\nforms baseline methods in various property prediction tasks.\nOur model helps narrow down the search space for candidate\nOSDAs, demonstrating significant potential in the field of di-\nrected zeolite synthesis. Future work will explore more in-\ntrinsic structures of the OSDA-Zeolite pair and generate rea-\nsonable OSDA-Zeolite structures."}]}