{"title": "A Riemannian Approach for Spatiotemporal Analysis and Generation of 4D Tree-shaped Structures", "authors": ["Tahmina Khanam", "Hamid Laga", "Mohammed Bennamoun", "Guanjin Wang", "Ferdous Sohel", "Farid Boussaid", "Guan Wang", "Anuj Srivastava"], "abstract": "We propose the first comprehensive approach for modeling and analyzing the spatiotemporal shape variability in tree-like 4D objects, i.e., 3D objects whose shapes bend, stretch and change in their branching structure over time as they deform, grow, and interact with their environment. Our key contribution is the representation of tree-like 3D shapes using Square Root Velocity Function Trees (SRVFT) [21]. By solving the spatial registration in the SRVFT space, which is equipped with an L\u00b2 metric, 4D tree-shaped structures become time-parameterized trajectories in this space. This reduces the problem of modeling and analyzing 4D tree-like shapes to that of modeling and analyzing elastic trajectories in the SRVFT space, where elasticity refers to time warping. In this paper, we propose a novel mathematical representation of the shape space of such trajectories, a Riemannian metric on that space, and computational tools for fast and accurate spatiotemporal registration and geodesics computation between 4D tree-shaped structures. Leveraging these building blocks, we develop a full framework for modelling the spatiotemporal variability using statistical models and generating novel 4D tree-like structures from a set of exemplars. We demonstrate and validate the proposed framework using real 4D plant data.", "sections": [{"title": "1 Introduction", "content": "We propose a novel framework for the statistical analysis of the spatiotemporal shape variability in tree-like 3D objects that deform over time, hereinafter referred to as 4D (or 3D + time) tree-like structures. Such objects, which undergo complex non-rigid and topological deformations, are abundant in nature. Understanding and modelling the deformation patterns of their shapes can benefit"}, {"title": "2 Related Work", "content": "We refer to [11,12,21] for a detailed survey. Here, we focus on 4D shape analysis and related topics. Studying and modelling the spatio-temporal shape variability in 4D shapes requires defining a proper shape space and metrics on this space, performing spatiotemporal registration under the metric, and computing geodesics between 4D shapes. The bulk of the work is focused on the spatial registration problem, which is traditionally solved using hand-crafted feature matching and the Iterated Closest Point [1,18,23]. These methods are well suited for 3D objects that bend and stretch, e.g., human/animal body shapes. Tree-like 3D objects such as plants and blood vessels have complex structures and exhibit topological variability, which makes their spatial registration challenging.\nTo address these issues, Feragen et al. [5\u20138] treat a tree-shaped object as a point in a tree shape space equipped with the Quotient Euclidean Distance (QED) as a metric. The problem of registering two tree-shaped objects is then reduced to that of finding the optimal deformation path, or geodesic with respect to the metric, that deforms one tree onto the other. These deformations include branch bending, stretching, and topological changes. Under the QED, bending and stretching are measured using the L2 metric while topological changes are measured using graph edit distance. This results in a significant shrinkage along the geodesic paths when the deformations are large. Wang et al. [20,22] alleviated this issue by representing the shape of the edges in the tree shapes of Feragen et al. [5\u20138] using the Square Root Velocity Functions (SRVF) [17] and then using the QED in the SRVF space, which is equivalent to the full elastic metric in the original space. This still suffers from the shrinkage that is due to the edge collapses used by the QED metric. Duncan et al. [4] addressed these issues by representing trees using sliding branches, instead of collapsing edges. Guan et al. [21] extended this representation to tree-like 3D shapes such as complex botanical trees, plant roots, and neuronal structures. It has also been used to build a full generative model of tree-like 3D shapes by fitting Gaussian distributions to tree-like 3D shapes represented as points in the tree-shape space.\nThis paper builds upon and generalizes the representation of [21] to 4D tree-shaped objects, i.e., sequences of tree-like 3D shapes that deform time. The key idea is to represent 4D shapes as trajectories in the tree-shape space reducing the problem to that of analyzing elastic trajectories in the tree-shape space. This idea has been introduced by Laga et al. [12] for objects that have a manifold structure"}, {"title": "3 The Space of 3D tree-shaped structures", "content": "We first present the mathematical framework we use to represent tree-structured 3D shapes (Sec. 3.1), the elastic metric for quantifying their bending, stretching, and topological changes (Sec. 3.2), and the computational tools for their spatial registration and geodesics computation (Sec. 3.3). Throughout the paper, we use the Pheno4D dataset [16], which consists of multiple 4D plants. Each 4D plant is a sequence of 3D plants, in the form of point clouds, captured at different times during its growth. We extract the skeleton of the plants using [15] and partition it into branches; see Fig. 1 and also Fig. 1 in the Supplementary Material."}, {"title": "3.1 Representation", "content": "We represent a branch of a 3D tree structure T as an arc length-parameterized curve \u03b2: [0,1] \u2192 R\u00b3 where \u1e9e(s) = (x(s),y(s), z(s)). We structure a 3D tree into layers; see Fig. 1. The first layer 3\u00ba is the main branch with k\u00ba subtrees T\u00b9 attached to it at the bifurcation points $s_i^0$ = 1,...,k\u00ba. That is, T = (\u03b2\u00b0, {$T_i^1, s_i^0\\}_{i=1}^{k^0}$). A 3D subtree T\u00b9 at level I of the hierarchy can be represented recursively as $T^l = (\u03b2^l, \\{T_i^{l+1},s_i^l\\}_{i=1}^{k^l})$, for I = 1,..., L \u2212 1. Here, L is the total number of layers, \u00dfl is the main branch of T\u00b9, k\u00b9 is the number of subtrees attached to the branch \u00df, and $s_i^l$ \u2208 [0,1] is a bifurcation point on \u00dfl of T\u00b9. The branches at different levels can have any arbitrary number of subtrees attached to them. A good representation needs to be invariant to similarity-preserving transformations (translation, scale, rotation, reparameterization). To achieve translation invariance, we translate each tree so that the start point of its main branch is located at the origin. Invariance to scale is optional as it may not be required for some applications such as growth analysis. The space of all such normalized trees is referred to as the pre-tree-shape space and is denoted by CT. The invariance to rotation and reparameterization will be dealt with at the metric level (Sec. 3.2). With this representation, a 3D tree becomes a point in the pre-tree shape space Cr. A 4D tree H can then be seen as a time-parameterized curve H : [0,1] \u2192 CT where [0, 1] is the time domain."}, {"title": "3.2 The elastic metric for comparing tree-shaped structures", "content": "If two 3D tree structures have the same number of branches, then one can quantify the dissimilarity between the two trees by measuring the amount of bending,"}, {"title": "3.3 Spatial registration and geodesics", "content": "Fig. 2 summarizes the spatial registration process. With this representation, the optimal rotation, diffeomorphism, and permutations that align Q2 onto Q1 can be found by solving the following optimization problem; see Section 2 in the Supplementary Material for the detailed algorithm:\n$(0^*, \u03b3^*, \u03c3^*) = \\underset{O, \u03b3, \u03c3}{argmin} d_{C_0} (Q_1, Q_2, \u039f, \u03b3, \u03c3)).$\nIn practice, the input trees have different numbers of branches, thus they are elements of different subspaces. We address this by adding null branches at the different levels of the trees. This way, trees become elements of the same pre-tree shape space. The location of each additional null branch, i.e., the value of its parameters, is initialized to the s value of its initial corresponding branch. These will get updated during the branchwise correspondences.\nEq. (4) registers onto each other a pair of tree-like 3D shapes. To analyze 4D trees, we need to jointly register and align all the 3D instances within a 4D tree. We perform this sequentially: each 3D tree-shape within a sequence is aligned to the next 3D tree-shape in the sequence, using Eq. (4). With this formulation, computing a geodesic, or the optimal deformation that aligns Q2 onto Q1 is straighforward. Let $Q_2^\u2217 = (Q_2, \u039f^\u2217, \u03b3^\u2217, \u03c3^\u2217)$. Since the metric is a weighted norm of L\u00b2 distances, the geodesic a* between Q1 and Q2 is the straight line that connects Q1 to $Q_2^\u2217$, i.e., a*(t) = (1 - t)Q1 + $tQ_2^\u2217$, t \u2208 [0, 1]. For visualization, we map a*(t) back to the non-linear space of 3D tree-shaped structures Cr using the inverse SRVF mapping, which has a closed analytical form; see [17]."}, {"title": "4 The proposed space of 4D trees-shaped structures", "content": "With this setup, a 4D tree-like shape becomes a time-parameterized 1D curve, or trajectory, a : [0, 1] \u2192 CQ. Thus, analyzing 4D tree-shaped structures becomes the problem of analyzing 1D curves in C\u0119. Here, we mathematically define the shape space Ca of such curves and equip it with a proper metric (Sec. 4.1) that will allow us to temporally register and compare such trajectories (Sec. 4.2)."}, {"title": "4.1 The shape space of 4D tree-shaped structures", "content": "Let a: [0, 1] \u2192 Co be a curve in C\u0119 representing the SRVFT of a 4D tree-shaped object. Let Ca be the space of all such curves. To temporally register, compare, and summarize samples of such curves, we need to define an appropriate metric on Ca that is invariant to the execution rate of the curves. Mathematically, variations in the execution rate correspond to time-warping and thus can be represented using diffeomorphisms \u00a7: [0,1] \u2192 [0,1] that map the temporal domain to itself. Two curves a and \u03b1\u03bf\u03beonly differ in their execution rates and thus should be deemed equivalent. With this, the temporal registration of two 4D trees a1 and 2 becomes the problem of finding the optimal time"}, {"title": "4.2 Temporal registration and geodesics between 4D trees", "content": "With this representation, a 4D tree-shaped structure a : [0, 1] \u2192 CQ becomes a trajectory apca in CPCA = Rk. Thus, the analysis framework presented in Sec. 4.1 for the pre-tree shape space can now be performed on Rk. Fig. 3 summarizes the"}, {"title": "5 Statistical Analysis of 4D Tree Shapes", "content": "The ability to compute spatio-temporal correspondences and geodesics between 4D tree-shaped structures enables a wide range of 4D shape analysis tasks. In"}, {"title": "6 Results and discussions", "content": "We demonstrate the proposed framework and evaluate its performance on the Pheno4D dataset [16], which contains 4D models of seven tomato and seven maize plants. All the models are not registered onto each other, neither spatially nor temporally; see the Supplementary Material for further details and results with ablation studies."}, {"title": "6.1 Spatiotemporal Registration", "content": "(1) Spatial registration. Fig. 2 shows an example of the spatial registration of four complex 3D tree-shaped structures of tomato plants. For clarity, we only show the branch-wise correspondences up to the second layer. Figs. 2, 3, and 4 in the Supplementary Material show, respectively, an example of the spatial registration within and across two 4D tomato plants as well as a zoom-in onto individual trees. This result shows that our framework is efficient in finding correct branch-wise correspondences between complex tree-shaped structures. We evaluate the quality of the proposed spatial registration method and compare it with state-of-the-art techniques such as [3,15] on eight pairs of 4D tomato plants and nine pairs of 4D maize plants. We use three quantitative measures:"}, {"title": "6.2 Geodesics between 4D Trees", "content": "Fig. 8 in the Supplementary Material shows a geodesic path, before spatiotemporal registration, between a source 4D plant (top row) and a target 4D plant (bottom row). The in-between rows correspond to 4D plants sampled at equidistances along the geodesic path between the source and target. In this example, the target has a different growth rate than the source. It also has missing samples. Thus, we interpolate it and sample it at the same time intervals as the source but we do not perform spatiotemporal registration. Consequently, the target follows a different growth pattern than the source. As we can see in this figure, since the two 4D plants are not spatio-temporally registered, the 4D geodesic"}, {"title": "6.3 Summary statistics and 4D tree-shae synthesis and generation", "content": "We took seven unregistered 4D tomato plants from the Pheno4D dataset and computed their mean and modes of variations using the proposed framework. Fig. 10 in the Supplementary Material shows the seven 4D tomato plants before (Fig. 10-a) and after (Fig. 10-b) co-registering them onto each other using the proposed spatiotemporal registration. Fig. 5 shows the mean 4D plant of these"}, {"title": "7 Conclusion", "content": "We have proposed a novel theoretical framework and a set of new computational tools for analyzing tree-shaped 4D structures, i.e., 3D objects that have a tree structure and grow and deform over time. These tools include mechanisms for the spatiotemporal registration of and geodesics computation between tree-shaped 4D structures. These are the key building blocks for learning statistical models and generative models from collections of tree-shaped 4D structures such as growing plants. Our key contribution is to model the spatiotemporal variability in 4D tree shapes as trajectories in the SRVF space, reducing the problem to that of analyzing curves in an Euclidean space. As demonstrated in the experiments, the proposed computational tools can handle complex tree-shaped 4D objects that undergo complex non-rigid and topological deformations. Although we evaluated the framework on 4D plants, it is general and can be used for other types of tree-shaped structures such as neuronal structures in the brain, blood vessels, and airway trees. The current framework is limited to the skeleton structure of tree-shaped 4D objects. In the future, we plan to extend the framework to handle the full 3D geometry of the branches in tree-shaped 3D and 4D objects. Potential negative impact. To the best of our knowledge, this work may not have any negative impact on society."}]}