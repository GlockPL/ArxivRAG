{"title": "SafePowerGraph: Safety-aware Evaluation of Graph Neural Networks for Transmission Power Grids", "authors": ["Salah GHAMIZI", "Aleksandar BOJCHEVSKI", "Aoxiang MA", "Jun CAO"], "abstract": "Power grids are critical infrastructures of paramount importance to modern society and their rapid evolution and interconnections has heightened the complexity of power systems (PS) operations. Traditional methods for grid analysis struggle with the computational demands of large-scale RES and ES integration, prompting the adoption of machine learning (ML) techniques, particularly Graph Neural Networks (GNNs). GNNs have proven effective in solving the alternating current (AC) Power Flow (PF) and Optimal Power Flow (OPF) problems, crucial for operational planning. However, existing benchmarks and datasets completely ignore safety and robustness requirements in their evaluation and never consider realistic safety-critical scenarios that most impact the operations of the power grids. We present SafePowerGraph, the first simulator-agnostic, safety-oriented framework and benchmark for GNNs in PS operations. SafePowerGraph integrates multiple PF and OPF simulators and assesses GNN performance under diverse scenarios, including energy price variations and power line outages. Our extensive experiments underscore the importance of self-supervised learning and graph attention architectures for GNN robustness. We provide at https://github.com/yamizi/SafePowerGraph our open-source repository, a comprehensive leaderboard, a dataset and model zoo and expect our framework to standardize and advance research in the critical field of GNN for power systems.", "sections": [{"title": "I. INTRODUCTION", "content": "In recent decades, the energy sector has experienced sig-nificant transformations driven by a range of technological, economic, and environmental influences. One of the most remarkable trends is the development and maturity of renew-able energy resources (RESs), and energy storage systems (ESs) that increase the complexity of monitoring and online-operations of power systems (PS).\nTransmission system operators (TSOs) require real-time tools for effective power systems operations, but current meth-ods for grid analyses, hindered by their computational speed, cannot fully meet the challenges posed by RESs and ESs at large scale. Driven by these limitations, TSO are increasingly relying on machine learning (ML) techniques to support power operations. In particular, Graph Neural Networks (GNNs) have demonstrated their effectiveness in modeling the dynamics of the power grid and have emerged as the leading techniques for real-time solutions to solve optimizations of the alternating-current (AC) power system [3, 26, 34].\nSolving AC power flow (PF) and AC Optimal Power Flow (OPF) problems is a routine task in power system operational planning. The PF problem involves determining the voltage magnitudes and phase angles of all buses in an electrical power system, ensuring that the power supplied meets the demand while satisfying the constraints of the network. Meanwhile, the OPF problem is an optimization problem. It seeks to find the best voltage settings in the system buses and generator power outputs to satisfy load requirements (energy demand), while satisfying network constraints and minimizing energy losses and energy generation costs. This optimization is not always scalable when considering large topologies, new components (RESS, ESs), and high variations in loads and energy prices.\nGNNs are today de facto the predominant approaches to solve the PF problem [6, 9, 20, 27, 30] and the OPF problem [28, 29, 34, 36]. Few approaches are designed outside of pure academia and are implemented by TSO themselves [3, 24]. However, each publication and approach are evaluated under different experimental settings, using different PF and OPF solvers (we identified six) to generate their labeled datasets and rarely consider challenging and safety-critical evaluation scenarios with network perturbations.\nA comprehensive study on the perturbations of Nordic power grids [5] showed that these eight countries faced a total of 1972 major disturbances in 2022. These disturbances were associated with 1345 faults on overhead lines. Line faults and outages are among the main security threats to the stability and safety of power grids. Energy price surges are another real threat to the stability of the network, and the recent crises have challenged, for example, European energy prices (Fig. 2).\nPublic power grid datasets such as the Electricity Grid Simulated (EGS) dataset [4], the PSML [43] dataset and the Simbench dataset [33] are not specifically designed for machine learning applications on graphs and do not account for these realistic perturbations. To the best of our knowledge, there are only two benchmarks related to our work: LIPS[24] and PowerGraph[39]. We compare them in Table II.\nTheir main limitations are that they (1) do not solve the variability problem of PF and OPF simulators in the commu-nity, and only support one simulation tool, (2) do not sup-port safety-critical scenarios such as line outages and energy price variations, and (3) only consider traditional supervised learning (SL), while most of the new approaches are driven by self-supervised learning (SSL) with physics-informed ML [17, 26]. These limitations make them unsuitable to unify and springboard future research in GNN for PS.\nWe make up for these shortcomings with SafePower-Graph, the first safety-oriented framework and benchmark. Our framework is simulator-agnostic and natively integrates the four popular PF and OPF simulators, and provides safety assessment of GNN by considering supervised errors (MSE), and physical errors (constraints violations) for three settings: in-distribution (ID) scenarios, energy price variations scenar-ios, and power line outages scenarios. Our study demonstrates the relevance of self-supervised learning and Graph Attention architectures for the robustness of GNN for PS.\nIn summary, we make the following contributions.\n\u2022\tTo the best of our knowledge, we are the first to define the problem of GNN vulnerability and safety for realistic PS operations. We introduce realistic scenarios and evaluation metrics tailored to this real-world critical application of GNN.\n\u2022\tWe introduce an innovative integrated GNN frame-work, called SafePowerGraph, which is, to the best of our knowledge, the first practical framework and benchmark addressing the safey and robustness of GNNs within the PS operations context.\n\u2022\tWe conduct extensive experiments on three stan-dardized graph power grids networks and two critical safety edge-cases, and demonstrate the relevance of our benchmark. SafePowerGraph, uncovers the criti-cal impact of GNN architectures and self-supervised learning to ensuring safe and robust GNNs for PS. SafePowerGraph is open-source and available at this repository: https://github.com/[ANONYMIZED].\n\u2022\tWe share with the community a Leaderboard based on more than 200 evaluations to track the progress and the current state of the art in safety and robustness of graph deep learning models for PS, including SL and SSL approaches. The goal is to clearly identify the most successful ideas in GNN architectures and robust training mechanisms to accelerate progress in the field. Our leadearboard is accompanied with a Dataset zoo and a Model Zoo to standarize the research."}, {"title": "II. PRELIMINARIES", "content": "Power grids consist of two elements: buses, which denote key points within the grid such as generation sites, load centers, and substations, and transmission or distribution lines that link these buses. Therefore, it is quite natural to visualize power grid networks as graphs, where buses and transmission lines are depicted as nodes and edges of the corresponding graph.\nThe buses are divided into three main categories: PV, PQ, and V0. PV buses denote grid generators that supply and inject energy. PQ buses denote the grid's loads, which are components that consume energy (e.g. households). The V0 bus is referred to as a \"slack bus\" and acts as a reference point for grid operation. The state of each bus is defined by a set of variables depending on its type (Table I).\nGiven the diversity of the components of the power grid, one can use a homogeneous graph representation where all buses have the same shape of features and labels, and their di-versity is processed as homogeneous GNN with masking [27], or leverage heterogeneous GNN to consider the node types separately [11]."}, {"title": "A. Graph Neural Networks", "content": "Graph Neural Networks (GNNs) have emerged as powerful tools for learning on graph-structured data, which are prevalent in various domains such as social networks, molecular biology, and power grids. At their core, GNNs leverage the message-passing framework, where node features are iteratively up-dated by aggregating information from their neighbors. Early approaches, such as Graph Convolutional Networks (GCNs) [23] applied convolutional operations to graphs, enabling the extraction of local patterns and capturing the graph struc-ture effectively. Following this, numerous enhancements have been proposed to improve GNNs' expressive power, such as GraphSAGE[15], which addressed the scalability issues of GNNs by employing a sampling strategy to aggregate information from a fixed number of neighbors, thus allowing the model to handle large graphs efficiently. Another sig-nificant development was Graph Attention Networks (GATS) [40], which leverages attention mechanisms to assign different weights to neighbor nodes, and DeeperGCN[25], designed to mitigate vanishing gradient, over-smoothing and over-fitting when going deeper.\nRecent advances include heterogeneous graph neural net-works (HGNNs), which extend conventional graph neural networks (GNNs) to handle multiple types of nodes and edges effectively, for example, by leveraging metapath-based aggregation for richer representations [37, 42].\nGNNs support a wide range of tasks, broadly categorized into node- and graph-level tasks. Node-level tasks, such as node classification and node regression, focus on predicting the properties or labels of individual nodes within the graph. In power grids, predicting the state of specific buses belongs to this category. Graph-level tasks, on the other hand, in-volve predicting properties of entire graphs, such as molecular property prediction in chemistry or powerflow convergence in power grids. In addition, GNNs have been utilized for link prediction tasks, which aim to infer missing edges in partially observed graphs. In power systems, link prediction could consist of predicting vulnerable or non-robust lines of the grids, commonly referred to as \"contingency analysis\".\nOur work focuses on two node-level regression tasks for power systems that are critical for power grid operations: Power Flow (PF) and Optimal Power Flow (OPF)."}, {"title": "B. Power Grids Operations", "content": "The scope of our work is to model and solve power flow and optimal power flow problems of transmission grids. We summarize in the following the equations of both the PF and the OPF problems using the polar form, and refer you to Appendix A-A for detailed explanations."}, {"title": "The Power flow problem", "content": "The goal of the PF problem is to find the solution of the unknown variables in each bus given the known values of the buses and the state of the grid (topology and attributes of the grid), as shown in Table I. $P_i^g$, $Q_i^g$ are the generated active and reactive power into bus i, $P_i^d$, $Q_i^d$ are the demand active and reactive power out of the bus i, $P_i$, $Q_i$ are the net real and reactive power injections with $P_i = P_i^g - P_i^d$ and $Q_i = Q_i^g - Q_i^d$, $V_i$, $\\theta_i$ are the voltage magnitude and voltage angle at bus i.\nThe model of the PF problem can be mathematically formulated using Kirchhoff's equations:\n\\[\n\\begin{cases}\nP_i = V_i \\sum_{k=1}^{N} V_k (G_{ik} \\cos(\\theta_i - \\theta_k) + B_{ik} \\sin(\\theta_i - \\theta_k)) \\\\\nQ_i = V_i \\sum_{k=1}^{N} V_k (G_{ik} \\sin(\\theta_i - \\theta_k) - B_{ik} \\cos(\\theta_i - \\theta_k))\n\\end{cases}\n\\]\nfor each bus i,k \u2208 {1..N} of the grid, where $G_{ik}$ and $B_{ik}$ denote two physical line properties, the conductance and susceptance, respectively. Traditionally, PF problem is addressed with iterative solvers. The most popular use the Newton-Raphson method, linearizing power flow equations starting from an initial guess of the unknown variables in Table I. We elaborate on the solver's optimization in Appendix A-A.\nWe learn the PF problem by minimizing three losses:\n1- A supervised loss that uses the solution from the solver (the oracle) as ground truth and minimizes the MSE between the predicted values of the GNN and the oracle's output.\n2- A self-supervised loss that computes all the terms of equations 1, and minimizes the error between the left side and the right sides of the equations.\n3- A boundary-violation loss that models the limits of the components as soft constraints and pushes the outputs to satify them; e.g., to force the predicted active power of each generator within its active power capacity."}, {"title": "The Optimal Power Flow Problem", "content": "The AC Optimal PowerFlow (OPF) problem is a more challenging problem than PF. It consists of finding the best solution to distribute electricity through power grids, consid-ering factors such as demand, supply, storage, transmission limits, and costs, to ensure that everything runs smoothly and efficiently without overloading the system. The objective of this optimization is to fulfill the demand while minimizing the cost of generation of various sources of energies."}, {"title": "Robustness and Safety of Constrained NN", "content": "Despite their effectiveness and scalability, GNNs face sig-nificant challenges in terms of robustness and generalization, and thus are not yet reliable to be deployed for critical applications [26]. In particular, researchers have explored the lack of robustness of GNNs to out-of-distribution data [14] and to adversarial perturbations [21].\nEarly approaches to improve GNN robustness such as Graph Robustification [45] and Adversarial Training [31] have successfully been explored to enhance GNNs' resilience to such perturbations. Recent approaches [7, 13, 22, 41] demon-strated the impact of architectures, training, and losses on the inherent robustness of GNN. However, few studies considered feasible perturbations under domain constraints. Geisler et al. [8] explored the robustness of GNN-based solvers for the traveling salesman problem, where the perturbation space was restricted by the problem.\nConstrained perturbation is a blooming field of research in computer vision and tabular machine learning. Ballet et al. [1] focused on the importance of characteristics in the design of attacks, Mathov et al. [32] took into account mutability, type, boundary, and data distribution constraints, and Simonetto et al. [35] emphasized the importance of considering domain-constraints (inter-feature relationships) for crafting realistic perturbations.\nOur work focuses on three realistic scenarios that GNNs for PS can encounter in the real world: load variations, price variations, and line outages. We generate valid perturbations by ensuring that all the domain constraints of the grid are satisfied, in particular the power flow equations defined in Eq. 1, and the boundaries of the features (Appendix B-A)."}, {"title": "III. PROBLEM FORMULATION", "content": "PF and OPF are node-level regression tasks, and the target (the ground truth of the state) for each node is a continuous vector provided by an oracle. At each perturbation, both the prediction and the target will then vary.\nContrary to traditional robustness assessment, where the target is not supposed to vary under small perturbations, the robustness of power grids is measured based on an acceptable threshold of error compared to the oracle. The targets of the nodes require expensive solvers to obtain the new ground truths. We formulate in the following the problem of hetero-geneous GNN robustness under constrained perturbations.\nWe consider a heterogeneous graph, denoted as $\\mathcal{G} = (\\mathcal{V}, \\mathcal{E}, \\mathcal{M})$, that consists of a node set $\\mathcal{V}$ and a link set $\\mathcal{E}$ and an adjacency matrix $\\mathcal{M}$. A heterogeneous graph is also associated with a node-type mapping function $\\phi : \\mathcal{V} \\rightarrow \\mathcal{A}$ and a link-type mapping function $\\psi : \\mathcal{E} \\rightarrow \\mathcal{R}$. $\\mathcal{A}$ and $\\mathcal{R}$ denote the sets of predefined node types and link types, where $|\\mathcal{A}| + |\\mathcal{R}| > 2$.\nFor both PF and OPF problems, we consider a homoge-neous link type $|\\mathcal{R}| = 1$, and the following node types: $\\mathcal{A} = \\{bus, line, transformer, generator, slack, load, capacitor\\}$.\nWe denote by $n_i$ the number of nodes of type i in the graph $\\mathcal{G}$, by $f_i$ the number of features of nodes of type i, and by $t_i$ the number of outputs of nodes of type i. Each node of type i has a set of features $\\mathcal{X}_i = \\{x_i^k / \\forall k \\in 1..f_i \\}$. The details of the features and outputs of each node are in Appendix B-A.\nWe denote by $\\mathcal{X} = \\{\\mathcal{X}_i \\in \\mathbb{R}^{n_i \\times f_i} \\ \\forall i \\in \\mathcal{A}\\}$ an input example, defined as the heterogeneous dictionnary of features of the nodes of the graph $\\mathcal{G}$, and denote by $\\mathcal{Y} = \\{y_i \\in \\mathbb{R}^{n_i \\times t_i} \\ \\forall i \\in \\mathcal{A}\\}$ its correct target. Let $h : (\\mathcal{X}, \\mathcal{M}) \\rightarrow \\hat{\\mathcal{Y}}$ be a graph neural network that outputs a regression value $\\hat{h} = \\{\\hat{h}_i \\in \\mathbb{R}^{n_i \\times t_i} \\ \\forall i \\in \\mathcal{A}\\}$, and $g : (\\mathcal{X},\\mathcal{M}) \\rightarrow \\hat{\\mathcal{y}}$ an oracle that outputs the ground truth value using traditional exact solvers (e.g., Newton Raphson).\nLet $\\Delta$ be the space of allowed perturbations. We define a $(\\Delta, \\mu)$-robust model h to be any model (e.g. GNN) that satisfies\n\\[\n\\forall \\delta \\in \\Delta : ||h(\\mathcal{X} + \\delta) - g(\\mathcal{X} + \\delta))||_p \\leq \\mu,\n\\]\nwhere $||.||_p$ is a defined distance (e.g. an Lp-normed distance) and $\\mu$ is an acceptable error threshold.\nIn image classification, the set $\\Delta$ is typically chosen as the perturbations within some Lp-ball around $\\mathcal{X}$, that is, $\\Delta_p = \\{\\delta \\in \\mathbb{R}^d, ||\\delta||_p \\leq \\epsilon\\}$ for a maximum perturbation threshold $\\epsilon$.\nPower grid data are by nature different from images. Each feature $X_{ij} \\in \\mathcal{X}_i$ of the graph represents a physical property (e.g., line resistances, length, etc.) or a smart meter measurement (e.g. load's active power). Thus, $X_{ij}$ has to respect physical constraints to be valid.\nA minimal requirement is to respect the boundary con-straints of each feature, and a sufficient requirement is that the perfect solver converges to a solution when optimizing the perturbed Pf or OPF problem. In practice, traditional solvers are not perfect and are dependent on their hyper-parameters (threshold, budget, ...), however, we assume that our oracle solver is perfect. A robust GNN is then defined as follows:\n\\[\n\\forall \\delta \\quad g(\\mathcal{X}+\\delta) converges \\rightarrow ||h(\\mathcal{X}+\\delta)-g(\\mathcal{X}+\\delta))||_p \\leq \\mu\n\\]\na) Threat Model: Within the Power Grid operations problems outlined above, a critical concern is the threat of unexpected grid variations during model inference, which compromises the safety of the grids and the integrity of operations of the Transmission System Operator (TSO). To scope our discussion, we assume that the variations are benign, that is, they have not been crafted specifically to hurt the ML system but represent black swans events with major impacts on the grid.\nb) Design Requirements: This paper aims to develop a framework to assess and mitigate the impact of Power Grid perturbations in the context of GNN-based powerflow and optimal power flow problems. Our method should be suitable for the Power Grid scenario that realistically poses major threats to the grid's optimal operation. Specifically, our design requirements are as follows.\nP1 Energy price variations: Each generator i has a polynomial generation cost function as follows: $c(P_i^g) = c_0 + c_1 P_i^g+c_2 (P_i^g)^2$, where $c_0$ is the offset active power cost, $C_1$ the linear cost per Mvar and $c_2$ the quadratic cost per MW. For each studied grid, we only vary the linear cost $c_1$, and never consider switching off completely a generator.\nThe cost parameters only impact the optimization of the OPF problem and are ignored for the PF problem.\nP2 Load variations: Each consumer is defined by its load active power $P_l$ and reactive power $Q_l$. While the training data uses a time series of real world consumptions, a robust model should generalize to extreme variations of loads for sub-parts or the entirety of the graph. We model these variation with a multipliper sampled from a uniform distribution. The distribution of this multiplier and the percentage of affected loads within the the grid reflect the severity of the perturbation.\nP3 Line outage: A line outage refers to the loss or failure of a transmission line within an electrical power system. Transmission lines are vital for carrying electricity from power plants to substations and, eventually, to consumers. When a line goes out of service due to a fault, maintenance, or any other reason, it can have several starting with the redistribution of loads that requires power flow change, to possible cascad-ing failures leading up to widespread blackouts. To simulate outages, we evaluate the N-1 reliability criterion. It states that the power system must be capable of withstanding the failure of any single component without causing widespread outages. We randomly remove one line of the grid during evaluation and assess the robustness of the GNN on this degraded grid."}, {"title": "IV. SAFEPOWERGRAPH", "content": "We introduce the architecture of our framework in Fig. 1. Our Python API abstracts both Power Systems (PS) and Ma-chine Learning (ML) functionalities for practitioners from both fields. For ML practitioners, SafePowerGraph is a standarized datasets and models zoo with a unified benchmark to evaluate node-level GNN tasks on complex graphs: Constrained hetero-geneous graphs modeling physical equations and a nonlinear minimization problem. For PS practioners, SafePowerGraph is a GNN-powered OPF and PF simulator that supports major PS formats and tools, and achieves precise, robust, and safe predictions. The main features of our API are:\nA. PowerFlow and OPF Simulation\nOur framework supports the most popular Power Grid libraries for full interoperability:\na) PandaPower (PF, OPF): PandaPower [38] is an open-source Python library that provides tools for the mod-eling, analysis, and optimization of electrical power systems. It is built on top of the popular data analysis library pandas, PandaPower and the power flow solver PYPOWER.\nb) MATPOWER (PF, OPF): MATPOWER [44] is an open-source MATLAB package that provides tools for steady-state power system simulations and optimizations. It supports large-scale PF analysis and OPF optimizations.\nc) OpenDSS (PF): OpenDSS (Open Distribution Sys-tem Simulator) [18] is a popular open-source software for simulating electric power distribution systems. In particular, it natively supports unbalanced distribution grid power flow estimations and is highly scalable.\nd) PowerModels (OPF): PowerModels [2] is a Julia/JuMP-based open-source package designed for solving complex power network optimization problems such as OPF, unit commitment and transmission expansion planning. It is highly extensible and scalable to larger grids.\nB. Graph Data Generation\nIn Fig. 3 we summarize how each graph is generated from a power grid. Starting from an initial grid descriptor (in MatPower, PandaPower or PyPower formats), we generate a Pytorch HeteroData with each component as a distinct subgraph (Step (1)). Each node can be of type: bus, load, gen-erator, slack, line, transformer, or capacitor, and is associated with its distinct set of features X6, X1, Xg, X5, Xe, Xt, Xc respectively. These features support perturbations dependant of their types. For example, generators and slack nodes support the mutation of the price features (i.e., the cost of each unit generated) and their maximum generation capacity (Step (2)).\nEach node is also associated with a set of constraints. They can be included during training as regularization losses, or enforced with clamping (e.g. boundary constraints). All features, mutations, and boundary constraints are detailed in the Appendix B-A.\nFor each mutated grid, we run in Step (3) a simulation and solver to obtain the ground truth of the PF or OPF optimization. This solution consists of the active and reactive power of each generator and the slack nodes (Yg, Ys) and the voltage magnitude and angle for each bus node (Y6).\nBuilding large graph datasets across multiple mutations can be expensive. We distribute our datasets in a zoo following the Open Graph Benchmark (OGB) taxonomy [16].\nC. Training\nHeterogeneous graph training supports multiple existing architectures, including GCN, Sage, and GAT. It consists of interleaving the message functions on each node type individually. We present in figure 4 the extension of a standard single node type architecture to two node types (bus and load).\nEach of our models consists of a succession of heteroge-neous graph layers (the backbone), and a set of fully connected layers that outputs the final predictions (head) [28]. Following [11], we extend this standard structure by computing the loss of each node type separately. The splitted loss computations allows to dynamically update the weight (the contribution) of each node type's loss in the backpropagated loss. SafePower-Graph supports weighting strategies because previous research demonstrated that adequate weighting can significantly im-prove the robustness of multitask models [10, 12].\nTraining loss: We incorporate the constraints of the prob-lem in the loss of our GNN as regularization terms. We transform each of the constraints and optimization objectives into a regularization loss. Given a training graph G, its set of node types A, its features X, its associated ground truth prediction y and its predicted output y, the training loss function of our GNN (parametrized by ) becomes:\n\\[\n\\mathcal{L}(\\Theta) := \\Lambda_b||\\mathcal{Y}_b - \\hat{\\mathcal{Y}}_b||^2 + \\Lambda_s||\\mathcal{Y}_s - \\hat{\\mathcal{Y}}_s||^2 + \\Lambda_g ||\\mathcal{Y}_g - \\hat{\\mathcal{V}}_g ||^2\n+ \\sum_{i\\in A} \\sum_{Y_i \\in \\Omega_b} ctrloss(i, Y_i)\n+ \\Lambda_e \\cdot sslloss (x, y)\n+ \\Lambda_c \\cdot costloss (x_g, y_g, x_s, y_s)\n\\]\nwhere the first term is the supervised loss over the bus, slack, and generator outputs. The second term captures the weighted constraints violations of the power grid given the set of constraints \u03a9 of each type of node. The third term is the self-supervised loss that solves the equations of the power grid in 1. The last term is the energy cost minimization loss considering the prices of the generators and the slack node.\nOur study in Appendix C-B confirms that optimal solutions in our scenarios require all the losses. Our pretrained models can be downloaded with our API and the results are available on a public, easy-to-use benchmark available on https://github .com/yamizi/SafePowerGraph.\nD. Quantitative Evaluations\nIn our evaluation, by default, we report three errors:\nSupervised error. We provide the normalized square error for predicted variables for each type of nodes averaged across all the nodes of this type per grid. For example, the reported MSE for generators in a 9-bus grid is averaged over the two generators of this grid. The final results is the average self-supervised error across all the validation grids.\nSelf-supervised error. We report the violations to the powerflow equations as an MSE over all the buses of the grid. The final results is the average self-supervised error across all the validation grids.\nBoundary errors. Given a violation threshold, for each node we consider all the boundary violations as binary. A graph is considered 'valid' if it has no violation. The final results is the percentage of invalid graphs in amonth the validation graphs.\nE. Qualitative Evaluations\nOur framework supports an in-depth analysis of the grid and the behavior of individual lines, buses, and constraints.\nConstraints Evaluation: The framework records individ-ual violations for powerflow and boundary constraints. They are stored in dataframe format for individual visualizations and analyses of the buses, the generators, the slack nodes.\nLoading Visualization: The framework allows the visual-ization of the the bus and line loading for solutions computed by a mathematical solver and by GNN. Buses are expected to have voltages under 1.0 per unit (pu) ideally, and at worst 1.1 pu. Line loading is ideally under 80%, and dangerous over 100%. Overloaded lines can lead to outages and have cascading effects. Our framework record these metrics and provides a simple visualisations by leveraging Pandapower [38] plotting API for all simulators and GNN.\nF. Other components\nSafePowerGraph integrates RAY parallelization to mutate and generate embeddings for thousands of graphs seamlessly. The calls to solvers are also parallelized in CPU and the train-ing leverages GPU parallelization. The framework supports natively experiment trackers such as Comet and WandB."}, {"title": "V. BENCHMARKING GNN FOR POWER GRIDS", "content": "We focus the empirical study on the harder OPF problem, and defer some results for the PF problem to the Appendix B.\nA. Experimental Settings\nPower grid topologies: We evaluate three commonly used topologies: WSCC 9-Bus system, IEEE 30-Bus system, and IEEE 118-Bus system. The first case represents a simple system with 9 buses, 3 generators, and 3 loads. The IEEE test cases represent an approximation of the American Electric Power system. The IEEE 30-Bus system has 30 buses, 5 generators, and 24 loads, and IEEE 118-bus has 118 buses, 19 generators, 35 synchronous condensers, 177 lines, 9 trans-formers, and 91 loads.\nPower grid mutations: For each experiment, we generate 1000 valid mutants (that is, for which the solver converged to a solution). We generate 800 training graphs using load variations from a real-world timeseries, and 200 test graphs are generated following different perturbation scenarios. The initial scenario is an In-Distribution mutation, where the loads are mutated following the same distribution of the training set (while ensuring no data leakage between train and test). We refer to this scenario as ID. For the second scenario (line outage), we randomly disconnect one line from the grid. In the last scenario, we randomly mutate the price of production of individual generator within the original generator price boundaries. We refer to this last scenario as Price variation.\nGNN architectures: We evaluated three GNN layer ar-chitectures: Graph Convolution (cgn), SageConv (sage), and Graph Attention (gat). We use two layers and run a hyperpa-rameter search on the number of features and hyperparameters of the layers (with 20% cross-validation). In evaluation we report the best performing model for each architecture.\nAfter the two graph layers, each model is composed of two fully connected layers with 128 features each. The output of the models depends on the size of the grid and is of size 2x (Nbus + Ngenerators + 1) to learn a regression task for the OPF solutions.\nEvaluation Metrics For the quantitative study, we report the supervised normalized MSE for the active and reactive powers of the generators and the slack node, and for the voltage magnitude and angle of the buses. We refer to them as Pgen, Qgen, Pslack, Qslack, and V, 0, respectively. We run our evaluations over three random seeds, report/plot in the main paper the mean values, and report in the appendices the standard deviations.\nFor the qualitative study, we evaluated the boundary con-straints with a tolerance of 10-4 (as they are hard physical constraints, such as the generation capacity), and we used a tolerance of 10-2 for the power flow equations.\nTraining and optimization: We trained all models with the 4x32Gb V100 GPU, for 1000 epochs and batch size of 128. We used Adam optimizer and a multistep learning rate, starting at 0.001 and decaying by 0.5 at epochs \u2208 {500, 750, 875}.\nWe evaluated three weighting strategies to weight i in the loss equation 6. A strategy with equal weights, a strategy with softmax randomized weights at each batch and epoch, and a normalized weight based on the cardinality of each loss term (number of buses, generators, constraints,...) We report an empirical study on the best weighting strategies in Appendix C-C."}, {"title": "B. OPF quantitative evaluation", "content": "Line outages. We report in orange in Fig. 5 the impact of line outages. They have limited impact on the errors of the Powerflow equations compared to the ID setting for 9-bus and 30-bus. The error varies from 6.02\u00d710-7 to 6.42\u00d710-7 in 9-bus and from 4.05\u00d710-9 to 3.84\u00d710-9 in 30-bus.\nLine outages"}, {"title": "SafePowerGraph: Safety-aware Evaluation of Graph Neural Networks for Transmission Power Grids", "authors": ["Salah GHAMIZI", "Aleksandar BOJCHEVSKI", "Aoxiang MA", "Jun CAO"], "abstract": "Power grids are critical infrastructures of paramount importance to modern society and their rapid evolution and interconnections has heightened the complexity of power systems (PS) operations. Traditional methods for grid analysis struggle with the computational demands of large-scale RES and ES integration, prompting the adoption of machine learning (ML) techniques, particularly Graph Neural Networks (GNNs). GNNs have proven effective in solving the alternating current (AC) Power Flow (PF) and Optimal Power Flow (OPF) problems, crucial for operational planning. However, existing benchmarks and datasets completely ignore safety and robustness requirements in their evaluation and never consider realistic safety-critical scenarios that most impact the operations of the power grids. We present SafePowerGraph, the first simulator-agnostic, safety-oriented framework and benchmark for GNNs in PS operations. SafePowerGraph integrates multiple PF and OPF simulators and assesses GNN performance under diverse scenarios, including energy price variations and power line outages. Our extensive experiments underscore the importance of self-supervised learning and graph attention architectures for GNN robustness. We provide at https://github.com/yamizi/SafePowerGraph our open-source repository, a comprehensive leaderboard, a dataset and model zoo and expect our framework to standardize and advance research in the critical field of GNN for power systems.", "sections": [{"title": "I. INTRODUCTION", "content": "In recent decades, the energy sector has experienced sig-nificant transformations driven by a range of technological, economic, and environmental influences. One of the most remarkable trends is the development and maturity of renew-able energy resources (RESs), and energy storage systems (ESs) that increase the complexity of monitoring and online-operations of power systems (PS).\nTransmission system operators (TSOs) require real-time tools for effective power systems operations, but current meth-ods for grid analyses, hindered by their computational speed, cannot fully meet the challenges posed by RESs and ESs at large scale. Driven by these limitations, TSO are increasingly relying on machine learning (ML) techniques to support power operations. In particular, Graph Neural Networks (GNNs) have demonstrated their effectiveness in modeling the dynamics of the power grid and have emerged as the leading techniques for real-time solutions to solve optimizations of the alternating-current (AC) power system [3, 26, 34].\nSolving AC power flow (PF) and AC Optimal Power Flow (OPF) problems is a routine task in power system operational planning. The PF problem involves determining the voltage magnitudes and phase angles of all buses in an electrical power system, ensuring that the power supplied meets the demand while satisfying the constraints of the network. Meanwhile, the OPF problem is an optimization problem. It seeks to find the best voltage settings in the system buses and generator power outputs to satisfy load requirements (energy demand), while satisfying network constraints and minimizing energy losses and energy generation costs. This optimization is not always scalable when considering large topologies, new components (RESS, ESs), and high variations in loads and energy prices.\nGNNs are today de facto the predominant approaches to solve the PF problem [6, 9, 20, 27, 30] and the OPF problem [28, 29, 34, 36]. Few approaches are designed outside of pure academia and are implemented by TSO themselves [3, 24]. However, each publication and approach are evaluated under different experimental settings, using different PF and OPF solvers (we identified six) to generate their labeled datasets and rarely consider challenging and safety-critical evaluation scenarios with network perturbations.\nA comprehensive study on the perturbations of Nordic power grids [5] showed that these eight countries faced a total of 1972 major disturbances in 2022. These disturbances were associated with 1345 faults on overhead lines. Line faults and outages are among the main security threats to the stability and safety of power grids. Energy price surges are another real threat to the stability of the network, and the recent crises have challenged, for example, European energy prices (Fig. 2).\nPublic power grid datasets such as the Electricity Grid Simulated (EGS) dataset [4], the PSML [43] dataset and the Simbench dataset [33] are not specifically designed for machine learning applications on graphs and do not account for these realistic perturbations. To the best of our knowledge, there are only two benchmarks related to our work: LIPS[24] and PowerGraph[39]. We compare them in Table II.\nTheir main limitations are that they (1) do not solve the variability problem of PF and OPF simulators in the commu-nity, and only support one simulation tool, (2) do not sup-port safety-critical scenarios such as line outages and energy price variations, and (3) only consider traditional supervised learning (SL), while most of the new approaches are driven by self-supervised learning (SSL) with physics-informed ML [17, 26]. These limitations make them unsuitable to unify and springboard future research in GNN for PS.\nWe make up for these shortcomings with SafePower-Graph, the first safety-oriented framework and benchmark. Our framework is simulator-agnostic and natively integrates the four popular PF and OPF simulators, and provides safety assessment of GNN by considering supervised errors (MSE), and physical errors (constraints violations) for three settings: in-distribution (ID) scenarios, energy price variations scenar-ios, and power line outages scenarios. Our study demonstrates the relevance of self-supervised learning and Graph Attention architectures for the robustness of GNN for PS.\nIn summary, we make the following contributions.\n\u2022\tTo the best of our knowledge, we are the first to define the problem of GNN vulnerability and safety for realistic PS operations. We introduce realistic scenarios and evaluation metrics tailored to this real-world critical application of GNN.\n\u2022\tWe introduce an innovative integrated GNN frame-work, called SafePowerGraph, which is, to the best of our knowledge, the first practical framework and benchmark addressing the safey and robustness of GNNs within the PS operations context.\n\u2022\tWe conduct extensive experiments on three stan-dardized graph power grids networks and two critical safety edge-cases, and demonstrate the relevance of our benchmark. SafePowerGraph, uncovers the criti-cal impact of GNN architectures and self-supervised learning to ensuring safe and robust GNNs for PS. SafePowerGraph is open-source and available at this repository: https://github.com/[ANONYMIZED].\n\u2022\tWe share with the community a Leaderboard based on more than 200 evaluations to track the progress and the current state of the art in safety and robustness of graph deep learning models for PS, including SL and SSL approaches. The goal is to clearly identify the most successful ideas in GNN architectures and robust training mechanisms to accelerate progress in the field. Our leadearboard is accompanied with a Dataset zoo and a Model Zoo to standarize the research."}, {"title": "II. PRELIMINARIES", "content": "Power grids consist of two elements: buses, which denote key points within the grid such as generation sites, load centers, and substations, and transmission or distribution lines that link these buses. Therefore, it is quite natural to visualize power grid networks as graphs, where buses and transmission lines are depicted as nodes and edges of the corresponding graph.\nThe buses are divided into three main categories: PV, PQ, and V0. PV buses denote grid generators that supply and inject energy. PQ buses denote the grid's loads, which are components that consume energy (e.g. households). The V0 bus is referred to as a \"slack bus\" and acts as a reference point for grid operation. The state of each bus is defined by a set of variables depending on its type (Table I).\nGiven the diversity of the components of the power grid, one can use a homogeneous graph representation where all buses have the same shape of features and labels, and their di-versity is processed as homogeneous GNN with masking [27], or leverage heterogeneous GNN to consider the node types separately [11]."}, {"title": "A. Graph Neural Networks", "content": "Graph Neural Networks (GNNs) have emerged as powerful tools for learning on graph-structured data, which are prevalent in various domains such as social networks, molecular biology, and power grids. At their core, GNNs leverage the message-passing framework, where node features are iteratively up-dated by aggregating information from their neighbors. Early approaches, such as Graph Convolutional Networks (GCNs) [23] applied convolutional operations to graphs, enabling the extraction of local patterns and capturing the graph struc-ture effectively. Following this, numerous enhancements have been proposed to improve GNNs' expressive power, such as GraphSAGE[15], which addressed the scalability issues of GNNs by employing a sampling strategy to aggregate information from a fixed number of neighbors, thus allowing the model to handle large graphs efficiently. Another sig-nificant development was Graph Attention Networks (GATS) [40], which leverages attention mechanisms to assign different weights to neighbor nodes, and DeeperGCN[25], designed to mitigate vanishing gradient, over-smoothing and over-fitting when going deeper.\nRecent advances include heterogeneous graph neural net-works (HGNNs), which extend conventional graph neural networks (GNNs) to handle multiple types of nodes and edges effectively, for example, by leveraging metapath-based aggregation for richer representations [37, 42].\nGNNs support a wide range of tasks, broadly categorized into node- and graph-level tasks. Node-level tasks, such as node classification and node regression, focus on predicting the properties or labels of individual nodes within the graph. In power grids, predicting the state of specific buses belongs to this category. Graph-level tasks, on the other hand, in-volve predicting properties of entire graphs, such as molecular property prediction in chemistry or powerflow convergence in power grids. In addition, GNNs have been utilized for link prediction tasks, which aim to infer missing edges in partially observed graphs. In power systems, link prediction could consist of predicting vulnerable or non-robust lines of the grids, commonly referred to as \"contingency analysis\".\nOur work focuses on two node-level regression tasks for power systems that are critical for power grid operations: Power Flow (PF) and Optimal Power Flow (OPF)."}, {"title": "B. Power Grids Operations", "content": "The scope of our work is to model and solve power flow and optimal power flow problems of transmission grids. We summarize in the following the equations of both the PF and the OPF problems using the polar form, and refer you to Appendix A-A for detailed explanations."}, {"title": "The Power flow problem", "content": "The goal of the PF problem is to find the solution of the unknown variables in each bus given the known values of the buses and the state of the grid (topology and attributes of the grid), as shown in Table I. $P_i^g$, $Q_i^g$ are the generated active and reactive power into bus i, $P_i^d$, $Q_i^d$ are the demand active and reactive power out of the bus i, $P_i$, $Q_i$ are the net real and reactive power injections with $P_i = P_i^g - P_i^d$ and $Q_i = Q_i^g - Q_i^d$, $V_i$, $\\theta_i$ are the voltage magnitude and voltage angle at bus i.\nThe model of the PF problem can be mathematically formulated using Kirchhoff's equations:\n\\[\\begin{cases}\nP_i = V_i \\sum_{k=1}^{N} V_k (G_{ik} \\cos(\\theta_i - \\theta_k) + B_{ik} \\sin(\\theta_i - \\theta_k)) \\\\\nQ_i = V_i \\sum_{k=1}^{N} V_k (G_{ik} \\sin(\\theta_i - \\theta_k) - B_{ik} \\cos(\\theta_i - \\theta_k))\\n\\end{cases}\\]\nfor each bus i,k \u2208 {1..N} of the grid, where $G_{ik}$ and $B_{ik}$ denote two physical line properties, the conductance and susceptance, respectively. Traditionally, PF problem is addressed with iterative solvers. The most popular use the Newton-Raphson method, linearizing power flow equations starting from an initial guess of the unknown variables in Table I. We elaborate on the solver's optimization in Appendix A-A.\nWe learn the PF problem by minimizing three losses:\n1- A supervised loss that uses the solution from the solver (the oracle) as ground truth and minimizes the MSE between the predicted values of the GNN and the oracle's output.\n2- A self-supervised loss that computes all the terms of equations 1, and minimizes the error between the left side and the right sides of the equations.\n3- A boundary-violation loss that models the limits of the components as soft constraints and pushes the outputs to satify them; e.g., to force the predicted active power of each generator within its active power capacity."}, {"title": "The Optimal Power Flow Problem", "content": "The AC Optimal PowerFlow (OPF) problem is a more challenging problem than PF. It consists of finding the best solution to distribute electricity through power grids, consid-ering factors such as demand, supply, storage, transmission limits, and costs, to ensure that everything runs smoothly and efficiently without overloading the system. The objective of this optimization is to fulfill the demand while minimizing the cost of generation of various sources of energies."}, {"title": "Robustness and Safety of Constrained NN", "content": "Despite their effectiveness and scalability, GNNs face sig-nificant challenges in terms of robustness and generalization, and thus are not yet reliable to be deployed for critical applications [26]. In particular, researchers have explored the lack of robustness of GNNs to out-of-distribution data [14] and to adversarial perturbations [21].\nEarly approaches to improve GNN robustness such as Graph Robustification [45] and Adversarial Training [31] have successfully been explored to enhance GNNs' resilience to such perturbations. Recent approaches [7, 13, 22, 41] demon-strated the impact of architectures, training, and losses on the inherent robustness of GNN. However, few studies considered feasible perturbations under domain constraints. Geisler et al. [8] explored the robustness of GNN-based solvers for the traveling salesman problem, where the perturbation space was restricted by the problem.\nConstrained perturbation is a blooming field of research in computer vision and tabular machine learning. Ballet et al. [1] focused on the importance of characteristics in the design of attacks, Mathov et al. [32] took into account mutability, type, boundary, and data distribution constraints, and Simonetto et al. [35] emphasized the importance of considering domain-constraints (inter-feature relationships) for crafting realistic perturbations.\nOur work focuses on three realistic scenarios that GNNs for PS can encounter in the real world: load variations, price variations, and line outages. We generate valid perturbations by ensuring that all the domain constraints of the grid are satisfied, in particular the power flow equations defined in Eq. 1, and the boundaries of the features (Appendix B-A)."}, {"title": "III. PROBLEM FORMULATION", "content": "PF and OPF are node-level regression tasks, and the target (the ground truth of the state) for each node is a continuous vector provided by an oracle. At each perturbation, both the prediction and the target will then vary.\nContrary to traditional robustness assessment, where the target is not supposed to vary under small perturbations, the robustness of power grids is measured based on an acceptable threshold of error compared to the oracle. The targets of the nodes require expensive solvers to obtain the new ground truths. We formulate in the following the problem of hetero-geneous GNN robustness under constrained perturbations.\nWe consider a heterogeneous graph, denoted as $\\mathcal{G} = (\\mathcal{V}, \\mathcal{E}, \\mathcal{M})$, that consists of a node set $\\mathcal{V}$ and a link set $\\mathcal{E}$ and an adjacency matrix $\\mathcal{M}$. A heterogeneous graph is also associated with a node-type mapping function $\\phi : \\mathcal{V} \\rightarrow \\mathcal{A}$ and a link-type mapping function $\\psi : \\mathcal{E} \\rightarrow \\mathcal{R}$. $\\mathcal{A}$ and $\\mathcal{R}$ denote the sets of predefined node types and link types, where $|\\mathcal{A}| + |\\mathcal{R}| > 2$.\nFor both PF and OPF problems, we consider a homoge-neous link type $|\\mathcal{R}| = 1$, and the following node types: $\\mathcal{A} = \\{bus, line, transformer, generator, slack, load, capacitor\\}$.\nWe denote by $n_i$ the number of nodes of type i in the graph $\\mathcal{G}$, by $f_i$ the number of features of nodes of type i, and by $t_i$ the number of outputs of nodes of type i. Each node of type i has a set of features $\\mathcal{X}_i = \\{x_i^k / \\forall k \\in 1..f_i \\}$. The details of the features and outputs of each node are in Appendix B-A.\nWe denote by $\\mathcal{X} = \\{\\mathcal{X}_i \\in \\mathbb{R}^{n_i \\times f_i} \\ \\forall i \\in \\mathcal{A}\\}$ an input example, defined as the heterogeneous dictionnary of features of the nodes of the graph $\\mathcal{G}$, and denote by $\\mathcal{Y} = \\{y_i \\in \\mathbb{R}^{n_i \\times t_i} \\ \\forall i \\in \\mathcal{A}\\}$ its correct target. Let $h : (\\mathcal{X}, \\mathcal{M}) \\rightarrow \\hat{\\mathcal{Y}}$ be a graph neural network that outputs a regression value $\\hat{h} = \\{\\hat{h}_i \\in \\mathbb{R}^{n_i \\times t_i} \\ \\forall i \\in \\mathcal{A}\\}$, and $g : (\\mathcal{X},\\mathcal{M}) \\rightarrow \\hat{\\mathcal{y}}$ an oracle that outputs the ground truth value using traditional exact solvers (e.g., Newton Raphson).\nLet $\\Delta$ be the space of allowed perturbations. We define a $(\\Delta, \\mu)$-robust model h to be any model (e.g. GNN) that satisfies\n\\[\\forall \\delta \\in \\Delta : ||h(\\mathcal{X} + \\delta) - g(\\mathcal{X} + \\delta))||_p \\leq \\mu,\\]\nwhere $||.||_p$ is a defined distance (e.g. an Lp-normed distance) and $\\mu$ is an acceptable error threshold.\nIn image classification, the set $\\Delta$ is typically chosen as the perturbations within some Lp-ball around $\\mathcal{X}$, that is, $\\Delta_p = \\{\\delta \\in \\mathbb{R}^d, ||\\delta||_p \\leq \\epsilon\\}$ for a maximum perturbation threshold $\\epsilon$.\nPower grid data are by nature different from images. Each feature $X_{ij} \\in \\mathcal{X}_i$ of the graph represents a physical property (e.g., line resistances, length, etc.) or a smart meter measurement (e.g. load's active power). Thus, $X_{ij}$ has to respect physical constraints to be valid.\nA minimal requirement is to respect the boundary con-straints of each feature, and a sufficient requirement is that the perfect solver converges to a solution when optimizing the perturbed Pf or OPF problem. In practice, traditional solvers are not perfect and are dependent on their hyper-parameters (threshold, budget, ...), however, we assume that our oracle solver is perfect. A robust GNN is then defined as follows:\n\\[\\forall \\delta \\quad g(\\mathcal{X}+\\delta) converges \\rightarrow ||h(\\mathcal{X}+\\delta)-g(\\mathcal{X}+\\delta))||_p \\leq \\mu\\]\na) Threat Model: Within the Power Grid operations problems outlined above, a critical concern is the threat of unexpected grid variations during model inference, which compromises the safety of the grids and the integrity of operations of the Transmission System Operator (TSO). To scope our discussion, we assume that the variations are benign, that is, they have not been crafted specifically to hurt the ML system but represent black swans events with major impacts on the grid.\nb) Design Requirements: This paper aims to develop a framework to assess and mitigate the impact of Power Grid perturbations in the context of GNN-based powerflow and optimal power flow problems. Our method should be suitable for the Power Grid scenario that realistically poses major threats to the grid's optimal operation. Specifically, our design requirements are as follows.\nP1 Energy price variations: Each generator i has a polynomial generation cost function as follows: $c(P_i^g) = c_0 + c_1 P_i^g+c_2 (P_i^g)^2$, where $c_0$ is the offset active power cost, $C_1$ the linear cost per Mvar and $c_2$ the quadratic cost per MW. For each studied grid, we only vary the linear cost $c_1$, and never consider switching off completely a generator.\nThe cost parameters only impact the optimization of the OPF problem and are ignored for the PF problem.\nP2 Load variations: Each consumer is defined by its load active power $P_l$ and reactive power $Q_l$. While the training data uses a time series of real world consumptions, a robust model should generalize to extreme variations of loads for sub-parts or the entirety of the graph. We model these variation with a multipliper sampled from a uniform distribution. The distribution of this multiplier and the percentage of affected loads within the the grid reflect the severity of the perturbation.\nP3 Line outage: A line outage refers to the loss or failure of a transmission line within an electrical power system. Transmission lines are vital for carrying electricity from power plants to substations and, eventually, to consumers. When a line goes out of service due to a fault, maintenance, or any other reason, it can have several starting with the redistribution of loads that requires power flow change, to possible cascad-ing failures leading up to widespread blackouts. To simulate outages, we evaluate the N-1 reliability criterion. It states that the power system must be capable of withstanding the failure of any single component without causing widespread outages. We randomly remove one line of the grid during evaluation and assess the robustness of the GNN on this degraded grid."}, {"title": "IV. SAFEPOWERGRAPH", "content": "We introduce the architecture of our framework in Fig. 1. Our Python API abstracts both Power Systems (PS) and Ma-chine Learning (ML) functionalities for practitioners from both fields. For ML practitioners, SafePowerGraph is a standarized datasets and models zoo with a unified benchmark to evaluate node-level GNN tasks on complex graphs: Constrained hetero-geneous graphs modeling physical equations and a nonlinear minimization problem. For PS practioners, SafePowerGraph is a GNN-powered OPF and PF simulator that supports major PS formats and tools, and achieves precise, robust, and safe predictions. The main features of our API are:\nA. PowerFlow and OPF Simulation\nOur framework supports the most popular Power Grid libraries for full interoperability:\na) PandaPower (PF, OPF): PandaPower [38] is an open-source Python library that provides tools for the mod-eling, analysis, and optimization of electrical power systems. It is built on top of the popular data analysis library pandas, PandaPower and the power flow solver PYPOWER.\nb) MATPOWER (PF, OPF): MATPOWER [44] is an open-source MATLAB package that provides tools for steady-state power system simulations and optimizations. It supports large-scale PF analysis and OPF optimizations.\nc) OpenDSS (PF): OpenDSS (Open Distribution Sys-tem Simulator) [18] is a popular open-source software for simulating electric power distribution systems. In particular, it natively supports unbalanced distribution grid power flow estimations and is highly scalable.\nd) PowerModels (OPF): PowerModels [2] is a Julia/JuMP-based open-source package designed for solving complex power network optimization problems such as OPF, unit commitment and transmission expansion planning. It is highly extensible and scalable to larger grids.\nB. Graph Data Generation\nIn Fig. 3 we summarize how each graph is generated from a power grid. Starting from an initial grid descriptor (in MatPower, PandaPower or PyPower formats), we generate a Pytorch HeteroData with each component as a distinct subgraph (Step (1)). Each node can be of type: bus, load, gen-erator, slack, line, transformer, or capacitor, and is associated with its distinct set of features X6, X1, Xg, X5, Xe, Xt, Xc respectively. These features support perturbations dependant of their types. For example, generators and slack nodes support the mutation of the price features (i.e., the cost of each unit generated) and their maximum generation capacity (Step (2)).\nEach node is also associated with a set of constraints. They can be included during training as regularization losses, or enforced with clamping (e.g. boundary constraints). All features, mutations, and boundary constraints are detailed in the Appendix B-A.\nFor each mutated grid, we run in Step (3) a simulation and solver to obtain the ground truth of the PF or OPF optimization. This solution consists of the active and reactive power of each generator and the slack nodes (Yg, Ys) and the voltage magnitude and angle for each bus node (Y6).\nBuilding large graph datasets across multiple mutations can be expensive. We distribute our datasets in a zoo following the Open Graph Benchmark (OGB) taxonomy [16].\nC. Training\nHeterogeneous graph training supports multiple existing architectures, including GCN, Sage, and GAT. It consists of interleaving the message functions on each node type individually. We present in figure 4 the extension of a standard single node type architecture to two node types (bus and load).\nEach of our models consists of a succession of heteroge-neous graph layers (the backbone), and a set of fully connected layers that outputs the final predictions (head) [28]. Following [11], we extend this standard structure by computing the loss of each node type separately. The splitted loss computations allows to dynamically update the weight (the contribution) of each node type's loss in the backpropagated loss. SafePower-Graph supports weighting strategies because previous research demonstrated that adequate weighting can significantly im-prove the robustness of multitask models [10, 12].\nTraining loss: We incorporate the constraints of the prob-lem in the loss of our GNN as regularization terms. We transform each of the constraints and optimization objectives into a regularization loss. Given a training graph G, its set of node types A, its features X, its associated ground truth prediction y and its predicted output y, the training loss function of our GNN (parametrized by ) becomes:\n\\[\\mathcal{L}(\\Theta) := \\Lambda_b||\\mathcal{Y}_b - \\hat{\\mathcal{Y}}_b||^2 + \\Lambda_s||\\mathcal{Y}_s - \\hat{\\mathcal{Y}}_s||^2 + \\Lambda_g ||\\mathcal{Y}_g - \\hat{\\mathcal{V}}_g ||^2\n+ \\sum_{i\\in A} \\sum_{Y_i \\in \\Omega_b} ctrloss(i, Y_i)\n+ \\Lambda_e \\cdot sslloss (x, y)\n+ \\Lambda_c \\cdot costloss (x_g, y_g, x_s, y_s)\\]\nwhere the first term is the supervised loss over the bus, slack, and generator outputs. The second term captures the weighted constraints violations of the power grid given the set of constraints \u03a9 of each type of node. The third term is the self-supervised loss that solves the equations of the power grid in 1. The last term is the energy cost minimization loss considering the prices of the generators and the slack node.\nOur study in Appendix C-B confirms that optimal solutions in our scenarios require all the losses. Our pretrained models can be downloaded with our API and the results are available on a public, easy-to-use benchmark available on https://github .com/yamizi/SafePowerGraph.\nD. Quantitative Evaluations\nIn our evaluation, by default, we report three errors:\nSupervised error. We provide the normalized square error for predicted variables for each type of nodes averaged across all the nodes of this type per grid. For example, the reported MSE for generators in a 9-bus grid is averaged over the two generators of this grid. The final results is the average self-supervised error across all the validation grids.\nSelf-supervised error. We report the violations to the powerflow equations as an MSE over all the buses of the grid. The final results is the average self-supervised error across all the validation grids.\nBoundary errors. Given a violation threshold, for each node we consider all the boundary violations as binary. A graph is considered 'valid' if it has no violation. The final results is the percentage of invalid graphs in amonth the validation graphs.\nE. Qualitative Evaluations\nOur framework supports an in-depth analysis of the grid and the behavior of individual lines, buses, and constraints.\nConstraints Evaluation: The framework records individ-ual violations for powerflow and boundary constraints. They are stored in dataframe format for individual visualizations and analyses of the buses, the generators, the slack nodes.\nLoading Visualization: The framework allows the visual-ization of the the bus and line loading for solutions computed by a mathematical solver and by GNN. Buses are expected to have voltages under 1.0 per unit (pu) ideally, and at worst 1.1 pu. Line loading is ideally under 80%, and dangerous over 100%. Overloaded lines can lead to outages and have cascading effects. Our framework record these metrics and provides a simple visualisations by leveraging Pandapower [38] plotting API for all simulators and GNN.\nF. Other components\nSafePowerGraph integrates RAY parallelization to mutate and generate embeddings for thousands of graphs seamlessly. The calls to solvers are also parallelized in CPU and the train-ing leverages GPU parallelization. The framework supports natively experiment trackers such as Comet and WandB."}, {"title": "V. BENCHMARKING GNN FOR POWER GRIDS", "content": "We focus the empirical study on the harder OPF problem, and defer some results for the PF problem to the Appendix B.\nA. Experimental Settings\nPower grid topologies: We evaluate three commonly used topologies: WSCC 9-Bus system, IEEE 30-Bus system, and IEEE 118-Bus system. The first case represents a simple system with 9 buses, 3 generators, and 3 loads. The IEEE test cases represent an approximation of the American Electric Power system. The IEEE 30-Bus system has 30 buses, 5 generators, and 24 loads, and IEEE 118-bus has 118 buses, 19 generators, 35 synchronous condensers, 177 lines, 9 trans-formers, and 91 loads.\nPower grid mutations: For each experiment, we generate 1000 valid mutants (that is, for which the solver converged to a solution). We generate 800 training graphs using load variations from a real-world timeseries, and 200 test graphs are generated following different perturbation scenarios. The initial scenario is an In-Distribution mutation, where the loads are mutated following the same distribution of the training set (while ensuring no data leakage between train and test). We refer to this scenario as ID. For the second scenario (line outage), we randomly disconnect one line from the grid. In the last scenario, we randomly mutate the price of production of individual generator within the original generator price boundaries. We refer to this last scenario as Price variation.\nGNN architectures: We evaluated three GNN layer ar-chitectures: Graph Convolution (cgn), SageConv (sage), and Graph Attention (gat). We use two layers and run a hyperpa-rameter search on the number of features and hyperparameters of the layers (with 20% cross-validation). In evaluation we report the best performing model for each architecture.\nAfter the two graph layers, each model is composed of two fully connected layers with 128 features each. The output of the models depends on the size of the grid and is of size 2x (Nbus + Ngenerators + 1) to learn a regression task for the OPF solutions.\nEvaluation Metrics For the quantitative study, we report the supervised normalized MSE for the active and reactive powers of the generators and the slack node, and for the voltage magnitude and angle of the buses. We refer to them as Pgen, Qgen, Pslack, Qslack, and V, 0, respectively. We run our evaluations over three random seeds, report/plot in the main paper the mean values, and report in the appendices the standard deviations.\nFor the qualitative study, we evaluated the boundary con-straints with a tolerance of 10-4 (as they are hard physical constraints, such as the generation capacity), and we used a tolerance of 10-2 for the power flow equations.\nTraining and optimization: We trained all models with the 4x32Gb V100 GPU, for 1000 epochs and batch size of 128. We used Adam optimizer and a multistep learning rate, starting at 0.001 and decaying by 0.5 at epochs \u2208 {500, 750, 875}.\nWe evaluated three weighting strategies to weight i in the loss equation 6. A strategy with equal weights, a strategy with softmax randomized weights at each batch and epoch, and a normalized weight based on the cardinality of each loss term (number of buses, generators, constraints,...) We report an empirical study on the best weighting strategies in Appendix C-C."}, {"title": "B. OPF quantitative evaluation", "content": "Line outages. We report in orange in Fig. 5 the impact of line outages. They have limited impact on the errors of the Powerflow equations compared to the ID setting for 9-bus and 30-bus. The error varies from 6.02\u00d710-7 to 6.42\u00d710-7 in 9-bus and from 4.05\u00d710-9 to 3.84\u00d710-9 in 30-bus.\nLine outages, however, significantly increase the Powerflow equation errors for the larger 118-bus from 2.00\u00d710-6 to 1.38\u00d710-2. Line outages have limited impact on the boundary violation errors across all the grids sizes. The remaining metrics show a moderate increase in error between the ID and line outage scenarios across all grids.\nImpact of price variations. We report in blue in Fig. 5 the impact of price variations. There is a significant error increase in the GNNs predictions across all grid sizes. That is, the error of the reactive power of the slack node increases from 4.67\u00d710-6 to 1.29\u00d710-2 the 9-bus grid, from 1.49\u00d710-7 to 2.94\u00d710-4 for the 30-bus grid and from 1.87\u00d710-4 to 1.19 for the 118-bus grid. Meanwhile, the powerflow error is slightly affected for small grids, but increases significantly in the 118-bus grid, from 2.00\u00d710-6 to 2.52.\nImpact of GNN architecture. We compare in Fig. 6 the performance of three architectures, GCN, SAGE, and GAT over the ID cases, and their robustness to line outages and price variations. Across all sizes, scenarios and metrics, GAT is the best performing architecture. Across all scenarios, SAGE layers lead to the highest error in 15/18 metrics and 13/18 met-rics for the 30-bus grids and the 9-bus grids respectively. For the large 118-bus grid, GCN is however the worst performing architecture for 16/18 metrics.\nImpact of self-supervised learning. We compare in Table III the performance of the best OPF GNN models with super-vised learning alone and with a combination of supervised and self-supervised learning. We evaluate the ID scenario and the robustness to the"}]}]}