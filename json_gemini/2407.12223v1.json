{"title": "Conditional Quantile Estimation for Uncertain Watch Time in Short-Video Recommendation", "authors": ["Chengzhi lin", "Shuchang Liu", "Chuyuan Wang", "Yongqi Liu"], "abstract": "Within the domain of short video recommendation, predicting users' watch time is a critical but challenging task. Prevailing deterministic solutions obtain accurate debiased statistical models, yet they neglect the intrinsic uncertainty inherent in user environments. In our observation, we found that this uncertainty could potentially limit these methods' accuracy in watch-time prediction on our online platform, despite that we have employed numerous features and complex network architectures. Consequently, we believe that a better solution is to model the conditional distribution of this uncertain watch time.\nIn this paper, we introduce a novel estimation technique-Conditional Quantile Estimation (CQE), which utilizes quantile regression to capture the nuanced distribution of watch time. The learned distribution accounts for the stochastic nature of users, thereby it provides a more accurate and robust estimation. In addition, we also design several strategies to enhance the quantile prediction including conditional expectation, conservative estimation, and dynamic quantile combination. We verify the effectiveness of our method through extensive offline evaluations using public datasets as well as deployment in a real-world video application with over 300 million daily active users.", "sections": [{"title": "1 INTRODUCTION", "content": "The rapid growth of online video platforms has significantly changed the way users consume digital content, with short videos emerging as an increasingly popular format [3, 9, 10, 23]. These platforms rely on recommendation systems to curate personalized content that aligns with users' interests, thereby enhancing user engagement and satisfaction. Different from indicators like click-through-rate and ratings that are widely used in conventional recommendation problems (e.g. e-commerce and news recommendation), a critical metric for measuring the engagement/interest in video recommendation is the watch-time, which is a dense and nuanced signal that reflects the amount of time a user spends on a particular video. Additionally, an accurate watch-time prediction would also help augmenting the ranking models and benefit the video recommendation. Nevertheless, accurately predicting the watch-time presents a formidable challenge due to the complex and dynamic nature of user-video interaction.\nGenerally, one can formulate the watch-time prediction problem as a regression task. Existing solutions learn a deterministic predictor [16, 20], which have shown that the watch-time not only depends on the user's interest but is also related to non-interest factors like the full video's duration. Despite their effectiveness, the inherent uncertainty in user interactions are not modeled, which potentially limit their accuracy and robustness. For example, a user would watch the entire video of interest in normal cases but may skip the video if he/she is caught up by something else outside the online service. As a solution, some work proposes to model the watch-time as a random variable [8, 21, 22] by assuming a Gaussian, mixture of Gaussian or Categorical distribution, and include a variance estimation that represents how confident the output watch-time is. This approach turns out to be more robust against user's uncertain behaviors than a deterministic point estimator, and is able to generate more accurate predictions and recommendations. Even though, this strategy inevitably depends on the validity of the pre-defined distribution, which might over-simplify or mismatch the real-world user behavior.\nIn this paper, we aim to achieve a more nuanced approach to watch-time prediction that overcomes the aforementioned limitations, and introduce our Conditional Quantile Estimation (CQE)"}, {"title": "2 RELATED WORK", "content": "2.1 Video Recommendation and Watch-time Prediction\nVideo recommendation systems have evolved to cater to the growing demand for personalized content delivery. With the advent of online video platforms like YouTube and TikTok, the importance of accurate video recommendation has been underscored by the significant impact on user retention and satisfaction [3, 9, 10, 16, 23]. In the realm of video recommendation systems, accurately predicting user engagement through watch time is a critical challenge. Watch time serves as a key metric for gauging user interest and engagement with recommended videos. The initial study [2] centered on enhancing video recommendations for the YouTube platform, introducing the Weighted Logistic Regression (WLR) technique for predicting watch time. This approach has since been recognized as an advanced method in its field. Nevertheless, the WLR's applicability is not straightforward to full-screen video recommendation systems, and it could encounter significant bias problems attributable to its weighted calculation system. D2Q [20] mitigates the duration bias through the implementation of backdoor adjustments and modeling the watch-time quantile under different duration groups. D\u00b2Co [21] tackles the problem of bias in video recommendation watch times by using a model that corrects for both duration bias and noisy watching, providing a more accurate measure of user interest. DVR [22] introduces a novel metric called WTG (Watch Time Gain) and employs adversarial learning to learn unbiased user preferences. Our method can be seamlessly integrated into a wide array of duration debiased methods, thereby significantly improving their predictive accuracy. TPM [8] breaks down the task into a series of interconnected classification problems arranged in a tree-like structure. Although TPM considers watch-time variance, it does not capture the full breadth of the watch-time distribution as our method does.\nThe watch-time prediction task also faces the critical problem of duration bias [8, 20-22]. This bias indicates that users prefer to spend more time watching longer-duration videos, skewing the average watch time in favor of longer content. Such a preference for duration over shorter alternatives complicates the task of accurately predicting user engagement. Our methodology integrates seamlessly with most duration debiasing methods, significantly improving their predictive ability.\n2.2 Quantile Regression\nQuantile regression is a type of regression analysis widely used in statistics, econometrics, and ecology [7]. Unlike traditional mean/linear regression-which focuses on estimating the average outcome, quantile regression seeks to estimate the conditional median and other quantiles of the random variable. This flexible feature provides a more comprehensive understanding of the variable's distributional effects that mean regression may overlook[1, 18, 19]. In the context of machine learning, quantile regression has been extended beyond linear models. Representative approaches [13, 14, 17] integrate quantile regression into neural networks, offering means to forecast conditional quantiles in non-linear and high-dimensional settings. QRF [11] further deploys quantile regression within random forests, further exemplifying its adaptability and the enhancement of predictive capabilities across diverse models.\nThe presented solution in this paper intends to integrate the principles of quantile regression into the domain of video recommendation systems. By adapting this statistical approach to account for the uncertainty and variability in watch time, we propose a novel application that enhances the predictive performance of recommendation systems. This advancement promotes a more nuanced understanding of user engagement, driving toward more personalized and satisfactory user experiences."}, {"title": "3 METHOD", "content": "3.1 Problem Formulation\nThe objective of the recommender system is intrinsically a predictive task, where we aim to estimate the degree of a user's engagement with the recommended content. In the video recommendation scenario, this engagement is mainly estimated by the user's watch-time-the time a user spends watching the video. Formally, we represent each user-video pair as (u, v), and assume a pre-defined mapping function that extracts an n-dimensional feature vector\nx = \u03c8(u, v) \u2208 Rn. These features encompass contextual information, video characteristics, user profile attributes, and the user's historical interaction data. Considering the user's watch-time as a random variable W, the goal is to estimate the probability distribution of W.\n3.2 Conditional Quantile Estimation\nPrevious research simplifies the problem by assuming that the conditional watch-time follows a Gaussian, mixed Gaussian or Categorical distribution [8, 21, 22]. Yet, the user's behavior might be far more complicated as we have discussed in 1. In contrast, we aim to learn the quantiles of the watch-time without making any assumption about the underlying distribution. Formally, we define a set of N quantiles \u03c41, \u03c42, ..., \u03c4N \u2208 (0, 1) that we are interested in. For example, \u03c4 = 0.5 corresponds to the median, while \u03c4 = 0.1 and \u03c4 = 0.9 correspond to the lower and upper tails of the distribution, respectively. As a special case, when adopting even separation, we have \u03c4i = i/(N + 1). Rather than giving a point estimation of the expected watch-time, we construct a conditional quantile estimation function \u03a6(t\u03c4\u2081,..., ttx) to infer the corresponding watch-time value tr\u2081 for each of the quantile ti, given the input x. To ensure the values of {tri}N\u2081 are ordered, we will first have the model output N non-negative elements, and then {tr\u2081}~\u2081 will be the cumulative sum of these elements. As shown in Figure 1, these output watch-time values exemplify the watch-time distribution, where output quantile values are closer to each other in areas with higher likelihood. This provides richer information about the user behavior, especially for extreme values like very high or very low watch-times.\nDuring training, an ideal solution would sample the watch-time for multiple rounds until sufficient samples are observed for accurate approximation of all N quantiles. However, this is impractical since we cannot require the user to repeatedly watch the same video under identical conditions. To solve this problem, we minimize the pinball loss that penalizes the deviation between the quantile estimates and the actual observed values [7]. For an individual \u03c4i, the loss function is defined as\nLr(y, tri) = { \u03c4i(y - tri) if y \u2265 tri \n(1 \u2212 \u03c4\u03af) (tr\u2081 \u2212y) otherwise (1)\nwhere y is the actual watch-time. And for each sample (x, y), we minimize the aggregated quantile regression loss:\nLQR = \u2211N i=1 L\u03c4i (y, tri). (2)\nIntuitively, the optimization is slower either when the prediction quantile value tri is close to the ground truth y, or its quantile is far from y. This would help learning more accurate approximations for quantiles closer to y, and avoid misguidance to quantiles on the other side of the distribution.\nWithout specification, we denote our solution framework as Conditional Quantile Estimation (CQE) for the rest of the paper. Through this method, we can construct a broad spectrum of predictions that allows us to reliably infer the distribution of user watch-time. This more complete understanding of the distribution of watch times potentially improves the precision of the estimation and enhance the performance of recommendation systems as a whole. As we will illustrate in the next section, it also provides a solid foundation for the flexible design of personalized recommendation strategies during inference. Though not the focus of this paper, this estimation can extend to adjust for duration bias or capture user interest inherent in the observed watch-time as in existing works [21, 22].\n3.3 Inference with Expanded Strategies\nOnce we have estimated the quantiles of the distribution tr\u2081,...,N, we can design a suitable quantile combination strategy for the watch-time inference.\n3.3.1 Conditional Expectation. The most intuitive strategy is recovering the mean estimation through the conditional expectation. One challenge of this strategy is that we do not have the output value for \u03c4\u2208 (\u03c4i, Ti+1) between any two consecutive quantiles. To circumvent this lack of information, we can use the interpolation method to approximate the conditional distribution. In practice, we adopt a linear interpolation between consecutive quantiles so the expected watch-time between ti and ti+1 becomes (tri + tti+1)/2(N + 1). For the two endpoints, we assume t0 = tr\u2081 and tN = ttN. Then, we can approximate the overall watch-time expectation as:\nE[W|x] ~ 1 \n2(N + 1)[(tr\u2081 + tr\u2081) + (tr\u2081 + tt2) ++(tr\u2082 + tt3)...\n+(tTN-2 + TN-1) + (tTN-1 + ttn) + (tIN + IN)]\n= 1\nN+1 \u2211N i=1 tri + \u03c41 + \u03c4N\n2(N + 1) (3)\nTheoretically, this expectation gives the most accurate prediction in general and it would achieve the optimal prediction when N \u2192 \u221e. Empirically, we will verify its superiority with our experimental analysis in section 4. Yet, we remind readers that this strategy may not be well-suited for scenarios where users are not tolerant of bad recommendations or the recommender system requires dynamic controls. Fortunately, the proposed CQE is a flexible framework that provides sufficient freedom on how a strategy would combine different quantile outputs.\n3.3.2 Conservative Estimations. In environments with implicit uncertainty, especially online platforms where users are sensitive to bad recommendations, conservative estimation stands as a pivotal strategy. For example, a video with high average watch-time may actually being polarized towards 0s and 1s in its watch-time distribution, so the expectation is no longer representative in this case. Adopting a conservative approach in video recommendations means that we should favor a quantile that reveals the underestimated watch-time scenarios, in contrast with an optimistic approach that selects overestimated watch-time. Consequently, the inferred watch-time is likely to be exceeded by the actual user behavior and the recommendation ensures that the lower bounded watch-time is still satisfactory.\nFormally, for a user-video pair, we focus on the lower quantiles of the expectation Eq.(3) and select one of the quantile tlow as the inference. In practice, tlow may be set to reflect our degree of risk aversion. For instance, a tlow of 0.25 could be used if we wish to ensure that the actual watch-time exceeds the predicted time at least 75% of the time. It is more cautious than using the median and enables a recommendation strategy that systematically avoids user disappointment due to overly optimistic estimates.\n3.3.3 Dynamic Quantile Combination. Intuitively, user engagement is a multifaceted behavior influenced by the interplay of various user-specific and content-specific factors, which results in the different propensity towards longer or shorter watch-time. Following this ever-changing nature of user interest and platform content, we also designed a dynamic quantile combination (DQC) strategy that allows the system to control the combination between the higher and lower quantile. Specifically, we use a blending parameter k that is carefully designed to encode the live feedback and activity level of users, as well as the novelty and diversity of the recommended content. Then the combined score sdyn is computed as a weighted average of lower and upper quantile predictions:\nsdyn = ttlow . k + tthigh \u00b7 (1 \u2013 k). (4)\nwhere tlow represent a conservative quantile prediction and thigh corresponds to a more optimistic one. The blending parameter k is thus a tuning knob that focuses the recommendation's strategy between these two bounds."}, {"title": "4 EXPERIMENTS AND RESULTS", "content": "We conduct extensive experiments in both offline and online environments to demonstrate the effectiveness of CQE. Three research questions are investigated in the experiments:\n\u2022 How do Conditional Expectation (CDE) of Conditional Quantile Estimation (CQE) compare with the state-of-the-art methods in terms of predicting user interest and watch time with regard to recommendation accuracy?\n\u2022 What is the impact of the number of quantiles on the performance of CQE-CED?\n4.1 Offline Experiments\nOur offline experiments were designed in line with two existing research settings. The first focused directly on watch-time prediction as proposed by TPM [8]. The second aimed at predicting user interest through duration bias adjustment as D\u00b2Co[21].\n4.1.1 Watch-Time Prediction. In this problem scope, our primary objective is to predict the watch-time. We employed the same training methodology as referred to in the TPM code.\nDatasets. Following TPM, we used two public datasets: Kuaishou (collected from Kuaishou App\u00b9) and CIKM16 (from CIKM16 Cup 2) for our experiments. CIKM16 aims to predict the dwell time for each session in online search results. Each item in the session is used as a single feature for input. Kuaishou dataset contains 7,176 users, 10,728 items, and 12,530,806 impressions; and CIKM16 dataset contains 310,302 sessions, and 122,991 items and the average length of each session is 3.981.\nMetrics. We used two metrics to evaluate the model's performance: Mean Average Error (MAE) and XAUC[20].\n\u2022 MAE: This metric is a typical measurement for evaluating regression accuracy. Denote the prediction as \u0177 and the true watch time as y,\nMAE = 1\nN \u2211N i=1 |\u0177i \u2212 yi| (5)\n\u2022 XAUC: this metric evaluates if the predictions of two samples are in the same order with their true watch time. Such pairs are uniformly sampled and the percentile of samples that are correctly ordered by predictions is XAUC.\nBaselines. Four state-of-the-art methods for watch time prediction were selected for comparison, including WLR(Weighted Logistic Regression) [2], D2Q(Duration-Deconfounded Quantile) [20], OR(Ordinal Regression) [12] and TPM(Tree-based Progressive regression Model) [8]. The first three methods are deterministic, while the latter introduces an element of uncertainty, offering both an estimate of the mean and the variance.\n4.1.2 User Interest Prediction. In this context, the training label is based on the transformation of watch time and duration, whereas the testing label is the user interest indicator defined as long_view. Following D\u00b2Co [21], in detail, it defines the user interest for a given user-video pair (u, v) as:\nx = { 1, if (d\u2264 18s and w = d) or (d > 18s and w > 18s);\n0, otherwise; (6)\nwhere d is video duration and w is watch-time. We adopted the same training configuration as D2Co and used the classical deep recommendation model DeepFM [5] and the state-of-the-art recommendation model AutoInt [15] as our backbone recommendation model.\nLCE = -r log[\u03c3(f(x))] \u2013 (1 - r) log[1 \u2013 \u03c3(f(x)), (7)\n4.1.3 Experimental Results. We summarize the results as follows:\nComparison between CDE-CQE and other methods: We compared the performances of different approaches in the watch-time prediction task, and the results are listed in Table 2. Both TPM and CDE-CQE outperform other methods in both MAE and XAUC metrics, thereby highlighting the significance of incorporating uncertainty into the models. Furthermore, our approach demonstrates superior performance on both metrics compared to TPM, thereby\nemphasizing the advantages of employing quantile modeling techniques. Additionally, the consistent behavior between MAE and XAUC metrics also verifies the feasibility of the watch-time estimation serving as ranking metrics. As for the user interest prediction task, we compare different frameworks across backbone models (DeepFM and AutoInt) and various label designs (PCR, WTG, and D2Co) and present the results in Table 1, our proposed CDE-CQE consistently outmatches the alternatives in all cases, indicating the robustness and effectiveness of CDE-CQE. In terms of the optimization framework, CE generally performs better than MSE, indicating the correctness of including the ordinal categorical information as guidance. And CDE-CQE can improve over CE across all the designs of user interest metrics (PCR, WTG, and D\u00b2Co), which means that the proposed framework is generalizable to different label settings.\nThe Effect of Hyper-Parameters in CDE-CQE: To better investigate the characteristics of the proposed CQE framework, we further conduct an ablation study on the number of quantiles N by varying its value from 1 to 500. Theoretically, larger N generates a more accurate approximation of the truth expectation and in turn achieves better recommendation performance in general. This is attributed to the fact that more quantiles yield a distribution that closely mirrors the actual one. In the context of the watch time prediction task, as evidenced by Figure 2, the model performance improves with an increase in predicted quantiles. In contrast, for the user interest prediction task, it was observed (shown in 3) that model performance was relatively weak when the number of quantiles was under 10. Beyond 10, the results oscillated around 0.663. Interestingly, unlike the watch time prediction task, more quantiles did not necessarily lead to better results. This discrepancy suggests that there is a gap between the training objective and the user interest label as defined in the testing set. In practice, another critical issue that may hinder the employment of large N is the trade-off between the marginal accuracy improvement and the linearly increased computational cost. In general, increasing N would potentially improve the prediction accuracy under the Conditional Expectation strategy, but there may exists several bottlenecks that potentially limit the performance: 1) the design of the target label; 2) the data characteristics; and 3) the computational concerns.\n4.2 Online Experiments\nTo validate the real-world impact of our Conditional Quantile Estimation (CQE) framework, we conducted extensive online A/B tests on the KuaiShou platform, which serves over 300 million daily active users. These experiments allowed us to assess the practical effectiveness of all three CQE strategies in a live environment with a substantial user base.\n4.2.1 Experiment Setup. Users were randomly assigned to control and experimental groups, with a minimum of 10% of daily user traffic allocated to the experimental group to ensure statistical significance. Each online A/B test ran for over a week, providing ample time for data collection and reliable result analysis.\nThe recommendation system operates in a two-stage process: candidate retrieval followed by ranking. We incorporated the CQE model into the ranking stage to predict watch time, a crucial component of the recommendation process.\n4.2.2 Experiment Results. Table ?? and Table ?? summarize the performance of the CQE strategies relative to the baseline across all four metrics:\nConditional Expectation (CDE): The CDE methodology demonstrated a statistically significant increase of 0.165% in the \"Average Watch Time per User\" metric. However, it showed a slight decrease of 0.088% in \"Total Play Count\". This suggests that CDE effectively increased the depth of user engagement with individual videos, albeit at the cost of slightly reduced breadth of interaction."}, {"title": "5 CONCLUSION", "content": "In this paper, we introduce CQE (Conditional Quantile Estimation), a novel approach to modeling the conditional distribution of uncertain watch time in short video recommendation systems. By leveraging quantile regression, CQE captures the inherent uncertainty and variability in user behavior, providing a more accurate and robust estimation of user engagement. Furthermore, we introduce innovative strategies for integrating the CQE model into existing recommendation systems, including CDE (Conditional Expectation), CSE (Conservative Estimation), and DQC (Dynamic Quantile Combination). These strategies leverage the estimated watch time distribution to enhance user satisfaction and engagement through personalized recommendations. Through extensive offline evaluations on public datasets and a real-world deployment on a platform with over 300 million daily active users, we demonstrated the superior performance of CQE compared to state-of-the-art methods."}]}