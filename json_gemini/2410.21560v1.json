{"title": "Going Beyond H&E and Oncology: How Do Histopathology Foundation Models Perform for Multi-stain IHC and Immunology?", "authors": ["Amaya Gallagher-Syed", "Elena Pontarini", "Myles J. Lewis", "Michael R. Barnes", "Gregory Slabaugh"], "abstract": "This study evaluates the generalisation capabilities of state-of-the-art histopathology foundation models on out-of-distribution (OOD) multi-stain autoimmune Immunohistochemistry (IHC) datasets. We compare 13 feature extractor models, including ImageNet-pretrained networks, and histopathology foundation models trained on both public and proprietary data, on Rheumatoid Arthritis (RA) subtyping and Sjogren's Disease (SD) diagnostic tasks. Using a simple Attention-Based Multiple Instance Learning classifier, we assess the transferability of learned representations from cancer H&E images to autoimmune IHC images. Contrary to expectations, histopathology-pretrained models did not significantly outperform ImageNet-pretrained models. Furthermore, there was evidence of both autoimmune feature misinterpretation and biased feature importance. Our findings highlight the challenges in transferring knowledge from cancer to autoimmune histopathology and emphasise the need for careful evaluation of AI models across diverse histopathological tasks. The code to run this benchmark is available at https://github.com/AmayaGS/ImmunoHistoBench", "sections": [{"title": "Introduction", "content": "Recent advancements in digital pathology have led to the development of powerful foundation models trained on large-scale H&E cancer datasets [2, 18, 26, 24, 6, 11, 22]. These models have shown remarkable performance in various cancer-related tasks [1, 14, 6, 2, 26, 18]. However, their ability to generalise to other histopathological domains, particularly immunohistochemistry (IHC) staining and autoimmune diseases, remains largely unexplored. This gap is particularly significant given the fundamental differences between cancer and autoimmune pathologies. Indeed, cancer and autoimmune diseases represent two ends of the immune spectrum, with distinct histopathological features reflecting their underlying pathogenesis [19]. In cancer, the immune response is often suppressed or evaded, leading to uncontrolled growth of malignant cells [15]. Conversely, autoimmune diseases are characterised by an overactive immune response against self-tissues [16]. These fundamental differences manifest in contrasting histopathological patterns, aspects of which we exemplify in Figure 1."}, {"title": "H&E and IHC provide complementary, yet contrasting information", "content": "H&E staining, a traditional and widely used technique, offers a broad view of tissue architecture and cellular morphology. Hematoxylin stains cell nuclei a deep blue-purple, while eosin stains cytoplasm and extracellular matrix in shades of pink (see Fig.1 D). In contrast, IHC is a more specialised technique that uses antibodies tagged with visual markers to identify specific proteins or antigens within tissue samples, allowing for precise localisation and visualisation of immune cell population (see Fig.1 A-C). In cancer diagnostics, H&E staining remains the foundation for initial assessment and general diagnosis. However, IHC plays a crucial role in tumour classification, prognosis determination, and treatment selection by pinpointing specific cancer markers and assessing treatment responsiveness indicators. For autoimmune diseases, while H&E staining identifies general patterns of inflammation and tissue damage, IHC becomes essential for a more nuanced understanding of the disease process. It highlights the types of immune cells present in inflammatory infiltrates, detects autoantibody deposits, and visualises specific autoantigens targeted by the immune system."}, {"title": "Cancer and Autoimmunity: two sides of the immune coin", "content": "The immune cell composition and organisation differ significantly between cancer and autoimmune conditions, reflecting their distinct pathogenic mechanisms. In H&E-stained cancer samples, one typically observes striking alterations in cellular and tissue architecture. Cancer cells exhibit uncontrolled proliferation, leading to disorganised growth patterns and invasion into surrounding tissues. These cells often display abnormal morphology, including enlarged nuclei with irregular shapes and altered nuclear-to-cytoplasmic ratios (Fig.1 D1). Furthermore, the immune landscape in cancers forming solid tumours is often characterized by an immunosuppressive tumour microenvironment (TME) that dampens the immune response, allowing cancer cells to evade destruction (Fig.1 A-B). Conversely, autoimmune pathology is characterized by dense inflammatory cell infiltrates, such as Ectopic Lymphoid Structure (ELS), composed of immune cells such as lymphocytes, plasma cells, and macrophages (Fig.1 C1/2) [15, 17, 19, 5]. As shown in Figure 1, these marked differences are reflected in often opposing patterns, with patterns which can indicate a good prognosis in cancer, often indicating a poor one in autoimmune pathologies."}, {"title": "Why does autoimmunity matter?", "content": "These contrasting histopathological patterns reflect the underlying immunological processes at play in cancer and autoimmune diseases, providing valuable insights into their pathogenesis and potential therapeutic approaches. The intersection of autoimmunity and cancer research offers a rich landscape for knowledge discovery and therapeutic innovation. While these conditions represent opposite ends of the immune dysfunction spectrum, insights from one field often inform the other [15]. For instance, the study of immune checkpoints, originally investigated in autoimmunity, has revolutionised cancer immunotherapy [20]. The presence of ELS structures, typically associated with autoimmunity, has also been linked to improved prognosis in some cancers, highlighting the complex role of immune organisation in disease outcomes [17, 27]. In turn, understanding how cancers evade immune surveillance provides clues about regulating overactive immune responses in autoimmune diseases. Importantly, knowledge gained from treating autoimmune conditions helps manage immune-related adverse events in cancer immunotherapy. This bidirectional flow of insights not only deepens our understanding of immune system dynamics but also paves the way for more nuanced and effective treatments in both cancer and autoimmune diseases. In the decades to come, novel treatment combinations and newly identified druggable targets will only expand the role of immunotherapy in the treatment of cancer and vice versa [23]."}, {"title": "Challenges for H&E generalisation", "content": "The distinct pathogenic mechanisms, immune responses, and tissue alterations in cancer versus autoimmune diseases result in characteristically different histopathological patterns that reflect their underlying biology. Histopathology foundation models trained primarily on cancer-related H&E data might face certain challenges when applied to autoimmune conditions and IHC analysis. We outline some potential pitfalls:\n1. Misinterpretation of unique autoimmune features: these models may fail to recognise or correctly interpret distinctive autoimmune patterns, such as ELSs or specific inflammatory infiltrates, leading to potential misdiagnosis.\n2. Difficulty with complex IHC staining patterns: The diverse and intricate staining patterns in IHC, especially in autoimmune diseases, could prove challenging for models trained mainly on H&E images, resulting in inaccurate interpretation of immune cell interactions and signalling molecules.\n3. Bias in feature importance: These models might inappropriately recognise cancer-related features (e.g., nuclear atypia, TMEs) when analysing autoimmune conditions, potentially skewing diagnosis or disease severity assessment."}, {"title": "Contribution", "content": "This study aims to assess the generalisation capabilities of state-of-the-art histopathology foundation models on out-of-distribution (OOD) multi-stain autoimmune datasets. We compare their performance against traditional ImageNet pretrained feature extraction models using simple Attention-Based Multiple Instance Learning algorithm (ABMIL) [10]. This straightforward, zero-shot approach allows us to directly evaluate the transferability of learned representations from cancer H&E images to autoimmune IHC images without the confounding effects of complex downstream tasks. It serves as an initial step to understanding if cancer-trained models can capture relevant features in autoimmune tissues, despite differences in disease processes and staining techniques.\nBy bridging the gap between cancer and autoimmune histopathology, this report aims to contribute to the broader goal of developing more comprehensive and versatile AI tools for medical image analysis, ultimately supporting advancements in precision medicine and improved patient care across a wider spectrum of immune-mediated diseases."}, {"title": "Methodology", "content": ""}, {"title": "Pipeline", "content": "Figure 2 illustrates our analytical pipeline. The input comprises a set of multi-stain Whole Slide Images (WSIs) per patient, including H&E and various IHC stains listed in Table 1. We apply adaptive thresholding to identify tissue areas and extract 224x224 pixel non-overlapping patches. These patches are then processed through a feature extractor network, generating a matrix of feature vectors representing each patient's WSI set. For downstream classification, we employ the Attention-Based Multiple Instance Learning (ABMIL) [10] algorithm, chosen for its simplicity and strong benchmark performance. Notably, this study concentrates on comparing different feature extraction techniques within this framework."}, {"title": "Datasets", "content": "To provide a benchmark on autoimmune multi-stain datasets, we use two clinical datasets. One dataset derives from the clinical trial R4RA [9], where patients with difficult to treat Rheumatoid Arthritis (RA) were recruited for treatment with rituximab [13]. The other derives from the routine diagnostic of patients presenting with dry eyes and mouth (sicca) and investigated for Sjogren's Disease (SD). Each dataset is composed of H&E slides, with approximately 3 IHC slides of different immune biomarkers per patient. In Table 1, we give further information on the stains present in each dataset."}, {"title": "Rheumatoid Arthritis", "content": "This clinical trial dataset comprises 607 Whole Slide Images (WSIs) from 153 Rheumatoid Arthritis patients, categorised into low (N=66) and high (N=87) inflammatory subtypes [9]. As exemplified in"}, {"title": "Sjogren", "content": "Diagnostic dataset consisting of 347 WSIs of labial salivary gland biopsies sampled from 93 patients, with 46 cases of non-specific sicca and 47 cases of Sjogren's Disease (SD). As shown in Figure 4 the samples were stained with H&E and the IHC stains CD20+ B cells, CD3+ T cells, CD21+ follicular dendritic cell network and CD138+ plasma cells. Each patient has a variable set of multi-stain WSIs, averaging 3.7 stains per patient. We perform binary classification on the detection of sicca vs SD+ biopsies. We extract non-overlapping patches at a 20x magnification, keeping those with over 30% tissue coverage, totalling approximately 237k patches."}, {"title": "Feature Extraction Models", "content": "We evaluate a comprehensive and diverse set of 13 feature extractor models to assess their efficacy on Autoimmune IHC datasets. As detailed in Table 2.3, these models span three distinct categories: 5 general computer vision models pretrained on ImageNet [21, 8, 25, 4], 5 histopathology-specific foundation models trained on publicly available data SSL_ResNet18 [3], SSL_ResNet50 [11], CTransPath [24], Lunit [11] and Phikon-v2 [6], as well as three of the latest, largest models trained on proprietary data UNI, H-Optimus-0 and GigaPath [2, 18, 26]. This selection enables us to systematically compare the performance of generic visual features against domain-specific representations learned from histopathological data. Our analysis encompasses both Convolutional Neural Network (CNN) architectures and Self-Attention (SA) based models, including state-of-the-art Vision Transformers. The models vary significantly in scale, ranging from 11 million to 1.1 billion parameters, and in their pretraining data, from generic image datasets to specialised collections of up to 1.3 billion histopathology image patches."}, {"title": "Implementation Details", "content": "Feature Extraction. In total we extract 26 patient level feature representations for the RA and SD datasets, obtained from each of the 13 feature extraction networks with frozen weights. We maintain the embedding dimension of each feature extraction network. See Appendix 5 for further details.\nExperimental Setup and Evaluation Metrics. We separate a random label stratified 20% hold out test set and perform 5-fold random label stratified cross validation on the remaining data (train:val:test / 60:20:20). Models were trained for a maximum 200 epochs, with a patience set to 15 such that early stopping was called if no change was observed in either the loss, accuracy or AUC score for 15 epochs. Weights were kept for the model obtaining the best accuracy score on each validation set while ensuring there was no under-fitting or over-fitting of the models. Each of the 5 trained model was applied to the hold-out test. We report the mean and standard error (SE) of the results obtained on the hold-out test set for Accuracy, Macro F1-score, Precision, Recall, AUC and Average Precision.\nABMIL. For classification we use the original one-layer ABMIL implementation [10], with input embeddings projected to a hidden layer of dimensions 128 and sigmoid activation function.\nTraining schedule. All models were trained using cross-entropy loss, with the AdamW optimizer set to $\\beta_1 = 0.9$, $\\beta_2 = 0.98$ and $\\epsilon = 10^{-9}$, with a learning rate 1e-5 and weight decay L2 = 0.01. No learning scheduler was used. We conducted an initial search on learning rate (1e-2, 1e-3, 1e-4, 1e-5, settling for le\u00af5 as we observed the smoothest loss on average across models and datasets. Training was conducted on an NVidia A100 GPU (40Gb) [12]."}, {"title": "Results", "content": ""}, {"title": "Rheumatoid Arthritis", "content": "In Figure 5 and Table 3, we show the results of our comparative analysis for RA, with scores organised from most to least performant within each type of model (here labelled as ImageNet, TCGA and Internal for convenience). For each metric, the top three performers are highlighted with a red box."}, {"title": "Sjogren's Disease", "content": "For Sjogren's Disease, Gigapath [26], ConvNext [25] and CTransPath [24] are the top three overall performers. However, as with RA we observe a similar trend of marginal differences between models, with considerable overlap in error bars and no significant differences between top performers for ImageNet vs histopathology pretrained models indicating the learned feature representation extracted from histopathology foundation models are not conferring real downstream benefits for diagnosis or subtyping of autoimmune diseases."}, {"title": "Attention heatmaps highlight misinterpretation and bias in feature importance", "content": "In Figure 7 we show an example of a SD+ set of multi-stain WSIs (H&E, CD3 and CD21), with attention heatmaps obtained from the ABMIL models trained with features extracted from ConvNext (left) and GigaPath (right), the two top performer models for SD. Observing these heatmaps we see clear evidence of the pitfalls mentioned in the introduction: in all three WSIs we see inflammatory aggregates present throughout the tissue being explicitly less attended to by the GigaPath foundation model. This is particularly clear in the H&E stained slide, were for GigaPath we see inflammatory aggregates appear as darker areas of low attention scores in the middle of highly attented areas. In contrast, ConvNext has a more evenly spread out attention map covering areas of immune cell infiltration. In CD3 and CD21, we again see this pattern of more spread out attention covering areas with immune cells in ConvNexT, whereas GigaPath is picking up strongly on areas which appear to bear high level similarities to TMEs, but which are not structures present in autoimmune disease. This is particularly striking in the top 5 patches with highest and lowest attentions scores plotted below each WSIs: GigaPath consistently assigns low attention scores to areas with immune cell populations and high attention scores to tissue with morphologies which bear some resemblance to abnormal cancer cells, while ConvNexT more accurately assigns low attention scores to areas with little tissue coverage or with WSIs artefacts present and higher attention scores to areas with immune cell populations. We further show attention heatmaps for UNI, CTransPath, ResNet50, ssl_ResNet50, Phikon-v2 and H-Optimus-0 in appendix 10 11 12 13 14 15. Notably, UNI, CTransPath, ResNet50 and ssl_ResNet50 show similar attention patterns, with attention scores very focused on aggregates of immune cell populations, whereas H-Optimus-0 and Phikon-v2 align with the patterns seen in GigaPath. This could indicate GigaPath, H-Optimus-0 and Phikon-v2 are focusing more on cancer specific patterns due to their large, highly specialised training corpus and training methodology.\nRecommendation. For researchers working on IHC and non-cancer datasets wishing to use a histopathology foundation model, UNI and CTransPath currently seem to represent a good compromise. However, we recommend caution and careful checking of the features highlighted by different feature extractors.\nLimitations. In this study we have empirically shown there is little to no significant difference in performance between ImageNet and histopathology-pretrained feature extraction networks for autoimmune IHC datasets, as well as clear differences in feature importance and heatmaps obtained by different models. However, we do not pinpoint which differences between backbone, training data and model training are the main contributors to the differences observed."}, {"title": "Conclusion", "content": "Our findings highlight the complexity of transferring knowledge from cancer histopathology to the autoimmune context and underscores the need for careful evaluation of model performance across diverse histopathological tasks, as this will be key for use in clinical practice. We believe future work should focus on incorporating a broader scope of immune-mediated diseases into histopathological foundation models, and handling complex IHC staining patterns to develop more versatile and accurate AI tools for a broader spectrum of diseases.\nBy understanding how the immune system behaves in these different contexts, we can gain deeper insights into immune evasion, surveillance, and modulation. This knowledge not only bridges the gap between cancer biology and immunology but also opens new avenues for disease prevention, diagnosis, and treatment in both fields. Future AI models in digital pathology should be designed to capture and interpret these complex immunological features across different disease states, enhancing our ability to leverage insights from both autoimmunity and cancer research."}, {"title": "Supplemental material", "content": ""}, {"title": "Model feature size & extraction time", "content": ""}, {"title": "Attention heatmaps", "content": "We show higher resolution images for ConvNexT and GigaPath in 8 and 9, as well as further heatmaps for CTransPath and UNI models in 12 and 13."}]}