{"title": "LoRID: Low-Rank Iterative Diffusion for Adversarial Purification", "authors": ["Geigh Zollicoffer", "Minh Vu", "Ben Nebgen", "Juan Castorena", "Boian Alexandrov", "Manish Bhattarai"], "abstract": "This work presents an information-theoretic examination of diffusion-based purification methods, the state-of-the-art adversarial defenses that utilize diffusion models to remove malicious perturbations in adversarial examples. By theoretically characterizing the inherent purification errors associated with the Markov-based diffusion purifications, we introduce LORID, a novel Low-Rank Iterative Diffusion purification method designed to remove adversarial perturbation with low intrinsic purification errors. LoRID centers around a multi-stage purification process that leverages multiple rounds of diffusion-denoising loops at the early time-steps of the diffusion models, and the integration of Tucker decomposition, an extension of matrix factorization, to remove adversarial noise at high-noise regimes. Consequently, LoRID increases the effective diffusion time-steps and overcomes strong adversarial attacks, achieving superior robustness performance in CIFAR-10/100, CelebA-HQ, and ImageNet datasets under both white-box and black-box settings.", "sections": [{"title": "1 Introduction", "content": "Despite their widespread adoption, neural networks are vulnerable to small malicious input perturbations, leading to unpredictable outputs, known as adversarial attacks (Szegedy et al. 2014; Goodfellow, Shlens, and Szegedy 2015). Various defense methods have been developed to protect these models (Qiu et al. 2019), including adversarial training (Madry et al. 2019; Bai et al. 2021; Zhang et al. 2019) and adversarial purification (Salakhutdinov 2015; Shi, Holtz, and Mishne 2021; Song et al. 2018; Nie et al. 2022; Wang et al. 2022, 2023). With the introduction of diffusion models (Ho, Jain, and Abbeel 2020; Song et al. 2021) as a powerful class of generative models, diffusion-based adversarial purifications have overcome training-based methods and achieve state-of-the-art (SOTA) robustness performance (Blau et al. 2022; Wang et al. 2022; Nie et al. 2022; Xiao et al. 2022). In principle, the diffusion-based purification first diffuses the adversarial inputs with Gaussian noises in t time-steps and utilizes the diffusion's denoiser to remove the adversarial perturbations along with the added Gaussian noises. While it is computationally challenging to attack diffusion-based purification due to vanishing/exploding gradient problems, high memory costs, and substantial randomness (Kang, Song, and Li 2024), recent work has been proposing efficient attacks against diffusion-based purification (Nie et al. 2022; Kang, Song, and Li 2024), which can degrade the model robustness significantly. A naive way to prevent such attacks is to increase the diffusion time-step t as it will remarkably raise both the time and memory complexity for the attackers (Kang, Song, and Li 2024). However, increasing t would not only introduces additional computational cost of purification (Nie et al. 2022; Lee and Kim 2023), but also inevitably damages the purified samples (see Theorem 2 or Fig. 3), and significantly degrade the classification accuracy.\nOur work aims to develop a more robust and efficient diffusion-based purification method to counter emerging adversarial attacks. We first introduce an information-theoretic viewpoint on the diffusion-based purification process, in which the purified signal is considered as the recovered signal from a noisy communication channel. Different from the previous purification (Nie et al. 2022) centered on the Score-based diffusion (Song et al. 2021), our work is the first theoretical analysis of the inherent error induced by Markov-based purifications (Blau et al. 2022; Wang et al. 2022; Xiao et al. 2022), which are purifications relying on the Denoising Diffusion Probabilistic Model (DDPM) (Ho, Jain, and Abbeel 2020). Our theoretical foundation for DDPM (Theorem 1, 2 and 3) are essential as they validate the usage of DDPM for purification and leverage its substantial advantage in terms of running time compared to the Score-based (as shown in Table 1). Our analysis further points out an interesting finding: the purification error (Corollary 1) can be reduced significantly by conducting multiple iterations at the early time-steps of the DDPM (Theorem 4). Particularly, the application of a single purification with a time-step t is theoretically shown to be less beneficial than the looping of L iterations of diffusion-denoising with a time-step of t/L (Fig. 1). Our study additionally suggests the usage of Tucker decomposition (Bergqvist and Larsson 2010), a higher-order extension of matrix factorization, to attenuate adversarial noise at the high-noise regime (Theorem 5). We realize the advantages of those findings and propose LoRID, a Low-Rank Iterative Diffusion purification method designed to mitigate the purification errors (Fig. 2). By controlling the purification error, LoRID can effectively increase the diffusion time-step and beat the SOTA robustness benchmark, in both white-box and black-box settings (Table. 1 highlights LORID's performance in CIFAR-10 (Rabanser, Shchur, and G\u00fcnnemann 2017), and Imagenet (Deng et al. 2009)). The main contributions of this work are:\n\u2022 We establish theoretical bounds on the purification errors of Markov-based purifications. In particular, Theorem 1 show that the the adversarial noise will be removed at a distribution-level as the purification time-steps increases. On the other hand, Theorem 2, and 3 point out the purification at the sample-level.\n\u2022 We show theoretical justifications for looping the early-stages of DDPM (Theorem 4), and the usage of Tucker decomposition (Theorem 5) for adversarial purification.\n\u2022 We introduce a Markov-based purification algorithm, called LORID (Alg. 1), utilizing early looping and Tucker decomposition and demonstrate rigorously its effectiveness and high performance in three real-world datasets: CIFAR-10/100, CelebA-HQ, and Imagenet.\nOur paper is organized as follows. Sect. 2 provides the background and related work of this study. Sect. 3 consists of our theoretical analysis and the description of our proposed purification LoRID. Sect. 4 provides our experimental results, and Sect. 5 concludes this paper."}, {"title": "2 Background and Related Work", "content": "This section first briefly reviews the Denoising Diffusion Probabilistic Model (Ho, Jain, and Abbeel 2020), which is the backbone of our diffusion purifications. Then, the related work about the usage of diffusion models as adversarial purifiers is discussed. Finally, we briefly discuss the Tucker decomposition, which is a component utilized by our method.\nDenoising Diffusion Probabilistic Models (DDPMs) are a class of generative models that, during training, iteratively adding noise to input signals, then learning to denoise from the resulting noisy signal. Formally, given a data point xo sampled from the data distribution q(x0), a forward diffusion process from clean data xo to x\u0442 is a Markov-chain that gradually adds Gaussian noise, denoted by N, to the data according to a variance schedule {\u03b2t \u2208 (0,1)}\u03a4t=1:\nq(x1:T|x0) := \u03a0\u03a4t=1 q(xt|xt\u22121), where\nq(xt|xt\u22121) := N(xt; \u221a(1 \u2212 \u03b2t)xt\u22121, \u03b2tI)\n(1)\nThe objective of DDPM is to learn the joint distribution Po (x0:T), called the reverse process, which is defined as another Markov-chain with learned Gaussian transitions p\u03b8(x0:T) = p(xT) \u03a0\u03a4t=1P\u03b8(xt\u22121|xt), where\np\u03b8(xt\u22121|xt) := N(xt\u22121; \u03bc\u03b8(xt,t), \u03a3\u03b8(xt, t))\n(2)\nstarting with p(x\u0442) = N(x\u0442;0, I). The mean \u03bc\u03b8(x,t) is a neural network parameterized by \u03b8, and the variance \u03a3\u03b8(xt,t) can be either time-step dependent constants (Ho, Jain, and Abbeel 2020) or learned by a neural network (Nichol and Dhariwal 2021). A notable property of the forward process is that it admits sampling xt at an arbitrary time-step t in closed form: using the notation \u03b1t := 1 \u2212 \u03b2t and \u0101t := \u03a0\u03c4=1 \u03b1s, we have\nq(xt|x0) = N (xt; \u221a\u0101tx0, (1 \u2212\u0101t)I)\nUsing the reparameterize trick, we can define the forward diffusion process to the time-step t as ft:\nxt = ft(x0) := \u221a\u0101tx0 + \u221a1 \u2212 \u0101t\u22080\n(3)\nwhere e0 is a standard Gaussian noise.\nFor the reverse process, the recovered signal from the time-step t can be written as (Ho, Jain, and Abbeel 2020):\nxo(t) = 1/\u221a\u0101t(Xt \u2212 \u221a1-\u0101t/ \u221a\u0101t e\u03b8(x,t))\n(4)\nwhere e is a function approximator predicting e from xt, i.e., the noise matching term. Given that, we have\nxo(t) \u2212 x0 = \u221a1-\u0101t/\u221a\u0101t (\u22080 \u2212 e\u03b8 (x, t))\n(5)\nThus, the approximator e can be trained using MSE loss:\nL(\u03b8) := Et,x0,\u03f5 [||\u03f5 \u2212 \u03f5\u03b8 (x, t)||2]\n(6)\nDiffusion models as adversarial purifiers. Diffusion-based purification schemes can be categorized into Markov-based purification (or DDPM-based), and Score-based purification, which utilize DDPM (Ho, Jain, and Abbeel 2020)"}, {"title": "3 Method", "content": "This section provides theoretical results on different aspects of Markov-based purification (7) and the details for our proposed adversarial purification algorithm LoRID.\n\u2022 Subsect. 3.1 provides Theorem 1 about the theoretical removal of the adversarial noise as the diffusion time-step t in the Markov-based diffusion model increases at the distribution-level. It is the counterpart of Theorem 3.1 in (Nie et al. 2022) for Score-based purification.\n\u2022 The purification error between the clean and the purified images at the sample-level are further characterized in Theorem 2 and 3 in Subsect. 3.1. While Theorem 3 can be viewed as an adaptation of Theorem 3.2 from Score-based to Markov-based purification, to the best of our knowledge, the lower bound on the reconstruction error in Theorem 2 has not been previously established for any diffusion-based purification methods.\n\u2022 Subsect. 3.2 demonstrates how we realize our theoretical analysis into practical measurement. Particularly, We analyze the intrinsic purification error arising from the Markov-based purification process (Corollary 1) and identify the advantage of looping the early time-steps of the diffusion models for the purification task (Theorem 4). The result suggests that, with the same effective diffusion-denoising steps, looping can reduce the intrinsic purification error significantly.\n\u2022 Subsect. 3.2 also studies and validates the usage of Tucker Decomposition combined with Markov-based purification at the high-noise regime (Theorem 5).\n\u2022 Based on the theoretical analysis, we design LoRID, the Low-Rank Iterative Diffusion method to purify adversarial noise. Its description is provided in Subsect. 3.3."}, {"title": "3.1 Markov-based Purification", "content": "Intuitively, the diffusion time-step t need be large enough to remove adversarial perturbations; however, the image's semantics will also be removed as t increases. That observation is captured in the following Theorem 1, which states that the KL-divergence between the distributions of the clean images and the adversarial images converges as t increases:\nTheorem 1. Let {x(i)t }\u03a4t\u2208{0,...,T}, i \u2208 {1,2} be two diffusion processes given by the forward equation (1) of a DDPM. Denote q(1)t and q(2)t the distributions of x(1)t and x(2)t, respectively. Then, for all t \u2208 {0, ..., T \u2212 1}, we have\nDKL (q(1)t+1||q(2)t+1) \u2265 DKL (q(1)t ||q(2)t )\nSketch of proof (proof in Appx A.1). While Theorem 1 resembles that stated for the Score-based purification (Nie et al. 2022), its proof is greatly different since the DDPM's diffusion is not controlled by an Stochastic Differential Equation. Instead, we leverage the underlying Markov process governing the forward diffusion of DDPM (1), and show DKL (q(1)t+1 ||q(2)t+1 ) = DKL (q(1)t ||q(2)t ) + DKL (q(1) (xt|xt+1)||q(2) (xt|xt+1))\nby expanding the KL-divergence between q(1) (xt+1,xt) and q(2) (xt+1, xt). Then, due to the non-negativity of the KL-divergence, we have the Theorem.\nNote that Theorem 1 captures the purification at the distribution level. Similar to the Score-based purification (Nie et al. 2022), we are also interested in the purification of the DDPM at the instance level. In fact, the variational bound (Eq. 6) suggests that the reconstruction error ||x0(t) \u2212 x0|| is directly proportional to the DDPM's training objective."}, {"title": "3.2 Controlling Purification Error", "content": "This subsection studies the inherent error introduced by the purification process and demonstrates why it instigates a better purification scheme based on looping the early stage of the DDPM and the utilization of Tucker decomposition.\nOur analysis starts with the consideration of the trivial case in which there is no adversarial noise. By combining the two Theorems 2 and 3, we have the following corollary:\nCorollary 1. Given the assumptions in Theorem 3, the intrinsic purification error on a clean purification input x0 = xclean, i.e., Ea 0, is bounded by\nMMSE (\u0101t/(1-\u0101t)) \u2264 E [||x0(t) \u2212 xclean ||] \u2264 MMSE (\u0101t/(1-\u0101t))+SDDPM(t)\n(14)\nThe corollary reflects the strong connection between the purification error and the MMSE term. Especially, when the DDPM is well-trained, the gap \u03b4DDPM(t) between the lower and upper bounds becomes small, and E [||x0(t) \u2212 xclean ||] becomes more similar to MMSE (\u0101t/(1 \u2013\u0101t)). This observation motivates us to investigate purification schemes that minimize the MMSE.\nLooping at early time-steps. Several recent work observed that repetitive usage of the diffusion-denoising steps in parallel (Wang et al. 2022; Nie et al. 2022) or sequential (Lee and Kim 2023) can enhance system robustness against adversarial attacks. However, too many diffusion-denoising calls would not only diminish robustness gain but also degrade the clean accuracy significantly. Hence, we tackle the following question: Given a fixed number of denoiser's call, i.e., total number of diffusion-denoising steps, for the sake of adversarial purification, should we diffusion-denoising multiple loops of the DDPM at the earlier time-steps or utilize a few loops with large time-steps?\nWe now provide theoretical justification for the usage of multiple loops in purification. Specifically, we want to compare the purification to the time-step t, i.e., denoted by rt\u25e6ft, and the purification of L loops to the time-step t/L, i.e., (rt/L \u25e6ft/L) L . By denoting the output of l times DDPM-purification to time-step t, x(t) := (rt/L \u25e6 ft/L ) l (x0), we formalize the impact of looping purification via the following Theorem 4:\nTheorem 4. Let {xt}Tt=0 be a diffusion process defined by the forward (1) where x is the adversarial sample. i.e, x0 = xclean + Ea. For any given time t, we have the reconstructed error E [||x(t/L) \u2212 xclean||] is upper-bouned by:\nE [||x(t/L) \u2212 xclean||] \u2264 Lx MMSE (\u0101t/L/(1-\u0101t/L)) + dDDPM(t) + ||Ea|| (15)\nNote that the upper-bound on the reconstruction error of (rt/L \u25e6ft/L )L is controlled by L \u00d7 MMSE (\u0101t/L/(1 \u2212\u0101t/L)), instead of MMSE (\u0101t/(1 \u2013 \u0101t)) as in the vanilla purification scheme rt\u25e6 ft. For an illustration of the impact of looping the diffusion-denoising, we consider the input to compute the MMSE as standard Gaussian. The MMSE is then given by MMSE(SNR) = 1/(1 + SNR) (instead of the integral form (11)). We further take the values of \u0101t in DDPM (Ho, Jain, and Abbeel 2020) and plot L \u00d7 MMSE (\u0101t/L/(1 \u2013 \u0101t/L)) as a function of L in Fig. 1. The result shows that purification at a small time-step with a large number of iteration is greatly beneficial for the purification error.\nTucker Decomposition for High-noise Regime. We now study the utilization of DDPM and Tucker Decomposition to purify the adversarial samples, which is characterized by the operations rt\u25e6 ft and TF = T \u22121 od\u22121 od\u25e6T. From the previous analysis, the reconstruction error induced by the two methods are bounded by:\nMSErtoft (Ea) \u2264 MMSE (\u0101t/(1-\u0101t)) + SDDPM(t) + ||Ea|| (16)\nMSETF(Ea) \u2264 ETUCKER + ||TF(Ea)|| (17)\nwhere (16) is from Theorem 3 and (17) is from (9). Here, MSErtoft (Ea) and MSETF(Ea) denote the reconstruction error of the rt\u25e6ft and TF purification schemes (stated in (13) and (9), respectively). We now provide the upper-bounds of an integration of Tucker Decomposition into DDPM purification in the following Theorem 5.\nTheorem 5. The reconstruction errors introduced of the purification rt ft \u25e6 TF is bounded by:\nMSErtoftOTF(Ea) \u2264 MMSE (\u0101t/(1-\u0101t)) + SDDPM(t)+ ETUCKER + ||TF(Ea)||\n(18)\nIntuitively, comparing to the purification rt o ft, this purification process rt \u25e6 ft \u25e6 TF have a better upper bound when the Tucker Decomposition can reduce the adversarial noise before forwarding the signal to the DDPM, i.e., when ETUCKER + ||TF(Ea)|| < ||Ea||, which suggests the usage of Tucker Decomposition at a high-adversarial-noise regime."}, {"title": "3.3 LORID: Low-Rank Iterative Diffusion for Adversarial Purification", "content": "Based on the above analysis, we propose LoRID, a Low-Rank Iterative Diffusion algorithm for adversarial furification. Generally, LoRID consists of two major steps: Tensor factorization, and diffision-denoising. So far, our manuscript has considered four different configurations of LoRID, depending on the usage of looping and on how the TF and diffusions are coupled: Tensor-factorization TF, diffusion-denoising rt\u25e6 ft, looping (rt/L \u25e6 ft/L), and Tensor-factorization with diffusion-denoising TF \u25e6 rt\u25e6 ft. However, the default configuration that we refer to with LoRID would utilize both Tucker Decomposition (step 1) and multiple loops of diffusion-denoising (step 2), which can be described by the expression TF \u25e6 (rt/L \u25e6 ft/L) L . The pseudocode of LoRID is described in Appendix. B.5."}, {"title": "4 Experiments", "content": "This section is about our experimental setting and robustness results: Subsect. 4.1 highlights the experimental settings and Subsect. 4.2 reports our experimental results."}, {"title": "4.1 Experimental Setting", "content": "Datasets and attacked architectures. We evaluate LORID on CIFAR-10/100 (Rabanser, Shchur, and G\u00fcnnemann 2017), CelebA-HQ (Karras et al. 2018), and ImageNet (Deng et al. 2009). Comparisons are made against SOTA defense methods reported by RobustBench (Croce et al. 2021) on CIFAR-10 and ImageNet, and against DiffPure (Nie et al. 2022), a score-based diffusion purifier, on CIFAR-10, ImageNet, and CelebA-HQ. We use the standard WideResNet (Zagoruyko and Komodakis 2017) architecture for classification, evaluating defenses using standard accuracy (pre-perturbation) and robust accuracy (post-perturbation). When the gradients is not needed (black-box setting) in CIFAR-10, all methods are evaluated 10000 test images. On the other hand, due to the high computational cost of computing gradients for adaptive attacks against diffusion-based defenses, we assess the methods on a fixed subset of 512 randomly sampled test images, consistent with previous studies (Nie et al. 2022; Lee and Kim 2023). Further experimental details are provided in Appx. B with EOT=20.\nAttacker settings. We consider two common threat models: black-box and white-box. In both scenarios, the attacker has full knowledge of the classifier. However, only in the white-box setting, the attacker also knows about the purification scheme. For black-box, we adapt (Nie et al. 2022; Lee and Kim 2023) and evaluate defense methods against AutoAttack (Croce and Hein 2020) in CIFAR-10/100 and BPDA+EOT (Ferrari et al. 2023) in CelebA-HQ. For white-box, we also follow the literature and consider AutoAttack and PGD+EOT (Zimmermann 2019).\nHowever, white-box attacks require gradient backpropagation through the diffusion-denoising path, causing memory usage to increase linearly with diffusion step t. This makes exact gradient attacks infeasible on larger datasets like CelebA-HQ and ImageNet (Kang, Song, and Li 2024). Therefore, all existing work rely on some approximations of the gradients to conduct white-box attacks on those dataset (Nie et al. 2022; Lee and Kim 2023). To the best of our knowledge, The strongest approximation to date is the surrogate method (Lee and Kim 2023), which denoises noisy signals using fewer denoising steps (Song, Meng, and Ermon 2020). This approach reduces the number of denoiser calls while effectively simulating the original process (details in Appendix B.4). In summary, we use exact gradients for CIFAR-10 and the surrogate method for CelebA-HQ and ImageNet in our white-box attacks.\nLoRID settings. LoRID requires the specification of both the time-step t and the looping number L, which are crucial for its iterative process. These hyperparameters are generally selected by evaluating the classifier's performance on the clean dataset, with t and L chosen to maintain acceptable clean accuracy. Further details on this parameter selection process are provided in Appx. B.6. We report those parameters as a tuple (t, L) next to the name of our method. Additionally, obtaining an accurate Tucker decomposition for large datasets can be computationally intensive. Therefore, in such cases, LoRID is applied solely with Markov-based purification. In our results, the use of Tucker decomposition is denoted by TF next to the method's name, e.g. (TF, t, L)."}, {"title": "4.2 Robustness Results", "content": "We compare LoRID with the SOTA adversarial training methods documented by RobustBench (Croce et al. 2021), as well as leading adversarial purification techniques, against strong L\u221e and L2 attacks.\nCIFAR-10. Tables 2 and 3 show the defense's performance under L\u221e(\u2208 = 8/255) and L2(\u2208 = 0.5) AutoAttack on CIFAR-10. Our method achieves significant im\nprovements in both standard and robust accuracy compared to previous SOTA in both black-box and white-box settings. Particularlly, LoRID improves black-box robust accuracy by 23.15% on WideResNet-28-10 and by 4.27% on WideResNet-70-16. Additionally, our method surpasses baseline robust accuracy in the white-box by 12.26% on WideResNet-28-10 and by 21.09% on WideResNet-70-16.\nImageNet. Table 4 shows the robustness performance against L\u221e(\u2208 = 4/255) AutoAttack on WideResNet-28-10. Our method significantly outperforms SOTA baselines in both standard and robust accuracies.\nCelebA-HQ. For large datasets like CelebA-HQ, attackers often use the BPDA+EOT attack (Tramer et al. 2020; Hill, Mitchell, and Zhu 2021), which substitutes exact gradients with classifier gradients. We evaluated our approach against baseline methods under this attack, as shown in Table 5. Our method outperforms the best baseline in robust accuracy by 7.17%, while also maintaining high standard accuracy.\nHigh-noise regime. We demonstrate the effectiveness of Tucker decomposition in high-noise settings, as shown in Table 6. Specifically, we compare LoRID to the best known robustness results from Gowal et al. (2021) under black-box L\u221e AutoAttack. The results indicate that Tucker decomposition becomes increasingly beneficial as noise levels rise, as supported by Theorem A.5. Notably, with Tucker decomposition, LoRID's robustness at a very high noise level (\u2208 = 32/255) surpasses SOTA performance at the standard noise level (\u2208 = 8/255) by 12.8%."}, {"title": "5 Conclusion", "content": "We introduced LoRID, a defense strategy that uses multiple looping in the early stages of diffusion models to purify adversarial examples. To enhance robustness in high noise regimes, we integrated Tucker decomposition. Our approach, validated by theoretical analysis and extensive experiments on CIFAR-10/100, ImageNet, and CelebA-HQ, significantly outperforms state-of-the-art methods against strong adaptive attacks like AutoAttack, PGD+EOT and BPDA+EOT."}, {"title": "A Appendix", "content": "A.1 Proof of Theorem 1\nIn the following, we provide the proof of Theorem 1. We restate the Theorem below:\nTheorem. Let {x(i)t }Tt\u2208{0,...,T}, i \u2208 {1, 2} be two diffusion processes given by the forward equation (1) of a DDPM. Denote q(1)t and q(2)t the distributions of x(1)t and x(2)t, respectively. Then, for all t \u2208 {0, ..., T \u2212 1}, we have\nDKL (q(1)t+1||q(2)t+1) \u2265 DKL (q(1)t ||q(2)t )\nProof. We start by restating the chain rule for relative entropy (Cover and Thomas 2006):\nDKL (p(Z1, Z2)||p' (Z1, Z2)) = DKL (p(Z1)||p'(Z1)) + DKL (p(Z2 Z1)||p' (Z2 Z1)) (19)\nThen, by denoting q(i) (xt+1,xt) the joint distribution of x(i)t+1 and x(i)t, the chain rule gives us:\nDKL (q(1) (xt+1, xt)||q(2) (xt+1, xt)) = DKL (q(1)t ||q(2)t ) + DKL (q(1) (xt+1|xt)||q(2) (xt+1|xt)) (20)\n = DKL (q(1)t ||q(2)t )+ DKL (q(1) (xt|xt+1)||q(2) (xt|xt+1)) (21)\n = DKL (q(1)t+1||q(2)t+1)(22)\nNote that, due to (1), we have q(1) (xt+1|Xt)=q(2)(xt+1|xt), this implies the last term of Eq. (22) DKL (q(1) (Xt+1|Xt)||q(2) (Xt+1|Xt)) = 0. Thus, we have:\nDKL (q(1)t+1||q(2)t+1)+ DKL (q(1) (xt+1|xt)||q(2) (xt+1|xt))= DKL (q(1)t+1||q(2)t+1)(23)\nThus, due to the non-negativity of the KL divergence DKL (q(1) (xt Xt+1)||q(2) (xt|xt+1)), we have the Theorem:\nDKL (q(1)t+1||q(2)t+1) \u2265 DKL (q(1)t ||q(2)t )\n(24)\nA.2 Proof of Theorem 2\nTheorem. Let {xt}t\u2208{0,...,T} be a diffusion process defined by the forward equation (1) where x0 is the adversarial sample. i.e, x0 = xclean + Ea. For any given time t, we have\nE [||x0(t) \u2212 xclean ||] \u2265 MMSE (\u0101t/(1-\u0101t)) || Ea||\nwhere the expectation is taken over the distribution of xclean and MMSE(SNR) is the minimum mean-square error achievable by optimal estimation of the input given the output of Gaussian channel with a signal-to-noise ratio of SNR. The function MMSE(SNR) has the following form (Guo, Shamai, and Verdu 2005):\n1- 1/\u221a2\u03c0\u222b\u221e\u2212\u221ee\u2212y2/2tanh (SNR \u2212 \u221a SNRY)\ndy\nProof. We consider (3) as a Gaussian channel yt = \u221a\u0101t x0 + \u22080, and x(t) as an estimation of x0(t) given yt. By denoting + (yt) the best estimator of x0 given yt, we have\nE [||x0(t) \u2212 x0||] \u2265 E [||+(yt) \u2212 x0||] = MMSE (\u0101t/(1-\u0101t))(25)\nwhere the equality is from the definition of the MMSE(SNR) function. We are now ready to show (10). In fact, from the triangle inequality, we have:\n||x0(t) \u2212 xclean || = ||x0(t) \u2212 x0 \u2212 Ea || \u2265 ||x0(t) \u2212 x0|| \u2212 ||Ea||.\nCombining the above with (25) gives us:\nE [||x0(t) \u2212 xclean ||] \u2265 MMSE (\u0101t/(1-\u0101t)) \u2212 ||Ea||(26)\nThus, we have the Theorem.\nFor comprehensiveness, we now highlight how to derive (11). Particularly, we use the following relation between mutual information of a channel, i.e., I(SNR), and the minimum mean-square error of Gaussian channel (Guo, Shamai, and Verdu 2005):\ndI (SNR)/dSNR= 1/2MMSE(SNR)(27)\nwhere the mutual information of a channel I(SNR) is given as (Blahut 1987) (p. 274), and (Gallager 1968) (Problem 4.22):\nSNR = 1/\u221a2\u03c0\u222b\u221e\u2212\u221ee\u2212y2/2log cosh (SNR \u2212 \u221a SNRY)dy.\n(28)\nHere, the mutual information is computed in nats. Taking the derivative of (28) gives us (11).\nA.3 Proof of Theorem 3\nTheorem. Additionally to the conditions stated in Theorem 2, if the DDPM is able to recover the original signal x0 within an error \u03b4DDPM(t) in the expectation, i.e., for all t,\nE [||x0(t) \u2212 x0||] \u2264 E [||+(yt) \u2212 x0||] + \u03b4DDPM(t)\nwhere + (yt) is the best estimator of x0 given yt = \u221a\u0101t x0 + \u22080, then, we have the reconstructed error\nE [||x0(t) \u2212 xclean ||] is upper-bounded by:\nE [||x0(t) \u2212 xclean ||]\u2264 MMSE (\u0101t/(1-\u0101t)) + \u03b4DDPM(t) + ||Ea||\nProof. From the triangle inequality, we have:\n||x0(t) \u2212 xclean || = ||x0(t) \u2212 x0 \u2212 Ea || \u2264 ||x0(t) \u2212 x0|| + ||Ea||\nCombining the above with the assumption on the recovering error stated in the Theorem gives us:\nE [||x0(t) \u2212 x0|| + ||Ea||] = E [||x0(t) \u2212 x0||] + E [||Ea ||] \u2264 E [||+(yt) \u2212 x0||] + \u03b4DDPM(t) + ||Ea||  = MMSE (\u0101t/(1-\u0101t)) + \u03b4DDPM(t) + ||Ea||\nWe then have the Theorem."}, {"title": "A.4 Proof of Theorem 4", "content": "Theorem. Let {xt"}, "t\u2208{0,...,T} be a diffusion process defined by the forward Eq. (1) where x0 is the adversarial sample. i.e, x0 = xclean + Ea. For any given time t, we have the reconstructed error E [||x(t/L) \u2212 xclean||"], "by": "nE [||x(t/L) \u2212 xclean||]\u2264 Lx (MMSE (\u0101t/L/(1-\u0101t/L)) + \u03b4DDPM(t)) + ||Ea||\nwhere the expectation is taken over the distribution of xclean.\nProof. From the triangle inequality", "have": "n||x(t/L) \u2212 xclean|| = ||\u03a3L\u22121l=1(x(l+1)t/L \u2212 x(l)t/L) + (x(L)t/L \u2212 x0) \u2212 Ea||\n\u2264\u03a3L\u22121l=1||(x(l+1)t/L \u2212 x(l)t/L) + (x(L)t/L \u2212 x0)||+ ||Ea||(29)\n\u2264 \u03a3L\u22121l=1||+1(t/L) \u2212 (t/L)||+ ||(t/L) \u2212 x0|| + ||Ea|| (30)\nNoting that, each of the signal x(l+"}