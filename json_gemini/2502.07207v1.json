{"title": "A Study on the Importance of Features in Detecting Advanced Persistent Threats Using Machine Learning", "authors": ["Ehsan Hallaji", "Roozbeh Razavi-Far", "Mehrdad Saif"], "abstract": "Advanced Persistent Threats (APTs) pose a significant security risk to organizations and industries. These attacks often lead to severe data breaches and compromise the system for a long time. Mitigating these sophisticated attacks is highly challenging due to the stealthy and persistent nature of APTs. Machine learning models are often employed to tackle this challenge by bringing automation and scalability to APT detection. Nevertheless, these intelligent methods are data-driven, and thus, highly affected by the quality and relevance of input data. This paper aims to analyze measurements considered when recording network traffic and conclude which features contribute more to detecting APT samples. To do this, we study the features associated with various APT cases and determine their importance using a machine learning framework. To ensure the generalization of our findings, several feature selection techniques are employed and paired with different classifiers to evaluate their effectiveness. Our findings provide insights into how APT detection can be enhanced in real-world scenarios.", "sections": [{"title": "1 Introduction", "content": "Cyber threats have dramatically become more widespread with the world's ongoing movement toward complete digitization [6, 25]. The financial loss, reputational damage, and at times compromises in national security caused by cyber-attacks make cybersecurity a growing concern for businesses across all sectors [1, 5]. Confidence in digital systems is maintained by protecting digital assets and ensuring the availability of data, integrity, and privacy. Conventional defenses struggle with coping with the rising intensity and scale of cyber-attacks, both in number and sophistication [8, 12, 18]. Thus, sophisticated and adaptive solutions should be developed that facilitate eliminating complex and large-scale cyber-attacks.\nAPTs are among the most sophisticated and complex cyber-attacks, making them very challenging to detect [3,17]. These stealthy and targeted attacks are commonly carried out in multiple steps to infiltrate a system and can remain active for an extended period of time. APT can have a variety of objectives, including stealing sensitive data and disrupting critical infrastructure. These enemies often remain unnoticed as they take advantage of the network and reveal the weaknesses in the system [27]. APTs are especially dangerous for both the public and private sectors since they are typically launched by highly skilled and resourceful hacker groups, such as nation-states or organized crime groups.\nMany research efforts are dedicated to addressing APTs in computer networks [13, 15, 23, 24]. The majority of these studies are based on intrusion detection systems, network monitoring tools, and firewalls, and they provide baseline security against such adversaries. Recently, machine learning-based systems have been employed to facilitate the detection process by focusing on patterns and anomalies in network traffic, system logs, and user behavior [2,16,20]. These models provide a dynamic and extensible approach that will enable organizations to automatically detect complex threats with less dependence on signature-based defenses.\nDespite the potency of machine learning-based detection systems, the data-driven backbone of these models is highly affected by the quality of data [11,14, 22]. For instance, redundant or irrelevant features that may be useful for other tasks may increase false alarms and missed detection [10]. In other words, the quality of features in the input space of the detection model directly impacts the detection performance of APT samples [16]. Moreover, if the employed features do not reflect the system dynamics when it is exposed to APT samples, the machine learning model cannot be effective, regardless of the model's robustness.\nTo tackle the aforementioned issues, this paper studies the network mea-surements used in detecting APTs and determines the features contributing the most to this process. To do so, we design a machine learning framework that ensures the generalization of our research findings. This has been ensured by employing several Feature Selection (FS) techniques from different categories and combining them with multiple classifiers. In addition, we study 15 different cases of APTs based on public records to cover a wide range of APT attacks. Our findings will provide insight into optimizing detecting APTs using machine learning techniques, addressing the critical challenge of data quality in APT defense strategies.\nThe remainder of this paper is organized as follows. Section 2 explains the background and preliminaries. Section 3 explains the methodology of this paper. Experimental results are reported and analyzed in Section 4. Finally, the paper is concluded in Section 5."}, {"title": "2 Background", "content": "Here, we first provide a more detailed explanation of APT. Then, we review popular real-world APT cases considered in this work."}, {"title": "2.1 Advanced Persistent Threats", "content": "APTs are targeted, intelligence-driven, and complex cyber-attacks launched against high-value targets such as critical infrastructures and financial institutions [3]. APTs are multi-step attacks, usually starting with intelligence collection through reconnaissance. Based on the security holes identified during reconnaissance, APT gains access to the system and exploits the system. To ensure continuous access to the targeted system, APTs often inject backdoors into the system so that they can revive the connection when desired. From there, attackers explore the network to extend their access to more sensitive components of the system. Finally, the attacker reaches a malicious objective such as hijacking sensitive data or disrupting critical infrastructures."}, {"title": "2.2 Cases of Advanced Persistent Threat", "content": "Several APT cases are considered in this study. The name of these cases indicates the hacker group responsible for them. These cases are briefly introduced in the following.\nAPT28 (Fancy Bear) A Russian cyber-espionage group linked to military intelligence. It targets government, military, and media sectors, mainly in Europe and the U.S. It is known for interfering in the 2016 election in the U.S. using spear phishing and sophisticated malware to carry out espionage.\nAPT29 (Cozy Bear) Another highly recognized state-sponsored Russian group linked to the Foreign Intelligence Service. APT29 focuses on long-term espionage campaigns targeting government, diplomatic, and healthcare organizations. It typically performs extremely stealthy and sophisticated malware attacks, like in the case of SolarWinds back in 2020.\nAPT30 A sophisticated cyber-espionage group, reportedly supported by China and with a large focus on targets such as Southeast Asian governments, aerospace, and defense industries. Spear phishing and custom malware are just some of the methods that have been utilized since at least 2005 to steal sensitive data.\nCarbanak A cybercrime gang launched attacks against financial institutions worldwide starting in 2013. It's known to infiltrate bank networks via phishing emails and then use malware to siphon off millions more by manipulating internal systems.\nDesert Falcon An Arabic-speaking hacker group that has been active since 2011, targets military, media, and political targets for espionage in the Middle East. It conducts sensitive data theft from governments and corporations using malware.\nHurricane Panda A Chinese hacker group that mainly targets aerospace and energy. It is well-known for its advanced toolset, featuring zero-day exploits. Hurricane Panda therefore steals proprietary information through cyber espionage.\nLazarus Group Some would consider it sponsored by North Korea; it has been accused of several high-profile hacks, including Sony Pictures and the WannaCry ransomware. It performs financial crime and espionage, quite frequently against global financial institutions.\nMirage A cyber-espionage group targeting energy companies and government organizations in East Asia. The nature of its hacks is described as phishing campaigns and custom malware aimed at intelligence gathering on behalf of the victims.\nPatchwork An Indian hacker group targets think tanks, government institutions, and the defense sector throughout South Asia. The malware is often just a rehash of code stolen from other APT groups, and intellectual property theft is their ultimate focus.\nSandworm One of the most feared Russian hacker groups because it boasts a large number of destructive attacks. Among them is the highly publicized attack on the 2015 Ukraine power grid. Sandworm deploys highly sophisticated malware and takes a huge interest in targeting vital infrastructure for political reasons.\nShiqiang This hacker group appears to be related to Chinese state actors and focuses its operations on cyber-espionage activities targeting the government and industrial sectors around the world. The prime intention behind such threats is to steal intelligence or trade secrets from strategic industries.\nTransparent Tribe Originating from Pakistan, Transparent Tribe targets Indian government and military verticals. It performs cyber espionage by infecting sensitive systems with malware such as Crimson RAT.\nViolin Panda An advanced cyber-espionage entity based in China targets organizations in technology and defense industries around the world. The main modus operandi of Violin Panda is spear-phishing campaigns, while custom malware is used for data exfiltration.\nWinnti Group This Chinese state-sponsored group, also known as Winnti, concentrates on stealing intellectual property through espionage. The primary targets of the group are the gaming and software industries. It is also known to be behind supply chain attacks and to maintain long-term persistence in networks."}, {"title": "2.3 Case Study", "content": "To simulate real-world APTs in computer networks, we consider the data introduced in [16]. This data is created based on known APTs with publicly available reports. These data contain 2086 APT samples obtained from 15 different APTs, as listed in Table 1. A total of 9021 non-APT malware are also included in the data. The objective of this case study is to distinguish between APT and non-APT attacks so that malware triage can be performed accordingly. Table 1 also indicates the population of samples associated with each APT mechanism. To minimize the latency, samples are recorded using static features that can be extracted with minimal delay. Initially, 4000 features were extracted using the PEFrame tool. These features consist of optional headers, MS-DOS headers, file headers, obfuscated string statistics, Mutex, Packer, buckets, and imported API."}, {"title": "3 Methodology", "content": "Fig. 1 illustrates the block diagram of the design feature analysis framework for data-driven detection of APT samples. Initially, a dataset is created by combining data associated with different APT cases based on the available public records [16]. Then, the unified dataset is processed by several FS algorithms that are selected from three main categories, namely filter, wrapper, and embedded FS. The filter approach often uses computationally efficient techniques to score features using statistical measures. ReliefF [21] and Spectral Feature Selection (SFS) [26] both follow this approach and are used within the designed framework. The wrapper approach uses a machine learning model to iteratively eliminate features based on the prediction performance associated with using them. Recursive Feature Elimination (RFE), Greedy Dynamic Selection (GDS) [7], and FS using Mutual Information (MI) [19] are examples of this category that are selected in our framework [9]. Embedded FS selects top features during learning, which is advantageous in terms of computational efficiency. Additionally, the classification performance using this approach often outperforms that of the others. From this category, Concrete Autoencoder (CAE) [4] and Concrete FS using MI (CFMI) [14] are included in the designed analytical framework.\nEach of the FS algorithms processes the prepared dataset and selects 110 features from the total pool of features. These features are then used for two separate studies. Firstly, we track the selected features by each FS method and assign a score to each feature. This score is calculated based on the number of FS techniques that selected a certain feature. Then, features are categorized into different priority groups based on the estimated scores. The priority groups and their features are analyzed and studied afterward.\nIn the second study, the selected features are passed to three classifiers, namely decision tree, random forest, and k-Nearest Neighbors (k-NN). The outputs of these classifiers are averaged to make the results independent of a certain classifier. In this process, four different performance metrics are used to enable studying various aspects of APT detection such as overall accuracy, performance under class imbalance, false alarm rate, and false positive rate. These results are then used to study the potency of FS in enhancing the performance of APT detection."}, {"title": "4 Experimental Results", "content": "This section initially explains the experimental setting used in the simulations and then proceeds to report and analyze the obtained results. The importance of features for APT detection is studied afterward."}, {"title": "4.1 Experimental Setting", "content": "Experiments are evaluated in terms of accuracy, F1-score, precision, and recall. To ensure the statistical reliability of the results, experiments are cross-validated using 10 folds. The parameters of FS methods are tuned using Grid Search with a search range obtained empirically. Experiments were conducted using an NVIDIA RTX 3080 GPU, an Intel Core i7-12700 CPU, and 32 GB of RAM."}, {"title": "4.2 Performance Analysis", "content": "Fig. 2 illustrates the box plot of post-FS detection performance in terms of four different performance metrics. The distribution of recorded performance across different iterations of the cross-validation is shown by solid circles beside each box. In addition, the average and median of this distribution are indicated with a solid square and a red line, respectively. Furthermore, plus signs denote outliers in the plotted distribution. Maximum and minimum values are specified using green lines.\nTo study the post-FS detection performance, we select 110 features from the original pool of 3000 features for each method. The detection task is carried out using three classifiers, namely decision tree, random forest, and k-nearest neighbors. Throughout the experiments, the recorded performance metrics obtained by these classifiers are averaged to evaluate the performance of each FS algorithm.\nLooking into the obtained accuracies in Fig. 2(a), it can be implied that coupling classifiers with FS results in outstanding APT detection performance. Among the selected FS methods, CFMI generally outperforms the rest regardless of the performance metric. RFE, CAE, MI, GDS, SFS, and RliefF are ranked from second to seventh in terms of accuracy. Nevertheless, given the high imbalance ratio in the utilized dataset (see Table 1), accuracy may accurately reflect the detection capability of this approach. Therefore, the F1-score of these methods is reported in Fig. 2(b) to better understand the potency of FS when dealing with highly imbalanced data. While the obtained F1-scores are desirable, the ranking of FS algorithms has changed. Here, CAE outperforms RFE, and ReliefF results in a better F1-score than GDS.\nIn order to take false positives and false alarms into account, precision and recall associated with APT detection are additionally reported in Fig. 2(c) and (d), respectively. Similar to the previous analysis, the obtained results in Fig. 2(c) and (d) show superior performance for all FS techniques. The comparison of FS methods in terms of precision is very similar to that of F1-score. On the other hand, the ranking of methods when taking recall into consideration, is roughly the same as the comparison performed on the detection accuracy. This implies that the reason for the different ranking of algorithms when considering accuracy and F1-score is the degree of false alarm and false positive each of them leads to."}, {"title": "4.3 Feature Analysis", "content": "Fig. 3 depicts the top 73 features selected by the majority of FS algorithms selected in this work. These features fall under different categories that relate to various aspects of binary's behavior and structure. Studying these categories helps with understanding how they contribute to detecting APTs within the network. Here, we categorize these features into three groups based on the level of priority.\nThe top nine features selected by all FS methods form the core of the detection strategy. These include winsock.dll, shell32.dll, and advapi32.dll Dynamic Link Library (DLL) imports and structural attributes such as MinorLinker Version and AddressOfEntryPoint. Because the features are present in all the selection procedures, it can be inferred that they are important aspects of APT?s behavior. As an example, wininet.dll and shell32.dll are frequently used by malicious programs for network communication and shell interaction. Advapi32.dll is used for performing registry and security operations which makes it a primary target for hackers trying to bypass and manipulate security protocols. AddressOfEntryPoint and MinorLinker Version are associated with the compilation and loading process of binaries, where abnormal alterations of the features may indicate the presence of malicious activities. These features suggest that both functional aspects and underlying structure indicators are beneficial in detecting malicious traffic associated with an APT.\nThe subsequent group of 21 features comprises, among others, additional DLLs and some functions that are substantially involved in the executable behavior. These include msvbvm60.dll, mscoree.dll, and ws2_32.dll. Although these features are rather less important than the top group, they still provide opportunities to ascertain an APT presence. In addition, such features facilitate identifying the areas, resources, or libraries, that the binary code might communicate with. These features are also useful for operations that might be conducted at the system level. For instance, msvbvm60.dll is particular to the visual basic programs, and therefore its presence could indicate the usage of outdated programs that are security risks. mscoree.dll is used for .NET programs, and it is important to track since viruses may use the .NET runtime to facilitate their operations. The presence of ws2_32.dll indicates possible networking operations, which can further be investigated for C2 communication or data exfiltration. Although not as central as the first nine features, this group is critical in narrowing down the broader depiction of what an executable does, in particular, the network-based-executables and managed code execution.\nThe rest of the features in Fig. 3 are selected by five methods. These features are helpful in improving the detection system. Some of these are modemui.dll, hal.dll, ntdll.dll, as well as type and structure imports and function imports. These features seem to represent behavioral patterns that are more specific to a context or target, and may not be present in all APT attacks, but are still useful flags in certain scenarios. For example, modemui.dll and hal.dll belong to the class of hardware control and system management, vulnerabilities where sophisticated malware that aims to exploit even lower-level parts of a computer system may attack. Usage of ntdll.dll also aids in communication with the kernel, and unorthodox usage of this library may point towards alterations made at the executive level of the system catalog. Such features assist in exposing more of the subtle tactics and approaches that may not be noticeable from the previously discussed groups of features. Table 2 lists features that are selected by four or fewer FS algorithms. These features have lower priority compared to the features included in Fig. 3 as they contribute less in detecting APT samples."}, {"title": "5 Conclusion", "content": "This paper designed a feature engineering framework to study the importance of features in the detection of APT samples based on the available public records of APTs. To ensure the generalization of our findings, 15 different APT cases were considered in our simulations. These samples were studied using several FS algorithms in combination with multiple classifiers. In addition, experiments were cross-validated using 10-fold to ensure statistical reliability of results. The feature analysis is performed by taking the results of all FS methods into consideration. The results show a superior APT detection performance when FS is incorporated into the detection process. After careful analysis of features, those identified among the top features were categorized into three groups based on the degree of importance. Finally, the necessary features for APT detection were explained along with the logic behind it. These findings provide insight for security experts into how data-driven APT detection can be enhanced using FS."}]}