{"title": "GRU-PFG: Extract Inter-Stock Correlation from Stock Factors with Graph Neural Network", "authors": ["Yonggai Zhuang", "Haoran Chen", "Kequan Wang", "Teng Fei"], "abstract": "The complexity of stocks and industries presents challenges for stock prediction. Currently, stock prediction models can be divided into two categories. One category, represented by GRU and ALSTM, relies solely on stock factors for prediction, with limited effectiveness. The other category, represented by HIST and TRA, incorporates not only stock factors but also industry information, industry financial reports, public sentiment, and other inputs for prediction. The second category of models can capture correlations between stocks by introducing additional information, but the extra data is difficult to standardize and generalize. Considering the current state and limitations of these two types of models, this paper proposes the GRU-PFG (Project Factors into Graph) model. This model only takes stock factors as input and extracts inter-stock correlations using graph neural networks. It achieves prediction results that not only outperform the others models relies solely on stock factors, but also achieve comparable performance to the second category models. The experimental results show that on the CSI300 dataset, the IC of GRU-PFG is 0.134, outperforming HIST's 0.131 and significantly surpassing GRU and Transformer, achieving results better than the second category models. Moreover as a model that relies solely on stock factors, it has greater potential for generalization.", "sections": [{"title": "1 Introduction", "content": "Stock investment is a significant means of wealth enhancement [1]. By purchasing shares of relevant companies, investors become shareholders and derive income from the company's profits [2]. In the long term, stock investment typically yields higher returns and serves as an effective hedge against inflation [3]. However, stock investment also entails considerable risk. In scenarios of market volatility or poor corporate performance, investors face the possibility of losing their capital entirely [4]. Risk mitigation and return enhancement are aspirations for many investors. Due to information asymmetry, the majority of investors often struggle to avoid risks, resulting in substantial losses [5].\nAgainst this backdrop, to better mitigate risks and enhance returns, an increasing number of investors are focusing on the application of machine learning methods in stock prediction [6, 7]. Neural networks, exemplified by CNNs and Transformers, have opened new avenues for stock forecasting [8]. Although the predictions inevitably deviate to some extent from reality, a well-designed predictive model can significantly aid investors in formulating their stock selection strategies [9].\nCurrent stock prediction models can be categorized into two types. The first type relies solely on stock factors as inputs for prediction, without incorporating additional information. The second type considers not only stock factors but also integrates extra information such as stock relationships, market capitalization, and industry financial reports. The former type, represented by models such as GRU (Gated Recurrent Units) and GATs (Graph Attention Networks), uses relatively objective and standardized information [10]. However, previous research often suggests that these methods lack sufficient information, making it challenging to achieve more efficient predictions. The latter type, exemplified by models such as MDGNN and HIST, introduces information like industry relationships and stock relationships. These methods place each stock within the industry framework, calculating the correlations between different stocks to predict returns more effectively [11, 12].\nPrevious research generally suggests that the latter type of model, which utilizes more comprehensive information, achieves higher accuracy [13]. However, this approach also has significant drawbacks. Firstly, information such as industry concepts, market capitalization, and financial reports is abundant (difficult to select) and often subjective, lacking objective standards for determining which data should be used as model inputs [14]. Secondly, this information tends to lag, meaning investors often realize critical industry insights only after significant stock changes have already occurred [15]. In other words, there are frequent instances where the stock has undergone substantial movements before investors recognize the relevant industry information. Additionally, the strategies of many companies are rapidly evolving, and new companies are constantly emerging [16]. For these new strategies and companies, the method based on historical industry relationships faces the risk of becoming obsolete. This means that predictions relying on past industry relationships may not be effective in these rapidly changing environments.\nConsidering the advantages and disadvantages of the two types of models, although the latter has shown good accuracy in some research, the issues it has suggest that the former has broader application prospects. Based on this, the present study references"}, {"title": "2 Related Work", "content": "related models that rely solely on stock factors. The MLP (Multilayer Perceptron) is the most basic model, learning factor information through multiple dimensionality reductions and nonlinear processing [17]. However, its ability to learn relationships between factors is limited due to the constrained capacity of its network. GRU (Gated Recurrent Unit), LSTM (Long Short-Term Memory), ALSTM (Attention-based LSTM), and Transformer models treat the relationships between factors as temporal sequences, enabling better extraction of factor information, representing a significant improvement over MLP [18, 19]. Nonetheless, these models do not perform well in capturing relationships between different stocks, which limits their prediction performance.\nWhile numerous models rely solely on stock factors, few focus on the roles of stocks within the market, and even fewer consider inter-stock relationships. [20]. Meanwhile, the correlations between stocks contain a wealth of information that can significantly help to stock prediction. Based on this, we propose a new stock prediction model purely based on stock factors, named GRU-PFG (Project Factors into Graph). In our approach, we project the factor information processed by the GRU onto a Graph Network to learn the relationships between stocks. With the Graph Network, we integrate factor information with inter-stock relationships and achieve better prediction performance. In summary, this study makes the following major contributions:\n1. We have innovatively proposed a more effective stock prediction model, GRU-PFG. Among prediction models purely based on Alpha360 factors, GRU-PFG outperforms previous models.\n2. GRU-PFG deeply extracts the information embedded in Alpha360. Compared to models like ALSTM and GRU, GRU-PFG provides more profound extraction. This model offers a new approach for further mining stock factor information.\n3. Compared to prediction models based on multiple sources of information (such as HIST and TRA), our model achieved results that are on par with these models in experiments. In this context, our model provides an approach with greater potential for generalization, as it can extract inter-stock correlations from stock factors.\nIn summary, the structure of this paper is as follows: In the second chapter, we discuss related works in stock prediction, highlighting the importance of the prediction model based on pure Alpha360 factors. In the third chapter, we introduce some foundational work of our model, including basic concepts related to stocks and the application of GRU networks in stock prediction. In the fourth section, we present the basic framework and algorithms of our model, and in the fifth section, we validate the superiority of our model through experiments on various metrics such as IC (Information Correction), Rank IC, and precision@N. Finally, we summarize and provide an outlook on our work."}, {"title": "2.1 Stock Factors", "content": "The quantitative work related to stock prediction has long been shrouded in secrecy due to the difficulty of obtaining insider information related to trading [21]. Against"}, {"title": "2.2 Prediction Models Purely Based on Alpha360", "content": "Among the two types of factors provided by the qlib platform, Alpha360 stock factors have more dimensions and are more suitable for processing with deep learning methods such as GRU, LSTM, and Transformer models [29]. In the application of deep learning, most models process based solely on stock factors. Compared to methods that based on multiple information, this approach is more standardized and universal.\nFor Alpha360 factors, MLP is the most basic model. It learns the factors through multiple dimensionality reductions and nonlinear processing, but its ability to learn the relationships between factors is limited by its network capacity [30]. GRU [31], LSTM [32], ALSTM [33], and Transformer [34] models treat the factor information as temporal sequences, allowing for better extraction of factor information, achieving a certain breakthrough compared to MLP. However, these models do not perform well in capturing the relationships between different stocks, which limits their performance [12]."}, {"title": "2.3 Prediction Models Based on Multiple Sources of Information", "content": "In recent years, some scholars have argued that the information contained in stock factors is limited and have begun to consider incorporating additional information into the stock prediction process [7]. This means use not only stock factors (trends of stocks over a certain period) as model inputs but also other information as predictive evidence.\nSome scholars have considered public sentiment, believing that sentiment information related to stocks might contain insights into how industries are affected, thereby predicting future trends [35]. Other scholars have suggested that information such"}, {"title": "3 Fundmentals", "content": "Stock prices are influenced by various factors, including a company's financial performance [38], market sentiment [39], and macroeconomic conditions [40]. Although stock prices result from multiple influencing factors, they tend to change smoothly and continuously within a certain time frame in the stock market, rather than experiencing sudden jumps or interruptions. By analyzing the changes in stock prices over a past period, one can objectively reflect the combined effects of these influencing factors to some extent and further predict the stock price trend for the next stage [41].\nGenerally, stock trends are primarily analyzed by comparing and calculating changes in stock price data. If the stock price at time t is $P_t$ and the stock price at time t+1 is $P_{t+1}$, then the change rate over this period can be used to define the stock's trend as follows:"}, {"title": "3.1 Stock trend-related concepts", "content": "Stock prices are influenced by various factors, including a company's financial performance [38], market sentiment [39], and macroeconomic conditions [40]. Although stock prices result from multiple influencing factors, they tend to change smoothly and continuously within a certain time frame in the stock market, rather than experiencing sudden jumps or interruptions. By analyzing the changes in stock prices over a past period, one can objectively reflect the combined effects of these influencing factors to some extent and further predict the stock price trend for the next stage [41].\nGenerally, stock trends are primarily analyzed by comparing and calculating changes in stock price data. If the stock price at time t is $P_t$ and the stock price at time t+1 is $P_{t+1}$, then the change rate over this period can be used to define the stock's trend as follows:\n$\\alpha = \\frac{P_{t+1} - P_t}{P_t}$                              (1)"}, {"title": "3.2 Limitations of GRU in Stock Prediction", "content": "From the stock's variation trend, we can further derive the daily stock return. If the opening price of a stock on a given day is $P_{open}$ and the closing price is $P_{close}$, then the stock's return for that day is given by:\n$\\beta = \\frac{P_{close} - P_{open}}{P_{open}}$   (2)\nIn the field of financial investment, Alpha360 factor is commonly used to define the changes in stock prices over a period (60 days) to predict the trend of stock price movements in the next phase. Alpha360 factor is an objective metric composed of various pieces of information from the stock market, used to quantify the difference between the expected return of a stock and the overall market return. It represents a collection of variables that may affect stock returns, including fundamental factors, technical indicators, market sentiment, and macroeconomic data. The concept of the Alpha360 factor embodies the idea of multi-factor methods, which consider not just a single factor but a combination of multiple factors when predicting future stock or portfolio returns. This approach aims to capture various dimensions of stock returns to improve prediction performance.\nIn general, neural networks handling daily stock data typically use 360 factors as inputs to the prediction network, with the output being the return of one day. While pure GRU networks may not extract information from the 360 factors as effectively, they still demonstrate relatively good performance compared to networks like Transformer and LSTM in daily predictions [12]."}, {"title": "4 Methodology", "content": "Considering the limitations of previous models, we propose a new model, GRU-PFG (only based on Alpha360), to achieve improved stock prediction performance.\nOur proposed stock prediction network, GRU-PFG, is divided into three parts: (1) Preliminary Information Extraction (2) Primary Relationship Extraction (3) Secondary Relationship Extraction. We use the Alpha360 factors of multiple stocks as input to predict the returns of these stocks."}, {"title": "4.1 Methodology", "content": "Considering the limitations of previous models, we propose a new model, GRU-PFG (only based on Alpha360), to achieve improved stock prediction performance.\nOur proposed stock prediction network, GRU-PFG, is divided into three parts: (1) Preliminary Information Extraction (2) Primary Relationship Extraction (3) Secondary Relationship Extraction. We use the Alpha360 factors of multiple stocks as input to predict the returns of these stocks.\nPreliminary Information Extraction. In the preliminary information extraction phase, we use a GRU network. With 360 factors as input, we treat every 6 factors as one time step, reducing the 360-dimensional information to a 64-dimensional representation for subsequent processing. During this stage, the relationships between different factors are extracted. After GRU processing, Stock factor information is extracted. and feature representation of each stock is obtained:"}, {"title": "4.2 Methodology", "content": "Primary Relationship Extraction. After obtaining the feature representation information for each stock from the GRU processing, we apply the softmax function to X along the horizontal and vertical dimensions to obtain matrices $X_a$ and $X_b$, respectively. These matrices represent the roles of each value $X_{mn}$ in the m-th stock's internal dimension and the n-th dimension across different stocks.\nThe matrices $X_a$ and $X_b$, maintain the same form as X, where $X_a$ represents the relationships between internal factor information within each stock, and $X_b$ represents the correlations between different stocks. We then compute the Pearson correlation coefficient for $X_a$ and $X_b$ across the dimensions of each stock to obtain the matrix R:\n$R_{xy} = \\frac{\\sum_{i=1}^{n}(F_{xi} - \\overline{F_x})(F_{yi} - \\overline{F_y})}{\\sqrt{\\sum_{i=1}^{n}(F_{xi} - \\overline{F_x})^2\\sum_{i=1}^{n}(F_{yi} - \\overline{F_y})^2}}$   (4)\nwhere x represent the x-th stock in matrix X, y represent the y-th stock in matrix $X_b$, i represent the i-th factor information for each stock, $F_{xi}$ represent the mean factor information of the x-th stock in matrix, and $F_{y}$ represent the mean factor information of the y-th stock in matrix.\nWe compute the aggregated weight $R_1$ by using the Pearson correlation coefficients. After that, we multiply $R_1$ with X, the to obtain the Stock Feature derived from the primary relationship extraction. In this process, our approach is significantly more complex than traditional GRU networks. This complexity is necessary to calculate the relationships between each factor and other factors, as well as between each stock and other stocks. To achieve this, we construct the matrix $R_1$ as a correlation relationship matrix to serve as the feature weight matrix."}, {"title": "4.3 Methodology", "content": "Secondary Relationship Extraction. In financial markets, there are complex industry and trading relationships. We believe that beyond the primary relationships, there are additional latent relationships. These latent relationships, together with the primary relationships, form the following expression:\n$X_{hid} = X - W_aX_a - W_bX_b$   (5)\nwhere X is the initial information extracted by the GRU, $X_a$ and $X_b$ represent the information extracted in the primary relationship phase, $W_a$ and $W_b$ are learnable parameters, $X_{hid}$ is the information to be extracted in the secondary relationship phase. We apply similar operations as in the primary relationship extraction: using softmax and Pearson correlation coefficients, we construct an aggregation matrix $R_2$ and multiply it with $X_{hid}$ to obtain the Stock Feature in the secondary relationship phase."}, {"title": "4.4 Methodology", "content": "Stock Feature. The final Stock Feature is $F_{last}$ obtained by combining the Stock Features derived from the above two relationship extraction phases:\n$F_{last} = W_cX + W_dR_1X + W_eX_{hid} + W_fR_2X_{hid}$  (6)\nwhere $W_c, W_d, W_e$ and $W_f$ are learnable parameters, $F_{last}$ is the final feature used to predict the change trends of all stocks:\n$\\hat{p_t} = W_iF_{last} + b_i$   (7)\nwhere $W_i$ and $b_i$ are learnable parameters, $\\hat{p_t}$ represents the predicted daily return on date t.\nLoss Function. The loss function $L$ for GRU-PFG is implemented using Mean Squared Error (MSE) and has the following form:\n$L=\\frac{1}{|D|} \\sum_{t \\in D} \\sum_{i \\in S_t} \\frac{1}{|S_t|}(\\hat{p}_i^t - g_i^t)^2$   (8)\nwhere D represents the set of dates, t represents a specific date, $S_t$ represents the set of stocks on date t, $\\hat{p}_i^t$ represents the predicted daily return for the i-th stock on date t, $g_i^t$ represents the actual daily return for the i-th stock on date t."}, {"title": "5 Experiments", "content": "We test our model based on the CSI100 and CSI300 datasets. We use stock data from January 1, 2007, to December 31, 2014, as the training set, stock data from January 1, 2015, to December 31, 2016, as the validation set, and stock data from January 1, 2017, to December 31, 2020, as the test set. We calculate the Alpha360 for different times as model inputs using the qlib platform, and use the predicted daily return rates as model outputs with the actual daily return rates as labels. To highlight the performance of our model, we compare the GRU-PFG model with other models under the same dataset, comparing metrics such as IC (The Information Coefficient), rank IC, and Precision@N in the test set.\nThe Information Coefficient is an important metric for evaluating stock prediction models. During training and testing, we calculate the Pearson correlation coefficient between the model's predictions and the actual labels. During training, IC is used as the loss function, while during testing, a higher coefficient indicates better prediction performance. Rank IC, or Spearman's rank correlation coefficient, measures the correlation between the predicted ranks and actual ranks of stocks, with a higher coefficient indicating better prediction accuracy. Additionally, following the work of other researchers, we also consider Precision@N as a key evaluation metric. We calculate the proportion of stocks in the top N predicted stocks that are actually in an upward trend. A higher Precision@N indicates that our model better aids investors in improving returns."}, {"title": "5.1 Experiment Setup", "content": "We test our model based on the CSI100 and CSI300 datasets. We use stock data from January 1, 2007, to December 31, 2014, as the training set, stock data from January 1, 2015, to December 31, 2016, as the validation set, and stock data from January 1, 2017, to December 31, 2020, as the test set. We calculate the Alpha360 for different times as model inputs using the qlib platform, and use the predicted daily return rates as model outputs with the actual daily return rates as labels. To highlight the performance of our model, we compare the GRU-PFG model with other models under the same dataset, comparing metrics such as IC (The Information Coefficient), rank IC, and Precision@N in the test set.\nThe Information Coefficient is an important metric for evaluating stock prediction models. During training and testing, we calculate the Pearson correlation coefficient between the model's predictions and the actual labels. During training, IC is used as the loss function, while during testing, a higher coefficient indicates better prediction performance. Rank IC, or Spearman's rank correlation coefficient, measures the correlation between the predicted ranks and actual ranks of stocks, with a higher coefficient indicating better prediction accuracy. Additionally, following the work of other researchers, we also consider Precision@N as a key evaluation metric. We calculate the proportion of stocks in the top N predicted stocks that are actually in an upward trend. A higher Precision@N indicates that our model better aids investors in improving returns."}, {"title": "5.2 Evaluation Results", "content": "The experimental results based on the CSI100 and CSI300 datasets demonstrate a significant advantage of our model over previous models (which only use Alpha360 factors for prediction). GRU-PFG performs exceptionally well across various metrics such as IC, Rank IC, and Precision@N (See Table 3).\nNotably, Our model outperforms the previous sota model HIST on the CSI300 dataset. It's important to note that our model uses only stock factors as input, while HIST incorporates additional industry information and corporate valuations beyond stock factors. Our model achieves better prediction results with fewer inputs. This performance also indirectly highlights the effectiveness of the network in extracting inter-stock correlations.\nIt is worth mentioning that our model exhibits a greater advantage on the CSI300 dataset compared to the CSI100 dataset. One possible explanation is that our model effectively captures the relationships between stocks. As the number of stocks increases, our model can capture more related information, naturally leading to improved performance.\nFurther, we compared the GRU-PFG model with several other models (just based on Alpha360) that performed well in prediction over time. Although models like ALSTM, GRU, and GATs have shown good performance on the CSI300 data, GRU-PFG model still maintains a significant advantage. Looking at the monthly average IC over different periods, GRU-PFG consistently leads by a large margin throughout most of the test period (See Figure 3), with only a few specific months where it is slightly surpassed by the other models."}, {"title": "5.3 Impact of Model Parameters and Structure", "content": "During the experimentation with our model, we made numerous macro and micro adjustments to the structure to achieve better prediction performance. To illustrate the adjustment process and the contribution of each structural component to the overall performance, we conducted ablation experiments to investigate the impact of different parts or sections.\nFrom a macro perspective, our model consists of three main components: (1) Preliminary Information Extraction by GRU (2) Primary Relationship Extraction (3) Secondary Relationship Extraction. We compared the stock trend prediction performance with and without the latter two components. It was observed that as more components are added, the prediction performance improves progressively, especially after incorporating the second-level relationship extraction network, which significantly enhanced the prediction performance on the CSI300 dataset.\nThe effectiveness of our model in capturing stock relationships is a crucial foundation for its superior performance compared to previous models. On a micro level, capturing stock relationships relies on Pearson correlation in Equation 4. Although we also considered using cosine similarity to represent stock correlations, as referenced in other articles [12, 42], it yielded relatively mediocre results. Both in terms of IC and Precision@30 metrics, the Pearson correlation coefficient demonstrated better"}, {"title": "6 Conclusion", "content": "In this paper, we propose a new stock prediction model based purely on Alpha360 factors, called GRU-PFG. This model overcomes the limitations of previous models that were confined to factor relationships and achieved limited effectiveness. By representing the relationships between different stocks using a graph, it provides a new approach for stock prediction, resulting in a significant enhancement of evaluation metrics such as IC on the same dataset.\nIn the future, we hope to promote this model to help more investors achieve higher returns. Additionally, we aim to further improve the model to enhance its prediction performance across various datasets."}]}