{"title": "DESIGN AND EVALUATION OF A CDSS FOR DRUG ALLERGY\nMANAGEMENT USING LLMS AND PHARMACEUTICAL DATA\nINTEGRATION", "authors": ["De Vito Gabriele", "Ferrucci Filomena", "Athanasios Angelakis"], "abstract": "Medication errors significantly threaten patient safety, leading to adverse drug events and substantial\neconomic burdens on healthcare systems. Clinical Decision Support Systems (CDSSs) aimed at\nmitigating these errors often face limitations, including reliance on static databases and rule-based\nalgorithms, which can result in high false alert rates and alert fatigue among clinicians. This\npaper introduces HELIOT, an innovative CDSS for drug allergy management, integrating Large\nLanguage Models (LLMs) with a comprehensive pharmaceutical data repository. HELIOT leverages\nadvanced natural language processing capabilities to interpret complex medical texts and synthesize\nunstructured data, overcoming the limitations of traditional CDSSs. An empirical evaluation using\na synthetic patient dataset and expert-verified ground truth demonstrates HELIOT's high accuracy,\nprecision, recall, and F1 score, uniformly reaching 100% across multiple experimental runs. The\nresults underscore HELIOT's potential to enhance decision support in clinical settings, offering a\nscalable, efficient, and reliable solution for managing drug allergies.", "sections": [{"title": "1 Introduction", "content": "Medication errors pose significant risks to patient safety and lead to adverse drug events (ADEs) [1]. In the NHS in\nEngland, an estimated 237 million medication errors occur annually, with around 66 million being potentially clinically\nsignificant [1, 2]. These errors cost the NHS approximately \u00a398.5 million annually, consume 181,626 bed days, and\ncontribute to 1,708 deaths [1]. Similarly, in the United States, the economic impact is substantial, with medical errors\ncosting an estimated $20 billion annually and healthcare costs for hospital-acquired infections ranging from $35.7 to\n$45 billion [2].\nCDSSs have emerged as vital tools in mitigating medication errors and enhancing patient safety [3]. These systems\nprovide healthcare professionals with evidence-based recommendations and alerts, helping to prevent potential ADEs.\nHowever, traditional CDSSs often face several limitations [3, 4, 5]. They typically rely on static databases and rule-based\nalgorithms, which may not capture the nuances of individual patient cases or the latest medical knowledge [4, 5, 6].\nAdditionally, these systems can generate many false alerts, leading to alert fatigue among clinicians and potentially\ncausing critical warnings to be overlooked [5, 6, 7, 8, 9].\nThe advent of Large Language Models (LLMs), such as GPT-4 [10], offers a promising avenue to address these\nlimitations. LLMs possess advanced natural language processing (NLP) capabilities, enabling them to understand and\ninterpret complex medical texts, such as drug leaflets and patient records. LLMs have already demonstrated success in\nvarious healthcare applications, such as predicting patient outcomes, assisting in diagnostic processes, and generating\nclinical notes [11, 12]. We conjecture that their ability to process and synthesize large volumes of unstructured data\nmakes them an innovative substitute for current rule-based CDSSs, which often lack the flexibility and depth of\nunderstanding required for complex clinical scenarios.\nThis paper presents the design and evaluation of a novel CDSS, HELIOT, specifically tailored for drug allergy\nmanagement. The proposed CDSS aims to overcome the limitations of traditional CDSSs by integrating LLMs with\na comprehensive pharmaceutical data repository and incorporating a human-in-the-loop mechanism [13, 14, 15] to\nimprove the accuracy, efficiency, and reliability of decision support in clinical settings. Our investigation has revealed\nthat HELIOT has high accuracy, reduces alert fatigue, and can provide timely recommendations without significant\ndelays.\nThe primary contributions of this paper are as follows:\n\u2022 We detail the comprehensive pipeline used to collect and preprocess datasets, including drugs, leaflets, and\nsynthetic patient data.\n\u2022 We describe the HELIOT CDSS's modular architecture, highlighting its core components and the methodology\nemployed to provide decision support services.\n\u2022 We present an empirical evaluation of the HELIOT CDSS, comparing its performance against a ground truth\nprovided by medical experts.\n\u2022 We provide datasets and code as a contribution to the research community."}, {"title": "2 Background", "content": "2.1 CDSSS\nCDSSs are pivotal in improving patient safety and clinical efficiency by seamlessly integrating with Electronic Medical\nRecords [16]. Despite their considerable promise, the implementation of CDSSs encounters numerous obstacles. Sutton\net al. [16] highlight several challenges in their systematic literature review, pointing out issues such as the difficulty\nin understanding decisions made by artificial intelligence, the struggle with limited data access, the problem of alert\nfatigue, and the potential for interference with established clinical practices. Additionally, the complexity of navigating\nthrough pharmacology and patient histories adds another layer of difficulty in deploying CDSSs.\nIn pharmacology, CDSSs manage intricate drug interactions and tailor medication recommendations to individual\npatients. The sheer volume of possible drug interactions, influenced by unique patient factors such as genetics and"}, {"title": "2.2 LLMs", "content": "LLMs have revolutionized the field of NLP by leveraging the Transformer architecture with self-attention mechanisms,\nas introduced by Vaswani et al. [24]. Notable examples of these models include commercial offerings such as GPT-3 [25]\nand GPT-4 [10], as well as open-source models like BERT [26], FLAN-T5 [27], LLama [28], BLOOM [29], and\nGLM [30]. LLMs are trained on extensive text datasets and often contain hundreds of billions of parameters [31, 32, 33].\nThe initial \"pre-training\" phase is computationally intensive but essential for enabling these models to perform a wide\nrange of NLP tasks, such as translation and summarization, with high proficiency [31, 32, 33].\nFollowing pre-training, LLMs can be specialized through a fine-tuning process, which involves using smaller datasets to\ntailor the models for specific NLP tasks, such as question-answering or tasks within different domains. Several emergent\nabilities have been discovered in the context of LLMs. The most notable abilities include \"In-context learning,\"\n\"Instruction following,\" and \"Step-by-step reasoning.\" \"In-context learning,\" introduced by GPT-3, allows models to\nperform tasks based on examples without additional training. \"Instruction following\" enables the models to execute\ntasks based solely on given instructions, while \"Step-by-step reasoning\" facilitates solving complex problems through\nchain-of-thought prompting [34]."}, {"title": "2.3 Motivation of our Work", "content": "Existing CDSS solutions often fail to address the peculiarities of individual patient cases and the dynamic nature of\nmedical knowledge. Traditional rule-based CDSSs, which rely on static databases and predefined algorithms, can lead\nto high rates of false alerts and alert fatigue among clinicians [5, 6, 7, 8, 9]. The complexity of drug interactions and\npersonalized medication recommendations underscore the urgent need for more sophisticated and adaptive systems [9].\nTherefore, it is crucial to compare different approaches and allow the research community to develop more reliable and\nefficient methods.\nNonetheless, to our knowledge, there remains a considerable gap in the availability of comprehensive datasets and\nreplication packages for developing and evaluating novel CDSS solutions. Additionally, existing studies do not report\ncomparable metrics such as accuracy, recall, F1-score, or execution time, making direct comparisons between different\napproaches difficult, if not impossible.\nOur work aims to bridge these gaps. On the one hand, we intend to develop a novel CDSS, HELIOT, which leverages\nthe advanced NLP capabilities of LLMs to enhance the accuracy and efficiency of decision support in clinical settings,\nreducing false alerts. On the other hand, we provide a path for the research community to use and compare our\nwork, as no comparable datasets and methods currently exist. Our contributions include detailed datasets, code, and\nmethodologies, which we hope will serve as a valuable resource for future research and development in this field."}, {"title": "3 Data Pipeline", "content": "In the following sections, we report the pipeline used to collect and preprocess the datasets used in our experiments (see\nFigure 1). All the scripts and material are reported in our online repository [35].\n3.1 Data collection\nIn the data collection phase, we gathered the necessary data for our experiments, specifically the datasets for drugs,\nleaflets, and patients. It is worth noting that the patient dataset is a synthetic dataset we created to experiment with our\nCDSS (see Section 3.5).\n3.1.1 Drugs dataset\nThe first step was creating the drug dataset. To this end, an Italian company provided us with the PostgreSQL dump of\nthe database of Italian medicines approved by the Italian Medicines Agency (AIFA) \u00b9. We developed a Python script,\n\"Extract_drugs.py\", to retrieve drugs from the provided database and create the drugs dataset. The drugs dataset has\n243,216 records, but only 106,962 have an associated leaflet. More than half of the drugs are no longer on the market,\nbut we decided to preserve this information because it can be helpful to check if a prescribed drug is allowed in future.\nThe dataset comprises the following columns:\n3.1.2 Leaflets dataset\nThe next step was to collect the leaflets associated with the medications. To make the pipeline production-ready, we\nautomated this step by referring to a pharmaceutical data provider, the Farmadati company. The Farmadati company 2"}, {"title": "3.2 Drugs subset extraction", "content": "We selected a random subset of 1,000 drugs from the complete drug dataset as a preparatory step for creating the\nsynthetic dataset of patients and the CDSS database. This subset formed the foundation for generating the prescription\ndata needed for our synthetic patient profiles and the subsequent \u201cdata preprocessing\u201d step. We developed a Python\nscript, \"drug_subset.py\", to automate the extraction of this random subset. The script ensures that the selection\nprocess is unbiased and that the drugs are chosen randomly from the larger dataset. The resulting subset was saved\nas \"drugs_subset.xlsx\". Following the automated extraction, we manually reviewed the resulting \u201cdrugs_subset.xlsx\"\nfile to ensure data quality and relevance. Specifically, we aimed to avoid having more than two instances of the same\ndrug with different pharmaceutical forms. The rationale behind this decision was to maintain a diverse yet manageable\ndataset, avoiding redundancy that could skew the results of our experiments. During this manual review, we identified\nand removed 5 rows that did not meet our criteria, resulting in a final subset of 995 unique drugs."}, {"title": "3.3 Data preprocessing", "content": "In the \"Data preprocessing\" phase, we had to preprocess leaflet data related to the \"drugs_subset\" dataset. Indeed,\na single leaflet can be valid for several pharmaceutical forms of the same drug. For instance, the leaflet for the\nTACHIPIRINA drug comprises information for TACHIPIRINA syrup and TACHIPIRINA tablets. However, physicians\nadminister a specific pharmaceutical form of a drug. Therefore, we needed to preprocess the following leaflet sections,\nwhich were originally in Italian and required translation to English for further processing:\n\u2022 02.0 QUALITATIVE AND QUANTITATIVE COMPOSITION\n\u2022 04.0 CLINICAL INFORMATION\n\u2022 05.0 PHARMACOLOGICAL PROPERTIES\n\u2022 06.0 PHARMACEUTICAL INFORMATION\nTo this end, we developed a new Python script, \u201cleaflet_preproc.py\", which reads the synthetic dataset, iterates over the\ndrug list, opens the drug leaflet, extracts the leaflet sections, translates them from Italian to English, and exploits GPT-4\nto extract information related to the drug's specific pharmaceutical form. We have designed specific prompts through\nprompt engineering to extract relevant information from the processed leaflet sections. In addition, to reduce the number\nof output tokens, we provided GPT-4 with specific instructions to report \u201c<< ALL >>\u201d in case the analyzed text was\nwholly related to the specific drug and its pharmaceutical form and not to different pharmaceutical forms.\nSpecifically, we followed three main prompt engineering guidelines [36]:\n1. Show and tell: making intentions clear using examples, instructions, or both.\n2. Provide quality data: ensuring enough samples for the model to follow a pattern.\n3. Check settings: setting the model parameters to make the model predictable in responding."}, {"title": "3.4 Populate the CDSS Databases", "content": "Finally, we populated the CDSS databases, namely the drug and synonyms databases, using the \u201cleaflet_info.csv\"\nand \"ingredients_synonyms.csv\" datasets. On the one hand, we implemented the drug database using TileDB [37]\nstarting from the \u201cleaflet_info.csv\" dataset. TileDB is a powerful, multi-dimensional array database that supports\ndense and sparse arrays. This capability makes it an excellent choice for managing complex datasets with varying\ndimensions and attributes, such as the data involved in CDSSs. TileDB's efficient data retrieval and storage compression\nmechanisms are advantageous for high-performance requirements and scalability. TileDB enhances its versatility by\nbeing deployable both as an embedded service and in the cloud. This dual capability makes TileDB an exceptionally\nscalable solution, especially in real-world scenarios where the number of drugs and the volume of associated data"}, {"title": "3.5 Patients Synthetic Dataset", "content": "In this phase, we created the synthetic patient dataset using the \u201ccreate_synth_patients.py\" script. The use of synthetic\ndata in healthcare research is supported by recent literature [39, 40]. For instance, K\u00fchnel et al. [39] highlight\nthe potential of synthetic data to replicate real-world analysis results while maintaining privacy. Giuffr\u00e8 et al. [40]\nemphasize the importance of synthetic data in enhancing data privacy and augmenting datasets for predictive analytics,\nalthough they also point out the challenges such as data quality and bias. In addition, we created a synthetic dataset\nso the community can use and expand it, as we will do in the future. This initiative aims to foster collaboration and\ninnovation in the field, providing a valuable resource for researchers and developers working on similar projects.\nThe dataset has 4,975 rows and contains the following columns:\nStatus is the ground truth and can be as follows:\n\u2022\nEmpty, indicating that the patient is not allergic to the drug's ingredients.\n\u2022 Allergic to an ingredient, indicating that the patient is allergic to one of the drug's ingredients."}, {"title": "3.6 Summary of the datasets", "content": "The following table reports the summary of the datasets collected:"}, {"title": "4 CDSS Design and Methodology", "content": "In the following sections, we describe the overall architecture of the HELIOT CDSS and the methodology used to\nprovide support services.\n4.1 CDSS Design\nThe HELIOT CDSS features an integrated, modular architecture to enhance physicians' decision-making efficiency and\naccuracy. The system's core components include a web application, an API application, and a central controller, as\nshown in Figure 5.\nThe web application is the user interface where physicians can request decision support. This interface forwards\nrequests\u2014such as drug codes and patient allergy information\u2014to the underlying API application.\nThe API application is the communication bridge between the web interface and the CDSS's backend logic. It provides\nRESTful services to handle requests and responses, ensuring efficient and secure data transmission. A key feature of\nthe API application is its ability to stream responses in real-time, similar to how ChatGPT functions. This ensures that"}, {"title": "4.2 CDSS Methodology", "content": "The methodology for providing decision support services to help physicians administer drugs based on a patient's\nallergy involves a multi-step process based on the Retrieval Augmentation Generation (RAG) technique to retrieve drug\ndata, resolve ingredients synonyms, and process the user's request using prompt engineering instructions to deliver the\nfinal answer (see Figure 6).\nThe first step is searching for drug data in TileDB to retrieve detailed information about the administered drug, including\nactive ingredients and excipients. This step augments the original query with the necessary information related to the\nadministered drug which helps the LLM to contextualize the specific medical case.\nThe second step is resolving synonyms related to the patient's allergy information. This step involves translating\nthe provided allergy description into a standardized form that can be accurately cross-referenced with the drug's\ningredients. To this end, we use GPT-4 to translate the provided allergy into English (see Figure 7) and then exploit the\nSynonymManager service to retrieve the commonly used name for the allergy."}, {"title": "4.3 CDSS Prototype", "content": "We developed a proof-of-concept (POC) prototype for the HELIOT CDSS, focusing on key components to demonstrate\nits functionality and effectiveness. The prototype consists of the following main components:\n\u2022 The web application was developed using the Streamlit framework.\n\u2022 The API application was developed using the FAST API and Uvicorn frameworks.\n\u2022 The HELIOT Controller was developed using TileDB and the OpenAI API.\nThe Web application provides the following functionalities:\n1. It allows the user to process a single prescription and then stream the results obtained from the API application\non the web page (see Figure 10).\n2. It allows the upload of an entire dataset, comprising the patient's ID, the prescribed drug code, and the patient's\nallergy, and then processes it using the API application. It also allows the download of the obtained results\n(see Figure 11).\nAll the scripts, results, and source code are provided in our online repository [35]."}, {"title": "5 Experiment Design", "content": "This section describes the empirical experiment we conducted to evaluate the proposed approach. The primary goal\nof the empirical assessment was to analyze the effectiveness of the proposed CDSS. The purpose was to provide\nempirical evidence highlighting the benefits and limitations of the HELIOT CDSS, enabling physicians to be aware of\nthe strengths and weaknesses they would encounter through its use. Specifically, the empirical assessment aimed to\naddress the following research question:"}, {"title": "5.1 Experiment Setup", "content": "To address the research question, we compared the responses from HELIOT CDSS with the ground truth provided by\nan oracle represented by the physicians involved in the data pipeline (see Section 3.5). The comparison involved using\nthe Web Application of the HELIOT CDSS prototype (see Section ??) to facilitate the interaction and validation. The\nsynthetic dataset described in Section ?? contains patients and their respective prescriptions and allergies. Each row in\nthe dataset has a class label as ground truth provided by the two involved physicians. For each patient-prescription pair,\nthe HELIOT CDSS's response was classified as either a correct or incorrect prediction of an allergic reaction based on\nthe ground truth."}, {"title": "6 Results, Discussion, and Future Work", "content": "This section presents and discusses the results achieved, highlighting their implications. Then, it reports our future\nwork.\n6.1 Empirical Results\nWe ran the experiment six times. The main motivation was to ensure consistency across executions and check the\nreliability of the results given the non-deterministic nature of LLMs. During the first execution, we noticed that in three\ncases, GPT-4 did not know the ingredient to which the patient was allergic. The Italian name was not in the knowledge\nbase of the LLM; therefore, we added the necessary synonyms for the following Italian ingredients:\n\u2022 Combreto, which is Combretum;\n\u2022 Etamido, which is Hydroxyethyl starch;\n\u2022 Coclearia, which is Cochlearia officinalis.\nSubsequently, we re-ran the experiment five times. Accuracy, Precision, Recall, and F1-score uniformly reached 100%\nin all the experiments. As regards the execution time, the average execution time was 3.2 seconds, for a total average\ntime of 15,920 seconds for the 4,970 patients measured across the six execution instances.\n6.2 Discussion\nThe empirical results demonstrate the HELIOT CDSS's high effectiveness and reliability in identifying potential allergic\nreactions during drug administration. The system achieved perfect scores across all key metrics: accuracy, precision,\nrecall, and F1-score, reaching 100%. This level of performance indicates that HELIOT consistently and accurately\nidentifies both the presence and absence of allergic reactions, ensuring that healthcare professionals can rely on its\nrecommendations. The involvement of physicians in the ground-truth verification process further validates the system's\naccuracy and practical applicability, leveraging a human-in-the-loop approach to enhance reliability and trustworthiness.\nThese results reveal that HELIOT, thanks to its advanced natural language processing capabilities, can understand\nand interpret complex medical texts, effectively reducing false positives and negatives, improving overall clinical\ndecision-making and overcoming the limitations of traditional CDSSs.\nAnother key aspect derived from analyzing the results is the system's efficiency. The average execution time was\n3.2 seconds per patient to see the overall response on the web application. Importantly, the response is streamed in\nreal-time, similar to how ChatGPT functions, so clinicians can start reading the suggestions immediately as they are"}, {"title": "6.3 Implications and Future Work", "content": "The positive impact of HELIOT CDSS on healthcare is substantial. By enhancing the accuracy and efficiency of\ndrug allergy management, HELIOT contributes to improved patient safety and reduces the incidence of ADEs. This\nimprovement, in turn, can lead to better clinical outcomes and a higher quality of care. The system's scalability and\nreliability make it a valuable tool for healthcare providers globally, potentially transforming how drug allergies are\nmanaged in clinical settings.\nFrom an economic perspective, HELIOT CDSS offers significant cost-saving potential. Medication errors and ADES\nimpose substantial economic burdens on healthcare systems. By reducing these errors, HELIOT can help decrease the\nassociated costs, such as hospital readmissions, extended hospital stays, and additional treatments. By mitigating these\nerrors, HELIOT can contribute substantial cost reductions, freeing up resources that can be redirected toward other\ncritical patient care areas.\nLooking ahead, several avenues for future work can further enhance the capabilities and impact of HELIOT CDSS. One\nkey direction is the expansion of the dataset to include real-world patient data. While the synthetic dataset provided a\nvaluable foundation for initial evaluations, incorporating real-world data will allow for a more comprehensive validation\nof the system's performance in diverse and complex clinical scenarios. This will help ensure that HELIOT can effectively\nhandle the intricacies of real-world clinical data and provide reliable decision support in various healthcare settings.\nAnother important aspect of future work involves optimizing the system's performance to ensure even faster response\ntimes. Although the current average execution time is competitive, further optimization techniques can be explored\nto enhance the system's efficiency. This is particularly crucial in clinical settings where timely decision-making is\nessential. Techniques such as caching mechanisms for allergy translations and LLM responses can be investigated to\nreduce latency and improve overall system performance.\nAdditionally, future research will also focus on refining the system's capabilities to address more complex clinical\nscenarios, such as managing multiple drug interactions and incorporating additional patient-specific factors like genetics\nand lifestyle. Integrating more advanced machine learning algorithms and expanding the system's knowledge base will\nenhance its decision-making capabilities. Evaluating user satisfaction and clinical outcomes will also be essential to\nprovide a more holistic assessment of the system's effectiveness and impact on patient care."}, {"title": "7 Threats to Validity", "content": "In this section, we discuss potential threats to the validity of our study and the measures taken to mitigate them.\n7.1 Internal Validity\nOne threat to internal validity is the synthetic nature of the patient dataset used in our experiments. Synthetic data\nmay not fully capture the complexity and variability of real-world patient data. To address this, we involved two"}, {"title": "7.2 Construct Validity", "content": "Construct validity is another area of concern. The metrics used to evaluate the HELIOT CDSS-accuracy, precision,\nrecall, and F1-score\u2014are standard in classification tasks but may not capture all clinical decision support performance\naspects. Future studies should consider additional metrics, such as user satisfaction and clinical outcomes, to provide a\nmore comprehensive evaluation."}, {"title": "7.3 Conclusion Validity", "content": "Conclusion validity is threatened by the potential overestimation of the system's effectiveness due to the high-\nperformance metrics achieved. We mitigated this by running multiple experiments and ensuring consistent results.\nHowever, further statistical analysis with larger datasets is required to confirm the findings and ensure they are not due\nto chance or specific conditions of the experiments."}, {"title": "8 Conclusion", "content": "The HELIOT CDSS has demonstrated high effectiveness and reliability in providing decision support for drug allergy\nmanagement. By leveraging LLMs' advanced natural language processing capabilities and integrating them with\ncomprehensive pharmaceutical data repositories, the system addresses many limitations of traditional rule-based\nCDSSS. HELIOT achieves perfect Accuracy, Precision, Recall, and F1-score scores across multiple experimental\nruns, along with promising execution performance. Traditional CDSSs often rely on static databases and rule-based\nalgorithms, resulting in high false alert rates and clinician alert fatigue. HELIOT overcomes these issues by using\nLLMs to interpret complex medical texts and synthesize unstructured data, thereby reducing false alerts and enhancing\nclinical recommendation precision. This adaptive system incorporates the latest medical knowledge and patient-specific\ndetails, significantly improving decision support accuracy and relevance. Additionally, integrating a human-in-the-loop\nmechanism ensures expert validation and continuous improvement, effectively addressing real-world clinical scenarios.\nThe positive impact of HELIOT CDSS on the world is substantial. By enhancing the accuracy and efficiency of drug\nallergy management, HELIOT contributes to improved patient safety and reduces the incidence of ADEs. All this, in\nturn, can lead to better clinical outcomes and higher quality of care. Moreover, the system's scalability and reliability\nmake it a valuable tool for healthcare providers globally, potentially transforming how drug allergies are managed\nin clinical settings. From an economic perspective, HELIOT CDSS offers significant cost-saving potential. Indeed,\nmedication errors and ADEs impose substantial economic burdens on healthcare systems. By reducing these errors,\nHELIOT can help decrease the associated costs, such as hospital readmissions, extended hospital stays, and additional\ntreatments, freeing up resources that can be redirected toward other critical patient care areas.\nTherefore, it represents a significant advancement in clinical decision support, promising to improve patient safety and\nhealthcare outcomes.\nFuture work will focus on expanding the dataset to include real-world patient data, optimizing execution times, and\nrefining the system's capabilities to manage more complex clinical scenarios. Additionally, efforts will be made to\nenhance the system's natural language understanding capabilities and to explore its application in other areas of clinical\ndecision support. Further research will also incorporate user satisfaction and clinical outcomes to provide a more\ncomprehensive assessment of the system's effectiveness."}]}