{"title": "Fine-Tuning TransMorph with Gradient Correlation for Anatomical Alignment", "authors": ["Lukas F\u00f6rner", "Kartikay Tehlan", "Thomas Wendler"], "abstract": "Unsupervised deep learning is a promising method in brain MRI registration to reduce the reliance on anatomical labels, while still achieving anatomically accurate transformations. For the Learn2Reg2024 LUMIR challenge, we propose fine-tuning of the pre-trained TransMorph model to improve the convergence stability as well as the deformation smoothness. The former is achieved through the FAdam optimizer, and consistency in structural changes is incorporated through the addition of gradient correlation in the similarity measure, improving anatomical alignment. The results show slight improvements in the Dice and Hd-Dist95 scores, and a notable reduction in the NDV compared to the baseline TransMorph model. These are also confirmed by inspecting the boundaries of the tissue. Our proposed method highlights the effectiveness of including Gradient Correlation to achieve smoother and structurally consistent deformations for interpatient brain MRI registration.", "sections": [{"title": "Motivation", "content": "Deep-learning approaches to brain magnetic resonance imaging (MRI) registration present challenges to achieving realistic anatomical transformations without relying on predefined anatomical labels. Labeled images help produce high segmentation scores, yet often struggle with smoothness and generalizability across unseen data, leading to deformations that lack biological plausibility [2]. Given the availability of expansive neuroimaging datasets, to address these needs in Learn2Reg'24 intersubject T1-weighted brain MRI registration challenge, we propose an unsupervised algorithm tailored to retain structural alignment and minimize deformation inconsistencies. We have focused on fine-tuning the best-performing baseline models to avoid unnecessary re-training, and minimizing the environmental impact. Our approach incorporates gradient correlation for consistent changes in structure and preservation of local structural continuity across subjects. Ensuring alignment of similar structural gradients supports anatomical coherence and enables smoother deformations."}, {"title": "Methods", "content": "To address the Learn2Reg LUMIR challenge, we built on the TransMorph [1] model, for which weights were kindly provided as a baseline model by the challenge organizers. Our main idea consisted of fine-tuning the pre-trained weights of the TransMorph model to help it achieve better results in this unsupervised learning task."}, {"title": "FAdam", "content": "One of our modifications was to employ the Fisher Adam (FAdam) [5] optimizer to improve optimization during training. FAdam is a variant of the Adam optimizer that incorporates principles from natural gradient descent and Riemannian geometry to improve convergence and stability. The key modifications proposed by the authors in FAdam include adjustments to momentum, bias correction, and adaptive gradient scaling, alongside a refined weight decay that respects the geometry of the parameter space. FAdam's superior performance has been demonstrated across multiple domains (language, speech, and image tasks)."}, {"title": "Normalized Gradient Cross Correlation", "content": "Our second modification is the incorporation of the gradient correlation (GC) [4, 8] similarity measure. For two three-dimensional images A and B, GC is defined as\n\\begin{equation}\nGC(A, B) = \\frac{1}{3}(NCC(\\nabla_{x}A, \\nabla_{x}B) + NCC(\\nabla_{y}A, \\nabla_{y}B) + NCC(\\nabla_{z}A, \\nabla_{z}B))\n\\end{equation}\nwhere $\\nabla_x, \\nabla_y, \\nabla_z$ denotes the gradient in directions x, y, z and NCC is the normalized cross-correlation given by\n\\begin{equation}\nNCC(A, B) = \\frac{\\sum_{(i,j)} (A - \\bar{A})(B - \\bar{B})}{\\sqrt{\\sum_{(i,j)} (A - \\bar{A})^2 \\sum_{(i,j)} (B - \\bar{B})^2}}\n\\end{equation}\nWe define the gradient correlation loss LGC as\n\\begin{equation}\nL_{GC} = 1 - GC(I_t, I_s \\circ \\phi)\n\\end{equation}\nwith $I_t$ being the fixed image, $I_s$ the moving, and $\\phi$ the deformation field, and extend the image similarity loss to\n\\begin{equation}\nL_{sim} = L_{IC}(I_t, I_s \\circ \\phi) + \\gamma L_{GC}(I_t, I_s \\circ \\phi)\n\\end{equation}"}, {"title": "Experiments and Results", "content": "We evaluated our approach using data from the 2024 Learn2Reg LUMIR challenge. The dataset consists of over 4,000 preprocessed T1-weighted brain MRI scans from multiple public sources, including OpenBHB [3] and AFIDs [9] (which uses data from OASIS [7]). All images were given in the NifTi format with a resolution of 160 \u00d7 224 \u00d7 192 and a voxel spacing of 1 \u00d7 1 \u00d7 1 mm\u00b3."}, {"title": "Quantitative evaluation", "content": "The performance is evaluated by calculating the segmentation accuracy consisting of Dice and the 95% Hausdorff distance (HdDist95 \u2191). Landmark accuracy is measured using the target registration error (TRE \u2193) of manually annotated landmarks. The final measure is the deformation smoothness, which is quantified by non-diffeomorphic volume (NDV\u2193) [6].\nWe evaluated the performance of three models - \"Baseline\" (which is the TransMorph model provided by the Learn2Reg challenge organizers), \"FAdam\" (which is the TransMorph provided fine-tuned with FAdam) and \"FAdam+GC\" (which is the TransMorph provided fine-tuned with FAdam and GC). For our fine-tuned models, we set the initial learning rate to half of the learning rate used for training the baseline model and used the same scheduler. Both models were trained for an additional 200 epochs and using the version with the lowest evaluation loss at 123 and 170 epochs, respectively."}, {"title": "Conclusion", "content": "Our proposed method builds upon the baseline TransMorph model, leveraging fine-tuned pre-trained weights to enhance unsupervised brain MRI registration. The model incorporates the Fisher Adam (FAdam) optimizer, a variant of the Adam optimizer with concepts from natural gradient descent and Riemannian geometry, to improve convergence stability. The integration of gradient correlation (GC) as a similarity measure aims to maintain anatomical alignment by promoting consistent structural changes and preserving local continuity across subjects.\nQuantitative evaluation on the 2024 Learn2Reg LUMIR challenge data shows that the proposed FAdam+GC model achieves slight improvements in the Dice coefficient and 95% Hausdorff distance (HdDist95) relative to the baseline. Notably, it demonstrates a reduced percentage of non-diffeomorphic volume (NDV), indicating smoother, anatomically plausible deformations. Qualitative analysis also shows enhanced alignment at tissue interfaces with high gradient values, directly impacting HdDist95 metrics. Our proposed method shows the effectiveness of integrating GC in achieving smoother, structurally consistent deformations for interpatient brain MRI registration. Further, reviews from medical experts of the achieved transformed moved images would be highly beneficial in evaluating the anatomical accuracy of our registration method."}]}