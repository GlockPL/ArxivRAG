{"title": "DiffuSETS: 12-lead ECG Generation Conditioned on Clinical Text Reports and Patient-Specific Information", "authors": ["Yongfan Lai", "Jiabo Chen", "Deyun Zhang", "Yue Wang", "Shijia Geng", "Hongyan Li", "Shenda Hong"], "abstract": "Heart disease remains a significant threat to human health. As a non-invasive diagnostic tool, the electrocardiogram (ECG) is one of the most widely used methods for cardiac screening. However, the scarcity of high-quality ECG data, driven by privacy concerns and limited medical resources, creates a pressing need for effective ECG signal generation. Existing approaches for generating ECG signals typically rely on small training datasets, lack comprehensive evaluation frameworks, and overlook potential applications beyond data augmentation. To address these challenges, we propose DiffuSETS, a novel framework capable of generating ECG signals with high semantic alignment and fidelity. DiffuSETS accepts various modalities of clinical text reports and patient-specific information as inputs, enabling the creation of clinically meaningful ECG signals. Additionally, to address the lack of standardized evaluation in ECG generation, we introduce a comprehensive benchmarking methodology to assess the effectiveness of generative models in this domain. Our model achieve excellent results in tests, proving its superiority in the task of ECG generation. Furthermore, we showcase its potential to mitigate data scarcity while exploring novel applications in cardiology education and medical knowledge discovery, highlighting the broader impact of our work.", "sections": [{"title": "INTRODUCTION", "content": "Currently, cardiovascular diseases account for about one-third of all global deaths\u00b9, making them one of the major threats to human health. The electrocardiogram (ECG) is a non-invasive diagnostic tool for heart disease and is widely used in clinical practice\u00b2. This popular assessment provides a comprehensive diagnosis of cardiac activity, but it also places heavy burdens on cardiologists for viewing and interpreting the data. To alleviate this pressure, Many studies have focused on developing ECG classifiers 3\u20135 and using them for automated ECG diagnosis. However, acquiring and sharing real ECG signals presents potential risks due to patient privacy concerns 6,7. Additionally, accurately labeled ECG signals, especially for rare cardiovascular diseases, are scarce, and their acquisition is both resource-intensive and costly. These limitations hinder the application of prevailing deep learning methods in advancing cardiological research and practice. Given these challenges, a critical upstream task is the generation of synthetic ECG signals 8,10.\nIn the field of ECG signal generation, the main research goal is to generate ECG signal samples with high fidelity and rich diversity. Many studies have adopted the Generative Adversarial Network (GAN) architecture to generate ECG signals\u00b9\u00b9, and others have introduced Ordinary Differential Equation (ODE) systems representing cardiac dynamics to create ECG samples. Recently, some new studies have incorporated patient-specific cardiac disease information into the ECG generation process to improve the generated outcomes 9,12, and some have included the content of patients' clinical text reports during generation 13. However, current research in this field still has certain deficiencies: (1) Dataset limitations. Most of the previous ECG datasets contain a limited variety of samples and have low textual richness in clinical text reports. Therefore, generative models trained on such datasets have limited performance and are unable to generate extremely rare ECG signals that are absent from the training data. Although extremely rare ECG samples remain scarce, the newly released MIMIC-IV-ECG14 and MIMIC-IV-Clinical15 provide a large ECG dataset with ample related information, paving the way for generation models with more possibilities. (2) Difficulty in unifying features across different modalities. Clinical text reports and patient-specific information encompass data from various modalities, each with distinct distributions, making it challenging to integrate all this information into a model. Consequently, many ECG generation models rely solely on high-level label information, which limits the diversity of the generated outputs. (3) Lack of benchmarking methods. In the field of ECG generation, there is still a lack of comprehensive benchmarking methods, making it difficult to assess the relative merits of models.\nEqually significant is the growing interest in expanding the applications of generative models beyond merely providing data for other Al models. The capabilities of generative methods, such as Denoising Diffusion Probabilistic Models (DDPM) 16, have been demonstrated, and their potential applications in scientific fields like neuroscience are beginning to be explored 17. However, the full potential of generative models in cardiology remains largely untapped. This raises a compelling question: what additional contributions can generative models make to the field of cardiology? Answering this question presents a meaningful challenge that warrants exploration.\nTo address the aforementioned issues, this paper introduces DiffuSETS, a Diffusion model to Synthesize 12-lead ECGs conditioned on clinical Text reports and patient-Specific information. Our approach is the first work to use diffusion models to handle ECGs generation from text. DiffuSETS utilizes the MIMIC-IV-ECG dataset as the training dataset, which features a wide variety of characteristics suitable for ECG signal generation and enhances the diversity of the generated signal samples. We also design a comprehensive evaluation, which includes quantitative and qualitative analyses at the signal level, feature level, and diagnostic level. Such testing allows for a comprehensive evaluation of the performance of generative models. We have also incorporated a clinical Turing test, involving evaluations by cardiologists, to ensure the high fidelity of the generated ECG samples. High level overview of our work are shown in Figure 1A. Furthermore, to explore the potential contributions of DiffuSETS, we not only demonstrate its ability to enhance downstream deep learning models but also use it to generate ECG signals under complex cardiac conditions and extremely rare heart diseases for cardiological education. Finally, we rigorously show that DiffuSETS can capture latent causal links between ECG signals and non-cardiac conditions, positioning it as a valuable tool for medical knowledge discovery.\nThe main contributions of this paper are as follows: (A) We introduce DiffuSETS, an ECG signal generator that accepts clinical text reports and patient-specific information as inputs. This is the first work to use diffusion models trained on MIMIC-IV-ECG dataset for generating ECGs from text. ECG signal samples with high semantic alignment can be generated by just inputting simple natural language text as a description of the patient's disease information. We can also accept inputs such as heart rate, sex, and age, adding constraints to the features of the generated ECG signals, thus making the generation of ECG signals more detailed and diverse. (B) We have designed a set of comprehensive evaluation to evaluate the effectiveness of ECG signal generation, which can comprehensively assess the performance of generative models. Our method is tested within this comprehensive evaluation and a Turing test. Both results are very significant, demonstrating the fidelity and semantic alignment of the model-generated ECG signal samples. (C) We address the challenge of data scarcity by applying DiffuSETS-generated ECGs to downstream tasks, showing through careful experimentation that the model offers significant benefits to ECG auto diagnosis. Furthermore, we explore the potential of DiffuSETS in promoting cardiological education and facilitating medical discoveries. This endeavor underscores the versatility of our model and the broader significance of our work."}, {"title": "RESULTS", "content": "In this paper, we propose DiffuSETS, a diffusion model capable of generating 12-lead ECGs from clinical text reports and patient-specific information. The architecture of DiffuSETS is illustrated in the Figure 1B, involving three modalities: signal space, latent space, and conditional information space (clinical text reports and patient-specific information). The variational autoencoder facilitates the conversion of vectors between signal space and latent space, while a prompted large language model, serving as the semantic embedding model, extracts embedding vectors from clinical text reports to capture semantic information, which are then merged with a embedding vector generated from patient-specific information. Finally, the denoising diffusion process and noise prediction model collaboratively achieve the cross-modal generation from text to electrocardiographic latent variables.\nWe use the MIMIC-IV-ECG dataset14 for training DiffuSETS, which contains 794, 372 12-lead ECG signal records after preprocessing. From this dataset, we extract heart rate features and corresponding clinical text reports. Then, using patient ID as key, we query the MIMIC-IV-CLINICAL dataset patient table to retrieve patient-specific information, such as sex and age. Additionally, we utilize PTB-XL dataset, which contains 299, 712 samples, for external validation and comparison with other baseline models."}, {"title": "DiffuSETS can generate high fidelity ECG", "content": "Our conprehensive evaluation involves experiments and analysis at the signal level, feature level, and diagnostic level. The overall design is shown in Figure 1C. In this framework, we aim to ask three key questions regarding ECG signals generated from clinical text reports and patient-specific information:\n1. (Signal level) Does the generated ECG signal resemble real ECG signals?\n2. (Feature level) Are the input features accurately reflected in the generated signals?\n3. (Diagnostic level) How closely does the generated ECG align with the corresponding clinical text report?\nThese questions guide our evaluation of the effectiveness and relevance of the generated ECG signals in capturing both the clinical context and the underlying physiological characteristics. DiffuSETS acheives remarkable scores in this three level comprehensive evaluation, results are listed in Table 1.\nAt the signal level, we focus on the fidelity and stability of the generated signals by evaluating various metrics that assess both the distribution similarity and the structural resemblance between real and generated ECG signals. First, we calculate the Fr\u00e9chet Inception Distance (FID) score to measure the distribution similarity between the two sets of signals. Since the FID score only assesses data distribution through macro scope of mean and variance, we also evaluate waveform-level similarity to ensure the quality of the generated ECG signals. For phase deviations may occur between the generated and real signals, traditional Mean Absolute Error (MAE) is not a reliable metric for assessing similarity. Instead, we adopt the brilliantly proposed method 18, which calculates precision and recall by counting the ratio of generated ECG signal representation points that fall within the manifold constructed by the real ECG signal representation points, and vice versa (illustrative cases are depicted in Figure 2C). Finally the F1 score is derived to assess the overall performance of accuracy and diversity. We use a pretrained Net1D19 as the encoder to obtain ECG representations in signal level assessment. The results shows that the ECG signals generated by DiffuSETS resemble the real ECG signals in both signal distribution and representation manifold, which proves the fidelity and stability of generated signals.\nAt the feature level, we examine whether the ECG signals generated by the model align with the input descriptions of patient-specific information. Considering that sex and age are difficult to measure through quantitative analysis, we choose heart rate as the focal point for testing. Our approach involves using the condition in ground truth sample as the input and obtaining heart rate value of generated ECG signal. Besides computing the MAE between input heart rate and heart rate of generated ECG signal, we depict scatters plots of the heart rate pairs (Figure 2A) respectively to visualize the result. It is suggested that patient-specific information significantly reduces the heart rate deviation, which demonstrates that our model can generate conditional ECG signals finely based on the heart rate information contained in the patient-specific information. Moreover, the inclusion of patient-specific information also empowers DiffuSETS to perform more flexible generation concerning with physiological conditions, which enlightens the medical discoveries.\nAt the diagnostic level, we assess whether the generated ECGs conform to the descriptions of the disease, that is, the content of the clinical text reports. We use CLIP scores 20 to assess the semantic alignment between the ECG signals generated by the DiffuSETS and the input clinical text report. This process can be viewed as use a text-ECG encoder that has already achieved semantic alignment in real dataset to measure whether the ECG signals generated by our model match the disease conditions. Similar to the method in signal level assessment, we use the Net1D19 as ECG encoder and deploy an MLP to project text embedding output by Large language model into the aligned space. In diagnostic assessment, DiffuSETS achieves a substantial performance in clinical alignment, which proves that it learns the hidden relationship between clinical text report and ECG waveform. Additionally, readers are encouraged to revisit the scatter plot in feature level (Figure 2A) and observe the results of the DiffuSETS model without patient-specific information (represented by orange filled plus). Notably, these points tend to form three distinct clusters centered around (55, 55), (80, 80), and (110, 110), despite the absence of heart rate input. This phenomenon suggests that model has learned the rhythmic information from clinical text report, because the clustering in fact corresponds to typical heart rates associated with rhythmic report \u201csinus bradycardia\u201d (heart rate below normal), \u201csinus rhythm\u201d (normal heart rate), and \u201csinus tachycardia\u201d (heart rate above normal).\nTo evaluate signal quality in greater detail, we utilize DiffuSETS to generate ECG signals corresponding to various cardiac conditions. Since the MIMIC IV ECG dataset lacks class-level labels, we parse the clinical text reports and employ keyword matching to select appropriate samples. The curated labels cover a wide range of common cardiac conditions, as listed in Figure 2D, offering a comprehensive view to test generation and alignment ability of DiffuSETS. For the generated ECG signals, we assess precision, recall, F1 score, and CLIP score, as illustrated in Figure 2E. The results indicate that DiffuSETS produces samples of consistently high quality across most cases. Additionally, the findings suggest that our approach effectively resists data imbalances in the training dataset, as the number of ECG signals varies significantly across different conditions. A plausible explanation is that the model learns fundamental waveform patterns from a large number of training samples, thus only requiring relatively fewer examples to capture distinctive features and adjust outputs to align with specific distributions.\nFinally, for external validations, we directly perform the three level test using PTB-XL dataset without modifying models. The result is shown in Table 1. DiffuSETS can still generate high quality ECG on other clinical text report system without any fine-tuning, which reflects the generalization ability credited to the usage of LLM and our prompt design."}, {"title": "DiffuSETS outperforms other ECG generation methods", "content": "In addition to comparing DiffuSETS with its ablation models, we conducted an experiment on the PTB-XL dataset to compare it against popular ECG/time series generation methods. While other open-source models cannot generate ECG signals based on clinical text reports or patient-specific information, we evaluated the overall quality of the generated ECG signals using signal level tests. Among the baseline models, all of which condtioned on labels, WAVEGAN21 is for general time series synthesis, Pulse2Pulse 22 and SSSD-ECG\u00b9\u00b9 are models specifically tailored for ECG generation.\nAs shown in Figure 2B, our method achieves the highest quality ECG generation in all four metrics. Furthermore, it is worth noting that other baseline models exhibit a noticeable gap between precision and recall scores. We conclude it to the fact that the manifold of ECG signals generated by other methods is much smaller than that of real ECG signals 18, as illustrated in Figure 2C(a)(c). That is, the diversity of the generated ECG signal does not match the real one. However, DiffuSETS does not experience a decline in recall scores, as illustrated in Figure 2C(b)(d), demonstrating the effectiveness of conditioning on clinical text reports and patient-specific information. Moreover, in practical applications, the diversity of DiffuSETS-generated ECGs can be further improved by adjusting the input clinical text reports and patient-specific details\u2014an advantage that models conditioned solely on labels cannot provide."}, {"title": "DiffuSETS has the potential to pass the Turing test", "content": "We conduct two kinds of cardiologist evaluation test. In the fidelity evaluation, we extract feature information from 50 records in the MIMIC-IV-ECG dataset, using as input to generate 50 ECG signals, and then randomly select another 50 ECG signals from the MIMIC-IV-ECG dataset. We provide these generated data alongside the real data to cardiologists for Turing test assessment. The cardiologists are tasked with determining whether the provided ECGs are generated by a machine. The judgements are recorded in Figure 3A. In the test for semantic alignment, we provide 100 generated ECGs (using different conditions, especially clinical text reports, recorded in MIMIC-IV-ECG). Experts are asked to determine whether our generated results matched all the descriptions in the clinical text reports.\nIn Turing test, despite different cardiologists may have different criteria for distinguishing real and generated ECG, which results in quantity gap of total number of ECG judged to be model-generated, judgments made by the same cardiologist show non-discrimination for real and generated ECG, i.e. the TP(Generated ECG judged as generated) value is close to FP(Real ECG misjudged as generated) value within the same row. This consistency indicates that even experienced cardiologists struggle to differentiate between real and generated ECG signals. Moreover, the significant proportion of false negatives (generated ECG misjudged as real) further underscores the high fidelity of the ECG signals produced by the DiffuSETS model, making them virtually indistinguishable from real ones. For alignment test, according to expert evaluation, the accuracy of semantic alignment in the electrocardiogram generated by DiffuSETS has reached 76%. Actually it is a relatively hard task since all reports need to check the consistency before the ECG data can be judged as alignment, there are still more than three-quarter generated ECGs are considered matching to input clinical text reports, which indicates that DiffuSETS model do grasp the diagnostic information between signal and text modalities when expanding the diversity of generated ECG signals."}, {"title": "DiffuSETS can enhance the performance of ECG diagnosis, particularly for rare diseases", "content": "A key objective of our efforts is to solve the deficiency of labeled ECG signals, particularly for rare cardiovascular diseases. To prove that DiffuSETS can generate medical data with high fidelity and without privacy issues, thus enhancing the potential of deep learning models in downstream tasks, we design three binary classification experiments. For each experiment, we filter out 50,000 ECG samples from the MIMIC-IV-ECG dataset by detecting kerword in the associated clinical text report and then partition to percentage of 80%, 10% and 10% for training, validation and test. Note that all three tasks suffer from varying degrees of data imbalance, with the most severe case exhibiting a quantity ratio of nearly 15:1, reflecting the challenges commonly encountered in real-world deep learning model training. We use DiffuSETS to generate ECG samples for the minority class, thereby creating a more balanced training dataset. Figure 3B(a)(c)(e) shows the statistics of three datasets before and after augmentation. In addition to training directly with the original dataset, we also evaluate the weighted cross-entropy loss method, where the weight for the minority class is set according to the imbalance ratio. We adopt the NET1D19 as the classifier, with modifications made only to the output layer.\nAs shown in Figure 3B(b)(d)(f), when trained directly on the original dataset, the model tends to classify all samples into the majority class due to severe data imbalance (evident in the AF/Non-AF and PVC/Non-PVC tasks). The weighted loss method mitigates this issue to some extent but degrades performance when the imbalance is less severe (as seen in the Normal/Abnormal task). In contrast, the model trained on the augmented dataset achieves the best results across all three experiments, effectively addressing the imbalance problem. These findings not only demonstrate the fidelity of the signals generated by DiffuSETS again, but also highlight its potential to enhance downstream tasks, which is one of the key motivations."}, {"title": "DiffuSETS can promote cardiological education and initiate new medical discoveries", "content": "Accurately interpreting ECGs under various heart conditions is a critical component of cardiology education. With the support of DiffuSETS, learners can generate ECG signals tailored to specific conditions of interest, thereby broadening their exposure and understanding. To demonstrate DiffuSETS' capability to handle complex cardiac conditions, we present a case study of generated ECG signals (Figure 4A) and provide an explanation of how they align with the input clinical text reports.\nThe input clinical text report for this electrocardiogram (Figure 4A) is \"1. Atrial fibrillation with PVC(s) or aberrant ventricular conduction. 2. Left anterior fascicular block. 3. Anteroseptal infarct age undetermined. 4. Left ventricular hypertrophy. 5. Lateral ST-T changes may be due to hypertrophy and/or ischemia. 6. Abnormal ECG.\", with a heart rate of 79 beats per minute and the male patient is 96 years old. The patient suffers from multiple concurrent severe arrhythmias, making it difficult to generate. Overall, it is an abnormal ECG. The generated ECG has a heart rate of approximately 80 beats per minute, which is consistent with the input information. The patient's RR intervals are irregular, and the P waves are absent, which is characteristic of atrial fibrillation. The QRS complex of the 9th heartbeat is significantly different from the others, being wide and malformed, indicating the occurrence of a ventricular premature beat. Moreover, the overall width of the QRS complex is wider, suggesting that the patient's ventricular conduction is abnormal, specifically diagnosed as left anterior fascicular block. In addition, the patient exhibits changes in the ST segment and T wave, indicating that the patient may have severe symptoms of myocardial ischemia or infarction. Finally, the voltage of the QRS complex is high, suggesting the possibility of left ventricular hypertrophy. This case sufficiently proves that our model is competent to generate ECG under a complex cardiac condition.\nThe other significant limitation in current cardiology education is the scarcity of ECG examples for extremely rare heart diseases, such as Brugada syndrome 23 and Long QT syndrome 24, both of which are often associated with a high risk of sudden cardiac death. Diagnosing these rare conditions typically relies on memorizing a few waveform patterns outlined in textbooks. Thus, it would be highly beneficial for cardiologists to have access to an ample supply of ECG samples for specific cases. However, the rarity of these diseases poses a challenge for conventional conditional generative learning methods, which require a large number of labeled training samples to model the relationship between conditions and data distributions effectively. To address this issue, we propose a novel framework leveraging DiffuSETS in conjunction with large language models, enabling the generation of ECG signals for rare cardiac conditions (Figure 4B).\nThe proposed framework operates in two stages. First, a large language model is queried to extract and summarize the ECG abnormalities and clinical characteristics associated with the target condition. Considering the potential hallucination of large language model, if necessary, expert review mechanisms can also be incorporated to ensure correctness. Second, the information is integrated with our custom-designed ordered prompt to generate a text embedding, which DiffuSETS then utilizes, along with predefined patient-specific informations, to generate ECG signals representative of the target rare disease. This two-stage framework effectively integrates the knowledge representation capabilities of large language models with the generative capabilities of DiffuSETS. By overcoming the data scarcity challenge, this approach enables the generation of realistic ECG signals for extremely rare cardiac conditions, providing a valuable resource for both educational and clinical applications. As an instance, We use this two-stage framework to generate ECG signal under the rare Brugada syndrome. The resulting ECG (Figure 4B) shows clear signs of right bundle branch block and persistent ST segment elevation, both of which are the typical signs of Brugada syndrome and match the canonical waveform patterns depicted on cardiology literature 23. This result not only validates the proposed two-stage framework but also demonstrates that DiffuSETS is capable of generating ECG signals for extremely rare heart conditions.\nFinally, we explore the potential of using DiffuSETS to initiate new medical discoveries, specifically focusing on uncovering hidden causal links between ECG signals and non-cardiac diseases. In previous training and experiments, we all utilized the ECG-related clinical text report as input, which contains abundant morphological information describing the ECG's characteristics. Here, we demonstrate through two validated cases that DiffuSETS can also generate plausible ECG signals by taking input related to non-cardiac conditions. This capability highlights its potential to uncover new medical insights about the relationships between non-cardiac conditions and ECG signals.\nIn the first case, we show that DiffuSETS can generate ECG signals related to the patient's heart age, showcasing its potential to aid in discovering age-related cardiological knowledge. Heart age 25 is a clinically significant concept that reflects the functional and structural aging of the cardiovascular system, which is influenced by both intrinsic cardiac factors and external conditions, such as lifestyle, comorbidities, and vascular health. While heart age may not directly equal to chronological age, it also carries great medical significance, capturing the cumulative effects of aging and pathological processes on the heart and vasculature. To evaluate the ability of DiffuSETS to model heart age, we extract clinical text reports and patient-specific information from real ECG signals in the MIMIC-IV-ECG dataset, which are used as input for generating ECG signals. We then employ the AnyECG model 26 to estimate the heart age for both the real(reference) and generated ECG signals. The resulting scatter plot, shown in Figure 4C, illustrates a significant correlation (r = 0.594, p < 0.001) between the heart ages of real(reference) and generated ECG signals. This finding demonstrates that DiffuSETS can effectively model age-related trends in ECG signals, highlighting its potential utility in cardiological research. For instance, it could play a key role in identifying age-specific ECG patterns, simulating rare cardiac conditions associated with particular age groups, and deepening our understanding of the relationship between aging and cardiovascular health.\nIn the other case, we examine hyperkalemia, a condition characterized by elevated potassium levels (K+) in the blood. While hyperkalemia is not a cardiac disease, it is well-known to impact ECG signals. To test if DiffuSETS can capture the latent relationship, we use the text input \u201cThe patient has hyperkalemia.\u201d along with patient-specific information: \u201cGender: Male, Age: 50, Heart Rate: 90 bpm.\u201d for generation. The resulting ECG signal (Figure 4D) aligns with documented trends in ECG waveforms affected by rising potassium levels 27, including the presence of peaked T waves, widening of the QRS complex, and the progression of the ECG waveform toward a sinusoidal pattern. Even with alternative text input, such as \u201cThe patient has high potassium levels in the blood,\u201d DiffuSETS consistently produces ECG signals exhibiting characteristic peaked T waves. This result underscores the model's ability to identify and represent hidden causal relationships between non-cardiac conditions and ECG signals. Importantly, this capability is achieved despite the absence of explicit cardiac cues in the input conditions, potentially attributed to the similarities of deep embeddings derived from large language models, which capture associations between non-cardiac conditions and ECG-related clinical text reports. To some extent, DiffuSETS functions as an interpreter, visualizing the obscure medical knowledge embedded within large language models. Thus, whether as a method to validate hypotheses or a tool for inspiration, we believe DiffuSETS holds promise for uncovering new medical knowledge and expanding our understanding of the interactions between various medical conditions and physiological signals."}, {"title": "DISCUSSION", "content": "The electrocardiogram (ECG) is an essential tool in cardiological diagnosis, serving as a foundation for detecting and understanding various heart conditions. However, as deep learning continues to revolutionize medical research, the lack of high-quality, annotated ECG data has become a critical bottleneck, especially when it comes to rare diseases where data is inherently limited. This scarcity hampers the development and evaluation of advanced models, reducing their effectiveness in real-world applications. While several studies have introduced generative models for synthesizing ECG signals, these models typically rely on small dataset, are conditioned solely on high-level labels, such as general disease categories, and often lack a systematic and robust methodology to assess the fidelity, diversity, and clinical relevance of the generated signals. More importantly, there is growing interest in exploring how these ECG generative models can have a broader impact on the medical domain. Beyond addressing data scarcity, such models hold significant promise for advancing cardiology education by providing diverse and condition-specific ECG signals for learning. Furthermore, they could contribute to medical knowledge discovery by enabling the exploration of other physiology conditions, paving the way for novel insights and innovations in healthcare.\nMotivated by aforementioned concerns, we present DiffuSETS, a novel electrocardiogram (ECG) generative model that leverages clinical text reports and patient-specific information to produce ECG signals with high fidelity and strong semantic alignment. To validate our approach, we develop and test DiffuSETS on a comprehensive evaluation framework, which includes signal, feature and diagnostic levels, highlighting the fidelity and semantic accuracy of the generated ECG samples. DiffuSETS also outperforms baseline models, particularly in generating diverse ECG signals. Besides the objective numerical metrics, we conduct a Turing test, the results of which reveals that even experienced cardiologists struggle to distinguish between real and DiffuSETS-generated ECGs. For the aspect of application, DiffuSETS effectively addresses data scarcity by providing high-quality synthetic ECG signals, which significantly enhance downstream tasks. Finally, we demonstrate the potential of DiffuSETS in medical education and knowledge discovery, showcasing its broad applicability and value.\nDiffuSETS can provide a comprehensive and adaptable solution to several pressing challenges in clinical research and healthcare. By tackling the issue of data imbalance, it enables the generation of synthetic ECG signals for rare and underrepresented conditions based on clinical text reports. This capability not only enriches dataset diversity but also enhances the robustness of machine learning models in real-world clinical applications, ensuring they perform effectively across a wide range of scenarios. Additionally, the ability of DiffuSETS to generate ECG signals that align closely with clinical reports creates new opportunities in medical education and research. Educators and learners can use these tailored ECGs to better understand the intricate relationships between symptoms, diseases, and their corresponding ECG patterns, offering a dynamic and practical way to study complex cardiac conditions. This feature also holds significant potential for advancing knowledge discovery, as it allows researchers to explore and uncover causal links and patterns within cardiovascular data that may not be immediately apparent in traditional datasets. Last but not least, it is important to note that DiffuSETS is a promising tool, and while we have highlighted only a few immediate applications, we believe its potential extends far beyond these examples, driven by the creativity and innovation of the research community.\nFuture directions for conditional ECG generation include enhancing DiffuSETS to facilitate the creation of digital twins by conditioning ECG generation on patient-specific ECG signals. This advancement would enable personalized healthcare predictions and solutions, offering individualized ECG data that could be instrumental in patient monitoring, providing a reliable basis for critical clinical decision-making. Another promising avenue is the development of a prospective ECG agent. By leveraging large language models, ECG generation can be conditioned on more diverse and aligned modalities such as clinical text, imaging data, or other diagnostic inputs. On top of that, integrating DiffuSETS into an ECG agent powered by large language models could further amplify the potential of agent. This combination could extend its capabilities beyond traditional applications, making it a versatile tool in fields such as cardiology education, real-time diagnosis, and the development of predictive healthcare systems. Together, these advancements would not only expand the applicability of ECG generative models but also drive innovation across a wider range of medical and research domains."}, {"title": "Conclusion", "content": "In this paper, we introduce DiffuSETS, a 12-lead ECG generation model contioned on clinical text report and patient-specific information. DiffuSETS shows its supremacy in the three level evaluations and cardiologist Turing test. We also demonstrate and showcase the application of DiffuSETS for addressing data scarcity as well as promoting medical education and knowledge discovery."}, {"title": "METHODS", "content": "There are many studies currently attempting to address the generation of electrocardiogram (ECG) signals, but these methods have several limitations. Firstly, many models can only generate short-term time series 28\u201331, enabling them to produce only the content of a single heartbeat, rather than long-term ECG recordings. Secondly, they are often trained on small datasets with a limited number of patients 32, or they use only a limited set of conditional labels 8,33,34. In addition, many of these methods require ECG segmentation as a pre-training step, rather than directly processing noises 8,30,31,33. Moreover, many of these methods are capable of generating and classifying for specific patients only34, and lack comprehensive training data and samples aimed at the general population 22.\nIn recent studies, some researchers have attempted to apply diffusion models to the generation of ECGs 11, treating ECGs as images rather than time series, and their methods were limited to the unconditional generation of single-lead ECGs. Moreover, from a quantitative performance evaluation perspective, these methods have not surpassed those based on GANs for generating ECGs. ME-GAN\u00ba introduces a disease-aware generative adversarial network for multi-view ECG synthesis, focusing on how to appropriately inject cardiac disease information into the generation process and maintain the correct sequence between views. However, their approach does not consider text input, and therefore cannot incorporate information from clinical text reports. Auto-TTE 13 proposed a conditional generative model that can produce ECGs from clinical text reports, but they also segmented the ECGs as a preprocessing step. SSSD-ECG12 introduced a conditional generative model of ECGs with a structured state space, encoding labels for 71 diseases and incorporating them into the model training as conditions, but it cannot accept clinical text reports in the form of natural language text, thus lacking some of the rich semantic information inherent in disease diagnosis. At the same time, due to the lack of a unified performance evaluation setup, it is often challenging to quickly assess the relative merits of these methods."}, {"title": "Model Architecture", "content": "The network architecture of DiffuSETS comprises a training phase and an inference phase, as depicted in Figure 1B. In the training phase, we first extract 12-lead ECG signal x from the ECG dataset. The signal-space representations of 12-lead ECG is then compressed by the encoder $\\mathcal{E}$ of variational autoencoder35 to obtain latent-space representation of the ECGs36, marked as $z_0$. Corresponding clinical text reports, after processing with prompts and utilizing an LLM, are transformed into a text embedding vector. Patient-specific information is also processed into a patient-specific embedding vector and merged with the text embedding vector to form a condition embedding vector c, which is then incorporated into the model's training. Subsequently, the denoising diffusion probabilistic model (DDPM, 16) scheduler continuously adds Gaussian noise $e_t$ to get the latent-space representation $z_t$ at randomly sampled time step t through forward process formula: $z_t = \\sqrt{\\bar{a}_t}z_0 + \\sqrt{1 - \\bar{a}_t}\\epsilon_t, \\ \\epsilon_t \\sim \\mathcal{N}(0, I)$.\nThe noise predictor, fed with the noisy latent-space representation $z_t$, current time step t and the condition embedding vector c, is trained to predict that noise. The loss function of the training phase is defined as:\n$\\mathcal{L}_{DiffuSETS} = || \\epsilon_t - \\hat{\\epsilon}_\\theta (z_t, t, c) ||^2$\nwhere $\\hat{\\epsilon}_\\theta (z_t, t, c)$ stands for the output of noise prediction model. By performing gradient descend on Equation 1, we can raise the Evidence Lower Bound (ELBO) so as to maximize the log likelihood of the training samples 16."}, {"title": "Inference phase", "content": "In the inference phase, the initial ECG signal latent $z_T$ is a noise vector sampled from the standard normal distribution. At each point during time step descends from T to 1, the noise prediction model attempts to predict a noise $\\epsilon_\\theta(z_t, t, c)$ with the assistance of the input clinical text reports and patient-specific information. Then, the denoising diffusion probabilistic model scheduler denoises the latent-space representation $z_t$ to retrieve $z_{t-1}$ through a sampling process:\n$z_{t-1} \\sim \\mathcal{N}(\\mu_q, \\sigma^2_t I)$\n$\\mu_q := [\\sqrt{a_t} (1 - \\bar{a}_{t-1}) z_t + \\sqrt{\\bar{a}_{t-1}} (1 - a_t) \\epsilon_\\theta(z_t, t, c)] / (1 - \\bar{a}_t)$\n$z_0 := [z_t - \\sqrt{1 - \\bar{a}_t} \\hat{\\epsilon}(z_t, t, c)]/\\sqrt{\\bar{a}_t}$\n$\\sigma_t^2 := (1 - a_t) (1 - \\bar{a}_{t-1}) / (1 - \\bar{a}_t)$\nwhere $a_t$ is the hyperparameter related to diffusion forward process noise. Finally, our trained decoder $\\mathcal{D}_\\theta$ reconstructs the normal 12-lead ECG signal based on the denoised latent-space representation, producing a signal-space ECG waveform series that aligns with the input descriptions."}, {"title": "Variational Autoencoder", "content": "The variational autoencoder35 consists of two parts: a encoder $\\mathcal{E}_\\theta$ to compute the mean and variance of latent normal distribution of input ECG signal x and a decoder $\\mathcal{D}_\\theta$ to reconstruct the latent vector z back to ECG signal. The latent-space representation is computed through reparameterization method (Equation 6) to enable the gradient pass through the discrete sampling process.\nz ~ N(\u03bc"}]}