{"title": "ILLM-TSC: INTEGRATION REINFORCEMENT LEARNING AND LARGE LANGUAGE MODEL FOR TRAFFIC SIGNAL CONTROL POLICY IMPROVEMENT", "authors": ["Aoyu Pang", "Maonan Wang", "Man-On Pun", "Chung Shue Chen", "Xi Xiong"], "abstract": "Urban congestion remains a critical challenge, with traffic signal control (TSC) emerging as a po- tent solution. TSC is often modeled as a Markov Decision Process problem and then solved using reinforcement learning (RL), which has proven effective. However, the existing RL-based TSC system often overlooks imperfect observations caused by degraded communication, such as packet loss, delays, and noise, as well as rare real-life events not included in the reward function, such as unconsidered emergency vehicles. To address these limitations, we introduce a novel integration framework that combines a large language model (LLM) with RL. This framework is designed to manage overlooked elements in the reward function and gaps in state information, thereby enhanc- ing the policies of RL agents. In our approach, RL initially makes decisions based on observed data. Subsequently, LLMs evaluate these decisions to verify their reasonableness. If a decision is found to be unreasonable, it is adjusted accordingly. Additionally, this integration approach can be seamlessly integrated with existing RL-based TSC systems without necessitating modifications. Ex- tensive testing confirms that our approach reduces the average waiting time by 17.5% in degraded communication conditions as compared to traditional RL methods, underscoring its potential to ad- vance practical RL applications in intelligent transportation systems. The related code can be found at https://github.com/Traffic-Alpha/iLLM-TSC.", "sections": [{"title": "1 Introduction", "content": "Traffic congestion has become a critical issue in urban governance. The increasing number of vehicles in urban areas significantly impacts travel efficiency, increases traffic accidents, and exacerbates environmental pollution. Advances in electronics and computer technology have paved the way for intelligent transportation systems, which aim to en- hance transportation efficiency through optimized control and scheduling decisions. Intelligent traffic signal control (TSC) systems, in particular, offer a viable solution to address these efficiency and safety-related challenges [1]. Tra- ditional TSC schemes, such as the Webster method [2] and SCATS [3], provide foundational approaches to TSC system design. However, these methods are heavily reliant on predetermined parameter settings and struggle to adapt dynamically to fluctuations in traffic flow [4].\nTo address the limitations of traditional TSC methods, recent research has employed reinforcement learning (RL) to utilize real-time sensor data at intersections for decision-making [5]. RL is capable of learning from data and dy- namically adjusting control strategies to accommodate real-time variations in traffic, showing impressive performance in both single-intersection and multi-intersection scenarios. The effectiveness of RL has been confirmed in large- scale implementations. However, most existing studies that apply RL in TSC operate under the assumption of perfect observation conditions and absence of communication issues, which are not reflective of real-world scenarios. For instance, as shown in Fig. 1, the communication process among vehicles, roadside units (RSUs), and base stations can face problems such as packet delays, losses, and noise. These issues can significantly degrade the performance of RL models [6]. When dealing with degraded communication scenarios, RL-based methods may make erroneous decisions, potentially jeopardizing traffic safety [7, 8]. Moreover, very few works consider long-tail scenarios, such as those involving emergency vehicles [9]. These challenges undermine the reliability of RL-based methods in practical applications, presenting substantial obstacles to the real-world deployment of RL-based TSC.\nRecognizing the limitations of both traditional methods and RL alone, researchers have begun to explore alternative solutions that leverage new technological paradigms. Large Language Models (LLMs) are considered prototypes of General Artificial Intelligence (GAI) and are seen as potential solutions for addressing the adaptability issues of TSC algorithms to dynamic environments [10]. Some efforts have begun exploring the application of LLMs in TSC. For example, [11] proposed a framework that utilizes LLMs to optimize urban TSC, overcoming the limitations of traditional methods in coping with rapidly changing traffic environments. Similarly, [12] developed a model called LA-Light, providing agents with various tools to address complex TSC challenges in the real world. However, despite LLMs' excellent performance in solving decision problems by enhancing the model's generalization ability, their performance remains suboptimal for specific problems, as they do not learn environment-specific policies [13]. In contrast, RL models can effectively learn policies directly from environment-specific traffic data. Thus motivated, this work aims to leverage the synergy of RL and LLM to achieve better performance."}, {"title": "2 Related Works", "content": "2.1 Traffic Signal Control Methods\nEfficient TSC strategies are crucial for reducing urban congestion. Most of the traditional TSC methods optimize traffic signals based on simplistic assumptions or fixed rules. For instance, the Webster method [2] calculates the ideal cycle length and allocation of traffic signal phases at intersections based on traffic volume and the assumption of traffic flow stability over specific periods. In addition, Self-Organizing Traffic Light Control (SOTL) [14] uses a set of predetermined rules to decide whether to continue with the current traffic signal phase or initiate a phase change.\nWhile traditional TSC systems have achieved some success in mitigating traffic congestion, their effectiveness is constrained by their dependence on real-time traffic data and their limited adaptability to quickly changing traffic conditions in complex environments. RL-based TSC methods are receiving increasing attention for their dynamic management of traffic signals [15]. These RL systems typically use factors such as queue length [8, 16, 17], vehicle waiting time [18, 19], or intersection pressure [20] as key indicators in their reward functions to reduce traffic conges- tion. Additionally, the frequency of signal switching has been considered [21, 22] to prevent the negative impacts of rapid signal changes, such as increased stop-and-go driving and the risk of accidents. While RL-based TSC systems provide flexibility in optimizing traffic flow through adjustments to reward functions, finding the right balance among these factors is still a challenging task. Furthermore, a reward function that fails to account for infrequent yet crucial events may not provide agents with the necessary guidance to manage unforeseen circumstances adeptly [23].\n2.2 Large Language Model Applications\nAs LLMs gain recognition across multiple domains [24], there have been several successful applications in the field of intelligent transportation recently [11,12,25\u201327]. [12] proposed a TSC method based on the LLM-Assisted frame- work, integrating LLMs into TSC by placing them at the center of the decision-making process and combining them with perception and decision-making tools to control traffic signals. Furthermore, [25] introduced LLMLight, a novel framework that uses LLMs as decision-making agents for TSC. By leveraging the advanced generalization capabilities of LLMs, this framework facilitates a reasoning and decision-making process similar to human intuition, thus improv- ing traffic control effectiveness. However, LLMs have not been trained specifically for these corresponding tasks,"}, {"title": "2.3 Prompt Engineering", "content": "Currently, LLMs often rely on superficial statistical patterns rather than systematic reasoning, which can degrade their performance when faced with simple prompts [35]. To address this limitation, prompt engineering has emerged as a crucial technique for enhancing the functionality of LLMs. It helps these models organize their responses more logically, resulting in improved answer quality [36,37]. This approach involves using task-specific prompts to boost model effectiveness without modifying the core model parameters [38].\nPrompt engineering utilizes carefully crafted instructions, enabling LLMs to perform effectively across a variety of tasks and domains [39]. This adaptability is a significant departure from traditional methods, which typically re- quire model retraining or substantial fine-tuning to tailor performance to specific tasks. The importance of prompt engineering is underscored by its ability to direct model responses, thereby enhancing the adaptability and practical applicability of LLMs.\nRecent studies have been continuously exploring innovative approaches and applications of prompt engineering within LLMs [37,40\u201342]. [42] introduce the Tree of Thoughts (ToT), which uses chain prompts to encourage the exploration of ideas as an intermediate step in using LLMs to solve general problems. Furthermore, [40] proposes a prompt refinement grading framework that enhances LLM capabilities through more detailed instructions and objectives. In addition, [43] presents a Retrieval Augmented Generation (RAG) architecture, combining information retrieval components with seq2seq generators, which can better handle knowledge-intensive tasks. Faced with scenarios like TSC with strong rule constraints, we combine these works to design a set of prompts to exploit LLM performance better, prevent LLM hallucinations, and improve overall framework performance."}, {"title": "3 Preliminaries and Problem Formulation", "content": "3.1 Traffic Movements and Phases\nMovement: A standard four-legged road intersection comprises four entrances: East (E), West (W), North (N), and South (S). Traffic movement refers to vehicles transitioning from an incoming approach to an outgoing one. As depicted in Fig. 2, this intersection has four entrances, labeled E0, E1, E2, and E3. Each entrance facilitates two movements: turning left (l) and proceeding straight (s). For instance, E0_l denotes a vehicle originating from E0 and intending to turn left. This study omits right turns, premised on the assumption that right turns are perpetually permissible in jurisdictions adhering to left-hand traffic regulations. As a result, there are eight possible movements at the intersection, referred to as M1, M2, M3, M4, M5, M6, M7, and m8 in the subsequent sections, and mi \u2208 M.\nPhase: A phase represents a set of movements that can be executed concurrently without causing conflicts. Given the consideration of only green and red signals, a phase can be conceptualized as a collection of permitted movements, with all others being prohibited. Fig. 2 illustrates the four phases of a standard four-way intersection, denoted as P = {0, 1, 2, 3}. For example, Phase-1 allows movements E0_s and El_s to occur simultaneously.\nTime and Time Slot: An RL agent takes an action to choose the next phase every time slot of 7 seconds. Unless specified otherwise, we set r = 5 in the sequel.\n3.2 TSC as an MDP Problem\nAn RL agent learns to make decisions through interactions with an environment modeled as a Markov Decision Process (MDP) [44], defined by the tuple (S, A, P, R, y). In the context of TSC, S represents the set of states, which"}, {"title": "4 Methodology", "content": "As illustrated in Fig. 3, we introduce a framework called iLLM-TSC that combines LLM and an RL agent for TSC. This framework initially employs an RL agent to make decisions based on environmental observations and policies learned from the environment, thereby providing preliminary actions. Subsequently, an LLM agent refines these actions by considering real-world situations and leveraging its understanding of complex environments. This approach enhances the TSC system's adaptability to real-world conditions and improves the overall stability of the framework. Details regarding the RL agent and LLM agent components are provided in the following sections.\n4.1 RL Agent Design\nIn the proposed method, the RL agent plays a pivotal role in making informed TSC decisions. This section outlines the three essential components that constitute the RL agent: state, action, and reward. Each component is critical for the agent's operation within the TSC environment, influencing its decision-making process in real-time traffic management.\nState: The following five state variables (SVs) are defined to characterize each movement mi for i = 1,2,.,8\n1. Flow Speed (SV\u2081): The average speed of vehicles in the movement, or -1 if there are no vehicles in the movement;\n2. Mean Occupancy (SV2): This is the ratio between the total length of roads occupied by vehicles and the total length of lanes, averaged over one-time slot;\n3. Jam length meters (SV3): This variable captures the total length of traffic jams in meters for each movement;\n4. Jam length vehicles (SV4): This variable captures the total length of traffic jams in terms of the number of vehicles;\n5. Current Phase (SV5): A binary variable, indicating whether the movement is passable at the time of current observation or not."}, {"title": "4.2 Training RL Agent for Initial TSC Decisions", "content": "The training of the RL-based agent is a critical aspect of the proposed framework. In this study, the Proximal Policy Optimization (PPO) algorithm [47] is employed to train the RL agent. PPO is chosen due to its suitability for policy- based reinforcement learning in environments with both discrete and continuous action spaces. This study utilizes two primary neural networks, namely a policy network denoted as \u03c0\u03b8 and a value network denoted as v\u03c6, where \u03b8 and \u03c6 are the respective network parameters. The policy network generates a probability distribution over the actions, given the current state, while the value network estimates the expected future return for that state. The traffic intersection observations st are used as input for both networks, generating \u03c0\u03bf(st) and v\u03c6(st). Next, the following PPO objective is proposed by taking into account both a policy loss Lp(\u03b8) and a value function loss Lv(\u03c6):\n$F(\\theta,\\varphi) = -L_p(\\theta) + \\lambda L_v(\\varphi),$\nwhere \u03bb is a hyperparameter that balances the two loss terms. Furthermore, the policy loss function Lp(\u03b8) is defined as:\n$L_p(\\theta) = \\mathbb{E}_\\pi [\\min (J(\\theta) \\hat{A}_t, clip(J(\\theta), 1 - \\epsilon, 1 + \\epsilon) \\hat{A}_t)],$\nwhere $\\mathbb{E}_\\pi$ denotes the empirical expectation under policy \u03c0\u03b8 while \u03f5 represents the clipping range. Furthermore, J(\u03b8) and At take the following form:\n$J(\\theta) = \\frac{\\pi_\\theta (a_t | s_t)}{\\pi_{\\theta_{old}}(a_t | s_t)},$\n$\\hat{A}_t = r_{t+1} + \\gamma v_\\varphi (s_{t+1}) - v_\\varphi (s_t),$\nwhere \u03b3 is the discount factor that determines the present value of future rewards. $\\pi_\\theta(\\cdot|\\cdot)$ and $\\pi_{\\theta_{old}}(\\cdot|\\cdot)$ stand for the current and previous policy, respectively. The previous policy $\\pi_{\\theta_{old}}(\\cdot|\\cdot)$ is used as a reference to ensure that the policy updates are consistent with the previous policy.\nFinally, the value function Lv(\u03c6) is computed as the mean-squared error between the predicted state values v\u03c6(s) and the actual discounted returns:\n$L_v(\\phi) = \\mathbb{E} [(\\hat{A}_t)^2].$\nBy minimizing this loss, the agent learns to predict the expected return from each state more accurately, which in turn helps the agent to choose better actions.\n4.3 Encoding Traffic Scenario into Text\nAs previously discussed, implementing RL-based TSC systems in real-world environments presents challenges, pri- marily due to the systems' limited understanding of the environment, which is crucial for effective decision-making. Conversely, LLMs can enhance decision-making by interpreting the current traffic conditions at intersections through natural language."}, {"title": "4.4 Enhancing RL Decisions with LLM Feedback", "content": "After the traffic scene is translated into a natural language description, the LLMs can be employed to refine the decisions made by the RL agent. This process begins by inputting prompt \u03a9 into the LLM model PLLM. The LLM aims to maximize the probability of generating the optimal sequence of actions as described by Eq. (9), producing each character sequentially.\n$p(O_t | \\Omega) = \\prod_{i=1}^{O_t} P_{LLM} (o_i | \\Omega, o_{<i}),$\nwhere or represents the i-th token, and Ot indicates the total number of tokens in the final response. The term o<i denotes all tokens preceding the i-th token. To ensure the LLM outputs are in the required format, we utilize regular expressions to extract the decision from Ot. However, as the LLM output may not always conform to the expected format, a maximum of K attempts is allowed. If the system exceeds K attempts without obtaining a correctly format- ted response, the original RL decision is executed. Algorithm 1 details the combined RL and LLM decision-making process in iLLM-TSC.\nAccording to Algorithm 1, the iLLM-TSC framework synergizes the strengths of RL and LLM to enhance the decision- making process in TSC systems. The LLM contributes its advanced capabilities in logical reasoning to analyze the actions proposed by the RL agent, thereby increasing the reliability of the system. Should there be a discrepancy between the RL suggestion and the LLM's logical framework, the LLM intervenes to adjust the action, ensuring the stability and robustness of the traffic management system. This collaborative approach not only leverages the policy power of RL but also utilizes the contextual understanding of LLM to optimize traffic control decisions effectively."}, {"title": "5 Experiment and Analysis", "content": "5.1 Experimental Setting\nExtensive experiments were conducted on the Simulation of Urban Mobility (SUMO) platform. We simulated an intersection with the phase structure shown in Fig. 2, where a green light was followed by a yellow light for 3 seconds before changing to a red light. Extension to more intersection types and more complex light phasing can be performed straightforwardly. The duration of each time slot 7 is set to 5 seconds. The LLM used in the following experiment was GPT-4 recently released by OpenAI. The RL parameters were configured as follows: the discount factor y was set to 0.99, the trace-decay parameter A was set to 0.9, and the policy clipping range e was established at 0.2. Additionally, we simulated a packet loss rate p of 0.2 and introduced a scaling factor for noise \u1e9e of 0.1 to mimic realistic communication conditions. Furthermore, to evaluate the robustness and adaptability of the RL model when integrated with LLM feedback, we set the maximum number of attempts to refine the RL decision based on LLM feedback at K = 3.\n5.2 Compared Methods\nOur evaluation encompasses five benchmark methods: two traditional TSC methods and three RL-based algorithms, detailed as follows:\n1. Fixed duration control: Fixed duration signal control algorithm is the most traditional method of TSC by pre-setting the traffic signal's phase sequence, phase duration, and cycle time in advance. In our experiment the fixed duration is set 25s;\n2. SOTL model [14]: SOTL algorithms utilize straightforward rules and indirect communication to enable traffic lights to organize and adjust to dynamic traffic conditions autonomously, leading to a reduction in waiting times.\n3. ADLight [18]: ADLight is a method for controlling traffic signal lights based on the PPO strategy in RL. Integrating features of movement and action with the set current phase duration ensures uniformity in model structure across different intersections.\n4. EMVLight [9]: EMVLight is an RL framework that considers emergency vehicles (EMV) in TSC. This framework addresses the coupling issue between EMV navigation and TSC. EMVLight not only reduces the travel time of background vehicles but also shortens the waiting time of EMVs.\n5. SARL-TSC [16]: SARL-TSC proposes a two-stage framework and leverages temporal information to enhance the robustness of the RL model against observation-impaired. The feature extraction model utilized in this framework is the EAttention.\n5.3 Evaluation Metrics\nWe leverage mean travel time, mean waiting time, and mean speed of vehicles to evaluate the performance of different actions made by TSC agents.\n1. Mean travel time: The mean travel time quantifies the average duration of all the vehicles traveling from their origins to their destinations."}, {"title": "5.4 Comparative Performance Analysis", "content": "Table 1 provides a performance comparison between iLLM-TSC and baseline algorithms under both normal and degraded communication scenarios. Under normal circumstances, iLLM-TSC ensures rapid passage for emergency vehicles while sustaining efficiency for conventional vehicles. Specifically, iLLM-TSC enhances the average travel time, average waiting time, and mean speed for all vehicles by 2%, 11.9%, and 3%, respectively, compared to AD- Light. The significant improvement in mean waiting time relative to travel time and speed can be attributed to the RL optimization target being primarily focused on reducing waiting times at intersections, whereas travel time and speed are influenced by overall traffic density. This prioritization results in a more substantial reduction in waiting times. Furthermore, when compared to SARL-TSC, which utilizes temporal sequence data, iLLM-TSC shows a minor deficit in overall vehicle throughput strategy. This difference arises because SARL-TSC focuses solely on maximizing junc- tion efficiency, neglecting the prioritization of emergency vehicles. In contrast, iLLM-TSC reduces the waiting time for emergency vehicles by 62.9% compared to SARL-TSC, benefiting from the integration of LLM capabilities that enhance scene understanding and enable human-like reasoning during incidents.\nCompared to EMVLight, a method specifically addressing emergency vehicle prioritization, iLLM-TSC has a slightly longer average waiting time for emergency vehicles by 13.0%. However, EMVLight faces challenges in optimally balancing reward weights for normal vehicles and emergency vehicles during training, which compromises its vehicle control strategy for normal traffic conditions, leading to a 19.4% increase in average waiting time for all vehicles compared to iLLM-TSC. Overall, iLLM-TSC not only facilitates quicker passage for emergency vehicles but also maintains efficient average waiting times for general traffic. The addition of an LLM provides the system with en- hanced adaptability and the capability to manage unexpected situations effectively.\nUnder degraded communication scenarios, all RL models that rely on observations experience a decline in perfor- mance, with the exception of the traditional Fixed Time control method. For instance, when compared with the ADLight model, our iLLM-TSC framework achieves a 17.5% improvement in mean waiting time. Furthermore, SARL-TSC, which performs optimally under normal conditions, exhibits a 10% increase in mean waiting time com- pared to iLLM-TSC in scenarios with compromised communication. While the Fixed Time control method remains unaffected by communication quality degradation, its mean waiting time is 25% higher than that observed with iLLM- TSC. This disparity is due to iLLM-TSC's ability to compensate for information loss. Specifically, when data is missing or incomplete, the LLM component of iLLM-TSC detects issues in the current scenario and disregards the RL suggestions, instead applying common sense and any relevant information to reach a decision. Further details and examples of this process will be provided in Section 5.6.\nAdditionally, iLLM-TSC significantly enhances emergency vehicles response efficiency in degraded communication scenarios. Compared to EMVLight, iLLM-TSC improves the mean waiting time for emergency vehicles by 35%, and also shows better performance in terms of mean speed and travel time. These results demonstrate that iLLM-TSC's strategy of utilizing RL for decision-making under normal conditions and leveraging LLM capabilities under special circumstances effectively enhances system performance across various scenarios."}, {"title": "5.5 Prompt Ablation Experiments", "content": "To investigate the influence of prompt components on the performance of LLMs, we conducted a series of ablation experiments based on the prompt structure depicted in Fig. 4. The prompt is composed of five elements: (1) the role of the LLM (role), (2) essential hints for decision-making (hints), (3) description of the traffic scenario (traffic scenario), (4) logical reasoning chain (logic), and (5) the format of the answer (format). Given the necessity for the LLM to comprehend the environment and respond in a specific format, the role, traffic scenario description, and answer format"}, {"title": "5.6 Typical Case Studies", "content": "In this section, we analyze how RL and LLMs collaborate in decision-making through three cases.\n5.6.1 Case 1: Normal Scenario\nAs depicted in Fig. 8, the first scenario represents a regular traffic condition at an intersection without any unusual or long-tail scenarios or communication issues. In this scenario, the traffic phase selected by the RL agent allows some vehicles to proceed, even though this phase might not correspond to the direction with the highest number of waiting vehicles. The LLM, using its capability to understand and describe the scene, confirms the absence of any special events currently affecting the traffic. At this point, the optimization goal of the LLM aligns with that of the RL agent. Consequently, the LLM endorses and supports the RL agent's decision, which contributes to alleviating congestion at the intersection. This case demonstrates that iLLM-TSC does not merely prioritize the green light for the longest queue but instead supports the RL decision and applies reasoning akin to human common sense, a capability often lacking in traditional rule-based algorithms.\n5.6.2 Case 2: Normal Scenario with Emergency Vehicles\nRL agents can sometimes fail to make optimal decisions in rare or unexpected situations, particularly when such scenarios are not included in the design of the reward function. Our approach, iLLM-TSC, which integrates a LLM with RL, addresses this limitation effectively. Fig. 8 illustrates a scenario where an emergency vehicle approaches an intersection. The RL component of iLLM-TSC initially selects Phase 0, prioritizing lanes with higher vehicle ac- cumulation, as the training did not specifically account for emergency vehicles. Recognizing the need to prioritize emergency responses, the LLM intervenes to override this decision by activating Phase 2. This action holds back other vehicles, thereby allowing the emergency vehicle to pass through the intersection promptly. This case study demonstrates that iLLM-TSC not only aims to minimize average waiting times but also effectively manages excep- tional traffic situations. Such adaptability is crucial in real-world traffic management, where diverse and unpredictable scenarios often arise.\n5.6.3 Case 3: Degraded Communication Scenarios\nCommunication disruptions can severely impact the performance of RL agents, particularly when the real-time data deviates from the training conditions. Fig. 9 depicts a situation characterized by communication problems, specifically packet loss, which prevents the accurate assessment of queue lengths at edge E0. Consequently, the RL agent defaults to activating Phase 0, which governs the movements E0_l and E1_l. These lanes exhibit relatively low occupancy"}, {"title": "6 Conclusion", "content": "In this study, we introduce the iLLM-TSC framework aimed at enhancing the reliability of RL-based TSC systems in real-world scenarios. Specifically, this paper addresses the challenge of imperfect observations due to degraded com- munication scenarios and rare traffic conditions not considered by the reward function with our dual-step framework. By leveraging the generalization capabilities of LLMs and making preliminary judgments about RL agent actions, our method enhances the adaptability of TSC systems to handle the complexities of real-world situations. This dual-step decision-making process enables our method to effectively manage complex environments while maintaining the ro- bust performance characteristics of RL methods. Additionally, iLLM-TSC can be seamlessly integrated with existing RL-based TSC systems. Extensive experiments and tests validate the effectiveness of the proposed iLLM-TSC frame- work. In scenarios with degraded communication, iLLM-TSC reduces the average waiting time by 17.5% compared to traditional RL methods. This significant improvement underscores the enhanced scene comprehension capabilities of LLMs tailored specifically for TSC applications. It is important to note that this initial work only scratches the surface of the potential integration of LLM-assisted frameworks with RL and is expected to inspire further exploration of the synergy between LLM and RL."}]}