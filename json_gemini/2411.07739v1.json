{"title": "UNLOCKING LEGAL KNOWLEDGE WITH MULTI-LAYERED\nEMBEDDING-BASED RETRIEVAL", "authors": ["Jo\u00e3o Alberto de Oliveira Lima"], "abstract": "This work addresses the challenge of capturing the complexities of legal knowledge by proposing a\nmulti-layered embedding-based retrieval method for legal and legislative texts. Creating embeddings\nnot only for individual articles but also for their components (paragraphs, clauses) and structural\ngroupings (books, titles, chapters, etc), we seek to capture the subtleties of legal information through\nthe use of dense vectors of embeddings, representing it at varying levels of granularity. Our method\nmeets various information needs by allowing the Retrieval Augmented Generation system to provide\naccurate responses, whether for specific segments or entire sections, tailored to the user's query. We\nexplore the concepts of aboutness, semantic chunking, and inherent hierarchy within legal texts,\narguing that this method enhances the legal information retrieval. Despite the focus being on Brazil's\nlegislative methods and the Brazilian Constitution, which follow a civil law tradition, our findings\nshould in principle be applicable across different legal systems, including those adhering to common\nlaw traditions. Furthermore, the principles of the proposed method extend beyond the legal domain,\noffering valuable insights for organizing and retrieving information in any field characterized by\ninformation encoded in hierarchical text.", "sections": [{"title": "Introduction", "content": "The increasing volume and complexity of legal corpora\npose significant challenges for legal professionals, includ-\ning those in legislative consultancy, where the efficient\naccess and analysis of legal texts are critical. Traditional\nkeyword-based search methods often fall short in capturing\nthe nuances of legal language and the intricate relationships\nwithin legal documents ([1, 2]).\nRecent advancements in Generative Artificial Intelligence\n(GenAI) and Retrieval Augmented Generation (RAG) sys-\ntems offer promising avenues for more efficient and accu-\nrate legal information retrieval. Embeddings, which are\ndense and compact vector representations of text, effec-\ntively capture the meanings of words, phrases, or docu-\nments ([3, 4]). Legislative documents, including bills and\nlegal normative statutes, inherently have a hierarchical\nstructure. This intrinsic hierarchy calls for an approach\nwith variable granularity, capable of representing both\nsmaller segments and broader groupings of legal texts\nthrough embeddings.\nThis paper proposes a multi-layered embedding-based re-\ntrieval method that captures the semantic content of legal\ntexts. By creating embeddings for articles,\u00b9 their compo-\nnents, and their structural groupings, we aim to provide a\nmore nuanced and comprehensive representation of legal\nknowledge. Our proposed approach enables RAG models\nto respond to user queries with varying levels of detail,\nranging from small portions to comprehensive sections."}, {"title": "Fundamental Concepts", "content": "Before moving forward with an exploration of our method\nand its applications, it's essential to define the core con-\ncepts pivotal to this study: embeddings, aboutness, re-\ntrieval augmented generation, and chunking. These foun-\ndational elements form the base of our methodology. Our\ngoal is to ensure clarity in our discourse for IT analysts\nand stakeholders within the legal sector alike, who may not\nbe well-versed in this specialized terminology. By clarify-\ning these key concepts, we aim to eliminate any potential\nknowledge gaps.\nEmbeddings: At the heart of our approach lie embeddings,\ndense vector representations of text that encapsulate seman-\ntic meanings within documents. These vectors position\nwords, sentences, or entire documents\u00b2 in a multidimen-\nsional space, where the spatial proximity between points\nsignifies semantic similarity. This allows us to obtain a\nmeasure of the semantic distance between texts (words,\nsentences or documents). Distant vectors imply the texts\nthat they stand for are dissimilar, while close vectors imply\nthey are similar.\nIn the legal domain, the intricate subtleties among various\nterminologies are captured through embeddings, which can\nbe visualized in a two-dimensional or three-dimensional\nspace via a process that reduces the dimensionalities of the\noriginal embedding. Let's examine an example using the\nfundamental concepts of Wesley Hohfeld's framework."}, {"title": "The Specificity of Legal and Legislative\nInformation", "content": "A defining characteristic of legislative texts is an inherent\nhierarchical structure. It reflects the systematization of le-\ngal dispositions, ranging from broad legal areas to specific\narticles, clauses, and sub-clauses.\nIn structured normative texts such as constitutions, ev-\nery detail has substantial semantic importance. Unlike\nordinary language, where redundancy and informality are\ncommon, constitutions are carefully crafted documents\nwhere each word, phrase, and clause is deliberately chosen\nto convey specific legal meaning and effect. This preci-\nsion requires a granular approach to information retrieval.\nAnalyzing and representing legal knowledge at varying lev-\nels of detail \u2013 from individual clauses and sub-clauses to\nbroader articles, chapters and titles \u2013 allows us to capture\nthe full spectrum of meaning embedded within these texts.\nFigure 3 depicts the organizational structure of legislative\ndocuments in Brazil, conforming to the guidelines of Com-\nplementary Law No. 95/1998. The highest level is the\n\"Legal Norm\" (Norma Jur\u00eddica), under which the Main\nText (Texto Principal) is the primary body of the document.\nOptionally, one or more Annex (Anexo) may be included,\nindicated by a dashed line, suggesting its non-mandatory\nnature. It is important to note that the number of Annex can\nvary, ranging from zero to several, indicating the flexibility\nfor including them.\nThe foundational unit of this framework is the \"Article,\"\nwhich consists of a mandatory \u201cLead paragraph\u201d (\u201ccaput\")\nand, potentially, one or more \"Paragraphs\" (\"Par\u00e1grafo\"),\nindicated by dashed lines to denote their optionality. These\n\"Paragraphs\" elucidate details or exceptions pertaining to\nthe \u201cLead paragraph.\u201d If enumeration is necessary, the lead\nparagraph or paragraphs can branch into \u201cSections\u201d (in-\ncisos), which may be further divided into \"Items\" (al\u00edneas),\nand then into \"Subitems\u201d (item) for detailed specificity.\nSimple statutes may consist of only articles, but complex\nstatutes and codes group articles into progressively larger\nunits: \"Sections [group of Articles]\" and \"Subsections\" are\npossible components of \u201cChapters,\u201d which are compiled\nunder \"Titles.\" These titles are then organized into", "Books,": "nand multiple books can be part of a larger", "Part,": "eflecting\nthe elaborate nature of legal codes."}, {"title": "Proposal for Utilizing a Multi-Layered\nEmbedding-Based Retrieval", "content": "Considering their fundamental role in systematizing legal\nnorms and principles, \"Articles\" are the most suitable unit\nfor initial semantic chunking within legislative texts. As\nillustrated in Figure 4, applying this approach to Title I of\nthe Brazilian Constitution results in four distinct chunks,\neach representing an individual article. While this provides\na solid basis for analysis, our proposed methodology, de-\ntailed in subsequent sections, seeks to further enhance this\nprocess. Generating a broader set of chunks for embedding\nallows us to create a more detailed and complete repre- 4 Proposal for Utilizing a Multi-Layered\nlayered embedding-based retrieval method. This approach\naims to capture the semantic content of legal documents\nat various levels of granularity, from entire documents to\nindividual clauses. The following section will outline the\nspecifics of our chunking methodology in the indexing\nphase and the strategies for filtering chunks in the retrieval\nphase.\nBuilding on our understanding of the hierarchical nature of This section explores our proposed approach, offering\nlegislative texts, we now present our proposal for a multi- recommendations that cover two RAG phases: chunking"}, {"title": "Chunking methodology during RAG's indexing\nphase", "content": "Our proposed solution defines the following layers for\nsegmenting the textual content of a legislative or legal\ndocument:\n\u2022 Document Level: At the highest level, we gener-\nate one embedding for each document. This cap-\ntures the overarching theme, purpose, and scope\nof the legal text. This comprehensive vector can\nthen be used to perform automatic classification\nof the document, aligning it with relevant legal\ncategories.\n\u2022 Document Component Level: This level concen-\ntrates on capturing the essence of document com-\nponents, which can be systematically presented\nthrough articles (such as the main text) or de-\npicted using various structures (like tables or un-\nstructured text). Examples encompass the main\ntext and additional texts components such as jus-\ntifications (in bills) and schedules (in annexes),\nwith each being assigned its own embedding to\nrepresent its distinct contribution to the overarch-\ning legal context.\n\u2022 Basic Unit Hierarchy Level: Embeddings are also\ngenerated for books, titles, chapters, and sections.\nThis captures the broader themes and relation-\nships between groups of articles.\n\u2022 Basic Unit Level: Each article, as a fundamen-\ntal unit of legal text, receives its own embedding.\nThis captures the specific legal issue addressed\nby the article and its core provisions.\n\u2022 Basic Unit Component Level: Further granularity\nis achieved by creating embeddings for the oblig-\natory head or the paragraphs that compose each\narticle. This allows a detailed understanding of\nthe semantics in each legal provision.\n\u2022 Enumeration Level: Further granularity is\nachieved by creating embeddings for item that\nare part of an article head or a paragraph. This\nallows a detailed understanding of the specific\ndetails in each legal provision.\nBy incorporating embeddings at these different levels, we\ncreate a multi-layered representation of legal knowledge,\nenabling RAG models to respond to user queries with vary-\ning levels of detail.\nTo illustrate the granularity achieved by our proposed\nmethod, let us consider the example presented in Figure 4.\nA standard approach using articles as the embedding unit\nwould segment this text into 4 chunks, corresponding to\nthe 4 articles. However, our hierarchical approach yields a\nmuch richer representation. At the Document-Level, we\nhave 1 chunk encompassing the entire text. Similarly, the\nText Component-Level also produces 1 chunk, as it en-\ncompasses the main body of the text. The Article-Level\nretains the 4 chunks corresponding to the articles, but the\nArticle Component-Level breaks these down into another\n25 chunks: 4 lead paragraphs (caputs), 2 sole paragraphs,\nand 19 sub-sections (incisos). Finally, the Grouping-Level\nprovides 1 chunk representing the single title. In total, our\nmethod generates 32 chunks, thus providing a significantly\nmore detailed representation compared to the 4 chunks of\nthe traditional approach."}, {"title": "Filter strategy during RAG's Retrieval phase", "content": "The strategy for filtering chunks in the retrieval system\nutilizes cosine similarity alongside additional parameters\nto ensure precise and contextually relevant responses. Af-\nter computing the cosine similarities between the query\nembedding and each chunk's embedding within the dataset,\nthe results are sorted based on similarity scores, prioritiz-\ning the highest values.\nThe selection process for the chunks includes several criti-\ncal steps. Firstly, a baseline token count is set, which in this\nexample is 2,500 tokens. This limit helps manage the total\nvolume of text being considered, preventing overly lengthy\nor unmanageable responses. Additionally, a baseline per-\ncentage for similarity deviation, set here at 25%, is used to\ncompare each chunk's similarity against the highest found\nsimilarity. This comparison helps to filter out chunks that\nare significantly less similar to the query, maintaining a\nfocus on those most closely related in semantic content.\nChunks are also filtered based on their textual boundaries\nto avoid overlap in the content presented. If a chunk's"}, {"title": "Comparative of Flat vs Multi-Layered\nChunking Approaches", "content": "This section will present a two-dimensional projection\nvisualization of embeddings and demonstrate a test im-\nplementation of RAG for the Brazilian Constitution. We\nwill compare flat (divided by articles) and multi-layered\nchunking approaches. In the second part, we will test the\nretrieval results of both approaches using six queries about\nprovisions of the Brazilian Constitution.\nIn this experiment, we employed the text-embedding-3-\nlarge models, configured to generate 256-dimensional vec-\ntors. To present the data in a comprehensible manner,\nwe reduced these high-dimensional embeddings to a two-\ndimensional plane using the dimensionality reduction tech-\nnique (PACMAP). The visualizations were then created\nusing Plotly, the interactive graphing library, to facilitate\na clearer understanding of the data structures and their\nsemantic correlations."}, {"title": "Comparative of Flat vs Multi-Layered\nEmbedding-Based Retrieval", "content": "Table 1 presents the questions formulated for a simple\ncomparative test of response retrieval and generation us-\ning Multi-Layer (ML) and Flat embedding approaches. In\ncrafting these questions, we aimed to encompass both spe-\ncific and comprehensive inquiries. Appendix A lists all the\ndevised questions along with descriptive information about\nthe selected chunks and an evaluation of each chunk's rel-\nevance to the response, graded from 'essential' through\n'complementary' to 'unnecessary'. Additionally, we have\nincluded the corresponding responses from the generation\nphase, accompanied by a brief commentary on each re-\nsponse. In this comparative test, the \"gpt-4-turbo-preview\"\nmodel was used during the generation stage, limiting the\noutput to 1000 tokens and setting the temperature at 0.3."}, {"title": "Conclusion", "content": "The proposed multi-layered embedding-based retrieval ap-\nproach offers a promising avenue for advancing legal in-\nformation retrieval. By capturing the inherent structure\nand diverse granularities of legal knowledge, this method\nfacilitates information access, ultimately empowering le-\ngal professionals and researchers in their pursuit of legal\nknowledge. The method's ability to represent legal texts at\ndifferent levels of granularity ensures that whether a query\nseeks an overview or a detailed examination, the retrieval"}, {"title": "Appendix \u2013 Questions", "content": "Question 1. What are the foundations of the republic?\nMulti-Layer \u2013 GPT-4 Answer\nFlat - GPT-4 Answer\nThe foundations of the Republic Federativa do Brasil", "are": "noutlined in Art. 1\u00ba of the CRFB", "include": "nsovereignty; citizenship; the dignity of the human per- Sovereignty\nson; the social values of labor and free enterprise; and\nCitizenship\npolitical pluralism.\nThe dignity of the human person\nThe social values of labor and free enterprise\nPolitical pluralism\nEvaluation of Answers and Chunks Selection\nBoth the multi-layer chunking GPT-4 answer and the flat chunking GPT-4 answer effectively outline\nthe foundations of the \"Republic Federativa do Brasil", "although the correct term in English would be\n\"Federative Republic of Brazil.\"\nSeveral chunks beyond Art. 1\u00ba are marked as unnecessary (U), indicating that they do not directly\ncontribute to understanding the foundational principles of the republic. These unnecessary chunks\nwere correctly disregarded in the response generation phase, ensuring focus on the most pertinent\ninformation.\nTable 2": "Q1 - Multi-Layer Chunking\nTable 3: Q1 - Flat Chunking\nLabel\nSimilarity #Tok R\nLabel\nSimilarity #Tok R\nArt. 1\u00ba", "U\nKey": "E - Essential; C \u2013 Complementary; U \u2013 Unnecessary\nQuestion 2. Talk about the social function of property.\nMulti-Layer - GPT-4 Answer\nFlat - GPT-4 Answer\nThe social function of property is a principle deeply em- The social function of property is a fundamental prin-\nbedded in the Brazilian Constitution", "4": "Q2 - Multi-Layer Chunking\nTable 5: Q2 - Flat Chunking\nLabel\nSimilarity # Tok\nR\nLabel\nSimilarity # Tok\nR\nCRFB", "C\nKey": "E - Essential; C \u2013 Complementary; U \u2013 Unnecessary\nQuestion 3. What are the attributes of the vote?\nMulti-Layer \u2013 GPT-4 Answer\nFlat - GPT-4 Answer\nThe attributes of the vote", "follows": "the vote is exercised through universal\nof Brazil (CRFB)"}, {"follows": "suffrage and is direct and secret", "for\nUniversal": "The vote is universal", "14).\nDirect": "Voting is direct", "14).\nSecret": "The vote is secret", "II).\nEqual": "Each vote has equal value", "Peri-\nodic": "The Constitution also implies the periodic nature\nof elections", "periodic\" is not di-\nrectly mentioned in the provided chunks. The periodic\nnature is inherent in the democratic process and the stip-\nulation against the abolition of direct, secret, universal,\nand periodic voting (CRFB, Art. 60, \u00a7 4\u00ba, Inciso II).\nThese attributes are fundamental to the democratic pro-\ncess, ensuring that the sovereignty of the people is exer-\ncised in a fair, free, and equitable manner.\nTable 6": "Q3 - Multi-Layer Chunking\nTable 7: Q3 - Flat Chunking\nLabel\nSimilarity #Tok R\nLabel\nSimilarity #Tok\nR\nCRFB", "U\nKey": "E - Essential; C \u2013 Complementary; U \u2013 Unnecessary\nQuestion 4. How is tax revenue distributed?\nMulti-Layer \u2013 GPT-4 Answer\nFlat - GPT-4 Answer\nTax revenue in Brazil is distributed among the Union", "context": "nkey points regarding the distribution: Union to States Federal Taxes: The Union", "Municipalities": "and municipalities have the authority to institute taxes\nArt. 159: The Union delivers 50% of the revenue col- (CRFB", "includes": "ntaxes in several ways", "including": "A portion of the income tax and taxes on industrialized\n21.5% to the Participation Fund for States and the Fed- products is allocated to states and municipalities (CRFB", "District": "Art. 158).\nArt. 157: States and the Federal District receive: Rev- Industrialized Products and Other Specific Taxes: A\nenue from income tax collected at the source on pay- share of the revenue from the tax on industrialized prod-\nments they make. ucts and certain other federal taxes is distributed among\n20% of the revenue from taxes the Union institutes under states and municipalities"}, {"Municipalities": "municipal participation (CRFB", "3": "States must pass on 25% of the revenue Transparency and Reporting:\nthey receive from the tax on industrialized products and The Union", "for\nMunicipalities": "their distribution", "158": "Municipalities are entitled to: of tax revenue (CRFB", "Financing": "nments made by them. Social security is financed through contributions from\n50% of the revenue from the Union's tax on rural prop- employers", "Provisions": "nvices circulation and communication services. The Federal District is entitled to municipal taxes in\nArt. 162: The Union", "Reporting": "ensure that taxes and contributions are graded according\nThis distribution mechanism ensures that tax revenue to the economic capacity of the taxpayer (CRFB", "8": "Q4 - Multi-Layer Chunking\nTable 9: Q4 - Flat Chunking\nLabel\nSimilarity #Tok\nR\nLabel\nSimilarity #Tok R\nCRFB, Art. 159., caput\n0,599326 487 E\nCRFB, Art. 157.\n0,562555 124"}]}