{"title": "CE-QArg: Counterfactual Explanations for Quantitative Bipolar Argumentation Frameworks", "authors": ["Xiang Yin", "Nico Potyka", "Francesca Toni"], "abstract": "There is a growing interest in understanding arguments' strength in Quantitative Bipolar Argumentation Frameworks (QBAFs). Most existing studies focus on attribution-based methods that explain an argument's strength by assigning importance scores to other arguments but fail to explain how to change the current strength to a desired one. To solve this issue, we introduce counterfactual explanations for QBAFs. We discuss problem variants and propose an iterative algorithm named Counterfactual Explanations for Quantitative bipolar Argumentation frameworks (CE-QArg). CE-QArg can identify valid and cost-effective counterfactual explanations based on two core modules, polarity and priority, which help determine the updating direction and magnitude for each argument, respectively. We discuss some formal properties of our counterfactual explanations and empirically evaluate CE-QArg on randomly generated QBAFs.", "sections": [{"title": "1 Introduction", "content": "Explainable AI (XAI) aims to enhance the transparency and trustworthiness of AI models by providing explanations for their decision-making process (Adadi and Berrada 2018), which is crucial in high-stakes decision-making domains such as healthcare, finance, and judiciary. Recently, explaining the reasoning process of Quantitative Bipolar Argumentation Frameworks (QBAFs) (Baroni et al. 2015) has received increasing attention (Kampik and \u010cyras 2022; Yin, Potyka, and Toni 2023; Kampik et al. 2024). QBAFS consist of arguments, binary relations (of support and attack), and a base score function that ascribes initial strengths to each argument. QBAFS semantics typically determine each argument's (final) strength based on the strength of its attackers and supporters (e.g. see (Leite and Martins 2011; Baroni et al. 2015; Amgoud and Ben-Naim 2018)), which allows quantitative reasoning among contradictory information (\u010cyras et al. 2021; Potyka 2021; Ayoobi, Potyka, and Toni 2023; Potyka, Yin, and Toni 2023). To explain arguments' final strength, often attribution-based methods are applied (e.g. see (Kampik and \u010cyras 2022; Kampik et al. 2024; Yin, Potyka, and Toni 2023)). These methods assign \"importance scores\" to arguments, showing how much they contribute to the final strength of arguments of interest.\nTo illustrate the idea, Figure 1 shows a QBAF to decide whether a person's loan application will be approved. This"}, {"title": "2 Related Work", "content": "The literature on QBAF explanations primarily focuses on attribution-based explanations. These methods aim to explain the reasoning outcome for (final strength of) a particular argument (referred to as the topic argument) in a QBAF by assigning importance scores to arguments. There are various ways to define these importance scores, including removal-based methods (Kampik et al. 2024) that measure the impact of removing an argument; gradient-based methods (Yin, Potyka, and Toni 2023) that measure sensitivity with respect to an argument's base score; and Shapley-based methods (Kampik et al. 2024) that distribute the overall impact among all arguments using tools from game theory. Shapley-based methods can also be used to attribute importance scores to edges (attacks and supports) rather than arguments in a QBAF to explain their impact (Amgoud, Ben-Naim, and Vesic 2017; Yin, Potyka, and Toni 2024). While attribution-based explanations are helpful and intuitive in explaining outcomes (final strength), they cannot guide improving them by altering the inputs (QBAFs). We focus instead on counterfactual explanations.\nCounterfactual explanations are typically used in XAI (Wachter, Mittelstadt, and Russell 2017) to indicate paths towards \u201calgorithmic recourse\u201d. Counterfactual explanations for QBAFs have not been well-studied. A recent study by (Kampik, \u010cyras, and Alarc\u00f3n 2024) focuses on explaining why the strengths' partial order of two topic arguments swap after updating QBAFs (e.g. by adding/removing arguments/edges or changing the base scores of arguments),"}, {"title": "3 Preliminaries", "content": "Formally, a QBAF can be defined as follows.\nDefinition 1. A Quantitative Bipolar Argumentation Framework (QBAF) is a quadruple $Q = (A,R^-,R^+ ,\\tau)$ consisting of a finite set of arguments A, binary relations of attack $R^- \\subseteq A \\times A$ and support $R^+ \\subseteq A \\times A$ ($R^- \\cap R^+ = \\emptyset$) and a base score function $\\tau : A\\rightarrow [0, 1]$.\nThe base score function in QBAFs ascribes initial strengths (base scores) to arguments therein. QBAFs may be represented graphically (as in Figure 1) using nodes to represent arguments and their base scores and edges to show the relations among arguments. Then QBAFs are said to be (a)cyclic if the graphs representing them are (a)cyclic.\nDefinition 2. A gradual semantics $\\sigma$ is a function that evaluates a QBAF $Q = \\langle A,R^-,R^+ ,\\tau \\rangle$ by ascribing values $\\sigma(a) \\in [0, 1]$ to every $a \\in A$ as their strength.\nDifferent (gradual) semantics typically ascribe different strengths to arguments. Most semantics define the strength of an argument through an iterative procedure involving two functions: first, an aggregation function aggregates the strength of the argument's attackers and supporters; then, an influence function combines the aggregation values with the argument's base score to determine its strength. Gradual se- mantics guarantee convergence for acyclic QBAFs (Potyka 2019). For cyclic QBAFs, the strength values may not converge (Mossakowski and Neuhaus 2018), but when they do, they converge quickly in practice (Potyka 2018). Our focus in this paper is on cases where convergence occurs, as we"}, {"title": "4 Counterfactuals for QBAFS", "content": "We define three counterfactual problems (see Figure 2) and explore the existence of solutions thereto (i.e. counterfactuals) and their relationships. Intuitively, given a QBAF, a topic argument and a desired strength therefor, we see counterfactuals as changes to the base score function to obtain the desired strength for the topic argument.\n4.1 Strong Counterfactual Problem\nDefinition 4. Given a topic argument $a^* \\in A$ and a desired strength $s^*$ for $a^*$ such that $\\sigma(a^*) \\neq s^*$ in $Q$, the strong counterfactual problem amounts to identifying a base score function $\\tau' \\neq \\tau$ such that $\\sigma_{\\tau'}(a^*) = s^*$ (in $Q_{\\tau'}$).\nIn Figure 2 (left), $\\tau$ is in the (undesired) red part and $\\tau_1, \\tau_2, \\tau_3$ in the green part are possible counterfactuals (base score functions) as they exactly hit the desired strength.\nA trivial solution to the strong counterfactual problem might be just setting the base score of the topic argument to the desired strength and the base score of all others to 0.\nDefinition 5. Given a topic argument $a^* \\in A$ and a desired strength $s^*$ for $a^*$, the trivial counterfactual is the base score function $\\tau' \\neq \\tau$ such that $\\tau'(a^*) = s^*$ and $\\tau'(a) = 0$ for all $a \\in A \\setminus \\{a^*\\}$.\nThe trivial counterfactual is a solution to the strong counterfactual problem if the semantics satisfies the following stability property (Amgoud and Ben-Naim 2018)."}, {"title": "4.4 Validity and Problem Relationships", "content": "We define notions of validity for counterfactuals and then explore the relationships among these notions.\nTo be consistent with the literature of counterfactuals in XAI, if a base score function is a solution to a counterfactual problem, we say that this solution is a valid counterfactual.\nDefinition 9. A valid counterfactual for the strong/$\\delta$-approximate/weak counterfactual problem is a base score function $\\tau'$ which is a solution to the strong/$\\delta$-approximate/weak counterfactual problem, respectively.\nTo illustrate, in Figure 2, all $\\tau_i, \\tau_j$ and $\\tau_k$ are valid counterfactuals as they are solutions to the (respective) problems.\nNext, we study relationships among valid counterfactuals.\nProposition 3 (Problem Relationships).\n1. If a counterfactual is valid for the strong counterfactual problem, then it is also valid for the $\\delta$-approximate and weak counterfactual problems.\n2. If a counterfactual is valid for the $\\delta$-approximate counterfactual problem, then it is also valid for the weak counterfactual problem.\nCorollary 1. If $\\sigma$ satisfies s-stability and $Q$ is acyclic, then the trivial counterfactual is valid for the strong/$\\delta$-approximate/weak counterfactual problem.\nHowever, non-trivial valid counterfactuals do not always exist when not allowing directly setting the base score of the topic argument to the desired strength. For instance, when a topic argument is not connected with any other arguments in the QBAF, then there is no non-trivial counterfactual.\nProposition 4 (Uniqueness). There is a unique valid counterfactual (for the strong/$\\delta$-approximate/weak counterfactual problem) iff the trivial counterfactual is the only valid counterfactual (for the respective problem).\nWe leave to future study the identification of special classes of QBAFs for which non-trivial counterfactual explanations can be always guaranteed to exist."}, {"title": "5 Cost-Effective Counterfactuals", "content": "In this section we turn to computational challenges: we aim to design an algorithm that can return not only valid but also cost-effective counterfactuals for the $\\delta$-approximate counterfactual problem. We focus on this problem because, as discussed in Section 4.2, it may be unrealistic to aim at exactly matching the desired strength and solve the strong counterfactual problem and, by Proposition 3, once a valid $\\delta$-approximate counterfactual is returned, it is also valid for the weak counterfactual problem. We interpret cost as distance: the shorter the distance, the lower the cost of a counterfactual. This is in line with literature on counterfactual explanations in XAI (Wachter, Mittelstadt, and Russell 2017). To illustrate, in Figure 2 (middle), while $\\tau_i, \\tau_j$ and $\\tau_k$ are all valid $\\delta$-approximate, their distance to the original base score varies, using the following notion of distance.\nDefinition 10. The $L_p$-Norm Distance between $\\tau$ and $\\tau'$ is:\n$d_p(\\tau, \\tau') = (\\sum_{a \\in A} |\\tau(a) - \\tau'(a)|^p)^{\\frac{1}{p}}$"}, {"title": "5.1 Algorithm Design Properties", "content": "We will design an iterative algorithm that incrementally adapts the weight to find a close counterfactual. To do so, we need to determine an updating direction and magnitude, which means deciding how much each argument's base score should be increased or decreased. To determine the former, we partition arguments based on their polarity. We first define paths and connectivity between arguments.\nDefinition 11. For any $a, \\beta \\in A$, we let $p_{a\\leftrightarrow\\beta} = ((\\gamma_0, \\gamma_1), (\\gamma_1, \\gamma_2), \\dots, (\\gamma_{n-1}, \\gamma_n)) (n \\geq 1)$ denote a path from $a$ to $\\beta$, where $a=\\gamma_0$, $\\beta = \\gamma_n$, $\\gamma_i \\in A (1 \\leq i \\leq n)$ and $(\\gamma_{i-1}, \\gamma_i) \\in R^- \\cup R^+$.\nNotation 2. We let $P_{a\\leftrightarrow\\beta}$ denote the set of all paths from $a$ to $\\beta$, and $|P_{a\\leftrightarrow\\beta}|$ denote the number of paths in $P_{a\\leftrightarrow\\beta}$, respectively.\nWe next distinguish three types of connectivity based on the number of paths from one argument to another.\nDefinition 12. For any $\\alpha, \\beta \\in A$:\n*   $\\beta$ is disconnected from $\\alpha$ iff $P_{\\beta\\leftrightarrow\\alpha} = \\emptyset$;\n*   $\\beta$ is single-path connected to $\\alpha$ iff $|P_{\\beta\\leftrightarrow\\alpha}| = 1$;\n*   $\\beta$ is multi-path connected to $\\alpha$ iff $|P_{\\beta\\leftrightarrow\\alpha}| > 1$.\nExample 1. Consider the QBAF in Figure 3. $\\gamma$ is disconnected from $\\beta$ because there is no path from $\\gamma$ to $\\beta$; $\\gamma$ is single-path connected to $\\delta$ via path $p_{\\gamma\\leftrightarrow\\delta} = ((\\gamma, \\delta))$; $\\alpha$ is multi-path connected to $\\beta$, because there are infinitely many paths from $\\alpha$ to $\\beta$, namely $p_{\\alpha\\leftrightarrow\\beta} = ((\\alpha, \\beta))$, $P_{\\alpha\\leftrightarrow\\beta} = ((\\alpha, \\beta), ((\\beta, \\alpha), (\\alpha, \\beta))$ and so on.\nInspired by (Rago, Li, and Toni 2023; Yin, Potyka, and Toni 2023), we define polarity to characterize the influence between arguments according to their connectivity and the number of attacks on paths between them.\nDefinition 13. The polarity from $\\beta$ to $\\alpha$ ($\\alpha,\\beta \\in A$, $\\alpha \\neq \\beta$) is:\n*   neutral ($\\beta$ is neutral to $\\alpha$) iff $\\beta$ is disconnected from $\\alpha$;\n*   positive ($\\beta$ is positive to $\\alpha$) iff $P_{\\beta\\leftrightarrow\\alpha} \\neq \\emptyset$ and for every path $p_{\\beta\\leftrightarrow\\alpha} \\in P_{\\beta\\leftrightarrow\\alpha}$, $|p_{\\beta\\leftrightarrow\\alpha} \\cap R^-|$ is even;\n*   negative ($\\beta$ is negative to $\\alpha$) iff $P_{\\beta\\leftrightarrow\\alpha} \\neq \\emptyset$ and for every path $p_{\\beta\\leftrightarrow\\alpha} \\in P_{\\beta\\leftrightarrow\\alpha}$, $|p_{\\beta\\leftrightarrow\\alpha} \\cap R^-|$ is odd;\n*   unknown ($\\beta$ is unknown to $\\alpha$) iff $\\exists p'_{\\beta\\leftrightarrow\\alpha} \\in P_{\\beta\\leftrightarrow\\alpha}$ such that $|p'_{\\beta\\leftrightarrow\\alpha} \\cap R^-|$ is even and $\\exists p''_{\\beta\\leftrightarrow\\alpha} \\in P_{\\beta\\leftrightarrow\\alpha}$ such that $|p''_{\\beta\\leftrightarrow\\alpha} \\cap R^-|$ is odd."}, {"title": "5.2 Algorithms", "content": "Algorithm 1 computes the polarity from a to $\\beta$ ($\\alpha \\neq \\beta$) in three steps. Firstly, we compute all the non-cyclic paths from $\\alpha$ to $\\beta$ with Depth-First Search (DFS) and store them in a set of paths called $P_{\\alpha\\leftrightarrow\\beta}$. If there is no path, then the polarity is neutral. Secondly, all the nodes in all the paths are checked for cycles with the function find_cycles. If any of the node is part of a cycle, then we check whether each cycle contains an odd number of attacks. If this is the case, then the polarity from a to $\\beta$ is unknown because the cycle will contain both odd and even numbers of attacks by going through the cycle an odd or even number of times. For instance, suppose a QBAF consists of two arguments $\\alpha$ and $\\beta$, where $\\alpha$ attacks $\\beta$, and $\\beta$ supports $\\alpha$. In this case, path $((\\alpha, \\beta))$ is negative while $((\\alpha, \\beta), (\\beta, \\alpha), (\\alpha, \\beta))$ is positive, thus $\\alpha$ is unknown to $\\beta$. Finally, we check the number of attacks on every path: if all the paths contain an odd (even) number of attacks, $\\alpha$ is negative (positive) to $\\beta$, and it is unknown otherwise.\nAlgorithm 2 computes the priority from $\\alpha$ to $\\beta$. We define the self-priority of an argument as a constant greater than 1. Thus an argument has the highest priority to itself than any others. Next, we perform a DFS to compute all the non-cyclic paths from $\\alpha$ to $\\beta$ and return the reciprocal of the shortest path length.\nFinally, Algorithm 3 (which we call CE-QArg for Counterfactual Explanations for Quantitative bipolar Argumentation frameworks) is an iterative updating algorithm for identifying valid and cost-effective $\\delta$-approximate counterfactuals. CE-QArg essentially involves determining the direction and magnitude of arguments. For brevity, we assume the current strength of the topic argument is less than the desired one. Firstly, we compute the polarity and priority for each argument with the function func_polarity and func_priority from Algorithm 1 and 2, respectively. Secondly, the key part of this algorithm is to determine the updating direction in every updating iteration. For this, we need an update list to record the updating direction in each iteration. For positive, negative and neutral arguments (lines 5-10), we only need to identify the updating direction once since they remain invariant, whereas, for unknown arguments (lines 13-20), we need to compute their updating direction in every iteration by difference quotient using the function func_dquo, which can be intuitively implemented by Definition 16 (so we omit the details). Once the updating direction of every argument is determined in an iteration, we update the base scores of all arguments all in one go by a small step multiplied by their priority (line 22) and make sure they are within the bounds. We assume the step is small enough that the interactions among arguments can be neglected. We repeat this procedure iteratively until the current strength reaches the desired strength, after which we return a possible counterfactual (lines 11-24)."}, {"title": "6 Formal Properties for Explanations", "content": "We study the properties for counterfactuals, with a focus on the neutral, negative, and positive arguments. Here, we assume the gradual semantics considered satisfy both directionality and monotonicity. Note that the properties of explanations are distinct from those of semantics, despite the satisfaction of the former being dependent on the latter.\nExistence (\u010cyras, Kampik, and Weng 2022; Kampik et al. 2024) is a commonly considered property for explanations. It says that if the strength of an argument differs from its base score, then there must exist an argument that caused the change. Alteration Existence states that if a valid counterfactual increases the strength of the topic argument, then there must exist a positive (negative) argument whose base score is also increased (decreased) in the counterfactual whenever the QBAF does not have any unknown arguments.\nProposition 10 (Alteration Existence). Given a valid counterfactual $\\tau^*$ (for the strong/$\\delta$-approximate/weak counterfactual problem), a topic argument $a^* \\in A$ such that"}, {"title": "7 Evaluations", "content": "We show effectiveness (Experiment 1), scalability (Experiment 2) and robustness (Experiment 3) of CE-QArg. In this section, we focus on the $\\delta$-approximate counterfactual problem and valid explanations therefor with $\\delta = 0.1$.\nSettings We conducted experiments separately using acyclic and cyclic QBAFs. For acyclic QBAFs, we generated tree-like QBAFs as they occur in many applications of QBAFs (e.g. see (Kotonya and Toni 2019; Cocarascu, Rago, and Toni 2019; Chi et al. 2021)). We created full binary, ternary, and quaternary trees with different widths (2, 3, and 4) and depths (from 1 to 8) where each edge was randomly set to an attack or a support. The topic argument was set as the root of the tree. To improve the credibility of"}, {"title": "7.1 Experiment 1: Effectiveness", "content": "We show the effectiveness of CE-QArg by conducting ablation studies on polarity and priority. We first propose the Baseline method (BL) based on Proposition 9, which directly computes the difference quotient for all arguments as the updating indicators without considering their polarity and priority. We then separately applied priority or polarity on the BL to show their individual efficacy (denoted as BL+pri and BL+pol). Finally, we showed the performance of our CE-QArg which incorporates both polarity and priority. We evaluated CE-QArg on validity, $L_1$, $L_2$-norm distance, and runtime."}, {"title": "7.2 Experiment 2: Scalability", "content": "We evaluated the scalability of CE-QArg on QBAFs of varying sizes. We show both validity and the runtime performance. First, all tested acyclic and cyclic QBAFs achieved a validity score of 1.00. We next present the average runtime for acyclic and cyclic QBAFs with different sizes in Figure 5."}, {"title": "7.3 Experiment 3: Robustness", "content": "Robustness is a crucial and commonly considered metric for counterfactual explanation methods (Artelt et al. 2021; Jiang et al. 2023a; Jiang et al. 2023b; Jiang et al. 2024). An explanation method is robust against input perturbations if similar inputs leading to the same outputs give rise to similar explanations. For instance, if two loan applicants with similar conditions are rejected, they should obtain similar counterfactuals. However, non-robust methods may generate completely different counterfactuals for similar rejected applicants (see an example in Figure 1(b) of (Slack et al. 2021)), which is unfair as they have different updating costs to obtain the desired decision. As an illustration, the counterfactual explanation method in Figure 6 (left) is more robust against input perturbations than that of Figure 6 (right) as the new counterfactual is still close to the previous counterfactual after the input is perturbed. We propose a robustness against input perturbations metric which uses the $L_p$-norm distance to evaluate the robustness of CE-QArg under the perturbation of the input base score function.\nMetric 1. Given a perturbation score $e > 0$, two base score functions $\\tau$ and $\\tau^e = \\tau(a) + e$ for all $a \\in A$, and two counterfactual explanation $\\tau'$ for $\\tau$ and $\\tau^e$ for $\\tau^e$, the robustness against input perturbations is measured by $d_p(\\tau', \\tau')$.\nIn addition, inspired by (Jiang et al. 2024; Krishna, Agarwal, and Lakkaraju 2022; Raman, Magazzeni, and Shah 2023), we propose a robustness against noisy execution metric, which requires that the generated counterfactual could still lead to similar output (final strength for the topic argument) even if the counterfactual is perturbed. Still taking the loan application as an example, robustness against noisy execution ensures that when a rejected applicant is very close to the provided counterfactual, then the output of this counterfactual should also be close to the desired final strength. We evaluate robustness against noisy execution by the absolute difference between the strength of a topic argument obtained with two similar counterfactuals.\nMetric 2. Given a topic argument $a^* \\in A$, a perturbation score $e$, and two counterfactual explanations $\\tau'$ and $\\tau^e = \\tau'(a) + e$ for all $a \\in A$, the robustness against noisy execution is measured by $|\\sigma_{\\tau'}(a^*) - \\sigma_{\\tau^e}(a^*)|$.\nWe applied Metrics 1 and 2 with an increasing perturbation $e$ from $10^{-8}$ to $10^{-1}$ over acyclic and cyclic QBAFs. Figure 7 (left) shows the robustness against input perturbations through the average explanation difference measured by Metric 1, while Figure 7 (right) shows the robustness against noisy execution through the average strength difference of the topic argument measured by Metric 2. With the increase of $e$, the explanation difference and strength difference both showed an approximate linear and stable increasing trend, albeit in Figure 7 (right), we observed a bit of unsteadiness at the beginning when $e = 10^{-8}$ and $e = 10^{-7}$. Overall, CE-QArg exhibited robustness against input perturbations and noisy execution on both cyclic and acyclic QBAFs."}, {"title": "8 Conclusions", "content": "We formally defined three counterfactual problem variants and discussed their relationships. We proposed an iterative algorithm CE-QArg to identify valid and cost-effective counterfactuals. We discussed some formal properties of our counterfactual explanations and empirically evaluate CE-QArg on random generated QBAFs. Experimental results show that CE-QArg has a desirable performance on effectiveness, scalability, and robustness. While the identification of valid and cost-effectiveness counterfactuals still lacks sufficient theoretical guarantees because there is no closed expression for a topic argument's final strength in general (cyclic) graphs, we improved the searching process by applying polarity and priority so that the $L_1$ and $L_2$-norm distance and the runtime decreased significantly compared to the baseline (BL) method.\nThere are a few avenues for future work. First, it would be interesting to explore identifying counterfactuals in QBAFs when their structure can be changed by adding or removing arguments or edges. Second, it would be worth exploring identifying counterfactuals for multiple topic arguments simultaneously. However, this would be challenging as it involves the interactive effect among topic arguments. Third,"}]}