{"title": "SHEDAD: SNN-ENHANCED DISTRICT HEATING ANOMALY DETECTION FOR URBAN SUBSTATIONS", "authors": ["Jonne van Dreven", "Sadi Alawadi", "Abbas Cheddad", "Ahmad Nauman Ghazi", "Jad Al Koussa", "Dirk Vanhoudt"], "abstract": "District Heating (DH) systems are essential for energy-efficient urban heating. However, despite the advancements in automated fault detection and diagnosis (FDD), DH still faces challenges in operational faults that impact efficiency. This study introduces the Shared Nearest Neighbor Enhanced District Heating Anomaly Detection (SHEDAD) approach, designed to approximate the DH network topology and allow for local anomaly detection without disclosing sensitive information, such as substation locations. The approach leverages a multi-adaptive k-Nearest Neighbor (k-NN) graph to improve the initial neighborhood creation. Moreover, it introduces a merging technique that reduces noise and eliminates trivial edges. We use the Median Absolute Deviation (MAD) and modified z-scores to flag anomalous substations. The results reveal that SHEDAD outperforms traditional clustering methods, achieving significantly lower intra-cluster variance and distance. Additionally, SHEDAD effectively isolates and identifies two distinct categories of anomalies: supply temperatures and substation performance. We identified 30 anomalous substations and reached a sensitivity of approximately 65% and specificity of approximately 97%. By focusing on this subset of poor- performing substations in the network, SHEDAD enables more targeted and effective maintenance interventions, which can reduce energy usage while optimizing network performance.", "sections": [{"title": "1 Introduction", "content": "The high energy consumed by cities worldwide for heating purposes significantly impacts climate change, the sur- rounding environment and the economy. Essential actions and solutions must be considered to face this challenge. For instance, district Heating (DH) systems offer a solution to meet urban heating demands while leveraging renewable energies efficiently. DH systems generate heat centrally and then distribute it via a network of insulated pipes, making them one of the most sustainable methods for providing heat in densely populated areas Werner [2017]. The Inter- national Energy Agency (IEA) expects that by 2030, approximately 350 million buildings will be connected to DH systems, fulfilling 20% of global space heating requirements IEA [2022]. Despite their benefits, unlocking the immense possibilities of DH systems will require carefully addressing the substantial challenges that presently constrain their capabilities.\nOne major challenge is the presence of operational faults in DH substations, which negatively impacts the substation itself and the entire network. Studies indicate that a substantial percentage (approximately 43 and 75% of the substations) of DH substations can operate sub-optimal due to faults M\u00e5nsson et al. [2019], Gadd and Werner [2015]. The lack of automated Fault Detection and Diagnosis (FDD) methods aggravates this issue, allowing faults to persist for extended periods, significantly impacting energy use. Fortunately, with the introduction of automatic heat meters, DH networks become better equipped for data-driven solutions and, with the proper detection, could help reduce the DH customers' energy usage on average by 14% Leiria et al. [2023]. Although, current data collection is not standardized and is primarily focused on billing rather than FDD. Commonly, DH datasets comprise primary side hourly measurements, including features such as supply temperature, return temperature, and flow rate, alongside derived metrics such as energy consumption. Most often, secondary side information (supply/return temperatures, flow, set points, and indoor temperature) and supplementary information, such as layouts of DH networks and geographical substation locations, are confidential, limiting the depth and spatial analysis that can be conducted. Additionally, DH data contains much-introduced noise in the measurements, e.g., supply temperature measurements contain substation behavior due to the sensor placement, as well as unknown confounders influencing measurements, e.g., building occupancy, size, or domestic hot water usages, which makes many conventional analytical methods often fall short. Furthermore, the lack of labeled data Neumayer et al. [2023] amplifies the challenges, making it difficult to develop Machine Learning (ML) methods and validate them. Given the complexity and constraints of DH data, there is a need for tailored methods specifically for DH.\nAutomatic FDD is commonly done through three steps. The process begins with fault detection, where algorithms monitor system parameters to identify deviations. This is followed by fault diagnosis, which involves analyzing the data to pinpoint the fault's cause. The final step, fault correction, adjusts system settings automatically or prompts manual interventions to remedy the identified issues, thereby ensuring system integrity and operational continuity.\nThis study introduces an innovative approach, the Shared Nearest Neighbor Enhanced District Heating Anomaly Detection (SHEDAD), designed to approximate the relative topology of DH networks. By utilizing local operational data and identifying similarities, SHEDAD significantly enhances anomaly detection precision.\nWe use the consumer supply temperature profiles as a distance metric to define relative neighbors of DH substations, thereby allowing for localized anomaly detection (intra-cluster) using modified z-scores. We identify two distinct categories of anomalies: those related to supply temperatures and those concerning substation performance. Crucially, our method avoids the need for sensitive data, such as geographical substation locations and network layouts, effectively addressing privacy and security concerns while enabling comparative assessments of substation performance. We advance the traditional Shared Nearest Neighbor (SNN) clustering method by integrating several enhancements tailored for time series DH data. We focus on improving the initial neighborhood creation through a multi-adaptive k-NN graph, which helps to isolate anomalous substations while improving connectivity for regular substations. Additionally, we introduce a novel merging technique that significantly reduces noise and eliminates meaningless edges that often obscure traditional graphs, thereby clarifying the graph structure and enhancing the effectiveness of the clustering process."}, {"title": "2 Related Work", "content": "Anomaly detection in DH systems typically involves either a global comparison of all substations against each other across the entire system to identify unusual patterns M\u00e5nsson et al. [2018, 2019] or using regression analysis on individual substations to detect anomalies based on fixed thresholds T. et al. [2021], Calikus et al. [2018]. Regression analysis can detect sudden variations in substation behavior, i.e., when a fault occurs. However, an anomaly may remain undetected if the model is constructed during an existing fault. Local anomaly detection is frequently overlooked in many settings due to the constraints imposed by the confidentiality of geographical substation locations. However, such"}, {"title": "3 Data Acquisition", "content": "The dataset used in this study comprises sensor measurements linked to different substations and geographical data of a DH network located in the southern part of Shandong province, China. Specifically, the dataset consists of data recorded every 5 minutes from 248 substations. The data collection spanned one month, from 1st January 2024 to 31st January 2024 (8,928 samples), capturing operational measurements of each substation as described in Table 1, across a broad spectrum of outdoor temperatures ranging from -9\u00b0C to 11\u00b0C. This wide range of temperatures allows for detailed analysis of the substations under varying climatic conditions. Due to the sensitive nature of the information, the dataset is confidential and has not been made publicly available."}, {"title": "4 Method", "content": "Our approach, SHEDAD, aims to systematically identify two distinct types of anomalies within DH networks: supply temperature and performance anomalies.\nInitially, we construct a relative network topology, which utilizes supply temperature profiles as a distance metric to approximate spatial relationships and operational similarities between substations. This topology serves as the framework for our anomaly detection processes, enabling us to pinpoint local deviations in supply temperature that may"}, {"title": "4.1 Network Topology", "content": "The primary supply temperatures reaching the consumer substations are affected by several aspects that contribute to the heat losses Zhao and Shan [2019]. The aspects are:\n\u2022 Flow rate: The rate at which the heated water or medium is circulated through the network impacts the supply temperature. Higher flow rates can lead to reduced time delays in heat delivery. Flow rate is influenced by a combination of factors related to the heat source, network design, and the consumption patterns of each heat consumer.\n\u2022 Pipe Length and Diameter: Longer distances and variations in pipe diameter affect the time it takes for the heat to reach different parts of the network, which can lead to variations in supply temperature at different substations.\n\u2022 Water Supply Temperature: The initial temperature of the water supplied from the heat source directly influences the supply temperatures throughout the network. Any fluctuations at the source are propagated throughout the system."}, {"title": "4.1.1 preprocessing", "content": "The preprocessing step prepares the supply temperature profiles from each substation for subsequent analysis. This phase ensures the quality and consistency of the data, which are critical for the reliability of the analysis. At first, we used standard data cleaning procedures, e.g., removing substations with missing values, which resulted in removing 28 substations.\nWe start by segmenting the dataset into daily supply profiles. The segmentation allows for studying individual days instead of the entire period, which can help avoid issues that might arise when clustering extensive time series data. For example, significant patterns or anomalies on specific days might get averaged out or diluted if the entire dataset is used.\nTo ensure our model accurately reflects the diverse operational dynamics of DH networks, it is critical to sample data from a broad spectrum of conditions. For instance, supply temperature variations are influenced by outdoor temperatures, as on colder days, increased flow rates may result in smaller network delays. In contrast, warmer days might see reduced flow and larger network delays. We select r random days from the segmented data to mitigate selection bias and prevent the model from overfitting. This random selection process helps us capture a representative cross-section of operational scenarios, ensuring our analysis remains robust and generalizable across the different environmental conditions.\nFor each of the r randomly selected days, we create a distance matrix between all pairs of substations based on their supply temperature profile. The distances are calculated using Dynamic Time Warping (DTW), with a Sakoe-Chiba warp constraint Sakoe and Chiba [1978]. This constraint allows for small time shifts to reflect minor delays in the DH network but prevents overly aggressive realignments that could distort the true relationships. This step is crucial for capturing the dynamic nature of temperature changes over time while ensuring that only meaningful temporal variations are considered to improve the model performance."}, {"title": "4.1.2 Initialization", "content": "In this step, we aim to construct a representative graph G' where nodes N represent substations, and weighted edges E represent the DTW distance between substations. The primary goal is to optimally balance the number of edges, as an excessive number of edges can obscure vital connections by obscuring the graph. Conversely, too few edges create a sparse graph, potentially overlooking meaningful relationships. Our approach aims to fine-tune the number of edges to capture essential connections effectively, ensuring that the graph remains interpretable and comprehensive without being overly complex or overly simplified.\nFor each distance matrix $d_i \\in D$, we construct an adaptive k-nearest neighbor (k-NN) graph $G_i$. The number of neighbors k for each substation is dynamically adjusted based on its edge weights, allowing more neighbors as long as their weights are below the threshold. Specifically, for substations with high weights, indicating high dissimilarity to other substations, we reduce the associated k value to minimize substation connectivity, effectively isolating them from the main graph. Conversely, nodes with predominantly low-weight connections, indicating closer proximity, are allowed more neighbors, enhancing their connectivity within the graph. This adaptive approach ensures a nuanced representation of substation relationships, balancing the need to maintain overall network cohesion while isolating outlying substations. The criteria for adjusting $k_i = k_b + \\Delta k_i$, where $k_b$ is the base number of neighbors, and $\\Delta k_i$ is the adjustment computed as:\n$$\\Delta k_i = \\begin{cases}\n-\\lfloor \\frac{low_i}{k_b} - 1 \\rfloor, & \\text{if } low_i \\geq k_b, \\\\\n+\\lfloor \\frac{high_i}{k_b} - 1 \\rfloor, & \\text{if } high_i \\geq k_b,\n\\end{cases}$$(1)"}, {"title": "4.1.3 Approximation", "content": "The final step approximates the relative network topology through analysis of the merged graph obtained earlier. We use Agglomerative Hierarchical Clustering Sokal and Michener [1958] and Ward Linkage Ward Jr. [1963] to analyze the similarity matrix constructed in the previous step. This method starts with each substation as an independent cluster and iteratively merges them based on the similarity measure provided by the SNN matrix. This method creates a dendrogram, a tree-like diagram illustrating how substations merge during the clustering process. This visualization offers clear, interpretable results revealing the substations' hierarchical relationships. Agglomerative hierarchical clustering is particularly suited for DH networks due to its bottom-up approach, which naturally aligns with how substations are interconnected. By starting with the most similar pairs of substations and progressively building larger clusters, this method mirrors the geographic proximities inherent within the network. This incremental clustering process allows for a nuanced understanding of how local operational characteristics aggregate into broader patterns, providing valuable insights into the complex dynamics of DH systems."}, {"title": "4.2 Anomaly Detection", "content": "The topology approximation forms the essential foundation for our anomaly detection system, making it feasible only with the initial processing in place to enable effective detection. We construct a Minimum Spanning Tree (MST) for each cluster based on pairwise Euclidean distances calculated from the supply temperatures. This MST serves as the framework for our performance comparisons, where each substation in the tree is compared against its k neighboring substations. Given that a substation may be compared multiple times-up to k 1 times we normalize the anomaly scores by the number of comparisons each substation undergoes. A normalized score of 1 denotes a significant anomaly, as it has been flagged in all its comparisons. In contrast, a score of 0 indicates average performance relative to its peers, i.e., it has never been flagged as an anomaly.\nFor each comparison, we calculate the Median Absolute Deviation (MAD) to robustly measure the dispersion within each comparison of k + 1 substations (intra-cluster). Additionally, we use modified z-scores Crosby [1994] to identify the outlying substations, i.e., substations with absolute mean z-scores exceeding the threshold of two standard deviations below the median are identified as anomalies. This non-parametric approach provides a robust defense against outliers and ensures a more precise measurement of dispersion compared to standard deviation. It is especially effective in scenarios where the data within clusters may not follow a normal distribution, addressing the challenges posed by the diverse and potentially skewed data characteristics encountered in district heating systems.\nTo assess substation performance, we use the primary \u2206T, often seen as a key performance indicator and reflects the efficiency of heat transfer of a substation. AT is the difference between the primary supply temperature and the primary return temperature, with high \u2206T values suggesting better performance. However, since our analysis focuses on relative comparisons, a substation is considered poor-performing when its mean modified z-score is below 20 (single-sided) compared to its peers."}, {"title": "4.3 Experimental Setup", "content": "We evaluate our approach against common time-series clustering methods in DH, as outlined in van Dreven et al. [2023]. Specifically, we use time series k-means, Spectral clustering, k-Shape, and SNN. To evaluate the compactness and connectivity of our clusters, we employ the mean MST intra-cluster distance metric, mean intra-cluster variance, and empirical observations. The mean MST intra-cluster distance is defined as:\n$MI = \\frac{1}{n} \\sum_{i=1}^n d_i,$(3)\nwhere MI is the mean intra-cluster distance, $d_i$ denotes the distance between connected nodes within the cluster, and n is the total number of nodes.\nThe mean intra-cluster variance is defined as:\n$MV = \\frac{1}{n} \\sum_{i=1}^n (d_i-\\bar{d})^2,$(4)\nwhere MV is the mean intra-cluster variance, $d_i$ represents the distances between each pair of nodes within a cluster, and $\\bar{d}$ is the mean distance calculated from these $d_i$ values. This metric quantifies the variability of distances within a fully connected subgraph of a cluster. A lower variance indicates a high consistency in node connectivity, suggesting that the substations are closely and uniformly integrated. In contrast, a high variance may highlight significant disparities in distances. While our proposed solution is applied to the supply temperature profiles, we validate our outcomes using the actual geographical substation locations. Such data is typically confidential and, therefore, not commonly accessible. However, their availability in this study allows us to rigorously assess our method's effectiveness in approximating the relative substation locations.\nWe compute the sensitivity and specificity of our anomaly detection model based on manual analysis provided by a domain expert. Sensitivity, or true positive rate, measures the proportion of actual positives the model correctly identifies. Specifically, it is defined as:\nsensitivity = $\\frac{true\\ positives}{true\\ positives + false\\ negatives}$(5)\nOn the other hand, specificity, or the true negative rate, measures the proportion of actual negatives that are correctly identified and is given by:\nspecificity = $\\frac{true\\ negatives}{true\\ negatives + false\\ positives}$(6)\nIt is crucial to consider that the expert analysis, while invaluable, may have its own limitations and not encompass the full spectrum of anomalies. This potential oversight could influence the perceived accuracy of the sensitivity and specificity metrics."}, {"title": "5 Results and Discussion", "content": "This section comprises two subsections, subsection 5.1 draw our findings on the relative topology approximation and identification of the supply temperature anomalies. At the same time, subsection 5.2 discusses anomaly detection performance and provides relative comparisons."}, {"title": "5.1 Relative Topology Approximation", "content": "Our study evaluated the performance of multiple clustering algorithms compared to our proposed method on DH data. The evaluation criteria included mean intra-cluster variance and MST distances. As shown in Figure3, SHEDAD was consistently outperforming other clustering methods (from k > 13) and maintained a low mean intra-cluster variance (Figure 3a) and distance (Figure 3b) across various cluster sizes k. It is worth highlighting that the proposed approach can recognize both the degree of homogeneity and stability in cluster composition, indicating that the substations within each cluster are closely connected in proximity."}, {"title": "5.2 Performance Anomalies", "content": "The relative network approximation forms the basis for our performance anomaly detection. Initially, we identified 30 clusters, from which 16 clusters showing supply temperature anomalies were excluded, leaving us with 14 remaining clusters for the subsequent performance anomaly detection phase. As outlined in subsection 4.2, we construct an MST for each of the 14 remaining clusters. These MSTs enable us to perform intra-cluster performance comparisons. Each substation is evaluated against its k (indirect) neighbors using modified z-scores. In each comparison, the respective substations with a mean modified z-score below 20, as compared to their neighboring substations, received an anomaly vote. Votes are normalized by the number of comparisons the substation was involved in, up to k \u2013 1, resulting in a score between 0 (normal) and 1 (anomalous).\nThrough this process, we identified 14 substations that received at least one anomaly vote, indicating that compared to their peers, these substations are underperforming. Notably, five of these substations were consistently flagged across all their comparisons, each receiving the highest anomaly score of 1, which indicates a persistently poor performance relative to their peers and across all assessments. Two of these 14 anomalies were independently confirmed by a domain expert through manual analysis of the substations. Ideally, a normal operating substation should show a stable and consistent pattern in its return temperature or AT. Substantial variance or oscillating behavior may hint towards a fault in the substation, ranging from mechanical issues to wrong software settings. Upon further inspection, substations with an anomaly score of 1 exhibited this behavior, including high return temperatures, oscillating readings, low AT, or sudden temperature drops, potentially indicating poor heat utilization or other issues such as sensor malfunctions and incorrect settings.\nThis approach allows for concentrating maintenance efforts on a smaller subset of poorly performing substations. By targeting these specific substations, network operators can enhance overall network performance and reliability and optimize the allocation of maintenance resources. Such an approach enables a cyclical or iterative approach to network maintenance, where utilities can initially focus on the most anomalous substations, e.g., an anomaly score of 1."}, {"title": "5.3 Limitations", "content": "While our methodology has demonstrated effectiveness in network topology approximation and anomaly detection of substations, some limitations should be considered. The performance of our method is sensitive to the choice of hyperparameters, such as the number of neighbors, warp distance, and edge inclusion/exclusion thresholds, which require specific domain knowledge that may not always be available. Additionally, at higher cluster counts, our approach tends to form a few large clusters and many singletons, potentially obscuring detailed insights and affecting the granularity of anomaly detection. Moreover, while the method's performance might vary across different DH networks, it is based on universal aspects of DH systems. Though validated only on one dataset, we expect the SHEDAD approach to be generalizable to other DH networks. Future research should test its adaptability and refine its performance across a diverse set of DH networks."}, {"title": "6 Conclusions and Future Work", "content": "This study introduced a novel SNN-enhanced approach (SHEDAD) for anomaly detection in DH networks, leveraging the relative network topology to identify operational anomalies. Our method adeptly manages the complex data structures of DH systems and maintains network confidentiality. It has effectively isolated anomalies, identifying 16 supply temperature anomalies and 14 performance anomalies among 248 substations. We achieved a sensitivity of approximately 65% and a specificity of approximately 97%. The results underscore the potential of our automatic method to improve the efficiency and reliability of DH networks by enabling more precise maintenance responses based on the identified anomalies. The proposed approach promotes a cyclical strategy for network maintenance, prioritizing intervention at substations with the highest anomaly scores. This iterative process enhances the operational performance of DH networks and facilitates the systematic collection of labeled data of both normal and faulty data. Such data are invaluable for training and validating data-driven models, improving anomaly detection and fault diagnosis capabilities over time. Possible future efforts are directed towards the following:\n\u2022 Enhancing the method's network approximation capabilities, aiming to develop uniform-sized clusters and dynamically adjust the number k more effectively.\n\u2022 Extending validation and testing across various types of DH networks to improve adaptability and effectiveness under diverse conditions. We plan to integrate federated learning to enable decentralized, collaborative anomaly detection across substations without compromising data privacy.\n\u2022 Enhancing anomaly detection processes via machine learning techniques that harness federated learning for model training on data collected through targeted maintenance operations.\nWe aim to develop a more robust, efficient, and universally applicable anomaly detection methodology for DH networks by addressing these areas."}]}