{"title": "Retrieval-Retro: Retrieval-based Inorganic Retrosynthesis with Expert Knowledge", "authors": ["Heewoong Noh", "Namkyeong Lee", "Gyoung S. Na", "Chanyoung Park"], "abstract": "While inorganic retrosynthesis planning is essential in the field of chemical science, the application of machine learning in this area has been notably less explored compared to organic retrosynthesis planning. In this paper, we propose Retrieval-Retro for inorganic retrosynthesis planning, which implicitly extracts the precursor information of reference materials that are retrieved from the knowledge base regarding domain expertise in the field. Specifically, instead of directly employing the precursor information of reference materials, we propose implicitly extracting it with various attention layers, which enables the model to learn novel synthesis recipes more effectively. Moreover, during retrieval, we consider the thermo-dynamic relationship between target material and precursors, which is essential domain expertise in identifying the most probable precursor set among various options. Extensive experiments demonstrate the superiority of Retrieval-Retro in retrosynthesis planning, especially in discovering novel synthesis recipes, which is crucial for materials discovery. The source code for Retrieval-Retro is available at https://github.com/HeewoongNoh/Retrieval-Retro.", "sections": [{"title": "Introduction", "content": "Discovering new materials is a fundamental problem in materials science [28, 4, 25], providing innovative options in various industry fields, such as semiconductors and batteries [37, 36]. On the other hand, it is also important to establish synthetic routes for newly discovered materials [21], i.e., retrosynthesis planning, as the ability to synthesize these materials is essential for their successful commercialization beyond mere discovery.\nFor organic materials, retrosynthesis planning approaches identify valid and efficient synthetic routes [8] by breaking down complex target molecules into smaller molecules that are commercially available and easily synthesizable. During the process, they focus on the structural information of target molecules, such as functional groups and reaction centers, that are related to widely known organic reaction mechanisms [21, 7, 9, 40, 22, 23]. Following the practice of organic retrosynthesis, machine learning (ML) based approaches utilizing the molecular structure expressed as SMILES strings [43] or molecular graphs have been extensively studied [45, 33].\nHowever, unlike organic retrosynthesis, using the atomic structural information of inorganic materials for retrosynthesis presents significant challenges due to 1) the high computational load incurred by the larger number of atoms compared to organic molecules [7, 6], and 2) the failure of traditional physical theories for the atomic structure computation caused by the inclusion of diverse and unusual elements [11, 1]. Therefore, a chemical composition-based approach is essential for retrosynthesis planning of inorganic materials. Besides the challenges of using the atomic structural information, there is a lack of a clear and general theory regarding the mechanisms of inorganic synthesis reactions"}, {"title": "Preliminaries", "content": "Inorganic Retrosynthesis Planning with Chemical Composition. In inorganic retrosynthesis planning, determining the atomic structure of inorganic materials poses significant challenges and demands costly computational efforts. As a result, both chemists [21] and prior ML methodologies [18, 17, 12] depend exclusively on composition information. In line with previous studies, we also base our approach on the composition information of inorganic materials instead of structural data.\nNotations. An inorganic material can be quantitatively described by a composition vector $x \\in \\mathbb{R}^d$, where d represents the total number of unique chemical elements. Each element in the vector $x$ represents the proportion of each chemical element that constitutes the material. As an example, consider the material with chemical formula SiO2, where Si and O correspond to element numbers 14 and 6, respectively. It can be represented as $x = (x_1,x_2,...,x_d)$, where $x_{14} = \\frac{1}{3}, x_6 = \\frac{2}{3}$, with all other x values being zero. Moreover, following a previous work [10], we construct a fully connected composition graph $G = (E, A)$, where $E$ is the set of elements associated with the nonzero components of $x$, and $A \\in \\{1\\}^{n \\times n}$ is the fully connected adjacency matrix with n indicating the number of nonzero entries in $x$. We initialize the initial feature $e_i$ of each element $e_i$ in $E$ with Matscholar [44], whose element embedding is obtained from the vast amount of scientific literature.\nTask: Precursor Prediction. Following a previous work [12], we formulate precursor prediction as a multi-label classification problem. Given a fully connected graph $G = (E, A)$ representing an inorganic material, our objective is to train a model $F$ that predicts the possible precursors for the material, i.e., $y = F(G)$, where $y \\in \\{0, 1\\}^l$ indicates the label vector with each element signifying the predefined $l$ precursors. That is, each element $y_i$ in the label vector $y$ indicates whether i-th precursor is necessary ($y_i = 1$) or not ($y_i = 0$) for synthesizing the target material $G."}, {"title": "Problem setup"}, {"title": "Composition Graph Encoder", "content": "To begin with, we briefly introduce the compositional graph encoder, which is used to encode the material representation in the paper. Specifically, given a composition graph $G = (E, A)$ of a material, we obtain the material representation $g$ as follows:\n$g = Pooling(GNN(E, A)),$ (1)\nwhere \"Pooling\" refers to the sum pooling of the node representations within the composition graph $G$, which are derived from a GNN encoder. The detailed architecture used in the paper is provided in"}, {"title": "Proposed Method: Retrieval-Retro", "content": "In this section, we introduce our proposed method Retrieval-Retro, a novel inorganic retrosynthesis planning approach that implicitly extracts the precursor information of reference materials retrieved with two complementary retrievers, i.e., Masked Precursor Completion (MPC) Retriever and Neural Reaction Energy (NRE) Retriever. The overall framework of Retrieval-Retro is shown in Figure 3."}, {"title": "Reference Material Retrieval", "content": "Before we extract precursor information from the reference materials, it is essential to decide which material should be referenced for the extraction. To elaborately determine which materials to reference, we employ two complementary retrievers: the Masked Precursor Completion (MPC) retriever and the Neural Reaction Energy (NRE) retriever.\nMasked Precursor Completion (MPC) Retriever. MPC retriever identifies the reference materials sharing similar precursors with the target material by learning dependencies between precursors. Specifically, given a chemical composition vector $x$ of a target material, we obtain its representation $m = M(x)$, where $M: \\mathbb{R}^d \\rightarrow \\mathbb{R}^{d'}$ indicates two layered MLPs with non-linearity. We define a learnable precursor embedding matrix $P \\in \\mathbb{R}^{l \\times d'}$, whose i-th row $p_i \\in \\mathbb{R}^{d'}$ represents a learnable embedding vector for the i-th precursor. Concurrently, we generate a randomly perturbed precursor vector $\\tilde{y}$ from the provided precursor information $y$, and create a perturbed precursor matrix $\\tilde{P}$ by applying the perturbed precursor vector $\\tilde{y}$ as a mask to the precursor matrix $P$. Specifically, $p_i$ is masked if $\\tilde{y}_i = 0$, and is left unchanged otherwise. We then integrate the representation $m$ and the perturbed precursor matrix $\\tilde{P}$ with cross-attention to form precursor conditioned representation of the material $s$. Then, the model is trained to reconstruct the original precursor vector $y$ from the precursor conditioned representation $s$ and precursor matrix $P$, by representing probability for each precursor as follows $\\sigma(s^T p_i)$. The overall training procedure of MPC retriever is in Figure 1 (a).\nBy doing so, it enables the retriever to learn dependencies among precursors and the correlation between the precursors and the target material. With the MPC retriever, we calculate the cosine similarity between the representation of the target material and all materials in the knowledge base obtained through $M$, and retrieve the top K materials that are similar to the target material.\nNeural Reaction Energy (NRE) Retriever. Although the MPC retriever effectively identifies reference materials with potentially similar sets of synthesis precursors, it overlooks widely recognized domain expertise in the field, i.e., the thermodynamic relationships between materials, which is essential for the inorganic synthesis process, particularly in selecting appropriate precursors [35, 27]. More specifically, the thermodynamic driving force between the target material and precursor set can be quantified by Gibbs free energy ($\\Delta G$), which is a measure of the material's thermodynamic stability. Under constant pressure and temperature, a negative $\\Delta G$ indicates that the energy of the target material is lower than that of the precursor set, signifying that the synthesis reaction can occur spontaneously [31, 35]. As a result, it is widely known that the more negative $\\Delta G$, the more precursor set is likely to synthesize the target material.\nBased on this knowledge, it would be beneficial to retrieve materials that have the precursor set capable of inducing favorable reactions with the target material by considering the thermodynamic force. $\\Delta G$ can be approximated by the difference $\\Delta H$ between the enthalpy of the target and"}, {"title": "Implicit Precursor Extraction", "content": "Now, we discuss how to extract the precursor information from the reference materials elaborately selected in Section 3.1. While the previous work [12] directly utilizes the precursor information of the reference materials, this limits the model's ability to learn and deduce new synthetic recipes for the target material, which can significantly accelerate the materials discovery and reduce the cost of material synthesis. Therefore, we propose to implicitly extract the precursor information from the retrieved material with various attention layers, i.e., self-attention and cross-attention layers, which aim to enhance the representation of reference materials by considering other reference materials and extract the implicit precursor information from the enhanced representation, respectively.\nTo do so, we first encode the target material and K reference materials using their associated composition graphs $G$ via the composition graph encoder introduced in Section 2.2. As a result, we obtain the representation of target material $g_t \\in \\mathbb{R}^D$ and the K reference materials $G_r = [g^1, ..., g^K] \\in \\mathbb{R}^{K \\times D}$, where $g^k$ indicates the representation of the k-th reference material.\nReference Enhancing with Self-Attention. To effectively extract the precursor information from the reference materials, we first enhance the representation of these materials through a self-attention mechanism [39, 24]. This approach encourages the model to selectively determine which information to extract from a particular reference material by considering the relationships among various refer-ence materials. To do so, we first obtain a new matrix for reference materials $G' = [g'^1, ..., g'^K]$, where $g'^k = \\phi_1(g^k || g_t)$ indicates the modified representation of the k-th reference material regarding the target material, where $||$ denotes the concatenation operation, and $\\phi_1 : \\mathbb{R}^{2D} \\rightarrow \\mathbb{R}^D$ is a learnable MLP. Note that by modifying the representation of the reference material through concatenation with the target material, we allow the model to extract information pertaining to the target material, rather than focusing solely on the reference materials. Then, we implement a self-attention mecha-nism to determine which information to extract from the reference material, taking into account the"}, {"title": "Model Training", "content": "Finally, we compute the model prediction $\\hat{y}$ as follows: $\\hat{y} = \\phi_{classifier}(g_t || g_t^{MPC} || g_t^{NRE})$, where $\\phi_{classifier} : \\mathbb{R}^{3D} \\rightarrow \\mathbb{R}^{l}$ is an MLP with non-linearity. Note that each dimension in $\\hat{y}$, i.e., $\\hat{y_i}$, indicates the model's predicted probability of whether precursor i will be included or not. For model training, we adopt Binary Cross Entropy (BCE) loss, which is commonly used for multi-label classification learning [5, 47], as: $L = -\\frac{1}{l} \\sum_{i=1}^{l} [y_i \\log(\\hat{y_i}) + (1 - y_i) \\log(1 - \\hat{y_i})]$.\nExperimental Setup\nDatasets. We use 33,343 inorganic material synthesis recipes extracted from 24,304 materials science papers [20] following prior studies [12, 18]. Due to the lack of an extensive database containing inorganic synthesis recipes [20], we use the training set as the knowledge base, following a previous work [12]. Additional details about datasets are provided in the Appendix B.\nBaseline Methods. We compare Retrieval-Retro with two inorganic retrosynthesis methods (i.e., He et al. [12] and ElemwiseRetro [18]), two composition-based representation learning methods (i.e., Roost [10] and CrabNet [41]), and three newly proposed baselines (i.e., Composition MLP and Graph Network [3], Graph Network + MPC) to demonstrate the effectiveness of Retrieval-Retro. The first newly introduced baseline is called Composition MLP, which does not retrieve reference materials but instead relies on the composition vector of the material. He et al. [12] conducts inorganic retrosynthesis planning by using the MPC retriever to access reference materials based solely on the material's composition vector. ElemwiseRetro [18] acquires precursor information through a fully connected graph that represents the constituent elements within the material. Furthermore, two composition-based material representation learning approaches, namely Roost [10] and CrabNet [41], explore the intricate interactions among elements within materials using message passing and self-attention, respectively. Although these methods are initially designed for property prediction, we have adapted prediction heads so that they can be effectively used for inorganic retrosynthesis planning. We also evaluate two new baselines, Graph Network [3] and Graph Network + MPC. The former predicts precursors without retrieving reference materials, while the latter does so after retrieving references. As these methods utilize the same backbone GNN structure as in our approach,"}, {"title": "Model Training"}, {"title": "Empirical Results", "content": "Effectiveness of Retrieval-Retro in Inorganic Retrosynthesis Planning. In Table 1, we have the following observations: 1) Modeling the interaction among the constituent elements (Int. \u2713) proves more effective than simply representing the material as a composition vector (Int. X). This demonstrates the importance of modeling the interaction between the composition elements not only for the material property prediction task [10, 41], but also for inorganic retrosynthesis planning. 2) By comparing the methods that utilize retrieval (Retr. \u2713) with those that do not (Retr. X), it becomes apparent that using precursor information from reference materials contained in a synthesis literature knowledge base enhances the precursor prediction performance. This underscores the significance of reference materials, which is also a standard practice in the traditional material synthesis process. 3) We also find that Retrieval-Retro surpasses all baseline models, indicating that our method successfully facilitates inorganic retrosynthesis planning. Furthermore, there is a significant performance enhancement over baseline methods in the year split setting (Table 1 (a)), which is a more realistic and challenging scenario, proving Retrieval-Retro's efficacy in real-world inorganic material synthesis processes.\nDiscovering Novel Synthesis Recipes. As shown in the previous section, the precursor information of reference materials is beneficial for the inorganic retrosynthesis planning of the target material. This observation raises a natural question: How can we effectively integrate the information from reference materials into synthesis recipes, particularly for novel synthesis recipes? To answer this question, we evaluate how each component in the model affects the model's capability of deducing novel synthetic recipes for the target material. To do so, we first divide the test set of the year split dataset into Subset case and New case. As shown in Figure 1, the subset case includes target materials that share a common set of precursors with those in the training set, while the new case comprises target materials that have an entirely new set of precursors. Moreover, we mainly compare Retrieval-Retro with \u201cGraph Network + MPC\u201d in Table 1, since the only difference between the models lies in whether the model directly utilizes the precursor information from reference materials. Then, we separately assess the model's performance in the subset case and the new case."}, {"title": "Model Analysis", "content": "Ablation Studies: Effects of Retriever. To verify the effect of the retrievers, we conduct ablation studies by removing the retriever modules. In Table 3, we have following observations: 1) When reference materials are randomly retrieved without using trained retrievers, the model extracts pre-cursor information that is irrelevant to the synthesis of the target material, leading to a deterioration in performance. 2) Furthermore, using just one of the retrievers (i.e., either MPC or NRE) leads to underperforms the case when both retrievers are used, showing that the two retrievers are complemen-tary to each other as discussed in Section 4.2. In conclusion, we contend that both MPC and NRE retrievers should be employed to provide informative reference materials to the model, facilitating the the extraction of valuable information in inorganic retrosynthesis planning. We provide further ablation studies in Appendix E.3.\nSensitivity Analysis: Size of Knowledge Base. We evaluate how the size of the knowledge base affects the model performance. More precisely, from the original database, we sample various sizes of knowledge bases, such as 20%, 40%, and up to 100% (Full) of the size of the original database, and then retrieve reference materials from these sampled subsets. In Figure 4 (a), as expected, the larger the knowledge base, the more accurate the model's predictions. These findings illuminate potential avenues for further development of our model, particularly as more inorganic synthetic recipes are uncovered in the future.\nSensitivity Analysis: Number of Reference Materials. Moreover, we investigate how the varying number of reference materials K affects the model performance. In Figure 4 (b), we notice that model performance improves with an increase in the number of references up to a certain point, specifically $K = 3$. This reaffirms the importance of incorporating precursor information from reference materials for inorganic retrosynthesis planning. However, increasing the number of reference materials beyond $K = 3$ does not further enhance model performance, likely due to the introduction of irrelevant or"}, {"title": "Related Works", "content": "Machine Learning for Inorganic Retrosynthesis\nOwing to the intricate nature of inorganic retrosynthesis, the production of inorganic materials entails a mix of numerous synthetic variables, leading to a variety of subtasks: 1) Learning favorable reaction pathways with thermodynamic variables when a target and precursor set are provided [2, 27, 35], 2) Employing regression models to predict conditions of the reaction pathway, such as heating temperature and time [13], and 3) Predicting possible precursor sets for a target material. In this work, we focus on the precursor selection task, which aims to predict feasible sets of precursors for synthesizing a target material [17, 18, 12].\nPrecursor Prediction Task. As a pioneering work, CVAE [17] generates synthesis actions and precursors through a generative model, i.e., conditional variational autoencoder [19]. However, it frequently produces chemically invalid precursors by relying on the generative model. ElemwiseRetro [18] alleviates the issue by formulating the precursor prediction task as a multi-class classification with dozens of manually created precursor templates. While it successfully suggests chemically valid precursors, it fails to incorporate knowledge from synthesis literature, which is common practice in the field of material science. More recently, inspired by the chemists' synthesis practice, He et al. [12] propose to use the precursor information of materials that are similar to the target material, which is retrieved from the related literature. This approach utilizes the precursors of the retrieved material as explicit conditions for predicting the precursors of the target material. However, such"}, {"title": "Machine Learning for Inorganic Retrosynthesis"}, {"title": "Composition-based representation learning for Inorganic materials", "content": "While most machine learning approaches for inorganic materials predominantly utilize structural information, in real-world material discovery, structural data is often unavailable due to the high costs of computational resources. Consequently, some ML methods opt to use compositional information of inorganic materials instead of structural details. For example, ElemNet [15] proposes to learn the representation of material with compositional information using deep neural networks (DNNs). Roost [10] learns material representation by building fully connected graphs based on the composition to model interactions between elements by graph neural networks (GNNs). Additionally, CrabNet [41] successfully applies a self-attention mechanism to the element-derived matrix to accurately predict the properties of materials. Although these methods were originally designed for predicting material properties, they can also be applied to inorganic retrosynthesis as they similarly rely on the composition information of materials."}, {"title": "Difference between Inorganic Retrosynthesis and Organic Retrosynthesis", "content": "Both organic and inorganic retrosynthesis are challenging tasks that predict the synthesis of mate-rials by breaking down the target material into simpler precursors. However, there are significant differences between organic and inorganic retrosynthesis. Organic retrosynthesis [45, 40, 7, 9, 33] deals with organic compounds, which are molecules primarily composed of elements such as carbon, hydrogen, oxygen, nitrogen, and sulfur. These compounds are represented using molecular structure graphs or SMILES strings. In contrast, inorganic retrosynthesis involves inorganic compounds, which can include a wider variety of elements, often including metals, and have structures that periodically repeat in unit cells. Another key difference lies in the use of structural information during retrosynthesis planning. Organic retrosynthesis utilizes structural information such as functional groups and reaction centers of organic compounds, which indicate the properties of a material and its reactivity with other molecules, to predict simpler molecules (precursors) into which the target molecule can be broken down. Inorganic compounds, however, have relatively unexplored generalized synthesis mechanisms compared to organic compounds, and calculating their structures is expensive. Therefore, it is challenging to directly use structural information for retrosynthesis planning. Instead, inorganic retrosynthesis [12, 17, 18] often relies solely on the chemical composition of the materials, distinguishing it from organic retrosynthesis."}, {"title": "Limitations", "content": "We aim to identify favorable precursor sets by considering the thermodynamic relationships between materials and their precursor set. However, in the actual synthesis process, the phase changes of materials are influenced by synthesis temperature, synthesis time, pressure condition and pairwise reactions between precursors. Taking these factors into account would enable more accurate precursor set predictions. Nevertheless, in situations where experimental data (such as temperature and pressure) are unavailable, we estimate the reaction energy solely from the formation energy calculated under consistent temperature and pressure conditions using a trained predictor, derived from the composition of materials. Considering multiple synthesis conditions can lead to more precise predictions of precursor sets."}, {"title": "Conclusion", "content": "In this study, we introduce Retrieval-Retro, a novel method for inorganic retrosynthesis planning by extracting the precursor information of retrieved reference material implicitly. To do so, we employ various attention layers that enhance and extract the information from the reference material. Moreover, we design a neural reaction energy (NRE) retriever that provides complementary reference material to the MPC retriever, allowing Retrieval-Retro to integrate precursor information from a broader range of reference materials through domain expertise. Through extensive experiments, including assessments in realistic scenarios, we demonstrate the effectiveness of implicit extraction of precursor information and NRE retriever in discovering novel synthesis recipes of target material, demonstrating the potential impact of Retrieval-Retro in the field."}]}