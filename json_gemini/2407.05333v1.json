[{"title": "3.3.2. Data transformation.", "authors": ["LUKAS FUCHS", "ORKUN FURAT", "DONAL P. FINEGAN", "JEFFERY ALLEN", "FRANCOIS L.E. USSEGLIO-VIRETTA", "BERTAN OZDOGRU", "PETER J. WEDDLE", "KANDLER SMITH", "VOLKER SCHMIDT"], "abstract": "Understanding structure-property relationships of Li-ion battery cathodes is crucial for optimizing rate- performance and cycle-life resilience. However, correlating the morphology of cathode particles, such as in NMC811, and their inner grain architecture with electrode performance is challenging, particularly, due to the significant length- scale difference between grain and particle sizes. Experimentally, it is currently not feasible to image such a high number of particles with full granular detail to achieve representivity. A second challenge is that sufficiently high- resolution 3D imaging techniques remain expensive and are sparsely available at research institutions. To address these challenges, a stereological generative adversarial network (GAN)-based model fitting approach is presented that can generate representative 3D information from 2D data, enabling characterization of materials in 3D using cost- effective 2D data. Once calibrated, this multi-scale model is able to rapidly generate virtual cathode particles that are statistically similar to experimental data, and thus is suitable for virtual characterization and materials testing through numerical simulations. A large dataset of simulated particles with inner grain architecture has been made publicly available.", "sections": [{"title": "1. INTRODUCTION", "content": "Improving Li-ion battery energy-density, power-density, and cycle-life is intricately linked to addressing the climate crisis by enabling transportation electrification and increasing storage capabilities for renewable energy sources. The tremendous progress in Li-ion battery performance, achieved over the past 30 years, has largely stemmed from fine tuning electrode microstructures and electrolyte compositions, without much change in the active material elemental composition [1]. Yet, opportunities still exist for controlling cathode sub-particle microstructure to enhance perfor- mance [2,3]. For example, frabricating radially oriented and elongated grains within LiNiMnyCo\u2082O\u2082 (NMCxyz) cathode particles has been shown to significantly increase rate capability as compared to cathode particles that have no preferential grain orientation or internal architecture [2, 4-6]. It is also expected that by designing cathode grain microstructures, chemo-mechanically induced fracture, which perpetuates loss-of-active-material and eventually leads to battery capacity fade, can be reduced [3]. The present paper seeks to improve the understanding of structure- property relationships between particle-level and grain-level microstructures and observed battery performance. This is achieved by developing a tool that can generate representative microstructures from experimental data. These realistic microstructures are essential in experiment data interpretation and are required for physics-based models that seek to explore particle- and grain-level physics that ultimately determine battery performance and longevity.\nThere is a need in the community for a tool that can generate representative microstructures for mesoscale battery models to assist in mapping realistic microstructural information to cell-level performance. Physics-based models have been used to help accelerate Li-ion battery electrode development. For example, physics-based models can be used to optimize designs for fast-charge performance [7-10]. Effective optimization using battery models requires relatively fast computation times. To achieve fast computation times, physics-based models typically abstract detailed electrode-level, particle-level, and grain microstructures to \"effective\" parameters that approximate these intricacies [11]. Examples of these effective parameters include: secondary-particle diameter, specific surface area, solid-phase diffusion coefficients, and electrolyte tortuosity. While these fast electrochemical models have shown great promise, there is a disconnect between the optimized effective parameters and the underlying complex microstructures that can achieve these performance metrics.\nMoreover, geometric complexities not typically included in physics-based models, such as grain orientation, grain size, and secondar particle surface area, can strongly influence cell aging [2, 12]. For example, secondary particle cracking has a complex relationship with capacity fade-cracks reduce solid-phase diffusion lengths and increase specific surface area [13], but can isolate active material and introduce unprotected surfaces for side reactions [14-16]). Additionally, grain orientation, size, and shape greatly influence the apparent solid-phase diffusion coefficient [17]. To bridge the gap between optimized effective parameters, identified in physics-based models and real microstruc- tures, researchers have developed \"mesoscale\" models that focus on particle- and grain-level microstructures and associated electro-chemo-mechanic physics [15,18-22]. However, generating statistically representative, realistic par- ticle and grain microstructures as inputs for these mesoscale models is challenging [23, 24]. Consequently researchers often approximate geometries with idealized shape, size, and orientations [15, 19-22, 25-29].\nIn the present paper, a \"multi-scale\" particle model is developed to generate representative secondary NMC811 particles comprised of representative grains (primary-particles). The multi-scale approach can be subdivided into two distinct models that can generate virtual morphologies that statistically resemble secondary-particles and grain architectures. A similar two-part, multi-length-scale approach was used previously [30]. As in this study, the outer secondary-particle shell is generated using a random field on the unit sphere [31], and the inner grain architecture is generated using a random tessellation. Roughly speaking, common (distance-based) tessellations can be considered as parametric partitions of Euclidean space, such as the Voronoi or Laguerre diagram [32]. Unlike the previous study [30], the proposed grain architecture model is not based on Laguerre tessellations [33], but on a more general class. Furthermore, in contrast to previous approaches, a neural network is implemented to generate the parameters of the tessellations. Importantly, this allows for a novel (gradient descent-based) fitting procedure of the tessellation model, enabling the generation of 3D grain architectures solely by using 2D planar section information.\nSeveral neural-network-based approaches for 2D-3D (re-)construction approaches have been explored previously [34- 36]. In contrast to the present model, most of these black-box methods are based on upsampling [37] or transposed convolution [38] techniques to generate discrete 3D voxel representations from 2D pixel images (i.e., slices or pro- jections). These generated 3D voxel representations do not have any underlying constraints and thus are able to generate any morphology at the expense of interpretability and computational efficiency.\nIn contrast to other 2D-to-3D generation methods, the present method does not solely rely on neural networks and the generation of a 3D voxel-based representation. Instead, a neural network and a Poisson point process [39,40] is used to generate (continuous) tessellation parameters [41, 42]. More precisely, the parameters of the random tessellation model, i.e., the parameters of the neural network and the point process, are fit by a generative adversarial network (GAN)-based [43] approach, allowing for the simulation of realistic 3D grain architectures. These virtual grain architectures are then sliced into several 2D images and passed to the so-called discriminator to be compared with measured grain architectures. The output of the discriminator is then used to update the parameters of the grain architecture model to generate more realistic 3D grain architectures. After training, the generated 3D structures are"}, {"title": "2. MATERIALS; ACQUISITION, PREPROCESSING AND ANALYSIS OF IMAGE DATA", "content": "2.1. Overview of experimental approach. To supply sufficient high-quality image data on particle and grain architectures, a multi-modal approach was deployed. Electron backscatter diffraction (EBSD) was used, as previously described in [48], to facilitate grain and grain boundary segmentation, as well as populate the segmented grains with local crystallographic orientation information. Note, there is a distinction between crystallographic and morphological grain orientation; crystallographic orientation refers to the orientation of the c-axis of the NMC811 crystal, whereas morphological grain orientation refers to the direction of the major axes of the best fitting elongated spheroid shapes of the grains with respect to the particle center. Conducting EBSD on a small number of particles provides a view of hundreds of grain planar sections. However, extending EBSD to 3D via focused ion beam (FIB)-EBSD and acquiring morphological data on hundreds of full particles is not yet practical experimentally. Instead, the (secondary-) particle morphological information, or outer shell, was captured in detail for many particles by X-ray nano-computed tomography (nano-CT) at the cost of a lack of inner grain architecture information. The outer shell and sub-particle grain architectures are independent and therefore must each be quantified with a sufficient number of samples to be representative. The combination of 2D EBSD and 3D nano-CT facilitated detailed information on the sub-particle grain features and full particle outer shell morphological detail, respectively, with sufficient volume to achieve representivity in both.\n2.1.1. Materials. A pristine sample of NMC811 electrode was used for this work. The electrode consisted of 96 wt% Targray NMC811, 2 wt% Timcal C-45, and 2 wt% Solvay 5130 PVDF binder. The Al foil was 20 \u00b5m thick, and the coating thickness was 58 \u00b5m with a porosity of 33% and areal capacity of 3.07 mAh cm-2. These cathodes have been extensively studied in fast-charge applications for electric vehicles [2, 12, 49, 50]. The preferential radial orientation of these particles is argued to significantly increase these cathodes rate performance and cycle-life resiliency [12].\n2.1.2. X-ray nano-computed tomography (nano-CT). For X-ray nano-CT imaging, cylindrical pillars of ca. 90 \u00b5m diameter were prepared using a micro-machining laser ablation approach described previously in [51]. The pillars were then imaged in a Zeiss Xradia Ultra 810 X-ray nano-CT system in Large Field of View (LFOV) absorption mode with binning 2, giving a voxel size of 128 nm. The field of view was 64 \u03bcm \u00d7 64 \u03bcm. 1601 images were acquired for the reconstruction of each tomogram.\n2.1.3. SEM and EBSD imaging. The NMC811 cathode sample was argon-milled with a JEOL CP ion beam planar section polisher (JEOL, USA). This provided a wide (ca. 2 mm) smooth planar section of the NMC811 electrode. Scanning electron microscopy (SEM) and EBSD images were taken on several planar sectioned particles using an FEI Nova NanoSEM 630 equipped with an EBSD detector (EDAX, USA). EBSD data was collected using step sizes of 50 nm rastered across the surface of particle planar sections. EBSD data was processed with OIM Analysis v.8 (EDAX, USA). Diffraction patterns were fit to a trigonal crystal system (space group R-3 m) with a = b = 2.875 \u00c5 and c = 14.248 \u00c5 to obtain the orientation of the crystal at each, where a, b, c denote the side lengths of the rhombohedral unit cell associated with the crystal's atomic lattice. The software produced text files containing a spatially resolved confidence index, image quality (IQ), and Bunge-Euler angle data. These data were then converted into images, where individual grains are labeled separately.\n2.2. Preprocessing of nano-CT data. The NMC811 particles' outer shells are modeled by a random field on the sphere. Fitting the random field model requires preprocessing the nano-CT data.\n2.2.1. Segmentation and labeling. Initially, the 3D grayscale CT image, undergoes segmentation and labeling. This process includes convolving the grayscale image with a discrete 3D Gaussian kernel with standard deviation \u03c3 = 1.8, followed by Otsu thresholding [52] and labeling of the resulting binary 3D image using the watershed algorithm [53]. Subsequently, disconnected components of the watershed-labeled image are separated, and small (volume V < 10 voxels) or non-spherical (sphericity \u03a8 < 0.5, see Eq. (20) for a formal definition) components are merged with their corresponding neighboring components if they exist; otherwise, they are neglected to remove artifacts. Finally, components intersecting the boundary of the sampling window are removed to minimize edge effects. This procedure yields N = 1590 labeled particles in voxel representation,"}, {"title": "2.2.2. Spherical harmonics representation.", "content": "These voxel-based particles are assumed to be star-shaped such that their so-called star point coincides with their centers of masses. Thereby, a star-shaped domain is one where every line segment from the star point to a boundary point lies entirely inside the domain. Therefore, a particle with center of mass $c\\in \\mathbb{R}^3$ can be represented by a radius function $P : S^2 \\rightarrow \\mathbb{R}_+ = [0,\\infty)$ on the unit sphere $S^2 = \\{x \\in \\mathbb{R}^3 : |x| = 1\\}$ given by\n\\(P(u) = \\max\\{r \\in \\mathbb{R}_+ : \\text{voxel } \\xi(ru + c) \\text{ belongs to the particle}\\},\\quad \\text{ for each } u \\in S^2,\\)\nwhere $\\xi(x) \\in \\mathbb{Z}^3$ denotes the grid point that is closest to some point $x \\in \\mathbb{R}^3$. For a visual validation of the star-shape assumption,. To stochastically model the star-shaped particles, the particles radius is modeled as a function by means of random fields on $S^2$. Realizations of these models can be considered to be radius functions that describe the outer shell of particles. Therefore, we use so-called (real-valued) spherical harmonic functions $Y_{\\ell m} : S^2 \\rightarrow \\mathbb{R}$ for $\\ell \\in \\mathbb{N}_0 = \\{0,1,...\\}$ and $m \\in \\mathbb{Z} = \\{\\dots, -1, 0, 1, \\dots\\}$ with $|m| \\leq \\ell$, which are given by\n\\[\nY_{\\ell m} (u) = \\sqrt{\\frac{2\\ell+1}{4\\pi}\\frac{(\\ell-|m|)!}{(\\ell+|m|)!}} P_{\\ell}^{|m|}(\\cos(\\theta(u))) \\begin{cases} \\sin(|m|\\varphi(u)), & \\text{if } m < 0, \\\\ P_{\\ell}^{0}(\\cos (\\theta(u))), & \\text{if } m = 0, \\\\ \\sqrt{2} \\cos(m\\varphi(u)), & \\text{if } m > 0, \\\\ \\end{cases} \\text{ for each } u \\in S^2,\n\\]\nwhere $P_{\\ell}^{m}:[0,1] \\rightarrow [0,1]$ are the Legendre polynomials and $\\theta(u) \\in [0,\\pi)$, $\\varphi(u) \\in [0,2\\pi)$ are the polar and the azimuthal angles of $u \\in S^2$, respectively. These functions form an orthonormal basis of the Hilbert space $L^2(S^2)$ of square-integrable functions\u00b9 on the unit sphere $S^2$ [54]. Thus, loosely speaking, the surface of each star-shaped particle can be expressed as a linear combination of spherical harmonic functions. As the order of these spherical harmonic functions increases (i.e., the value of $\\ell$), they contribute to capturing more detailed and rougher surface features. Since the considered CT data has a finite resolution, it is not meaningful to consider significantly high orders. Therefore, in the following only spherical harmonic basis functions with $\\ell < L = 9$ are considered. This results in a spherical-harmonics representation $\\hat{P} : S^2 \\rightarrow \\mathbb{R}_+$ of the radius function $P$, given by\n\\[\n\\hat{P}(u) = \\sum_{\\ell=0}^{L} \\sum_{m=-\\ell}^{\\ell} a_{\\ell m} Y_{\\ell m}(u),\\quad \\text{ for each } u \\in S^2,\n\\]\nwhere $a_{\\ell m}$ are the $(L + 1)^2 = 100$ coefficients of this basis representation. The computation of these coefficients for a given star-shaped particle's radius function $P$, and therefore its approximation in terms of the spherical harmonics basis up to order $L$, is done by least squares regression. More precisely, the least squares fit between $P(Ru)$ and $\\hat{P}(u)$ is computed regarding 642 equidistant evaluation points $u \\in S^2$ on the unit sphere, resulting in 642 equations with the 100 variables $a_{\\ell m}$. Here, $R\\in \\mathbb{R}^{3\\times 3}$ denotes a rotation matrix, uniformly chosen at random, which helps to mitigate any anisotropy in the data arising from the voxel-based representation of the CT data or the segmentation procedure. For a visual inspection of the quality of this fit,"}, {"title": "2.3. Morphology of 2D grain architectures.", "content": "As mentioned in Section 2.1.3, the text data produced by the EBSD measurement was first converted into image data of labeled grains. These 2D image data resulting from EBSD measurement are from now on referred to as 2D EBSD (planar section) data. The grain architectures observable in these data show a non-uniform morphological orientation, i.e., the grains morphologies exhibit a preferred orientation towards the center of the particle planar section, which is identified as the origin o = (0,0) \u2208 R2 of the coordinate system. Note that morphological orientation described here is distinct from crystallographic orientation. The proposed model should be able to reflect this behavior, thus, the orientation of individual 2D grains has to be captured quantitatively. For this purpose, the principal components v\u2081, v\u2082 \u2208 R\u00b2 of the pixel positions associated with a grain, along with their corresponding eigenvalues e\u2081 > e\u2082 > 0 are utilized. The first principal component v\u2081 is a direction that maximizes the (empirical) variance of the pixel positions [55]. In other words, it describes the primary orientation of the grain. The orientation \u03b1 \u2208 [0, \u03c0] of a grain is thus given by the smallest angle between the grain's center c (in the planar section) and v\u2081, \u0456.\u0435.,\n\\[\n\\alpha = \\arccos \\frac{v_1^T c}{|v_1||c|},\n\\]\nsee . For grains with \u03b1 \u2248 0 the principal component v\u2081 points towards the origin, whereas an orientation \u03b1 = \u03c0/2 corresponds to principal components that are orthogonal to the direction pointing to the origin. shows the grain orientation distribution per 2D EBSD image. Furthermore, exemplary planar sections are presented Notably, for some planar sections, the corresponding EBSD data (outlined with gray boxes in ) exhibits no preferred grain orientation. It is conjectured that these images correspond to planar sections located farther away from the particle center as compared to those highlighted with a black box, i.e., the assumption that the particle center is located at the origin of the planar section observed in the EBSD image is not valid. However, the stereological model fitting approach for the inner grain architecture model, introduced in Section 3.3, relies on image data of planar sections passing through the particle center, since in such images, grains in each radial distance from the particle center can be observed, a property not present in planar sections at other locations. Consequently, EBSD planar sections represented by gray curves are excluded from the subsequent model fitting procedure."}, {"title": "3. STOCHASTIC MULTI-SCALE MODEL", "content": "In this section, the stochastic models for both the outer shell and the inner grain architecture, along with their corresponding fitting procedures, are presented. The choice of a two-scale modeling approach is driven by the pre- sumed minimal correlation between the outer shell of NMC811 particles and their inner grain architecture. Initially, the outer shell structure is modeled on a coarser length scale (by means of nano-CT data), before proceeding to the modeling of the inner 3D grain architecture, which is observable on a finer length scale (by means of 2D EBSD data).\n3.1. Stochastic outer shell model. After the preprocessing of nano-CT data explained in Section 2.2, the next step towards stochastic outer shell modeling is to describe the distribution of the coefficients $a_{\\ell m}$ appearing in by appropriately chosen random variables $Z_{\\ell m}$. Due to the assumed isotropy of the underlying image data, the random variables $Z_{\\ell m}$ and $Z_{\\ell m'}$ are supposed to be identically distributed for any $m,m'$. For $(\\ell,m) \\neq (\\ell', m')$ with $\\ell, \\ell' \\neq 0$, the random variables $Z_{\\ell m}$ and $Z_{\\ell'm'}$ can be assumed to be independent, see [56]. Furthermore, to justify the assumption of independence of $Z_{00}$ and $Z_{\\ell m}$ for $\\ell,m \\neq 0$, the empirical distance correlation coefficient (edcc) [57] of the observations of $a_{00}$ and $a_{\\ell m}$ is investigated. Note that the distance correlation coefficient of two random variables is zero if and only if the random variables are independent. Thus, the small values of the edcc, shown, justify the assumption of independence. Moreover, the coefficients $a_{00}$ which predominantly"}, {"title": "", "content": "influence the size of the particles are described by a log-normally distributed random variable $Z_{00}$ with parameters $\\mu = 0.4$, $\\sigma = -29.83$, whose probability density $f_0: \\mathbb{R}_+ \\rightarrow \\mathbb{R}_+$ is given by\n\\[\nf_0(x | \\mu, \\sigma) = \\frac{1}{\\sqrt{2\\pi}\\sigma x} \\exp\\left( - \\frac{(\\ln(x) - \\mu)^2}{2\\sigma^2}\\right),\\quad \\text{ for each } x \\in \\mathbb{R_+}.\n\\]\nOn the other hand, for each $\\ell > 0$, the coefficients $a_{\\ell m}$ are described by a scaled Student's t-distribution, i.e., for some $\\nu, \\tau > 0$, the probability density $f_{\\ell}: \\mathbb{R}_+ \\rightarrow \\mathbb{R}_+$ of the random variable $\\tau Z_{\\ell m}$ is given by\n\\[\nf_{\\ell}(x | \\nu) = \\frac{\\Gamma(\\frac{\\nu+1}{2})}{\\sqrt{\\pi \\nu}\\Gamma(\\frac{\\nu}{2})} \\left(1 + \\frac{x^2}{\\nu} \\right)^{-(\\nu+1)/2},\\quad \\text{ for each } x \\in \\mathbb{R},\n\\]\nwhere $\\Gamma$ and $\\ln$ denote the gamma function and the natural logarithm, respectively. The fitted values of the parameters $\\nu$ and $\\tau$ are given in Table 1, see also  for a visual validation of the fitted densities $f_{\\ell}: \\mathbb{R}_+ \\rightarrow \\mathbb{R}_+$ for $\\ell = 0, 1, ..., 9$.\nThe resulting outer shell model $\\{X(u), u \\in S^2\\}$ is given by\n\\[\nX(u) = \\sum_{\\ell=0}^{L} \\sum_{m=-\\ell}^{\\ell} Z_{\\ell m} Y_{\\ell m}(u) \\quad \\text{ for each } u \\in S^2,\n\\]\nwhere $Y_{\\ell m}$ denotes the spherical harmonic function introduced in Eq. (2). Realizations of this model are shown in . Note that the model has been calibrated on a voxel grid, see Eq. (1). Thus, the generated outer shells are scaled by the voxel side length of 128 nm afterwards.\n3.2. Stochastic grain architecture model. This section introduces the model used to describe the inner grain ar- chitecture of NMC811 particles. The model is based on a so-called generalized balanced power diagram (GBPD) [58], which is a generalization of the well-known Voronoi [32] and Laguerre [33] tessellations. GBPDs are a powerful tool to describe Euclidean space filling structures, such as grains, in a low parametric way [41]. This low-parametric rep- resentation allows for data compression, fast computation, and a simpler and more interpretable grain architecture modeling as compared to voxel-based approaches.\nIn general, for any integer $d\\in \\mathbb{N} = \\{1,2,...\\}$, a GBPD is a decomposition of the $d$-dimensional Euclidean space $\\mathbb{R}^d$ into non-overlapping subsets (or grains) $G_1, ..., G_{\\nu} \\subset \\mathbb{R}^d$, where for each $i \\in \\{1, ..., \\nu\\}$ it holds that\n\\[\nG_i = \\{x \\in \\mathbb{R}^d : |x - s_i|_{M_i} - r_i \\leq |x - s_j|_{M_j} - r_j \\text{ for all } j \\in \\{1, ..., \\nu\\} \\backslash \\{i\\}\\},\n\\]\ngiven $\\nu \\in \\mathbb{N}$ distinct seed points $s_1,..., s_{\\nu} \\subset \\mathbb{R}^d$ and markers $(M_1,r_1), ..., (M_{\\nu}, r_{\\nu})$. Here, $M_i \\in \\mathbb{R}^{d\\times d}$ is a positive definite matrix, $r_i \\in \\mathbb{R}$ is an offset parameter and $|x - s_i|_{M_i} = (x - s_i)^T M_i(x - s_i)$ is the metric induced by $M_i$. Later on, for $d\\in \\{2,3\\}$, each set $G_i$ will represent a single grain and consequently will be referred to as such.  show examples of such tessellations for the cases $d = 2$ and $d = 3$, respectively.\nThe tessellations used within the proposed grain architecture model are further restricted to GBPDs whose matrices $M_i$ can be written as $M_i = Q_iD_iQ_i^T$. Here, $Q_i$ is a basis change matrix to a given basis whose first basis vector is $s_i/|s_i|$ and $D_i$ is a diagonal matrix. This restriction reduces the marker dimensionality from 6+1 to 3+1 and allows deriving a non-stationary but radial symmetric model, the realizations of which resemble the grain architectures observed in the image data considered in Section 2.3. To derive such a radial symmetric model, the seed points $s_1,..., s_{\\nu}$, as well as the markers $(D_1, r_1), ..., (D_{\\nu}, r_{\\nu})$ of the tessellations are modeled stochastically. Thereby, the modeling of the seed points is done by a Poisson point process [39,40], i.e., a random point pattern, whereas the modeling of the markers is accomplished by a fully connected neural network as explained in Section 3.3 below. The neural network based approach allows for a stereological model fitting procedure. This is crucial since only 2D EBSD data are available to investigate the grain architecture of NMC811 particles.\nThe following section describes this stereological procedure in more detail.\n3.3. Stereological tessellation model calibration. The neural network used for marker generation is calibrated by means of a generative adversarial network (GAN) framework [43]. Note that GANs represent a game-theory inspired zero-sum game framework, where two key neural networks comprise the GAN framework: The generator G and the discriminator D. These neural networks compete with each other to achieve a so-called Nash equilibrium [59], i.e., the generator continually refines its ability to produce data resembling measured samples, while the discriminator iteratively enhances its capability to distinguish between measured and simulated data. Typically, this is realized by an image generating neural network $G: \\mathcal{N} \\rightarrow \\mathcal{I}$, i.e., a neural network that maps some noise space $\\mathcal{N}$ to some set of images $\\mathcal{I}$, and a discriminator $D: \\mathcal{I} \\rightarrow \\mathbb{R}$ that is trained to distinguish between measured and simulated images, see [34,43] for details. In the present paper, the discriminator tries to assign measured data a label of 1 and simulated ones a label of 0. Using the least squares loss [60], this results in the following min-max problem:\n\\[\n\\max_{G} \\min_{D} \\mathbb{E} [(D(X) - 1)^2] + \\mathbb{E} [(D(G(Z)))^2],\n\\]\nwhere $X \\in \\mathcal{I}$ is a random vector following the distribution of measured data, and $Z\\in \\mathcal{N}$ is some random vector which serves as input for the generator network G (where Z is sometimes chosen as white noise [60]). The terms $\\max$ and $\\min$ in Eq. (9) refer to the maximum and minimum taken over all possible parameter values of the neural\n\\quad\nnetworks G and D, respectively, given that their architectures are fixed. However, in the GAN approach proposed in the present paper, the output of the generator, i.e., a 3D tessellation-based grain architecture, can not directly be compared to measured data, i.e., pixel-based 2D image data, and, therefore, the loss function given by Eq. (9) has to be adapted [34]. Thus, we introduce two (random) functions, $\\mathcal{T}_{2D}$ and $\\mathcal{T}_{3D}$, which compute (random) discretized 2D cutouts of 2D images drawn from $X$, and 2D cutouts of simulated 3D tessellations drawn from $G(Z)$, respectively. This leads to the optimization problem\n\\[\n\\max_{G} \\min_{D} \\mathbb{E} [(D(\\mathcal{T}_{2D}(X))) - 1)^2] + \\mathbb{E} [(D(\\mathcal{T}_{3D}(G(Z))))^2] .\n\\]\nIn the following, the precise definitions of G, $\\mathcal{T}_{2D}$, $\\mathcal{T}_{3D}$, and D will be explained in more detail. To ensure an efficient GAN training, we assume the superimposed mapping $D(\\mathcal{T}_{3D}(G))$ to be differentiable almost everywhere with respect to the parameters of G. Since G and D are defined by neural networks and thus almost everywhere differentiable,"}, {"title": "", "content": "only $\\mathcal{T"}, {"mathcal{T}": "mathbb{R"}, 3, "rightarrow [0,1]^{\\nu}$ of a tessellation, see [41,61]. This means that the values of $\\mathcal{T}$ are given by\n\\[\n\\mathcal{T}(x) = \\begin{pmatrix} \\frac{\\exp(-|x-s_1|_{M_1} + r_1)}{\\sum_{i=1}^{\\nu} \\exp(-|x - s_i|_{M_i} + r_i)} \\\\ \\vdots \\\\ \\frac{\\exp(-|x-s_{\\nu}|_{M_{\\nu}} + r_{\\nu})}{\\sum_{i=1}^{\\nu} \\exp(-|x - s_i|_{M_i} + r_i)} \\end{pmatrix},\\quad \\text{ for each } x \\in \\mathbb{R}^3.\n\\]\nThe vector-valued mapping $\\mathcal{T} = (\\mathcal{T}_1 ...,\\mathcal{T}_{\\nu})$ directly implies a tessellation $G_1,...,G_{\\nu}$, as defined in Eq. (8), by considering the index i of the component $\\mathcal{T}_i(x)$ with maximal value, i.e., $G_i = \\{x \\in \\mathbb{R}^3: \\mathcal{T}_i(x) = \\max_j \\mathcal{T}_j(x)\\}$. Furthermore, note that the differentiable softmax representation $\\mathcal{T}$ given in Eq. (11) for 3D tessellations can be analogously defined for planar 2D tessellations.\nThe generation of the sequence $(s_1, n_1, \\gamma_1), ..., (s_{\\nu}, n_{\\nu}, \\gamma_{\\nu})$, i.e., the seed points $s_1,..., s_{\\nu}$ and corresponding noise $(n_1, \\gamma_1), ..., (n_{\\nu}, \\gamma_{\\nu})$ necessary for random marker creation, is done by drawing samples from a homogeneous Poisson point process with some intensity $\\mu > 0$, being restricted to the set $\\mathcal{W} = [-128, 128]^3 \\times [0, 1]^2 \\times [0, \\pi]$ [39,40]. However, the corresponding markers $(M_1,r_1), ..., (M_{\\nu}, r_{\\nu})$ are generated by a fully connected (FC) neural network, which is denoted as $G_{net}$. Since the grain shape and the size is only influenced by nearby grains, we assume that the marker of a seed point only depends on its neighboring seed points. More precisely, for the generation of the marker $(M_i, r_i)$ only information is considered derived from the $\\kappa = 12$ nearest seed points $s_{i_1},..., s_{i_{\\kappa}}, i_j \\in \\{1,...,\\nu\\} \\backslash \\{i\\}$ with respect to the Euclidean distance. Furthermore, to ensure a statistically radial symmetric output of the generator network $G_{net}$, its input is modified to get rid of anisotropic information, i.e., the direction of $s_i$. This is done by rotating the coordinate system in such a way that $s_i$ is always aligned in the direction of the unit vector $e_1 = (1,0,0)$. That is, for a given seed point $s_i$ we determine a rotation matrix $Q_i$ given by\n\\[\nQ_i = R_{e_1, \\gamma_i} R_{\\frac{s_i}{|s_i|}+e_1, \\pi},\n\\]\nwhere $R_{s,\\gamma}$ denotes the rotation matrix that describes a rotation around $s \\in \\mathbb{R}^3$ by an angle of $\\gamma \\in [0, \\pi]$, $\\delta_i = \\frac{s_i}{|s_i|}$ is the normalized version of $s_i$, and $\\gamma_```json\n{\n      \"title\":", ",\n      \"content\": ", "i$ is some angle determined by the Poisson point process. Finally, the vectors $v_{i_1},..., v_{i_{\\kappa}}$, which are used as input of $G_{net}$ for marker generation, are given by rotating the displacements $s_{i_j} - s_i$ by $Q_i$, i.e., $v_{i_j} = Q_i(s_{i_j} - s_i)$ for $j = 1,..., \\kappa$. Note that $Q_i$ is a basis change as described in Section 3.2.\nTo further allow the generator network $G_{net}$ to find a non-deterministic grain architecture for given seed points, and therefore being a suitable stochastic model, seed point specific noise $n_{i_j} \\in [0, 1]^2$ is added. Thus, the input of $G_{net}$ is given by $(v_{i_1}, n_{i_1},..., v_{i_{\\kappa}}, n_{i_{\\kappa}})$. shows the fully connected architecture of $G_{net}$. It uses ReLu activation functions $f(t) = \\max\\{0,t\\}, t \\in \\mathbb{R}$ in the hidden layers for neuron activations and utilizes scaled sigmoid functions $\\phi(t)_{a,b} = a + (b - a)/(1 + e^{-t}), t \\in \\mathbb{R}$ as activation functions in the output layers to ensure that the generated markers are in a reasonable range. This limits the elongation of the resulting grains, which makes them less likely to be disconnected (something that can occur for GBPDs), this helps to prevent unintended artifacts, and improves the generator-discriminator training. In particular, the values of $a, b \\in \\mathbb{R}$ of the channels within the output layer are chosen such that the value of $r_i$ and the diagonal entries of $D_i$ are restricted to $[1,10]$ and $[0,50]$, respectively."], "content": "To address the issue of unassigned pixels, a differentiable representation $\\mathcal{T}$ (see Eq. (11)) of the restricted GBPD with $d = 2$ is fitted to the EBSD data using the method described in [41]. This fitted 2D tessellation is referred to as \"ground truth data\". shows an exemplary fit. The approach of considering a 2D tessellation fit to the experimental EBSD data as ground truth data has at least three advantages. First, it provides a meaningful prescription for missing measurement information (inner white pixels in , left). Second, it ensures that the planar sections with which the generator attempts to imitate can indeed be generated, i.e., the ground truth data can be represented by GBPDs. Without assurance that the ground truth data can be represented by GBPDs, it is possible that the discriminator differentiates between measured and simulated data solely based on a difference of the representation, which would offer no insightful feedback to guide the generator's improvement. Third, it facilitates effective data augmentation during training, i.e., by modifying the seed points and markers of the fitted 2D tessellation slightly, similar but new 2D grain architectures can be generated as additional training data. Note that the distribution of the random variable $X$ considered in Eq. (10) describes the distribution of 2D training data, i.e., the data that arise from the ground truth data by this kind of augmentation.\n3.3.3. 2D representation of cutouts. Despite the fact that now both ground truth and simulated data are represented as differentiable tessellations, their dimensionalities are not yet consistent (being equal to 2 and 3, respectively). To overcome this problem and to generate input that is feasible for the discriminator D, i.e., a matrix of fixed size, randomly located (2D) pixel-based cutouts of these tessellations are computed.\nFor this purpose, a 32 \u00d7 32 grid of equidistant points is chosen, say $\\{1, ..., 32\\} \\times \\{1,...,32\\} \\subset \\mathbb{R}^2$. The tessellation $\\mathcal{T}$ of the restricted GBPD with $d = 2$ is then evaluated at these grid points, resulting in a matrix $I$ with $32 \\times 32 \\times \\nu$ entries. Such a matrix is often referred to as a multichannel 2D image, with dimensions representing the x-axis, y-axis, and channels, respectively. For each $(x, y, i) \\in \\{1, ...,32\\}^2 \\times \\{1, ..., \\nu\\}$, the entry $I_{x,y,i}$ of $I$ corresponds to the probability that the grid point $(x, y)$ belongs to grain $i$. To reduce the number of channels of $I$ to a (sufficiently small) fixed value, the set of channels is truncated to those channels which belong to grains being most present among the considered grid points. In the following, for the case of a 2D tessellation $\\mathcal{T}$, this procedure is described in more detail. First, the originally chosen 32 \u00d7 32 grid $\\{1, ..., 32\\}^2$ of equidistant points in $\\mathbb{R}^2$ is shifted and rotated at random, i.e., a (random) grid of equidistant points is determined by drawing a radial distance $\\rho$ and a polar angle $\\beta$ uniformly from the intervals $(0,80]$ and $[0, 2\\pi]$, respectively. Then, for each $(x, y) \\in \\{1, ..., 32\\}^2$, the corresponding grid point $(x', y')$ of the transformed grid is given by\n\\[\n\\begin{pmatrix}\nx' \\\\\ny' \\end{pmatrix} = R_{\\beta} \\begin{pmatrix} \\frac{x+\\rho}{\\frac{y}{16.5}} \\end{pmatrix} \\text{ where } R_{\\beta} = \\begin{pmatrix} \\cos \\beta & -\\sin \\beta \\\\ \\sin \\beta & \\cos \\beta \\end{pmatrix}.\n\\]\nEvaluating the tessellation $\\mathcal{T}$ at these points gives the (non-truncated) image $I = (I_{x,y,i})$, where the entry $I_{x,y,i}$ of the matrix $I$ at $(x, y, i) \\in \\{1, ..., 32\\}^2 \\times \\{1, ..., \\nu\\}$ is given by\n\\[\nI_{x,y,i} = \\mathcal{T}_i\\left(R_{\\beta} \\begin{pmatrix} \\frac{x+\\rho}{\\frac{y}{16.5}} \\end{pmatrix}\\right).\n\\]\nThe right-hand side of shows the three steps of this cutout computation procedure are illustrated, where two different coordinate systems are used, one for the original pixel positions $(x,y) \\in \\{1,..., 32\\}^2$ and one for the grid points $(x', y')$ introduced in Eq. (14). The procedure starts with a cutout, whose center lies on the x-axis, i.e., $\\rho = \\beta = 0$. Grains located in this cutout that are strongly orientated towards the center of the planar section (i.e., $\\alpha << \\frac{\\pi}{2}$, see Eq. (4)) are elongated in the direction of the x-axis. In a second step, the cutout is shifted in the direction of x-axis, according to the selected value of $\\rho$ (where $\\rho = 70$ in ). As before, grains within the cutout which have an orientation $\\alpha << \\frac{\\pi}{2}$ show elongations in the direction of the x-axis of the cutout. Finally, in a third step, the cutout is rotated by an angle of $\\beta\\in [0, 2\\pi]$. This does not only displace the cutout but also changes its orientation. Consequently, grains that are located in this cutout having an orientation of $\\alpha << \\frac{\\pi}{2}$, are orientated in the direction of the (new) x'-axis of the cutout. This procedure is performed to generate consistent cutouts which are feasible for the discriminator D and, simultaneously, to be able to use a wide range of cutout positions within the ground truth data for training.\nTo achieve a fixed (small) number of channels necessary for the discriminator input, the $\\nu$ channels of $I$ are sorted by the sum of their entries in descending order. Then, all but the first 12 channels are omitted, i.e, only the channels corresponding to the 12 most prominent grains regarding the grid points are retained, in order to retain the channels that contain the most information of grain morphologies. This (random) procedure will be denoted by $\\mathcal{T}_{2D}$ in the following."}, {"title": "3.3.4. Discriminator architecture.", "content": "The discriminator D, which is trained to decide whether a 32\u00d732\u00d712 cutout image originates from ground truth or artificially generated data, is structured as a convolutional neural network (CNN). Note that CNNs are a neural networks that can handle spatial dependencies in their input and are therefore especially useful in computer vision tasks such as image classification [62]. To avoid overfitting issues, the discriminator D considered in the present paper has a rather simple architecture. Namely, the discriminator consists of stacked convolutional layers, batch normalization layers, and ReLU activation functions. These components are responsible for feature extraction, learning acceleration, as well as neuron activation and deactivation. Additionally, max-pooling layers are used for dimension reduction, and dense layers are used to process the extracted features to a single output. shows a detailed representation of the network, and the number of features per layer.\n3.3.5. Training procedure and data augmentation. The GAN-based training process involves iteratively training the generator G and discriminator D through gradient-descent and a non-gradient-descent based optimization of the point process intensity \u00b5, as described in Eq. (13). The gradient-descent based training uses an Adam optimizer with a learning rate of 10\u22124 and gradient normalization [63]. The whole training procedure is done over 200 epochs with 100 steps per epoch and a batch size of 64 and 128 for generator and discriminator training, respectively. While training the discriminator the pixel values of its input images (see Eqs. (15) and (16)) are rounded to the closest value in \\{0,1\\} to suppress features that arise from the dimensions of the underlying artificially generated and ground truth tessellations, respectively. To address the issue of overfitting the discriminator, the update of the discriminator's weights is skipped during training, provided that its current mean squared error given by Eq. (10) is below 0.32. Furthermore, training data augmentation is achieved through marker modification, i.e., the diagonal entries of the matrices $D_i$ introduced in Section 3.2, and the additive marks $r_i$ of the fitted 2D tessellation are modified through uniform augmentations up to 20%, i.e., $\\frac{x-x'}{x} < 0.2$, where $x$ is equal to $r_i$ or a diagonal entry of $D_i$, and $x'$ is its augmented version. This augmentation of training data results in more diverse grain architectures that still adhere to the constraints of the restricted GBPD representation, see . However, this is contrary to augmentations achievable through conventional techniques of image data processing [64]. and Algorithm 2 provide an overview of the training procedure described above, where the pseudocode is presented in such a way as to improve readability and should not be considered computationally efficient. For a more efficient implementation, the seed"}, {"title": "3.4. Multi-scale model.", "content": "Combining the outer shell model and the grain architecture model follows the approach presented in [30]. More specifically, to get a simulated NMC811 particle, an outer shell and a grain architecture are independently drawn from the models introduced in Sections 3.1 and 3.2, respectively, and overlaid on a 3D domain. Next, grains whose centers of mass are not located inside the outer shell are removed.  illustrates this procedure and shows 3D renderings of samples drawn from the outer shell model and the grain architecture model, as well as their combination to a virtual NMC811 particle."}, {"title": "4. RESULTS AND DISCUSSION", "content": "In this section, the simulated NMC811 particles are evaluated quantitatively, where various structural descriptors, characterizing particle and grain morphology, are computed for ground truth and simulated data and, afterwards, compared to each other. Importantly, the structural descriptors considered in this section have not been used for model calibration.\n4.1. Validation of the outer-shell model. To evaluate the outer-shell model introduced in Section 3.1, four different descriptors are chosen to characterize the 3D morphology of ground truth and simulated microstructures, respectively. These descriptors include the diameter $d_{max}$, the compactness $\\gamma$, the aspect ratio $A_R$, and the sphericity $\\Psi$ of particles [65]. More precisely, for a particle represented by its radius function $P: S^2 \\rightarrow \\mathbb{R}_+$, the values of these descriptors are given by\n\\[\nd_{max}(P) = \\max\\{P(u) + P(-u): u \\in S^2\\},\n\\]\n\\[\n\\gamma(P) = \\frac{V(P)}{V(\\text{@Conv}(P))},\n\\]\n\\[\nA_R(P) = \\frac{d_{max}(P)}{d_{min}(P)}, \\text{ where } d_{min}(P) = \\min\\{P(u) + P(-u): u \\in S^2\\},\n\\]\n\\[\n\\Psi(P) = \\frac{\\pi^{\\frac{1}{3}} (6V(P))^{\\frac{2}{3}}}{A(P)},\n\\]\nwhere $A(.)$ is the surface area, $V(.)$ the enclosed volume, and $\\text{@Conv}(.)$ the boundary of the convex hull. Note that the compactness $\\gamma$ measures the degree of convexity of a particle, whereas the aspect ratio $A_R$ describes the particle's elongation, and the sphericity $\\Psi$ measures the roundness of a particle, i.e., its similarity to a sphere. (top row) shows histograms of these descriptors for both ground truth and simulated particles.\nIn the outer-shell analysis, simulated particles having a volume of less than 10 voxels, i.e., less than $10 \\cdot (0.128 \\mu m)^3$, are neglected. These volumes are omitted for further analysis, since the segmentation procedure described in Section 2.2.1 generates only particles with larger sizes. The histograms of the descriptors $d_{max}, \\gamma, A_R$, and $\\Psi$ of the resulting particles show nice agreement with correspnding histograms computed from nano-CT data,. It is noteworthy that the model does not produce particles with extremely low sphericities, as observed in the seg- mentation process (see the values for $\\Psi \\leq 0.6$ in ). Further investigations are required to check whether these particles can be attributed to an imperfect segmentation, and consequently, whether their absence in model realizations is important.\nRecall that the relatively small edcc values displayed in provided the basis for assuming that the model's random spherical harmonics coefficients are independent of each other. However, an increasing trend of the edcc along with the order of the basis functions can be observed. It is assumed that this trend can partially be attributed to missing fine structures in particles with a small diameter due to the discrete voxel-based resolution. Additionally, the small expected values of $Z_{\\ell m}$ for $\\ell > 4$ suggest that these coefficients can be neglected, without decreasing the model quality significantly. A systematic investigation of the influence of the maximum spherical harmonics order L on the model quality will be the subject of future work.\n4.2. Validation of the grain architecture model. The model introduced in Section 3.2 for the inner 3D grain architecture of NMC811 particles is based solely on 2D EBSD data. Since only 2D planar section data of ground truth grain architectures is available, the validation of simulated grain architectures is done by a statistical comparison of pixel-based planar sections. For this comparison, the distributions of four microstructure descriptors are evaluated: the distribution of the size $A_{cross}$ of planar grain sections, the distributions of their elongation $\\eta$ and their orientation $\\alpha$, and the chord-length distribution [66] of the ensemble of planar grain sections. Note that the size $A_{cross}$ of a planar grain section is given by the number of pixels occupied by the given grain section. The orientation $\\alpha$ is defined in Eq.(4), and the elongation $\\eta$ is given by\n\\[\n\\eta = \\frac{e_1}{e_2},\n\\]\nwhere $e_1 \\geq e_2 > 0$ are the eigenvalues of the principal components of the planar section of the given grain, see Section 2.3. The chord-length distribution is given by the distribution of the lengths c of all chords of the planar section, where a chord of a pixel-based planar section of grains is a sequence of consecutive aligned pixels that belong to the same grain and that can not be extended further without containing pixels belonging to other grains.  shows histograms of these descriptors for both ground truth and simulated data, which are are quite similar to each other. However, the elongation $\\eta$ shows slightly larger values for simulated data, which means that the grains observed in the planar sections of the stereologically fitted model are slightly more elongated than those in the ground truth data. A similar behavior can be observed for the grain orientation $\\alpha$, where simulated grain architectures show a slightly more preferred orientation as compared to the ground truth. Nevertheless, the histograms computed from ground truth and simulated data, respectively, show nice agreement, which indicates that"}, {"title": "4.3. Discussion of model assumptions.", "content": "The trained grain architecture model, which was fitted and evaluated by means of planar 2D sections, can be used to generate realistic 3D grain architectures of NMC811 particles and to investigate structural properties of these 3D morphologies. For example,  shows how the distribution of grain orientations observed in planar sections depends on the section's position (i.e., its cut height). It can be observed that the grains that are visible in planar sections near the origin exhibit an increasingly preferred orientation, in contrast to more distant planar sections, which show an almost uniform distribution of grain orientations. This observation coincides with the assumption stated in Section 2.3 that some planar sections observed in EBSD data may not pass through the particle center and therefore were neglected for training purposes. However, the GAN-based training of the grain architecture model could be adapted such that planar sections that are taken farther away from the particle center can also be used. Nevertheless, such modifications would necessitate providing the discriminator with additional information about the observed data. Such additional information could include the distance of the planar section to the particle center. This adjustment would enable the discriminator to evaluate the plausibility of observed grain elongations or preferred orientations based on the position of the planar section within the particle. However, this type of information, i.e., the relative location of the planar section with respect to the particle center, would have to be acquired by laboratory measurements.\nIn the proposed multi-scale model, we assumed that the inner grain architecture can be modeled independently of the outer shell. While this may be true for large particles, it will not be true for particles with very small radii, i.e., particles that consist only of hundreds of grains. To investigate this issue further and, consequently, adapt the modeling approach, EBSD data of differently sized particles has to be acquired. Importantly, these rather small particles account for a small mass percentage of an electrode and, thus, their inclusion/exclusion is not expected to significantly influence predicted electrode performance."}, {"title": "5. CONCLUSION", "content": "The multi-scale modeling approach described here enables realistic 3D particle geometries with sub-particle grain detail. The 3D sub-particle grain morphologies were generated by only using 2D EBSD data, facilitating character- ization of 3D grain morphological properties from 2D experimental information. Representative particle generation capabilities are not only required for characterizing otherwise challenging 3D morphological properties but are also required for high-fidelity cathode degradation models that require significant test geometries to mitigate stochastic effects resulting from particle geometry variations. Notably, it is significantly easier and faster to simulate chemo- mechanics on hundreds of generated geometries, as compared to relying solely on a sparse set of empirical image data. A bulk of such simulated NMC811 particles with inner grain architectures, suitable for numerical simulations, is made publicly available. Previous cathode degradation modeling efforts focused mostly on NMC532 particles with randomly distributed grains, which was primarily due to the availability of full 3D imagery [3]. Now, with the capability of inferring 3D geometries of grain architectures with curved grain boundaries from only 2D EBSD slices, it is possible to model NMC811 degradation and consider radially oriented grain geometries, which will be the focus of future work. Additionally, the proposed method can enable quicker development of generation methods for new and emerging electrode chemistries.\nIn the future, there are plans to expand the model not only to capture the geometry of the grains but also to describe their crystallographic orientation. Additionally, there are intentions to adjust the fitting for the outer shell model such that calibration can be performed from 2D image data to achieve a fully stereological multi-scale model."}]