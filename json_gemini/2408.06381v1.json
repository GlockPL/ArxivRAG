{"title": "Assessment of Cell Nuclei AI Foundation Models in Kidney Pathology", "authors": ["Junlin Guo", "Siqi Lu", "Can Cui", "Ruining Deng", "Tianyuan Yao", "Zhewen Tao", "Yizhe Lin", "Marilyn Lionts", "Quan Liu", "Juming Xiong", "Catie Chang", "Mitchell Wilkes", "Mengmeng Yin", "Haichun Yang", "Yuankai Huo"], "abstract": "Cell nuclei instance segmentation is a crucial task in digital kidney pathology. Traditional automatic segmentation methods often lack generalizability when applied to unseen datasets. Recently, the success of foundation models (FMs) has provided a more generalizable solution, potentially enabling the segmentation of any cell type. In this study, we perform a large-scale evaluation of three widely used state-of-the-art (SOTA) cell nuclei foundation models-Cellpose, StarDist, and CellViT. Specifically, we created a highly diverse evaluation dataset consisting of 2,542 kidney whole slide images (WSIs) collected from both human and rodent sources, encompassing various tissue types, sizes, and staining methods. To our knowledge, this is the largest-scale evaluation of its kind to date. Our quantitative analysis of the prediction distribution reveals a persistent performance gap in kidney pathology. Among the evaluated models, CellViT demonstrated superior performance in segmenting nuclei in kidney pathology. However, none of the foundation models are perfect; a performance gap remains in general nuclei segmentation for kidney pathology.\nKeywords: Foundation model Kidney Pathology Instance Segmentation Nuclei Model Agreement Ensemble learning.", "sections": [{"title": "INTRODUCTION", "content": "Among the various tasks in digital pathology, cell nuclei instance segmentation is crucial as it is often the first step for extracting biological signals for accurate disease diagnosis and treatment planning [3, 5, 7, 10, 12, 13]. However, a limitation in current methodologies is the generalizability of models in handling the growing scale and diversity of data. This challenge underscores the need for cell nuclei foundation models capable of segmenting nuclei from diverse organs and large-scale datasets [8,11,14,15]. Thus, we pose the question: how do current cell nuclei foundation models perform for comprehensive nuclei segmentation in kidney pathology?"}, {"title": "Methods", "content": "Fig. 1 illustrates the overall framework of this study: (1) Large-scale diverse dataset creation, (2) Nuclei instance segmentation, (3) Rating on Segmentation Performance. Meaningful image patches were then identified through model agreement analysis."}, {"title": "Diverse Large-scale dataset", "content": "Our dataset incorporates both public and private kidney datasets, totaling 2,542 WSIs.\nAccording to Fig. 1b, 57% (1,449 WSIs) are sourced from publicly available datasets such as Kidney Tissue Atlas (KPMP) [1], NEPTUNE [2], and HUBMAP [9], while 43% (1,093 WSIs) are from an in-house collection at Vanderbilt University Medical Center. To enhance dataset diversity, we included WSIs from both human and rodent sources. As shown in Fig. 1c, the WSIs were stained using Hematoxylin and Eosin (H&E), Periodic acid-Schiff methenamine (PASM), and Periodic acid-Schiff (PAS),"}, {"title": "Nuclei instance segmentation", "content": "Nuclei instance segmentation was performed on these kidney nuclei image patches using three foundation models: Cellpose [14], StarDist [15], and CellViT [8]. We summarized the three foundation models and provided GitHub links to our customized GPU-optimized inference pipelines in Table. 1:\n1. Cellpose: Cellpose [14] is a generalist segmentation model that utilizes a U-Net backbone to predict the horizontal and vertical gradients of the topological maps, as well as a binary map. Through a gradient tracking algorithm and grouping pixels that follows the same point (center), individual object can be retrieved.\n2. StarDist: StarDist [15] uses a unique star-convex polygon representation for nuclei segmentation, which is particularly effective for roundish objects such as cell nuclei. A simple U-Net architecture is employed for dense prediction of radial distances and object probabilities, with non-maximum suppression used to select final instances."}, {"title": "Rating on Segmentation Performance", "content": "Two pathologist-trained students scored the model predictions as \u201cgood,\u201d \u201cmedium,\" or \"bad\" based on a standard provided by a renal pathologist. \"good\" predictions correctly capture about 90% of nuclei in an image patch, \"bad\" predictions capture less than 50%, and the rest are categorized as \"medium.\" We apply this scoring system to quantitatively assess each model's predictions in our dataset. Finally, we ensemble ratings from three foundation models to curate strongly agreed-upon failure samples. These image patches can be used for training or fine-tuning future foundation models in kidney pathology."}, {"title": "Experiments", "content": "Implementations: The model inference pipeline was implemented using Python 3.9\nand PyTorch 2.0.1, with GPU acceleration provided by CUDA 11.7. The experiments,\nconducted on an NVIDIA RTX A5000 GPU with 24GB memory, ensured efficient\ntest-time inference. GPU-optimized inference codebases, are provided in the links in\nTable. 1."}, {"title": "Distribution of foundation model predictions", "content": "We analyzed the distribution of predictions for each foundation model across our evaluation dataset. This analysis provides insights into the performance and behavior of each model by examining the frequency of different prediction classes (\"good\", \"medium\", \"bad\") within each foundation model. The prediction class assignments were determined through the manual rating-based curation."}, {"title": "Agreement analysis between foundation models", "content": "To further assess cross-model performance on our kidney nuclei dataset, we conducted\nan agreement analysis between the models. This analysis involved the following steps:\n1. Agreement Matrix. We calculated the agreement percentages between each pair\nof models to understand how often they make the same predictions. This matrix\nhelps identify the consistency between foundation models.\n2. Class-Specific Agreement. Image patches are categorized into three types: All\nThree Models Agree, which represents the number of patches where all models\nagree on the prediction class; Two Models Agree, indicating patches where any\ntwo models agree on the prediction class; and No Agreement, where none of the\nmodels agree on the prediction class."}, {"title": "Consensus \"bad\" image patches mining", "content": "By ensemble curated labels from three cell nuclei foundation models across our kidney dataset, we can identify strong-agreed-upon failure samples, which occur when all three models produce \"bad\" instance segmentation results. These \"global failure\" image patches, where all three models agree on poor performance, highlight the gap areas where the current cell nuclei foundation models need improvement in kidney pathology."}, {"title": "Results", "content": "From Fig. 2, we can observe the distribution of predictions for each model. For all three foundation models, at least 40% of predictions are categorized as \"bad\" or\n\"medium.\" at least 40% of predictions are \"good\". This indicates that, despite not being specifically trained on kidney pathology nuclei data, the models retain some transferable knowledge applicable to our task. However, the 40% gap underscores the need for a specialized foundation model for kidney pathology. Cellpose and StarDist have similar amount of \"good\" predictions, while CellViT shows a notably higher number of \"good\" predictions of 5,609, which suggests its potentially superior performance and adaptability in kidney pathology."}, {"title": "Conclusion", "content": "This study provides a comprehensive assessment of cell nuclei foundation models (Cell-pose, StarDist, CellViT) in kidney pathology, focusing on nuclei instance segmentation. By evaluating a large and diverse kidney nuclei dataset, we identified CellViT as having superior performance. However, a performance gap remains between general and kidney-specific nuclei segmentation. Additionally, we utilized all three foundation models to curate consensus \u201cgood\u201d and \u201cfailure\" image patches, summarizing their characteristics to offer insights for improving cell nuclei foundation models in kidney pathology."}]}