{"title": "Assessment of Cell Nuclei AI Foundation Models in Kidney Pathology", "authors": ["Junlin Guo", "Siqi Lu", "Can Cui", "Ruining Deng", "Tianyuan Yao", "Zhewen Tao", "Yizhe Lin", "Marilyn Lionts", "Quan Liu", "Juming Xiong", "Catie Chang", "Mitchell Wilkes", "Mengmeng Yin", "Haichun Yang", "Yuankai Huo"], "abstract": "Cell nuclei instance segmentation is a crucial task in digital kidney\npathology. Traditional automatic segmentation methods often lack generalizabil-\nity when applied to unseen datasets. Recently, the success of foundation mod-\nels (FMs) has provided a more generalizable solution, potentially enabling the\nsegmentation of any cell type. In this study, we perform a large-scale evalua-\ntion of three widely used state-of-the-art (SOTA) cell nuclei foundation mod-\nels-Cellpose, StarDist, and CellViT. Specifically, we created a highly diverse\nevaluation dataset consisting of 2,542 kidney whole slide images (WSIs) col-\nlected from both human and rodent sources, encompassing various tissue types,\nsizes, and staining methods. To our knowledge, this is the largest-scale evaluation\nof its kind to date. Our quantitative analysis of the prediction distribution reveals\na persistent performance gap in kidney pathology. Among the evaluated mod-\nels, CellViT demonstrated superior performance in segmenting nuclei in kidney\npathology. However, none of the foundation models are perfect; a performance\ngap remains in general nuclei segmentation for kidney pathology.", "sections": [{"title": "1 INTRODUCTION", "content": "Among the various tasks in digital pathology, cell nuclei instance segmentation is cru-cial as it is often the first step for extracting biological signals for accurate disease\ndiagnosis and treatment planning [3, 5, 7, 10, 12, 13]. However, a limitation in current\nmethodologies is the generalizability of models in handling the growing scale and di-\nversity of data. This challenge underscores the need for cell nuclei foundation models\ncapable of segmenting nuclei from diverse organs and large-scale datasets [8,11,14,15].\nThus, we pose the question: how do current cell nuclei foundation models perform for\ncomprehensive nuclei segmentation in kidney pathology?"}, {"title": "2 Methods", "content": "Fig. 1 illustrates the overall framework of this study: (1) Large-scale diverse dataset\ncreation, (2) Nuclei instance segmentation, (3) Rating on Segmentation Performance.\nMeaningful image patches were then identified through model agreement analysis."}, {"title": "2.1 Diverse Large-scale dataset", "content": "Our dataset incorporates both public and private kidney datasets, totaling 2,542 WSIs.\nAccording to Fig. 1b, 57% (1,449 WSIs) are sourced from publicly available datasets\nsuch as Kidney Tissue Atlas (KPMP) [1], NEPTUNE [2], and HUBMAP [9], while\n43% (1,093 WSIs) are from an in-house collection at Vanderbilt University Medical\nCenter. To enhance dataset diversity, we included WSIs from both human and rodent\nsources. As shown in Fig. 1c, the WSIs were stained using Hematoxylin and Eosin\n(H&E), Periodic acid-Schiff methenamine (PASM), and Periodic acid-Schiff (PAS),"}, {"title": "2.2 Nuclei instance segmentation", "content": "Nuclei instance segmentation was performed on these kidney nuclei image patches us-\ning three foundation models: Cellpose [14], StarDist [15], and CellViT [8]. We summa-\nrized the three foundation models and provided GitHub links to our customized GPU-\noptimized inference pipelines in Table. 1:\n1. Cellpose: Cellpose [14] is a generalist segmentation model that utilizes a U-Net\nbackbone to predict the horizontal and vertical gradients of the topological maps,\nas well as a binary map. Through a gradient tracking algorithm and grouping pixels\nthat follows the same point (center), individual object can be retrieved.\n2. StarDist: StarDist [15] uses a unique star-convex polygon representation for nu-\nclei segmentation, which is particularly effective for roundish objects such as cell\nnuclei. A simple U-Net architecture is employed for dense prediction of radial dis-\ntances and object probabilities, with non-maximum suppression used to select final\ninstances.\n3. CellViT: CellViT [8] employs a hierarchical encoder-decoder Vision Transformer\n(ViT) backbone. The encoder utilizes pre-trained weights from a ViT trained on\n104 million histological images (ViT256) [4], addressing the data scarcity challenge\noften faced in medical imaging. The post-processing procedure follows the HoVer-\nNet methodology [6]."}, {"title": "2.3 Rating on Segmentation Performance", "content": "Two pathologist-trained students scored the model predictions as \u201cgood,\u201d \u201cmedium,\" or\n\"bad\" based on a standard provided by a renal pathologist. \"good\" predictions correctly\ncapture about 90% of nuclei in an image patch, \"bad\" predictions capture less than 50%,\nand the rest are categorized as \"medium.\" We apply this scoring system to quantitatively\nassess each model's predictions in our dataset. Finally, we ensemble ratings from three\nfoundation models to curate strongly agreed-upon failure samples. These image patches\ncan be used for training or fine-tuning future foundation models in kidney pathology."}, {"title": "3 Experiments", "content": "Implementations: The model inference pipeline was implemented using Python 3.9\nand PyTorch 2.0.1, with GPU acceleration provided by CUDA 11.7. The experiments,\nconducted on an NVIDIA RTX A5000 GPU with 24GB memory, ensured efficient\ntest-time inference. GPU-optimized inference codebases, are provided in the links in\nTable. 1."}, {"title": "3.1 Distribution of foundation model predictions", "content": "We analyzed the distribution of predictions for each foundation model across our evalu-\nation dataset. This analysis provides insights into the performance and behavior of each\nmodel by examining the frequency of different prediction classes (\"good", "medium": "n", "bad": "within each foundation model. The prediction class assignments were deter-\nmined through the manual rating-based curation."}, {"title": "3.2 Agreement analysis between foundation models", "content": "To further assess cross-model performance on our kidney nuclei dataset, we conducted\nan agreement analysis between the models. This analysis involved the following steps:\n1. Agreement Matrix. We calculated the agreement percentages between each pair\nof models to understand how often they make the same predictions. This matrix\nhelps identify the consistency between foundation models.\n2. Class-Specific Agreement. Image patches are categorized into three types: All\nThree Models Agree, which represents the number of patches where all models\nagree on the prediction class; Two Models Agree, indicating patches where any\ntwo models agree on the prediction class; and No Agreement, where none of the\nmodels agree on the prediction class."}, {"title": "3.3 Consensus \"bad\" image patches mining", "content": "By ensemble curated labels from three cell nuclei foundation models across our kid-\nney dataset, we can identify strong-agreed-upon failure samples, which occur when all\nthree models produce \"bad\" instance segmentation results. These \"global failure\" im-\nage patches, where all three models agree on poor performance, highlight the gap areas\nwhere the current cell nuclei foundation models need improvement in kidney pathology."}, {"title": "4 Results", "content": "From Fig. 2, we can observe the distribution of predictions for each model. For\nall three foundation models, at least 40% of predictions are categorized as \"bad\" or\n\"medium.\" at least 40% of predictions are \"good\". This indicates that, despite not being\nspecifically trained on kidney pathology nuclei data, the models retain some transfer-\nable knowledge applicable to our task. However, the 40% gap underscores the need for\na specialized foundation model for kidney pathology. Cellpose and StarDist have sim-\nilar amount of \"good\" predictions, while CellViT shows a notably higher number of\n\"good\" predictions of 5,609, which suggests its potentially superior performance and\nadaptability in kidney pathology.\nFig. 3a illustrates the consistency between model predictions. As shown, no pair\nexhibits over 90% agreement or complete disagreement. The highest agreement is ob-\nserved between Cellpose and StarDist (0.76), while the lowest is between Cellpose and\nCellViT (0.67). These non-extreme values, with a maximum of 0.76 and a minimum of\n0.67, indicate that the current SOTA nuclei foundation models in digital pathology do\nnot generalize exceptionally well to diverse large-scale kidney data. Each model has its\nown strengths, and this inconsistency inspires us to combine multiple SOTA foundation\nmodels to enhance performance in downstream kidney nuclei tasks.\nBoth Fig. 3b and Table. 2 show the number of image patches where all three mod-\nels agree, two models agree, or no models agree for each prediction class (\"good", "n": "edium", "bad": "."}, {"bad": "ases exhibit the highest inter-\nmodel reliability, with over 70% agreement among all three models. Particularly, sam-\nples where all three foundation models agree in both the", "good": "Consensus"}, {"good": "nand", "bad": "Consensus", "failure": "amples exhibit overall lower staining intensity, lighter\nnuclei, and reduced imaging contrast. From the failure categories in Fig. 3, it is evident\nthat certain types of nuclei and tissue conditions diminish the segmentation performance\nof foundation models. Specifically, long and flat nuclei, nuclei with blurred boundaries,\nand densely distributed nuclei within glomeruli are particularly difficult to segment ac-\ncurately. Additionally, slides that are too thin, contain fatty tissues, or have an excessive\nnumber of red blood cells can lead to a higher incidence of false positive predictions."}, {"title": "5 Conclusion", "content": "This study provides a comprehensive assessment of cell nuclei foundation models (Cell-\npose, StarDist, CellViT) in kidney pathology, focusing on nuclei instance segmenta-\ntion. By evaluating a large and diverse kidney nuclei dataset, we identified CellViT as\nhaving superior performance. However, a performance gap remains between general\nand kidney-specific nuclei segmentation. Additionally, we utilized all three foundation\nmodels to curate consensus \u201cgood\u201d and \u201cfailure\" image patches, summarizing their\ncharacteristics to offer insights for improving cell nuclei foundation models in kidney\npathology."}]}