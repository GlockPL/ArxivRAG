{"title": "Predicting Molecular Ground-State Conformation via Conformation Optimization", "authors": ["Fanmeng Wang", "Minjie Cheng", "Hongteng Xu"], "abstract": "Predicting ground-state conformation from the corresponding molecular graph is crucial for many chemical applications, such as molecular modeling, molecular docking, and molecular property prediction. Recently, many learning-based methods have been proposed to replace time-consuming simulations for this task. However, these methods are often inefficient and sub-optimal as they merely rely on molecular graph information to make predictions from scratch. In this work, considering that molecular low-quality conformations are readily available, we propose a novel framework called ConfOpt to predict molecular ground-state conformation from the perspective of conformation optimization. Specifically, ConfOpt takes the molecular graph and corresponding low-quality 3D conformation as inputs, and then derives the ground-state conformation by iteratively optimizing the low-quality conformation under the guidance of the molecular graph. During training, ConfOpt concurrently optimizes the predicted atomic 3D coordinates and the corresponding interatomic distances, resulting in a strong predictive model. Extensive experiments demonstrate that ConfOpt significantly outperforms existing methods, thus providing a new paradigm for efficiently and accurately predicting molecular ground-state conformation.", "sections": [{"title": "Introduction", "content": "In the past few years, given that molecular interactions are fundamentally three-dimensional [1, 2], molecular modeling has progressed from simple 1D sequences [3, 4] and 2D graphs [5, 6] to crucial 3D structures [7, 8]. While significant progress has been made in various downstream applications like molecular docking [9] and molecular property prediction [10] through incorporating 3D structural information, it has also created a huge demand for scarce high-quality 3D molecular structure data. In this context, molecular ground-state conformation, which represents the most stable 3D molecular structure with the lowest energy and determines many molecular properties [11], becomes increasingly important.\nDespite the crucial role that molecular ground-state conformation plays in various downstream applications, obtaining it remains a challenging task [12]. Traditionally, molecular ground-state conformation can be obtained through various experimental or simulation methods. For example, some methods involve molecular dynamics (MD) simulations [13] or density functional theory (DFT) calculations [14] to obtain molecular ground-state conformation. However, these methods like CREST [15] are expensive and computationally slow, thus restricting their ability to meet the growing demands [16]. While some cheminformatics-based prediction methods like RDKit ETKDG [17] have been developed to improve efficiency, they suffer from accuracy shortcomings, which still makes them unsuitable for this task [18]. Given the importance of molecular ground-state conformation and the enormous prediction demands, an ideal method should be able to make both efficient and accurate predictions."}, {"title": "Related work", "content": ""}, {"title": "Molecular Conformation Generation", "content": "Molecular conformation generation (MCG) is closely related to molecular ground-state conformation prediction and numerous methods have been proposed in recent years. Specifically, CVGAE [25] is initially introduced to address this task using variational autoencoders [26]. Then CGCF [27] and ConfGF [28] are further proposed to enhance the performance through normalizing flows [29] and score-based generative models [30], respectively. Meanwhile, some works like GeoDiff [31] and TorDiff [32] have leveraged popular diffusion models [33] for generating molecular conformations, showing promising outcomes. However, all these methods are essentially designed for obtaining multiple potential low-energy conformations rather than directly obtaining the lowest-energy ground-state conformation [22], necessitating additional screening steps to identify the lowest-energy conformation among the generated conformations when used in the molecular ground-state conformation prediction task. Besides, due to the uncertainty of the sampling process, there is no guarantee of sampling the ground-state conformation, further restricting their practical application in the molecular ground-state conformation prediction task [11]. Therefore, subsequent efforts have shifted to develop specialized predictive models to determine molecular ground-state conformation directly."}, {"title": "Molecular Representation Learning", "content": "As the crucial link between large-scale unlabeled molecules and small-scale labeled molecules, molecular representation learning (MRL) has garnered increasing attention in recent years. Initially, inspired by the significant achievements in the area of natural language processing, early works such as SMILES-BERT [3] and Chemberta [4] treat molecules as 1D sequences (e.g., SMILES) and undergo pretraining akin to language models. Then, considering the limited representation capacity of molecular sequences and the rapid development of geometric deep learning [34, 35], molecular representation learning methods based on molecular graphs have become popular. For example, MolCLR [5] involves pretraining on around 10 million molecular graphs through the contrastive learning strategy, leading to notable enhancements in the downstream task. Recently, considering the close correlation between molecular properties and corresponding 3D molecular structure, more and more works are incorporating 3D structural information into pretraining [1, 2]. Specifically, several 3D molecular representation learning methods like Uni-Mol [36] and 3D-PGT [7] have been proposed and shown great capacity in various downstream tasks. With the transition of molecular representation learning to 3D, the demand for scarce high-quality 3D molecular structure data has increased dramatically, thus making it increasingly important to design efficient and accurate molecular ground-state conformation prediction methods."}, {"title": "Method", "content": ""}, {"title": "Preliminary", "content": ""}, {"title": "Notation.", "content": "Each molecular graph with n atoms can be denoted as $G = (V, E)$, where $V = \\{v_i\\}_{i=1}^n$ is the set of vertices representing atoms and $E = \\{e_{ij}\\}_{i,j=1}^n$ is the set of edges representing interatomic bonds. Besides, each node $v_i \\in V$ describes the corresponding atomic features (e.g., atomic type, atomic charge, and hybridization state) of i-th atom, while each edge $e_{ij} \\in E$ describes the corresponding bond type (e.g., single, double, triple, aromatic and unconnected) between i-th atom and j-th atom. Moreover, the corresponding ground-state conformation can be denoted as $C = (A,P)$, where $A = [a_i] \\in \\mathbb{R}^n$ represents atomic types and $P = [p_i] \\in \\mathbb{R}^{n\\times3}$ represents atomic 3D coordinates. In addition, based on the atomic 3D coordinates P, the corresponding interatomic distances can be denoted as $D = \\{d_{ij}\\}_{i,j=1}^n \\in \\mathbb{R}^{n\\times n}$, where $d_{ij} = ||P_i - P_j ||_2$ represents the corresponding Euclidean distance between i-th atom and j-th atom in the 3D space."}, {"title": "Problem Definition.", "content": "The molecular ground-state conformation prediction task aims to predict the corresponding ground-state conformation $C = (A,P)$ from the molecular graph $G = (V,E)$. Specifically, considering the atomic type A is aligned with the vertice set V, the molecular ground-state conformation prediction task can be further expressed to predict the corresponding atomic 3D coordinates in the ground state from the molecular graph, i.e.,\n$\\mathbb{P} = M_{\\theta}(G) = M_{\\theta}(V, E)$,\nwhere $\\mathbb{P} = [p_i] \\in \\mathbb{R}^{n\\times3}$ is the predicted atomic 3D coordinates in the ground state and $M_{\\theta}$ is a ground-state conformation predictive model."}, {"title": "Overview of ConfOpt.", "content": "In this work, considering that molecular low-quality conformations are readily available, we propose a novel framework, called ConfOpt, to predict molecular ground-state conformation from the perspective of conformation optimization. As shown in Figure 2, different from previous works that only rely on information learned from the molecular graph to predict the corresponding ground-state conformation from scratch, our proposed ConfOpt also leverages the corresponding low-quality conformation $C$ generated by RDKit ETKDG [17] as input to provide the initial conformation information. Then under the guidance of the molecular graph $G$, ConfOpt iteratively optimizes the corresponding low-quality conformation $C$ to derive the predicted ground-state conformation $C$, thus effectively simplifying the original molecular ground-state conformation prediction task and boosting predictive performance (see Sec. 3.2 for details). Besides, considering the limitations of previous works that only optimize interatomic distances $D$ acquired from the predicted atomic 3D coordinates $\\mathbb{P}$ in the training phase, we further propose a multi-task learning paradigm that optimizes both predicted atomic 3D coordinates $\\mathbb{P}$ and the corresponding interatomic distances $D$ to effectively capture intricate 3D molecular structures, thus enhancing predictive performance in various scenarios. (see Sec. 3.3 for details)."}, {"title": "Model Architecture", "content": ""}, {"title": "Inputs.", "content": "As shown in Figure. 2, except for the molecular graph, our proposed ConfOpt also uses the corresponding low-quality conformation $C$ generated by RDKit ETKDG [17] as input to provide the initial conformation information, thus effectively simplifying the original molecular ground-state conformation prediction task and boosting predictive performance. Then, we further extract the initial atom-level representation $X_a^{(0,0)}$"}, {"title": "Backbone.", "content": "After extracting the initial atom-level representation $X_a^{(0,0)}$ and pair-level representations $X_p^{(0,0)}$, we use the backbone module $\\phi_{\\theta}$, which is composed of L SE(3)-Transformer encoder layers [23], to iteratively optimize the low-quality conformation information under the guidance of the information learned from the molecular graph, thus deriving the final atom-level representation $X_a^{(K,L)}$ and pair-level representation $X_p^{(K,L)}$, i.e.,\n$X_a^{(K,L)}, X_p^{(K,L)} = \\phi_{\\theta}(X_a^{(0,0)}, X_p^{(0,0)})$, \nwhere K is the number of iterations. During the i-th iteration, our backbone module $\\phi_{\\theta}$ takes the representation $X_a^{(i,0)}$ and $X_p^{(i,0)}$ as inputs and process them through L SE(3)-Transformer encoder layers to obtain the output representations $X_a^{(i,L)}$ and $X_p^{(i,L)}$, which are also used as the inputs of the next iteration.\nTo effectively capture intricate 3D structure information and optimize the low-quality conformation, the atom-to-pair communication [36] is utilized in the SE(3)-Transformer encoder layer to improve the traditional self-attention mechanism. As shown in Figure. 2, the specific implementation of the h-th attention head in the l-th SE(3)-Transformer encoder layer during the k-th iteration can be expressed as follows:\n$\\begin{aligned}A^{(k,l,h)} &= \\frac{Q^{(k,l,h)}(K^{(k,l,h)})^T}{\\sqrt{d_h}}\\\\X_a^{(k,l,h)} &= \\sigma(A^{(k,l,h)})V^{(k,l,h)} + X_a^{(k,l-1,h)},\\\\X_p^{(k,l,h)} &= A^{(k,l,h)},\\end{aligned}$\nwhere $Q^{(k,l,h)}$, $K^{(k,l,h)}$, and $V^{(k,l,h)} \\in \\mathbb{R}^{n\\times d_h}$ are the query, key, and value matrices derived by applying the corresponding linear maps $W_Q^{(k,l,h)}$, $W_K^{(k,l,h)}$, and $W_V^{(k,l,h)} \\in \\mathbb{R}^{d_a\\times d_h}$ to the input $X_a^{(k,l-1)} \\in \\mathbb{R}^{n\\times d_a}$. Besides,"}, {"title": "Position Decoder.", "content": "Finally, we use a pair-level position decoder $\\psi_{\\theta}$ to decode the predicted atomic 3D coordinates $\\mathbb{P}$ in the ground-state conformation $C$ from the inputs and outputs of the backbone module along with the atomic 3D coordinates $\\mathbb{P}$ in the input low-quality conformation $C$, i.e.,\n$\\mathbb{P} = \\psi_{\\theta} (\\mathbb{P}, X_a^{(0,0)}, X_p^{(K,L)})$.\nHere, based on the pair-level position decoder $\\psi_{\\theta}$, the specific calculation of the corresponding 3D coordinate in the ground state for i-th atom can be expressed as follows:\n$\\hat{p_i} = p_i + \\sum_{j=1}^n \\frac{f_p(x_{p_{ij}}^{(KL)} - x_{p_{ij}}^{(0,0)})}{n} (p_i - p_j)$,\nwhere $\\hat{p_i} \\in \\mathbb{R}^3$ is the predicted 3D coordinate of i-th atom in the ground-state conformation $\\hat{C}$ and $p_i \\in \\mathbb{R}^3$ is the 3D coordinate of i-th atom in the input low-quality conformation $C$. Besides, n is the number of atoms, and $f_p(\\cdot)$ is an MLP layer that maps the updated pair-level representation $(x_{p_{ij}}^{(K,L)} - x_{p_{ij}}^{(0,0)}) \\in \\mathbb{R}^{d_p}$ of atom pair (i, j) to a scalar as the weight of the corresponding displacement vectors."}, {"title": "Learning Paradigm", "content": "As mentioned earlier, the molecular ground-state conformation prediction task aims to predict the corre-sponding 3D coordinate in the ground state for each atom in the molecule. However, previous works only constrain the interatomic distances $D$ acquired from the predicted atomic 3D coordinates $\\mathbb{P}$ during training, thus seriously limiting their performance.\nHere, to overcome the limitations of previous works, we further propose a multi-task learning paradigm that constrains both predicted atomic 3D coordinates $\\mathbb{P}$ and the corresponding interatomic distances $D$ to enhance predictive performance in various scenarios.\nSpecifically, given the predicted atomic 3D coordinates $\\mathbb{P}$ and corresponding ground truth $\\mathbb{P}$, we firstly align $\\mathbb{P}$ to $\\mathbb{P}$ in the 3D space i.e.,\n$\\begin{aligned}P_0 &= P - \\frac{1}{n} \\sum_{i=1}^n p_i, \nP_0 &= \\mathbb{P} - \\frac{1}{n} \\sum_{i=1}^n \\mathbb{p}_i, \nP^* &= Align(P_0, \\mathbb{P}_0) = P_0Rot(P_0, \\mathbb{P}_0) = P_0VU^T, \\end{aligned}$\nwhere $P_0$ and $\\mathbb{P}_0$ are zero-mean atomic 3D coordinates, and $P^*$ is the aligned ground truth. $Rot(P_0, \\mathbb{P}_0)$ is the rotation matrix derived by Procrustes analysis [39], in which U and V are obtained from the singular value decomposition (SVD) of $\\mathbb{P}_0^TP_0$.\nSubsequently, we use the MAE loss [40] as our loss function to constrain both predicted atomic 3D coordinates $\\mathbb{P}$ and the corresponding interatomic distances $D$ during training as follows:\n$\\mathcal{L} = MAE(\\mathbb{P}, P^*) + \\lambda MAE(D, D^*)$,"}, {"title": "Experiments", "content": ""}, {"title": "Experimental Setup", "content": ""}, {"title": "Datasets.", "content": "Following previous works, we also employ the Molecule3D and QM9 datasets to validate the effectiveness of our proposed method:\n\u2022 Molecule3D. The first benchmark introduced by [22] for the molecular ground-state conformation prediction task. It comprises approximately 4 million molecules, each with its corresponding ground-state conformation calculated by DFT. Besides, it provides two dataset-splitting results (i.e., random and scaffold splitting) to ensure a comprehensive evaluation.\n\u2022 QM9. A small-scale quantum chemistry dataset introduced by [11] for the molecular ground-state conformation prediction task. It comprises approximately 130,000 molecules with 9 heavy atoms, each with its corresponding ground-state conformation calculated by DFT. Besides, it adopts the identical dataset-splitting strategy described in [41]."}, {"title": "Evaluation metircs.", "content": "To guarantee a comprehensive and fair assessment, we choose the same metrics introduced by [11], including D-MAE, D-RMSE, and C-RMSD to evaluate the predictive performance in terms of interatomic distances"}, {"title": "Baselines.", "content": "To fully demonstrate the effectiveness of our proposed method, we compare our proposed method with the state-of-the-art method GTMGC [11] and its typical baselines, including RDKit ETKDG [17], GINE [42], GATv2 [43] and GPS [44]."}, {"title": "Comparison", "content": "Table 1 summarizes the performance of different methods on the Molecule3D and QM9 datasets, which are evaluated by D-MAE, D-RMSE, and C-RMSD together. As shown in this table, our proposed method, ConfOpt, significantly outperforms all baselines across all evaluation metrics on all datasets, achieving state-of-the-art performance."}, {"title": "Effectiveness Analysis", "content": "As illustrated in Sec. 3.3, different from previous works that only optimize the interatomic distances, we further propose a multi-task learning paradigm, which constrains predicted atomic 3D coordinates and the corresponding interatomic distances together during training, to enhance predictive performance. Table 2 displays the performance of our proposed ConfOpt on the Molecule3D and QM9 datasets under different learning paradigms to evaluate the rationality and effectiveness of our proposed multi-task learning paradigm.\nOn the one hand, in most cases, merely constraining predicted atomic 3D coordinates performs significantly worse than constraining the corresponding interatomic distances. This phenomenon aligns with previous works prioritizing constraining corresponding interatomic distances over predicted atomic 3D coordinates, proving the importance of focusing on corresponding interatomic distances during training. On the other hand, compared with merely constraining one term (either predicted atomic 3D coordinates or corresponding interatomic distances), constraining them together during training can achieve better performance across all evaluation metrics on all datasets, thus greatly supporting the rationality and effectiveness of our proposed multi-task learning paradigm.\nIn addition, as our proposed ConfOpt derives the molecular ground-state conformation by iteratively optimizing the low-quality conformation, we further analyze its performance under different iterations to validate the rationality and effectiveness of the conformation iterative optimization. As shown in Figure 5, the performance of our proposed ConfOpt improves steadily and gradually converges with more iterations, thus proving that our proposed ConfOpt can effectively employ conformation iterative optimization to derive the ground-state conformation."}, {"title": "Conclusion", "content": "In this work, we present ConfOpt, a novel framework that effectively simplifies and tackles the molecular ground-state conformation prediction task from the perspective of conformation optimization. Meanwhile, we introduce a multi-task learning paradigm that concurrently optimizes the predicted atomic 3D coordinates and the corresponding interatomic distances during training to improve predictive performance in various scenarios. Extensive experiments demonstrate that our proposed ConfOpt can significantly outperform existing methods and achieve state-of-the-art performance, thus providing a new paradigm for efficiently and accurately predicting molecular ground-state conformation."}]}