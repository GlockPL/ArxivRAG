{"title": "CausalMob: Causal Human Mobility Prediction with LLMs-derived Human Intentions toward Public Events", "authors": ["Xiaojie Yang", "Hangli Ge", "Jiawei Wang", "Zipei Fan", "Renhe Jiang", "Ryosuke Shibasaki", "Noboru Koshizuka"], "abstract": "Large-scale human mobility exhibits spatial and temporal patterns that can assist policymakers in decision making. Although traditional prediction models attempt to capture these patterns, they often interfered by non-periodic public events, such as disasters and occasional celebrations. Since regular human mobility patterns are heavily affected by these events, estimating their causal effects is critical to accurate mobility predictions. Although news articles provide unique perspectives on these events in an unstructured format, processing is a challenge. In this study, we propose a causality-augmented prediction model, called CausalMob, to analyze the causal effects of public events. We first utilize large language models (LLMs) to extract human intentions from news articles and transform them into features that act as causal treatments. Next, the model learns representations of spatio-temporal regional covariates from multiple data sources to serve as confounders for causal inference. Finally, we present a causal effect estimation framework to ensure event features remain independent of confounders during prediction. Based on large-scale real-world data, the experimental results show that the proposed model excels in human mobility prediction, outperforming state-of-the-art models.", "sections": [{"title": "1 INTRODUCTION", "content": "Human mobility exhibits spatio-temporal patterns that can aid policy-makers in urban management and decision-making. However, large-scale public events complicate the capture of these mobility patterns, resulting in less robust predictions [9, 15, 28]. These"}, {"title": "2 RELATED WORK", "content": "Human Mobility Prediction. In recent years, the development of geolocated datasets and data mining technologies has made human mobility increasingly important for urban management, transportation and disaster response [4, 7]. Benefiting from high-performance computational power, large-scale human mobility prediction based on deep learning has achieved good performance [44]. Researchers have focused on capturing periodical and semantic information to represent regional features for prediction. For example, STGCN [41] captured long-term periodical spatio-temporal patterns based on graph structures for traffic prediction, while DeepSTN+ [19] modeled long-range spatial dependence of different regions using POI features as semantic information. These models effectively capture regular patterns in human mobility. However, for irregular situations with low periodicity, such as disasters or festivals, previous research tends to model mobility under specific conditions, making predictions less generalizable [3, 14, 36].\nCausal Analysis for Human Mobility. Causal analysis aims to reveal cause-effect relationships among variables [23]. Many previous studies have separated treatments from traditional inputs to analyze their effects on outcomes. These treatments are usually single variables, including discrete and continuous variables [40]. However, in the real world, treatment variables affecting human mobility are much more complex. Previously, causal analysis for human mobility has focused on specific situations. For example, Ma [20] introduced causal inference to assess the effectiveness of COVID-19-related policies by learning confounders from human mobility data and residents' vigilance from Google Trends. Similarly, Zhang [45] used these data to assess the effect of typhoons, represented by wind speed and precipitation, on human mobility."}, {"title": "3 DATA AND ANALYSIS", "content": "In this section, we describe the observation data used to estimate the causal effects of public events on human mobility. We also include data analysis of public events and human mobility patterns to demonstrate the necessity of introducing causality analysis."}, {"title": "3.1 Observational Data", "content": "This research aims to causally analyze the relationship between public events (treatment) and human mobility (outcomes) in Japan. We select 490 administrative regions (referred to as regions in the following content) across Japan, as shown in Figure 3(a). Some areas were exclude due to insufficient human mobility data (aggregated from GPS records provided by BlogWatcher Inc. [1]). We continuously filter these data within the time range of 2023/04/01 to 2024/03/31, corresponding to the official fiscal year in Japan.\nTreatment E: Public events features extracted from news articles. We collaborate with Kyodo News, one of the largest international news agencies, which distributes news to almost all newspapers, radio, and television networks in Japan, reaching over 50 million subscribers [38]. With the same time range as the human mobility data, we filter out unrelated articles as data-cleaning process. We then align the news articles with the corresponding regions using manually labeled region codes. To further analyze the effects on human mobility, we introduce LLMs to extract structured information and human intentions as features from these filtered news articles. More details will be provided in the methodologies section.\nOutcome Y: Future human mobility in selected regions. This study focuses on human mobility affected by the causal effects of public events. We aggregate human mobility data (GPS records) in selected regions as our prediction target. During this process, all users remain anonymous, and we take the hourly samples of uids aggregation within mentioned time ranges.\nCovariates X: Spatio-temporal regional covariates. We introduce proxy variables as region covariates to capture the unobserved confounders Z. We collect Points of Interest (POI) from OpenStreetMap (OSM) and categorize them to represent region features [19]. Before calculating confounders Z, we concatenate POI features, time embeddings, region embeddings, and historical human mobility data. More details will be provided in the methodologies section.\nNetworks A: Re-normalized Mobility network. We use a human mobility network to model the inter-regional interactions and capture unobserved confounders in the selected regions. We aggregate the hourly Origin-Destination (OD) matrix adjacency within the regional network to represent the strength of each region's relationship. Each edge in this network contains a time-varying weight computed based on mobility volumes between two regions in the OD matrix. We re-normalize this mobility network, resulting in a weighted adjacency matrix \\(A_t\\) for each timestamp [17]."}, {"title": "3.2 Preliminary Data Analysis", "content": "To explore the mentioned causal relationship, we conduct preliminary data visualization analysis to illustrate the dependence between changes in human mobility and the occurrence of public events. We manually select two cases including a firework and a typhoon from our datasets and visualize them, respectively.\nAs illustrated in Figure 1, public events are divided into four"}, {"title": "4 METHODOLOGY", "content": "In this section, we explain why and how to obtain human intentions towards public events extracted from news articles as treatments with LLMs and describe how we formulate the causal effect estimation problem in human mobility prediction."}, {"title": "4.1 Human Intentions Extraction with Semantic-Aware LLMS", "content": "In most situations, news articles report public events objectively, allowing us to estimate mobility-related human intentions. Our dataset contains over 130,000 news articles of one year, covering multiple genres as shown in Figure 4, making manual processing impractical. Taking advantage of the development of open source LLMs, we can extract the necessary structured information [12] and simulate human intentions related to human mobility using prompt engineering, starting with simple manual filtering [16].\nTo enable LLMs to reason about human mobility-related inten-"}, {"title": "4.2 Causal Effect Inference through Counterfactual Estimation", "content": "For features of n selected regions, we collect POI information and divide them into c specific categories according to their labels. We denote this feature as \\(P_i = \\{p_i^j\\}_{j=1}^c\\), where p refers to the j-th category of the i-th region. Using human mobility data consisting of GPS coordinate records, we aggregate anonymous uids in one region with a fixed time interval. This can be represented as \\(X_{flow}^{i} = \\{x_{flow}^i\\}_{i=1}^n\\). Furthermore, considering that human mobility is highly dependent on regional interactions, we used a n \u00d7 n normalization adjacency matrix \\(A_t\\) at timestamp t to represent time-varying relations between regions. In Figure 5, we calculate confounder \\(Z_t = \\{z_{i,t}\\}_{i=1}^n\\) with observation data, where \\(X_{Reg}^{i,t}\\) refers to natural region representations, \\(X_t\\) is the embedded timestamp, and \\(X_{i,t}\\) is temporally re-weighted POI feature.\nAs for treatments for causal inference, we obtain structured information including information about time, location and human intentions toward public events of each region \\(N_{i,t}\\) at time step t with prompted LLMs, and we conclude observed events in the input window and scheduled or predictable ones in the output window, as the flow chart in Figure 5. When it comes to evaluating treatment effects, one of the challenges is that previous studies focused on binary or continuous covariates in one dimension, while in our research we are facing complicated event features depicted by news articles over multiple time steps, and we need to convert them to a single feature \\(T_{i,t}\\). To calculate the causal effect of different public events on human mobility, we need to calculate the average treatment effect (ATE) at timestamp t of i-th selected region in our research area:\n\\[\\tau_{ATE} = \\mathbb{E}[y_{i t}^{1} - y_{i t}^{0} | z_{i,t}, T_{i,t}],\\]\nwhere \\(y_{i t}^{1}\\) and \\(y_{i t}^{0}\\) refer to potential outcomes of human mobility with and without causal effects of public events under the same spatio-temporal condition, corresponding to the outcomes Y.\nGenerally, it is impossible to observe the effects of different public events in one region simultaneously. Furthermore, in our observation data, public events show biases because of confounder imbalance and non-randomized treatments among regions. It means that some events tend to happen in certain regions, which will lead to unreliable inference. Processing public event features into a one-dimensional feature will result in significant information loss. Fortunately, we can quantify the similarity or strength of public events at a semantic level. Therefore, we introduce the concept of average dose-response function (ADRF) [11], denoted as \\(\\mathbb{E}(Y_t | Z_t, T_t = T)\\), to apply causal effect evaluation with multidimensional treatments.\nPrevious research stressed that ADRF loss is bounded by the marginal loss comprising factual loss and counterfactual loss. As we cannot easily observe and define a counterfactual, we alternatively use a re-weighting schema to reduce confounder imbalance and calculate the upper bound of ADRF loss with Integral Probability Metrics (IPM) distance as our counterfactual loss (also an auxiliary loss) [33]. As IPM distance represents a group of metrics to measure distribution differences between re-weighted fact and counterfactual, optimizing the upper bound allows us to encompass most ADRF estimation methods used in previous research.\nBased on the above formulations, we propose a causal effects"}, {"title": "4.3 Confounder Representation Learning by Spatio-Temporal Data Modeling", "content": "In Figure 5, to learn spatio-temporal regional confounders, we use ST-ResNET [42] based on Graph Convolution Networks (GCNs) to capture hidden states independent of treatments from historical observation data. First, we capture time-varying regional covariates using POI features and time information [19]. For each region, we collect POI data with c categories, represented as \\(P_i \\in \\mathbb{R}^{n \\times c}\\). After normalization, we fuse POI features with embedded time information \\(X_t \\in \\mathbb{W}^{T \\times c}\\) within a fixed input window. Finally, we re-weight the static POI features with average time embedding and calculate the mean value as time-varying regional features:\n\\[X_{i t} = X_t \\odot P_i,\\]\nwhere \\(\\odot\\) refers to element wise multiplication and \\(X_t\\) represents mean value of temporal embedding of input window.\nNext, we concatenate multiple time-step ground truth observations \\(X_{flow}^{A_{i t}}\\) with other input variables before being passed into the GCN-based ST-ResNET, just as described below [10, 17]:\n\\[\\mathcal{X}_{i,t} = X_{flow}^{A_{i t}} \\oplus X_t \\oplus \\widehat{X_t} \\oplus X_{Reg},\\]\nwhere \\(\\oplus\\) refers to concatenation operations. As for \\(f_{GCN}\\), we use a two-layer GCN to fuse and capture the hidden state as follows:\n\\[f_{GCN} (X, A) = A [(AX)W_1] W_2,\\]\nwhere \\(W_1\\) and \\(W_2\\) are learnable parameters of two GCN layers. Finally, the output of \\(f_{GCN}\\) will be added with input to build up a ST-ResNET [42] structure to get the confounder \\(z_{i,t}\\):\n\\[z_{i,t} = f_{GCN} (\\mathcal{X}_{i,t}, A_t) + \\mathcal{X}_{i,t}.\\]"}, {"title": "4.4 Human Mobility Prediction Enhanced by Causality Modeling", "content": "With the confounder \\(z_{i,t}\\), the model starts calculating the factual loss and counterfactual loss. We encode the treatment \\(T_{i,t}\\) with human intentions \\(N_{i t}\\) in structured information. Considering that"}, {"title": "5 EXPERIMENT", "content": "In this section, we conduct experiments to introduce different analyses of our model based on Figure 5. In Section 5.2, we show overall performance by comparing with baseline models and present the results of the ablation study. In Section 5.3, we provide distributions of LLMs' output for human intentions toward public events in news articles. In Sections 5.5 and 5.6, we provide analyses of average treatment effects estimation and the causal response of human mobility to two public events as counterfactuals. As a case study in Section 5.7, we show prediction results in our test process comparing predictions without human intentions."}, {"title": "5.1 Experimental Settings", "content": "Our model is developed with Pytorch 1.8.2 and Python 3.8, and trained on a server equipped with four NVIDIA RTX A6000 GPUs running the Ubuntu 20.04 operating system. The raw GPS data"}, {"title": "5.2 Overall Performance", "content": "To evaluate the prediction performance of our proposed model, we select several state-of-the-art models in human mobility prediction. It's important to note that it is difficult to implement the event-based treatments into traditional causal-based models, as they are not one-dimensional and cannot be easily classified into binary treatments as in previous studies. Therefore, we mainly focus on the following human mobility prediction models:\n3DGCN [39]: A crowd flow prediction model based on a three-dimensional GCN to capture spatio-temporal dependencies.\nGTS [25]: A time-series prediction model that explores correlation and causation among variables based on GNNs by learning a probabilistic graph by optimizing performance over graph distribution.\nPromptST [43]: A spatio-temporal prediction model combining transformers and spatio-temporal prompts to balance common knowledge learning with efficient adaptation to specific tasks.\nSTGNN [34]: A traffic flow prediction model based on GCN, GRU, and transformer structure to learn the latent patterns and capture spatial dependency in traffic nodes of transportation networks.\nDeepST [42]: A crowd flow prediction model based on ST-ResNET by simulating close, period and trend properties of crowd traffic and further combined with external factors during prediction.\nDeepSTN+ [19]: A crowd flow prediction model by modeling the long-range spatial dependence among crowd flows in different regions and fusing POI semantic features simultaneously.\nSTID [26]: A simple MLP-based baseline model for multivariate time series forecasting using spatial and temporal identity embeddings to improve efficiency and accuracy.\nCIDER [20]: A causal effect estimation framework for COVID-19 policy in the US based on GRU and GCN. Also, Zhang [45] used the same backbone model for assessing causal effects of typhoons.\nFor prediction settings, we assume that public events have different potential effects at multiple time scales, so we design three tasks with different input (In) and output window (Out). We choose Root Mean Square Error (RMSE), Mean Absolute Error (MAE), and Mean Absolute Percentage Error (MAPE) as metrics for comparison."}, {"title": "5.3 Analysis of LLMs-derived Human Intentions", "content": "In this section, we analyze LLMs-derived human intentions extracted from structured information. In the previous sections, we set multiple scores to evaluate news articles with Prompt 5 in Appendix 8.1. In Figure 6, we show the distributions of scores for all news articles. The score of Q1 describes the degree of danger of public events, with almost 60% having no negative impact on human mobility. The third score for Q3 refers to the level of interest, with almost half of the events not attracting people to certain areas. The concepts of danger and interest are not mutually exclusive, allowing an event to receive non-zero scores in both dimensions simultaneously. The remaining scores represent different aspects such as staying in Q2, impact on daily life in Q4, impact on business activities in Q5, transportation in Q6, public health in Q7, government intervention in Q8, and public services in Q9. The last score, Q10, indicates the duration of the public events. With Prompt 4 in Appendix 8.1, we expect LLMs to judge the predictability of public events. Combined with scores in danger and interest, we categorize news articles into four quadrants based on public events categorization in Figure 1. Finally, public events in news articles labeled with \"Yes\" are treated as unpredictable cases."}, {"title": "5.4 Analysis of Encoded Treatment Interpretability", "content": "In this section, we present the results of encoded human intentions. In our CausalMob, human intentions toward public events in the input and output window are considered simultaneously. All intentions in the input window are included, but only those of predictable events are considered and put into the encoder during training. Here, we choose the encoder in the long-term prediction task to process features obtained from LLMs. In Figure 8, we visualize encoded features of different public events using t-SNE [30].\nIn Figure. 8, human intentions features related to Sports are generally distinguished from events with other labels, and the corresponding points in the right figure are categorized into positive predictable events. In contrast, Crime/Justice, Disaster/Accident events have similar distributions. Besides, those corresponding points are always classified into negative events in the right figure.\nThe above conclusions are consistent with the information revealed in Figure 7, which also demonstrates the ability of the treatment encoder to identify and learn the characteristics of human intentions."}, {"title": "5.5 Analysis of Regional Average Treatment Effects", "content": "In this section, we analyze the average treatment effects of different public events under the same spatio-temporal conditions. We collect all treatment representations of human intentions during the training process and sorted them according to their cosine similarities to the treatment baseline [27]. We use 0.1 as the interval to split similarities, resulting in 14 intervals of treatment similarities. In Figure 9, we visualize the distributions of the original news labels in each interval, and we can see that public events related to Sport and Crime/Justice occupy the majority of all treatments intervals. In the most dissimilar treatment interval of [-0.4, -0.3], Weather shares a higher proportion, which is quite different from other intervals."}, {"title": "5.6 Analysis of Causal Response with Counterfactual", "content": "In this section, we provide an analysis of the causal response of human mobility to different public events as counterfactuals. We select news articles about a firework and an earthquake, then extract structured information to get human intentions as treatments and input them into the long-term prediction process as a predictable event and an unpredictable one, respectively, for one region (Aichi, Matsuyama). In Figure 11, the event feature of the firework festival presents a positive effect on human mobility at all prediction timestamps. On the contrary, the feature of the earthquake tends to control the increase of human mobility compared to the firework, with our results presenting negative effects on human mobility at several timestamps in the mid-noon and night. This demonstrates that our proposed model can simulate the positive and negative effects of different public events on human mobility prediction."}, {"title": "5.7 Case Study of Prediction with Human Intentions", "content": "In this section, we provide a case study in test dataset to show the effect of our model. In Figure 12, a predictable public event of severe weather is reported on 2024-03-12 08:25:00, and in the structured information processed with LLMs, the event time is reset to noon the next day. We use LLMs-derived human intentions, as shown in the title of Figure 12, to predict human mobility on the day following the 12th. For comparison, we use all-zero intentions to mask this event and also predict future human mobility. Then, we calculate the prediction errors for each timestamp and the improvement of our model with the green line, along with the occurrence of the severe weather at noon, indicated by the orange line.\nIn Figure 12, we can see that the prediction results are similar in the morning hours of the day. However, as the predictable severe weather approaches, our model starts to show more accurate predictions, which is evident from the change in the Improvement line. In this case, our model achieved the best results around the predictable public event (i.e., 12:00 p.m.). The improved performance of predictions with and without the causal influence of human intentions decreases gradually after that point. Overall, our model consistently maintained more accurate predictions. This result shows that our model can use structured information and human intentions"}, {"title": "6 CONCLUSION", "content": "In this research, we aim to predict human mobility based on LLMs-derived human intentions toward public events using a causal inference framework and evaluate the response of human mobility to different public events. We utilize news articles provided by a Japanese international news media company to extract structured information about public events and generate human intentions related to human mobility with open-source LLMs by prompt engineering. We propose a prediction model called CausalMob to predict human mobility and estimate the causal effect of public events using multiple data sources (including open source POI data and private human mobility data of GPS coordinates records) in 490 main administrative regions of Japan. Compared with several state-of-the-art models, our proposed model performs better on multiple prediction tasks. Furthermore, our approach provides interpretable results for investigating the relationship between human mobility and public events. Our findings can help decision-makers estimate mobility changes in different regions and make informed decisions in advance when facing various public events."}, {"title": "7 ACKNOWLEDGMENT", "content": "This work is supported by LocationMind Inc. and Kyodo News. The authors appreciate the members of the Koshizuka Lab at The University of Tokyo and the Spatio-temporal Intelligence Lab at Jilin University for their constructive suggestions on this work."}, {"title": "8 APPENDIX", "content": ""}, {"title": "8.1 Prompts for LLMs", "content": "Prompt 1: Public Events\nYou are an Al that notifies affected users and makes suggestions to change their mobility based on news text. First, identify the most influential events in the news content, including scheduled and unpredictable events.\nPrompt 2: Time Information\nNext, estimate the exact time of the most important event mentioned in the news in the following JSON format: \"event time\": \"yyyy-mm-dd hh:mm:ss\". If the exact time is unknown, use the news release time. Provide only the JSON string without any additional text or explanations.\nPrompt 3: 3W1H about Human Mobility\nBased on the news text and our chat, evaluate the 3W1H related to human mobility.\nWhere: Where should people move if necessary?\nWho: What kind of people will be affected?\nWhen: When did the event happen?\n- How: How should people move if necessary?\nPrompt 4: Predictability\nIs the content in the news more like an unpredictable event, such as an earthquake? Your answer can only be \"Yes\" or \"No\".\nPrompt 5: Human Intentions\nBackground: Most news related to economic, politics, culture, and history issues usually have no effect on human mobility because they do not relate to people's daily life.\nSlight disasters, such as light earthquakes and tsunamis, or some local events (like political events) may also have no effect on human mobility in Japan.\nOnly events that happened close to the release time (within several hours) may have an influence on human mobility.\nTask: Score the news text based on the following aspects (0-100, where a higher number means higher agreement):\nQ1. To what extent do the events described in the news make people leave the area because they are dangerous?\nQ2. To what extent do the events described in the news make people stay in the area because it is better not to move?\nQ3. To what extent do the events described in the news make people visit the area because they are interesting events?\nQ4. To what extent do the events described in the news make people keep their daily routine as these events are not important to daily life?\nQ5. To what extent do the events described in the news lead to interruption of economic activities, such as business closures or work stoppages?\nQ6. To what extent do the events described in the news affect transportation conditions, such as traffic congestion or road closures?\nQ7. To what extent do the events described in the news impact public health and safety, leading to decisions to leave or avoid certain areas?\nQ8. To what extent do the events described in the news involve government or official instructions that influence people's movements?\nQ9. To what extent do the events described in the news affect the availability of public services, such as school closures or interruptions in medical services?\nQ10. To what extent do the events described in the news last a long time (like one day)?\nExpected response: A list of 10 numbers between 0 and 100."}, {"title": "8.2 Hyper-Parameter Settings", "content": "In this section, we provide other hyper-parameters for model training that we did not mention in the main content because of space limitation."}, {"title": "8.3 News Articles with LLMs Generated Answers", "content": "In this section, we provide some cases of news articles and their structured information generated with LLMs. Due to copyright and other policies, we cannot share original articles, but we can provide links to the corresponding news articles (English version, not original Japanese news article).\nTyphoon Khanun:\nAnswer 1: I've identified the most influential events in the news content: Typhoon No. 6 is expected to approach Okinawa on August 3, (predicted closest approach).\nAnswer 2: 2023-08-03 06:00:00\nAnswer 3: Here are my evaluations:\nWhere: People in Okinawa and Amami regions may need to move to safer areas or evacuation centers, away from coastal areas prone to storm surges and flooding.\nWho: Residents, commuters, and tourists in Okinawa and Amami regions, especially those living in low-lying areas or near the coast, will be affected by the typhoon.\nWhen: The event is ongoing, with the typhoon expected to approach Okinawa on August 3. (Note: The news release time was August 2, 07:17:28)\nHow: If necessary, people should move to safer areas or evacuation centers using safe routes and modes of transportation, such as official evacuation buses or private vehicles, while following instructions from local authorities and staying informed about weather updates.\nAnswer 4: No.\nAnswer 5: [80, 20, 0, 0, 40, 70, 80, 60, 30, 50]\nSumidagawa Firework:\nAnswer 1: The most influential event identified is the resumption of the \"Sumida River Fireworks Festival\" after a 4-year hiatus due to the COVID-19 pandemic. This event will take place on July 29th and is expected to attract approximately 950,000 people.\nAnswer 2: 2023-07-29 19:07:04\nAnswer 3: Here are my evaluations:\nWhere: If necessary, people may need to move away from the Sumida River area in Tokyo to avoid congestion and large crowds.\nWho: People who plan to travel or move around in the Sumida River area in Tokyo, particularly those who live or work nearby, tourists, and festival-goers will be affected by the event.\nWhen: The event happened on July 29th (the day of the news release).\nHow: If necessary, people should consider using public transportation, rescheduling their travel plans, and planning alternative routes to avoid congested roads and traffic jams.\nAnswer 4: No.\nAnswer 5: [0, 20, 85, 20, 0, 0, 0, 0, 0, 60]"}]}