{"title": "A versatile machine learning workflow for high-throughput analysis of supported metal catalyst particles", "authors": ["Arda Genc", "Justin Marlowe", "Anika Jalil", "Libor Kovarik", "Phillip Christopher"], "abstract": "Accurate and efficient characterization of nanoparticles (NPs), particularly regarding particle size distribution, is essential for advancing our understanding of their structure-property relationship and facilitating their design for various applications. In this study, we introduce a novel two-stage artificial intelligence (AI)-driven workflow for NP analysis that leverages prompt engineering techniques from state-of-the-art single-stage object detection and large-scale vision transformer (ViT) architectures. This methodology was applied to transmission electron microscopy (TEM) and scanning TEM (STEM) images of heterogeneous catalysts, enabling high-resolution, high-throughput analysis of particle size distributions for supported metal catalysts. The model's performance in detecting and segmenting NPs was validated across diverse heterogeneous catalyst systems, including various metals (Cu, Ru, Pt, and PtCo), supports (silica (SiO2), \u03b3-alumina (y-Al2O3), and carbon black), and particle diameter size distributions with mean and standard deviations of 2.9 \u00b1 1.1 nm, 1.6 \u00b1 0.2 nm, 9.7 \u00b1 4.6 nm, 4 \u00b1 1.0 nm. Additionally, the proposed machine learning (ML) approach successfully detects and segments overlapping NPs anchored on non-uniform catalytic support materials, providing critical insights into their spatial arrangements and interactions. Our AI-assisted NP analysis workflow demonstrates robust generalization across diverse datasets and can be readily applied to similar NP segmentation tasks without requiring costly model retraining.", "sections": [{"title": "Introduction", "content": "Heterogeneous catalysts, consisting of metal/oxide nanoparticles (NPs) deposited on high-surface-area supports, are fundamental for major industrial processes and environmental management. Their widespread use is driven by their small size and high surface area-to-volume ratios, which endow them with distinctive physical and chemical properties and efficient metal utilization. In heterogeneous catalysis, precious metal NPs such as Platinum (Pt) and Palladium (Pd) are extensively employed as active sites for various chemical reactions owing to their unique surface electronic structure that facilitates a range of important catalytic processes [1, 2].\nAccordingly, accurate analysis of NP size distributions is critical for understanding the structure-property relationship of heterogeneous catalysts. Several techniques are commonly employed to measure NP size, including H2 or CO chemisorption, dynamic light scattering (DLS) for NPs in solution, TEM, scanning electron microscopy (SEM), X- ray diffraction (XRD), nanoparticle tracking analysis (NTA), small-angle X-ray scattering (SAXS), X-ray absorption spectroscopy, UV-visible spectroscopy, etc. [3, 4, 5]. Each method has distinct advantages and disadvantages. A comprehensive review of these techniques is beyond the scope of our paper.\nAmong these techniques, TEM employs an electron beam to probe thin samples, yielding high-resolution images that reveal the detailed structure and morphology of materials [6]. One of TEM's key strengths is its ability to achieve sub- nanometer resolution, allowing for direct observation of particle shape and structure. This high-level detail is essential for many analysis tasks, which require precise identification of objects and their boundaries at pixel resolutions of tenths of a nanometer and even at subpixel precision.\nWhile providing high-resolution information, TEM is not a sample-averaged technique; it focuses on a limited area of a sample by acquiring 2D projections of 3D objects. Due to the lack of automation in data acquisition and analysis, TEM is often overlooked for large-scale, routine analysis, which hinders its broader application [7]. As the field progresses toward scaling 2D data analysis, there is a growing demand for reliable, reproducible, and high-throughput methods for particle size analysis in TEM [8, 9, 10]. Efficiently processing large datasets is crucial for obtaining statistically meaningful information, particularly when a single TEM grid can contain tens of thousands of NPs. Addressing these challenges is essential for advancing the quantitative analysis of NP systems and enhancing the efficiency of TEM-based studies.\nClassical image processing methods such as thresholding, edge detection, and watershed segmentation, commonly employed in NP size analysis, use global intensity distributions rather than localized pixel-level classifications for feature extraction [11, 12, 13, 14]. These methods often fail when analyzing complex, densely packed, low-contrast, and fine-scale NPs when scattered on catalytic support materials with similar contrast. In such cases, manual user intervention is required to resolve objects and their boundaries. Without this, image analysis results in ambiguities due to the intricate contrast mechanisms inherent to TEM.\nRecent advances in AI have profoundly transformed the field of computer vision, enabling the automated analysis of large and complex datasets that would otherwise be impractical manually [15, 16, 17, 18, 19, 20, 21, 22, 23, 24]. Deep learning-based pixel-level classifiers have been effectively employed in various classification tasks where traditional methods struggle to process complex structures [25, 26, 27]. AI-driven approaches excel in cases where bimodal intensity distributions are ineffective, and boundaries between the structures are difficult to resolve due to the subtle variations in the contrast gradients.\nConvolutional neural networks (CNNs) have been explored for the segmentation of NPs in high-resolution TEM images (HRTEM)[24, 28, 29]. These studies primarily focus on segmenting HRTEM images of well-isolated precious metal NPs dispersed on ultrathin amorphous carbon film TEM supports. While the CNNs have been evaluated on these ideal systems, their applicability has not been assessed for supported metal catalyst particles, where the background intensity of the support can exhibit significant complexity. Furthermore, these approaches have shown limited success in segmenting overlapped or connected particles, as well as fine-scale particles with diameters of 2 nm or less.\nIn AI-driven analysis, supervised and unsupervised machine learning (ML) algorithms face challenges regarding model generalization and compatibility [30, 31]. CNNs, such as U-Net, typically require large amounts of labeled data for model training to achieve optimal performance [24, 28, 32]. Their effectiveness diminishes when applied to images that differ from those in the training dataset, limiting their ability to generalize. Consequently, ensuring these models perform consistently across diverse datasets remains a critical challenge in advancing AI-driven analysis.\nTo overcome the challenges associated with NP detection and analysis, we developed a two-stage methodology that integrates an object detection stage, functioning as a prompt generator and a transformer model for pixel-level clas- sification. Our NP analysis approach encompasses Meta AI's segment anything model (SAM), which is designed to function through manual or automated prompts [33]. As a foundation ViT model, SAM generalizes effectively across various segmentation tasks. Implementing models like SAM represents a paradigm shift in deep-learning-based im- age segmentation, as traditional deep-learning approaches typically involve training CNNs from scratch or fine-tuning them for specific tasks. Recent studies have reported significant segmentation accuracy gains over traditional CNN models like U-Net, leveraging SAM's zero-shot generalization capability by point or box prompt engineering strategies [34, 35, 36, 37, 38].\nObject detection consists of two competing domains: single-stage and two-stage detectors for bounding box predic- tions. Two-stage models, such as Faster R-CNN, first generate a set of region proposals for potential object locations [39]. These proposals are then refined and classified into object categories in a second stage. In contrast, single- stage object detection models process the entire image simultaneously, directly predicting bounding boxes without a separate proposal stage, making them faster and more suitable for real-time applications [40]. Among two-stage de- tectors, Faster R-CNN is a leading model, excelling in accuracy. However, single-stage models like YOLO (You Only Look Once), particularly with the development of YOLOv8, have significantly improved their architectural design and model generalization through anchor-free and multi-scale prediction algorithms [41, 42]. These models have been reported to be comparable to, and even outperform, Faster R-CNN in certain object detection tasks [43, 44, 45, 46].\nSingle-stage object detection models like YOLO perform well in rapidly and accurately localizing objects across various sizes and with occlusions [47, 48]. YOLO's robustness in handling these complex visual tasks has established its versatility in numerous applications, including autonomous vehicle navigation, aerial drone surveillance, defect identification in industrial manufacturing, and even early-stage cancer detection [49, 50, 51, 52].\nOur approach combines YOLO's compatibility, speed, and accuracy for precise NP detection with SAM's fast and ac- curate segmentation capabilities, providing a robust tool for high-throughput analysis. This integrated process demon- strates strong generalizability, eliminating the need for labor-intensive model retraining and allowing users to focus on data interpretation and analysis. We believe this approach will significantly accelerate TEM particle analysis, enabling the efficient processing of thousands of NPs with minimal user intervention and facilitating the automated analysis of large datasets."}, {"title": "Results and discussion", "content": "2.1 Detection and segmentation\nModel training for the object detection task begins with transfer learning using the pre-trained weights of the YOLOv8x model, which serves as the foundation for the prompt generator. This model is then fine-tuned using manually anno- tated images to adapt it specifically for the NP class. This fine-tuning step enables the model to effectively detect NPs within bright-filed TEM (BF-TEM) and high-angle annular dark-field (HAADF) STEM images.\nWe selected the largest version of the YOLOv8 model, known as YOLOv8x (extra-large), which features more layers (365 layers), channels, and parameters (68M parameters). This architecture enhances the model's ability to detect smaller objects and manage complex scenes, making it particularly well-suited for NP detection.\nFigure 1 (top) illustrates the three main components of the YOLO object detection model. The backbone, comprising a 53-layer deep convolutional neural network, is responsible for extracting feature maps from input images. The neck of the network integrates features from various stages of the backbone to produce a multi-scale feature representation, employing a path aggregation network (PANet) to enhance feature aggregation. The head of the network is responsible for predicting bounding boxes, objectness scores, and class probabilities. By utilizing feature maps from different levels of the network, the model can predict objects of varying sizes, ranging from small to large.\nIn conjunction with YOLO, our pipeline encompasses SAM, which has been trained on the SA-1B dataset, consisting of 11 million images and 1 billion annotations. SAM has shown strong zero-shot learning capabilities, enabling seg- mentation without requiring additional retraining for new classes. We adapted the model using the smallest backbone, vit-b, which provides a lightweight solution for fast and accurate pixel-level classification of the NPs."}, {"content": "2.2 Nanoparticle analysis\nWe demonstrate the effectiveness of our AI-assisted particle analysis workflow on a diverse set of metallic NPs dis- persed on catalytic support materials. Figure 2 shows object detection and segmentation results from BF-TEM images of PtCo NPs on carbon black, as well as HAADF STEM images of Cu NPs on silica and Ru NPs on y-alumina, all captured from large field-of-view TEM images. The total processing time, including both detection and segmentation stages, is approximately one minute for 748 PtCo NPs and 339 Ru NPs, and 30 seconds for 173 Cu NPs.\nIn BF-TEM, electron diffraction primarily drives contrast formation, whereas in HAADF STEM, contrast is influenced by variations in composition and sample thickness. The contrast modulation observed in the BF-TEM images of NPs arises from changes in crystal orientations relative to the electron beam. Image interpretation is further complicated by the contributions from the support material to background contrast and varying degrees of NP overlap. Using our proposed Al-assisted particle analysis workflow, 748 NPs with an average particle diameter of 4 \u00b1 1.0 nm (mean \u00b1 standard deviation) were successfully detected and segmented from the BF-TEM image of PtCo NPs on carbon black support material, as shown in Figure 2 (top).\nIn HAADF STEM, image contrast is monotonic, with intensities increasing as both the sample thickness and atomic number (Z) of the elements increase. While a higher Z enhances the contrast, a significant increase in thickness can considerably reduce it. Consequently, identifying regions containing higher-Z elements against a background of relatively thin TEM foil and lighter support material is a more feasible task.\nSTEM imaging presents significant challenges due to abrupt thickness variations in the underlying catalytic support material. The support materials often form micron-thick large aggregates decorated with planar surface facets and a dense network of pores and channels. Such geometric variations complicate contrast formation and make it difficult to trace the boundaries between the NPs and the surrounding background, particularly when there is a sudden increase in the support materials's thickness. However, our proposed workflow successfully overcomes these challenges, as demonstrated by the detection and segmentation of hundreds of Cu NPs (Figure 2, middle) and Ru NPs (Figure 2, bottom) with average particle diameters of 1.6 \u00b1 0.2 nm and 2.9 \u00b1 1.1 nm, respectively, from wide field-of-view HAADF STEM images.\nThe segmentation performance was evaluated using standard semantic segmentation metrics, as detailed in Table 1, to measure the overall overlap between the predicted and ground truth segmentations. The segmentation of the NPs, guided by bounding box prompting, achieved an average F1 overlap score of 0.91 (\u00b1 0.01) across three catalytic sys- tems: Cu NPs on silica, Pt NPs on y-alumina, and PtCo NPs on carbon black datasets. Notably, the sparse distribution of the metallic NPs over the background and catalytic support material introduces an unbalanced representation of the data in the TEM images. This class imbalance, dominated by an overwhelming number of easy examples from the background, skews the loss function during the model training in CNNs, limiting their ability to focus on the minority foreground class. The high F1 score, precision, and recall values across each dataset demonstrate the effectiveness of our proposed two-stage workflow. First, it identifies the NPs in these imbalanced datasets using a multi-scale feature fusion and prediction approach and then segments them using a transformer model.\nThe results in Table 1 indicate a relatively lower overlap ratio for the segmentation of Cu NPs compared to Pt NPs, which are associated with a higher average Z of elements in the HAADF STEM images. This lower performance for Cu NPs can be attributed to their low contrast against the silica substrate, especially when the smaller NPs are distributed on the thicker regions of the silica support material, as shown in Figure 2 (middle). The uncertainty in these diffuse boundaries can introduce ambiguity in identifying and manually annotating the ground truth segmentations, making precise annotation difficult even for human experts. The observed issues with Cu NPs highlight potential improvements in handling low-contrast images.\nTo further investigate our segmentation results, we assessed the degree of surface match for the NPs using the Haus- dorff distance (HD) metric. While the segmentation-overlap results provide insight into overall performance across the entire NP, they are often more influenced by the high number of true positives. The HD metric specifically tar- gets boundary-match errors between the ground truth and predicted segmentations of NPs, offering a more detailed evaluation of segmentation accuracy, particularly at the NP boundaries.\nTable 2 presents the largest segmentation error based on the average HD and the 90th percentile of robust HD (RHD) values. The RHD measurement is crucial for understanding the impact of the outliers and noise on model performance and for guiding the accuracy of boundary match. The average HD is 7.8 \u00b1 3.7 nm, with the largest error observed for Cu NPs, aligning with the lower overall segmentation-overlap values reported for this material in Table 1. Interestingly, the 90th percentile RHD values follow a different trend, indicating significantly lower values of segmentation error: 1.4 \u00b1 0.6 nm for Pt NPs, 0.16 \u00b1 0.05 nm for Cu NPs, and 0.4 \u00b1 0.1 nm for PtCo NPs.\nAdditionally, we observe that RHD values scale with an average of 3.5 \u00b1 0.45 pixels for the Pt and Cu NPs imaged both using the HAADF STEM technique. This systematic discrepancy across two catalytic systems is mostly expected considering the origins of the image formation in HAADF STEM, which is directly interpretable and near-linear compared to BF-TEM imaging. In contrast, there is a relatively more pronounced segmentation error per pixel for the BF-TEM images of PtCo NPs at the 90th percentile of the RHD. Contributing factors to the BF-TEM image formation, such as low Z-contrast, surface delocalization, and Fresnel fringes in regions with heavily overlapped particles, introduce significant ambiguity, making it difficult to segment these NPs with high pixel accuracy.\nMetallic catalyst particles often exhibit bimodal or multimodal size distributions rather than being uniform. Analyzing a large sample size enhances the accuracy of the average particle size calculation by reducing the impact of the outliers and anomalous measurements. As the number of sampled NPs increases, statistical errors decrease, therefore improving the reliability of the data and making the reported size more representative of the entire NP population. This approach also enhances the reproducibility and comparability of the results.\nThe particle size distribution histograms shown in Figure 3 illustrate the impact of sample size on the analysis of Pt NPs acquired using HAADF STEM. The histogram in Figure 3 (bottom-left) presents a particle size analysis from an image containing only 70 NPs with detection and segmentation results shown in Figure 3 (top). Figure 3 (bottom- right) represents an analysis of a larger sample of 1,080 NPs from a high-throughput analysis of 7 images. The batch image analysis of these 1,080 NPs was completed in 212.7 seconds, revealing more detailed insights into the particle size distribution. In addition to the prominent peak around 8 nm, a subtle shoulder around 15 nm and a broader peak around 20 nm in diameter are observed, as highlighted by the arrows.\nThe smaller sample size results in a less distinct histogram in Figure 3 (bottom left). It poorly identifies the peak at 8 nm and fails to capture the additional size distribution characteristics present in the larger sample. This compre- hensive analysis highlights the importance of larger sample sizes for accurately detecting and characterizing peaks in histograms, as they provide a more complete view of the NP size distribution and reduce the risk of misidentifying size characteristics.\nWhen the NPs are connected or overlapped, particularly under reactive conditions, contrast similarities become more pronounced, complicating the segmentation of NPs. Figure 4 illustrates how we tackled this issue using our two-stage approach of detection and segmentation for PtCo NPs with varying degrees of particle overlap. In this example, bounding box prompting guides SAM in localizing each NP instead of treating closely aligned NPs as a single entity. Leveraging the object detection model's ability to detect occluded objects, our AI-assisted NP analysis successfully disentangles four PtCo NPs into nine distinct NPs in a BF-TEM image. This small field of view resulted in more than a two-fold increase in the number of NPs identified on the support material.\nThe detection model's anchor box-free, multi-scale prediction architecture enables the localization of NPs with varying degrees of overlap, morphologies, and sizes. Additionally, detection parameters, such as input image size, confidence level, and IoU threshold, can be interactively adjusted during inference to adapt to a new example dataset, providing greater flexibility and compatibility while managing the precision-recall trade-off. To further enhance its applicability, we plan to incorporate a broader range of catalytic particles with diverse shapes and contrast levels into the model. With recent advances in automatic data collection, AI-assisted NP analysis is positioned to revolutionize the field of TEM for routine quantitative measurement of catalysts on a statistically relevant scale, which is not currently possible."}, {"title": "Conclusion", "content": "We present a two-stage AI-assisted particle analysis workflow that integrates a prompt generator model for identifying regions containing NPs and zero-shot learning for precise segmentation. This automated workflow enables scientists and engineers to apply it directly to their NP datasets without the need for model retraining. Our results demonstrate that the object detection model effectively detects small NPs dispersed on the catalytic support materials within a wide field-of-view of the TEM images and performs well even when NPs vary significantly in size or are overlapped. This integrated methodology improves the efficiency, reliability, and scalability of NP analysis."}, {"title": "Data Availability", "content": "Python code is publicly available at the link below."}, {"title": "Code Availability", "content": "The code for this study, including the model weights and a demonstration script, is publicly available online on GitHub S/TEM AutomatedNanoparticleAnalysis."}, {"title": "Competing interests", "content": "The authors declare no competing interests."}, {"title": "Correspondence", "content": "Correspondence and requests for materials should be addressed to ardagenc@ucsb.edu"}], "equations": [{"equation": "Precision = \\frac{TP}{TP + FP}", "context": "Precision is derived from the confusion matrix as follows:", "id": 1}, {"equation": "Recall = \\frac{TP}{TP+FN}", "context": "Recall is derived from the confusion matrix as follows:", "id": 2}, {"equation": "IoU = \\frac{TP}{TP+FP+ FN}", "context": "IoU is derived from the confusion matrix as follows:", "id": 3}, {"equation": "F1score =\\frac{2x Precisionx Recall}{Precision + Recall}", "context": "F1score  is the harmonic mean of precision and recall", "id": 4}, {"equation": "HD(A, B) = max(hd(A, B), hd(B, A))", "context": "HD definition", "id": 5}, {"equation": "hd(A, B) = max min ||a - b||_{a\u2208A  b\u2208B}", "context": "hd(A, B) definition", "id": 6}, {"equation": "hd(B, A) = max min ||a - b||_{b\u2208B  a\u2208A}", "context": "hd(B, A) definition", "id": 7}, {"equation": "MAP =  \\frac{1}{c=n} \u03a3AP_{C}", "context": "mAP definition", "id": 8}]}