{"title": "AlPatient: Simulating Patients with EHRs and LLM Powered Agentic Workflow", "authors": ["Huizi Yu", "Jiayan Zhou", "Lingyao Li", "Shan Chen", "Jack Gallifant", "Anye Shi", "Xiang Li", "Wenyue Hua", "Mingyu Jin", "Guang Chen", "Yang Zhou", "Zhao Li", "Trisha Gupte", "Ming-Li Chen", "Zahra Azizi", "Yongfeng Zhang", "Themistocles L. Assimes", "Xin Ma", "Danielle S. Bitterman", "Lin Lu", "Lizhou Fan"], "abstract": "Simulated patient systems play a crucial role in modern medical education and research, providing safe, integrative learning environments and enabling clinical decision-making simulations. Large Language Models (LLM) could advance simulated patient systems by replicating medical conditions and patient-doctor interactions with high fidelity and low cost. However, ensuring the effectiveness and trustworthiness of these systems remains a challenge, as they require a large, diverse, and precise patient knowledgebase, along with a robust and stable knowledge diffusion to users. Here, we developed AlPatient, an advanced simulated patient system with AlPatient Knowledge Graph (AIPatient KG) as the input and the Reasoning Retrieval-Augmented Generation (Reasoning RAG) agentic workflow as the generation backbone. AlPatient KG samples data from Electronic Health Records (EHRs) in the Medical Information Mart for Intensive Care (MIMIC)-III database, producing a clinically diverse and relevant cohort of 1,495 patients with high knowledgebase validity (F1 0.89). Reasoning RAG leverages six LLM powered agents spanning tasks including retrieval, KG query generation, abstraction, checker, rewrite, and summarization. This agentic framework reaches an overall accuracy of 94.15% in EHR-based medical Question Answering (QA), outperforming benchmarks that use either no agent or only partial agent integration. Our system also presents high readability (median Flesch Reading Ease 77.23; median Flesch Kincaid Grade 5.6), robustness (ANOVA F-value 0.6126, p<0.1), and stability (ANOVA F-value 0.782, p<0.1). The promising performance of the AlPatient system highlights its potential to support a wide range of applications, including medical education, model evaluation, and system integration.", "sections": [{"title": "Introduction", "content": "Simulated patient systems, also referred to as virtual patient simulation systems, have become an essential tool in modern medical education and research [1]. These systems are designed to enhance integrative learning and evaluation by incorporating basic science objectives, simulating the outcomes of clinical decisions, and including diverse cases to improve cultural competency [2\u20135]. The applications of simulated patients are broad, spanning learning, teaching, assessment, and implementation [6,7].\nWhile simulated patients are designed to be a low-risk and high-fidelity tool, there are unresolved concerns about its effectiveness and trustworthiness. Current usability evaluation of simulated patients is usually objective [8]. As a result, for example, variations of medical students' familiarity of simulated patient systems can also cause inaccuracy in SP-based medical skill evaluation [9]. Moreover, traditional evaluation of simulated patient systems often focuses more on the fact-based accuracy and utilizes inter-rater reliability-based evaluation methods that are less generalizable [10]. For instance, in psychiatric education, inherent issues with utilizing simulated patients are highlighted in connection to the essence of empathy and the distinctively interpersonal nature of the field [11], which are traditionally not the focus of simulated patient system evaluation.\nLarge Language Models (LLM) are powerful Al systems [12-14], especially renowned for their advanced reasoning capabilities [15\u201317] and medical applications [18\u201321]. LLM-based simulated patients have great potential in consistently replicating a wider range of medical conditions, simulating patient interactions, and mitigating logistical challenges associated with using human actors. Some researchers have developed frameworks and methodologies for general medical education settings [22\u201326], while others have tailored these technologies to specific use cases such as psychiatry [27,28]. While these implementations are promising, there are still critical gaps in effectiveness and trustworthiness, including (1) the lack of a large, comprehensive, and diverse patient profile database, (2) the need for fact-checking mechanisms to minimize hallucinations and ensure consistency, (3) the insufficient flexibility in taking on different personalities, and (4) the absence of a thorough evaluation framework.\nHere, we introduce AlPatient, an advanced simulated patient system with LLM-powered Reasoning Retrieval-Augmented Generation (Reasoning RAG) agentic workflow and reliable knowledge input from an AlPatient Knowledge Graph (AIPatient KG). Figure 1 illustrates the Reasoning RAG agentic workflow which improves the traditional RAG framework [29], inserting step-by-step reasoning in between. Figure 2 presents an overview of the AlPatient system, illustrating how it functions as an integrated platform. The system processes realistic data and delivers verified information in a natural language format tailored to the user's needs, particularly aligning responses with patient personalities. Additionally, it ensures continuity in the interaction by summarizing and updating the conversation history throughout the process. Our Al Patient system could benefit medical education and research applications, such as serving as simulated patients in medical student education, facilitating patient-focused evaluation on Al models, and integrating as a patient agent in multi-agent Al systems."}, {"title": "Methods", "content": "We create the patient profiles based on 1,500 sampled patient records from the Medical Information Mart for Intensive Care (MIMIC)-III database [30], containing de-identified EHRs for more than 40,000 distinct hospital admissions to critical care units at the Beth Israel Deaconess Medical Center between 2001 and 2012. Table 1 describes the demographic and clinical characteristics of patient populations in this study. This data use is approved by the PhysioNet Clinical Databases for credentialed access.\nWhen constructing the AlPatient KG, we first extract patients' symptoms, including medical history, vitals, allergies, social history and family history from the discharge summary using an LLM-based NER approach detailed in Supplementary Methods. Figure 3 presents an example of NER-based data transformation for medical entities in discharge summaries.\nThe relationships among these entities are stored in a graph database, Neo4j (AuraDB version 5) [31]. This data structure enables efficient storage, retrieval, and querying of complex relationships within the AlPatient KG. The full schema is provided in Supplementary Methods."}, {"title": "AlPatient KG construction with NER", "content": "Data use agreement of MIMIC-III strictly prohibits the use of Protected Health Information (PHI) data with online services such as GPT. To conform with data use requirements, we use the Azure OpenAl service for GPT-family LLM and Amazon Bedrock for Claude-family LLM, both not sharing data for model training [34].\nTo find the best performing model for the down-stream tasks, we use the gold-standard labeled dataset to evaluate six models' performance on the knowledge validity (NER) tasks. The models include three Claude models (Claude-3.5 Sonnet, Claude-3 Haiku, and Claude-3 Sonnet) [35] and three GPT models (GPT-4 Turbo, GPT-40, and GPT-3.5 Turbo) [36-38].\nTo perform NER tasks, we designed prompts for extracting each type of medical entity detailed in Supplementary Methods. We calculated general and medical entity category-specific True Positive Rate, False Positive Rate, Precision, Recall and F1 as follows:\n\u2022 True Positive Rate: TP/(TP + FN)\n\u2022 False Positive Rate: FP/(TN + FP)\n\u2022 Precision: TP/(TP + FP)\n\u2022 Recall: TP/(TP + FN)\n\u2022 F1: (2*Precision*Recall)/(Precision+Recall)\nHere, we specify the in-context definitions of TP, FP, TN, and FN:\n\u2022 TP: Number of instances where both LLM and gold-standard data agree a medical entity is present.\n\u2022 FP: Number of instances where LLM indicates a medical entity is present, but gold-standard data shows no medical entity.\n\u2022 TN: Number of instances where both LLM and gold-standard data agree no entity is present.\n\u2022 FN: Number of instances where LLM indicates no medical entity, but gold-standard data shows a medical entity is present."}, {"title": "LLM selection and knowledgebase validity (NER) evaluation", "content": "Figure 5 highlights a section of the AlPatient system on which we conduct the QA conversation accuracy evaluation. We conduct ablation studies for the KG Query Generation Agent in different scenarios (1) on its own, (2) in combination with the Retrieval Agent, the Abstraction Agent, or both, and (3) using zero-shot or few-shot strategy. Using an ablation study framework, there are a total of eight setups. For all setups, two researchers independently compare the retrieved results against the correct answers, and provide binary ratings of correct or incorrect. To ensure the reliability and consistency of the evaluation process, an intercoder reliability check is performed with Cohen's Kappa of 0.92 [39]. To resolve discrepancies in data labeling, we then include a third annotator, who is an experienced researcher in medical Al, to judge the annotation difference and decide the correct label. We use the accuracy rate to evaluate the model's ability to precisely and reliably answer questions based on EHRs. We define accuracy rate as the number of questions LLM answered correctly over the total number of questions."}, {"title": "QA accuracy evaluation through ablation studies", "content": "The primary goal of AlPatient is to simulate realistic patient interactions in medical training and practice. For the simulations to be effective, the output must be easily understandable by users of varying expertise, including students, trainees, and seasoned medical professionals. We focus on the output of the Rewrite Agent, and employ two metrics based on Average Sentence Length (ASL, the number of words per sentence) and Average Syllables per Word (ASW) to assess the readability of AlPatient and determine the ease of understanding for users.\nThe first metric is the Flesch Reading Ease [40], where Higher scores indicate easier readability, with a score of 90-100 suggesting text easily understood by an average 11-year-old, and scores of 30-50 indicating college-level material. Here,\n\u2022 Flesch Reading Ease =206.835-(1.015\u00d7ASL)-(84.6\u00d7ASW).\nThe second metric is the Flesch-Kincaid Grade Level [41], which estimates the U.S. school grade level required to understand the text. Lower grade levels correspond to simpler text, while higher grade levels reflect more complex material. Here,\n\u2022 Flesch-Kincaid Grade Level = (0.39\u00d7ASL)+(11.8\u00d7ASW)-15.59.\nFor each question in the QA set, we prompt the Rewrite Agent to write the answer in the context of the question. This step mimics the Rewrite process in the AlPatient framework, where the Rewrite Agent will formulate natural language responses to user's questions based on the Cypher query results. We then calculate the Flesch Reading Ease and Flesch-Kincaid Grade Level for each of the rewritten responses."}, {"title": "Readability evaluation", "content": "Robustness is a critical component of the trustworthiness of AlPatient, reflecting the system's reliability and consistency across varied inputs. To evaluate the robustness of AlPatient, we employ a methodology centered around the resilience of the system to changes in the phrasing of questions and assess the system robustness.\nEach question in the QA conversation set is paraphrased three times to create a diverse pool of queries that maintain the original intent but differ in structure and vocabulary.\nThis paraphrasing mimics the real-world scenario where different users may phrase the same clinical question in various ways.\nTo answer each paraphrased question, we invoke the Reasoning RAG framework and extract the required information from the knowledge graph. Finally, the robustness of AlPatient is assessed by comparing the accuracy of the responses generated from the paraphrased questions against the responses from the original questions (two sample t-test and ANOVA)."}, {"title": "Robustness (system) evaluation", "content": "The stability of personality in AlPatient is another vital aspect of its trustworthiness, particularly concerning the system's ability to integrate distinct personality traits into simulated patient interactions without compromising the accuracy or integrity of medical information. This evaluation focuses on ensuring that personality variations do not distort or omit essential clinical data, thereby maintaining consistency in the information presented across different simulated personalities.\nUtilizing the Big Five personality framework, we generate 32 distinct personality types by combining different levels of the five major traits. These personality profiles are then integrated into the Rewrite Agent of AlPatient. The Rewrite Agent's task is to adjust the responses generated by the system to reflect the specific personality traits of the simulated patient while answering questions from the QA set. This involves altering the tone, style, and certain expressions in the answer to align with the given personality, without altering the core medical information.\nFinally, researchers manually review the outputs to ensure that all personality-infused rewrites maintain the core information from the original answers. The primary goal is twofold:\n1. To confirm that the inclusion of personality traits in the rewrites does not lead to a loss of essential information compared to rewrites without personality traits.\n2. To check that there is no statistically significant difference in the accuracy of information across different personality groups.\nTo quantitatively assess these goals, we calculate the personality-induced data loss proportion, and employ ANOVA to test for statistical differences in the quality of information retention across the different personality profiles."}, {"title": "Stability (personality) evaluation", "content": "In Robustness and Stability evaluation, we use ANOVA to statistically determine if there are significant differences in the system's performance across various input paraphrases and personality-infused responses. Two proportion t-tests are conducted to compare the accuracy of the system's responses between the original questions and their paraphrased counterparts, and between responses generated with and without personality traits. A two-sided P \u2264 0.05 was considered statistically significant. Statistical analyses were carried out using the statistical Python package in scipy (Scipy.org). Python version 3.9.16 (Python Software Foundation) was used to carry out this work."}, {"title": "Statistical analysis", "content": "The Retrieval Agent directly queries from the AIPatient KG and extracts entities in discharge notes in MIMIC-III. Table 3 presents the statistics of entities in the AlPatient KG: there are 1,500 patient-admission records, with a total of 15,441 nodes and 26,882 edges."}, {"title": "Knowledge graph statistics", "content": "For each of the medical entity categories, we experimented with all six LLMs and evaluated their NER-based knowledgebase validity. As Table 4 shows, we observe superior knowledgebase validity for the GPT-4-Turbo model, with the highest overall F1 of 0.89. Results for TPR, FPR, Precision and Recall are presented in Supplementary Table 1-4. For the Claude family models, Claude-3.5-sonnet shows the best performance of 0.74 overall F1. We note that the GPT-family models specifically excelled in extracting Allergies, where the older version of Claude models suffered (Claude-3-haiku and Claude-3-sonnet). Based on these results, we use the GPT-4 Turbo model to construct the final version of AlPatient KG."}, {"title": "LLM selection and knowledgebase validity (NER)", "content": "In Table 5, we highlight ablation studies results across Symptom, Medical History, Family and Social History. Results of additional medical categories (Admission, Patient, Allergy, Vitals) are presented in Supplementary Table 5, where all LLM achieved a high accuracy rate regardless of the setup chosen. The setup with all agents and few-shot learning achieves the highest accuracy in most categories, with 94.15% overall accuracy. The baseline without the AlPatient KG and Reasoning RAG performs worse, particularly in Family and Social History, where accuracy drops to 13.33%.\nFigure 6(a) shows that the median Flesch Reading Ease scores range from 10.91 to 99.23 (median 68.77). Figure 6(b) indicates that the Flesch-Kincaid Grade Level peaks at 6th grade level (median grade level 6.4)."}, {"title": "QA accuracy ablation studies", "content": "The 32 personality groups have a median personality-induced data loss proportion of 2%, and range of 0% to 5.88%, indicating consistently low data loss proportion across all personality groups, with only a small range of variability.\nAs shown in Table 7, for the Overall dataset, the paraphrase group did not significantly affect the system's performance, with an F-value of 0.7820 and a p-value of 0.7990, indicating no substantial differences across personality groups. Similarly, no significant differences were observed in the Symptom (F = 1.1104, p = 0.3230) and Family and Social History (F = 0.6774, p = 0.9024) categories. For the Medical History category, no statistical test was conducted due to the lack of variation, as all personality groups achieved 100% accuracy. These results suggest that the AlPatient system maintains its stability across different simulated personalities, ensuring the integrity and consistency of the medical information presented, regardless of personality variations."}, {"title": "Readability", "content": "We developed an EHRs and LLM powered patient simulation system, the AlPatient system, that leverages the Reasoning RAG agentic workflow and the MIMIC-III-based AlPatient KG to support medical investigation in an effective and trustworthy manner. Overall, this system facilitates complex reasoning through LLM agent interactions and accurate patient information processing with NER, potentially allowing for dynamic and human-like responses to medical questions across a range of simulated patient personalities. The Reasoning RAG framework extends the current RAG strategy and optimizes system performance through stepwise and interactive agentic instructions with few-shot examples, feedback loops, and conversation history updates. The construction of the AlPatient KG prototypes a large-scale NER-based EHR processing method, which also enables LLM selection for downstream tasks. From the perspective of system assessment strategies, we further contribute comprehensive evaluation guidelines for medical NLP systems, especially useful for EHRs and LLM based multi-agent systems."}, {"title": "Stability (Personality)", "content": "The primary objective of NER is to extract structured entities from unstructured clinical notes or patient records [42]. By extracting medical entities and their interrelationships from this dataset, the AlPatient KG serves as a reliable backbone of the AlPatient system. Using a knowledge graph to preprocess and organize EHRs data offers several advantages over a traditional free text or tabular format.\nFirst, compared to the unstructured clinical notes, knowledge graphs represent a structured representation of entities and relationships. This structured approach facilitates clearer organization and retrieval of information, enabling more efficient data analysis and reasoning. Here, NERs enhance knowledge graphs by correctly key entities such as diseases and medications from unstructured clinical notes, enabling the systematic and correct organization of these entities into a structured format with a F1 score of 0.89.\nSecond, knowledge graphs allow for a more intuitive and interconnected view of data. In clinical contexts, this means easily visualizing how patients, symptoms, diseases, treatments, and outcomes are related. Users can perform more complex queries that traverse these relationships, such as finding all patients with a specific frequency who were treated with a particular medication and had certain outcomes. This relationship is less apparent in free text or tabular data.\nThird, unlike tabular data, knowledge graphs can evolve their schema without major rework. New types of entities and relationships can be added as medical knowledge and needs evolve. This is desirable specifically for the AlPatient project, as we are continuously exploring the MIMIC-III dataset for meaningful data sources and relationships.\nLastly, knowledge graphs offer concise and efficient organization and representation of information. When integrated with large language models, they mitigate catastrophic forgetting and reduce the high tokenization costs associated with processing vast amounts of information."}, {"title": "Discussion", "content": "Agentic workflow involves more interactive, iterative, and multi-step task executions rather than the traditional one-off responses to user prompts [43]. This method leverages the collective capabilities of Al agents, prompt engineering, and generative Al networks to create a dynamic environment where Al agents are not just responders but active participants in problem-solving processes [43]. The core elements of agentic workflows include self-reflection (e.g., Checker Agent), tool utilization (e.g., Abstraction and Rewrite Agents), and multi-agent collaboration, each adding layers of depth and functionality that enhance the overall effectiveness and intelligence of Al systems [44]. Our Reasoning RAG agentic framework improves accuracy and minimizes hallucination risk.\nReasoning RAG relies on abstraction and iterative checking for enhanced reasoning. The reasoning process in the RAG framework involves abstraction, where complex medical data is distilled into manageable pieces for LLMs, improving performance. Complementing this, the checking step introduces iterative self-reflection, enabling Al agents to refine their responses by cross-checking data. The dynamic interplay between the checker agent and the KG query generation agent further boosts the system's reliability and relevance in simulated medical environments, yielding an accuracy rate of over 94.15%.\nBy integrating few-shot learning and personality aspects, AlPatient delivers human-like, accessible, and context-aware generation while maintaining high system robustness and personality stability in responses to medical investigations. Notably, from Table 5, we observe a systematic improvement in accuracy with the few-shot strategy. On average, the accuracy rate increased by 11.1% after incorporating few-shot examples into the prompt. We also note that on average, accuracy is the lowest for answering social history questions. This is likely due to the result of the variety of social history representations (i.e., \u201che never smoked,\u201d \u201c3 packs a day,\" or \"quit tobacco.\u201d). High readability is another important aspect for facilitating effective learning and interaction, ensuring that medical information is conveyed clearly without overwhelming the user with overly technical language. These results highlight that the AlPatient system successfully balances the need for medical accuracy with the necessity for clear communication, making it potentially useful for both medical student training and medical system integrations."}, {"title": "Knowledge graph enables structured medical information retrieval from EHRs", "content": "While the AlPatient system currently benefits from the Reasoning RAG framework and a multi-agent workflow, further enhancements could improve user experience. In particular, we aim to develop and integrate an automatic Evaluator Agent to assist with scoring and providing feedback during medical investigations. This Evaluator Agent could reference medical textbooks and clinical guidelines, providing evidence-based assessments to ensure accuracy and alignment with current medical standards [6]. By incorporating this feature, the system could offer detailed, standardized feedback that medical students and professionals could rely on for learning and improvement.\nIn addition, our present implementation of the AlPatient KG relies heavily on discharge notes from the MIMIC-III dataset, which primarily covers critical care cases. This presents a limitation, as it lacks representation of a broader set of scenarios, including those encountered in outpatient, inpatient, and long-term care settings. Expanding the database to include EHRs from these additional domains would enhance the diversity of patient cases, offering medical students exposure to a wider range of clinical conditions. At the same time, the current dataset only covers a homogenous population from Boston, Massachusetts, which limits the generalizability of this study's results when applied to other datasets. In future work, we plan to enrich the KG by incorporating more medical entities and relationships, such as patient histories of medication use, negative reports on allergies, prescriptions, and detailed medical histories. We will also expand the current patient population in MIMIC-III to a broader population to enhance system inclusiveness. These expansions would provide a more comprehensive simulation experience, aligning better with the complex reality of patient care.\nSimilarly, the Reasoning RAG can also benefit from additional expansions, including multimodal integration, processing speed optimization, and data privacy and security. Currently, our system operates using textual data. However, the advent of multimodal large language models (MLLMs) that can process a variety of data types opens new possibilities. Future iterations of AlPatient could integrate medical images such as ECGs, X-rays, MRIs, and CT scans, allowing for a richer and more holistic patient simulation experience. By incorporating these modalities, the system could offer more realistic and comprehensive medical investigations, where both clinical notes and imaging data are used in diagnosis and treatment planning.\nAnother challenge faced by the current system is its relatively slow processing speed, caused by the need for multiple agents to operate sequentially via API calls. This results in longer wait times for completing simulations. To address this, we are exploring several optimizations. First, we plan to implement local finetuned LLM or Small Language Models (SLM) to reduce reliance on external API calls, which will enable faster, more efficient interactions. This approach will not only improve the speed of the system but also enhance the overall user experience by enabling more seamless, real-time responses. Implementing a locally-hosted model will also address concerns related to data privacy and security. By maintaining end-to-end control of the model, the system can ensure that sensitive patient information remains secure, avoiding the need to transmit data over external networks. This is especially important in clinical settings, where patient confidentiality is paramount.\nWhile our current evaluation framework is comprehensive, it can further benefit from multi-round evaluation and risk assessments. At present, the evaluation process for AlPatient is limited to single-round interactions. However, many real-world medical investigations require iterative questioning and decision-making processes. To address this, future versions of the system could include multi-round evaluations, designed with input from professionals across various medical disciplines to better reflect the nuances of their respective fields. An additional area for future research could be the assessment of risks within the system. While current evaluation methods focus on the system's application risk in accurately role-playing as patients, we must also ensure that simulated patients reflect appropriate socio-cultural contexts and realistic case scenarios. Addressing these issues could minimize the risk of significant errors and enhance the system's safety and reliability in real-world applications.\nFinally, future work is needed to understand the comfort and concerns of trainees, physicians, and patients regarding the implementation of such generative Al systems in clinical education and practice. Although the AlPatient system offers significant enhancements to medical training, the integration of Al in sensitive healthcare contexts brings potential ethical, psychological, and professional considerations. For instance, medical trainees and practitioners may have concerns about the system's impact on their learning process, the accuracy and reliability of Al-provided feedback, and the potential replacement of traditional training methods. Similarly, patients may have reservations about Al's involvement in simulated clinical scenarios and how it might influence care quality. To address these aspects, future research should explore user experiences and gather feedback from trainees, clinicians, and patients, ensuring that the system evolves in a way that aligns with the expectations and comfort levels of all stakeholders involved."}, {"title": "LLM Agentic workflow with abstractive and self-reflective reasoning enhances medical QA accuracy and realism", "content": "We enable these strategies when constructing the prompts for optimizing the performance of various agents within the system. These strategies support better interaction and more accurate retrieval, generation and simulation of patients.\n1. Role specification [46]: Role specification is often used to set context for the task at hand. In the case of biomedical domains, defining the model's role as a biomedical researcher helps guide the LLMs to focus on relevant terms and relationships specific to that domain. Using predefined roles aligns with studies showing that role-specific context boosts performance in biomedical text mining and entity recognition.\n2. Few-shot [47,48]: We include a few examples in the prompts, which allow the models to generalize effectively by drawing on prior knowledge. This approach significantly reduces the need for large volumes of annotated medical data while still maintaining high accuracy in tasks like entity recognition and relationship extraction.\n3. XML-style tag [49,50]: To improve entity extraction and relationship mapping, we employ XML-style tagging in our prompts. This structured format ensures that the output is both readable and easily processed."}, {"title": "Limitations and future work", "content": "AIPatient KG is constructed from the medical entities (nodes) and relationships (edges) extracted from the unstructured clinical notes. Relationships illustrate how entities are interconnected, such as \"patient has certain symptoms\" and \"disease has specific duration.\" These extractions are based on an LLM powered NER approach, using GPT-4 model. In particularly, we use prompts with the following characteristics:"}, {"title": "Prompt Engineering Strategy", "content": "The full schema of the AlPatien KG is as follows. This schema is included in the prompt to allow agents to effectively query and retrieve relevant EHR data from the knowledge graph."}, {"title": "NER Prompt Engineering Details", "content": "Retrieval Agent Details\n\u2022 conversation_history: summarized conversation history between AlPatient and user. For example: Patient ID 23709 (Admission ID 182203) initially reported black and bloody stools. The patient has a complex medical history including depression, heart and brain issues, stomach troubles, and previous falls with broken bones. When asked about allergies, the patient disclosed an allergy to SSRI medications but expressed reluctance to discuss it further. The current context relates to the patient's allergy history.\n\u2022 user_query: the input query from the user. For example: \"Can you tell me your symptoms?\"\n\u2022 schema: the general structure of the knowledge graph, including node properties and relationships, as specified in the supplementary methods of AlPatient KG Schema. For example: Patient node has properties: SUBJECT_ID, GENDER, AGE, ETHNICITY, RELIGION, MARITAL_STATUS; relationship: FamilyMember -> FamilyMedicalHistory: HAS_MEDICAL_HISTORY"}, {"title": "AlPatient KG Schema", "content": "Abstraction Agent Details\n\u2022 user query: the input query from the user. For example: \u201cCan you tell me your symptoms?\"\n\u2022 conversation_history: summarized conversation history between AlPatient and user. For example: Patient ID 23709 (Admission ID 182203) initially reported black and bloody stools. The patient has a complex medical history including depression, heart and brain issues, stomach troubles, and previous falls with broken bones. When asked about allergies, the patient disclosed an allergy to SSRI medications but expressed reluctance to discuss it further. The current context relates to the patient's allergy history."}, {"title": "Retrieval Agent Details", "content": "KG Query Generation Agent Details\nAn example of cypher query generation prompt (with few-shot, abstraction agent, and retrieval agent input) is listed below:\n\u2022 subject_id: unique patient identifier\n\u2022 hadm_id: unique admission identifier\n\u2022 nodes_edges: output of the Retrieval Agent, contains relevant nodes and edges for constructing the cypher query. For example: {'Nodes': ['Allergy'], 'Relationships': ['HAS_ALLERGY']}\n\u2022 conversation history: summarized conversation history between AlPatient and user. For example: Patient ID 23709 (Admission ID 182203) initially reported black and bloody stools. The patient has a complex medical history including depression, heart and brain issues, stomach troubles, and previous falls with broken bones. When asked about allergies, the patient disclosed an allergy to SSRI medications but expressed reluctance to discuss it further. The current context relates to the patient's allergy history.\n\u2022 user_query: the input query from the user. For example: \"Can you tell me your symptoms?\"\n\u2022 schema: the general structure of the knowledge graph, including node properties and relationships, as specified in the supplementary methods of AIPatient KG Schema. For example: Patient node has properties: SUBJECT_ID, GENDER, AGE, ETHNICITY, RELIGION, MARITAL_STATUS; relationship: FamilyMember -> FamilyMedicalHistory: HAS_MEDICAL_HISTORY\n\u2022 abstraction_context: output of the Abstraction Agent, contains step-back context. For example, when the user ask about whether the patient has fever, the step back context is a list of all the symptoms the patient has."}, {"title": "Abstraction Agent Details", "content": "Checker Agent Details\nAn example of Checker Agent prompt is provided below:\n\u2022 user_query: the input query from the user. For example: \"Can you tell me your symptoms?\"\n\u2022 conversation_history: summarized conversation history between AlPatient and user. For example: Patient ID 23709 (Admission ID 182203) initially reported black and bloody stools. The patient has a complex medical history including depression, heart and brain issues, stomach troubles, and previous falls with broken bones. When asked about allergies, the patient disclosed an allergy to SSRI medications but expressed reluctance to discuss it further. The current context relates to the patient's allergy history.\n\u2022 query_result: extracted result from AlPatient KG based on the user_query. For example, ['black and bloody stools', 'lightheadedness', 'shortness of breath'] for the user query: \"what symptoms do you have?\u201d"}, {"title": "KG Query Generation Agent Details", "content": "Rewrite Agent Details\nThis rewrite agent includes five broad dimensions: openness, conscientiousness, extraversion, agreeableness, and neuroticism. Each patient is assigned specific traits within these dimensions to create a realistic and relatable personality profile. For example, a patient with personality traits of \u201csensitive/nervous\u201d in the neuroticism category might repeatedly ask for reassurance about their condition and treatment plan, and another with \"friendly/compassionate\u201d in the agreeableness category might be open to engaging in more detailed conversations and expressing gratitude for the care provided. An example of Rewrite Agent prompt is provided below:\n\u2022 personality: the selected Big Five personality profile. It is a combination of five dimensions including: extraversion, agreeableness, openness, conscientiousness, and neuroticism. An example of one personality profile is [Practical, conventional, prefers routine, Impulsive, careless, disorganized, Quiet, reserved, withdrawn, Critical, uncooperative, suspicious, Calm, even-tempered, secure]\n\u2022 user_query: the input query from the user. For example: \u201cCan you tell me your symptoms?\"\n\u2022 conversation_history: summarized conversation history between AlPatient and user. For example: Patient ID 23709 (Admission ID 182203) initially reported black and bloody stools. The patient has a complex medical history including depression, heart and brain issues, stomach troubles, and previous falls with broken bones. When asked about allergies, the patient disclosed an allergy to SSRI medications but expressed reluctance to discuss it further. The current context relates to the patient's allergy history.\n\u2022 query_result: extracted result from AlPatient KG based on the user_query. For example, ['black and bloody stools', 'lightheadedness', 'shortness of breath'] for the user query: \"what symptoms do you have?\""}, {"title": "Checker Agent Details", "content": "Summarization Agent Details\n\u2022 conversation_history: summarized conversation history between AlPatient and user. For example: Patient ID 23709 (Admission ID 182203) initially reported black and bloody stools. The patient has a complex medical history including depression, heart and brain issues, stomach troubles, and previous falls with broken bones. When asked about allergies, the patient disclosed an allergy to SSRI medications but expressed reluctance to discuss it further. The current context relates to the patient's allergy history.\n\u2022 query_result: extracted result from AlPatient KG based on the user_query. For example, ['black and bloody stools', 'lightheadedness', 'shortness of breath'] for the user query: \"what symptoms do you have?\"\n\u2022 patient_response: natural language response from the simulated patient. For example: \"Yes, I am over 50. But why does that matter right now? I prefer to stick to the routine questions we usually go through. And honestly, I don't see how my age is relevant to what we're discussing today. Can we move on to something more practical?\""}, {"title": "Rewrite Agent Details", "content": "Supplementary Tables"}, {"title": "Summarization Agent Details", "content": "Prompt Engineering Strategy\nWe enable these strategies when constructing the prompts for optimizing the performance of various agents within the system. These strategies support better interaction and more accurate retrieval", "46": "Role specification is often used to set context for the task at hand. In the case of"}]}