{"title": "RAPTOR: Refined Approach for Product Table Object Recognition", "authors": ["Eliott THOMAS", "Mickael COUSTATY", "Aur\u00e9lie JOSEPH", "Gaspar DELOIN", "Elodie CAREL", "Vincent POULAIN D'ANDECY", "Jean-Marc OGIER"], "abstract": "Extracting tables from documents is a critical task across various industries, especially on business documents like invoices and reports. Existing systems based on DEtection TRansformer (DETR) such as TAble Transformer (TATR), offer solutions for Table Detection (TD) and Table Structure Recognition (TSR) but face challenges with diverse table formats and common errors like incorrect area detection and overlapping columns. This research introduces RAPTOR, a modular post-processing system designed to enhance state-of-the-art models for improved table extraction, particularly for product tables. RAPTOR, addresses recurrent TD and TSR issues, improving both precision and structural predictions. For TD, we use DETR (trained on ICDAR 2019) and TATR (trained on PubTables-1M and FinTabNet), while TSR only relies on TATR. A Genetic Algorithm is incorporated to optimize RAPTOR's module parameters, using a private dataset of product tables to align with industrial needs. We evaluate our method on two private datasets of product tables, the public DOCILE dataset (which contains tables similar to our target product tables), and the ICDAR 2013 and ICDAR 2019 datasets. The results demonstrate that while our approach excels at product tables, it also maintains reasonable performance across diverse table formats. An ablation study further validates the contribution of each module in our system.", "sections": [{"title": "1. Introduction", "content": "Efficient extraction of tabular data is crucial across various industries, particularly in business applications where tables are commonly used to present structured information such as sales figures and financial performance. Two key processes are involved in extracting information from these tables: TD, which identifies table boundaries, and TSR, which defines the internal layout of rows, columns and headers. Accurately detecting and extracting table content remains a challenging task due to the diversity of table formats and the limited availability of annotated datasets, especially for business tables, which often contain proprietary data.\nAmong the various types of tables, product tables are specialized formats that include data such as product names, descriptions, prices, and supplier information. These tables are essential for inventory management, order processing, and strategic decision-making. In this work, we specifically focus on simple product tables, which do not include complicated structures such as spanning cells [3].\nGiven the scarcity of annotated business documents for privacy reasons, fine-tuning existing models is challenging. Thus, we utilize pretrained models on public datasets: DETR is pretrained on ICDAR 2019 for TD, and TATR is pretrained on Pubtables-1M and FinTabNet for both TD and TSR [2, 6, 20, 26]. The goal of our modular method is to provide an alternative to fine-tuning when only a limited amount of training data is available. To achieve this, we apply a Genetic Algorithm to learn the parameters of our modules using a very limited amount of private data. This modular strategy allows us to leverage the strengths of different models while tailoring our approach to specific challenges in table extraction.\nWe evaluate RAPTOR on five datasets, including two private and three public ones: ICDAR 2013, ICDAR 2019, and a curated subset of the DocILE dataset [6, 7,24], which we release publicly for table extraction tasks. Our re-"}, {"title": "2. Related Work", "content": "Table extraction from documents has been a longstanding research topic, with early surveys like Zanibbi et al. [25] highlighting its significance. While image-based models like Faster R-CNN [17] have been employed, they often underperform due to the unique characteristics and variability of tables [20]. Alexiou et al. [1] provide a succinct review of traditional table detection methods, categorizing them into heuristic, deep learning, and hybrid approaches. Rujiao et al. introduce the WTW dataset [12] to address realistic scenarios, such as images of documents taken in real-world conditions-like photos of papers, screenshots, or scanned documents with various distortions, including perspective warping and blurring. However, our approach assumes access to deskewed scanned documents paired with OCR technologies. We use ABBYY OCR for our private data and DocTR [13] for public datasets.\nWe leverage DETR [2], which merges a CNN backbone for feature extraction with a transformer architecture to model global context. This innovative architecture mitigates the need for post-processing steps like Non-Maximum Suppression (NMS) by employing a bipartite matching loss during training. For our table detection tasks, we utilize DETR-19, trained specifically on the ICDAR 2019 dataset. Alongside it we used Table Transformer (TATR), an extension of DETR fine-tuned on table-specific datasets like PubTables-1M [20] and FinTabNet [26]. This combination enhances our ability to detect tables across diverse document layouts."}, {"title": "2.1. Table Detection (TD)", "content": "Table extraction from documents has been a longstanding research topic, with early surveys like Zanibbi et al. [25] highlighting its significance. While image-based models like Faster R-CNN [17] have been employed, they often underperform due to the unique characteristics and variability of tables [20]. Alexiou et al. [1] provide a succinct review of traditional table detection methods, categorizing them into heuristic, deep learning, and hybrid approaches. Rujiao et al. introduce the WTW dataset [12] to address realistic scenarios, such as images of documents taken in real-world conditions-like photos of papers, screenshots, or scanned documents with various distortions, including perspective warping and blurring. However, our approach assumes access to deskewed scanned documents paired with OCR technologies. We use ABBYY OCR for our private data and DocTR [13] for public datasets.\nWe leverage DETR [2], which merges a CNN backbone for feature extraction with a transformer architecture to model global context. This innovative architecture mitigates the need for post-processing steps like Non-Maximum Suppression (NMS) by employing a bipartite matching loss during training. For our table detection tasks, we utilize DETR-19, trained specifically on the ICDAR 2019 dataset. Alongside it we used Table Transformer (TATR), an extension of DETR fine-tuned on table-specific datasets like PubTables-1M [20] and FinTabNet [26]. This combination enhances our ability to detect tables across diverse document layouts."}, {"title": "2.2. Table Structure Recognition (TSR)", "content": "Graph-based methods were once promising for table extraction due to their ability to model relationships between table elements. Techniques by Riba et al. [19], Zheng et al. [26], and Li et al. [11] used Graph Neural Networks (GNNs) to capture the structure of tables. However, they no longer offer state-of-the-art (SOTA) results, having been surpassed by deep learning models like DETR and TATR, which excel at directly predicting table boundaries and structures. TableNet provides an end-to-end solution for table detection and structure recognition by highlighting text zones with different colors based on their type, as shown in Paliwal et al. [14]. Similarly, Prasad et al. [15] use the image-based CascadeTabNet, which employs iterative transfer learning and data augmentation to enhance performance. Rashid et al. [16] introduce a hybrid method (image and text) that predicts whether segments of a document are inside or outside of tables, enhancing accuracy by averaging predictions with their neighbors.\nFor table structure recognition, we used TATR [20] as well. TATR for TSR is designed to capture the structural relationships within tables, such as rows and columns, making it highly effective for TSR tasks. By using TATR in both TD and TSR, we ensure a comprehensive approach that leverages its strengths to effectively tackle the challenges of table extraction in real-world scenarios."}, {"title": "2.3. Challenges in Business Table Extraction", "content": "Despite significant advancements in table extraction, a notable gap exists in research focused on business tables, particularly product tables. Business tables, as seen in datasets like DocILE [24](Section 4), encompass a variety of data types, such as product details or invoices. They often exhibit considerable noise, with content added arbitrarily and inconsistent spacing between lines, complicating the extraction process. In contrast, datasets like FinTabNet [26] specifically target financial documents, which are typically clean and well-structured, focusing on numerical metrics and financial reporting.\nOur analysis of common errors in Table 1 on the Business (private) dataset shows a high prevalence of TD errors, often due to business-specific elements resembling tables, like tax indications. To address these issues, we propose a post-processing method with corrective modules targeting frequent TD and TSR errors. These modules, optimized using a Genetic Algorithm (GA) [8], improve accuracy after the initial model predictions. This approach contrasts with Le Vine et al.'s method [23], which uses GA and Conditional Generative Adversarial Networks (CGAN) [9] to generate table structures directly. We anticipate that our method will generalize well to other public business datasets, such as DocILE, due to their shared domain. In contrast, errors from the ICDAR 2019 dataset highlight the varied challenges across different document types."}, {"title": "3. Methodology", "content": "Our pipeline (see Figure 2), integrates modular components to enhance both TD and TSR. For TD, we employ an ensemble approach that combines predictions from the DETR and TATR models to identify table regions within documents. These initial detections are further refined through dedicated TD modules. Once the table region is confirmed, the TSR task is carried out using the TATR model, with additional refinement modules improving table structure recognition. This flexible, modular design allows the pipeline to adapt to different baseline models and dataset-specific needs."}, {"title": "3.1. Table Detection refinement", "content": "The TD task aims to extract the overall table area. However, when this area is processed by the TSR model, it assumes that all content within the detected boundary is relevant. This is often valid for ICDAR datasets, but business tables frequently contain additional elements, such as empty spaces and noise. Thus, TD refinement adjusts the detected boundaries to better fit the smallest bounding box containing only the essential content for TSR."}, {"title": "3.1.1 Table Chooser", "content": "RAPTOR utilizes a Table Chooser module to refine candidate regions identified by the TD baseline (the ensemble of DETR and TATR models). Given the monotable context, where only one table needs to be selected, we cannot rely solely on the confidence scores of the predictions. Detectors may erroneously predict table-like objects with higher confidence than the actual table. Our Table Chooser identifies the bounding box that most likely represents a table in the document image.\nInitially, candidate regions with confidence scores above a threshold \u03b1 are considered. The selection process employs a multi-feature evaluation strategy, incorporating prediction confidence, geometric properties (area, width, and height), and textual content analysis. The textual analysis uses the Levenshtein distance [10] to compare candidates against a dictionary of potential table headers generated by ChatGPT 3.5 from the provided examples.\nThe module also focuses on header location within the bounding box, with a greater concentration towards the top indicating a higher likelihood of being a table. It assigns scores to each bounding box and selects the highest-scoring one for further processing. This module is crucial for resolving the \"Wrong table detected\" issue (noted in Table 1), which frequently arises in our datasets due to single tables being surrounded by table-like entities. The detailed dictionary used for textual analysis is available in the Data Repository."}, {"title": "3.1.2 Header Refiner", "content": "The Header Refiner module enhances the bounding box selected by the Table Chooser to ensure the top portion accurately represents the table header. This iterative process checks for content above the header, including content alignment (left or right), common header keywords, and stopwords that should not appear in headers. If any checks raise concerns about the top area, the module crops the bounding box until a valid header is identified. This refinement ensures that subsequent processing in the RAPTOR pipeline focuses on accurate table header recognition, effectively addressing the \"Noise detected above\" issue noted in Table 1."}, {"title": "3.1.3 Oversegmentation management", "content": "This module addresses the \"Noise detected below\" issue from Table 1. RAPTOR introduces the oversegmentation module which uses DBSCAN clustering [4] to group words by their y-coordinates, estimating horizontal lines. X-axis and XY-axis clustering techniques are applied to detect column position outliers and overall table structure. RAPTOR analyzes the sequence of clusters to identify the most frequent pattern, representing the \"core table line\". Starting from the bottom of the table, each line receives a suspiciousness score based on the number of outliers and its deviation from the core pattern (using Levenshtein distance [10]). Suspicious lines are removed, and the bounding box is adjusted upward until a non-suspicious core line is reached."}, {"title": "3.2. Table Structure Recognition refinement", "content": "In the TSR task, our goal is to accurately interpret content within the detected table area. However, the complexity of business tables, often characterized by noise and inconsistent formatting, can lead to inaccuracies when directly transferring data from the TD model. To improve the quality of table structures, we implement refinement techniques that resolve common issues such as overlapping columns, unfused lines, and extraneous lines."}, {"title": "3.2.1 Overlapping columns", "content": "The Overlapping Columns module helps mitigate the \"Segmentation error\" issue from Table 1. RAPTOR detects overlapping columns using the Intersection-over-Union (IoU) metric [5]. When columns with an IoU greater than a specified threshold \u03b8\u03bf\u03c5 are detected, RAPTOR compares the number of header words (identified by the TATR model) in each column and selects the one with the most headers"}, {"title": "3.2.2 Unfuse Lines", "content": "In tables, rows may sometimes include multiline entries, such as lengthy comments or descriptions. The Unfuse Lines module in RAPTOR addresses the \"Fused Lines\" issue identified in Table 1. This module focuses specifically on cases where cells within a row contain multiple amounts. It detects and separates these merged rows into distinct entities. Additionally, the module employs spatial coordinates to split other cells within the same row."}, {"title": "3.2.3 Remove Extra Lines", "content": "This approach helps mitigate the \"Segmentation error\" and \"Noise detected below\" issues identified in Table 1. It eliminates lines from the bottom of the table that do not conform to expected alignment or data type similarities. Additionally, we check whether the last lines are too far from the rest of the table by measuring the space between lines. If the gap exceeds \u03b2 times the largest height among the predicted lines, those lines are flagged and removed."}, {"title": "3.3. Genetic Algorithm Process", "content": "Genetic Algorithms (GAs) are optimization techniques inspired by natural selection [8]. In our methodology, we applied a GA to optimize RAPTOR's parameters using a refinement dataset similar to our target data. We initialized a population of candidate solutions, each representing a set of module parameters. The GA evolved this population over several generations, optimizing based on the F1 score from GRITS-CON [21]. Key evolutionary mechanisms included elitism, crossover, and mutation, with the best-performing individual from the final generation defining the new parameters for RAPTOR."}, {"title": "4. Evaluation protocol", "content": "In our evaluation of RAPTOR's performance, we used various metrics. For TD, we employed Purity and Completeness [7]: Purity measures the proportion of predicted tables whose elements are fully contained within ground truth (GT) tables, while Completeness assesses the predicted tables that encompass all GT elements. Additionally, we applied the Generalized Intersection over Union (GIoU) [18], which extends traditional IoU by considering predictions without overlap, ranging from -1 to 1. For TSR, we selected GRITS, which overcomes limitations of previous metrics, as noted in [21], specifically GRITS-CON to compare cell content between GT and predicted tables."}, {"title": "4.1. Metrics", "content": "In our evaluation of RAPTOR's performance, we used various metrics. For TD, we employed Purity and Completeness [7]: Purity measures the proportion of predicted tables whose elements are fully contained within ground truth (GT) tables, while Completeness assesses the predicted tables that encompass all GT elements. Additionally, we applied the Generalized Intersection over Union (GIoU) [18], which extends traditional IoU by considering predictions without overlap, ranging from -1 to 1. For TSR, we selected GRITS, which overcomes limitations of previous metrics, as noted in [21], specifically GRITS-CON to compare cell content between GT and predicted tables."}, {"title": "4.2. Inference Datasets", "content": "We evaluate our approach using public datasets for reproducibility and benchmark comparisons, along with two private datasets to better reflect real-world scenarios. These datasets are described in Table 2 and Figure 3."}, {"title": "4.2.1 Public datasets : ICDAR 2013, ICDAR 2019 and DocILE", "content": "We used the corrected ICDAR 2013, ICDAR 2019, and a subset of the DocILE dataset. Each dataset benchmarks RAPTOR's performance against established standards, ensuring the generalizability and reproducibility of our results.\nThe ICDAR 2013 dataset [7] is a well-known benchmark for TD and TSR. We utilized the corrected 2023 version available on Hugging Face [22], which addresses the original dataset's limitations through manual corrections and automated techniques for consistency with other TSR datasets, like PubTables-1M [20]. To better reflect our target documents, which have very few spanning cells, we employed a simplified version of the ICDAR 2013 dataset. We used the competition and non-competition splits from the corrected dataset [22] and performed additional preprocessing by removing all tables with spanning cells and excluding any document pages that no longer contained tables after this filtering.\nFor a more challenging evaluation, we utilized the ICDAR 2019 dataset [6], specifically the test set for modern tables. We used this dataset unaltered, as its small size and inherent complexity rigorously test RAPTOR's capabilities. The documents contain intricate table structures that differ significantly from the product-oriented tables in our private dataset, making ICDAR 2019 the most demanding benchmark for general table extraction. Additionally, since the original dataset lacks textual annotations, we applied the DOCTR OCR to extract text from the document images.\nLastly, we utilized a subset of the DocILE dataset [24], which contains business documents like invoices, closely aligning with our private dataset. This makes it a valuable reference for researchers testing similar document types. It's important to note that the DocILE dataset was not initially designed for tables, so we carefully selected the 86 documents where all columns were annotated, headers were present, and no hierarchical headers or overlapping cells existed."}, {"title": "4.2.2 Private datasets : Business and Statements", "content": "This section outlines the datasets used to evaluate RAPTOR's effectiveness in extracting tables from real-world customer documents.\nThe Business dataset includes tables from business files such as invoices and product detail lists. It focuses on simple tables with well-defined structures, avoiding spanning cells, overlapping, or hierarchical headers. A semi-automatic approach was used for its creation: initial table predictions from the baseline pipeline (top of Figure 2) were manually reviewed and refined by annotators. The entire process (creation, annotation by two annotators, and verification by four), took approximately 20 hours. Figure 1 displays an example of the business dataset. The rest of the document is similar to the DocILE example (Figure 3c).\nThe Statements dataset was created similarly to maintain consistent annotation and quality, containing tables from statements such as invoice lists."}, {"title": "4.3. Refinement Dataset", "content": "We used a small Refinement dataset with a structure similar to the Statements dataset. This set was exclusively for parameter tuning using Genetic Algorithms (GA) and for fine-tuning the baseline models in our experiments."}, {"title": "5. Experiments and results", "content": "RAPTOR's performance is evaluated across various datasets (see Section 4) against the baseline with all modules disabled. We assess improvements in Table Detection and Table Structure Recognition, conducting an ablation study on the statements dataset to isolate the impact of each refinement. The GA was trained on a subset of 50 documents from the Refinement Dataset, simulating limited training data availability. Results include averages per method with 95% confidence intervals. Parameter values used are \u03b1 = 0.5, \u03b2 = 3, and \u03b8iou = 0.34."}, {"title": "5.1. Table Detection", "content": "The baseline we use for comparison is based on TATR and DETR trained on ICDAR 2019, as referenced in Section 2. This baseline operates by taking the predictions from both models, utilizing only their confidence scores to determine the final output. In contrast, we introduce RAPTOR, which enhances these predictions by incorporating refinement modules. To evaluate the performance of both approaches, we employed three metrics: Completeness [7], Purity [7], and GIoU [18]. This structured comparison enables a clear assessment of the effectiveness of our RAPTOR refinements over the baseline system.\nQuantitative results in Table 3 indicate that our method consistently outperforms or matches the baseline in Purity across all datasets. However, the baseline slightly outperforms our approach in Completeness. While GIoU scores are comparable, the baseline shows a negative average GIoU for the Business dataset, reflecting frequent predictions without overlap with the GT. This evaluation highlights RAPTOR's effectiveness in enhancing TD purity across diverse datasets, although the baseline maintains slightly higher completeness overall."}, {"title": "5.2. Table Structure Recognition", "content": "For the TSR experiments, we utilized TATR as the baseline model, as referenced in the previous section. This task follows the TD step, using the outputs from the TD task as input, creating a more realistic scenario. RAPTOR builds on this by incorporating additional refinement modules (Section 3). We employed Precision, Recall, and F1 metrics from GRITS-CON [21] to evaluate cell content.\nIn Table 4, RAPTOR demonstrates significant improvements in business datasets (Statements, Business, and DOCILE), although there is a slight decrease in Recall on the Business dataset. Performance declines on ICDAR-13 and ICDAR-19, particularly in Recall, likely due to the modules reducing the number of predictions by removing too much content.\nOverall, RAPTOR meets its objectives by maintaining performance across datasets while enhancing outcomes on targeted product tables. The ablation study on the Statements dataset, shown in Table 5, confirms the importance of each refinement. Removing any component results in decreased precision and recall, underscoring their collective significance in RAPTOR's architecture."}, {"title": "5.2.1 Impact of RAPTOR Modules on Fine-Tuned Models", "content": "The goal of our modular method is to provide an alternative to fine-tuning when only a limited amount of training data is available. Throughout this work, we assume the availability of only 50 training documents, similar to the Statement dataset. Our comparison in Table 4 reveals a limitation of fine-tuning: when applied to such a small dataset, it does not significantly enhance performance. Specifically, while we observe a 15-point increase in precision, there is also a 20-point drop in recall for the Baseline model. This table highlights the value of our modular approach, which consistently improves performance across all metrics, even when fine-tuning is employed. Thus, our method not only serves as a viable alternative to fine-tuning but also complements it, providing consistent improvements in model outputs when applied to product tables."}, {"title": "5.3. Computational details", "content": "The average processing time per document is 0.94 \u00b1 0.05 seconds for the baseline system and 1.50 \u00b1 0.15 seconds for the RAPTOR pipeline, adding approximately 0.56 seconds per document. The Genetic Algorithm training utilized parallelism, taking around 23 hours. For fine-tuning, the average training time was about 10 seconds per epoch; the TD models were trained for 250 epochs each, while the TSR model underwent 500 epochs, all on an Nvidia RTX A6000."}, {"title": "6. Limitations", "content": "RAPTOR achieves strong precision for business documents but struggles with recall on ICDAR-13 and ICDAR-19 datasets [6, 7]. This stems from its optimization for product tables, which differ from the general tables in these datasets. The noise-removal modules, effective in business contexts, may exclude valid elements in \"out-of-scope\" tables, reducing recall. Additionally, the system's design assumes single-table inputs by selecting only the highest-scoring bounding box for processing, which limits its application in multi-table documents. The approach's heavy dependence on business document characteristics also constrains its generalizability, requiring significant adjustments for deployment in different domains."}, {"title": "7. Conclusion", "content": "This paper introduces RAPTOR, a modular system designed to enhance product table extraction from business documents by integrating deep learning for table extraction with specialized modules to address noise and structural errors. By refining parameters using Genetic Algorithms, RAPTOR effectively operates with minimal data. Users can analyze error types and activate relevant modules to improve performance on specific document types.\nEvaluations indicate that RAPTOR accurately locates business tables and recognizes their structures while minimizing false positives, which is essential in finance, accounting, report generation, and legal contexts. Additionally, RAPTOR automates table extraction, improving decision-making, productivity, and cost efficiency across various industries. Future work will focus on expanding dataset coverage and enhancing robustness."}]}