{"title": "Physically Parameterized Differentiable MUSIC for DoA Estimation with Uncalibrated Arrays", "authors": ["Baptiste Chatelier", "Jos\u00e9 Miguel Mateos-Ramos", "Vincent Corlay", "Christian H\u00e4ger", "Matthieu Crussi\u00e8re", "Henk Wymeersch", "Luc Le Magoarou"], "abstract": "Direction of arrival (DoA) estimation is a common sensing problem in radar, sonar, audio, and wireless communication systems. It has gained renewed importance with the advent of the integrated sensing and communication paradigm. To fully exploit the potential of such sensing systems, it is crucial to take into account potential hardware impairments that can negatively impact the obtained performance. This study introduces a joint DoA estimation and hardware impairment learning scheme following a model-based approach. Specifically, a differentiable version of the multiple signal classification (MUSIC) algorithm is derived, allowing efficient learning of the considered impairments. The proposed approach supports both supervised and unsupervised learning strategies, showcasing its practical potential. Simulation results indicate that the proposed method successfully learns significant inaccuracies in both antenna locations and complex gains. Additionally, the proposed method outperforms the classical MUSIC algorithm in the DoA estimation task.", "sections": [{"title": "I. INTRODUCTION", "content": "Direction of arrival (DoA) estimation refers to the angular estimation of a wavefront impinging on a sensor array. In modern wireless communication systems, DoAs are used for a wide variety of tasks: localization, target tracking, beamforming, or interference management [1], [2]. The growing interest in integrated sensing and communication (ISAC), where sensing and communication are jointly performed, has further reinforced the need of efficient DoA estimation. Classically, model-based algorithms have been proposed to solve the DoA estimation problem [3]\u2013[7]. While the use of subspace methods such as multiple signal classification (MUSIC) [3], or estimation of signal parameters via rotational invariance techniques (ESPRIT) [6] allows to increase estimation performance, such methods are sensitive to hardware impairments. Several studies have been carried out to assess the impact of hardware impairments on wireless communication performance [8]-[12], but also on sensing performance [13]\u2013[15].\nMachine learning has recently emerged as an alternative to classical signal processing methods in many fields of wireless communication [16], [17], including beamforming [18], channel estimation [19], localization [20] or decoding [21]. However, such ML approaches can be seen as black boxes, leading to minimal interpretability of the learned system. Alternatively, the model-based machine learning paradigm [22], [23] offers increased interpretability in the learned structure, as models from signal processing are used to structure and initialize neural architectures. This paradigm has been employed in several communication problems: channel estimation [24], [25], precoding [26], beam prediction [27], detection [28], and also in ISAC design [29], [30].\nContributions. It is proposed to tackle the joint DoA estimation and hardware impairments learning problem following the model-based machine learning paradigm. In this paper, the use of a differentiable MUSIC (diffMUSIC) algorithm for antenna array location inaccuracies and complex gains impairments learning is studied. This differentiable version of the classical MUSIC algorithm is achieved by replacing the non-differentiable argmax step by a convex combination of DoAs. Additionally, supervised and unsupervised learning strategies are presented. Experiments conducted on synthetic data against several baselines demonstrate the effectiveness of the proposed method. It is shown that the proposed method is able to compensate for significant antenna array impairments. Specifically, impairments are considered on both the location and complex gain of each radiating elements composing the antenna array."}, {"title": "II. PROBLEM FORMULATION", "content": "A uniform linear array (ULA) composed of N antennas with half-wavelength spacing is considered. The presented approach can be straightforwardly extended to any given antenna array geometry. $M < N$ non-coherent far-field sources are impinging the array. Measurements are carried out over T snapshots:\n$X = A_\\zeta (\\theta) S + N$,\nwhere $X \\in \\mathbb{C}^{N \\times T}$ corresponds to the measured signals, and $\\theta \\in [-\\pi/2, \\pi/2]^M$ represents the sources DoAs. The narrowband sources signals are defined as $S = \\{s_i\\}_{i=1}^M \\in \\mathbb{C}^{M\\times T}$, such that $s_i \\sim \\mathcal{CN} (0_M,\\sigma_s^2 I_M)$. The sensing noise $N = \\{n_i\\}_{i=1}^T \\in \\mathbb{C}^{N\\times T}$ is defined such that $n_i \\sim \\mathcal{CN} (0_N, \\sigma_n^2 I_N)$. $A_\\zeta(\\theta) = \\{a_\\zeta(\\theta_i)\\}_{i=1}^M$ is a steering matrix defined as:\n$A_\\zeta (\\theta) = \\begin{bmatrix} \\frac{g_1e^{-jp_1u(\\theta_1)}}{\\|g\\|_2} & \\cdots & \\frac{g_1e^{-jp_1u(\\theta_M)}}{\\|g\\|_2}\\\\ \\vdots & \\ddots & \\vdots \\\\ \\frac{g_Ne^{-jP_Nu(\\theta_1)}}{\\|g\\|_2} & \\cdots & \\frac{g_Ne^{-jP_Nu(\\theta_M)}}{\\|g\\|_2} \\end{bmatrix}$\nwhere $g = \\{g_i\\}_{i=1}^N \\in \\mathbb{C}^N$ represents the complex antenna gains, $p_i \\in \\mathbb{R}$ is the location of the ith antenna along the array axis, and $u(\\theta_i) = cos(\\theta_i)$. Finally, $\\zeta = \\{\\{g_i\\}_{i=1}^N, \\{p_i\\}_{i=1}^N\\}$ corresponds to a physical parametrization of the array manifold. \nThe DoA estimation problem can be seen as follows: can the DoAs $\\theta$ be recovered from the received signal X?\nSubspace methods. The eigenstructure of the received signal covariance matrix can be exploited to perform DoA estimation. Indeed, with non-coherent sources, the covariance matrix of the received signal expresses as:\n$\\Gamma_X = A_\\zeta (\\theta) \\Gamma_S A_\\zeta(\\theta)^H + \\sigma_n^2 I_N,$\nwhere $\\Gamma_S$, the covariance matrix of S, is diagonal. Since\n$rank (A_\\zeta(\\theta) \\Gamma_S A_\\zeta(\\theta)) = N,$\n$A_\\zeta(\\theta) \\Gamma_S A_\\zeta(\\theta)$ admits only N strictly positive eigenvalues. Furthermore, $\\Gamma_X$ admits the following eigenvalue decomposition (EVD):\n$\\Gamma_X = U \\Lambda U^H$,\nwhere U is the matrix containing the eigenvectors and $\\Lambda$ is the diagonal matrix holding the eigenvalues on its diagonal. Then, combining Eq. (3) and (5) yields the following results (see [38, Chapter 4, pp.159-164] for more details):\n1) The eigenvalues ordered by decreasing amplitude are $\\lambda_1,\\cdots,\\lambda_M,\\lambda_{M+1},\\cdots,\\lambda_{M+1}$, where $\\lambda_{M+1} = \\sigma_n^2$ has multiplicity $N-M$.\n2) The eigenvectors span a space that can be decomposed into signal and noise subspaces: $U = [U_S, U_N]$, with $U_S \\perp U_N$.\nIt is then clearly established that $A_\\zeta(\\theta) \\perp U_N$, leading to:\n$\\forall i \\in [1, M], \\|U_N a_\\zeta(\\theta_i)\\|^2 = 0$.\nMUSIC. The core of this method lies in Eq. (6) and is summarized in Algorithm 1. Since the inverse of Eq. (6) tends to infinity for the sources' DoAs, the MUSIC algorithm involves evaluating this inverse on an angular grid $\\theta_g$, and identifying the sources' DoAs as the arguments of the peaks. It is important to note from Eq. (10) that DoA estimation performance depends on the array parametrization knowledge: imperfect knowledge of the antenna gains and locations leads to error in the MUSIC spectrum peak locations and amplitudes, thereby altering the estimated DoAs."}, {"title": "III. PROPOSED METHOD", "content": "As previously mentioned, the performance of the classical MUSIC algorithm deteriorates when considering hardware impairments. To address this issue, it is proposed to modify its structure to make it differentiable, enabling the learning of the array parametrization within the DoA estimation scheme."}, {"title": "Model-based differentiable architecture", "content": "Stochastic gradient descent (SGD) is leveraged to solve:\n$minimize_{\\zeta} \\mathbb{E}_{(\\theta,X)\\sim P(\\theta,x)} [\\mathcal{L} (\\theta,\\hat{\\theta} (X|\\zeta))],$\n$subject \\space to \\space \\zeta \\in \\mathbb{C}^{N} \\times \\mathbb{R}^{N}$\nwhere $P_{(\\theta,x)}$ represents the data distribution, $\\mathcal{L}$ is a loss function on the DoAs, $\\theta$ are the true DoAs associated to the measurements X and $\\hat{\\theta} (X|\\zeta)$ are estimated DoAs from a given DoA estimator with array parametrization knowledge $\\zeta$. In order to solve (P1) through SGD, it is necessary to compute the derivatives $\\nabla_\\zeta\\mathcal{L}(\\theta,\\hat{\\theta} (X|\\zeta))$. Using the derivative chain rule, it can easily be shown that one has to compute $\\nabla_{\\hat{\\theta}} \\hat{\\theta} (X|\\zeta)$ to compute $\\nabla_\\zeta\\mathcal{L}(\\theta, \\hat{\\theta} (X|\\zeta))$.\nThe MUSIC algorithm is inherently non-differentiable, a characteristic arising from the arg max operation in Eq. (10). This hard decision scheme can be represented through angular masks containing a single value at each spectrum peak, with no operations performed within those windows. Since only the operations following the applications of the fixed angular masks are considered for gradient computations, it leads to the non-existence of $\\nabla_{\\hat{\\theta}} \\hat{\\theta} (X|\\zeta)$ for the MUSIC method, which results in its non-differentiability.\nIt is thus proposed to replace this hard-decision scheme with a differentiable softmax-based approach outlined in Algorithm 2, where each estimated DoA can be seen as a convex combination of grid DoAs around the associated MUSIC spectrum peak. Note that $\\Theta^{mask} = I_L(\\Theta_g, \\Theta^{peak})$ denotes a windowing operation of size L, applied on the DoA grid $\\Theta_g$, centered around $\\Theta^{peak}$ such that $\\Theta^{mask} \\in \\mathbb{R}^{L}$. As for MUSIC, the diffMUSIC method initially estimates the spectrum peaks using a non-differentiable peak finding method: arg max in Eq. (11). Then, angular windows are defined around each peaks. As depicted in Eq. (13), within each window, the estimated DoAs are computed using differentiable operations involving the steering matrix $A_\\zeta(\\theta)$, through the computed MUSIC spectrum. This ensures that $\\nabla_{\\hat{\\theta}} \\hat{\\theta} (X|\\zeta)$ exists for a fixed angular mask, thereby making the method differentiable. Note that, in addition to being differentiable, this approach also increases angular resolution as off-grid estimates are possible through the convex DoA combination."}, {"title": "Learning framework", "content": "As presented in [36], [37], the root mean periodic squared error (RMPSE) on the DoAs can be used as a loss function to solve (P1) in a supervised learning (SL) manner. This loss function is defined as:\n$\\mathcal{L}_{SL, \\Theta} = \\frac{1}{|\\mathcal{T}|} \\sum_{(\\Theta,X) \\in \\mathcal{T}} \\min_{P \\in \\mathcal{P}} \\sqrt{\\frac{1}{M} \\sum_{i=1}^M \\|mod (\\Theta_i - P\\hat{\\Theta} (X|\\zeta)_i )\\|^2 }$,\nwhere $\\mathcal{P}$ is the set of permutation matrices, and $\\{\\Theta, X\\}$ is the training set. The RMPSE takes into account the permutation invariance in the DoA learning task through the permutation matrices $P \\in \\mathcal{P}$: more details can be found in [36]. Rather than learning on estimated DoAs, a proposed alternative strategy is to maximize the MUSIC spectrum amplitude at the true DoA locations. The associated supervised loss is defined as:\n$\\mathcal{L}_{SL, P} = \\frac{1}{\\mathcal{T}} \\sum_{(\\Theta,X) \\in \\mathcal{T}} \\sum_{i=1} ^M \\mathcal{P}_{MUSIC} (\\Theta_i | \\zeta)$.\nThis approach does not directly solve (P1); instead, it addresses a proxy problem, the solution of which translates into minimizing the DoA estimation error. Indeed, minimizing $\\mathcal{L}_{SL,P}$ can be interpreted as finding an array parametrization that maximizes the orthogonality between steering vectors associated to the true DoAs and the noise subspace.\nOnce the impairments are learned using $\\mathcal{L}_{SL,P}$, the DoAs can then be estimated using the classical MUSIC algorithm, or through diffMUSIC, with the learned array. This alternative SL strategy presents a reduced computational complexity during training in comparison to the RMPSE based strategy."}, {"title": "IV. EXPERIMENTS", "content": "It is proposed to study the impairments learning performance of the proposed diffMUSIC method against several baselines and in different scenarios.\nDataset generation. A ULA with N = 16 antennas is considered. Measurements are generated following Eq. (1). The sources DoAs are generated as $\\forall i \\in [1, M], \\theta_i \\sim U [-80^\\circ, 80^\\circ]$. The sensing signal to noise ratio (SNR) is computed as $SNR = 10 log_{10} (\\frac{\\sigma_s^2}{\\sigma_n^2})$. Concerning the hardware impairments, imperfections in both antenna locations and gains are taken into account. For the antenna locations, one has:\n$\\forall i \\in [1, M], p_i = \\bar{p}_i + \\delta p_i,$\nwhere $p_i$, resp. $\\bar{p}_i$, denotes the physical, resp. nominal, ith antenna location, and $\\delta p_i \\sim U [-\\eta, \\eta]$, with $\\eta \\alpha \\lambda/2$. Note that the locations are only altered along the non-null dimension of the ULA. Similarly, for the antenna gains, one has:\n$\\forall i \\in [1, M], g_i = \\bar{g}_i + \\delta g_i,$\nwhere $g_i$, resp. $\\bar{g}_i$, denotes the physical, resp. nominal, complex gain for the ith antenna, and $\\delta g_i \\sim \\mathcal{CN} (0, \\sigma_g^2)$.\nUnless otherwise stated, M = 5 sources, T = 100 snapshots, $\\eta = 0.5 \\lambda /2$ and $\\sigma_g^2 = 0.36$ are considered."}, {"title": "Baselines", "content": "The proposed approach is compared against the classical MUSIC algorithm (denoted as M) with nominal and physical array, but also against diffMUSIC (denoted as dM) with physical array. Note that the window size L of diffMUSIC is optimized in each considered scenario. Additionally, it is proposed to compare diffMUSIC against the SubspaceNet network presented in [37]: as its goal is to learn a surrogate covariance matrix to counter imperfections in the sensing process, it is able to take into account hardware impairments.\nThe evaluation metric for all approaches is the RMPSE defined in Eq. (14) evaluated over a test set.\nPerformance against baselines. It can be seen that the proposed approaches outperform the MUSIC algorithm with nominal array knowledge. Moreover, one can see that SubspaceNet performs relatively well for $M = 1$ but totally fails to learn the imperfections in the multi-source scenario. Additionally, it can be seen that diffMUSIC with $\\mathcal{L}_{SL, P}$ equals or outperforms diffMUSIC with physical array, indicating good impairment learning capabilities. Furthermore, one can remark that the UL approach presents good performance in the multi-sources scenario: this is of particular interest as this approach does not rely on labeled DoAs. Note that this approach could be extended in an online learning strategy where the antenna array would learn its hardware impairments on the fly."}, {"title": "Learned parameters and MUSIC spectrums", "content": "It is proposed to visualize the learned parameters by the proposed methods for $M = 5$ and their impact on the associated MUSIC spectrums.\nFig. 3 presents the learned parameters: the center of each circle represents an antenna location, the circle radius represents the associated complex gain magnitude, and the segment angle represents the associated complex gain phase. It can be seen that the $\\mathcal{L}_{SL,\\Theta}$ approach presents good impairments learning except for two antennas whose defaults are small. It is worth noting that both the $\\mathcal{L}_{SL,P}$ and $\\mathcal{L}_{UL}$ approaches achieve near-perfect learning of the impairments which aligns with their strong performance observed in Table II."}, {"title": "Performance against sensing noise", "content": "Fig. 5 presents the DoA estimation performance evolution with variable SNR, for M = 5 sources and T = 100 snapshots. One can remark that, while the $\\mathcal{L}_{SL,\\Theta}$ approach presents good performance in the high SNR region, the $\\mathcal{L}_{SL,P}$ approach presents the overall best performance as it follows tightly the diffMUSIC performance with physical array. It is worth noting that, in the very low SNR region, both the $\\mathcal{L}_{SL,\\Theta}$ and $\\mathcal{L}_{UL}$ approaches are significantly affected by noise, preventing them from effectively learning hardware impairments. In contrast, the $\\mathcal{L}_{SL,P}$ approach does not suffer from that issue."}, {"title": "Performance against snapshot number", "content": "Fig. 6 presents the DoA estimation performance evolution with variable number of snapshots for M = 5 sources and 30dB SNR. As expected, the estimation performance degrades across all approaches when the number of snapshots is low. This can be attributed to the higher estimation error in the empirical covariance matrix when T is low. It is also worth noting that the $\\mathcal{L}_{SL,P}$ approach exhibits the overall best performance. It demonstrates its superiority against other methods as it offers both better estimation performance in low SNR or low snapshot scenarios, while also achieving lower time complexity."}, {"title": "V. CONCLUSION AND FUTURE WORK", "content": "This paper discussed the application of a differentiable version of the MUSIC algorithm for learning hardware impairments in the DoA estimation context. The differentiable MUSIC algorithm was obtained by replacing the non-differentiable argmax search by a softmax-based approach, where each estimated DoA can be viewed as convex combination of DoAs. Additionally, both supervised and unsupervised loss functions have been proposed for this impairment learning task. The proposed methods have been evaluated against several baselines, showing their good hardware impairment learning and DoA estimation abilities. Specifically, it has been shown that the proposed methods are able to learn hardware impairments even in the presence of high sensing noise and low number of measurement snapshots. Furthermore, the unsupervised learning strategy is of particular interest as it enables the antenna system to perform hardware impairment compensation without requiring measured DoAs.\nFuture work will focus on extending the differentiable MUSIC approach to address coherent or partially correlated sources, and its application to near-field localization."}]}