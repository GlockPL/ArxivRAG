{"title": "Deep Spatio-Temporal Neural Network for Air Quality Reanalysis", "authors": ["Ammar Kheder", "Benjamin Foreback", "Lili Wang", "Zhi-Song Liu", "Michael Boy"], "abstract": "Air quality prediction is key to mitigating health impacts and guiding decisions, yet existing models tend to focus on temporal trends while overlooking spatial generalization. We propose AQ-Net, a spatiotemporal reanalysis model for both observed and unobserved stations in the near future. AQ-Net utilizes the LSTM and multi-head attention for the temporal regression. We also propose a cyclic encoding technique to ensure continuous time representation. To learn fine-grained spatial air quality estimation, we incorporate AQ-Net with the neural kNN to explore feature-based interpolation, such that we can fill the spatial gaps given coarse observation stations. To demonstrate the efficiency of our model for spatiotemporal reanalysis, we use data from 2013-2017 collected in northern China for PM2.5 analysis. Extensive experiments show that AQ-Net excels in air quality reanalysis, highlighting the potential of hybrid spatio-temporal models to better capture environmental dynamics especially in urban areas where both spatial and temporal variability are critical.", "sections": [{"title": "1 Introduction", "content": "Air pollution is one of the greatest current global health challenges faced by society. According to the World Health Organization, 99% of the world's population breathes unhealthy air, which is responsible for as many as 7 million premature deaths annually [17]. In China alone, an estimated 2.5 million people die per year due to poor air quality [16]. Therefore, air quality prediction is a crucial field of study aimed at safeguarding both human and environmental health, especially in the context of megacities such as those in China.\nAccurately predicting urban air quality is challenging due to the complex interplay of spatiotemporal factors, particularly in dense megacities such as Beijing. However, due to the limited monitoring stations or instrument errors, it is important to reanalyze the historical data to reconstruct a complete picture of air pollution across time and space, and gain knowledge for atmospheric chemistry study. Traditional deep learning methods (e.g., LSTMs with attention) can handle temporal sequences but often struggle in unmonitored areas lacking direct measurements. To address this limitation, we propose AQ-Net, a hybrid approach that combines an LSTM, multi-head attention, and a neural k-Nearest Neighbors (kNN) module for spatiotemporal analysis. Our model specifically focuses on PM2.5 since it has significant health and environmental impacts for its longer atmospheric lifetime and widespread sources. As illustrated in Figure 1, given visible stations (\u25b3), not only AQ-Net reconstructs the PM2.5 at hidden stations (nearby stations \u25cb), it can also estimate the global PM2.5 map across northern China and accurately localize pollution, like Beijing, Hebei, and Shandong. Even in regions lacking direct monitoring, the model demonstrates robust performance, underscoring its capacity to handle both temporal dependencies and spatial variability for enhanced air quality reanalysis. To summarize, our contributions are:"}, {"title": "2 Related Works", "content": ""}, {"title": "2.1 Chemical modeling for air quality analysis", "content": "In recent decades, China has experienced rapid economic growth and urbanization. This has come with challenges, one of the biggest of which is air quality, and there has been a focus on researching and understanding air quality issues in Chinese cities [37,31,10]. One of the most commonly measured air pollutants is PM2.5 (particulate matter less than 2.5 \u00b5m in diameter). When inhaled, airborne particulates can penetrate deep into the lung and enter the bloodstream, leading to cardiovascular diseases, strokes, and respiratory illness [33]. During haze episodes, which are prevalent in Beijing and the North China Plain in winter months, PM2.5 can reach very unhealthy and even dangerous levels. Haze episodes have serious health and economic consequences, resulting in hospitalizations, loss of working time, and premature deaths[33,23,15].\nTraditional approaches to air quality reanalysis often rely on chemical transport models (CTMs), which simulate the chemical and physical mechanisms and processes in the atmosphere. CTMs are usually coupled with a numerical weather prediction (NWP) model, and they are used for generating short- and mid-range reanalysis of air quality parameters[3,2]. Examples of CTMs for air quality analysis include WRF-Chem[25], CMAQ[1], Enviro-HIRAM[2], and SILAM[29]. While these models are useful reanalysis tools and provide valuable insights, they are computationally expensive and highly sensitive to the precision of input data, such as uncertainties in anthropogenic emission inventories or meteorological parameters in the NWP datasets [38,11]. These models often underestimate pollutant concentrations during severe haze episodes in China [13]. Moreover, CTMs are limited to current scientific knowledge, and they still lack some important chemical mechanisms. For example, many models are missing heterogeneous oxidation of SO2, which is an important mechanism for sulfate"}, {"title": "2.2 Temporal domain prediction via deep learning", "content": "Recent advancements in deep learning have significantly improved air quality reanalysis by leveraging time-series data. Recurrent Neural Networks (RNNs) and their variants, such as Long Short-Term Memory (LSTM) [14] and Gated Recurrent Units (GRUs) [7], have been widely used for sequential modeling. These models capture long-term dependencies in air pollution data and have shown promising results in predicting pollutant concentrations based on historical trends [5].\nOne of the main challenges of RNN-based models is the vanishing gradient problem, which can affect long-range dependencies. LSTM and GRU networks mitigate this issue through gating mechanisms that selectively retain relevant information over time. Several studies have demonstrated the effectiveness of LSTMs in air quality reanalysis [39]. However, these models primarily focus on temporal dependencies and often overlook the spatial correlations between different monitoring stations [9]. An attention mechanisms [30] have been integrated into LSTM-based architectures to enhance performance by selectively weighting important time steps [4]. Attention-based LSTMs have demonstrated superior prediction accuracy compared to standard LSTMs, particularly in complex urban environments where pollution levels fluctuate dynamically [32]. Despite their success, these methods still lack spatial adaptability, making them ineffective for predicting PM2.5 concentrations in unobserved locations."}, {"title": "2.3 Deep learning for spatiotemporal domain analysis", "content": "To address these limitations, hybrid approaches have been developed to incorporate both spatial and temporal dependencies in air quality reanalysis. Traditional machine learning models, such as XGBoost [6], leverage historical time series and meteorological data to predict PM2.5 concentrations. Although these models are computationally efficient, they often fail to capture the complex nonlinear relationships present in spatiotemporal data [36].\nTo integrate spatial dependencies, this approach is related to image/video super-resolution techniques. Besides conventional Convolutional Networks [19,21,22,20], Graph Neural Networks (GNNs) have been used for spatiotemporal analysis. Dynamic Graph Convolutional Recurrent Neural Networks (DCRNN) [18] and Spatio-Temporal Graph Convolutional Networks (ST-GCN) [36] leverage graph structures to model the relationships between monitoring stations, enabling more accurate reanalysis. Additionally, attention mechanisms have been employed to enhance the efficiency of spatio-temporal models. The Transformer model [30], initially designed for natural language processing, has been adapted to environmental modeling due to its ability to capture long-range dependencies [35]. Hybrid models that integrate LSTMs with attention mechanisms, such as STTN"}, {"title": "3 Approach", "content": "The air quality data used as input is from a network of real-time air quality sensors throughout China, which are managed by the Ministry of Environmental Protection (MEP) and published hourly by the China Environmental Monitoring Centre (CEMC) [8]. This network has been collecting measurements since 2013, with the goal to study and predict air quality issues throughout China. By 2014, there were 944 air quality monitoring stations in 190 cities, and currently, there are over 2100 stations throughout China. The air quality parameters measured by this network are PM2.5 and PM10, NOx, SO2, O3 and CO. The dataset has been quality controlled with the algorithm described by Wu et al.[34]. This study uses data from 584 stations in the metropolitan area of northern China from 2013 to 2017."}, {"title": "3.1 Overall Architecture", "content": "Our model predicts PM2.5 by combining temporal and spatial dependencies. AQ-Net comprises three core components: an LSTM-MHA module, combining LSTM and multi-head attention for temporal feature extraction, a neural KNN module for spatial interpolation, and a Cyclic Encoding (CE) layer for time embedding. We use hourly measurements of PM2.5, PM10, CO, NO2, SO2, and O3 from monitoring stations, and estimate PM2.5 for the coming hours and days. The LSTM captures long-range pollutant fluctuations, while multi-head attention highlights critical time steps. A temporal pooling step condenses the latent sequence into a single feature vector, which the neural kNN module uses for spatial interpolation at unobserved stations based on their nearest neighbors. This integrated architecture generates 168-hour (7-day) PM2.5 estimation for both observed and unobserved locations, leveraging key temporal patterns and spatial relationships."}, {"title": "3.2 Proposed Modules", "content": "Air quality reanalysis is formulated as a spatiotemporal reanalysis problem. The input data consists of historical pollutant concentrations along with their time steps and geospatial information from monitoring stations.\nCyclic Encoding (CE) for Temporal Features To preserve the periodic nature of time-related features, we apply a cyclic encoding technique to the time step t using sine and cosine transformations. This approach ensures a continuous representation, preventing discontinuities between values such as 23:00 and 00:00. The encoding is defined as Xsin = sin(2\u03c0t/cycle), Xcos = cos(2\u03c0t/cycle), where t represents a temporal feature (e.g., hour, day, or month), and cycle corresponds to its periodicity (e.g., 24 for hours, 7 for days, and 12 for months).\nLong Short-Term Memory (LSTM): To capture temporal dependencies, an LSTM network processes the time series data of pollutant concentrations. Given an input sequence X \u2208 RC\u00d7T\u00d7N, where C is the number of features, T is the sequence length (number of time steps), and N is the number of stations, the LSTM generates a temporal representation Z \u2208 Rdim\u00d7T\u00d7N, where dim represents the hidden state dimension. The LSTM captures long-term dependencies, allowing the model to learn pollutant trends over time.\nMulti-Head Attention (MHA): Although LSTM effectively captures sequential dependencies, it treats all past observations equally at each time step. To improve performance, we integrate a Multi-Head Attention (MHA) mechanism that enhances temporal dependencies by selectively weighting relevant time steps. The attention mechanism is computed as follows:\nZ' = softmax(QzKzT/\u221adk)Vz + Z (1)\nwhere Qz, Kz, Vz are linear transformations of Z and dk is a scaling factor. This mechanism enables the model to focus on important time intervals, improving its ability to recognize patterns in pollutant fluctuations.\nSpatial Interpolation via kNN While the LSTM-MHA module captures temporal trends, it does not account for spatial correlations between monitoring stations. To estimate PM2.5 values at unobserved stations, we employ a kNN-based interpolation method. Instead of using the raw PM2.5 values from observed stations, we first extract a \"station-wise feature vector\" from the refined temporal representation Z' using temporal pooling Z' \u2208 RC\u00d7dim\u00d7N. This feature vector encapsulates the learned temporal patterns of each station, rather than just the"}, {"title": "4 Experiments", "content": ""}, {"title": "4.1 Dataset and model architectures", "content": "We use real-world data from 584 monitoring stations collected between 2013 and 2017. The dataset contains hourly measurements of CO, NO2, O3, PM10, PM2.5, and SO2. Stations with incomplete time series are removed, and all features are normalized into [0, 1]. We train AQ-Net using AdamW optimizer with the learning rate of 1 \u00d7 10-3. We use the MSE as the loss function to estimate the network output and ground truth values for backpropagation. The batch size is set to 32 and AQ-Net is trained for 468K iterations (about 2 hours) on the CSC server with one NVIDIA A100 GPU using PyTorch deep learning platform. The k value for Neural kNN is 20. The code can be found at https://github.com/AmmarKheder/AQ-Net."}, {"title": "4.2 Overall Performance Comparison", "content": "To evaluate the accuracy of the reanalysis, three key metrics are considered: Mean Absolute Error (MAE), Root Mean Squared Error (RMSE), and the coefficient of determination (R2). Each of these metrics provides valuable insight into the performance of the models:\n\u039c\u0391\u0395 = 1/n \u03a3|Yi \u2212 Y'i|, RMSE = \u221a(1/n \u03a3(Yi \u2212 Y'i)\u00b2), R\u00b2 = 1 \u2212 \u03a3(Yi \u2212 Y'i)\u00b2 / \u03a3(Yi \u2212 Y'i)\u00b2. (2)\nWe compare our proposed AQ-Net with three approaches: PatchTST [24] (a Transformer tailored for time series processing), Linear Regression, and LSTM [28]. Our model can be used for temporal prediction at the same monitoring stations, it can also provide spatiotemporal prediction at unseen monitor stations.\nShort-term temporal reanalysis (24-Hour Input Window) Table 1 shows short-term estimated PM2.5 concentrations in Beijing over the next few hours based on a 24-hour historical input. These reanalysis are critical for real-time air quality monitoring, health alerts, and short-term pollution control measures."}, {"title": "4.3 Analysis of Temporal Attention Patterns", "content": "We examine the model's temporal dependencies by analyzing MHA weights across different heads. In Figure 4, Head 2 shows strong responsiveness to short-term fluctuations, while Head 1 maintains more stable weights, suggesting a focus on long-term trends. To identify and select these heads, we performed a PCA-based clustering of all attention heads, revealing that these two belong to distinct cluster: one emphasizing immediate variations (short-term) and the other capturing broader temporal structures (long-term).\nThe global attention heatmap (Figure 5) shows how the model distributes attention between training days when reanalysis is performed. The x-axis represents input (historical) days (oldest \u2192 most recent), and the y-axis corresponds to output (reanalysis) days. The strong diagonal pattern indicates that the model prioritizes recent data, while some off-diagonal values suggest that it also captures longer-term dependencies. Darker areas attract more attention, highlighting the importance of recent pollution levels for accurate reanalysis."}, {"title": "4.4 Spatiotemporal reanalysis in Northern China", "content": "Our proposed AQ-Net is able to interpolate the geographical trajectory given pollution data at known stations. Following the previous experiments in Beijing,"}, {"title": "5 Conclusion", "content": "In this work, we addressed the challenge of reanlyzing air quality in complex urban environments, focusing on Northern China as a test bed. Our proposed AQ-Net model combines LSTM and multi-head attention to explore time series correlations, and a neural kNN to handle spatial interpolation for unobserved stations. This hybrid structure effectively captures both spatial and temporal pollution dynamics, as evidenced by strong performance in 6-to-24-hour horizons and in extended reanalysis up to seven days. Comparisons with established baselines reveal that AQ-Net outperforms these models in terms of RMSE and MAE. Notably, the attention mechanism highlights key temporal dependencies without requiring excessive complexity. Meanwhile, the neural kNN module ensures that spatial relationships among stations are preserved, enabling fine-resolution predictions even in regions lacking direct sensor measurements. AQ-Net provides valuable insights for health alerts and policy decisions. Beyond this specific application, the methodology can be extended to other pollutants and urban contexts where data coverage is uneven. Future enhancements could explore adaptive approaches to handle changing emission patterns or incorporate real-time data feeds to further refine long-term forecasts."}]}