{"title": "The Helicobacter pylori AI-Clinician: Harnessing Artificial Intelligence to Personalize H. pylori Treatment Recommendations", "authors": ["Kyle Higgins", "Olga P. Nyssen", "Joshua Southern", "Ivan Laponogov", "AIDA CONSORTIUM", "Dennis Veselkov", "Javier P. Gisbert", "Tania Fleitas Kanonnikoff", "Kirill Veselkov"], "abstract": "Helicobacter pylori (H. pylori) is the most common carcinogenic pathogen worldwide. Infecting roughly 1 in 2 individuals globally, it is the leading cause of peptic ulcer disease, chronic gastritis, and gastric cancer. To investigate whether personalized treatments would be optimal for patients suffering from infection, we developed the H. pylori Al-clinician recommendation system. This system was trained on data from tens of thousands of H. pylori-infected patients from Hp-EuReg, orders of magnitude greater than those experienced by a single real-world clinician. We first used a simulated dataset and demonstrated the ability of our Al Clinician method to identify patient subgroups that would benefit from differential optimal treatments. Next, we trained the Al Clinician on Hp-EuReg, demonstrating on average the Al Clinician reproduces known quality estimates of treatment decision making, for example bismuth and quadruple therapies out-performing triple, with longer durations and higher dose proton pump inhibitor (PPI) showing higher quality estimation on average. Next, we demonstrated that treatment was optimized by recommended personalized therapies in patient subsets, where 65% of patients were recommended a bismuth therapy of either metronidazole, tetracycline, and bismuth salts with PPI, or bismuth quadruple therapy with clarithromycin, amoxicillin, and bismuth salts with PPI, and 15% of patients recommended a quadruple non-bismuth therapy of clarithromycin, amoxicillin, and metronidazole with PPI. Finally, we determined trends in patient variables driving the personalized recommendations using random forest modelling. With around half of the world likely to experience H. pylori infection at some point in their lives, the identification of personalized optimal treatments will be crucial in both gastric cancer prevention and quality of life improvements for countless individuals worldwide.", "sections": [{"title": "Background", "content": "Helicobacter pylori (H. pylori) is a Gram-negative S-shaped bacteria which has adapted to colonize the niche of the deep gastric mucous layer in the human stomach.1 H. pylori infection in the gastric mucosa leads to a diverse inflammatory response in local epithelial cells, resulting in chronic active gastritis. (Figure 1A) Despite producing antibodies to H. pylori antigens, this immune response is generally incapable of eradicating the bacteria. Over decades, this inflammation has been thought to lead to a variety of conditions, most notably peptic ulcer disease (PUD) and gastric cancer. Of the nearly 4 billion people infected by H. pylori, approximately 10% will develop PUD within a decade of infection, meaning roughly 780 million worldwide will be afflicted by this condition.2 (Figure 1B) Peptic ulcers result from damage to the lining of the stomach and may lead to complications such as internal bleeding and perforations, with a high mortality rate in such cases. H. pylori eradication has shown promising results in the treatment of PUD, achieving not only ulcer healing but also preventing its recurrence.\nAround 90% of gastric cancer cases are due to H. pylori infection.3 It is estimated that gastric cancer makes up 37% of chronic infection-induced cancers, making H. pylori the most frequently carcinogenic pathogen.4 Gastric cancer is thought to develop after years of inflammation-induced gastric atrophy, wherein achlorhydria drives the development of an abnormal microbiome, further driving the transformation of gastric epithelial cells to an oncogenic state (a hypothesis termed the 'Correa cascade').5 Indeed, a 'point of no return' has been observed with regards to H. pylori infection in patients developing gastric cancer, past which H. pylori eradication is insufficient to interrupt the inflammatory cascade leading to oncogenesis. Despite advancements in treatment such as chemotherapy and surgery, gastric cancer results in a poor prognosis compared to other cancer types, especially in advanced stages.6\nThe European Registry on Helicobacter pylori management (Hp-EuReg) was established to combat the high social and health burden of H. pylori infection across Europe. It was noted at the time that consensus and clinical guidelines were established for H. pylori treatment, but that no data existed cataloging the implementation of these recommendations. This project took the form of an international and multicenter prospective non-interventional registry documenting the real clinical practice by European gastroenterologists of H. pylori management in the majority of countries across Europe. (Figure 1C) Patient data documented include several demographics categories (i.e., country, sex, age), pre-existing gastrointestinal symptoms, treatment indication, previous eradication attempts, and compliance. (Figure 1D) Crucially, this registry documents treatment chosen, duration of treatment, proton pump inhibitor (PPI) dosage and eradication outcome. To date, this registry has been used in over 40 published studies.7 (For a full list of publications, see 9.) The most common uses for this dataset have been to assess treatment effectiveness, especially in a country or region-specific context. However, most of these studies have mainly relied on traditional statistical methods rather than advanced methods employing machine learning (ML), artificial intelligence (AI), with one notable exception10.\nThe most frequently used treatments in this registry include the administration of triple and quadruple (either bismuth and non-bismuth based) antibiotics regimens. Treatment durations predominately include 7, 10, and 14-day prescriptions. Components of these treatments include a combination of at least two antibiotics and a PPI in order to raise stomach pH and bismuth for its bacteriostatic effect. Standard triple therapies, most often consisting of two antibiotics (amoxicillin and clarithromycin), and a PPI, were a great advance in the treatment of H. pylori in the 1990s, leading to its once adoption as the treatment gold standard.11 However, increasing clarithromycin resistance (up to 23% observed in Hp-EuReg) and other factors have led to the development of additional therapies such as quadruple regimens. Certain formulations of quadruple therapies quickly demonstrated >90% eradication rate (now considered the threshold for an optimal H. pylori regimen12), leading to their adoption as the current recommendation standard.13 In their traditional formulation, they combine a nitroimidazole (such as metronidazole or tinidazole) with a PPI and antibiotics amoxicillin, clarithromycin. However due in part to an antibiotic resistance, an alternative bismuth quadruple regimen has been widely adopted (including tetracycline and metronidazole), to great effect in first-line treatments 14,15. Bismuth has been included for its bactericidal effect, rendering bismuth quadruple therapy unaffected by clarithromycin and metronidazole resistance. 16 Sequential therapies were also developed in part to overcome limitations posed by triple therapies, and consist of a two-part treatment period, first using a PPI and amoxicillin, followed by a PPI, clarithromycin, and either tinidazole or metronidazole17. However, sequential therapies have been administered to variable effect, with eradication rates varying from <80%-90%, largely dependent on region.18-20 Finally, bismuth single capsule therapies such as Pylera\u00ae replace multi-drug regimens with a single pill containing bismuth, metronidazole, and tetracycline, combined with a PPI.21 Bismuth single capsule therapy are a relatively new treatment, with Pylera\u00ae first approved by the FDA in 2006 and currently only approved in Europe in a subset of countries.22 Early studies show the eradication rate varying around 80% to around 95%23,24, and a recent meta-analysis report an effective eradication (90%) not only in first-line but also in rescue therapy and in those patients with clarithromycin- or metronidazole-resistant strains, and in those previously treated with clarithromycin.25 Though further study is needed as implementation is increased in diverse populations.\nA further consideration for treatment recommendation is the presence of allergies to penicillin-like medications, such as amoxicillin. Around 1-5% of patients globally have documented penicillin allergies 26, though higher percentages suggested when self-reporting. 27 The presence of this allergy necessitates use of therapies without amoxicillin, such as levofloxacin-based regimens or a tetracycline, metronidazole, and bismuth salts regimens combined with a PPI such as those found in bismuth single capsule therapies.\nRecently, Al and ML have revolutionized several fields including medicine in part due to their propensity for patterns in large quantities of data. Several Al approaches have had particular success. Supervised learning involves the training of models on labeled data to either classify or make predictions about data from other sources. Unsupervised learning on the other hand operates on unlabeled data, with the purpose of finding unknown patterns in the data. Common examples of this technique include clustering and dimensionality reduction. Finally, reinforcement learning (RL) is a paradigm designed for the purpose of training a decision-making apparatus by rewarding desirable decisions and penalizing undesirable ones. It has found particular success in the fields of robotics, video gaming, and various optimization problems. However, its utility has rarely been applied in the field of medicine.\nWe developed the H. pylori Al-Clinician which applies RL to determine patient-specific first-line treatment recommendations and determine one size fits all for optimal treatment strategy. (Figure 1E) This method applies RL, which in this case learns iteratively which actions to take (termed policy) to maximize reward in the context of a given state. RL is well-suited to datasets such as the case of the Hp-EuReg with many interacting variables (on the order of a thousand when one-hot encoded) as it is sensitive to small differences in rewards, and able to detect subtle factors which affect outcome in the state, and therefore patient outcomes. 28"}, {"title": "Method Development", "content": "The H. pylori Al-clinician was developed in order to predict optimal treatment outcomes on a patient-specific basis while learning from real-world clinical decisions. It was developed using RL, which is a ML approach by which an agent learns by observing the reward it receives from taking actions in a trial-and-error manner. However, since our agent (the Al-clinician) was being applied to real-world patients, it is both dangerous and unethical to implement trial-and-error learning in early stages. Therefore, an alternative approach was implemented which trains the agent using clinical actions (treatments) and their observed reward (success/failure) rather than implementing the actions of the agent directly. (Figure 2A)\nThe specific RL method developed was termed independent-state Deep Q-Network Learning. (isDQN) It is an adaptation of Deep Q-Network (DQN) Learning, which is one of the most widely applied methods in RL. 29-32 Q-learning is a method by which the quality of state-action pairs is learned over time, where the state is some set of environmental variables and the actions are the set of all possible actions an agent may take. Usually, the action taken will be that with the highest Q-score in a given state context. DQN is termed 'deep' in that it utilizes a neural network of several layers to achieve its learning. Reward is observed for each action in the context of a given state, and this reward is in turn used to alter weights in the neural network during some optimization step to improve the estimation of Q-scores in the future, therefore improving decision-making. Optimizations are traditionally some functions of both immediate reward from action taken, and the quality of the state the action puts the environment in in the subsequent moment (for example, increasing score in a video game immediately, and also putting the agent in a position to further increase score in future moves.)\nOur method, isDQN differs from traditional RL methods in that there is no concept of a 'subsequent state' for patient data as this data remains static before and after treatment, with eradication fully represented in the reward. Mathematically, optimization is traditionally performed using a loss function which aims to represent and minimize what 'cost' was accrued by the current failures in decision-making at a given step. This loss function is traditionally calculated using the Q-score of the current state subtracted from the immediate reward and maximum expected quality of the subsequent state. In our method, the quality of the subsequent state is not considered, effectively eliminating it from the loss function. (In mathematically rigorous terms, the trajectory is always taken to be in its final state, which is a special case described in the original formulation of DQN analysis detailed by Mnih et al.33\nThe representation of patient information is as follows. States were represented by the one-hot encoded patient variables represented in the Hp-EuReg dataset. Actions were also one-hot encoded as described by clinical treatment decisions including antibiotic/PPI combination, antibiotic dose, PPI dose category (see Methods for values), and duration (for example, clarythromycin + amoxicillin + metronidazole + clarithromycin dose = 500 mg, + intakes twice daily + + high dose PPI, 14-day duration) and encoded numerically. Only treatments with at least 500 examples in the dataset were included in the action space. (Figure 2B) Note that PPI dose category was divided into categories of 'Standard or Low Dose' and 'High Dose' to reduce the number of treatment category divisions. Reward was represented by the clinical outcome of the treatment, therefore a value of +1 if eradication was achieved and -1 if the eradication was a failure. The model was trained using batches of patients, where a mathematical operation termed gradient descent reweighs the neural network at each optimization step using a mean squared error (MSE) loss function. Over time, this agent learns the quality of each treatment for a given patient, determining patient-specific optimal treatments. (Figure 2C)"}, {"title": "Results", "content": "To demonstrate the effectiveness of our model in detecting heterogeneous optimal treatment choices, we generated a simulated dataset of 10,000 patients with 100 binary features. To model an asymmetric dataset (unbalanced classes) 7000 patients were assigned one random combination of binary variables, while another group of 3000 was assigned a different random combination of variables. (Figure 3A) Noise was added to the dataset at various levels to obscure the structure of variables determining outcome, similar to real-world datasets. Two simulated treatments were used in the dataset, where treatment A was given 90% success in group A of patients, and treatment B was given 80% success in group A. Likewise, treatment B was given 90% success in group B whereas it was only given 80% in group A.\nData was generated and split into a balanced and randomized 90-10 training-testing distribution. Here we consider a 'correct' optimal drug recommendation to be one where the drug with 90% effectiveness in the patients' group of origin is recommended (For example, drug A to a patient from group A). During the testing phase, Q scores for both treatments (optimal and non-optimal) were examined, demonstrating highly accurate optimal drug recommendations. (Figure 3B) Noise levels of 5, 10, 25, 50, 75, and 99% were tested to evaluate the model's performance in the presence of noisy data. The percentage of patients correctly identified in each noise level was 98.9% (5% noise), 94.2% (10% noise), 92.1% (25% noise), 92.3% (50% noise), 82.4% (75%), 72.0% (99% noise) demonstrating that the model is capable of detecting patient heterogeneity in optimal treatment even in the presence of highly noisy data. (Figure 3C)\nA second, more complex simulated analysis was performed for hyperparameter tuning. In this case, 10 unique simulated patient 'types' were generated, with a unique random pattern of 70 one-hot encoded patient variables, for 50,000 simulated patients total. In each simulated patient 'type' a single optimal treatment out of 10 possibilities is given 90% effectiveness, with all other treatments providing 70% effectiveness. An additional 5% noise is added to the data to simulate real world variability. A hyperparameter grid testing multiple combinations of batch size, steps per optimization, deque size, and learning rate is sampled to include every combination, and a model trained using a random sample of 80% of the data. As a metric of success, a score is generated between 0 and 1 which represents the fraction of patients in the testing dataset (remaining 20%) which was correctly assigned the treatment corresponding to 90% success rate in the simulated training group. An optimal combination favoring small batch sizes and a fast learning rate was found to perform best and used for analysis of real-world data. (For full description, see Methods)\nMoving to Hp-EuReg, we evaluated the consistency of the Al Clinician with different splits of training data by generating 500 independent models by ten-fold, fifty repeat cross validation. For each repeat, training (model optimization) was performed using a 90% random sample of first-line treatments from the Hp-EuReg dataset, with testing performed on the remaining 10%. Al performance was compared to clinicians by comparing Q-scores of the clinician's action to the Al-recommended action for each patient. In a representative model, mean Q scores in the testing phase were tabulated to quantify the Al Clinician's preference for different treatment categories. All therapies include prescription of a PPI. Overall, Pylera\u00ae therapies had the highest average Q score (mean=0.92, SD=0.04), suggesting that over the entire testing dataset it was on average estimated to be the most effective on a diverse population of patients. It was followed by quadruple bismuth therapies with clarithromycin, amoxicillin, and bismuth salts (mean=.90, SD=0.05), quadruple non-bismuth therapies with clarithromycin, amoxicillin, and metronidazole (mean=0.89, SD=0.04), and sequential therapies with clarithromycin, amoxicillin, and tinidazole (mean=0.89, SD=0.05). Triple therapies performed the most poorly, with clarithromycin and metronidazole (mean=0.86, SD=0.04) slightly outperforming clarithromycin and amoxicillin (mean=0.85, SD=0.05). (Figure 4A) Average Q scores based on PPI dose demonstrate a preference for high dose PPI on average (mean=0.88, SD=0.04) compared to low or standard doses (mean=0.86, SD=0.04). (Figure 4B) For a full description of PPI dose definitions given particular PPIs, see Methods. It is worth noting that many patients in the training dataset had a PPI dose which was not specified by the clinician. However, the category of patients with unspecified dose also showed high Q scores (mean=0.89, SD=0.04) suggesting this population was dominated by high PPI doses. Finally, ten (mean=0.89, SD=0.04) and fourteen-day (mean=0.88, SD=0.04) durations were found to have higher Q scores than seven day (mean=0.85, SD=0.04) treatment periods-with ten and fourteen day periods showing similar average Q scores. (Figure 4C)\nWhen tabulated over all repeats (50 recommendations per patient in the testing phase), 65.5% of patients were consistently recommended a bismuth therapy consisting of either Pylera\u00ae or clarithromycin, amoxicillin, and bismuth salts paired with a PPI by more than half of the models, which we treat as a frequency threshold. Further, 15.5% of patients were recommended a non-bismuth clarithromycin, amoxicillin, and metronidazole with PPI, and 19.0% of patients recommended a variety of therapies, with no single therapy being recommended by more than half of models. Notably no patients were consistently recommended triple or sequential therapies. (Figure 5A) We additionally examined the breakdown of patients where unique bismuth therapies are considered separately, where patients need to be recommended either Pylera or quadruple bismuth therapies with clarithromycin, amoxicillin, and bismuth salts by more than half of models to be considered above frequency threshold. 51.5% were recommended quadruple non-bismuth therapy with clarithromycin, amoxicillin, and metronidazole, 30.4% were recommended Pylera\u00ae, and 18.1% were recommended quadruple bismuth therapies with clarithromycin, amoxicillin, and bismuth salts. (Figure 5B)\nFinally, in order to see which variables correlated most strongly to treatment recommendation, we perform RF analysis each time for four recommendation groups: Pylera, bismuth quadruple (with clarithromycin, amoxicillin, and bismuth salts), bismuth salts (any) which could be either Pylera\u00ae or bismuth quadruple therapy, and non-bismuth quadruple therapy (with clarithromycin, amoxicillin, and metronidazole). The model is formulated to predict whether a patient will receive a given treatment versus all others, based on patient variables. RF models had a balanced accuracy of prediction of 84.7% for Pylera\u00ae, 76.7% for bismuth quadruple therapies, 73.6% for bismuth salts (any), and 92.3% for non-bismuth quadruple therapies. Patient variable importance was ranked by mean decrease in impurity (MDI) to determine highest predictive power for a given treatment recommendation. Overall, being from the southwest region of Europe, not taking acetylsalicylic acid, and taking concurrent medication of any kind were more likely to result in a Pylera\u00ae recommendation. Taking concurrent medication, being from an eastern region of Europe and not taking probiotics were more likely result in a bismuth quadruple recommendation. Likewise, being from an eastern region, taking any concurrent medication, and not experiencing heartburn as a symptom were more likely to correspond to a bismuth salts therapy of any sort. Finally, being from the eastern region, Caucasian, and not taking rebamipid were more likely to correspond to a recommendation of non-bismuth quadruple therapy. (Figure 5C)"}, {"title": "Discussion", "content": "The H. pylori Al-clinician was developed to investigate whether optimal treatment should include prescribing subsets of patients' different therapies depending on their clinical variables. We found that this was the case. Overall, we found that Q scoring in individual models was in line with current trends in treatment recommendations 14,34, demonstrating the reliability of the Al Clinician method. Pylera and quadruple therapies with clarithromycin, amoxicillin, and bismuth salts or metronidazole, and sequential therapies showed the highest quality estimate by the Al clinician, in that order (and above triple therapies containing clarithromycin and amoxicillin or metronidazole). We also found that higher dose PPIs performed better than low and standard dose on average, suggesting most patients would benefit from a higher dose. Finally, while 10 and 14-day durations out-performed 7 day, they performed quite similarly in terms of quality estimate to one another, likely driven by Pylera\u00ae's increased effectiveness and 10-day formulation.\nWe found that 65.5% of patients were recommended a bismuth therapy by the majority of Al Clinician models trained on differing splits of data; while 15.5% were consistently recommended a non-bismuth quadruple therapy with clarithromycin, amoxicillin, and metronidazole. Overall, RF modelling was able to achieve a high balanced accuracy for the latter therapy, indicating that variables including presence in an eastern region, being Caucasian, and not taking rebamipid were highly indicative of a patient receiving a non-bismuth quadruple therapy recommendation. Pylera\u00ae was more likely to be recommended if a patient was from a southwest region and taking concurrent medication, but not acetylsalicylic acid. Non-bismuth quadruple therapies including clarithromycin, amoxicillin, and metronidazole were more likely to be recommended again if taking a concurrent medication, but instead from an eastern region and not taking probiotics.\nThe correspondence to region in personalized recommendations suggests several possibilities: that strains of H. pylori varying by region are driving the trend, that interactions between genetics and treatment are responsible, that trends in lifestyle varying by region are responsible, or a combination of the three. Further investigations to study a higher number of region-specific variables in detail will be needed to determine the explanation. Interestingly, though Pylera\u00ae did see the highest average Q score from modelling, it was not the most frequently recommended therapy overall (which was non-bismuth quadruple therapies), suggesting that the quality of Pylera\u00ae in patients consistently recommended it is higher than other treatments; which is to say these patients have a higher benefit from their optimal therapy than other groups.\nInterestingly, 19.0% of patients were recommended a variety of treatments, with no single category being recommended by more than half of models. In addition, most patients were not recommended the same treatment by every model generated by differing splits of training data. A further shortcoming of this study is that several treatment formulations (for example, the quadruple bismuth therapy including metronidazole, tetracycline, and bismuth subcitrate with PPI-which the single capsule Pylera\u00ae is based on) were not present in sufficient numbers in the dataset to be included in training due to the requirement of around 500 samples for stabilization in the network observed in our study. PPI dosage category was also divided into only two categories ('Standard or Low' and High') to reduce the number of therapy type subdivisions due to the limited number of samples of each treatment category, though there are well-documented differences in effect between low and standard PPI doses. These facts signal the need to collect additional data for model training and for the improvement of the sensitivity of the Al Clinician in the future.\nThough these results are encouraging in terms of increasing early eradication of H. pylori, future work should be focused on treatment of patients for which the damage of long-term infection has already been done. For example, a well-established point of no return for infections exists, past which gastric cancer often develops even after eradication of H. pylori. Investigating other data types such as endoscopy images and omics data, especially with advanced methods such as ML and Al will be crucial for determining what specific consequences of infection a patient is experiencing or at risk of experiencing, and what therapeutic strategies may be applied.\nWith over half the globe experiencing H. pylori infection at some point in their lifetime, there is a great need to apply advances in Al to evaluate and improve management and treatment, especially with regards to treatment recommendation standards. This work demonstrates the robustness of current recommendation standards throughout a diverse and heterogeneous population, lending support their broad administration. Further, this work demonstrates a fundamentally novel system for making personalized treatment recommendations based on patient data, opening the door to many potential future applications."}, {"title": "Methods", "content": "Variable Preprocessing\nThe Hp-EuReg Dataset was obtained on February 14th, 2024 and was taken from the AEG-REDCap platform. Data were recorded in an Electronic Case Report Form (e-CRF) using the collaborative research platform REDCap hosted at \"Asociaci\u00f3n Espa\u00f1ola de Gastroenterolog\u00eda\", a non-profit Scientific and Medical Society focused on Gastroenterology research.35 The dataset consisted of 73,313 patients and 321 patient variables, including treatment administered and outcome in terms of H. pylori eradication. Samples were filtered to include only first-line treatments administered to patients who complied with their full regimen (nsamples=52,801). In order to ensure sufficient training data for each treatment, treatments with <200 samples were also removed from the dataset (and therefore samples to which these treatments were administered, resulting in nsamples=48,335). Variable preprocessing was performed to achieve a format suitable for one-hot encoding, with numeric variables also treated as categorical. Age was then binned into four categories: 'Under 40' (n=16,165), '40-50' (n=12,794), '50-60' (n=13,699), and 'Above 60' (n=17,952). Finally, variables were filtered to remove those which were reflective of treatment outcome and to drop variables with more than 50 categories such as dates of visit, record ID, and physician comments (nvar=163). Variables were one-hot encoded for upstream analysis. (nsamples=48,335, none-hot_encodings=866)\nPPI Dose Mapping\nPPI doses were mapped to provide a structured framework for interpreting dose variability between different PPIs. Omeprazole doses of 80mg are considered 'High Dose' whereas doses of 10, 20, and 40mg are considered 'Standard or Low Dose'. For Lansoprazole, doses of 60 mg are considered high and 30 or 15mg are considered standard or low. For Pantoprazole, all doses are considered standard of low (including 20 and 40mg) whereas for Esomeprazole, 40 and 80mg are considered high, with 20 mg considered standard or low. Finally, Rabeprazole doses of 40mg are considered high whereas 20 and 10mg are considered standard or low. Only 501 patients were given a dose deviating from these values, which we consider 'non-traditional' and perhaps mis-entered, omitting this information and grouping with unlisted PPI values. Overall, 30,086 patients were given PPI doses considered 'High Dose', 20,180 were given doses considered 'Standard or Low Dose'. A large fraction of the dataset did not have a specified PPI dose by clinician, and when combined with non-traditional doses 22,047 termed 'Nondescript Dose' were included in the dataset."}, {"title": "Action Space Definition", "content": "The action space was defined in terms of antibiotic/PPI combination prescribed by the clinician as well as the dose of each medication, number of intakes (for example, twice a day), PPI dose category, and duration it was prescribed. For example, a quadruple bismuth regimen of clarithromycin (dose=500mg, twice daily), amoxicillin (1000mg, twice daily), bismuth salts (120mg, four times daily), and high dose PPI for a 14-day duration would be represented as a single numeric action. The action space was restricted to include only treatments with at least 500 examples in the dataset."}, {"title": "Independent-State Deep Quality Network Learning (isDQN)", "content": "The analysis method used to train our recommendation system, termed independent-state Deep Quality Network Learning (isDQN) takes the form of a traditional DQN analysis, except that optimizations to network weights do not consider a subsequent state when calculating loss. A deep neural network of four layers was implemented for this analysis, consisting of an input layer (nnodes=866, the number of one-hot encoded variables for each patient), two hidden layers (nnodes=128 each), and an output layer (nnodes=12, the total number of combinations of treatment and duration). Inputs to the optimization step consist of:\n\u2022 \u03a6, the state space, where $ = {\u03a61, \u2026, \u03a6nstate} and represents the set of binary (one-hot) encoded patient variables, and nstate=1265.\n\u2022 A, the action space, where A = {1, ..., Anaction} and represents the numerically encoded combination of treatment and durations of antibiotic combinations with durations of 7, 10, and 14 days, and therefore naction=12\n\u2022 R, the reward space, where R = {-1, +1} and +1 represents successful eradication, whereas -1 represents failed eradication."}, {"title": "Optimization", "content": "Optimization was performed via gradient descent on a smooth L1 loss function, which was chosen due to its lessened sensitivity to outliers and tendency to avoid exploding gradients. For a batch size N, loss is defined as:\nl(x, y) = mean(L) = mean({l\u2081, ..., l\u0145}T)\nWhere:\nl_n = \\begin{cases} \\frac{1}{2*\u03b2}(x_n - y_n)^2, & \\text{if } |x_n - y_n| < \u03b2\\\\|x_n - y_n| - \\frac{\u03b2}{2}, & \\text{otherwise} \\end{cases}\nWhere \u03b2 = 1, and N = number of patients per batch, and\nXn = Rn\nWhere Rn is the reward observed for patient n,\n\u0423\u043f = Q(\u0424n, an; \u03b8)\nWhere Q(Sn, an) is the quality score for the state-action (patient-treatment) pair of patient n determined by a forward pass through the neural network and are the neural network parameters.\nThe isDQN algorithm is modified from the original DQN algorithm detailed in Mnih et al.33 in Algorithm 1."}, {"title": "Selection of optimal treatment for Al recommendation", "content": "The Al-recommended action for a given patient is defined by:\n\u03b1*(\u03a6n) \u2190 argmaxa Q(\u03a6\u03b7; \u03b8)\nWhere the argmax function determines the state-action pair of highest Q-value by considering the quality of all possible actions for a given patient, defined by patient variables . Therefore, Q-scores of Al actions can be directly compared the Q-scores of Clinical decisions via Q(\u03c6\u03b7, \u03b1*(\u03c6\u03b7); 0)) and Q($j, aj; \u03b8), respectively."}, {"title": "Theoretical Al Clinician Testing", "content": "A synthetic dataset of 10000 patients with 100 binary variable features was generated. To model a dataset with imbalanced classes, patients were split into two groups of 7000 and 3000 patients respectively where binary variables were identical within groups by a random selection of O's and 1's. Next, noise was added to the dataset by introducing a random selection of a 0 or 1 at random intervals in each patient to a desired level. Datasets with noise levels of 5, 10, 25, 50, 75, and 99%% were generated. Each group of patients was 'treated' half of the time with treatment A and half of the time with treatment B, where treatment A was made 90% effective in group A and 80% effective in group B. Treatment B was made 90% effective in group B and 80% effective in group A. Rewards of +1 were assigned for 'successful' treatments and -1 for failures at the 90% and 80% rate described above. Training was performed on a balanced randomized 90-10 training-testing split, where optimization was carried out using Mean Square Error (MSE) loss and hyperparameters of batch size 1000, learning rate 0.001, deque size of 1000, and steps to optimize of 100. Evaluation of results was performed by counting the number of times a treatment with 90% effectiveness in its respective group was recommended to a patient from this respective group, for example treatment A recommended to a patient from group A."}, {"title": "Sensitivity Analysis and Hyperparameter Selection", "content": "To determine optimal hyperparameters in the context of a more complex dataset similar to Hp-EuReg, 50,000 patients were generated with 10 unique 'types' of 70 patient variables. For each of the ten groups, one treatment was given 90% effectiveness while all others were given 70% effectiveness, with no treatment being 90% effective in any two groups of patients. A hyperparameter grid was tested including: batch size of 1000, 5000, and 10000; a learning rate of 5*10-5, 10-4, 5*10-4, and 10-3; steps to optimize of 50 and 100; and a deque size of 1000, 5000, and 10000. Scoring of best hyperparameters was based on the fraction of treatments correctly recommended to patient group based on higher efficiency in training data. The hyperparameters chosen for further modeling had the highest percentage of correct recommendations of 99.9%, and consisted of a batch size of 1000, learning rate of 5*10-5, and deque size of 1000."}, {"title": "Single Model Examination", "content": "To examine average trends, Q scores were broken down by treatment categories including quadruple bismuth therapies with clarithromycin, amoxicillin, and bismuth salts, quadruple non-bismuth therapies with clarithromycin, amoxicillin, and metronidazole, sequential therapies with clarithromycin, amoxicillin, and tinidazole, triple therapies with clarithromycin and amoxicillin, triple therapies with clarithromycin and metronidazole, and Pylera\u00ae. All treatments include a PPI in the formulation. Treatments are also broken down by PPI dose into categories of low/standard and high. The subset of patients recommended a nondescript PPI dose was dropped from this analysis"}]}