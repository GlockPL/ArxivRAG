{"title": "FAP-CD: Fairness-Driven Age-Friendly Community Planning via Conditional Diffusion Generation", "authors": ["Jinlin Li", "Xintong Li", "Xiao Zhou"], "abstract": "As global populations age rapidly, incorporating age-specific considerations into urban planning has become essential to addressing the urgent demand for age-friendly built environments and ensuring sustainable urban development. However, current practices often overlook these considerations, resulting in inadequate and unevenly distributed elderly services in cities. There is a pressing need for equitable and optimized urban renewal strategies to support effective age-friendly planning. To address this challenge, we propose a novel framework, Fairness-driven Age-friendly community Planning via Conditional Diffusion generation (FAP-CD). FAP-CD leverages a conditioned graph denoising diffusion probabilistic model to learn the joint probability distribution of aging facilities and their spatial relationships at a fine-grained regional level. Our framework generates optimized facility distributions by iteratively refining noisy graphs, conditioned on the needs of the elderly during the diffusion process. Key innovations include a demand-fairness pre-training module that integrates community demand features and facility characteristics using an attention mechanism and min-max optimization, ensuring equitable service distribution across regions. Additionally, a discrete graph structure captures walkable accessibility within regional road networks, guiding model sampling. To enhance information integration, we design a graph denoising network with an attribute augmentation module and a hybrid graph message aggregation module, combining local and global node and edge information. Empirical results across multiple metrics demonstrate the effectiveness of FAP-CD in balancing age-friendly needs with regional equity, achieving an average improvement of 41% over competitive baseline models.", "sections": [{"title": "Introduction", "content": "Over the past two decades, global population aging has accelerated. By 2050, individuals aged 65 and older are projected to comprise 38% of the world's population (Rudnicka et al. 2020), posing new demands on urban infrastructure and services. To address these challenges, the World Health Organization (WHO) introduced the concept of Age-friendly Cities in 2007 (Organization 2007), highlighting the need for developing Age-friendly Communities (AFCs) to support aging populations (Menec et al. 2011). AFCs aim to improve the quality of life and social participation of elderly residents through enhanced community services. Research further shows that most elderly individuals prefer to age in residential communities rather than rely on institutional care services (Sun and Yang 2023). In this context, studying and optimizing the distribution of aging-related facilities and services within communities is essential for the effective development of age-friendly cities.\nUnfortunately, even in some of the most advanced and developed modern metropolises, the level of age-friendly infrastructure remains far from adequate (Wang, Gonzales, and Morrow-Howell 2017; Xie 2018). For instance, in Beijing, although 22.6% of the population was aged 60 and above by 2023, significant deficiencies in elderly care facilities persist. Our analysis, leveraging the 15-minute Walkability metric (Moreno et al. 2021)\u2014which evaluates resource accessibility and captures the ease of access to community-based elderly services-shows that only 40.85% of communities have senior care centers within a 15-minute walking distance, and merely 24.51% offer meal assistance services for the elderly. Furthermore, an analysis using Local Moran's Index reveals significant spatial inequalities in the distribution of elderly care facilities across Beijing's neighborhoods, as illustrated in Figure 1. More critically, as the aging population grows, demands for medical, recreational, and educational facilities become increasingly diverse and urgent (Yung, Conejos, and Chan 2016), yet current facility allocations fail to meet these needs or support AFCs development and regeneration.\nThe planning of age-friendly communities is crucial for achieving active aging among community seniors and establishing sustainable communities. The core task is to create an optimized spatial layout that reflects the needs of the elderly in urban areas (Sun and Yang 2023). Traditional large-scale urban planning, from initial sketches to detailed designs, is not only complex and time-consuming but also incurs substantial costs. In today's rapidly digitizing world, fueled by urban big data and advancements in artificial intelligence (AI), automated spatial layout design has not only become feasible but is also emerging as a prevailing trend. In recent years, a few studies have attempted to generate planning schemes automatically through deep generative techniques. For instance, Wang et al.(2020) proposed a generative model for land use allocation, utilizing geographic and human mobility data to build spatial graph representations and training a generative adversarial network with positive and negative sample contrasts. Wang et al.(2023) developed an instruction-based hierarchical planner (IHPlanner) that captures the spatial hierarchy and planning dependencies between urban functional zones and land use allocation using human instructions and the surrounding environment, generating land use configurations for vacant areas. Zheng et al.(2023) proposed a reinforcement learning (RL)-based urban planning model, constructing an urban adjacency graph with urban geographic elements (blocks, roads) as nodes and framing urban planning as a sequential decision-making problem on the graph. Additionally, some studies (Ye, Du, and Ye 2022; Eskandar et al. 2023) have viewed urban areas as two-dimensional images, treating scheme generation as an image generation task.\nAlthough these methods have advanced the field of automated urban planning scheme generation, they are limited in scope: either simulating urban development patterns at a macro level while neglecting detailed land use and building layouts, or coarsely updating land allocation without incorporating the urban multimodal data (Yong and Zhou 2024; Xu and Zhou 2024) of target communities. Moreover, no algorithms currently exist for generating planning schemes specifically tailored to age-friendly urban renewal. Addressing this critical technical gap is an urgent priority.\nRecently, diffusion models (Ho, Jain, and Abbeel 2020; Song, Meng, and Ermon 2020) have made significant advancements in the field of computer vision, becoming the most advanced deep generative models, surpassing other generative models such as Variational Autoencoders (VAEs) (Kingma and Welling 2013) and Generative Adversarial Networks (GANs) (Goodfellow et al. 2020). Diffusion models approximate complex data distributions by gradually removing small amounts of noise from a simple distribution. The refined denoising process enables these models to effectively fit complex distributions and generate high-quality data. In this study, we propose a fairness-driven age-friendly community planning method (FAP-CD) based on the denoising diffusion model guided by stochastic differential equations (SDEs). Leveraging conditional diffusion generation, this approach frames the planning problem as a facility graph generation task. It utilizes complex walking graphs to capture spatial relationships among regional facilities, aiming to better meet the needs of elderly residents while promoting fairness across regions.\nMore specifically, we deploy a unified graph noise prediction model that intricately interacts with the node and edge representations in both real-valued matrices and discrete graph structures. Initially, we develop a fair-demand pre-training module, utilizing min-max optimization (Pardalos, Migdalas, and Pitsoulis 2008) to derive spatial region representations that achieve maximum minimum entropy (Han and Sung 2021; Razaviyayn, Hong, and Luo 2013). These representations are meticulously crafted to reflect residential demands within the region and to promote equitable characteristics across communities. Subsequently, we guide the diffusion process by carefully adjusting the mean of the introduced Gaussian noise. During the denoising phase, we implement a hybrid graph noise prediction model, which comprises a message-passing layer on the discrete graph and a graph transformer layer. The message-passing layer is responsible for modeling the dependencies among the edges of neighboring nodes, while the transformer layer is dedicated to extracting and disseminating global information. Furthermore, we utilize a straightforward walking capability graph to support conditional discrete graph denoising and employ m-step random walk matrices, derived from the discrete adjacency matrix, to enhance the representation learning of nodes and edges.\nOur main contributions are summarized as follows:\n\u2022 We propose an efficient conditional discrete graph diffusion framework. To the best of our knowledge, this is the first study on generating AFCs planning that consider both elderly needs and equity.\n\u2022 We design a novel graph denoising diffusion network conditioned on fair-demand embedding and simple discrete structure to ensure practicality and fairness of the spatial layout in the generated grid layouts.\n\u2022 Extensive experiments on real-world multi-modal urban data demonstrate that FAP-CD delivers superior performance and significantly outperforms contemporary state-of-the-art methods. Additionally, we provide in-depth analyses to highlight the superiority of our framework."}, {"title": "Preliminaries", "content": "Given a city area divided into an H \u00d7 W grid map based on latitude and longitude, with each grid of size d x dm\u00b2, the grid regions are denoted as R = {r1,2,...,rk}, where k is the number of grid regions in the city. In our study, d is set to 2 km, and each grid encompasses the following aspects:\nUrban attributes. Urban attributes are the inherent social and geographic features of urban regions. A specific type of regional attribute can be denoted as A \u2208 \\mathbb{R}^{N\\times f_a}, where fa is the region attribute dimensions. In our work, multiple region attributes, like demographics and socio-economic indicators, are considered.\nWalking graph. For each grid region ri, we construct an undirected weighted graph, denoted as G = {N, E, A}, where N, E are the node set and edge set, respectively. A\u2208 {0,1}^{N\u00d7N} is the adjacency matrix to describe the walkable accessibility between every two nodes in the region. N \u2208 \\mathbb{R}^{D\\times f_a}, where D denotes the total number of facilities and fa dictates the distinct categories of facilities within the grids R. Each category is encoded using a one-hot representation. Additionally, textual modal descriptions of each facility are captured as grid features F\u2208 \\mathbb{R}^{N&d}.\nGrids region demand. This includes the current status of facility distribution on each grid region, based on Beijing's standards for facilities per thousand residents\u00b9 and the regulations for age-appropriate amenities\u00b2, we evaluate the existing facility on each grid. We classify the state of area facilities into four categories: no supply, under supplied, appropriately supplied, and oversupplied. We standardize each demand representation D \u2208 {0,1, 2, 3} N\u00d7N (i.e., high configuration, proper fit, low configuration, under allocation).\nAFCs Planning Generation. Given a set of grid regions R = {r1,r2,...,rk}, each characterized by grid demand D, urban region attribute A and grid feature F, our goal is to generate the AFCs planning that addresses equitable demands across various urban areas in different time intervals."}, {"title": "Preliminaries on Diffusion Process", "content": "Diffusion models are a class of generative models that generate samples by learning a distribution that approximates a data distribution. The first step in constructing diffusion models (Ho, Jain, and Abbeel 2020; Song, Meng, and Ermon 2020) is to define a forward diffusion process. Assuming a continuous random variable xo \u2208 \\mathbb{R}^{d}, the diffusion models consist of a forward process that gradually add noise to perturbs xo until the output distribution becomes a known prior distribution within the specified time range t in the interval [0, T], we have a Gaussian transition kernel as follows:\nq_{ot}(x_t|x_o) = N(x_t|a_tx_o, \\sigma_tI), \\tag{1}\nwhere at and \u03c3\u03b5 are time-dependent differentiable functions, usually chosen to ensure that the signal-to-noise ratio decreases. This ensures that qr(xT) \u2248 N(0, I), resulting in a tractable prior distribution with a low signal-to-noise ratio that is convenient for sampling. The forward process can be represented by the following SDE:\ndx_t = f(x_t,t)dt + g(t)dw_t, \\tag{2}\nwhere f(\u00b7, t) is the drift coefficient, g(t) is the scalar diffusion terms (a.k.a. noise schedule function), and wt is a standard Brownian motions on f(\u00b7,t). The reverse-time SDEs from time T to 0 is denoted as:\ndx_t = [f(t)x_t - g^2(t)\\nabla log q_t (x_t)]dt + g(t)d\\bar{w}_t, \\tag{3}\nwhere log qt (xt) is the score function and dwt is the reverse-time standard Wiener process. By learning to reverse this process, the diffusion model generates new samples from the data distribution.\nIn this work, to address the scarcity of elderly-friendly facilities and spatial inequity within contemporary urban structures, we adopt a diffusion model based on graph SDEs. Specifically, we abstract the spatial and facility relationships within grid region into a graphical representation, constructing a graph G = (X, A) composed of N nodes with features X\u2208\\mathbb{R}^{N\\times F} encoded using one-hot encoding to denote the types of facilities, and the adjacency matrix A \u2208 \\mathbb{R}^{N\\times N} (i.e., Ai,j = 1 if the walking time between node i and j is within 15 minutes)."}, {"title": "Methodology", "content": "Figure 2 illustrates the overall framework of FAP-CD, which can be divided into two stages: forward process and reverse process with conditional graph denoising. The fair-demand module learns to ensure a valid fair representation optimized by the min-max principle across regions, which serves as the condition supporting the graph denoising diffusion process.\nTo generate a target optimized spatial distribution map of facilities from noise in vector space, we design an attention mechanism-based fair-demand module as shown in Figure 3 (c). The denoising process utilizes the region-specific max-min fairness demand embeddings, which are learned through the fair-demand module, to guide the AFCs generation. Specifically, for each region ri, let Di denotes the representation obtained by concatenating the urban attributes and demand representations, then use a linear projection to obtain the query vector Q = D\u00bfWq. Subsequently, grid features are mapped through a fully connected layer to the same vector space to get the key vector K = FiWk and the value vector V = FW. The importance of region demand representations and the output are calculated as follows:\n\\alpha_i = softmax(\\frac{QF_i^T}{\\sqrt{dk}}), \\tag{4}\nH_i = \\alpha_i VW_H, \\tag{5}\nwhere Wo is the output projection matrix.\nIn this study, we advance beyond simply concatenating various conditional embeddings for control conditions. We focus on detailed modeling of demand interactions among facilities and the semantic characteristics of residential areas, while also addressing inter-regional fairness. Our refined conditional embedding, represented as Ci = Hi 0 Fi, empowers the model to adaptively leverage these representations for more nuanced and effective outcomes.\nTo generate a distribution of service facilities that meets the requirements of age-friendliness and spatial fairness, we develop a pre-trained model optimized based on the principle of max-min entropy. This framework has been widely applied across various optimization and control domains (Liu, Dai, and Luo 2013; Zhang, Lemoine, and Mitchell 2018; Wai et al. 2019). Our model is trained by minimizing the loss function:\nL = \\frac{1}{n} \\sum_{i\\in M} (\\frac{1}{|R_i|} \\sum_{j \\in R_i} -p_{ij} *log(p_{ij})) + \\lambda, \\tag{6}\nwhere pi = \u03a3j=1 Pij, represents the normalized probability distribution, while pij = 0 if j \u2208 Ri. The term pij is the softmax output of Oi, n is the batch size, Ri denotes the index of the residence within the grid region. M represents the maximum number of facilities per region."}, {"title": "Discrete Graph Diffusion Model", "content": "In this work, we formulate the AFCs planning generation task in a conditional SDEs-based graph denoising framework. Inspired by (Jo, Lee, and Hwang 2022; Vignac et al. 2022) which treats (X, A) as a whole and omit the intrinsic graph structure. we diffuse separately on each node and edge feature of the constructed graph G = (X, A). We apply the variance-preserving SDE introduced by (Song et al. 2020), which in its discrete-time manifestation adopts the framework of a denoising diffusion probabilistic model (Ho, Jain, and Abbeel 2020). Similarly to diffusion models for images, which apply noise independently on each pixel, we diffuse separately on each node and edge feature. Roughly speaking, the forward diffusion process for each graph sample can be described by the SDE with t \u2208 [0,T] as:\ndG_t = f(G_t,t)dt + g(t)d(w_{X_t}, w_{A_t}), \\tag{7}\nwhere wX, and wA\u2081 are independent standard Wiener processes for the node and edge, respectively. This forward SDE shares the same transition distribution as in Eq. 1 to conveniently sample Gaussian noise Gt = \u03b1tGo + steg at any time t. For undirected graphs, noise is applied only to the upper triangular part of E and then symmetrized to maintain the undirected nature of the graph.\nIn the reverse process with conditional denoising, FAP-CD defines the conditional reverse diffusion process Po(Gt-1|Gt, C, \\bar{A}), which performs iterative denoising from pure Gaussian noise to generate optimized spatial facilities in vector space. This process is conditioned on the region fair-demand embeddings C and a discrete adjacency matrix A, representing facility nodes within a 15-minute walk from residential areas. The corresponding reverse-time SDEs are given by:\ndX_t = [f(t)X_t - g^2(t)\\nabla_x log q_t (X_t, A_t)] dt + g(t)dw_{X_t}, \\\\\ndA_t = [f(t)A_t - g^2(t)\\nabla_a log q_t (X_t, A_t)] dt + g(t)dw_{A_t}. \\tag{8}\nThen, we train two time-dependent score networks \\epsilon_{\\theta,x}(\u00b7) and \\epsilon_{\\theta,A}(\u00b7) i.e., the parametric score function, for estimating the score \\nabla x log qt (Xt, At) and \\nabla A log qt (Xt, At) for both (Xt, At), separately. The denoising score matching objective (Vincent 2011) is modified for score estimation training as:\nmin E_t{\\chi(t)E_{G_oEG_t|G_o} [||\\epsilon_x - \\epsilon_{\\theta,x} (G_t, C, \\bar{A}_t, t)||^2 + ||\\epsilon - \\epsilon_{\\theta,A}(G_t, C, \\bar{A}_t, t)||^2]}, \\tag{9}\nwhere \u03c7(t) is a given positive weighting function to keep the transition kernel pot(xt|x0) to be a tractable Gaussian distribution. ex = xlog Pot (XtXo) and EA = Valog Pot (At A0) are the sampled Gaussian noise. For the diffusion step t, we use a positional encoding method as described in Ho, Jain, and Abbeel(2020), followed by two fully connected layers before feeding into the denoising network."}, {"title": "Conditional Graph Denoising Network", "content": "The architecture of our denoising network is shown in Figure 3 (a). The conditional denoising network processes a noisy graph represented by Gt = (Xt, At), alongside the regional fair-demand embedding C and the discrete graph A as input conditions. The backbone network of our diffusion model integrates the graph transformer, as proposed by (Dwivedi and Bresson 2020), with standard message-passing networks to form a Residual Hybrid Layer. This design enhances the model's ability to effectively process and integrate graph-based data. To incorporate time information, we normalize the time step to [0, 1] and treat it as a global feature to add noise. It outputs tensors X and A in different time intervals t, which respectively represent the optimization distribution over clean graphs.\nGraph Transformer Block. In each layer, the attention weights between every pair of nodes are calculated through self-attention. Notably, the calculation of attention weights for the propagation of information between nodes also incorporates the influence of edge features.\n\\alpha_{i,j} = softmax(-\\frac{(tanh((WE_{i,j}))Q_{k,l})K_{k,l}}{\\sqrt{dk}}), \\tag{10}\nM_{i}^{l+1} = \\sum_{j=0}^{N-1} \\alpha_{i,j} (tanh(W^{(l)}(E_{i,j})). V_{k,l}), \\tag{11}\nwhere Ei,j is the corresponding image-like tensor i.e. edge feature, Q, K, V are projected from the node features HD, H(l+1) \u2208 ]\\mathbb{R}^{N\\times d} represents the node outputs, W() and W(1) are learnable parameters, tanh is the activation layer and l is transformer layer. Our transformer layers also feature residual connections and layer normalization.\nMessage Passing Block. Since the graph transformer captures global graph information, in our task, there is also a need to focus on neighboring nodes within a 15-minute walking range. Therefore, we rely on the decoded discrete graph structure and employ a standard message-passing layer based on the Graph Convolutional Network (GCN) to aggregate local neighbor edge features. Then, we feed the node outputs H(1+1) into the FFN(1), which comprises a multi-layer perceptron (MLP) and a normalization layer. Finally, we obtain the aggregated node output H  \\mathbb{R}^{Nxd} and the corresponding edge features E(1+1) \u2208 \\mathbb{R}^{NxNxd}.\n\\bar{H}_{i}^{l+1} = FFN(H_{i}^{l+1}), \\tag{12}\nE_{i,j}^{l+1} = FFN(H_{i}^{l+1} + \\bar{H}_{i}^{l+1}). \\tag{13}\nNext, node and edge outputs from the graph transformer and message passing blocks are independently aggregated, then each fed into a fully connected layer. The resulting outputs, ee,x and ee, A, are computed by aggregating data via skip connections from each residual hybrid layer, followed by processing through an MLP and three Conv1x1 blocks.\nAugmentation Module. We design a module to enhance node and edge features within graphs by incorporating statistical properties such as degree and centrality. Furthermore, using an m-step random walk derived from the discrete adjacency matrix, we develop m-step random walk matrices to employ the arrival probability vectors concatenated with original node features as enhanced node embeddings. Similarly, truncated shortest-path distances obtained from the same matrix are used to augment edge embeddings. Through node and edge augmentation, the network can comprehensively model the noisy topology structure from both node and edge perspectives at each diffusion step."}, {"title": "Experiments", "content": "We develop our model using real-world datasets, focusing on Beijing. We obtain geographic information from OpenStreetMap, including road networks and administrative divisions. Additionally, we source 149,049 Points of Interest (POIs) within the city from Baidu Maps\u00b3, categorized into 11 types such as food, medical services, etc. We also gather data on 568 senior meal programs and 1,472 senior care centers from4. In collaboration with the real estate agency, we acquire comprehensive data on 8,201 residential areas, detailing housing prices, property fees, community populations, and elderly populations over age 60.\nEvaluation Metrics. To comprehensively evaluate our model, we employ a set of evaluation metrics that take into account facility types, spatial distribution and fairness, which provide a multi-dimensional view of the effectiveness and equity of the allocations. The key evaluation metrics include: Efficiency=RK\u03a3\u03a3\u03a3 maxne Nik Ain,h\n( 1 Diversity = \u03a3\n \u03a3{Cij | j Si and Cij R} Accessibility=\n Gini=1"}, {"title": "Experimental Results", "content": "Table 1 shows the overall comparison results in terms of all evaluation metrics in Beijing. Our observations based on the results are as follows. First, the AFCs planning generated by FAP-CD achieves the best realism in terms of both facility distribution efficiency and equity. Specifically, compared with the best baseline, the Accessibility is improved by over 29% and Gini index reduced over 28%, respectively. Moreover, our model outperforms all baselines on average by a large margin. Second, We discover that when categorizing facility allocations, traditional resource allocation models, particularly DRF, exhibit superior diversity. This superiority arises because the facility allocations in methods AC and GA are guided by a demand-driven pheromone update mechanism and fitness functions, respectively, and are also influenced by stochastic factors.\nOur analysis further reveals that the overall performance of the EDGE is inferior to that of DDPM and our model. This indicates that while graph generation guided by node categorization presents significant advantages in terms of graph discretization and time efficiency, relying solely on a denoising network composed of MLPs and Gated Recurrent Units (GRUs) to extract neighborhood and global spatial information from the graph does not optimize graph generation. This underscores the relative advantages of our hybrid message passing and augmentation strategy."}, {"title": "Ablation Study", "content": "We conduct an ablation study to validate the efficacy of the Residual Hybrid Layer. Results in Figure 4 indicate that incorporating the residual hybrid module (w/o RHL) within the denoising model enhances AFCS generation performance by up to 105.1% according to metric accessibility. Additionally, ablation experiments are conducted separately on the graph transformer block (w/o GTB) and message passing block (w/o MPB) within the denoising network, revealing that removing either mechanism causes performance degradation to varying degrees. We also evaluate the impact of the node and edge attribute enhancement module (w/o AM) within the SDE-based diffusion model. As shown in Figure 4, this design yields up to a 13.1% improvement in performance according to metric Gini, marking the most significant enhancement observed."}, {"title": "Hyperparameters", "content": "We next conduct experiments on various hyperparameters, including the number of residual hybrid layers in the conditional graph denoising network and the dimension of hidden variables. As illustrated in Figure 5 (a), the results show that a shallow and appropriate number of layers (three in this case) is crucial for FAP-CD, as overly deep networks tend to overfit, leading to a decline in performance. Figure 5 (b) examines the impact of hidden variable dimension size. The results indicate that an optimal hidden size (e.g., 128) enhances model performance, whereas excessively large dimensions (e.g., 256) do not improve performance and increase the computational burden."}, {"title": "Visualization of Generated AFC Configurations", "content": "Figure 6 presents a visual comparison between the original and generated AFCs in Beijing, analyzing the facility distribution across various land parcels. The results show that the generated plan not only enhances community diversity but also significantly improves the efficiency of aging-friendly facility distribution. Furthermore, our model optimizes the spatial arrangement of these facilities. For example, in the lower grid, areas highlighted in green as 15-minute walkable zones and outlined by red boxes now enjoy improved access to previously hard-to-reach facilities, such as hospitals and parks. This enhancement is facilitated by reconfigured roadways, including major urban renewal projects like subways and overpasses. Thus, FAP-CD offers urban planning experts valuable insights for facility planning and clearly demonstrates its potential to optimize spatial allocations."}, {"title": "Related Work", "content": "Diffusion Models. Diffusion models, as an emerging generative technique, have demonstrated exceptional capabilities in fields such as computer vision (Dhariwal and Nichol 2021), natural language processing (Li et al. 2022), and graph generation (Niu et al. 2020; Vignac et al. 2022). These models operate through two main phases: an initial noise addition phase and a reverse denoising phase that restores noisy data to complex distributions. The most pertinent works involve the application of diffusion models to graph generation tasks (Niu et al. 2020; Vignac et al. 2022; Huang et al. 2023). For instance, Niu et al.(2020) used score-based models with Gaussian noise for permutation-invariant graph, while Jo, Lee, and Hwang(2022) and recent studies (Vignac et al. 2022; Haefeli et al. 2022) explored the potential of diffusion models for generating node and edge-enhanced graphs and using multinomial noise for discrete models that preserve graph sparsity and enhance quality. Moreover, incorporating additional information as conditioning cues is crucial for targeted generation. For example, Zhou et al.(2023) designed a novel diffusion process to generate city mobility flows, which are guided by a volume estimator and influenced by regional features.\nInspired by the significant success of diffusion models, our study integrates age-friendly needs and urban region characteristics into our model to optimize AFCs planning. This study explores the capabilities of graph diffusion models in strategic planning for AFCs, aiming not only to develop configurations for community revitalization but also to provide insights into optimal geographic locations.\nAutomated Planning Generation. Traditional urban planning methods have encountered many challenges in practice, including high cost, low efficiency, lack of skilled facilitators, and low interest to participate (Abas et al. 2023). Recently, the remarkable success of deep generative learning has led researcher about automated planning generation to improve the efficiency of urban planning. For example, Wang et al.(2023) eveloped an instruction-based hierarchical planner (IHPlanner), which automatically captured the spatial hierarchy and planning dependencies between urban functional zones and land use allocation based on human instructions. Zheng et al.(2023) proposed a RL-based urban planning model that trained a value network to enhance spatial planning quality focusing on the completeness of the 15-minute city concept (Moreno et al. 2021), with the aim of improving the efficiency of transportation, services, and ecological systems in urban regions. However, these plans are either completed based on single human instructions or remain inherently time-consuming. Furthermore, they lack scalability in age-friendly service facilities and do not address issues of planning efficiency and fairness. Compared to these efforts, the FAP-CD model is more advanced in automation and the facilitation of age-friendly urban planning."}, {"title": "Conclusion", "content": "In this work, we propose a novel conditional graph diffusion model FAP-CD, which transforms the planning issue into a problem of graph generation by constructing a detailed walking graph of spatial relationships among facilities within a region. This model leverages fair-demand guidance enhancement and discrete graph structure adjustments along with a finely tuned graph noise prediction network to generate AFCs planning during the reverse denoising process. Extensive experiments and case studies validate FAP-CD's effectiveness, enhancing efficient and equitable age-friendly urban renewal planning and supporting sustainable urban development amid rapid global aging."}, {"title": "Appendix", "content": "Urban Geospatial Dataset. The urban geospatial dataset employed in this study encompasses a comprehensive collection of geographic information within the Beijing metropolitan area, including pedestrian road networks, building footprints, and township-level administrative divisions. The pedestrian road networks are used to generate service areas of 15-minute walking life circles surrounding residential areas. The administrative division data are organized at the township and community levels of Beijing's governance boundaries. The building footprint data outlines the spatial extent and structure of individual buildings.\nSenior Service Dataset. The senior service dataset encompasses POI data specifically focused on elderly service stations and senior meals canteens within Beijing. For the elderly service stations, data points include the station's level, the range of services provided, insurance accreditation status, and details about the establishment of medical rooms within the facilities. Regarding the senior meal canteens, the dataset provides essential information such as the addresses, operating hours, and pricing of the food offered.\nResidential Area Dataset. The residential area dataset comprises the residential communities within Beijing. The basic information includes fundamental details about each residential area, such as the name, address, geographical coordinates, house prices, total numbers of buildings, and housing units. Additionally, we integrate data from the 2020 Seventh National Population Census of China to obtain more precise figures for the resident population and the elderly population aged 60 and above within each residential area, which allows for a more accurate analysis of demographic trends and the specific needs of different communities. In Figure 7, we visualize the distribution of facility categories and assess the per capita availability throughout Beijing.\nOur experimental dataset contains 466 grid regions with residential areas. The number of facilities in these grids ranges from a minimum of 10 to a maximum of 399, including residences.\nIn our experiments, we set the number of diffusion steps to 200, adopting a 3st-order DPM-Solver (Lu et al. 2022) and utilizing a cosine noise scheduler as proposed by Nichol and Dhariwal (2021). Our model is trained for 1000 epochs, using four residual layers in the graph denoising network with a hidden embedding dimension of 128. The Adam optimizer is employed with an initial learning rate of 3e-4, following a decay schedule of le-2. The batch size for the graph denoising network is set to 8. The number of random walks in the augmentation module is set to 20. For the fair-demand module, the training is conducted for 60 epochs with a batch size of 6 and a learning rate of le-5.\nTo ensure a fair comparison, we use node embeddings from our pretrained model as the initial node features for VAE and GraphRNN, and a MLP decoder with inner product computation for edge existence to reconstruct the graph structure.\nWe provide a detailed description of the experimental setup in the baseline EDGE, which refers to the experimental setup for hierarchical generation with EDGE in Appendix E to generate graphs with node attributes. Specifically, node attributes are represented as one-hot vectors, we have a matrix X \u2208 {0,1}^{N\u00d7Cnode}, while adjacency matrix is described by the matrix A \u2208 {0,1}^{N\u00d7N} to indicate whether the edge exists or not. In this context, Cnode denotes the number of classes for node types. We consider the following joint model:\np(X, A) = p(X)p(AX) \\tag{14}\nWe first sample node attributes, employing the node sequence length Cnode instead of the node degree sequence modeling. For p(A|X), we apply the EDGE framework, incorporating node features from X during both the training and generation phases. Subsequently, the graph structure is sampled using EDGE, conditioned on node attributes."}, {"title": "Hyperparameters for SDE", "content": "We apply the variance-preserving SDE (VPSDE) introduced by (Song et al. 2020) for graph data Gt, whose discrete-time form is a denoising diffusion probabilistic model. Considering the linear scaling function \u03b2(t) = \u03b2min + t(\u03b2max - \u03b2min) for t \u2208 [0,T], and f(t) = \u2212\u03b2(t), g(t) = \u221a\u03b2(t), we derive the SDE from equation 2 presented in the main text as:\ndG_t = -\\frac{1}{2} \\beta(t)G_tdt + \\sqrt{\\beta(t)}dw_t, \\tag{15}\nwhere \u03b2(t) follows a monotonically decreasing cosine schedule across different timesteps t and controls the noise scale. The values for \u03b2max and \u03b2min are set to 20 and 0.1, respectively. The parameters of VPSDE are used without further tuning, maintaining a small signal-to-noise ratio at Gt."}, {"title": "Details of Evaluation Metrics", "content": "The metrics primarily assess the efficiency, spatial layout, and fairness of the generated plans. Specifically, to evaluate the coverage of daily life needs and the elderly-friendliness of the plans, we calculate the efficiency of both elderly care and life services. Efficiency measures the extent to which facilities cover residential nodes and assesses the overall effectiveness of the plan by averaging the coverage rates across sample grids. To assess the diversity of facility types within the plan, we introduce the Diversity metric, which evaluates the variety of facilities across different grids. Accessibility (Talen and Anselin 19"}]}