{"title": "Dual-Constrained Dynamical Neural ODEs for Ambiguity-aware Continuous Emotion Prediction", "authors": ["Jingyao Wu", "Ting Dang", "Vidhyasaharan Sethu", "Eliathamby Ambikairajah"], "abstract": "There has been a significant focus on modelling emotion ambiguity in recent years, with advancements made in representing emotions as distributions to capture ambiguity. However, there has been comparatively less effort devoted to the consideration of temporal dependencies in emotion distributions which encodes ambiguity in perceived emotions that evolve smoothly over time. Recognizing the benefits of using constrained dynamical neural ordinary differential equations (CD-NODE) to model time series as dynamic processes, we propose an ambiguity-aware dual-constrained Neural ODE approach to model the dynamics of emotion distributions on arousal and valence. In our approach, we utilize ODEs parameterised by neural networks to estimate the distribution parameters, and we integrate additional constraints to restrict the range of the system outputs to ensure the validity of predicted distributions. We evaluated our proposed system on the publicly available RECOLA dataset and observed very promising performance across a range of evaluation metrics.", "sections": [{"title": "1. Introduction", "content": "Speech emotion recognition plays an important role in building the next generation of human-machine interactions [1]. Dimensional representation, describing emotions with continuous values on affect dimensions (e.g., arousal and valence), allows for broader descriptions of the complexity and richness of emotion, making it extensively utilised in the speech emotion recognition research community [2, 3]. Typically, the continuous emotion labels (also denoted as ratings) are collected from a group of human raters by asking for their perceptual evaluations of the same speech or video recordings. This is depicted in the top plot of Figure 1, where dashed lines represent the various arousal ratings collected from 6 raters. The differences in perception, referred to as inter-rater ambiguity [4], reflect the subtlety of natural emotions, and this ambiguity should be taken into consideration when developing emotion recognition systems.\nUntil recently, researchers in affective computing have often treated this ambiguity as noise and used the average ratings from multiple raters as a 'gold standard' [4, 5]. However, there is now growing recognition that inter-rater ambiguity in emotion labels conveying information about the emotion state and such ambiguity is being taken into account by treating arousal/valence labels as distributions [6-9]. This paradigm shift has spurred the development of ambiguity-aware emotion prediction systems that predict emotion states as distributions on the arousal/valence dimensions, rather than conventional mean predictions [6-11]."}, {"title": "2. Related work", "content": "Recent years have witnessed an increasing amount of effort on modelling and predicting the ambiguity associated with emotion labels, often treated as probability distributions [6, 14, 16]. However, the majority of existing research primarily addresses the ambiguity in predictions while neglecting the temporal dependencies, treating distributions at each time step as independent. Among the few studies addressing temporal dependencies in emotion distributions, initial methods modelled emotion labels using Gaussian Mixture Models (GMMs) without considering temporal dynamics [6]. Subsequent improvements incorporated Kalman filters to account for the temporal evolution of GMM parameters [14]. However, this approach assumes that the temporal dynamics follow a linear dynamical system. Zhang et al. proposed using Bidirectional LSTM to estimate the means and standard deviations of Gaussian-distributed labels [17], but the poor prediction in standard deviations suggests the unsuitability of the predefined distribution types. While LSTM learns temporal dependencies in the parameters, it lacks transparency and flexibility in integrating constraints or prior knowledge on emotion dynamics. More recent efforts, such as a system utilizing a Sequential Monte Carlo approach, explored predicting time-varying emotion distributions with a non-linear dynamical system, yet focused solely on the dynamics of distribution means [7]. These approaches either operate in separate stages rather than end-to-end, apply simplistic linear constraints or make specific and inappropriate assumptions about distribution dynamics, or lack the flexibility in incorporating constraints. On the other hand, the CD-NODE system captures the temporal dynamics of emotions without imposing predefined assumptions on their evolution, facilitating end-to-end modelling and allowing for incorporating constraints, which has shown superior performance in continuous emotion prediction [15]. However, it only predicts mean arousal/valence ratings and neglects the associated ambiguity."}, {"title": "3. Overview of CD-NODE", "content": "The recently published CD-NODE was developed to model time series with additional constraints on the dynamics of the predicted quantity. It models the continuous emotion labels (i.e., arousal/valence ratings) \\(y(t) = \\{y_{t0}, y_{t1}, \u2026\u2026\u2026, y_{tN} \\}\\) as a non-linear dynamical process using ODE with governing function \\(f\\) parameterized by neural networks \\(\\theta\\), and the dynamics in \\(y(t)\\) is dependent on both the input speech features \\(x(t) = \\{x_{t0}, x_{t1}, ..., x_{tN} \\}\\) and previous \\(y\\). It is defined as:\n\n\n\n\n\\frac{dy(t)}{dt} = \\Phi(f(x(t), y(t); \\theta)))\n\n\n\n\n(1)\n\n\n\nThe function \\(\\Phi(\u00b7)\\) is an additional constraint to limit the rate of change of \\(y(t)\\), which controls the smoothness of \\(y(t)\\) as:\n\n\n\n\n\\Phi(\u00b7) = a * tanh(\\frac{\u00b7}{a})\n\n\n\n\n(2)\n\n\n\nwhere \\(a\\) is a hyperparameter that can be tuned based on the characteristics of \\(y(t)\\). A smaller \\(a\\) results in a smoother trajectory of \\(y(t)\\) and vice versa. The governing function \\(f\\) can be parameterised by any network structure that approximates the nonlinear function in ODE. The final trajectory of \\(y(t)\\) is obtained by solving an ODE initial value problem as shown in Equation (3).\n\n\n\n\n\\mathbf{y}(t) = \\text{ODESolve}(f, \\theta, y_{t0}, t_{0},..., t_{N}, \\mathbf{x}(t))\n\n\n\n\n(3)"}, {"title": "4. Proposed CD-NODE", "content": "While the original CD-NODE based system only predicts the mean arousal/valence rating, this paper proposes an ambiguity-aware dual-constrained Neural ODE, referred to as, CD-NODE\\(\\gamma\\), that predicts ambiguous arousal/valence states as time-varying Beta distributions as suggested in [16] that Beta distributions are highly suitable for modelling emotion ambiguity. Furthermore, in addition to the explicit smoothness constraint which was a key feature of the CD-NODE, we introduce a second constraint \\(\\gamma\\), which restricts the system output to fall within a given range, which in turn helps ensure the validity of the predicted distributions.\n4.1. Model Structure\nAssuming the arousal/valence at time \\(t_n\\) is represented by a beta distribution that is parameterised by \\(\\psi_{t_n}\\), the aim of the emotion prediction system is to predict \\(\\Psi(t) = \\{\\psi_{t0}, \\psi_{t1},..., \\psi_{tN}\\}\\) given a sequennce of input speech features \\(\\mathbf{x}(t) = \\{\\mathbf{x}_{t0}, \\mathbf{x}_{t1}, ..., \\mathbf{x}_{tN}\\}\\). The most likely emotion intensity and the associated ambiguity can then be inferred from the predicted beta distribution, \\(\\psi_{t_n}\\), at each time step.\nThe Beta distribution is typically parameterised using two parameters, denoted as \\(\\psi_{t_n} = \\{\\psi^1_{t_n}, \\psi^2_{t_n}\\}\\). This then leads to a multi-task learning framework to model \\{\\psi^1_{t_n}, \\psi^2_{t_n}\\}:\n\n\n\n\\frac{d \\psi^{i}(t)}{dt} = \\Phi^{i}(f^{i}(\\mathbf{x}(t), \\psi^{i}(t); \\theta^{i})), i \\in [1, 2]\n\n\n\n(4)\n\n\n\nwhere \\(i \\in [1,2]\\) corresponds to the two parameters, \\(f^{i}\\) are the two governing functions modelled as neural networks with the aim of learning to predict \\(\\frac{d \\psi^{i}(t)}{dt}\\). They are each constrained with their own smoothness constraint function \\(\\Phi^i\\).\nNoting that the parameters of any beta distributions will have constraints to ensure a resulting distribution is valid (for e.g., when using the mode and concentration parameterisation of a beta distribution, the concentration must be higher than 2 to ensure a bell shaped distribution), we impose an additional constraint function \\(\\gamma(\u00b7)\\) to limit the range of \\(\\psi^1\\) and \\(\\psi^2\\). Thus, the final outputs are obtained as per equation (5).\n\n\n\n\\psi^{i}(t) = \\gamma^{i}(\\text{ODESolve}(f^{i}, \\theta^{i}, \\psi^{i}_{t0}, t_{0},......, t_{N}, \\mathbf{x}(t)))\n\n\n\n(5)\n\n\n\nFinally, the loss function for the proposed multi-task learning framework is taken as:\n\n\n\n\\mathcal{L} = \\lambda_1 \\mathcal{L}_1 + \\lambda_2 \\mathcal{L}_2\n\n\n\n(6)\n\n\n\n\\mathcal{L}_i = 1 - \\rho_c(\\psi^{i}(t), \\hat{\\psi}^{i}(t)), i \\in [1, 2]\n\n\n\n(7)"}, {"title": "4.2. Constraint Function: \u03b3", "content": "where \\(\\lambda_i\\) are scaling factors; and \\(\\mathcal{L}_i\\) are loss functions for \\(\\psi^i(t)\\), dependent on the concordance correlation coefficient (CCC) \\(\\rho_c\\) between the predicted \\(\\psi^{i}(t)\\) and the ground truth \\(\\hat{\\psi}^{i}(t)\\) [15]. The model aims to minimize \\(\\mathcal{L}_i\\), i.e., maximizing the CCC.\nThe initial stage of our approach involves identifying the most suitable parameter pairs for the Beta distribution in our proposed CD-NONEY. This is a crucial step in ensuring that our model can effectively learn the distributional properties of emotions. The most commonly used parameter pairs include: shape parameters \\(\\{a,b\\}\\), and \\(\\{\\text{mean}(\\mu), \\text{variance}(\\sigma^2)\\}\\) and \\(\\{\\text{mode}(\\omega), \\text{concentration}(\\kappa)\\}\\) which indicate the central tendency (\\(\\mu\\) or \\(\\omega\\)) and spread (\\(\\sigma^2\\) or \\(\\kappa\\)) of the distribution. We observed that shape parameters \\(\\{a,b\\}\\) are less interpretable compared to \\(\\{\\mu, \\sigma\\}\\) and \\(\\{\\omega, \\kappa\\}\\). Furthermore, when comparing \\(\\{\\mu, \\sigma\\}\\) to \\(\\{\\omega, \\kappa\\}\\), we observe that both \\(\\mu\\) and \\(\\sigma\\) are both bounded to the interval [0, 1], while only \\(\\omega\\) is bound to a finite interval with the only bound on \\(\\kappa\\) being \\(\\kappa > 2\\). The lack of an upper bound to \\(\\kappa\\) leads to dramatic changes in its dynamics which makes a CD-NODE that predicts \\(\\{\\omega, \\kappa\\}\\) harder to train. Therefore, we chose \\(\\{\\mu, \\sigma\\}\\) to represent the Beta distributions. Consequently, we design the constraint functions \\(\\gamma_i\\) as in equation (8) for both \\(\\mu\\) and \\(\\sigma\\) as:\n\n\n\n\\Upsilon_{\\mu} = pS(\u00b7), \\gamma_{\\sigma} = qS(\u00b7)\n\n\n\n(8a)\n\n\n\n0 < p < 1,0 < q^2 < \\min(p^2, \\frac{2p-p^2}{1+p})\n\n\n\n(8b)\n\n\n\nwhere, \\(S(.)\\) denotes a sigmoid function and is used to constrain the output to [0, 1], and \\(p\\) and \\(q\\) are adjustable constants that must satisfy the relationship as per equation (8b) in order to ensure the Beta distribution is bell shaped [18]."}, {"title": "5. Experimental Settings", "content": "5.1. Dataset\nThe RECOLA dataset is one of the most commonly used multimodal corpus which consists of 9.5 hours spontaneous dyadic conversation recordings in French [19]. There are 9 five-minute utterances each in the training and development sets, identical to the data partition in the AVEC challenge 2015 [20]. Since the challenge test sets are not publicly available, the system is trained and the hyperparameters are optimized using the training set and tested on the development set as per standard practice [7, 15, 18, 20]. The dataset is annotated by 6 human raters with continuous arousal and valence labels within range [-1, 1], with sampling rate of 40ms.\n5.2. Beta distribution parameter estimation\nTo obtain the ground truth beta distribution, we follow the same approach used in [18] to estimate the Beta distribution parameters. The original ratings are first mapped to range \\(x \\in [0, 1]\\) via a linear transformation \\(y = 0.4975x + 0.5\\) in order to perform the Beta fit. To compute the Beta parameter at each frame, the ratings from neighbouring F frames are concatenated as \\(\\tilde{y} = [y_{n-F} : y_{n+F}]\\), \\(y_n\\) refers to the labels from 6 raters at frame \\(n\\) to avoid overfitting. F is 6 and 1 for arousal and valence respectively as suggested in [18]. Finally, the Beta parameters \\(\\Psi_{t_n}\\) are obtained by Maximum A Posterior (MAP) as:\n\n\n\n\\Psi_{t_n} = \\arg \\max_{\\Psi} [\\prod_m P(y_{n,m}|\\Psi)P(\\Psi)]\n\n\n\n(9)\n\n\n\nwhere \\(y_{n,m}\\) denotes the rating from the \\(m^{th}\\) rater at frame \\(n\\); \\(p(y_{n,m}|\\Psi)\\) refers to the posterior probability of \\(y_{n,m}\\); and \\(P(\\Psi)\\) refers to the prior probability which is estimated with kernel density estimation, the same as in [18].\n5.3. System configurations\nFeatures. The Bag-of-audio-words(BoAW) feature representations are extracted with 100 clusters from 20-dimensional MFCCs using OpenXbow [21]. Detailed explanation refers to [22]. 4 second delay compensation is applied to both arousal and valence to compensate the annotation delay [23].\nNetwork parameters. A fully connected (FC) layer with 64 neurons and tanh activation function is first employed to transfer the BoAW features. The following \\(f_1\\) (i.e., \\(f_{\\mu}\\)) and \\(f_2\\) (i.e., \\(f_{\\sigma}\\)) for modelling dynamics of \\(\\mu\\) and \\(\\sigma\\) are composed of three FC layers respectively, with tanh activation function applied for the first two layers to enforce the nonlinearity, and the smoothing constraint applied to the last FC layer (c.f. Equation (8)), with \\(a_{\\mu} = 0.5\\) [15] and \\(a_{\\sigma} = 10\\) which is optimized within \\(\\{0.5, 1, 2, 4, 6, 8, 10, 15\\}\\) for both arousal and valence. For the proposed constraints in Equations (2), we chose \\(p = 0.75\\) for both arousal and valence as 95% of the ratings are within the range [0,0.75], and \\(q = 0.15\\) satisfying the requirement in Equation (8). The initial values \\(\\psi_{t0}\\) in Equation (5) are the Beta distribution parameters inferred from the labels of the first frame during the training phase, and set to zeros during the test phase given emotions at the beginning of any utterances tend to be zeros. We used the adjoint method with Runge-Kutta 5 ODE solver [24]. The absolute and relative error tolerances of the ODE solver were \\(10^{-13}\\) and \\(10^{-7}\\) based on preliminary empirical analyses [15]. The number of model parameters is approximately 30k\u00b9.\nBaseline. Two state-of-art systems are compared: the Sequential Monte Carlo (SMC) approach [7] and the LSTM based system [18]. The LSTM system follows the same settings as in [18] which directly predicts Beta distribution parameters. In our experiments, the sigmoid activation function is applied at the output layer to limit the output range for a fair comparison. The SMC approach predicts distributions that are not constrained to Beta distributions and we employ the same settings as in [7].\nTraining. For all systems, Adam optimizer was used, and the initial learning rate is optimized to 0.01 and 0.001 for \\(f_{\\mu}\\) and \\(f_{\\sigma}\\), with a decaying ratio of 0.9. 60 and 30 epochs were tested for CD-NODE\\(\\gamma\\) and LSTM baseline. We fixed the seed numbers to ensure reproducibility when testing different models. The training utterances were chunked into 4-second windows (i.e., 100 frames) in each batch for training efficiency, while it was tested with the entire utterance to match the practical scenarios. The scaling factors in the loss function in Equation (6) were optimized within the range [0,20] with step size 1 and \\(\\lambda_1 = 1\\) and \\(\\lambda_2 = 10\\) were selected. The predictions were post-processed with a moving average filter with 12 frames( 0.5s) window size. The training time is approximately 72h on Apple M2 chip with 8 cores on 16GB CPU.\nEvaluation Metric. It is suggested in [7] that at low ambiguity regions, a well-predicted distribution should be centred at the ground truth mean; whereas at high ambiguity regions, the mean is not representative of the underlying emotions, and thus, the spread of the distributions is more important. We evaluate the first aspect by comparing root mean squared error (RMSE) between the predicted mean and ground truth mean at different ambiguity regions [7]; and the second aspect using Concordance Correlation Coefficient (CCC) between the predicted standard deviation (SD) and ground truth SD."}, {"title": "6. Results", "content": "6.1. Comparisons with state-of-the-art\nThe comparison to the state-of-the-art systems is reported in Table 1, in terms of CCC between the predicted Beta distribution (i.e., mean \\(\\mu\\) and standard deviation \\(\\sigma\\)) and the ground truth Beta distributions (refer to section 5.2) correspondingly. In addition to [18] that uses LSTM to predict \\(\\omega\\) and \\(\\kappa\\) of beta distribution (referred to as LSTM-w-k), we further validate the system performance for predicting \\(\\mu\\) and \\(\\sigma\\) for a fair comparison, named as LSTM-\\(\\mu\\)-\\(\\sigma\\). The proposed system is also compared to the existing SMC model which adopts non-parametric distribution [7]. It is observed that the proposed model CD-NODE\\(\\gamma\\) yields the highest CCC in terms of mean predictions \\(\\mu\\) for both arousal and valence, with significance p-value < 0.001. Regarding the SD prediction, CD-NODE\\(\\gamma\\) shows comparable performance to the best system LSTM-\\(\\mu\\)-\\(\\sigma\\) for arousal, and underperforms the best system SMC for valence. This could be because the dynamics of SD change more rapidly compared to the mean, which may require a more advanced ODE solver to obtain a more accurate solution.\n presents the RMSE values between the predicted and ground truth means across different ambiguity regions, defined based on deciles of the ground truth standard deviation. As expected, the RMSE generally increases at higher standard deviation deciles for both arousal and valence, indicating that mean prediction errors increase with rising ambiguity (low inter-rater agreement). Conversely, the systems perform better at low ambiguity regions (high inter-rater agreement), which supports our hypothesis. Notably, our proposed system, CD-NODE\\(\\gamma\\), consistently achieves the lowest RMSE compared to all baseline systems for both arousal and valence. These results demonstrates the superior performance of CD-NODE\\(\\gamma\\) in modelling time-varying emotion distributions, as it accurately predicts the emotion state at low ambiguity regions while still reasonably predicting the level of ambiguity at both low and high ambiguity regions. Although CD-NODE and LSTM-\\(\\mu\\)-\\(\\sigma\\) achieved similar performance on valence, it may be attributed to the inherent difficulty in predicting valence using speech data.\n6.2. Impact of range constraint\nWe further validate the effectiveness of the constraint functions in the CD-NODE\\(\\gamma\\), by comparing the system performance without constraint (D-NODE), with only the smoothness constraint (CD-NODE), and with both the smoothness and range constraints (CD-NODE\\(\\gamma\\)). The performance in terms of CCC in Table 2 shows that CD-NODE\\(\\gamma\\) achieves the highest CCC and D-NODE without constraint shows the lowest CCC, indicating the advantages of adding constraints. More importantly, CD-NODE\\(\\gamma\\) yields 3.6% and 6.5% relative improvements over CD-NODE for mean and SD of arousal, and 3.7% and 26.6% relative improvements for mean and SD of valence. This further confirms the effectiveness of the proposed range constraint \\(\\gamma\\).\nRMSE is also reported in Figure 4 for the three systems. All three systems show an increasing trend of RMSE with increasing SD decibels, aligning with the assumption that prediction error is larger where inter-rater ambiguity is high. Notably, CD-NODE\\(\\gamma\\) consistently shows a smaller RMSE compared to the other two systems, e.g., 6.3% and 3.3% relative decreases at lowest ambiguity decile on arousal compared to D-NODE and CD-NODE respectively, further validating the benefits of proposed constraints. Overall, the results suggest that CD-NODE\\(\\gamma\\) with the range constraint can capture the time-varying dynamics of emotion distributions more effectively, which might be because the constraint function eliminates the noisy predictions outside the possible range of the predicted quantity."}, {"title": "7. Conclusion", "content": "In this paper, a multi-task learning framework is used to develop an ambiguity-aware dual-constrained dynamic neural ODE (CD-NODE\\(\\gamma\\)) system that models ambiguous emotional states as time-varying Beta distributions. Our proposed method takes into account the temporal dynamics of distributions and incorporates a range constraint that restricts the outputs to better ensure the validity of predicted emotion distribution, in addition to a smoothness constraint. Experimental results, when compared to various baselines, show that the proposed CD-NODE\\(\\gamma\\) model outperforms them in modelling emotional states and produces accurate predictions in low ambiguity regions and reliable predictions of high ambiguity regions. Moreover, the outcomes acquired with various constraint configurations indicate that the inclusion of a range constraint enhances the CD-NODE's ability to learn the distribution dynamics. The results highlight the benefits of utilising CD-NODE to model temporal dynamics of distributions with explicit constraints, which opens up new avenues for emotion ambiguity modelling."}]}