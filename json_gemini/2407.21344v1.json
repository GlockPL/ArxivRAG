{"title": "Dual-Constrained Dynamical Neural ODEs for Ambiguity-aware Continuous Emotion Prediction", "authors": ["Jingyao Wu", "Ting Dang", "Vidhyasaharan Sethu", "Eliathamby Ambikairajah"], "abstract": "There has been a significant focus on modelling emotion ambiguity in recent years, with advancements made in representing emotions as distributions to capture ambiguity. However, there has been comparatively less effort devoted to the consideration of temporal dependencies in emotion distributions which encodes ambiguity in perceived emotions that evolve smoothly over time. Recognizing the benefits of using constrained dynamical neural ordinary differential equations (CD-NODE) to model time series as dynamic processes, we propose an ambiguity-aware dual-constrained Neural ODE approach to model the dynamics of emotion distributions on arousal and valence. In our approach, we utilize ODEs parameterised by neural networks to estimate the distribution parameters, and we integrate additional constraints to restrict the range of the system outputs to ensure the validity of predicted distributions. We evaluated our proposed system on the publicly available RECOLA dataset and observed very promising performance across a range of evaluation metrics.", "sections": [{"title": "1. Introduction", "content": "Speech emotion recognition plays an important role in building the next generation of human-machine interactions [1]. Dimensional representation, describing emotions with continuous values on affect dimensions (e.g., arousal and valence), allows for broader descriptions of the complexity and richness of emotion, making it extensively utilised in the speech emotion recognition research community [2, 3]. Typically, the continuous emotion labels (also denoted as ratings) are collected from a group of human raters by asking for their perceptual evaluations of the same speech or video recordings. The differences in perception, referred to as inter-rater ambiguity [4], reflect the subtlety of natural emotions, and this ambiguity should be taken into consideration when developing emotion recognition systems.\nUntil recently, researchers in affective computing have often treated this ambiguity as noise and used the average ratings from multiple raters as a 'gold standard' [4, 5]. However, there is now growing recognition that inter-rater ambiguity in emotion labels conveying information about the emotion state and such ambiguity is being taken into account by treating arousal/valence labels as distributions [6-9]. This paradigm shift has spurred the development of ambiguity-aware emotion prediction systems that predict emotion states as distributions on the arousal/valence dimensions, rather than conventional mean predictions [6-11].\nAdditionally, emotions are dynamic processes that evolve continuously over time [12, 13]. This dynamic nature applies not only to the emotional state itself but also to the associated ambiguity [14]. Nevertheless, among the limited works that model emotion ambiguity, only a small subset of these systems have attempted to incorporate the temporal dependencies amongst the distributions.\nIn this paper, we present a speech-based ambiguity-aware emotion prediction system that explicitly incorporates the temporal dependencies of emotion distributions. Leveraging the advantages of the recently proposed constrained dynamical neural ordinary differential equation (CD-NODE) for modelling time series with the ability to impose constraints on the smoothness of dynamic process, and its effectiveness in modelling time-varying emotion ratings [15], we develop a novel ambiguity-aware dual constrained CD-NODE system (denoted as CD-NODE). This system predicts ambiguity-aware emotion states with time-varying distributions along the arousal/valence dimensions, and automatically learns how these emotion distributions evolve over time. Moreover, CD-NODE integrates smoothness and range constraints to manage the rate of change and the absolute scope of emotion distributions, respectively, further ensuring the validity of the distributions."}, {"title": "2. Related work", "content": "Recent years have witnessed an increasing amount of effort on modelling and predicting the ambiguity associated with emotion labels, often treated as probability distributions [6, 14, 16]. However, the majority of existing research primarily addresses the ambiguity in predictions while neglecting the temporal dependencies, treating distributions at each time step as independent. Among the few studies addressing temporal dependencies in emotion distributions, initial methods modelled emotion labels using Gaussian Mixture Models (GMMs) without considering temporal dynamics [6]. Subsequent improvements incorporated Kalman filters to account for the temporal evolution of GMM parameters [14]. However, this approach assumes that the temporal dynamics follow a linear dynamical system. Zhang et al. proposed using Bidirectional LSTM to estimate the means and standard deviations of Gaussian-distributed labels [17], but the poor prediction in standard deviations suggests the unsuitability of the predefined distribution types. While LSTM learns temporal dependencies in the parameters, it lacks transparency and flexibility in integrating constraints or prior knowledge on emotion dynamics. More recent efforts, such as a system utilizing a Sequential Monte Carlo approach, explored predicting time-varying emotion distributions with a non-linear dynamical system, yet focused solely on the dynamics of distribution means [7]. These approaches either operate in separate stages rather than end-to-end, apply simplistic linear constraints or make specific and inappropriate assumptions about distribution dynamics, or lack the flexibility in incorporating constraints. On the other hand, the CD-NODE system captures the temporal dynamics of emotions without imposing predefined assumptions on their evolution, facilitating end-to-end modelling and allowing for incorporating constraints, which has shown superior performance in continuous emotion prediction [15]. However, it only predicts mean arousal/valence ratings and neglects the associated ambiguity."}, {"title": "3. Overview of CD-NODE", "content": "The recently published CD-NODE was developed to model time series with additional constraints on the dynamics of the predicted quantity. It models the continuous emotion labels (i.e., arousal/valence ratings) $y(t) = {Y_{t_0}, Y_{t_1}, \u2026\u2026\u2026, Y_{t_n}}$ as a non-linear dynamical process using ODE with governing function $f$ parameterized by neural networks $\\theta$, and the dynamics in $y(t)$ is dependent on both the input speech features $x(t) = {X_{t_0}, X_{t_1}, ...,x_t}$ and previous y. It is defined as:\n$\\frac{dy(t)}{dt} = \\phi(f(x(t), y(t); \\theta)))$"}, {"title": "4. Proposed CD-NODE", "content": "While the original CD-NODE based system only predicts the mean arousal/valence rating, this paper proposes an ambiguity-aware dual-constrained Neural ODE, referred to as CD-NODE, that predicts ambiguous arousal/valence states as time-varying Beta distributions as suggested in [16] that Beta distributions are highly suitable for modelling emotion ambiguity. Furthermore, in addition to the explicit smoothness constraint which was a key feature of the CD-NODE, we introduce a second constraint $\\gamma$, which restricts the system output to fall within a given range, which in turn helps ensure the validity of the predicted distributions.\nAssuming the arousal/valence at time $t_n$ is represented by a beta distribution that is parameterised by $\\psi_{t_n}$, the aim of the emotion prediction system is to predict $\\psi(t) = {\\psi_{t_0}, \\psi_{t_1},...,\\psi_{t_n}}$ given a sequennce of input speech features $x(t) = {X_{t_0}, X_{t_1}, ,x_t}$. The most likely emotion intensity and the associated ambiguity can then be inferred from the predicted beta distribution, $\\psi_{t_n}$, at each time step.\nThe Beta distribution is typically parameterised using two parameters, denoted as $\\psi_{t_n} = {\\psi_{t_n}^1, \\psi_{t_n}^2}$. This then leads to a multi-task learning framework to model ${\\psi_{t_n}^1, \\psi_{t_n}^2}$:\n$\\frac{d\\psi^i(t)}{dt} = \\phi^i(f(x(t), \\psi^i (t); \\theta^i)), i \\in [1, 2]$\nwhere $i \\in [1,2]$ corresponds to the two parameters, $f_i$ are the two governing functions modelled as neural networks are each constrained with their own smoothness constraint function $\\phi^i$.\nNoting that the parameters of any beta distributions will have constraints to ensure a resulting distribution is valid we impose an additional constraint function $\\gamma$ to limit the range of $\\psi^1$ and $\\psi^2$. Thus, the final outputs are obtained as per equation:\n$\\psi^i (t) = \\gamma^i (ODESolve(f_i, \\theta^i, \\psi_{t_0}^i, t_0,\u2026\u2026, t_n, x(t)))$\nFinally, the loss function for the proposed multi-task learning framework is taken as:\n$L = \\lambda_1 L_1 + \\lambda_2L_2$\n$L_i = 1 - \\rho_c(\\psi^i(t), \\hat{\\psi}^i(t)), i \\in [1, 2]$"}, {"title": "4.2. Constraint Function: \u03b3", "content": "The initial stage of our approach involves identifying the most suitable parameter pairs for the Beta distribution in our proposed CD-NONEY. This is a crucial step in ensuring that our model can effectively learn the distributional properties of emotions. The most commonly used parameter pairs include: shape parameters {a,b}, and {mean($\\mu$), variance($\\sigma$)} and {mode($\\omega$), concentration(k)} which indicate the central tendency ($\\mu$ or $\\omega$) and spread ($\\sigma^2$ or k) of the distribution. We observed that shape parameters {a,b} are less interpretable compared to {$\\mu$, $\\sigma$} and {$\\omega$, k}. Furthermore, when comparing {$\\mu$, $\\sigma$} to {$\\omega$, k}, we observe that both $\\mu$and $\\sigma$ are both bounded to the interval [0, 1], while only $\\omega$ is bound to a finite interval with the only bound on k being k > 2. The lack of an upper bound to k leads to dramatic changes in its dynamics which makes a CD-NODE that predicts {$\\omega$, k} harder to train. Therefore, we chose {$\\mu$, $\\sigma$} to represent the Beta distributions. Consequently, we design the constraint functions $\\Upsilon_i$ as in equation (8) for both $\\mu$and $\\sigma$ as:\n$\\Upsilon_{\\mu} = pS(\u00b7), \\gamma_{\\sigma} = qS(\u00b7)$\n$0 < p < 1, 0 < q^2 < min(p^2, \\frac{2p-p^2}{1+p})$\nwhere, S(.) denotes a sigmoid function and is used to constrain the output to [0, 1], and p and q are adjustable constants that must satisfy the relationship as per equation (8b) in order to ensure the Beta distribution is bell shaped [18]."}, {"title": "5. Experimental Settings", "content": "The RECOLA dataset is one of the most commonly used multimodal corpus which consists of 9.5 hours spontaneous dyadic conversation recordings in French [19]. There are 9 five-minute utterances each in the training and development sets, identical to the data partition in the AVEC challenge 2015 [20]. Since the challenge test sets are not publicly available, the system is trained and the hyperparameters are optimized using the training set and tested on the development set as per standard practice [7, 15, 18, 20]. The dataset is annotated by 6 human raters with continuous arousal and valence labels within range [-1, 1], with sampling rate of 40ms."}, {"title": "5.2. Beta distribution parameter estimation", "content": "To obtain the ground truth beta distribution, we follow the same approach used in [18] to estimate the Beta distribution parameters. The original ratings are first mapped to range x \u2208 [0, 1] via a linear transformation y = 0.4975x + 0.5 in order to perform the Beta fit. To compute the Beta parameter at each frame, the ratings from neighbouring F frames are concatenated as \u1ef9 = [Yn-F : Yn+F], Yn refers to the labels from 6 raters at frame n to avoid overfitting. F is 6 and 1 for arousal and valence respectively as suggested in [18]. Finally, the Beta parameters $\\Upsilon_{t_n}$ are obtained by Maximum A Posterior (MAP) as:\n$\\Upsilon_{t_n} = arg \\underset{\\psi}{max} [P(y_{n,m}|\\psi)P(\\psi)]$\nwhere yn,m denotes the rating from the mth rater at frame n; $p(y_{n,m}|\\psi)$ refers to the posterior probability of yn,m; and P($\\psi$)"}, {"title": "5.3. System configurations", "content": "Features. The Bag-of-audio-words(BoAW) feature representations are extracted with 100 clusters from 20-dimensional MFCCs using OpenXbow [21]. Detailed explanation refers to [22]. 4 second delay compensation is applied to both arousal and valence to compensate the annotation delay [23].\nNetwork parameters. A fully connected (FC) layer with 64 neurons and tanh activation function is first employed to transfer the BoAW features. The following $f_1$ and $f_2$ for modelling dynamics of $\\mu$ and $\\sigma$ are composed of three FC layers respectively, with tanh activation function applied for the first two layers to enforce the nonlinearity, and the smoothing constraint applied to the last FC layer with $\\alpha_{\\mu}$ = 0.5 and $\\alpha_{\\sigma}$ = 10 which is optimized for both arousal and valence. For the proposed constraints, we chose p = 0.75 for both arousal and valence as 95% of the ratings are within the range [0,0.75], and q = 0.15 satisfying the requirement. The initial values $\\psi_0$ in Equation are the Beta distribution parameters inferred from the labels of the first frame during the training phase, and set to zeros during the test phase given emotions at the beginning of any utterances tend to be zeros. We used the adjoint method with Runge-Kutta 5 ODE solver [24]. The absolute and relative error tolerances of the ODE solver were 10-13 and 10-7 based on preliminary empirical analyses. The number of model parameters is approximately 30k.\nBaseline. Two state-of-art systems are compared: the Sequential Monte Carlo (SMC) approach [7] and the LSTM based system [18] which directly predicts Beta distribution parameters. In our experiments, the sigmoid activation function is applied at the output layer to limit the output range for a fair comparison. The SMC approach predicts distributions that are not constrained to Beta distributions and we employ the same settings as in [7].\nTraining. For all systems, Adam optimizer was used, and the initial learning rate is optimized with a decaying ratio of 0.9. 60 and 30 epochs were tested for CD-NODE and LSTM baseline. We fixed the seed numbers to ensure reproducibility when testing different models. The training utterances were chunked into 4-second windows in each batch for training efficiency, while it was tested with the entire utterance to match the practical scenarios. The scaling factors in the loss function were optimized within the range with step size 1 and $A_1 = 1$ and 2 = 10 were selected. The predictions were post-processed with a moving average filter with 12 frames( 0.5s) window size. The training time is approximately 72h on Apple M2 chip with 8 cores on 16GB CPU.\nEvaluation Metric. It is suggested in [7] that at low ambiguity regions, a well-predicted distribution should be centred at the ground truth mean; whereas at high ambiguity regions, the mean is not representative of the underlying emotions, and thus, the spread of the distributions is more important. We evaluate the first aspect by comparing root mean squared error (RMSE) between the predicted mean and ground truth mean at different ambiguity regions; and the second aspect using Concordance Correlation Coefficient (CCC) between the predicted standard deviation and ground truth SD."}, {"title": "6. Results", "content": "The comparison to the state-of-the-art systems is reported, in terms of CCC between the predicted Beta distribution and the ground truth Beta distributions. In addition to that uses LSTM to predict $\\omega$ and k of beta distribution we further validate the system performance for predicting $\\mu$ and $\\sigma$ for a fair comparison. The proposed system is also compared to the existing SMC model which adopts non-parametric distribution . It is observed that the proposed model CD-NODE yields the highest CCC in terms of mean predictions $\\mu$ for both arousal and valence with significance p-value < 0.001.\nNotably, our proposed system, CD-NODEy, consistently achieves the lowest RMSE compared to all baseline systems for both arousal and valence. These results demonstrates the superior performance of CD-NODEy in modelling time-varying emotion distributions, as it accurately predicts the emotion state at low ambiguity regions while still reasonably predicting the level of ambiguity at both low and high ambiguity regions. Although CD-NODE and LSTM-\u03bc achieved similar performance on valence, it may be attributed to the inherent difficulty in predicting valence using speech data."}, {"title": "6.2. Impact of range constraint", "content": "We further validate the effectiveness of the constraint functions in the CD-NODEy, by comparing the system performance without constraint (D-NODE), with only the smoothness constraint (CD-NODE), and with both the smoothness and range constraints (CD-NODE). The performance in terms of CCC  shows that CD-NODE achieves the highest CCC and D-NODE without constraint shows the lowest CCC, indicating the advantages of adding constraints. More importantly, CD-NODE yields 3.6% and 6.5% relative improvements over CD-NODE for mean and SD of arousal, and 3.7% and 26.6% relative improvements for mean and SD of valence. This further confirms the effectiveness of the proposed range constraint \u03b3.\nOverall, the results suggest that CD-NODEy with the range constraint can capture the time-varying dynamics of emotion distributions more effectively, which might be because the constraint function eliminates the noisy predictions outside the possible range of the predicted quantity."}, {"title": "7. Conclusion", "content": "In this paper, a multi-task learning framework is used to develop an ambiguity-aware dual-constrained dynamic neural ODE (CD-NODE) system that models ambiguous emotional states as time-varying Beta distributions. Our proposed method takes into account the temporal dynamics of distributions and incorporates a range constraint that restricts the outputs to better ensure the validity of predicted emotion distribution, in addition to a smoothness constraint. Experimental results, when compared to various baselines, show that the proposed CD-NODE model outperforms them in modelling emotional states and produces accurate predictions in low ambiguity regions and reliable predictions of high ambiguity regions. Moreover, the outcomes acquired with various constraint configurations indicate that the inclusion of a range constraint enhances the CD-NODE's ability to learn the distribution dynamics. The results highlight the benefits of utilising CD-NODE to model temporal dynamics of distributions with explicit constraints, which opens up new avenues for emotion ambiguity modelling."}]}