{"title": "Reach Measurement, Optimization and Frequency Capping In Targeted Online Advertising Under k-Anonymity", "authors": ["Yuan Gao", "Mu Qiao"], "abstract": "The growth in the use of online advertising to foster brand awareness over recent years is largely attributable to the ubiquity of social media. One pivotal technology contributing to the success of online brand advertising is frequency capping, a mechanism that enables marketers to control the number of times an ad is shown to a specific user. However, the very foundation of this technology is being scrutinized as the industry gravitates towards advertising solutions that prioritize user privacy. This paper delves into the issue of reach measurement and optimization within the context of k-anonymity, a privacy-preserving model gaining traction across major online advertising platforms. We outline how to report reach within this new privacy landscape and demonstrate how probabilistic discounting, a probabilistic adaptation of traditional frequency capping, can be employed to optimize campaign performance. Experiments are performed to assess the trade-off between user privacy and the efficacy of online brand advertising. Notably, we discern a significant dip in performance as long as privacy is introduced, yet this comes with a limited additional cost for advertising platforms to offer their users more privacy.", "sections": [{"title": "Introduction", "content": "Digital advertising now represents a significant proportion of the global ad expenditure (Statista, 2023). Thanks to its innate capacity for targeted and personalized ad delivery, digital advertising has become an effective platform for performance-based marketing. The key to effectiveness lies largely in relevancy. Initially, marketers identify potential customers by delineating their audience according to user geolocation and interests. This process is further refined as digital advertising platforms match users and ads based on real-time relevance, preventing advertisers' budgets from being squandered on less-engaged audiences. Furthermore, major online publishers now offer automated tools to aid advertisers in optimizing for their desired outcomes, such as purchases or app downloads. The capacity to measure and drive immediate impact via automated systems forms the backbone of the swift growth of online advertising.\nConversely, traditional marketing places substantial emphasis on brand advertising. The objective of brand advertising, unlike performance-based marketing, is to nurture long-term relationships with customers. This aim is pursued through consistent ad exposure to audiences who demonstrate potential interest in the brand. However, unlike performance-based advertising where more conversions translate to better outcomes, increased impression volume does not always yield desirable results in brand ads. Studies indicate that ad over-exposure negatively impacts the brand (Broussard, 2000; Ma et al., 2016). In response to this issue, the industry often employs frequency capping. Specifically, in a brand advertising campaign, a frequency cap of c ensures an ad from the campaign is shown a maximum of c times to the same user. In brand marketing, it's typical to define the campaign objective as maximizing impressions, subject to a frequency cap constraint. The objective is commonly referred to as reach when c = 1, as it represents the number of unique targeted users served. However, for"}, {"title": "Related Work", "content": "Traditional reach optimization research often operates under the assumption of known user identities, with a focus on challenges such as frequency capping and constrained ad matching problems (Mehta et al., 2007; Feldman et al., 2009; Buchbinder et al., 2014; Hojjat et al., 2017). More practically, modern online advertising platforms often run under popular auction formats such as first and second price auctions, and campaign optimization under these auction formats are usually studied under optimal bidding (Balseiro and Gur, 2019; Gao et al., 2022; Maehara et al., 2018; Zhang et al., 2014). However, these methodologies are met with significant hurdles when applied in scenarios where privacy protection protocols obscure full knowledge of user identities.\nThe preservation of privacy in digital advertising has attracted considerable research interest, with a significant focus on the issue of cross-publisher reach measurement in environments lacking third-party cookies. Influential studies propose the establishment of common identifiers across publishers used exclusively for aggregate measurement (World Federation of Advertisers, 2023). Notably, (Skvortsov and Koehler, 2019) suggests a method for assigning virtual identifiers across various domains. With these unified identifiers in place, it becomes possible to amalgamate measurement statistics from different publishers using differentially-private solutions, which rely on either global (Kreuter et al., 2020) or local (Wright et al., 2021) summarization algorithms.\nAdditional research avenues include exploring the intermediary stage where partial cross-publisher activity data is available from users who have given their consent to be tracked (Sang et al., 2022). In such instances, machine learning algorithms have been proposed as a means of learning from this data to infer and optimize non-trackable requests.\nDistinguished from the existing body of work, this paper anticipates future scenarios where user privacy is stringently maintained, even within the context of first-party domains. The aim of this work is to evaluate the efficacy of measurement and optimization strategies under a specific privacy protocol, namely the k-anonymous privacy protocol."}, {"title": "The k-anonymous Privacy Protocol", "content": "In the realm of online advertising, the concept of k-anonymity plays a pivotal role in balancing the effectiveness of targeted advertising with the imperative need for user privacy. This protocol is adeptly implemented by publisher platforms, such as social media sites, search engines, or content providers, which meticulously form user groups (Epasto et al., 2021). Each group comprises k members, safeguarding individual user actions by making them indistinguishable from k \u2212 1 others within the same cohort. These groups are thoughtfully created based on common user attributes like geolocation and interests. When a user visits the publisher and triggers an ad request, their information is forwarded to a separate identification system, which returns one of the groups containing the user. This group identity is then utilized by the downstream advertising system to make decisions on ad displays, ensuring that only group-level information is used, in order to maintain user anonymity (Figure 1).\nWhile the optimal computation of k-anonymity is recognized as an NP-hard challenge(Meyerson and Williams, 2004), pragmatic algorithms have emerged (Pascale et al., 2023; Bonizzoni et al., 2013), facilitating its application in diverse real-world settings. Furthermore, the concept of k-anonymity seamlessly extends to certain advertising contexts, such as television ads targeted at households. Here, the ad is directed at a family unit, inherently forming a k-anonymous group, where the television"}, {"title": "Notations", "content": "We use i to index individual users, j to indicate user groups, and t to signify ad requests originating from a user group. As the primary focus of this research is the measurement and optimization of reach for a single ad campaign, there's no need to introduce additional indices for multiple campaigns. For the campaign in question, we assume its frequency cap is c and it targets a total of N users. For simplicity, we presume that the targeted user indices range from 1 to N. These targeted users are assigned to M distinct user groups, which collectively generate a total of T ad requests.\nEach ad request t is generated by an unidentified user. However, the system has access to $j_t$, the index of the user group generating ad request t. We use $p_t$ to denote the probability that ad request t comes from a user who has previously been served fewer than c times.\nWe define $U_j$ as the set of targeted user indices in group j. Formally,\n$U_j :=\\begin{cases}i\\mid\\text{ user $i$ is in user group $j$ }\\\\ \\text{user $i$ is targeted}\\end{cases}$,\nWe also define $G_i$ as the set of group indices containing user i:\n$G_i := \\{j \\mid \\text{user $i$ is in user group $j$}\\}$.\nWe use the random variable $X_i$ to denote the number of times user i has viewed the ad."}, {"title": "Reach Measurement", "content": "Under k-anonymity, the ability to track users at an individual level is compromised, making accurate reach measurement challenging. In this section, we focus on estimating reach when only the user group impressions are accessible. It's essential to keep in mind that these impressions result from auction-based bidding. The specifics of the reach optimization problem are outlined in Section 4.\nAs discussed in the introduction, typically, an ad campaign operates under a pre-determined frequency cap c, where reach is defined as the total number of impressions served within this cap. However, advertisers often require the reach metric for a variety of frequency caps. For instance, an advertiser may set the frequency cap at c = 2 to ensure that targeted users don't see the ad more than twice. Still, it would be beneficial for the publisher to report the unique number of users served by the ad.\nTime is another important factor. Advertisers frequently assess campaign reach during the campaign flight, necessitating real-time updates of reach metrics. Additionally, reach metrics should accommodate range-based queries to enable advertisers to access reports for any given time frame, such as reach within the past week or month.\nFormally, a time window identifies a subset of indices from the set 1, . . ., T. Let $n_j$ be the number of impressions for the ad campaign from user group j within this window. The theorem below details the expected reach under a given frequency cap.\nTheorem 1 (Reach in Expectation) The expected reach under a given frequency cap $c \\geq 1$ is given by\n$\\sum_{i=1}^N \\sum_{l=1}^c f\\Big(l; \\sum_{j \\in G_i} n_j, \\frac{1}{k}\\Big)+c -cF\\Big(c; \\sum_{j \\in G_i} n_j, \\frac{1}{k}\\Big)$.\nIn the special case where c = 1, the following Corollary applies:\nCorollary 1 Let $n_j$ be the number of impressions of the ad campaign from user group j, then the expected number of unique reach is\n$\\sum_{i=1}^N \\Big(1-\\big(1-\\frac{1}{k}\\big)^{\\sum_{j \\in G_i} n_j}\\Big)$.\nFor the other extreme, as c \u2192 \u221e, equation (1) simply becomes $\\sum_{i} \\sum_{j \\in G_i} n_j$, the expected total impressions. This number is bounded above by $\\sum_{j} n_j$, the total group impressions. This upper limit is reached when all users within the groups are targeted.\nIt's also worth noting that in the degenerate case where k = 1 and each user belongs to a distinct group, Theorem 1 and Corollary 1 provide deterministic reach counts.\nTheorem 1 allows the publisher to compute reach metrics for any given time window. In addition, the following alternative formulation of (1) also facilitates a streaming algorithm that updates the expected reach as new impressions are observed, with a time complexity of $O(kc^2)$ and a space complexity is $O(cT)$."}, {"title": "Bounds on the Estimate", "content": "Apart from consistently reporting the correct reach metric in expectation, it is also crucial to understand the extent to which the actual reach can diverge from the expectation. For instance, when the groups do not overlap, the reach's lower bound R(c) is simply $\\sum_{j=1}^M$min$(n_j, c)$, achievable when requests from each group originate consistently from the same user. Conversely, the upper bound of R(c) is $\\sum_{j=1}^M$min$(n_j, c |U_j|)$, realizable when, for example, targeted users in a group are catered to in a round-robin manner. The upper and lower bounds for the general case involving overlap can be complex to represent mathematically, but they can be computed using greedy algorithms.\nWhen it comes to concentration bounds on the reach metric R(c), it is significant to acknowledge that although R(c) = $\\sum_{i=1}^N R_i(c)$ is a sum of random variables, Hoeffding's inequality does not apply in this context since $R_i(c)$ are typically negatively correlated for users within the same group. Instead, we can calculate the variance of R(c) and apply Chebyshev's inequality to derive probabilistic bounds on the deviation. However, the analytical form of the variance for general c is of combinatorial nature. Consequently, we present an explicit bound on R(1). It hinges on the following lemma. For notation simplicity, we denote R := R(1) as the reach when c = 1.\nLemma 1 (Covariance) Let $R_i$ = min($X_i, 1$), where $X_i$ represents the number of impressions from user i. For two users i, i', let $G_\\cap$ := $G_i \\cap G_{i'}$ represent their intersecting groups and $G_\\cup$ := $G_i \\cup G_{i'}$ their union. If $n_j$ denotes the number of impressions of the ad campaign from user group j, then the covariance Cov$[R_i, R_{i'}]$ is given by\n$(1-\\frac{1}{k})^2 \\sum_{j \\in G_\\cap} n_j - (1-\\frac{1}{k}) \\sum_{j \\in G_\\cup - G_\\cap} n_j$.\nTogether with the observation that in this scenario Var$[R_i]$ = E$[R_i]$ $(1 - E[R_i])$, which equates to\n$(1-\\big(1-\\frac{1}{k}\\big)^{\\sum_{j \\in G_i} n_j}\\Big) \\big(1-\\frac{1}{k}\\big)^{\\sum_{j \\in G_i} n_j}$,\nwe obtain the following theorem.\nTheorem 2 (Concentration Bounds) The probability that R deviates its expectation E[R] (given in Theorem 1) by $ \\epsilon \\sigma$ is bounded by\nP $(|R - E[R]| \\geq \\epsilon \\sigma) \\leq \\frac{\\tau}{\\epsilon^2}$,\nwhere\n$\\tau = \\sum_i Var[R_i] + \\sum_{i \\neq i'} Cov[R_i, R_{i'}]$,\nwhere Var$[R_i]$ is given by (4) and Cov$[R_i, R_{i'}]$ is given by (3).\nFor general c > 1, we can compute the variance of R(c) using Monte Carlo methods. For more information, refer to Section 5. Finally, the subsequent theorem offers estimates on over-exposure, crucial for advertisers concerned about its negative impact.\nTheorem 3 (Over-exposed Users) If $n_j$ denotes the number of impressions of the ad campaign from user group j, then the expected count of over-exposed users (served more than c times) is\n$N - \\sum_{i=1}^N F\\Big(c; \\sum_{j \\in G_i} n_j, \\frac{1}{k}\\Big)$"}, {"title": "Relaxing the Uniformity Assumption", "content": "The prior sections rely on a key assumption that each user within a group has an equal probability of generating a group request. While this simplification is essential for privacy protection, it doesn't accurately capture real-world scenarios. However, under specific conditions, specifically when user groups do not overlap and advertisers define their target audience at a level less granular than these groups, we can improve ad performance without compromising k-anonymity.\nLet's consider a scenario in which the ad platform can estimate each individual user's visit frequency. In such a case, we could associate each group j with a property vector $(q_{j1}, q_{j2}, ..., q_{jk})$, where $q_{j1} \\leq q_{j2} \\leq ... \\leq q_{jk}$ and $\\sum_{l} q_{jl} = 1$. This vector represents the user visit probabilities within group j. To maintain k-anonymity, the ad system is only permitted to access these probabilities without linking them to specific users. For instance, a group with a property vector of (0, 0, ..., 0, 1) would signal to the ad system that there is a single active user in the group, while the rest are inactive; however, the system would not be able to identify the active user. The following theorem provides the expected reach for a user group in this setup.\nTheorem 4 Given $n_j$ as the number of impressions of the ad campaign from user group j with property vector $(q_{j1}, q_{j2}, ..., q_{jk})$, the expected reach generated from user group j under frequency cap c can be expressed as:\n$\\sum_{l=1}^k \\Big(\\sum_{l=1}^c lf (l; n_j, q_{jl})+c -cF (c; n_j, q_{jl})\\Big)$.\nThe total reach of the campaign can then be derived by summing up the reach from each group, as we are assuming the groups do not overlap. In the case of unique reach (c = 1), we can state the following:\nCorollary 3 Given $n_j$ as the number of impressions of the ad campaign from user group j with property vector $(q_{j1}, q_{j2}, ..., q_{jk})$, the expected number of unique reach from user group j can be defined as:\n$k - \\sum_{l=1}^k (1 - q_{jl})$."}, {"title": "Reach Optimization", "content": "Measurement and optimization play pivotal roles in online advertising platforms, as they are essential tools that help marketers achieve a solid return on investment. Reach measurement is typically displayed on an ad reporting page within the publisher platform, allowing marketers to identify gaps in audience coverage and evaluate the effectiveness of their marketing strategies. Meanwhile, reach optimization is often offered by the platform through an automated bidding service, which places bids on behalf of advertisers in each auction to optimize results. As the outcome is reported by the measurement component, it is crucial that these two elements maintain consistency with one another.\nIn this section, we focus on the reach maximization problem with regard to an ad campaign, which comprises an ad, a budget, and a targeted user set. In traditional scenarios where user identity is readily available, the advertising platform tracks the frequency of ad impressions per user. It halts the campaign for a given user once the frequency cap c is reached. Here, we expand the reach optimization problem to account for ad requests originating from user groups.\nLet T denote the total number of ad impressions initiated by the targeted users' viewing or search sessions. Each impression is generally auctioned either via a first-price or second-price auction, with the winning bid claiming the impression. The objective of an ad campaign is to secure as many impressions as possible while ensuring that each targeted user receives the ad at most c times. For instance, when c = 1, the goal is to reach as many unique targeted users as possible.\nConsider the t-th impression and define $W_t(b)$ as the winning probability given a bid price of b and $H_t(b)$ as the expected cost. Let their respective derivatives be $w_t$ and $h_t$. Let B denotes the"}, {"title": "Estimating Reach Probability", "content": "As discussed in the previous section, the crucial quantity in Equation 7 is $p_t$. This is the probability that the request comes from a user who has viewed the ad fewer than c times.\nConsider a campaign focused on maximizing unique reach (c = 1), within a user group composed of two targeted users: A and B. Suppose the group generates two ad requests indexed by 1 and 2. For the first request, $p_1 = 1$ since it is the initial time we encounter this group. If the campaign secures this impression, the next time this group visits the publisher, we know that either A or B has seen the ad. Hence, there is only a 50% chance that we can reach a unique user, and therefore, $p_2 = 0.5$.\nFormally, let $n_{t;j}$ denote the number of impressions of the ad campaign from user group j up until the t-th ad request. Let $j_t$ represent the index of the user group that generates the t-th ad request. We then have the following formula for $p_t$.\nTheorem 5 (Probability of Additional Reach) Assume that user group $j_t$ generates ad request t. The probability $p_t$ that ad request t comes from a user who has viewed the ad fewer than c times is given by\n$p_t = \\frac{1}{k} \\sum_{i \\in U_{j_t}} F \\Big(c-1; \\sum_{j \\in G_i} n_j, \\frac{1}{k}\\Big)$.\nAs a remark, as c\u2192 \u221e, we find that $p_t$ \u2192 1, in which case, the optimization problem in (6) simplifies to an impression volume optimization. For the specific case where c = 1, we have the following corollary.\nCorollary 4 For a campaign optimizing for unique reach, we have\n$p_t = \\frac{1}{k} \\sum_{i \\in U_{j_t}} \\Big(1 - \\big(1 - \\frac{1}{k}\\big)^{\\sum_{j \\in G_i} n_j}\\Big)$.\nIt's noteworthy that the probability $p_t$ decreases exponentially with $n_{tj}$ for a specific group j. To see how the winning probability diminishes as the group impression count increases, consider $p_t = exp(-\\alpha n_{tj})$, where \u03b1 > 0 is a parameter that depends on the group size. At the extremes, for a group of size k = 1, we have \u03b1 \u2192 +\u221e, and \u03b1 \u2192 0 as the group size k \u2192 \u221e."}, {"title": "Experiments", "content": "This section outlines the experiments conducted to address a range of significant questions. Firstly, we deploy Monte Carlo simulations on the reach distribution, demonstrating the accuracy of the reach estimate and its variance progression throughout a campaign's lifespan. Secondly, we show the increase in measurement uncertainty as stricter user privacy is implemented. Next, we run tests on campaign reach optimization under varying privacy levels, resulting in an efficiency versus privacy tradeoff curve. This quantifies the influence of privacy on digital brand advertising performance. Lastly, we also compare the performance of different methods on real-world datasets where user arrival within a group is non-uniform."}, {"title": "Monte Carlo Simulations on Reach", "content": "The expected reach for a given set of group impressions is detailed in Theorem 1. In this initial experiment, Monte Carlo simulations are conducted to derive the complete reach distribution. We model a campaign with 120 targeted users and a frequency cap, c = 3. These targeted users are divided into 20 groups, each containing k = 6 members. We randomly draw 250 impressions from these groups and sample the potential user trajectories that generated these impressions. This data is used to plot the reach distribution (Figure 2A), with the empirical mean from this distribution closely aligning with the expected reach from Theorem 1.\nFurther analysis of the reach distribution evolution as impressions increase is illustrated in Figure 2B. When impressions are scarce, it is likely that most fall under the frequency cap and are counted as reach, resulting in a small distribution variance. As impressions accrue, the variance initially increases, but decreases as impressions become plentiful. This is due to the reach becoming saturated as a result of the frequency cap amidst a high number of impressions.\nLastly, the variances across various group sizes are plotted in Figure 2C. This illustrates the effect of heightened user privacy on the reach measurement's uncertainty. At k = 1, the measurement is deterministic. As user privacy is introduced (k = 2), a substantial increase in variance occurs. However, as we provide more user privacy, the growth in measurement uncertainty is minimal."}, {"title": "Privacy vs. Efficiency Tradeoff", "content": "Digital privacy is ushering in substantial changes within the advertising industry. There is a prevailing consensus that the efficacy of online marketing risks being compromised as stronger privacy protection"}, {"title": "Non-uniform Setting", "content": "For completeness, we also present the reach probabilities $p_t$ in the non-uniform arrival setting described in Section 3.2.\nTheorem 6 Let $n_{t;j}$ be the number of impressions of the ad campaign from user group j with property vector $(q_{j1}, q_{j2},..., q_{jk})$, up until ad request t happens. Now suppose user group j generates the t-th request, then the probability $p_t$ that ad request t is from a user that has been served less than c times previously is\n$p_t = \\sum_{i=1}^k q_{ji}F (c - 1; n_{tj}, q_{ji}) $.\nIn particular, for unique reach, $p_t = \\sum_i q_{ji} (1 \u2013 q_{ji})^{ntj}$."}, {"title": "Final Remarks", "content": "To the best of our knowledge, this paper is the first to investigate reach measurement, optimization, and frequency capping under the k-anonymous privacy protocol. We outline how to report reach in this new privacy context and demonstrate how probabilistic discounting, a probabilistic variant of traditional frequency capping, can be leveraged to optimize campaign performance. For ease of presentation, we have assumed that all user groups are of equal size k. However, the findings are adaptable to scenarios where user groups vary in size."}, {"title": "Algorithms", "content": "Theorem 1 allows the publisher to compute reach metrics given any time window. We give a streaming algorithm (Algorithm 1) that outputs the expected number of reach as new impressions are getting observed in real time. The algorithm is based on Corollary 2.\nThe time complexity of Algorithm 1 for each new impression is $O(kc^2)$, and the overall space complexity is O(cT). It uses dynamic programming to avoid duplicate computation of $f(l; n, 1/k), \\forall l \\in \\{1, ..., c\\}, n \\in \\{1, . . ., T\\}$. For the particular case when the groups are non-overlapping, the time complexity goes down to $O(c^2)$ as the computation can be conducted on the group level instead.\nSimilar to the measurement algorithm, a streaming algorithm that computes $p_t$ is given in Algorithm 2. The quantity $p_t$ shows up in the bidding formula 7, which is used to optimize campaign performance.\nThe time complexity for each request is O(kc), and the overall space complexity is O(cT)."}]}