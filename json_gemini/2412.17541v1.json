{"title": "Concept Discovery in Deep Neural Networks for Explainable Face Anti-Spoofing", "authors": ["Haoyuan Zhang", "Xiangyu Zhu", "Li Gao", "Jiawei Pan", "Kai Pang", "Guoying Zhao", "Stan Z. Li", "Zhen Lei"], "abstract": "With the rapid growth usage of face recognition in people's daily life, face anti-spoofing becomes increasingly important to avoid malicious attacks. Recent face anti-spoofing models can reach a high classification accuracy on multiple datasets but these models can only tell people \"this face is fake\" while lacking the explanation to answer \"why it is fake\". Such a system undermines trustworthiness and causes user confusion, as it denies their requests without providing any explanations. In this paper, we incorporate XAI into face anti-spoofing and propose a new problem termed X-FAS (eXplainable Face Anti-Spoofing) empowering face anti-spoofing models to provide an explanation. We propose SPED (SPoofing Evidence Discovery), an X-FAS method which can discover spoof concepts and provide reliable explanations on the basis of discovered concepts. To evaluate the quality of X-FAS methods, we propose an X-FAS benchmark with annotated spoofing evidence by experts. We analyze SPED explanations on face anti-spoofing dataset and compare SPED quantitatively and qualitatively with previous XAI methods on proposed X-FAS benchmark. Experimental results demonstrate SPED's ability to generate reliable explanations.", "sections": [{"title": "I. INTRODUCTION", "content": "Due to the vulnerability of face recognition systems to attack, academia and industry have paid extensive attention to face anti-spoofing technology [1]. Nowadays, face anti-spoofing technologies [2], [3], [4], [5] have already reached a high level of defense against physical attacks such as print, replay, makeup and 3D masks, etc. However, these technologies can only answer the question \u201cwhether the photograph provided was fake\u201d while lacking the evidence to support its results which brings doubts and implicit bias.\nWhen a facial recognition system rejects an image for security reasons, it is considered necessary for the system to provide an explanation. Without such an explanation, the interaction can become not only frustrating and uncomfortable for users, but also lack transparency and trustworthiness. Thus an X-FAS (eXplainable Face Anti-Spoofing) system is advocated to provide user-friendly face anti-spoofing results by generating explanations based on face anti-spoofing models, which is the goal of this paper. We believe X-FAS is crucial as it can make the anti-spoofing system more comprehensive and significantly enhance the user experiences and reliability of the systems.\nThe field of XAI (eXplainable Artificial Intelligence) [6], [7], [8], [9] has emerged to demystify the inner workings of black-box models and offer insights into their decision-making processes. These techniques examine the basis of the model's results and present in the form of heatmaps of interesting regions. Recent XAI methods [10], [11] begin to find the importance of concept discovering, for example, CRAFT [12] can find and mark saw blade in a image of class \u201cchain saw\u201d, making XAI provides not only a heatmap but also the corresponding activated concept.\nIn this paper, we introduce SPED (SPoofing Evidence Discovery), an X-FAS method that can discover spoof concepts and provide explanations of attack images. Given a well-trained face anti-spoofing model, SPED can discover spoof concepts from a given spoof dataset and analyze the importance of each concept without changing the anti-spoofing model, thus keep the original performance. With the help of discovered concept basis, SPED can mark the attention region of each concept if the input image is judged as a fake sample during inference. Examples are shown in Fig. 1, SPED find multiple activated concepts in attack images and provide the corresponding attention regions. To perform evaluation on X-FAS methods, we present an X-FAS benchmark to evaluate the quality of the generated explanations. Experiments show that SPED can discover key spoof concepts and provide a heatmap of corresponding concepts in face anti-spoofing tasks which increase the trustworthiness of users.\nOur main contributions can be described as follows:"}, {"title": "II. METHOD", "content": "In order to discover concepts of the attack image on faces and show the activated spoof concept and its region on the input sample, we separate the method into three parts which are concept discovery, importance analysis, and attribution estimation. The whole pipeline and detail of SPED can be seen in the left and right part of Fig. 2 respectively."}, {"title": "A. Preliminaries", "content": "Consider a general supervised learning setting, where $(x_1, ..., x_N) \\in \\mathcal{X}^N \\in \\mathbb{R}^{N \\times D}$ are N inputs images and $(Y_1, ..., Y_n) \\in \\mathcal{V}^N$ their associated labels. We are given a well trained predictor $f : \\mathcal{X} \\rightarrow \\mathcal{Y}$ which maps the input $x$ to the predicted class $f(x)$. We decompose the neural network $f$ into two components $g$ and $h$ where $g$ maps input $x$ to intermediate logits $g(x)$ and the second maps the intermediate logtis $g(x)$ to output $h(g(x))$. The original function $f$ is reconstructed as $f = h \\circ g$."}, {"title": "B. Concept discovery", "content": "The process of concept discovery is illustrated in the right part of Fig. 2 with pink arrow. Firstly, we gather a set of images that one wish to explain. There should be commonalities between these images, such as attack images with the same spoof strategy. We assume $\\pi(\\cdot)$ is a straightforward crop and resize function to create sub-regions and get a auxiliary dataset $X \\in \\mathbb{R}^{N' \\times d}$. To discover concepts, we feed X to the network to obtain activations $A = g(X) \\in \\mathbb{R}^{N' \\times h w \\times C}$ where $h w$ indicates the shape of activation map and C indicates the number of channel. We apply Semi-NMF (Semi Non-negative Matrix Factorization) [13] to factorize activation maps since the non-negative constraint on the coefficients brings better interpretability while remain the capability to process negative values. Semi-NMF decompose the average pooled activations A into a product of concept coefficients $U \\in \\mathbb{R}^{N' \\times K}$ and concept basis $W \\in \\mathbb{R}^{C \\times K}$ by solving:\n$\\displaystyle (U, W) = \\arg \\min_{U \\geq 0, W} ||A - UW^T||_F^2, \tabel (1)$\nwhere K indicates the number of concepts to discover and $||\\cdot ||$ denotes the Frobenius norm.\nAccording to Ding et al. [13], the objective can be solved by iterativley updating U and W as follows:\n$\\displaystyle W = X^+ U(U^T U)^{-1}, \tabel (2)$\n$\\displaystyle U=U \\frac{(AW)^+ + U(WW)^-}{(AW)^- + U(WW)^+}, \tabel (3)$\nwhere the separated positive and negative parts of a matrix M is:\n$\\displaystyle M^+ = (|M| + M)/2, \\quad M^- = (|M| - M)/2$"}, {"title": "C. Importance analysis", "content": "The process of concept discovery is illustrated in the right part of Fig. 2 with gray arrow. We adopt sobol indices proposed in CRAFT [12] to estimate the importance of each concept given the original N images X and the discovered concept basis W. We generate random perturbation mask $M \\sim U[0, 1]^K$ and leave-one perturbation $M_{\\sim k}$ by independently set number k to zero or other random number. The importance can be written as:\n$\\displaystyle S_k = \\frac{E_{M_{\\sim k}} (V_M (Y|M_{\\sim k}))}{V(Y)} \\tabel (4)$\nwhere $Y|M_{\\sim k} = g((U \\odot M)W^T) - g((U \\odot M_{\\sim k})W^T)$, $E$ indicates expectation and V indicates variance. We use Quasi-Monte Carlo Halton sequence as the random generator of perturbation mask M."}, {"title": "D. Attribution estimation", "content": "The process of concept discovery is illustrated in green box of Fig. 2 with blue arrow. After concept discovery, we get K concept basis $W \\in \\mathbb{R}^{C \\times K}$ of the given N images. Given an image $x_i$ (in the N images), we factorize the activations $A_i = g(x_i) \\in \\mathbb{R}^{h w \\times C}$ with the fixed concept basis W and get concept coefficients $U_i \\in \\mathbb{R}^{h w \\times K}$. Specifically, we can regard $U_{i, (x, y, k)}$ as the importance of concept k at (x, y) position of the activation map and the $U_{i, k}$ can be seen as a activation map of concept k. In this way, we factorizes a single input image into several concepts and its activation map.\nSince activation maps remain spatial correlations to the input image, we follow Collins et al. [14] to mark attention regions of each concept by scaling activation maps of concepts (keep 10% of the maximum value and set the rest to zero) to the input shape which indeed makes sense."}, {"title": "III. BENCHMARK", "content": ""}, {"title": "B. Evaluation metric", "content": "Due to the specificity of manifestations of explanation, we define a fair metric derived from intersection over union (IoU) termed normalized intersection over union (nIoU). Given a annotated evidence $M_G$ and a explanation $M_1$. First, get a processed explanation $M_1^*$ by assigning the first $x$ percent value as 1 and others 0. The metric nIoU can be formulated as follows:\n$\\displaystyle \\text{nIoU}(M_G, M_1, x) = \\frac{\\text{IoU} (M_G, M_1^*) * \\max(x, y)}{\\min(x, y)} \\in [0, 1]  \\tabel (5)$\nwhere y is the useful pixel percentage of annotated evidence $M_G$. $\\frac{\\text{min}(x,y)}{\\text{max}(x,y)}$ is the optimum value of IoU $(M_G, M_1)$"}, {"title": "IV. EXPERIMENTS", "content": "To demonstrate the efficacy of SPED, we analyze explanations generated by SPED by visualizing the discovered spoof concepts and corresponding attention regions. We also compare SPED with multiple previous commonly used X\u0391\u0399 methods on X-FAS benchmark quantitatively and qualitatively which further proves the reliability of SPED."}, {"title": "A. Concept discovery and explanation generation", "content": "We choose CASIA-FASD [16] dataset to further analyze the explanations generated by SPED. The spoofing evidence in CASIA-FASD can be summarized into concrete concepts since they are clear. For example, we can easily say the image is an attack sample if we find hands grabbing a photo. As shown in Fig. 4, concepts discovered by SPED is represented in multiple patches which is easy to be understood by users. All four types of concepts have clear semantic meanings: clutching hand, cut hole, photo edge and iPad border.\nWith the help of these discovered concepts, SPED can generate explanations which mark attention regions of activated corresponding concepts, as shown in Fig. 6. In the explanation of Fig. 6(a), SPED find activated concepts c1, c2, c3 and mark the specific attention region in red which is consistent with concepts in Fig. 4. While in the explanation of Fig. 6(b), SPED only find activated concept c1 and c4.\nThe result shows that SPED has the ability to discover spoof concepts which is easy to be understood by users and provide corresponding attention regions of each concept on top of face anti-spoofing models."}, {"title": "B. X-FAS comparison experiment", "content": "Baselines: We consider three categories of XAI methods: gradient-based methods, perturbation-based methods, and concept-based methods. Gradient-based methods include GradCAM [17], GradCAM++ [18], EigenGradCAM [19], AblationCAM [20], RandomCAM (code from [21]). Perturbation-based methods we choose RISE [22]. The concept-based method is SPED proposed in this paper. Following the evaluation protocol in [15], we calculate mean IoU and mean nIoU (detail in Section III-B) metric on four types of evidence in X-FAS benchmark.\nQuantitative comparison: Table I shows the overall results on X-FAS benchmark. Previous XAI methods show unstable performance on four types of spoof evidence. For example, GradCAM exceeds other previous XAI methods on type clutching hand and iPad border but get a low performance on other two types. However, on all four types of spoof evidence, SPED reach the highest performance on both IoU and nIoU metric proving the quality of its explanations.\nQualitative comparison: Fig. 5 shows the visualization comparison between multiple XAI methods and SPED. Previous XAI methods show a single heatmap where some cover the whole face missing finer-level information and some pay attention to partial spoof evidence. In contrast, SPED provides multiple heatmaps where each of them corresponds to a specific activated spoof concept."}, {"title": "V. CONCLUSION", "content": "In this paper, we propose a new problem termed X-FAS to provide reliable face anti-spoofing results by generating explanations on top of face anti-spoofing classification results to cope with the vulnerability of black-box models. We introduce SPED, an X-FAS method which can discover spoofing concepts that is easy to be understood by users and provide a heatmap of activated concepts of attack images. To evaluate the quality of X-FAS methods, we present an X-FAS benchmark with expert annotations on four types spoof evidence. In our experiments, both quantitative and qualitative results show the efficacy and reliability of SPED. We hope that this work will guide further efforts in the research for X-FAS which can eliminate user's doubts of face anti-spoofing models and make it more transparent, trustworthy and effective."}]}