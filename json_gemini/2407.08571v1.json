{"title": "MULTI-GROUP PROPORTIONAL REPRESENTATION", "authors": ["Alex Oesterling", "Claudio Mayrink Verdun", "Carol Xuan Long", "Alex Glynn", "Lucas Monteiro Paes", "Sajani Vithana", "Martina Cardone", "Flavio P. Calmon"], "abstract": "Image search and retrieval tasks can perpetuate harmful stereotypes, erase cultural identities, and amplify social disparities. Current approaches to mitigate these representational harms balance the number of retrieved items across population groups defined by a small number of (often binary) attributes. However, most existing methods overlook intersectional groups determined by combinations of group attributes, such as gender, race, and ethnicity. We introduce Multi-Group Proportional Representation (MPR), a novel metric that measures representation across intersectional groups. We develop practical methods for estimating MPR, provide theoretical guarantees, and propose optimization algorithms to ensure MPR in retrieval. We demonstrate that existing methods optimizing for equal and proportional representation metrics may fail to promote MPR. Crucially, our work shows that optimizing MPR yields more proportional representation across multiple intersectional groups specified by a rich function class, often with minimal compromise in retrieval accuracy.", "sections": [{"title": "Introduction", "content": "A recognized objective in fair machine learning (ML) is discovering, reporting, and mitigating representational harms [1-3]. Representational harms arise when systems reinforce and perpetuate the marginalization of population groups based on characteristics such as race, socioeconomic status, cultural background, and gender [1, 4-6]. These harms often manifest through the biased portrayal or misrepresentation of these groups, stereotype reinforcement, and erasure of cultural identities [7, 8]. Representational harms have been widely documented in ML systems. For instance, many freely available datasets used in ML are not geo-diverse [9], and generative models can output images that under-represent demographic minorities across gender and racial identities [10-12].\nWe focus on representation in retrieval tasks. Representational harms in retrieval and ranking tasks arise when retrieved items do not accurately reflect the true diversity and proportions present in reality, perpetuating harmful stereotypes and biases [13]. For instance, Kay et al. [2] demonstrated that, in 2015, only 10% of the top 100 results for CEO in Google Image Search were women, despite 28% of CEOs in the US being women, and recent studies [14, 15] have demonstrated that this bias is still present in modern image search engines. Later, Otterbacher et al. [16] showed that the search engine Bing usually produced twice as many men as compared to women when queried with the word \u201cperson\u201d. Finally, [17] systematically studied gender biases in image representations by auditing the four most important image search engines: Google, Bing, Baidu, and Yandex. In particular, among other findings, this study showed that when a qualifier such as \u201cintelligent\u201d is added to the query \u201cperson\u201d, the engines still exhibit a huge gender discrepancy; see also [1, Chapter 7]. When retrieval is based on a search over vector embeddings of images and text, biases in embedding models can propagate to retrieved results, leading to disparate representation of people by demographic groups such as gender or race [18-20], as well as propagating spurious correlations from the dataset more broadly [21] or distorting results due to stereotypes present in the representation [22]. Though correlations between unrelated semantic concepts do not necessarily constitute representational harms, a wealth of research charts undesirable bias in embedding models, including publicly available joint vision-language foundational embedding models such as CLIP [23] used for retrieval."}, {"title": "A Multi-Group Proportional Representation Metric", "content": "Preliminaries. Consider a retrieval dataset of items from which we aim to retrieve relevant entries, denoted by $D_R = \\{x_i\\}_{i=1}^n$. We assume that $x \\in \\mathbb{R}^d \\times G$, where G is a set of additional labels for each item. For example, items x can be d-dimensional embeddings of images, videos, or textual content, in which case G = \u00d8. Alternatively, $x = (e_i, g_i)$, where $e_i \\in \\mathbb{R}^d$ is an embedding and $g_i$ is a vector of labels indicating group membership (e.g., gender, race, ethnicity).\nGiven a query embedding $q \\in \\mathbb{R}^d$, the goal of retrieval is to search and return the top-k most similar items to q in $D_R$. The similarity between an embedding of q and items in $D_R$ is measured according to a metric $\\kappa : \\mathbb{R}^d \\times \\mathbb{R}^d \\rightarrow \\mathbb{R}$. Throughout the paper, we assume that $D_R$ is a vector database and $\\kappa$ is cosine similarity between embeddings, though this formulation can be generalized. To retrieve items from $D_R$, users prompt a query q (e.g., \"Fortune 500 CEOs\") which is then embedded $ \\mathbb{R}^d$. Ideally, the user receives k retrieved items $R(q) = \\{x_1,...,x_k\\} \\subset D_R$ such that $\\kappa(q, x_i) \\geq \\kappa(q, x)$ for all $x \\notin R(q)$ and $i \\in [k]$.\nThe simplest setting for measuring representation is to consider only two population groups denoted by a binary variable \u2013 a setting commonly found in the fair retrieval and generation literature [18, 19]. In this case, group membership is determined by a group-denoting function $c : \\mathbb{R}^d \\times G \\rightarrow \\{-1,1\\}$. For an item $x, c(x)$ indicates membership to group -1 or 1 (e.g., male/female) based on its embedding $e_i$ and associated labels $g_i$. If the retrieval dataset $D_R$ contains annotations for group membership, $c(x)$ can simply return the relevant feature from $g_i$. However, when group labels are not present (i.e., G = \u00d8), c(x) can be implemented as a classifier that predicts group membership based on the item's embedding $e_i$.\nWith a group-denoting function c(x) in hand, we can measure the representation of each group in a set of retrieved items R(q). One popular constraint for representation is equal representation [2, 28], which aims to ensure that the number of retrieved items in each group is approximately the same, i.e., $\\Sigma_{x^*\\in R(q)} c(x^*) \\approx 0$. An alternative metric is proportional representation [20, 61], which quantifies the deviation of group membership from a reference distribution Q. Methods that promote proportional representation aim to ensure $\\Sigma_{x^*\\in R(q)} c(x^*) \\approx \\mathbb{E}_Q [c(X)]$."}, {"title": "Computing Multi-Group Proportional Representation", "content": "Computing MPR in Defnition 1 requires approximating two quantities: the representation distribution Q and the supremum $sup_{c \\in C}$. We first establish generalization bounds for approximating Q using i.i.d. samples. We then show how to compute $sup_{c \\in C}$ for several classes of representation statistics C.\nError in approximation Q via a curated dataset. Proposition 1, proved in Appendix A, bounds the deviation between the empirical MPR computed over the curated dataset $D_C$ drawn i.i.d. from reference distribution Q and the true MPR measured over Q.\nProposition 1 (Generalization Gap of MPR). Let $R(q) = \\{x_i\\}_{i=1}^k$ be a set of k retrieved samples, $D_C = \\{x_i\\}_{i=1}^m$ be a curated dataset comprised of m i.i.d. samples from a target representation distribution Q, and $\\delta > 0$. If $C = \\{c : \\mathbb{R}^d \\times G \\rightarrow \\{-1,1\\}\\}$ with Rademacher complexity $R_m(C)$ then, with probability at least $1 - \\delta$,\n$|MPR(C, R, D_C) - MPR(C, R, Q)| \\leq R_m(C) + \\sqrt{\\frac{\\log (2/\\delta)}{8m}}$\nWe can extend Proposition 1 to any set of bounded functions C (see, e.g., bounds on empirical MMD estimates in [63]). Note that the guarantee in (2) only holds for a single set of retrieved items R in response to a query. Proposition 2 provides a bound on the size m of an i.i.d. curated dataset $D_C$ that ensures an $\\epsilon$-accurate estimate of MPR for a set of M queries.\nProposition 2 (Query Budget Guarantee). Consider any set of M queries $Q = \\{q_1, ..., q_M \\}$ where $M \\in \\mathbb{N}$. Let $VC(C)$ denote the VC-dimension of the class C with range in $\\{-1,1\\}$. For $\\epsilon > 0$, if $D_C$ consists of m i.i.d. samples drawn from Q where m satisfies\n$m \\geq \\frac{32VC(C)}{\\epsilon^2} + \\frac{2 \\log (\\frac{2M}{\\delta})}{2 \\epsilon^2}$\nthen, with probability at least $1 - \\delta$, $|MPR(C, R, D_C) - MPR(C, R, Q)|\\leq \\epsilon$.\nThe above results provide guidelines on the size of the curated dataset required to accurately estimate MPR relative to a true target representation distribution Q. If the class of representation statistics C is very complex (in the VC-dimension sense), then the size m of the curated dataset $D_C$ must be proportionally large to represent Q accurately. Hence, the curation dataset should be designed having in mind (i) the number of diverse queries being asked and (ii) the complexity of the function class C. While Proposition 2 provides a conservative bound, as generalization bounds are often not tight [67], these results nevertheless offer insight into the relationship between the complexity of C and the accuracy of MPR estimation.\nIn the remainder of the paper, we assume that MPR is computed against a fixed curated dataset $D_C$ of size m. We consider four specific instantiations of the set of representation statistics C: (i) C is closed under scalar multiplication, i.e., if $c \\in C$, then $\\lambda c \\in C$ for any $\\lambda \\in \\mathbb{R}$, (ii) C is a set of functions taking values in $\\{-1, 1\\}$; (iii) C consists of linear functions; and (iv) C consists of functions in a Reproducing Kernel Hilbert Space (RKHS). Next, we show that for cases (i) and (ii) MPR can be computed using calls to an oracle that performs regression over C and, for linear functions (iii), MPR has a simple closed-form expression. Due to its technical nature, we defer the calculation of MPR for functions in an RKHS to Appendix B.2.\nComputing MPR via Mean Square Error (MSE) Minimization. When C is closed under multiplication or consists of binary functions with values -1, 1, MPR can be expressed as an MSE minimization. This enables us to compute MPR by leveraging existing black-box oracles that perform regression under quadratic loss, such as regressors/classifiers implemented in ML libraries like scikit-learn [68]."}, {"title": "Promoting Multi-Group Proportional Representation in Retrieval Tasks", "content": "Next, we develop an optimization framework for retrieving the k most similar items in a vector database to a given query q while satisfying a target MPR threshold of \u03c1. We formulate the retrieval goal as maximizing the average similarity between a query and retrieved items, given by $s_i = \\kappa(x_i, q)$ (recall Section 2 for notation), where $\\kappa(x_i, q)$ is given by cosine similarity in our experiments. The problem of maximizing utility in retrieval while satisfying an MPR constraint (expressed as Eq. (4)) can be formulated as the integer program:\n$\\max_{a \\in \\{0,1\\}^n} \\sum_{i=1}^n a_i s_i$ subject to $sup_{c \\in C} |\\frac{1}{k} \\sum_{i=1}^n a_i c(x_i) - \\frac{1}{m} \\sum_{i=1}^m c(x_i)| \\leq \\rho, \\sum_{i=1}^n a_i = k$.\nWhen C is given by normalized linear functions as in Proposition 4, the integer constraints can be relaxed to $a \\in [0, 1]^n$ and the optimization can be approximated via standard quadratic solvers; see Appendix B.1.\nMulti-Group Aware Retrieval. We approximate (10) via the Multi-Group Aware Proportional Retrieval Algorithm (MAPR), described in Algorithm 1. MAPR is essentially a cutting-plane method that aims to find a set of k items that maximize utility while approximately satisfying an MPR constraint of \u03c1. The algorithm iterates between (i) a call to an oracle that computes MPR and returns a function $c \\in C$ that achieves the supremum in (4) and (ii) a call to a linear program (LP) solver that approximates the top-k most similar items to a query subject to linear constraints on the violation measured by c. Each oracle call adds an additional constraint to the LP solver which, in turn, approximates the top-k items under an increasing set of constraints. The solution of the LP is rounded to satisfy the integer constraint $a \\in \\{0,1\\}^n$. In our implementation, we assume that MPR can be computed via MSE minimization (cf. Section 3) in which case we consider the normalized class C'. The oracle call consists of running a black-box quadratic loss minimization over C.\nInterestingly, we observe that, despite relaxing the integer constraints in each LP call, the solution to the relaxed problem is very sparse and (after rounding) approximates well the solution of the ideal integer program (10) for moderate values of \u03c1. However, the method can fail to accurately approximate the IP solution when \u03c1 is small. We present a more detailed analysis of MAPR in Appendix B, which discusses potential convergence issues with the cutting plane method as well as stopping conditions."}, {"title": "Numerical Experiments", "content": "In this section, we show that MAPR is effective in promoting more proportional representation across intersectional groups while preserving similarity between retrieved items and a given query. Notably, MAPR Pareto-dominates competing benchmarks in terms of achieved MPR gap and utility.\nDatasets. We conduct retrieval over three image datasets of faces: CelebA [37], which includes labels for gender, age, and various other attributes, UTKFace [39], which contains gender, age, and race attributes, and Occupations [2], which contains gender attributes. We compute MPR using FairFace [38] as the curated dataset $D_C$, since it is a carefully designed dataset of faces with subgroup attributes for race, gender, and age. In all cases, each dataset entry consists of an image (CLIP) embedding $e_i$ and a set of labels $g_i$.\nBenchmarks. We compare our method with four baselines. DebiasClip [20] modifies text queries with a prepended learned embedding for debiased retrieval but does not allow for tunable control of the representation-similarity trade-off,"}, {"title": "Concluding Remarks and Limitations", "content": "In this work, we introduced a novel retrieval metric called Multi-group Proportional Representation (MPR) and developed algorithms to ensure MPR in retrieval tasks. By measuring deviations in a set of representation statistics, MPR provides a scalable approach to quantifying and enforcing proportional representation for complex, intersectional groups. We analyzed the generalization properties and realizable regimes of MPR and, through experiments in image retrieval, demonstrated its favorable utility-fairness trade-off compared to existing fair retrieval algorithms.\nOur work has limitations that offer opportunities for future research. First, while MPR is designed to handle a large number of groups, the computational complexity of the proposed cutting-plane algorithm in the case of a general function class C can be a concern for high-dimensional feature spaces. Developing more efficient algorithms or approximation techniques could help address this issue. Second, while we focused on retrieval tasks, adapting MPR to other domains, such as ranking, recommendation systems, and image generation, could broaden its impact and applicability. Future research could also investigate the long-term societal impact of enforcing MPR in real-world retrieval systems to understand its potential benefits and risks. Finally, MPR is inherently limited by the curated dataset. If this dataset is biased against a given group, this bias will be propagated by MAPR. The creation and selection of curated datasets must carefully account for stakeholder interest and target representation statistics."}]}