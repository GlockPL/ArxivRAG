{"title": "Identity-Driven Hierarchical Role-Playing Agents", "authors": ["Libo Sun", "Siyuan Wang", "Xuanjing Huang", "Zhongyu Wei"], "abstract": "Utilizing large language models (LLMs) to achieve role-playing has gained great attention recently. The primary implementation methods include leveraging refined prompts and fine-tuning on role-specific datasets. However, these methods suffer from insufficient precision and limited flexibility respectively. To achieve a balance between flexibility and precision, we construct a Hierarchical Identity Role-Playing Framework (HIRPF) based on identity theory, constructing complex characters using multiple identity combinations. We develop an identity dialogue dataset for this framework and propose an evaluation benchmark including scale evaluation and open situation evaluation. Empirical results indicate the remarkable efficacy of our framework in modeling identity-level role simulation, and reveal its potential for application in social simulation.", "sections": [{"title": "1 Introduction", "content": "The advanced natural language generation capabilities of Large Language Models (LLMs) enable the creation of convincing human simulacra, which have attracted significant research interest. By building Role-Playing Agents (RPAs), LLMs can emulate various personas, ranging from specific individuals to typical representatives of demographic groups. The applications of RPAs offer benefits beyond entertainment \u00b9 and have significant influences in fields such as psychotherapy, economics and social studies. The implementation of Role Playing Agents can be categorized into two primary approaches: prompt-based strategies and fine-tuning methods."}, {"title": "2 Methodology", "content": ""}, {"title": "2.1 Hierarchical Identity Role-Playing Framework", "content": "Identity Theory asserts that individuals have multiple identities stemming from their affiliations with various social groups, categorized by criteria such as occupation, ethnicity, and gender. The relationship between identities is either exclusive or compatible. Identities within the same category are generally mutually exclusive (e.g. progressive v.s conservative), while those from different categories may coexist within an individual (e.g. a progressive artist). To this end, we devise the Hierarchical Identity Role-Playing Framework (HIRPF) to construct identity-level role-playing from personality traits and professions, which is distinguished by two features: identity isolation and explicit control.\nIdentity Isolation Identity isolation is used to model mutual exclusivity between identities, which operates on two levels: intra-level and inter-level isolation. For intra-level, refer to and assume that $W_o \\in \\mathbb{R}^{m \\times d}$ represents the parameter matrix of the pre-trained LLM, we specify corresponding Lora matrices $B_i \\in \\mathbb{R}^{m \\times r}$ and $A_i \\in \\mathbb{R}^{r \\times d}$ for each identity in the same category (personality or profession), where i indicates the i-th identity in the category and r indicates the rank of Lora. For inter-level, Lora matrices for"}, {"title": "Explicit Control", "content": "To model compatibility between identities, allowing flexible and controlable fusion of identities, we achieves explicit control. This enables users to tailor the identity composition for their requirements. Given the identities to be activated {10, 11, ..., ia} in j-th block, where a indicates the number of active identities, the updated attention parameters $W_j$ are derived as follows:\n$W_j = W_o + \\sum_{k=1}^{n} w_{jk} \\cdot B_k A_k$\n$w_j = Gate(e_j)$\n$= Softmax(M_j \\cdot \\sigma(e_j)) \\in \\mathbb{R}^{n}$\nwhere n indicates the total number of identities in j-th block, $e_j \\in \\mathbb{R}^{n}$ represents the input features for the block, $o$ is the sigmoid function that scales ej into a positive range, and $M_j \\in \\mathbb{R}^{n \\times n}$ is a diagonal mask matrix. In Mj, diagonal elements corresponding to activated identities are set to 1 while others are set to -\u221e, which ensures that only the weights for the active identities remain positive and influence the model's output, maintaining clear control over the model's identity combination."}, {"title": "Training & Inference", "content": "During the training phase, HIRPF receives dialogues and associated active identities. Role prompts are initially constructed from these identities, combined with the dialogue, and tokenized before model input. During forward propagation, routers apply explicit control based on active identities, updating only related routers and Lora parameters while keeping other parameters unchanged. In the inference phase, users activate specific identities and role prompts to start conversations."}, {"title": "2.2 Identity Dialogue Dataset", "content": "Most existing role-playing datasets focus on the role level without providing identity-level data. While some datasets cater to specific personalities, they fall short in covering interactions across multiple identity categories. Consequently, we have developed an identity dialogue dataset that includes dialogues featuring individual personality traits, professions, and multiple identities.\nSingle Personality The construction of dialogues with singular personality traits follows the pipeline outlined in : occasion generation, plot generation, and dialogue generation. Initially, we employ ChatGPT 2 to create a variety"}, {"title": "3 Benchmark", "content": "To evaluate identity-level agents, we construct a benchmark including scale tests and open-ended situation tests."}, {"title": "3.1 Scale Test", "content": "We first conducted scale tests to assess the fit of each identity, including personality scale and profession scal."}, {"title": "Personality Scale", "content": "We use BF-marker-10033 as the personality scale, which is one of the most widely used scales in Big-Five. In BFM, there are 20 items in each trait. Each item is a statement that reflects the positive or negative aspect of one trait. The scale is originally a five-dimensional Likert scale, and subjects need to choose according to the item how much it is consistent with them."}, {"title": "Profession Scale", "content": "The profession scale aims to evaluate the character's suitability for a specific profession. Since no similar scales available, we model the personality scale and construct a profession scale. In the profession scale, each item for one occupation is a statement related to the professional knowledge or skills. It is used to measure whether the character imitates the relevant knowledge of the corresponding profession, and at the same time, the character is expected to be ignorant of non-professional knowledge. There are 20 items for each occupation in this scale."}, {"title": "Test Implementation", "content": "Although the original personality scale was a five-dimensional Likert scale, issues often arose during implementation where the agent's outputs did not align with its explanations. To address this, we introduced an interactive scale measurement method. This method involves using ChatGPT to question the agent and engage in multiple rounds of dialogue to elicit detailed responses about each item. ChatGPT then evaluates these responses to determine which scale option the agent matches, using self-consistency checks to finalize the decision. We have established three rounds of interaction and 5 repetitions of self-consistency in the evaluation phase."}, {"title": "3.2 Open-end Situational Test", "content": "In addition to the fit of a single identity, we also want to be able to evaluate the accuracy of multi-identity fusion. Rather than each item on a scale"}, {"title": "4 Experiments", "content": ""}, {"title": "4.1 Experimental Setup", "content": "Implementation Details We apply our framework HIRPF on top of Llama2-7b-chat and fine-tune it using our identity dialogue dataset. The a and r of the LORA method are both set to 16. There are 10 personality identities (positive and negative for each trait) and 3 professional identities (artist, doctor, and programmer). We set the learning rate to 1 \u00d7 10-4, batch size to 8, gradient accumulation step to 4, employ AdamW as the optimizer and train the model 5 epochs on 8 NVIDIA RTX4090 GPUs.\nModels for comparision Since we are the first to propose a role-playing method from the identity level, there is currently no equivalent fine-tuning model to compare with us, so we mainly compare with prompt-based methods, and the comparison with role-specific fine-tuning methods will be left in the discussion part 5. We selected the following models for comparison:\n\u2022 LLaMA-2: Developed by Meta, LLaMA-2 is an open-source language model. For comparative analysis, we have chosen the LLaMA-2-7b-chat variant.\n\u2022 LLaMA-3: The latest in the LLaMA series, LLaMA-3 represents an advancement over its predecessors with several improvements. We have selected the LLaMA-3-8B-Instruct model for comparison."}, {"title": "4.2 Main Results", "content": "Single Trait Simulation Figure 3 illustrates a comparison between our method and baseline models in accurately representing single personality polarities. The original scores on the scale range from 1 to 5, with higher scores indicating more pronounced positive traits and lower scores corresponding to negative traits. The scores shown in the figure represent the absolute differences from the neutral score of 3, The higher the value, the higher the degree of fitting to the trait in the corresponding direction. Our method shows superior performance across all dimensions compared to models with similar parameter sizes, including Llama2-7B-chat and Llama3-8B-Instruct. Additionally, our method surpasses the ChatGPT in depicting most personality traits, especially negative ones such as low agreeableness, low conscientiousness, low extraversion, and low openness. This advantage is largely due to the limitations of ChatGPT's ethical and moral frameworks, which hinder its ability to accurately express negative traits and realistically simulate behaviors associated with these traits.\nSingle Profession Simulation Figure 4 displays the performance of our method compared to baseline models using the professional scale. In the figure, the horizontal axis represents the various occupational dimensions covered by the scale, while the vertical axis quantifies the fidelity of representation across specific occupations. Agents developed through our method consistently achieve the highest fidelity scores in the dimensions consistent with their professions and markedly lower scores in non-professional dimensions. This distinction is critical as it shows that our method not only excels in accurately fitting into specific occupational roles but also effectively discriminates between different professional identities. This precision in role-fitting and identity distinction is especially valuable in applications requiring accurate role portrayal and differentiation, such as training simulations, automated customer service, and interactive educational systems.\nOpen-end Situation Test Table 5 displays the outcomes of an open-ended situational test designed to assess whether an agent accurately represents the required identity in performance. Each column within the table measures the precision with which the agent's generated dialogues align with a predefined identity, assessing how well the agent captures the essence of the specified character traits. The results reveal that our method achieves superior accuracy in simulating the trait of agreeableness, outperforming the ChatGPT in"}, {"title": "5 Discussion", "content": ""}, {"title": "5.1 Comparision with Role-specific model", "content": "The framework in this study is not compared with role-specific models as it emphasizes demographic effects in broad social simulations rather than detailed role simulations. It focuses on group dynamics over individual identities to better represent general characteristics of demographic groups. This approach is particularly relevant for social governance and group decision-making. We will demonstrate the applications of our framework in social simulations to highlight its potential in Section 5.2."}, {"title": "5.2 Social Simulatin Application", "content": "Questionnaire Questionnaires are crucial in sociology for understanding diverse population responses to social issues. Researchers can leverage LLMs to simulate various demographic groups to predict how different segments might react to policies or societal changes."}, {"title": "6 Related Work", "content": ""}, {"title": "6.1 Role-Playing Agents", "content": "Role-playing agents powered by large language models (LLMs) have significantly evolved from using simple prompts to guide behavior, as initially noted by , to employing more sophisticated prompting strategies discussed by . Alternatively, researchers like have developed role-specific datasets for Supervised Fine-Tuning (SFT), creating specialized training corpora with persona-specific information to enhance foundational models' role-playing capabilities. Additionally, methods like those proposed by , which integrate training with retrieved information, further augment these capabilities."}, {"title": "6.2 Mixed Expert Models", "content": "Recent advancements in Mixture-of-Experts (MoE) models showcase innovative methods. introduced a model where experts, rather than tokens, select the top-k tokens. demonstrated that combining this method with instruction tuning offers greater benefits to MoE models compared to dense models. developed MOELORA, utilizing low-rank matrices and a task-motivated gate function for expert adjustment according to specific tasks. implemented a learnable gating function in each Low-Rank Adaptation (LoRA) layer to optimize domain-specific weights."}, {"title": "6.3 Social Simulation", "content": "Large Language Models (LLMs) have revolutionized social simulation, enabling the creation of virtual communities and complex social dynamics. developed a virtual community using agent-driven models, while explored the simulation of human social collaboration. created a social network simulation platform to observe phenomena like information spread and emotional shifts. Concurrently, research on the social capabilities of intelligent agents has advanced, with introducing a benchmark to evaluate agent interactions, further deepening our understanding of their dynamics."}, {"title": "7 Conclusion", "content": "In this work, we address the limitations of conventional role-playing methods by developing a hierarchical identity role-playing framework rooted in identity theory. This framework, integrating LORA and MoE technologies, facilitates identity isolation and explict control, enabling the modeling and seamless integration of multiple identities for authentic and flexible role-playing. We constructed a specialized identity dialogue dataset to train this framework and established a comprehensive benchmark for systematic evaluation, including scale and open situation assessments. Our results show that our framework outperforms traditional prompt-based approaches and matches or surpasses ChatGPT in certain performance metrics. We also explore how our framework distinguishes itself from role-specific fine-tuned models, highlighting its potential for advanced social simulation."}, {"title": "Limitations", "content": "Our proposed framework focuses on demographic role fitting and aims to accurately simulate specific groups. By integrating this framework with retrieval enhancement technology, we can simulate individual behaviors and characteristics using detailed personal information, biographies, and memories. Although our dataset, based on ChatGPT, incorporates several measures to ensure credibility and authenticity, it still differs from real conversation data. Moving forward, we plan to incorporate real conversation data into our modeling efforts to bridge this gap and enhance realism."}, {"title": "Ethics Statement", "content": "Our proposed framework is designed to facilitate role-playing at the identity level, focusing specifically on the dimensions of personality and occupation. The data, constructed entirely using ChatGPT, is devoid of personal privacy concerns and free from individual biases or harmful content. We ensure that the dataset, which includes negative traits as understood by GPT, contains no toxic information. Throughout the data generation and model training processes, we meticulously control for the exclusion of sensitive or harmful content, ensuring the safety and integrity of the generated text."}, {"title": "A Appendix", "content": ""}, {"title": "A.1 Big-Five Personality Traits", "content": "Personality is defined as \"the coherent pattern of effect, cognition, and desires (goals) as they lead to behavior\". the Big Five represents the most widely adopted personality framework for quantifying personality. This personality theory is not only applicable to individuals across many countries and cultures but also furnishes reliable assessment scales for measuring personality. Here's a detailed look at the five personality traits that make up the Big Five.\nOpenness to experience is commonly defined as the extent and intricacy of an individual's cognitive life and encounters. This trait is frequently concomitant with attributes such as imagination, originality, and insight within the psychological framework. Individuals demonstrating a pronounced openness to experience are inclined towards venturing beyond their comfort zones, embracing novelty, and deriving satisfaction from artistic pursuits. Additionally, such individuals are predisposed to cultivating new social connections. Conversely, an individual exhibiting a diminished openness to experience may manifest tendencies towards conformity, obstinacy, and a preference for more concrete, non-abstract elements in various aspects of life. Openness to experience displayed a diminished association with both neuroticism and extraversion while exhibiting predominantly negligible correlations with agreeableness and conscientiousness.\nConscientiousness is closely linked to organizational tendencies, conformity, and a predilection for seeking security, demonstrating an inverse association with a penchant for stimulation and excitement. Individuals characterized by a high degree of conscientiousness are likely to place value on attributes such as order, responsibility, achievement, and self-discipline. They engage in conscious deliberation and earnest efforts to enhance their abilities, reflecting a commitment to continuous improvement. This trait exhibited a modest negative correlation with neuroticism and a modest positive correlation with agreeableness; however, its association with other factors did not reach statistical significance.\nExtraversion, a personality trait distinguished by enthusiasm, sociability, talkativeness, confidence, and heightened emotional expressiveness, encapsulates a spectrum of individual dispositions. Individuals exhibiting high levels of extraversion typically prioritize achievement and excitement while assigning comparatively lesser value to tradition or conformity. Such individuals are often characterized by confidence, activity, and sociability, opting for pursuits that eschew self-denial in favor of experiences characterized by excitement and pleasure. Conversely, introverts commonly display a preference for solitude, exhibit unsociable tendencies, and may manifest lower levels of self-confidence. In addition, when compared with the other five factors, extroversion was weakly negatively correlated with neuroticism and positively"}, {"title": "A.2 Abliation Experiments", "content": ""}, {"title": "A.3 Prompts", "content": ""}]}