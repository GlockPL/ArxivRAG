{"title": "Causally-Aware Spatio-Temporal Multi-Graph Convolution Network for Accurate and Reliable Traffic Prediction", "authors": ["Pingping Dong", "Xiao-Lin Wang", "Indranil Bose", "Kam K.H. Ng", "Xiaoning Zhang", "Xiaoge Zhang"], "abstract": "Accurate and reliable prediction has profound implications to a wide range of applications, such as hospital admissions, inventory control, route planning. In this study, we focus on an instance of spatio-temporal learning problem-traffic prediction-to demonstrate an advanced deep learning model developed for making accurate and reliable forecast. Despite the significant progress in traffic prediction, limited studies have incorporated both explicit (e.g., road network topology) and implicit (e.g., causality-related traffic phenomena and impact of exogenous factors) traffic patterns simultaneously to improve prediction performance. Meanwhile, the variability nature of traffic states necessitates quantifying the uncertainty of model predictions in a statistically principled way; however, extant studies offer no provable guarantee on the statistical validity of confidence intervals in reflecting its actual likelihood of containing the ground truth. In this paper, we propose an end-to-end traffic prediction framework that leverages three primary components to generate accurate and reliable traffic predictions: dynamic causal structure learning for discovering implicit traffic patterns from massive traffic data, causally-aware spatio-temporal multi-graph convolution network (CASTMGCN) for learning spatio-temporal dependencies, and conformal prediction for uncertainty quantification. In particular, CASTMGCN fuses several graphs that characterize different important aspects of traffic networks (including physical road structure, time-lagged causal effect, contemporaneous causal relationships) and an auxiliary graph that captures the effect of exogenous factors on the road network. On this basis, a conformal prediction approach tailored to spatio-temporal data is further developed for quantifying the uncertainty in node-wise traffic predictions over varying prediction horizons. Experimental results on two real-world traffic datasets of varying scale demonstrate that the proposed method outperforms several state-of-the-art models in prediction accuracy; moreover, it generates more efficient prediction regions than several other methods while strictly satisfying the statistical validity in coverage. An ablation study is also designed to examine the unique role of each considered graph in capturing traffic characteristics. This study not only contributes to the literature on traffic prediction-going beyond the conventional focus on connections of physical networks, but also provides a meaningful lens to support a wide range of learning problems with spatio-temporal characteristics.", "sections": [{"title": "1. Introduction", "content": "Accurate and reliable prediction is a cornerstone in data-driven decision automation across a broad spectrum of applications, such as inventory control, traffic management, product recommendations, etc. To make accurate prediction, it is essential to discover the underlying mechanism governing the data generation process by learning from observational data data. The mechanism often gets manifested in various forms such as associations, causal relationships, and temporal/spatial dependencies, and should be encoded appropriately in the model under development\u2014say, a machine learning (ML) model\u2014to inform learning and prediction. Due to the variability nature of practical decision-making environments, prediction reliability is as important as, if not more important than, prediction accuracy. This necessitates a statistically meaningful estimation of prediction uncertainty, often in the form of a confidence interval that is anticipated to contain the ground truth at a given confidence level. Across a wide range of application domains, however, a rigorous framework to deliver high-quality prediction and statistically valid uncertainty estimation is largely lacking in the literature. In this paper, we take traffic prediction as an exemplary application to showcase a generic framework developed for making accurate and reliable prediction under uncertainty. The studied traffic prediction problem is featured by several traits prevalent in other domains (e.g., disease spread control, social network influence modeling, location-based recommendation service): discovery of implicit patterns from observed data, spatio-temporal dependencies learning, data-driven fusion of heterogeneous information, and uncertainty estimation. In this sense, the proposed approach is fairly generic as it can be readily extended to other spatio-temporal learning problems.\nTraffic prediction is typically formulated as a spatio-temporal learning problem\u2014that is, to use the traffic states in the past M time steps to predict the states of the entire network over the next H time steps. Due to complex temporal and spatial dependencies pervasive in traffic networks, making accurate and reliable traffic predictions is highly challenging. Luckily, deep neural networks have come to the rescue in tackling spatio-temporal forecasting problems due to its powerful ability in end-to-end learning of intricate spatio-temporal dependencies (Shaygan et al. 2022, Li et al. 2022b). The extant studies predominately characterize traffic patterns along the spatial and temporal dimensions separately. Temporal dependencies in spatio-temporal data are typically modeled using recurrent neural networks (Luo et al. 2024). Spatial dependencies, on the other hand, are captured with methods like convolution neural networks for grid data and graph convolutional networks (GCNs) for graph-structured data (Pan et al. 2018, Li et al. 2022a, 2018). GCNs excel in extracting spatial features from non-Euclidean graph structures by relying on adjacency matrix defining node"}, {"title": "2. Dynamic Causal Structure Learning", "content": "When learning causal structures from observational data, Bayesian networks (BNs) are a popular analytical framework for modeling probabilistic relationships among random variables. Typically, BNs use directed acyclic graphs (DAGs) to represent conditional dependencies among random variables, where nodes denote random variables and directed edges indicate conditional dependencies (Heckerman 2008, Lan et al. 2024). Dynamic BNs extend static BNs to handle time-series data by modeling temporal dependencies (Murphy 2002). Currently, there are two classes of methods for learning graph structures: score-based and constraint-based methods (Cheng et al. 2002). Score-based methods aim to identify an optimal graph structure that maximizes a preset scoring function,"}, {"title": "2.3. Uncertainty Quantification", "content": "Traffic systems are inherently complex and dynamic, influenced by various factors such as road conditions, weather. Day-to-day variability, fluctuations in travel demand, and random traffic incidents all contribute to the uncertainty in traffic prediction (Sengupta et al. 2024). Quantifying the uncertainty arising from these sources enables the development of robust control and congestion mitigation measures. Bayesian methods have been widely used for quantifying prediction uncertainty in ML models (Sengupta et al. 2024, Lin et al. 2024) by assuming that the parameters of ML models follow certain prior distributions. These prior distributions are then combined with the observed data to infer posterior distributions of model parameters via Bayesian inference. Jin et al. (2024) assumed traffic flow follows a Gaussian distribution and added an additional layer to capture uncertainty in traffic state evolution. Qian et al. (2024) developed two independent subnetworks to maximize heterogeneous log-likelihood for estimating aleatoric uncertainty in traffic flows and utilized multi-hierarchical conformal calibration to relax the Gaussian distribution assumption. Other studies, such as Wang et al. (2024), and Jiang et al. (2023), have measured uncertainty by assuming variables follow either a Gaussian or Tweedie distribution. Despite these advancements, the inherent variability in traffic variables makes it challenging to characterize their uncertainty with a fixed probability distribution. Traffic variables can exhibit diverse characteristics over time"}, {"title": "3. Methodology", "content": "In this section, we describe the proposed methodology for network-wide traffic prediction. We first define the traffic prediction problem, formulate it as a learning problem, and outline the learning objective (Section 3.1). Next, we introduce the Causally-Aware Spatio-Temporal Multi-Graph Convolutional Network (CASTMGCN) for making deterministic prediction for each node (Section 3.2). Finally, we explain how to use the conformal prediction method to generate statistically meaningful uncertainty estimations for spatio-temporal traffic data (Section 3.4). The mathematical notations used in this paper are summarized in Table EC.2 (see the Online Supplement).\nTraffic prediction involves two key elements: traffic network and traffic state, described as below.\nA traffic network can be mathematically represented as a graph $G = (V, E, A)$, where V is a finite set of nodes ($|V| = N$) representing sensors, roads, intersections, or stations. E is the set of edges indicating connectivity between nodes, and $A \\in R^{NXN}$ is the adjacency matrix of graph G. In this study, we treat each road segment as an individual node in graph G since traffic detectors are installed underground to record relevant traffic quantities (e.g., traffic volume, speed).\nThe traffic variables of interest at time t are denoted by $x_t \\in R^{N\\times F}$, where N is the number of nodes in the road network and F is the number of traffic state variables (e.g., volume, speed, density). Let $X_M = [X_{t-(M-1)}, X_{t-M},...,x_t] \\in R^{N\\times FXM}$ represent the traffic variables of the entire road network over the M time steps prior to (and including) t.\nGiven graph G and historical traffic states $X_M$, the traffic prediction problem is mathematically formulated as learning a function $f (\\cdot)$ to predict the traffic state of the N nodes over the next H steps (i.e., $\\hat{Y}_H = [\\hat{y}_{t+1}, \\hat{y}_{t+2},..., \\hat{y}_{t+H}] \\in R^{N\\times F\\times H}$) based on the historical traffic states $X_M$ and the road"}, {"title": "3.2. Dynamic Causal Structure Learning", "content": "As previously mentioned, many implicit traffic patterns can be modeled from the lens of causality.\nFrom a causal perspective, the traffic state at time t (i.e., $x_t$) is influenced by two major factors:"}, {"title": "3.3. Spatio-Temporal Dependencies Learning", "content": "The matrices C and $A^{\\circ}$ derived from causal structure learning along with the predefined adjacency matrix indicating physical connectivity are incorporated into neural network for traffic prediction. Figure 1 shows the neural network composed of an embedding layer, stacked spatio-temporal blocks (ST-blocks), and a prediction layer. Each ST-block combines a gated attention temporal convolution network (Gated-ATCN) for temporal dependencies and a multi-graph convolution network (MGCN) for spatial dependencies in traffic data. By stacking these blocks, the module effectively captures spatio-temporal features at various scales, thus enhancing the accuracy of traffic prediction."}, {"title": "3.3.1. Embedding Layer", "content": "When making traffic prediction, it is crucial to encode specific time information (e.g., peak vs non-peak hours, weekdays vs weekends) into neural networks to capture time-dependent traffic patterns and causal relationships to enhance prediction accuracy (e.g., Zheng et al. 2020, Guo et al. 2021, Wu et al. 2019). Herein, we incorporate essential time information at granularity of 5 minutes (e.g., dividing an hour into 12 time steps), the hour of the day (e.g., 1, 2, 3, ...), and the day of the week (e.g., Monday, Tuesday, \u2026). Let $T_M$ denote the one-hot representation of time-related information over M time steps. We concatenate $X_M$ with $T_M$, forming the extended traffic state $\\tilde{X}_M = X_M||T_M \\in R^{N\\times M\\times F'}$, where F' is the feature space dimension.\nAdditionally, an embedding layer maps the original node-specific data across time steps into a d-dimensional continuous representation to enhance learning effectiveness. The embedding operation"}, {"title": "3.3.2. Gated-ATCN", "content": "While recurrent neural network are commonly used to capture temporal dependencies, they exhibit limitations when processing long temporal sequences, such as shorter reference windows, diminishing signals from earlier data, and exploding/vanishing gradients during backpropagation (Lu et al. 2020). To address these issues, we develop a Gated-ATCN to capture both short- and long-term temporal dependencies in time-series traffic data. We leverage the gated mechanism of TCNs for handling long sequences (Wu et al. 2019) and the self-attention mechanism for selectively capturing important information in the time-series data (Vaswani et al. 2017)."}, {"title": "3.3.3. MGCN", "content": "To extract spatial dependencies from traffic data, we develop an MGCN to learn spatial relationships in the road network. To compensate the effect of overlooked exogenous factors, we introduce an auxiliary matrix $\\hat{A}$ to adaptively characterize their spatial impact on the traffic state. Next, MGCN fuses multiple individual graphs representing different spatial relationships to extract useful spatial features (Geng et al. 2019). At a high level, MGCN is formulated as:\n$X_s = ||_{a \\in all} \\Sigma_{k=0} g(a)^k X_c W_k,$"}, {"title": "3.3.4. Prediction Layer", "content": "Following He et al. (2016), we add residual connections to each component (i.e., Gated-ATCN and MGCN) to prevent gradient vanishing during backpropagation. Stacking multiple ST-blocks enhances the model's capacity to learn spatio-temporal dependencies. Assuming there are k ST-blocks, the output of the final ST-block is represented as $Y = X_s + X_s^{k-1}$, where $Y = [\\hat{Y}_{t+1}, \\hat{Y}_{t+2}, ..., \\hat{Y}_{t+H}]$ is the final output of the model, $X_s^{k}$ is the output produced by the k-th ST-block, and $X_s^{k-1}$ is the output from the (k \u2212 1)-th ST-block added to the k-th ST-block's output through the residual connection.\nFinally, deterministic traffic predictions over multiple look-ahead time steps are made after two nonlinear fully-connected layers. The model is trained to minimize the mean absolute errors between actual traffic observations and predictions over the road network using the loss function below:\n$L = \\Sigma_{t=1}^{t+H} ||Y_i - \\hat{Y}_i||_1,$"}, {"title": "3.4. Uncertainty Quantification with Conformal Prediction", "content": "Conformal prediction (CP) is a distribution-free method for uncertainty quantification. In regression problems, CP generates a prediction region $\\Gamma^{1-\\alpha}$ at a significance level $1 - \\alpha$ to ensure that $\\Gamma^{1-\\alpha}$ contains the ground truth value with at least a probability of $1 - \\alpha$ (Stankeviciute et al. 2021). The proposed CP method, following the general procedure of CP, splits the original training data into a training $D_{train}$ and calibration set $D_{calib}$ with $n_{train} = |D_{train}|$ and $n_{calib} = |D_{calib}|$. A deterministic"}, {"title": "4. Computational Study", "content": "We demonstrate the effectiveness of the proposed framework for traffic prediction using two real-world traffic datasets. The proposed method is first compared with several state-of-the-art models in prediction accuracy. Next, we assess the validity and efficiency of conformal prediction methods to showcase the superiority of the proposed conformal prediction method in traffic prediction."}, {"title": "4.1. Dataset Description", "content": "The first real-world traffic dataset is the Hong Kong traffic dataset (referred to as the HK dataset hereafter). As a part of the \u201csmart mobility\u201d initiatives, the Hong Kong Transport Department installed 700 traffic detectors (see Figure 4(a) for their distribution) on strategic routes and major roads across Hong Kong. The detectors record real-time traffic information, including traffic volume,"}, {"title": "4.2. Experiment Setup", "content": "The Hong Kong traffic dataset is split into training, validation, and test sets with a ratio of 6:2:2. Dates for each set are: training (July 1 to September 12), validation (September 12 to October 7), and test (October 7 to October 31). The METR-LA dataset is divided into training, validation, and test sets with a ratio of 7:1:2. Dates for each set are: training (March 1 to May 23), validation (May 23 to June 4), and test (June 4 to June 27). Note that the validation set serves a dual role: on the one hand, it is used to tune hyperparameters to prevent model overfitting; on the other hand, it serves as a calibration set for quantile query in building prediction regions for the test set. Deep learning models are trained using the PyTorch framework on a NVIDIA GeForce RTX 4090 GPU. Model validation indicates that the best-performing model consists of 4 layers, as summarized in Table 1.\nDuring inference, historical data from the previous 12 time steps are used to predict the next 12 time steps. A lag value of P = 1 is used to balance the spatial relationship between time-lagged and contemporaneous causal graphs. For conformal prediction, the parameters are $\\eta = 0.95$, $\\zeta = 0.05$, and $\\beta = 0.9$ for the HK dataset, and $\\eta = 0.99$, $\\zeta = 0.01$, and $\\beta = 0.9$ for the METR-LA dataset."}, {"title": "4.3. Causal Relationship Analysis", "content": "To demonstrate the learned inter-slice and intra-slice causal graphs, we selected a one-week data for each dataset: July 21\u20137, 2023 for the HK dataset and March 1\u20137, 2012 for the METR-LA dataset."}, {"title": "4.4. Performance Comparison", "content": "In this study, we adopt two groups of methods as baselines to compare against our proposed method in traffic prediction and uncertainty estimation. In traffic prediction, we consider five deterministic models: DCRNN (Li et al. 2018), Graph WaveNet (Wu et al. 2019), ASTGNN (Guo et al. 2021), DDSTGCN (Sun et al. 2022), and STCGAT (Zhao et al. 2023a). In uncertainty estimation, we consider four methods: SCP (Lei et al. 2018), CFRNN (Stankeviciute et al. 2021), TQA-B and TQA-E (Lin et al. 2022), see Table EC.3 in the Online Supplement for detailed descriptions."}, {"title": "5. Conclusion", "content": "Accurate and reliable prediction is a paramount demand across a broad array of applications. In this paper, we take traffic prediction as an exemplary application to showcase a CASTMGCN framework developed for generating accurate and reliable traffic predictions over road network."}]}