{"title": "Chromosomal Structural Abnormality Diagnosis by Homologous Similarity", "authors": ["Juren Li", "Fanzhe Fu", "Ran Wei", "Yifei Sun", "Zeyu Lai", "Ning Song", "Xin Chen", "Yang Yang"], "abstract": "Pathogenic chromosome abnormalities are very common among the general population. While numerical chromosome abnormalities can be quickly and precisely detected, structural chromosome abnormalities are far more complex and typically require considerable efforts by human experts for identification. This paper focuses on investigating the modeling of chromosome features and the identification of chromosomes with structural abnormalities. Most existing data-driven methods concentrate on a single chromosome and consider each chromosome independently, overlooking the crucial aspect of homologous chromosomes. In normal cases, homologous chromosomes share identical structures, with the exception that one of them is abnormal. Therefore, we propose an adaptive method to align homologous chromosomes and diagnose structural abnormalities through homologous similarity. Inspired by the process of human expert diagnosis, we incorporate information from multiple pairs of homologous chromosomes simultaneously, aiming to reduce noise disturbance and improve prediction performance. Extensive experiments on real-world datasets validate the effectiveness of our model compared to baselines.", "sections": [{"title": "1 INTRODUCTION", "content": "chromosomal abnormalities, which include missing, extra, or irregular portions of chromosomal DNA [25], are the root cause of various genetic and hereditary diseases. It is estimated that 6 of every 1,000 newborns have chromosomal abnormalities, which often result in dysmorphism, malformations, and developmental disabilities [52]. These chromosomal changes caused by abnormalities lead to serious consequences, e.g. 25% of all miscarriages and still-births, and 50%-60% of first-trimester miscarriages [19]. With the help of chromosomal abnormality detection, clinicians can identify more abnormalities that may result in birth defects and take further preventive measures, which is of great significance to people's livelihood and social development.\nThere are two types of chromosomal abnormalities: numerical abnormality and structural abnormality [11]. Numerical abnormalities involve the absence or addition of entire chromosomes [14]. For example, an extra copy of chromosome 21 will cause Down syndrome. Structural abnormality refers to the deletion, excess, inversion, or translocation of a certain segment of one chromosome to"}, {"title": "2 PRELIMINARIES", "content": "To clearly illustrate our work, this section first introduces the dataset and the preprocessing steps. Detailed and formal definitions of the dataset and the problem formulation will be provided in this section."}, {"title": "2.1 Dataset and Preprocessing", "content": "Each chromosome data in the dataset contains two sequences sampled from the chromosome diagram. As shown in Figure 1 (a) and (b), the chromosome diagrams indicate a unidirectional flow of information, suggesting that the information density aligns with the chromosome's direction. Typically, image data exhibits information density along two perpendicular directions. Therefore, we propose converting the original data into chromosomal sequences for our dataset.\nAs shown in Figure 2, the chromosomal sequences represent the gray mean sequences derived from the left and right parts of the corresponding chromosome diagram. In a chromosome diagram, sister chromatids cross over the left and right sides of the chromosome. A sister chromatid refers to the identical copies (chromatids) formed by the DNA replication of a chromosome [41]. In theory, both of them would look the same in chromosome diagram. However, the left and right sides of the chromosome diagram are not completely symmetrical due to the bending of the chromosome and uneven staining of stains. Thus, we need to sample both the left and right sequences. For convenience, we use the term \u201cchromosome\u201d to represent the sampled chromosomal sequence."}, {"title": "2.2 Problem definition", "content": "Inspired by the diagnostic process of human experts, we find that considering the information of multiple-pairs homologous chromosomes at the same time can make the judgment more reliable. This also reduces the noise disturbance of considering only one pair of homologous chromosomes. Thus we combine multi-pair homologous chromosomes to form a bag, denoted by X.\nEach homologous chromosome in X is denoted by \\(H_i\\).\nThen we get \\(X = {H_1, H_2, . . ., H_m}\\), where m is the number of homologous pairs. All the homologous chromosomes \\(H_i \\in X\\) are from different cells of the same patient, and their chromosome type are the same, denoted by c. c is one-hot vector with the length of 24. As mentioned above, the band levels of chromosomes of cells may be different. In the dataset, band level is denoted by b, a one-hot vector with the length of 4. Because there are four types of band level in our dataset: 300, 400, 550 and 700, which also covers most of the common band types. Each \\(H_i\\) consists of two chromosomes, where homologous chromosome 1 and 2 are denoted by \\(H_{i,1} \\in R^{2\\times d}\\) and \\(H_{i,2} \\in R^{2\\times d}\\), respectively. d is the length."}, {"title": "3 METHODOLOGY", "content": "In this section, we introduce the proposed model HomNet for diagnosing chromosomal structural abnormalities by homologous similarity."}, {"title": "3.1 Overview", "content": "The framework of HomNet is depicted in Figure 3, comprising three main components: CMSBlock, HomBlock, and BagBlock.\nTo capture common characteristics of structural abnormalities across chromosomes with varying morphologies, we design HomNet based on homologous similarity. We generate five types of artificial abnormal chromosome sequences as negative samples based on real-world structural abnormalities. Subsequently, we devise a self-supervised training strategy to utilize the chromosomes of healthy individuals and the artificially generated chromosomes. To address the data inconsistent distribution problem across different hospitals, we propose fine-tuning the model for each specific hospital.\nFor each query tuple (X, c, b), CMSBlock extracts the distinguishable features \\(R_{i,j}\\) from each chromosome in X, where j \u0454 1, 2. Subsequently, HomBlock aligns each pair of homologous chromosomes and captures the differences between them based on homologous similarity, denoted as \\(H'\\). Finally, BagBlock considers all the \\(H'\\) to diagnose the structural abnormalities.\nMore specifically, CMSBlock first captures the features of the chromosomes. During this process, CMSBlock utilizes prior information band level b and chromosome type c to help HomNet to extract the features. Generally, there is at most one chromosome with structural abnormality in any pair of homologous chromosomes. Thus, we propose to detect the chromosomal structural abnormalities by homologous similarity. However, it is challenging to capture the differences since the shape of each chromosome varies and the diagram of chromosome pair may be flipped over, i.e., they are not perfectly aligned. To align each part, HomBlock uses an inter-attention based strategy to capture the difference H between the representations \\(H_{i,1}\\) and \\(H_{i,2}\\) of homologous chromosome 1 and 2. As mentioned above, in order to reduce noise disturbance and increase judgment reliability, HomNet considers multiple pairs of homologous chromosomes simultaneously in BagBlock. After getting all the difference representation (\\(H'_1, H'_2, ..., H'_m\\)) of the Bag X, BagBlock makes a prediction \\(\\hat{Y}\\) according to these representations."}, {"title": "3.2 Self-supervised Learning with Artificial Abnormalities", "content": "Due to the significant imbalance between the number of chromosomes with structural abnormalities and those without, it becomes challenging to identify distinctive features for abnormality detection [27]. On the bright side, we possess a substantial amount of chromosome data from healthy individuals. Leveraging this data"}, {"title": "3.3 Modeling the Feature of Chromosomes", "content": "Before capturing the differences between homologous chromosomes, we model features of chromosomes. Each chromosome, \\(H_{i,j}\\), is from a chromosome diagram with or without structural abnormality. We propose CMSBlock to extract the features of each chromosome. As Figure 3 shows, the CMSBlock first merges two sequences into one, and get \\(H^{mg}_{i,j}\\). Then, CMSBlock utilizes \\(H^{mg}_{i,j}\\) band type b and chromosome type c to obtain the chromosomal representation \\(R_{i,j}\\).\nMerge two chromosome sequences. The chromosome data we obtain consists of two sequences: \\(H_{i,j} \\in R^{2\\times d}\\). As previously mentioned, these sequences represent the mean sequences of the left and right portions of the chromosome diagrams, respectively. Given the partial differences between the left and right sequences within \\(H_{i,j}\\), both containing crucial chromosome information, a simple merging approach using average, maximum, or minimum values would result in substantial information loss. Therefore, we opt to merge these sequences using a learnable method. Specifically, we employ a convolution operation, and get the representation \\(H^{mg}_{i,j}\\).\n\\[H^{mg}_{i,j} = Conv(H_{i,j})\\]\nModel the feature of regions. Subsequently, CMSBlock extracts the features of each chromosome, obtaining the feature representation \\(R_{i,j}\\). As depicted in Figure 2, the chromosome diagram displays multiple grayscale bands along the chromosomes, which are referred to as regions [35]. When a structural abnormality occurs, the region where the abnormality happens will correspondingly change. For instance, in the case of a chromosomal deletion [35], the corresponding region will also be missing.\nTherefore, HomNet detects structural abnormalities by analyzing the differences in regions between homologous chromosomes. Therefore, we divide \\(H^{mg}_{i, j}\\) into multiple subsequences, each representing a region of the chromosome.\nAdditionally, leveraging the prior knowledge that chromosome types and band levels can aid in modeling the chromosomes, we"}, {"title": "3.4 Capture the Differences between Homologous Chromosomes", "content": "Based on expert detection processes, HomNet diagnoses structural abnormalities through homologous similarity. As depicted in Figure 1, diagrams of homologous chromosome pairs with structural abnormalities differ, while those of normal homologous chromosomes are similar. However, most existing anomaly detection methods concentrate on individual objects and do not leverage the distinctions between homologous chromosomes with structural abnormalities. Therefore, we introduce HomBlock to capture the differences between homologous chromosomes, based on their feature representations, \\(R_{i,1}\\) and \\(R_{i,2}\\).\nAdaptive region alignment in homologous pairs. As mentioned above, obtaining the difference of homologous chromosomes involves comparing the distinctions between the feature representations of corresponding regions in a pair of homologous chromosomes. However, due to the free oscillation of chromosomes in cells, and potential inversion of chromosome diagrams, the representations \\(R_{i,1}\\) and \\(R_{i,2}\\), which encode chromosomal structural information, are not well aligned. Mere subtraction or stacking of these representations without proper alignment introduces bias. Therefore, HomBlock employs an adaptive alignment method to capture homologous differences by aligning each region between homologous chromosomes. HomBlock adaptively aligns each row of \\(R_{i,1}\\) with each row of \\(R_{i,2}\\). Here, \\(r_i\\) represents the \\(e^{th}\\) row of \\(R_{i,j}\\); and also the \\(e^{th}\\) region in the chromosome.\nHomBlock initially computes the similarity between corresponding regions. For instance, considering the \\(e^{th}\\) region of homologous chromosome 1, \\(r_{i,1}\\), we calculate the similarity between all regions"}, {"title": "4 EXPERIMENT", "content": "Datasets. As mentioned in Section 2.1, we use the dataset sampled from healthy people for self-supervised learning. Additionally, we also use the artificial samples with and without structural abnormalities. After self-supervised training, we fine tune HomNet on each dataset from patients with chromosomal structural abnormalities from Hos#1, Hos#2, Hos#3 and Hos#4. The number of homologous chromosome pair in a bag is set as 5, that is, m is set as 5. Due to the privacy and sensitivity of chromosome data with structural abnormalities, almost all public datasets contain only normal chromosomes. Therefore, we constructed artificial structural abnormal chromosome data on the public chromosome dataset Pki-3 [44]. Experiments are also performed on this dataset for supplemental reference. More details about the dataset can be found in the Appendix.\nBaseline. We compare our proposed model, HomNet, with several baseline models. Specifically, we initially compare our model with a classical machine learning method: Logistic Regression (LR) based on feature engineering. Additionally, we conduct experiments using commonly employed unsupervised methods for anomaly detection, including OC-SVM [51], Deep-SVDD [46], and an AutoEncoder (AE) based method [61]. Furthermore, we compare our model with supervised methods, such as MLP-Mixer [57], Vit [12], Xception [10], ResNet [20], DensNet [23], and MobileNet [22]. In addition, we also conduct an experiment with a recent contrastive learning-based method for detecting structural anomalies [5]. This method employs a Siamese architecture and allows for interchangeable backbone models, hence it is abbreviated as \"Siamese\".\nTraining. For the pre-training stage, we utilize normal samples and samples with artificial abnormalities. During this stage, we implement Adam as the optimizer, setting learning rate at 0.001 with a batch size of 512. A validation set, which does not overlap with the training set, is also used to identify the optimal pre-trained model. We then incorporate an early stopping mechanism to monitor model convergence closely. Specifically, if there's no observed enhancements in the validation set over 10 consecutive epochs, the training is discontinued. For the fine-tuning stage, we freeze the parameters of CMSBlock and the first layer of HomBlock. This strategy helps transfer learned knowledge from the pre-training stage. The Adam optimizer, with a learning rate of 0.00001, is once again used here. We also employ the same early stopping mechanism here."}, {"title": "4.2 Performance Evaluation", "content": "We present the performance of all methods in chromosomal structural abnormalities detection across four hospital datasets in Table 2. The results for Hos#4 outperform those of other hospitals, while the outcomes for Hos#1 and Hos#3 are marginally less favorable. The varying performances across different hospitals highlight the inconsistency in the distribution of chromosome data, emphasizing the need to individually fine-tune the data from each hospital based on these experimental findings.\nOverall, HomNet demonstrates superior performance across all four hospitals. On the one hand, the manual feature-based logistic regression method only exhibits limited capability in detecting"}, {"title": "4.3 Ablation Study", "content": "HomNet utilizes the homologous similarity between aligned homologous chromosomes (Pair strategy) to diagnose structural abnormalities. Additionally, HomNet considers multiple pairs of homologous"}, {"title": "4.4 Running Time Comparison", "content": "We evaluated the running time of HomNet in comparison with other models by testing the completion of 100 batches and measuring the convergence time on the pre-training dataset. The following results, presented in seconds, are obtained:"}, {"title": "5 APPLICATION", "content": "For practical clinical diagnostic applications, HomNet integrates an end-to-end pipeline with AutoVision [54], an Al analysis system for karyotypes developed by Hangzhou Diagens Biotechnology Co., Ltd., China. To begin with, physicians upload their patients' karyotypes to AutoVision, which has been enhanced with the integration of HomNet. Subsequently, the enhanced AutoVision, now incorporating HomNet, optimizes and organizes the karyotypes, yielding chromosome diagrams and band level identifications within an impressive 3 seconds, as depicted in Figure Figure 4. The chromosome diagrams are then converted into sequence data, as detailed in Section 2.1. This sequence data, along with the chromosome type and band levels, serves as input for HomNet, which diagnoses the presence of structural abnormalities. The final diagnosis results are directly output to the physicians. Notably, HomNet can diagnose chromosomal structural abnormalities using data from a single patient, encompassing 115 pairs of homologous chromosomes from five cells, in less than 5 milliseconds."}, {"title": "6 RELATED WORK", "content": "For clarity, we first review methods related to anomaly detection, then introduce works about detecting chromosomes with structural abnormalities.\nAnomaly detection is an important topic in diverse research fields and application domains [8, 9, 24]. Anomalies are also referred to as outliers, deviants or abnormalities [2]. Chromosomes with structural abnormalities that are different from normal chromosomes can also be called anomalies.\nTraditional anomaly detection methods include Principal Component Analysis (PCA) based methods [21, 53], Nearest Neighbor (NN) based methods [6, 31], and the One-Class Support Vector Machine (OC-SVM) [51] that learns a decision function for novelty detection, that is, classifying new data as similar or different one to the training set. These methods are unsupervised. Because in the"}, {"title": "7 CONCLUSION", "content": "In this paper, we study the problem of chromosomal structural abnormalities diagnosis. Inspired by the homologous similarity of chromosomes and the diagnostic process of doctors, we propose a novel model, HomNet, to model features of chromosomes and diagnose chromosomal structural abnormalities by homologous similarity.\nCentral to our approach is the innovative utilization of multiple homologous chromosome pairs: a strategy akin to how skilled diagnosticians compare multiple diagrams for accuracy. HomNet simultaneously considers the information of multiple pairs of homologous chromosomes and detects structural abnormalities by capturing the differences between homologous chromosomes.\nAdditionally, we artificially construct chromosomal samples with structural abnormalities according to different types of real-world structural abnormalities. And self-supervised learning has been adopted to enable HomNet to fully learn chromosomes with data of normal chromosomes and artificial structural abnormalities. Then, we fine-tune HomNet with data from different hospital to address the challenge of inconsistent distribution.\nExperimental results show that HomNet achieved significantly better performance than other baselines on real-world dataset and public datset with artificial abnormalities. In addition, ablation studies further underscore the indispensability of each component within HomNet, highlighting the synergistic effect of its carefully crafted design."}, {"title": "A APPENDIX", "content": "According to the real world chromosomes with structural abnormalities in our datasets, we construct five types of artificial structural abnormality chromosome sequences:\n\u2022 Deleted. Part of the sampled chromosome sequences is deleted, which makes the length of the chromosome sequence shorter than before. The corresponding types of real world chromosome structural abnormality include deletion: a portion of the chromosome is missing or has been deleted [33], and the donor chromosomes in insertion abnormalities: a portion of one chromosome has been deleted from its normal place and inserted into another chromosome [4].\n\u2022 Added with other fragments. The sampled chromosome sequences are added with a non-self segment, which makes the length of the chromosome sequences longer than before. The corresponding types of real world chromosome structural abnormalities include the receptor chromosomes of insertion abnormality and some unbalanced translocations: a portion of one chromosome has been transferred to another chromosome [36].\n\u2022 Duplicated with self fragments. The sampled chromosome sequences are added with a segment of its own, which also makes the chromosome sequences longer. The corresponding type of real world chromosome structural abnormality is duplication: a portion of the chromosome has been duplicated [60].\n\u2022 Replaced. One segment of a pair of sampled chromosome sequences, the left part and right part, is replaced by another, which doesn't change the length. If it is replaced by a segment of itself, the corresponding type of real world chromosome structural abnormality is inversion: A portion of the chromosome has broken off, turned upside down, and reattached [38]. If it is replaced by a segment from another pair of sampled chromosome sequences, the corresponding type of real world chromosome structural abnormality is balanced translocations.\n\u2022 Robertsonian translocation. The chromosome sampling sequence was symmetrical and repeated, which make the length doubled. The corresponding type of real world chromosome abnormality is robertsonian translocation: an entire chromosome has attached to another at the centromere [18]."}, {"title": "A.2 Datasets", "content": "As mentioned in Section 2.1, we use the dataset sampled from both healthy people and patients. We split the datasets according to the desensitized patient IDs. There is no overlap between the patients in the training set and test set. In the self-supervised learning stage,"}, {"title": "A.3 Experiment setting", "content": "For feature engineering-based LR, we carefully extract features of one chromosome including mean, variance, on-peak and off-peak of the sampled sequence data, and features between the chromosomes in a homologous pair including DTW distance, the correlation coefficient and covariance. For anomaly detection methods, such as OC-SVM, Deep-SVDD and AE-based method, we use the data of normal chromosomes from healthy people as the training set. For the supervised-learning based method, we change the operation of dividing the image into multiple patches in the first step into the operation of dividing the sampled sequence into multiple subsequences or transfer the Conv2D into Conv1D to handle the sequential chromosome data. For LR and OC-SVM, We used the sk-learn [40] library for our experiments. For Deep-SVDD and AE-based method, we use the PyOD [61] libary for our experiments. The codes of MobileNet, Xception, DensNet and ResNet refer to https://github.com/weiaicunzai/pytorch-cifar100. The code of MLP-Mixer refers to https://github.com/google-research/vision_transformer. The code of Vit refers to https://github.com/lucidrains/vit-pytorch. The code of Siamese refers to https://github.com/MEABECHAR/ ChromosomeSiameseAD. Besides, we use Adam [30] optimizer with a learning rate of 0.001 for self-supervised learning and that of 0.00001 for fine-tuning, and the batch size is set as 512. During the fine-tuning, we freeze the parameters of CMSBlock and the first difference extraction layer in HomBlock, namely the first attention layer."}]}